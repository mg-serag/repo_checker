[
  {
    "instance_id": "jupyterlab__jupyterlab-17654",
    "pr_id": 17654,
    "issue_id": 17653,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "UI tests snapshot update is needed\nAs a follow-up to https://github.com/jupyterlab/jupyterlab-demo/pull/150\n\n![Image](https://github.com/user-attachments/assets/6ef6def7-5549-4a58-a112-2cfa6fc90376)",
    "issue_word_count": 31,
    "test_files_count": 8,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json"
    ],
    "base_commit": "b7b72035093b4f07919c9f3d2360ddd29421b09a",
    "head_commit": "9aafe7fa970ea341829bb11add532439efa3a286",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17654",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17654",
    "dockerfile": "",
    "pr_merged_at": "2025-06-25T14:39:15.000Z",
    "patch": "",
    "test_patch": "diff --git a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\nindex fb09c26d69c2..cc13f6cdf22e 100644\n--- a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n+++ b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n@@ -203,6 +203,24 @@\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n+  {\n+    \"id\": \"apputils:license-report\",\n+    \"label\": \"Download All Licenses as Markdown\",\n+    \"caption\": \"Download All Licenses as Markdown\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"apputils:licenses\",\n+    \"label\": \"Licenses\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"apputils:licenses-refresh\",\n+    \"label\": \"Refresh Licenses\",\n+    \"caption\": \"Refresh Licenses\",\n+    \"shortcuts\": []\n+  },\n   {\n     \"id\": \"apputils:load-statedb\",\n     \"label\": \"Load state for the current workspace.\",\n@@ -862,7 +880,7 @@\n   },\n   {\n     \"id\": \"filebrowser:delete\",\n-    \"label\": \"Delete\",\n+    \"label\": \"Move to Trash\",\n     \"caption\": \"\",\n     \"shortcuts\": [\n       \"Delete\"\n@@ -1242,8 +1260,8 @@\n   },\n   {\n     \"id\": \"help:license-report\",\n-    \"label\": \"Download All Licenses as Markdown\",\n-    \"caption\": \"Download All Licenses as Markdown\",\n+    \"label\": \"Download All Licenses\",\n+    \"caption\": \"\",\n     \"shortcuts\": []\n   },\n   {\n@@ -1255,7 +1273,7 @@\n   {\n     \"id\": \"help:licenses-refresh\",\n     \"label\": \"Refresh Licenses\",\n-    \"caption\": \"Refresh Licenses\",\n+    \"caption\": \"\",\n     \"shortcuts\": []\n   },\n   {\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png\nindex 344894cb8fcf..cdc17f72e009 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png\nindex 695c769d9fe5..583a1e1714d3 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png\nindex cef4d4a2c85c..5c20f6ae7a1b 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png\nindex 070d36d531cb..dba74558a8a3 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex 81b343c85381..e90e5e8acb43 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png\nindex 764a5b24e478..b151039fce00 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\nindex a0120150111e..b9b89c4918c5 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n@@ -19,6 +19,7 @@\n   \"@jupyterlab/application-extension:tree-resolver\": \"Provides the tree route resolver\",\n   \"@jupyterlab/apputils-extension:announcements\": \"Add the announcement feature. It will fetch news on the internet and check for application updates.\",\n   \"@jupyterlab/apputils-extension:kernel-status\": \"Provides the kernel status indicator model.\",\n+  \"@jupyterlab/apputils-extension:kernels-settings\": \"Reserves the name for kernel settings.\",\n   \"@jupyterlab/apputils-extension:licenses-client\": \"The licenses client plugin for fetching licenses.\",\n   \"@jupyterlab/apputils-extension:licenses-plugin\": \"Adds licenses reporting tools.\",\n   \"@jupyterlab/apputils-extension:notification\": \"Add the notification center and its status indicator.\",\n@@ -33,6 +34,7 @@\n   \"@jupyterlab/apputils-extension:settings-connector\": \"Provides the settings connector.\",\n   \"@jupyterlab/apputils-extension:splash\": \"Provides the splash screen.\",\n   \"@jupyterlab/apputils-extension:state\": \"Provides the application state. It is stored per workspaces.\",\n+  \"@jupyterlab/apputils-extension:subshell-settings\": \"Kernel subshell settings.\",\n   \"@jupyterlab/apputils-extension:themes\": \"Provides the theme manager.\",\n   \"@jupyterlab/apputils-extension:themes-palette-menu\": \"Adds theme commands to the menu and the command palette.\",\n   \"@jupyterlab/apputils-extension:toggle-header\": \"Adds a command to display the main area widget content header.\",\n@@ -89,6 +91,7 @@\n   \"@jupyterlab/filebrowser-extension:download\": \"Adds the download file commands. Disabling this plugin will NOT disable downloading files from the server, if the user enters the appropriate download URLs.\",\n   \"@jupyterlab/filebrowser-extension:factory\": \"Provides the file browser factory.\",\n   \"@jupyterlab/filebrowser-extension:file-upload-status\": \"Adds a file upload status widget.\",\n+  \"@jupyterlab/filebrowser-extension:notify-upload\": \"Adds feature to auto-open supported files after upload\",\n   \"@jupyterlab/filebrowser-extension:open-browser-tab\": \"Adds the open-in-new-browser-tab features.\",\n   \"@jupyterlab/filebrowser-extension:open-url\": \"Adds the feature \\\"Open files from remote URLs\\\".\",\n   \"@jupyterlab/filebrowser-extension:open-with\": \"Adds the open-with feature allowing an user to pick the non-preferred document viewer.\",\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17631",
    "pr_id": 17631,
    "issue_id": 17630,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`jupyterlab.browser_check` is slow as it downloads browsers\n## Description\n\nOn CI here and in extension-template we download a browser each time for browser check. We should improve CI to not waste dev time on it. We should cache to browser for this:\n\n![Image](https://github.com/user-attachments/assets/339c823c-0f6f-4f8d-a210-590efb88c89c)\n\nand probably do not need to setup Firefox here anymore:\n\n![Image](https://github.com/user-attachments/assets/59bdc496-aa62-43ca-8b7c-2778fc1dfd12)\n\nSince https://github.com/jupyterlab/jupyterlab/pull/15117\n\n",
    "issue_word_count": 85,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "a4b486eeaf248fced6889e1a58445c128511ebb1",
    "head_commit": "d11378b51342ae93ec5f72be7025853285bad0dd",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17631",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17631",
    "dockerfile": "",
    "pr_merged_at": "2025-06-16T08:28:03.000Z",
    "patch": "",
    "test_patch": "diff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex d7949d883e52..3c790269c93e 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -54,8 +54,14 @@ jobs:\n       - name: Base Setup\n         uses: jupyterlab/maintainer-tools/.github/actions/base-setup@v1\n \n-      - name: Setup firefox\n-        uses: browser-actions/setup-firefox@latest\n+      - name: Restore Playwright browsers cache\n+        uses: actions/cache@v3\n+        id: playwright-cache\n+        with:\n+          path: /home/runner/.cache/ms-playwright\n+          key: playwright-browsers-${{ runner.os }}-v1\n+          restore-keys: |\n+            playwright-browsers-${{ runner.os }}-\n \n       - name: Install dependencies\n         env:\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17563",
    "pr_id": 17563,
    "issue_id": 14598,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Emit a signal when the file browser selected items changes\n### Problem\n\nCurrently there is no easy way to know when the list of selected items in the file browser changes.\n\n### Proposed Solution\n\nAdd a new `selectionChanged` signal on the `FileBrowser`. The args could contain the list of selected items or `void` since they can already be retrieved with `browser.selectedItems()`.\n\n### Additional context\n\nThis would directly help Notebook 7 in the case of adding buttons to the file browser toolbar when multiple items are selected: https://github.com/jupyter/notebook/pull/6888",
    "issue_word_count": 81,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "docs/source/extension/extension_migration.rst",
      "packages/filebrowser/src/browser.ts",
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/test/browser.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/browser.spec.ts"
    ],
    "base_commit": "d23213cae9c0c194842860e0b22a01f1c8cc77dd",
    "head_commit": "15788a0f445e04f899b8057cd6ab715009381817",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17563",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17563",
    "dockerfile": "",
    "pr_merged_at": "2025-05-22T15:38:15.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17557",
    "pr_id": 17557,
    "issue_id": 17527,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix incorrect ARIA labels in the `MainAreaWidget`\n## References\r\n\r\nIssue: https://github.com/jupyterlab/jupyterlab/issues/13045\r\nPRs: https://github.com/jupyterlab/jupyterlab/pull/17155, https://github.com/jupyterlab/jupyterlab/pull/15137\r\n\r\n## Code changes\r\n\r\n- Changed the aria-label for `content.node` to \"main area content\" as a more generic default, replacing \"notebook content.\"\r\n- Changed the aria-label for `content.toolbar` to \"main area toolbar\" as a more useful default, replacing \"notebook actions.\"\r\n- Checked the test to address and correct any instances of improper behavior.\r\n\r\n## User-facing changes\r\n\r\nImproved ARIA labels for the main content area and toolbar to better reflect their purpose.\r\n\r\n## Backwards-incompatible changes\r\n\r\nNo backwards-incompatible changes identified.",
    "issue_word_count": 102,
    "test_files_count": 3,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/galata/notebook.spec.ts",
      "galata/test/jupyterlab/codemirror.test.ts",
      "packages/apputils/src/mainareawidget.ts",
      "packages/apputils/test/mainareawidget.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/galata/notebook.spec.ts",
      "galata/test/jupyterlab/codemirror.test.ts",
      "packages/apputils/test/mainareawidget.spec.ts"
    ],
    "base_commit": "e21950e4914cb03b1e5404b5d578cf4e1d20aed4",
    "head_commit": "cf5b0af9363d3340016bd40f7ae53052c51d2e96",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17557",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17557",
    "dockerfile": "",
    "pr_merged_at": "2025-05-26T10:28:52.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17556",
    "pr_id": 17556,
    "issue_id": 17493,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Auto-open uploaded notebook/file after upload\n### Problem\n\nWhen uploading a notebook to work on, it is hard to find it after it was uploaded.\n\n### Proposed Solution\n\nWhen user uses the upload button either:\n- open the uploaded notebook/file\n- display a notification with a button allowing to open the notebook/file\n\nQuestions:\n- a) should we open all file types or only notebooks and text files?\n- b) should we display the notification about upload complete for both upload button and drag-and-drop?\n- c) when user uploads multiple files should we open them all?\n- d) if user uploads a large file which could freeze the UI when opened, should we still open it? Should there be a size limit for auto-open?\n- e) should it be opt-in or opt-out?\n\n### Additional context\n\n- Google Colab opens the uploaded notebook straightaway. Colab only allows to upload one notebook at a time.\n- Google Drive shows a little notification in the right corner allowing to open the uploaded file or to display its location:\n   ![Image](https://github.com/user-attachments/assets/d68a3f30-ec46-4567-8d84-826fb710a85a)\n\n\n\n\n\n",
    "issue_word_count": 175,
    "test_files_count": 1,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "galata/test/galata/filebrowser.spec.ts",
      "packages/filebrowser-extension/schema/browser.json",
      "packages/filebrowser-extension/src/index.ts",
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/src/upload.ts",
      "packages/filebrowser/src/uploadstatus.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/galata/filebrowser.spec.ts"
    ],
    "base_commit": "e5bc7eaaa7315e2d56bfd482efe4302e6a894c33",
    "head_commit": "c4ba704c647dfe060f516d8e2d03d8716b394c31",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17556",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17556",
    "dockerfile": "",
    "pr_merged_at": "2025-05-26T07:29:15.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17552",
    "pr_id": 17552,
    "issue_id": 17544,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Temporarily ignore links to github.com\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\nThe check links job now more often fails than not with `429: Too Many Requests` on the `jupyterlab/galata/__init__.py` link:\r\n\r\n```\r\n_ /home/runner/work/jupyterlab/jupyterlab/galata/README.md: https://github.com/jupyterlab/jupyterlab/tree/main/jupyterlab/galata/__init__.py _\r\nhttps://github.com/jupyterlab/jupyterlab/tree/main/jupyterlab/galata/__init__.py: 429: Too Many Requests\r\n```\r\n\r\nThis PR disables checking of that link.\r\n\r\nAlso see https://github.com/jupyterlab/jupyterlab/pull/17537#issuecomment-2851184465\r\n\r\n\r\n## Code changes\r\n\r\nNone\r\n\r\n## User-facing changes\r\n\r\nNone\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone",
    "issue_word_count": 120,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "a037918c8dfd05e2c5a68641b0e34785f5c10be1",
    "head_commit": "1337c74fd9f67b7e1b01fd5ff09bd1d8ce4919dc",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17552",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17552",
    "dockerfile": "",
    "pr_merged_at": "2025-05-07T11:55:12.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17551",
    "pr_id": 17551,
    "issue_id": 17544,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Temporarily ignore links to github.com\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\nThe check links job now more often fails than not with `429: Too Many Requests` on the `jupyterlab/galata/__init__.py` link:\r\n\r\n```\r\n_ /home/runner/work/jupyterlab/jupyterlab/galata/README.md: https://github.com/jupyterlab/jupyterlab/tree/main/jupyterlab/galata/__init__.py _\r\nhttps://github.com/jupyterlab/jupyterlab/tree/main/jupyterlab/galata/__init__.py: 429: Too Many Requests\r\n```\r\n\r\nThis PR disables checking of that link.\r\n\r\nAlso see https://github.com/jupyterlab/jupyterlab/pull/17537#issuecomment-2851184465\r\n\r\n\r\n## Code changes\r\n\r\nNone\r\n\r\n## User-facing changes\r\n\r\nNone\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone",
    "issue_word_count": 120,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "0ec9848d1427295e2f1308acbd26638e6319593c",
    "head_commit": "e16cf944ebac8200377b30689e342810aea16f2b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17551",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17551",
    "dockerfile": "",
    "pr_merged_at": "2025-05-07T14:48:45.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17533",
    "pr_id": 17533,
    "issue_id": 17525,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Update lumino to `v2025.4.30` to pull menu aria fix\n\r\n## References\r\n\r\n- pulls https://github.com/jupyterlab/lumino/pull/753\r\n- to be released together with https://github.com/jupyterlab/jupyterlab/pull/17472\r\n\r\nCC @nkn2022\r\n\r\n## Code changes\r\n\r\nUpdates to the latest lumino patch.\r\n\r\n## User-facing changes\r\n\r\nMenu items with a checkmark (e.g. toggled commands) will be announced as checked by screen readers supporting the [`menuitemcheckbox` role](\r\nhttps://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Reference/Roles/menuitemcheckbox_role)\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 72,
    "test_files_count": 1,
    "non_test_files_count": 29,
    "pr_changed_files": [
      "builder/package.json",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/federated/md_package/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "jupyterlab/tests/mock_packages/mimeextension/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console/package.json",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer/package.json",
      "packages/debugger/package.json",
      "packages/docmanager-extension/package.json",
      "packages/docmanager/package.json",
      "packages/docregistry/package.json",
      "packages/documentsearch-extension/package.json",
      "packages/documentsearch/package.json",
      "packages/extensionmanager/package.json",
      "packages/filebrowser-extension/package.json",
      "packages/filebrowser/package.json"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/mock_packages/mimeextension/package.json"
    ],
    "base_commit": "2033c8ef713cd113d2477d43aca8cd033bae54ab",
    "head_commit": "7c10351f12e80928c53a54a0ab50d2e9b6e13555",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17533",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17533",
    "dockerfile": "",
    "pr_merged_at": "2025-05-02T09:09:58.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17527",
    "pr_id": 17527,
    "issue_id": 13045,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "ARIA labels on main area widget are incorrect (always referring to a notebook)\n## Description\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/b57ec962a7b8cda65bb89a72223f195564f8387a/packages/apputils/src/mainareawidget.ts#L46-L50\r\n\r\nsays \"notebook content\" when using a file editor or opening a CSV file, etc, but it should not.\r\n\r\nWe could:\r\n- change it to \"main area content\" and \"main area toolbar\"\r\n- in each of the `MainAreaWidget` subclasses set a proper text\r\n  - we could take the string from a getter so subclasses have less work (getter so that we can translate)\r\n  - if we want to be more strict we could use an abstract getter and force all subclasses of `MainAreaWidget` to provide an aria-label since 4.0\r\n",
    "issue_word_count": 101,
    "test_files_count": 3,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/galata/notebook.spec.ts",
      "galata/test/jupyterlab/codemirror.test.ts",
      "packages/apputils/src/mainareawidget.ts",
      "packages/apputils/test/mainareawidget.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/galata/notebook.spec.ts",
      "galata/test/jupyterlab/codemirror.test.ts",
      "packages/apputils/test/mainareawidget.spec.ts"
    ],
    "base_commit": "0331eb6dcd00b2f47d3d187c75472ef92f7b5271",
    "head_commit": "4975b0103208d0f03bdc5df5bd9a375c27e89086",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17527",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17527",
    "dockerfile": "",
    "pr_merged_at": "2025-05-08T12:14:08.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17522",
    "pr_id": 17522,
    "issue_id": 17521,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`Test Minimum Versions` failing on 4.3.x\n- branch: https://github.com/jupyterlab/jupyterlab/actions/runs/14751729095/job/41410552389\n- PR https://github.com/jupyterlab/jupyterlab/actions/runs/14751733001/job/41418804615?pr=17512\n- it was not failing here though: https://github.com/jupyterlab/jupyterlab/pull/17520\n\n```\n  + python -m pip install --upgrade pip\n  Requirement already satisfied: pip in /opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages (25.0.1)\n  + '[' Linux '!=' Windows ']'\n  ++ which python\n  + pipx install hatch --python /opt/hostedtoolcache/Python/3.8.18/x64/bin/python\n  creating virtual environment...\n  installing hatch...\n  Fatal error from pip prevented installation. Full pip output in file:\n      /opt/pipx/logs/cmd_2025-04-30_09.49.50_pip_errors.log\n  \n  Some possibly relevant errors from pip install:\n      TypeError: 'ABCMeta' object is not subscriptable\n  Error installing hatch.\n```\n\nMy guess would be a package was released assuming Python 3.9 syntax is ok and did not set versions correctly.\n\nHmm of `hatch` dependencies, `uv` had a big 0.7 release recently",
    "issue_word_count": 154,
    "test_files_count": 4,
    "non_test_files_count": 1,
    "pr_changed_files": [
      ".github/workflows/linuxjs-tests.yml",
      ".github/workflows/linuxtests.yml",
      ".github/workflows/macostests.yml",
      ".github/workflows/windowstests.yml",
      "pyproject.toml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxjs-tests.yml",
      ".github/workflows/linuxtests.yml",
      ".github/workflows/macostests.yml",
      ".github/workflows/windowstests.yml"
    ],
    "base_commit": "50a86d7a28a55b23038f4906970933817d115c39",
    "head_commit": "6af55d36b77f26a1ee4d07160afc9973b96f5af6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17522",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17522",
    "dockerfile": "",
    "pr_merged_at": "2025-04-30T17:30:03.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17486",
    "pr_id": 17486,
    "issue_id": 17247,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Undo / redo broken in `none` windowing mode\nUndo and redo (Cmd + Z, Cmd + Shift + Z on Mac) within a cell is only working on the first cell. I suspect it is caused by `yUndoManager`.\n\nTested with versions 4.3.4, 4.3.5, 4.4.0a3\n\n![Image](https://github.com/user-attachments/assets/3d7b804c-c9e8-4619-b201-fa8dca9dd8e8)",
    "issue_word_count": 51,
    "test_files_count": 1,
    "non_test_files_count": 17,
    "pr_changed_files": [
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/notebook/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer/package.json",
      "packages/console/package.json",
      "packages/debugger/package.json",
      "packages/docregistry/package.json",
      "packages/fileeditor/package.json",
      "packages/notebook-extension/package.json",
      "packages/notebook/package.json",
      "packages/notebook/test/widget.spec.ts",
      "packages/services/package.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/widget.spec.ts"
    ],
    "base_commit": "ea23ac60be1ae91b0feb4a773bf46857b76f1bb0",
    "head_commit": "5c3dbd42026fb9e6c62d2d4ebb1bff4d30a94c91",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17486",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17486",
    "dockerfile": "",
    "pr_merged_at": "2025-04-22T08:27:27.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17463",
    "pr_id": 17463,
    "issue_id": 17429,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix document search matching text within unsupported SVG tags\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\nFixes https://github.com/jupyterlab/jupyterlab/issues/17349\r\n\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\nI added `svg` in lowercase to the list of unsupported elements, along with some tests and comments that explain why checking the uppercase qualified name for SVG's is not always sufficient to identify an element.\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\nPreviously search candidates would match and be highlighted within SVGs which lead to the fragment not rendering and appearing as if it was disappearing.\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\nThe disappearing text video can be seen in the original issue, and the following is a video with the proposed changes.\r\n\r\nhttps://github.com/user-attachments/assets/8b01b699-1a7a-43fc-be75-e06476d61870\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\nI don't believe there should be any backward incompatible changes, however would it make sense to backport this fix?",
    "issue_word_count": 240,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/documentsearch/src/providers/genericsearchprovider.ts",
      "packages/documentsearch/test/documentsearchprovider.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/documentsearch/test/documentsearchprovider.spec.ts"
    ],
    "base_commit": "8b2fd4aab701e14d328260aba50f39594d74e5d0",
    "head_commit": "897b979f65ad382845e4dcd864a3f2ec165d6a30",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17463",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17463",
    "dockerfile": "",
    "pr_merged_at": "2025-04-11T15:34:20.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17453",
    "pr_id": 17453,
    "issue_id": 17452,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Obsolete dependency on importlib-resources\nThe importlib-resources dependency for Python < 3.9 is obsolete because the supported Python versions are >= 3.9\n",
    "issue_word_count": 18,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "jupyterlab/tests/test_app.py",
      "jupyterlab/upgrade_extension.py",
      "packages/lsp/schema.js",
      "pyproject.toml"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/test_app.py"
    ],
    "base_commit": "8ce37a58199674b1a7a44e2f5cb059465fcef411",
    "head_commit": "c5f5833d98be8a63d8b74ae8e46acf92a21bb0dd",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17453",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17453",
    "dockerfile": "",
    "pr_merged_at": "2025-04-08T06:42:36.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17442",
    "pr_id": 17442,
    "issue_id": 13677,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Command palette gets re-rendered even if hidden\n## Description\r\n\r\nCommand palette gets re-rendered even if hidden.\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Open command palette and two tabs\r\n2. Close the command palette\r\n3. Go to inspector right click on command palette element, select \"break on\" > \"subtree modifications\"\r\n4. Switch tabs\r\n5. See that command palette fragments get re-rendered via lumino virtual DOM\r\n\r\n![Screenshot from 2022-12-29 13-23-55](https://user-images.githubusercontent.com/5832902/209961278-164071f9-3032-4091-af3e-84102658cbcb.png)\r\n\r\nIt is not clear to me why this update appears. Of note the migration to `requestAnimationFrame` in lumino seems to make the debugging/profiling a bit more confusing as I don't immediately see if this was a genuine animation frame request or just lumino messaging.\r\n\r\n## Expected behavior\r\n\r\nUpdating command palette on tab switch is expected because different commands will become available in different contexts (e.g. text editor/notebook), but re-rendering it while it is hidden is not expected.\r\n\r\nIn a bigger picture we could ask: should command palette get detached rather than hidden. I think hiding is ok because there is ever only one command palette, but requires a better hygiene on when a re-render is triggered.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.0.0a31",
    "issue_word_count": 210,
    "test_files_count": 2,
    "non_test_files_count": 28,
    "pr_changed_files": [
      "builder/package.json",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/federated/md_package/package.json",
      "examples/federated/middle_package/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "galata/extension/package.json",
      "galata/package.json",
      "jupyterlab/tests/mock_packages/interop/token/package.json",
      "jupyterlab/tests/mock_packages/mimeextension/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/attachments/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/celltags-extension/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console/package.json",
      "packages/coreutils/package.json",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer/package.json"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/mock_packages/interop/token/package.json",
      "jupyterlab/tests/mock_packages/mimeextension/package.json"
    ],
    "base_commit": "0dbe74708be66cb9ac423c0fb47c66418c037a8f",
    "head_commit": "98f8b5fbfdc4444f4bba00a7870ff844763b864c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17442",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17442",
    "dockerfile": "",
    "pr_merged_at": "2025-04-01T10:40:58.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17429",
    "pr_id": 17429,
    "issue_id": 17349,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "DocumentSearch extension finds matches within unsupported element leading to disappearing text\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\n\nBefore creating a new issue:\n* Search for relevant issues\n* Follow the issue reporting guidelines:\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\n-->\n\n## Description\n\nWhen you have an embedded `<svg>` tag within your cell output the application search matches content inside the tag. This results in an unsupported `<mark>` tag being wrapped around the text, which doesn't render and makes your content appear to have missing text. I've attached a small video as an example with a developer build of the most recent commit off main.\n\nhttps://github.com/user-attachments/assets/c9885a5c-7259-499b-88ef-3b23eb2e8c46\n\n## Reproduce\n\nYou can reproduce by embedding a `svg` tag with some text, like the following cell.\n\n```python\nfrom IPython.display import display, HTML\n\nsvg = \"\"\"\n<svg height=\"30\" width=\"200\" xmlns=\"http://www.w3.org/2000/svg\">\n  <text x=\"10\" y=\"20\" font-family=\"Arial\" font-size=\"16\" fill=\"white\">Some Text</text>\n</svg>\n\"\"\"\n\ndisplay(HTML(svg))\n```\n\nThis was originally found by rendering a Plotly plot with a `notebook` renderer, and a user trying to search for the name of a subplot title. Unfortunately it took the user quite some time to realize that there was not an issue with how they were rendering their plot, but with their searched query stripping the text from their plot.\n\n## Expected behavior\n\nIdeally I'd expect the searched text within a `svg` to be wrapped with a `tspan` and some CSS fill styles to emulate a `mark` style. Otherwise, I'd expect an unsupported element to not be matched. However, it does appear that `SVG` is listed as an unsupported element in the `HTMLSearchEngine` class?\n\nhttps://github.com/jupyterlab/jupyterlab/blob/1c64e5e00c3842eb7694190ed80a31685dcdeffa/packages/documentsearch/src/providers/genericsearchprovider.ts#L67\n\n## Context\n\n<!--Complete the following for context, and add any other relevant context-->\n\n- Operating System and version: macOS Sequoia 15.2 - Intel chip\n- Browser and version: Firefox 135.0.1\n- JupyterLab version: 4.4.0b0\n\n<!--The more content you provide, the more we can help!-->\n\n<details><summary>Troubleshoot Output</summary>\n<pre>\nâ¯ jupyter troubleshoot\n\n[notice] A new release of pip is available: 24.0 -> 25.0.1\n[notice] To update, run: pip install --upgrade pip\n$PATH:\n        /Users/achhina/projects/jupyterlab/.venv/bin\n        /Users/achhina/bin\n        /Users/achhina/.pyenv/shims\n        /Users/achhina/.nix-profile/bin\n        /nix/var/nix/profiles/default/bin\n        /usr/local/bin\n        /System/Cryptexes/App/usr/bin\n        /usr/bin\n        /bin\n        /usr/sbin\n        /sbin\n        /var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin\n        /var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin\n        /var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin\n        /Library/Apple/usr/bin\n        /usr/local/go/bin\n        /Users/achhina/bin\n        /Users/achhina/.nix-profile/bin\n        /nix/var/nix/profiles/default/bin\n        /Applications/Ghostty.app/Contents/MacOS\n\nsys.path:\n        /Users/achhina/projects/jupyterlab/.venv/bin\n        /usr/local/Cellar/python@3.10/3.10.14/Frameworks/Python.framework/Versions/3.10/lib/python310.zip\n        /usr/local/Cellar/python@3.10/3.10.14/Frameworks/Python.framework/Versions/3.10/lib/python3.10\n        /usr/local/Cellar/python@3.10/3.10.14/Frameworks/Python.framework/Versions/3.10/lib/python3.10/lib-dynload\n        /Users/achhina/projects/jupyterlab/.venv/lib/python3.10/site-packages\n        /Users/achhina/projects/jupyterlab\n\nsys.executable:\n        /Users/achhina/projects/jupyterlab/.venv/bin/python3\n\nsys.version:\n        3.10.14 (main, Mar 19 2024, 21:46:16) [Clang 15.0.0 (clang-1500.3.9.4)]\n\nplatform.platform():\n        macOS-15.2-x86_64-i386-64bit\n\nwhich -a jupyter:\n        /Users/achhina/projects/jupyterlab/.venv/bin/jupyter\n\npip list:\n        Package                   Version        Editable project location\n        ------------------------- -------------- ----------------------------------\n        anyio                     4.8.0\n        appnope                   0.1.4\n        argon2-cffi               23.1.0\n        argon2-cffi-bindings      21.2.0\n        arrow                     1.3.0\n        asttokens                 3.0.0\n        async-lru                 2.0.4\n        attrs                     25.1.0\n        babel                     2.17.0\n        backports.tarfile         1.2.0\n        beautifulsoup4            4.13.3\n        bleach                    6.2.0\n        build                     1.2.2.post1\n        bump2version              1.0.1\n        cattrs                    24.1.2\n        certifi                   2025.1.31\n        cffi                      1.17.1\n        cfgv                      3.4.0\n        charset-normalizer        3.4.1\n        click                     8.1.8\n        comm                      0.2.2\n        coverage                  7.6.12\n        debugpy                   1.8.12\n        decorator                 5.2.1\n        defusedxml                0.7.1\n        distlib                   0.3.9\n        docutils                  0.21.2\n        exceptiongroup            1.2.2\n        executing                 2.2.0\n        fastjsonschema            2.21.1\n        filelock                  3.17.0\n        fqdn                      1.5.1\n        h11                       0.14.0\n        hatch                     1.14.0\n        hatchling                 1.27.0\n        html5lib                  1.1\n        httpcore                  1.0.7\n        httpx                     0.28.1\n        hyperlink                 21.0.0\n        identify                  2.6.8\n        idna                      3.10\n        importlib_metadata        8.6.1\n        iniconfig                 2.0.0\n        ipykernel                 6.29.5\n        ipython                   8.32.0\n        isoduration               20.11.0\n        jaraco.classes            3.4.0\n        jaraco.context            6.0.1\n        jaraco.functools          4.1.0\n        jedi                      0.19.2\n        Jinja2                    3.1.5\n        json5                     0.10.0\n        jsonpointer               3.0.0\n        jsonschema                4.23.0\n        jsonschema-specifications 2024.10.1\n        jupyter_client            8.6.3\n        jupyter_core              5.7.2\n        jupyter-events            0.12.0\n        jupyter-lsp               2.2.5\n        jupyter_server            2.15.0\n        jupyter_server_terminals  0.5.3\n        jupyterlab                4.4.0b0        /Users/achhina/projects/jupyterlab\n        jupyterlab_pygments       0.3.0\n        jupyterlab_server         2.27.3\n        keyring                   25.6.0\n        markdown-it-py            3.0.0\n        MarkupSafe                3.0.2\n        matplotlib-inline         0.1.7\n        mdurl                     0.1.2\n        mistune                   3.1.2\n        more-itertools            10.6.0\n        nbclient                  0.10.2\n        nbconvert                 7.16.6\n        nbformat                  5.10.4\n        nest-asyncio              1.6.0\n        nodeenv                   1.9.1\n        notebook_shim             0.2.4\n        overrides                 7.7.0\n        packaging                 24.2\n        pandocfilters             1.5.1\n        parso                     0.8.4\n        pathspec                  0.12.1\n        pexpect                   4.9.0\n        pip                       24.0\n        platformdirs              4.3.6\n        pluggy                    1.5.0\n        pre_commit                4.1.0\n        prometheus_client         0.21.1\n        prompt_toolkit            3.0.50\n        psutil                    7.0.0\n        ptyprocess                0.7.0\n        pure_eval                 0.2.3\n        pycparser                 2.22\n        Pygments                  2.19.1\n        pyproject_hooks           1.2.0\n        pytest                    8.3.4\n        pytest_check_links        0.10.1\n        pytest-console-scripts    1.4.1\n        pytest-cov                6.0.0\n        pytest-jupyter            0.10.1\n        pytest-timeout            2.3.1\n        pytest-tornasync          0.6.0.post2\n        python-dateutil           2.9.0.post0\n        python-json-logger        3.2.1\n        PyYAML                    6.0.2\n        pyzmq                     26.2.1\n        referencing               0.36.2\n        requests                  2.32.3\n        requests-cache            1.2.1\n        rfc3339-validator         0.1.4\n        rfc3986-validator         0.1.1\n        rich                      13.9.4\n        rpds-py                   0.23.1\n        ruff                      0.9.4\n        Send2Trash                1.8.3\n        setuptools                69.2.0\n        shellingham               1.5.4\n        six                       1.17.0\n        sniffio                   1.3.1\n        soupsieve                 2.6\n        stack-data                0.6.3\n        terminado                 0.18.1\n        tinycss2                  1.4.0\n        tomli                     2.2.1\n        tomli_w                   1.2.0\n        tomlkit                   0.13.2\n        tornado                   6.4.2\n        traitlets                 5.14.3\n        trove-classifiers         2025.2.18.16\n        types-python-dateutil     2.9.0.20241206\n        typing_extensions         4.12.2\n        uri-template              1.3.0\n        url-normalize             1.4.3\n        urllib3                   2.3.0\n        userpath                  1.9.2\n        uv                        0.6.3\n        virtualenv                20.29.2\n        wcwidth                   0.2.13\n        webcolors                 24.11.1\n        webencodings              0.5.1\n        websocket-client          1.8.0\n        zipp                      3.21.0\n        zstandard                 0.23.0\n</pre>\n</details>\n",
    "issue_word_count": 1219,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/documentsearch/src/providers/genericsearchprovider.ts",
      "packages/documentsearch/test/documentsearchprovider.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/documentsearch/test/documentsearchprovider.spec.ts"
    ],
    "base_commit": "85c82eba1caa7e28a0d818c0840e13756c1b1256",
    "head_commit": "3402b84ed7bf4d3a75ec6fef952b2c3eaf4cac00",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17429",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17429",
    "dockerfile": "",
    "pr_merged_at": "2025-04-09T12:26:13.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17408",
    "pr_id": 17408,
    "issue_id": 17407,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "HTML sanitizer strips some style attributes breaking custom grid and flexbox layouts\n## Description\n\nThere seems to be an issue with how style attributes are handled in Markdown cells or Markdown documents in JupyterLab. Specifically, custom CSS properties such as grid-template-columns, grid-gap, and flex-direction are not rendered as expected. This makes it impossible to create layouts using CSS for Markdown elements.\n\nWhen trying to use `div` elements with style attributes to create `grid` or `flexbox` layouts, the elements either don't behave as described in the CSS, or the styles appear ignored. Below is an example that demonstrates the issueâ€”it should position elements side by side using CSS Grid or in a column using Flexbox, but the rendered output fails to respect these styles.\n\n**Example**:\n```html\n<div style=\"color: black; display: grid; grid-template-columns: auto 1fr; grid-gap: 10px; text-align: left;\">\n  <div style=\"background-color: lightblue;\">left Column</div>\n  <div style=\"display: flex; flex-direction: column; margin-right: 150px;\">\n      <div style=\"background-color: pink;\">right row 1</div>\n      <div style=\"background-color: lightyellow;\">right row 2</div>\n    </div>\n</div>\n```\n\nExpected behavior: The outer `div` should display two columns within a grid layout, and the inner `div` should stack its child elements (Row 1 and Row 2) vertically with a margin. However, the actual rendered output does not conform to this structure.\n\n## Reproduce:\n\nSteps to reproduce the behavior:\n\n1. Open JupyterLab (e.g., version 4.4.0b1).\n2. Create a new notebook with a Mardown cell or Markdown document.\n3. Add the example HTML/Markdown code provided above into a Markdown cell or document.\n4. Render the Markdown content by executing the cell or saving the document.\n5. Observe that the styles are not applied correctly.\n\n![Image](https://github.com/user-attachments/assets/a2bc885a-9767-41ce-8c62-fbaf271dc797)\n\n## Expected behavior\n\nThe custom CSS provided in style attributes should be applied correctly to the elements, enabling users to create layouts like grids and flexbox within Markdown cells or documents. The resulting structure should match the defined styles, specifically:\n\nThe grid layout (grid-template-columns: auto 1fr; grid-gap: 10px) should display two elements side-by-side with a 10px gap between them.\nThe flexbox layout (flex-direction: column; margin-right: 150px) should display child elements stacked vertically with spacing applied as expected.\n\nLooking at the rendered output in Chrome DevTools suggests that the issue is related to a sanitizer stripping specific attributes. It appears that even valid style properties are being removed in the rendering pipeline, leading to the described issues.\n\n## Context\n\n- Operating System and version: Linux Ubuntu 24.04 \n- Browser and version: Chrome 134\n- JupyterLab version: 4.4.0b1\n\n\n",
    "issue_word_count": 432,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/apputils/src/sanitizer.ts",
      "packages/apputils/test/sanitizer.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/apputils/test/sanitizer.spec.ts"
    ],
    "base_commit": "76f8a56e63a01cdeca58756aa4f0aca6d8112d63",
    "head_commit": "3760d20e6fca5e29396cd7ea4f97682ee760cd99",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17408",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17408",
    "dockerfile": "",
    "pr_merged_at": "2025-05-08T08:41:58.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17404",
    "pr_id": 17404,
    "issue_id": 17371,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix rendering URLs as linked in errors\nThis PR fixes a bug in error output rendering that prevented URLs from being rendered as HTML links. This bug was introduced when IPython-style file linking was implemented for error output.\r\n\r\nHere is how URL linking in error output looked in JupyterLab 4.0.x:\r\n\r\n<img width=\"826\" alt=\"jupyterlab-v4 0 9\" src=\"https://github.com/user-attachments/assets/0eb2dbdf-6e43-432a-be97-544f466b0b3d\" />\r\n\r\nIn JupyterLab 4.3.5, some files are linked, but a nearby URL can cause a file linking to fail. Additionally, URLs are not linked:\r\n\r\n<img width=\"841\" alt=\"jupyterlab-v4 3 5 unmarked\" src=\"https://github.com/user-attachments/assets/5431def1-ae75-418e-bf7d-958acfb817e6\" />\r\n\r\nThis PR fixes both of those cases:\r\n\r\n<img width=\"845\" alt=\"jupyterlab-fix-17225\" src=\"https://github.com/user-attachments/assets/68c837db-0a5a-41b6-a284-47f8450950f8\" />\r\n\r\n\r\n## References\r\n\r\nFixes #17225 \r\n\r\n## Code changes\r\n- Changes a broad selector (all `a` tags) to a more narrow selector `a[data-path]` to only do IPython-style file linking for relevant links so that URLs can be linked properly.\r\n- Adds a unit test to verify that both URL and file links render properly.\r\n- Changes some private functions that returns promises to `async` to simplify them and to reduce the number of immediately-resolving promises.\r\n\r\n## User-facing changes\r\n\r\n**before** (errors highlighted in magenta)\r\n\r\n<img width=\"846\" alt=\"jupyterlab-v4 3 5 marked\" src=\"https://github.com/user-attachments/assets/32b871c8-87cf-4d0f-9550-5e5451ceca40\" />\r\n\r\n**after**\r\n\r\n<img width=\"845\" alt=\"jupyterlab-fix-17225\" src=\"https://github.com/user-attachments/assets/9534b1fa-458c-410e-964e-4f28fffc412c\" />\r\n\r\n\r\n## Backwards-incompatible changes\r\nn/a",
    "issue_word_count": 264,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/rendermime/src/renderers.ts",
      "packages/rendermime/test/factories.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/rendermime/test/factories.spec.ts"
    ],
    "base_commit": "39489c1e96b51fd5a7e19b615863af7c1265dc5b",
    "head_commit": "8306764aa1b2901791b6edfb38f83a0b9c0f9584",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17404",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17404",
    "dockerfile": "",
    "pr_merged_at": "2025-03-17T15:51:16.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17391",
    "pr_id": 17391,
    "issue_id": 17369,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix cell output stream if previous chunk did not end in new line\n## References\r\n\r\nFixes #17358.\r\n\r\n## Code changes\r\n\r\nUpdate current position to end of text.\r\n\r\n## User-facing changes\r\n\r\nBetter handling of cell output streams.\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone.",
    "issue_word_count": 25,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/outputarea/src/model.ts",
      "packages/outputarea/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/outputarea/test/model.spec.ts"
    ],
    "base_commit": "b68b936ad61612716cda7c4d579c60e383b59736",
    "head_commit": "36f145ac0cfefadae6999dc3313ac67728a011aa",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17391",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17391",
    "dockerfile": "",
    "pr_merged_at": "2025-03-13T09:12:13.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17387",
    "pr_id": 17387,
    "issue_id": 510,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "(soft) line wrapping in text editor not working\nTitle says it all... It makes it basically impossible to edit files that may have been created without hard `\\n` breaks, as is often the case from folks who edit with line-wrapping editors.\n",
    "issue_word_count": 34,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "jupyterlab/tests/mock_packages/test_no_hyphens/yarn.lock"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/mock_packages/test_no_hyphens/yarn.lock"
    ],
    "base_commit": "ff9597a2db5f6e04d25d91f5bcb3c9e2b802c940",
    "head_commit": "91b31c10a6d837d08e1119c3331ad557bf22a1e7",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17387",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17387",
    "dockerfile": "",
    "pr_merged_at": "2025-03-12T14:28:46.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17371",
    "pr_id": 17371,
    "issue_id": 17225,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`stderr` in cell outputs do not auto-link URLs like `stdin`\n## Description\n\nURLs are automatically linked in the output area of a cell if it is written `stdout` but not if it is written to `stderr`. Here is what it looks like:\n\n<img width=\"789\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/0be6a799-33ca-45dd-871c-63493664a5a7\" />\n\nThis rendering is implemented in the `@jupyterlab/rendermime` package for the MIME types `application/vnd.jupyter.stderr` and `application/vnd.jupyter.stdout`:\n\nhttps://github.com/jupyterlab/jupyterlab/blob/main/packages/rendermime/src/factories.ts#L64-L82\n\n## Reproduce\nCreate a notebook with a Python kernel and run the following code to see the difference between `stdout` and `stderr`.\n\n```python\nimport sys\nprint(\"https://example.com/ written to stderr\", file=sys.stderr)\nprint(\"https://example.com/ written to stdout\", file=sys.stdout)\n```\n\n## Expected behavior\n\nUnless there is some consideration I am missing (perhaps security-related), I would expect the same link handling behavior in both `stdout` and `stderr`.\n\n## Context\n\n- Operating System and version:  macOS\n- Browser and version: Chrome 131\n- JupyterLab version: 4.4.0a2\n",
    "issue_word_count": 170,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/rendermime/src/renderers.ts",
      "packages/rendermime/test/factories.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/rendermime/test/factories.spec.ts"
    ],
    "base_commit": "9749b07d54b4ac7622e617f1afdce770849c6f92",
    "head_commit": "8a8e7a8c16519a2cdff4c17694c9490631b995d6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17371",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17371",
    "dockerfile": "",
    "pr_merged_at": "2025-03-17T14:38:53.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17369",
    "pr_id": 17369,
    "issue_id": 17358,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`print()` with newline and `end=\"\"` can produce corrupt output\n## Description\n\n`print()` with newline and `end=\"\"` can produce corrupt output.\n\n## Reproduce\n\nCreate and execute a cell with the following code:\n\n```Python\nprint(\"The meaning of life is....\\nSome people... \", end=\"\", flush=True)\nprint(\"More text.\")\n```\n\nThe output, for me (Jupyter Lab 4.3.4) is\n```\nThe meaning of life is....\nMore text.e... \n```\n\nI originally discovered this in a cell magic, but it happens when I merely `print()` in a cell.\n\n## Expected behavior\n\nThe output should be \n```\nThe meaning of life is....\nSome people... More text.\n```\n\n## Context\n\n- Operating System and version: MacOS 15.3.1<!-- e.g. Linux Ubuntu 21.04 -->\n- Browser and version: Same behavior, 133.0.6943.126 (Official Build) (arm64), Safari, and Firefox.<!-- e.g. Chrome 92 -->\n- JupyterLab version: 4.3.4 <!-- e.g. 3.1.7 -->\n\nSame behavor in Jupyter Version: 7.3.2.\n\nNo Browser Output in the JavaScript console.\n",
    "issue_word_count": 145,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/outputarea/src/model.ts",
      "packages/outputarea/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/outputarea/test/model.spec.ts"
    ],
    "base_commit": "d470c501f50ad7075413cd89967a1a8a332b9a2f",
    "head_commit": "ee104e5a368f237af47c963a1593696fe1a14013",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17369",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17369",
    "dockerfile": "",
    "pr_merged_at": "2025-03-12T17:46:42.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17359",
    "pr_id": 17359,
    "issue_id": 13116,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Request for Accuracy: Rename \"Delete\" to \"Move to Trash\"\n## Description\r\n\r\nIn the Jupyterhub UI, the user has the option to \"Delete\" the file the have selected.\r\nHowever, the actual behavior of \"Delete\" is to move the file to $HOME/.local/share/files/Trash\r\n\r\nThis caused some problems for my team when we wondered why storage space wasn't being cleared after \"Delete\"ing a file. Renaming this option to \"Move to Trash\" would be more accurate and mimic what MacOS/Windows names this identical feature.\r\n\r\n![Screen Shot 2022-09-22 at 4 38 54 PM](https://user-images.githubusercontent.com/53441157/191869414-215edc2c-e967-4157-8dce-eb4d87b642e3.png)\r\n\r\n## Expected behaviour\r\nWe expected \"Delete\" to delete and clear the storage space that the file once occupied.\r\n\r\n## Actual behaviour\r\n\"Delete\" moves the file to a different location without actually deleting it.\r\n",
    "issue_word_count": 130,
    "test_files_count": 7,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/file-jupyterlab-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/folder-jupyterlab-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/running-notebook-jupyterlab-linux.png",
      "jupyterlab/labapp.py",
      "packages/filebrowser-extension/src/index.ts",
      "packages/filebrowser/src/listing.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/file-jupyterlab-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/folder-jupyterlab-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/running-notebook-jupyterlab-linux.png"
    ],
    "base_commit": "ff9597a2db5f6e04d25d91f5bcb3c9e2b802c940",
    "head_commit": "8ad22be99de659b90fabe814aaf030d80c3eb9cc",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17359",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17359",
    "dockerfile": "",
    "pr_merged_at": "2025-03-13T12:40:00.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17357",
    "pr_id": 17357,
    "issue_id": 17298,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Updated enabling logic for run-all-below button on Notebook Panel\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\nContains changes to resolve [#issue16996](https://github.com/jupyterlab/jupyterlab/issues/16996)\r\n\r\n## Code changes\r\n\r\n* Addresses the issue of greyed Run-All-Below button on the Panel when a new notebook is opened\r\n* Changes the logic for Run-All-Below button on Notebook Panel\r\n* Runs the selected cell and all the cells below it\r\n* Removes logic for - \r\n        1. Check for Single Selected cell \r\n             Reason - Command states that it is for 'Run Selected Cell and All Below'. Option should be there to run this for multiple cells(Single cell check restricts user actions)\r\n        2. Check for Last Cell in the Notebook\r\n             Reason - This is a redundant check. If this is not there, the command runs only for last cell, which is acceptable\r\n         \r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\nRun-All-Below button will be enabled whenever the notebook is open and the cell is selected.\r\n \r\nBefore Change\r\n\r\n![image](https://github.com/user-attachments/assets/04a69ba3-ee2e-46c5-9338-c8688cff22b3)\r\n\r\n\r\nAfter Change\r\n\r\n![image](https://github.com/user-attachments/assets/76eea2f5-01b0-441d-a67a-ff6d03c61f01)\r\n\r\n## Testing\r\n\r\nLocal Testing Successful\r\n\r\nSteps Performed:\r\n1. jlpm run build - Successful\r\n2. jlpm run build:core - Successful\r\n3. jupyter lab build - Successful\r\n4. jupyter lab --dev-mode - Changes getting reflected and the button is enabled to run cells\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\nN/A",
    "issue_word_count": 281,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-run-jupyterlab-linux.png",
      "packages/notebook-extension/src/index.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-run-jupyterlab-linux.png"
    ],
    "base_commit": "40d114354ce6e3099c3963d9bf5d98044ee2cc66",
    "head_commit": "8887acd3359686b395397cc690b91fa39495654c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17357",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17357",
    "dockerfile": "",
    "pr_merged_at": "2025-03-11T14:56:20.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17352",
    "pr_id": 17352,
    "issue_id": 14682,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Option to disable context menu per user, without admin permissions\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\n\n<!--\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\n\n\nBefore creating a new feature request please search the issues for relevant feature requests.\n-->\n\n### Problem\n\nAs discussed in #13553 the context menu lacks copy and paste of selected text. For some users, access to copy and paste is more important and used more often than any feature in the custom context menu. \n\n\n### Proposed Solution\n\nAn option to completely turn off the context menu, returning right click to the browser's context menu only and bringing back copy and paste of selected text via right clicking. \n\n### Additional context\n\n<!-- Add any other context or screenshots about the feature request here. You can also include links to examples of other programs that have something similar to your request. For example:\n\n* Another project [...] solved this by [...]\n-->",
    "issue_word_count": 184,
    "test_files_count": 15,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-stop-on-breakpoint-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-right-common-documentation-linux.png",
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-in-use-warning-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-console-run-keystroke-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-terminal-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-text-editor-indentation-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-text-editor-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png",
      "packages/application-extension/schema/context-menu.json",
      "packages/application-extension/src/index.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-stop-on-breakpoint-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-right-common-documentation-linux.png",
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-in-use-warning-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-console-run-keystroke-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-terminal-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-text-editor-indentation-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-text-editor-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png"
    ],
    "base_commit": "519ca4b971870e86201c447d0aaa2322a57c4fef",
    "head_commit": "04a86212a061e913e302f40a991762ec9ecc884b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17352",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17352",
    "dockerfile": "",
    "pr_merged_at": "2025-03-04T22:09:06.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17350",
    "pr_id": 17350,
    "issue_id": 16664,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Restart Kernel and Run All Cells is applied on different notebooks if tabs switch in between\n## Description\r\n\r\nIf you have multiple notebooks open and click `Restart Kernel and Run All Cells` for one notebook and switch to another notebook then the kernel restart and run all cells are applied to different notebooks. This must be caused by kernel restart being async and run all cells executing as separated event and recalculating the active tab / notebook. This issue is probably not limited to restart and rerun all, but more combined events that act on active tab.\r\n\r\n## Reproduce\r\n\r\nIt is more easily reproduced if network is slow or kernel restart takes longer.\r\n\r\n![jlab restart rerun issue](https://github.com/user-attachments/assets/0d5c1e0f-47f4-486c-bbd0-f1c5c6e9f635)\r\n\r\n## Expected behavior\r\n\r\nAction should be applied to the original notebook / tab\r\n\r\n## Context\r\n\r\nTested with JupyterLab version: 4.2.4\r\n\r\n\r\n",
    "issue_word_count": 128,
    "test_files_count": 2,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "galata/test/jupyterlab/completer.test.ts-snapshots/completer-with-doc-panel-jupyterlab-linux.png",
      "galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png",
      "packages/application/src/utils.ts",
      "packages/apputils/src/semanticCommand.ts",
      "packages/console-extension/src/index.ts",
      "packages/notebook-extension/src/index.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/completer.test.ts-snapshots/completer-with-doc-panel-jupyterlab-linux.png",
      "galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png"
    ],
    "base_commit": "1c64e5e00c3842eb7694190ed80a31685dcdeffa",
    "head_commit": "f2b14df835505644eea0a6461e0d83b9e0b10c8d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17350",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17350",
    "dockerfile": "",
    "pr_merged_at": "2025-03-01T22:28:46.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17345",
    "pr_id": 17345,
    "issue_id": 17344,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Expose `ConfigSection` via a plugin?\n### Problem\n\nCurrently `@jupyterlite/servives` exposes a `ConfigSection` namespace to interact with the Jupyter Server `/api/config` endpoint: https://jupyter-server.readthedocs.io/en/latest/developers/rest-api.html#get--api-config-section_name\n\nhttps://github.com/jupyterlab/jupyterlab/blob/e55daf1f1f6e89ed6b0d72e316d0e4a92805c146/packages/services/src/config/index.ts#L40-L72\n\nWhich can be used in other plugins, for example here:\n\nhttps://github.com/jupyterlab/jupyterlab/blob/e55daf1f1f6e89ed6b0d72e316d0e4a92805c146/packages/apputils-extension/src/announcements.ts#L72-L74\n\nThis functionality is however not exposed the same way as other Jupyter Server and JupyterLab services, such as kernels, sessions, settings, terminals and so on. Which means it's currently not easy to swap the implementation for another one via a plugin, like it is the case now with the `ServiceManagerPlugin` plugins defined here: https://github.com/jupyterlab/jupyterlab/blob/main/packages/services-extension/src/index.ts\n\nNot sure about the historical reasons for having it exposed this way. But having this config section functionality provided via a plugin sounds like it would be consistent with the other service manager services.\n\n### Proposed Solution\n\nOne way could be to expose a new `IConfigSection` token via a `JupyterFrontEndPlugin` providing the same functionality as the current `ConfigSection` namespace by default. In extensions, the plugin providing `IConfigSection` could then be swapped for another implementation.\n\nAnother approach would be to add it to the `ServiceManager` interface (and as a `ServiceManagerPlugin`), so it becomes available via `app.serviceManager.config` alongside other Jupyter Server services, and would still be swappable:\n\nhttps://github.com/jupyterlab/jupyterlab/blob/e55daf1f1f6e89ed6b0d72e316d0e4a92805c146/packages/services/src/manager.ts#L235-L306\n\nIn both cases we can keep backwards compatibility to make sure `ConfigSection.create` is still available, but start encouraging extensions to consume the token (and document it).\n\n\n### Additional context\n\nThis would make it easier for downstream applications and extensions to provide a different backend for storing config sections.\n\nFor example in the case of JupyterLite, the config could be stored in the browser (after https://github.com/jupyterlite/jupyterlite/pull/1590).\n\n`ConfigSection.create` is also used in `jupyterlab-tour` here: https://github.com/jupyterlab-contrib/jupyterlab-tour/blob/76f9dbf474cba2748809b13c2654c04909246319/src/plugin.tsx#L63-L68",
    "issue_word_count": 353,
    "test_files_count": 3,
    "non_test_files_count": 6,
    "pr_changed_files": [
      "docs/source/extension/extension_migration.rst",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/apputils-extension/src/announcements.ts",
      "packages/services-extension/src/index.ts",
      "packages/services/examples/browser/src/config.ts",
      "packages/services/src/config/index.ts",
      "packages/services/src/tokens.ts",
      "packages/services/test/config/config.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/services/test/config/config.spec.ts"
    ],
    "base_commit": "d470c501f50ad7075413cd89967a1a8a332b9a2f",
    "head_commit": "9ec81536e75b101420aa7191f388a1510ede81fc",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17345",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17345",
    "dockerfile": "",
    "pr_merged_at": "2025-03-12T08:50:10.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17337",
    "pr_id": 17337,
    "issue_id": 16277,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`Language pack 'en_US' not installed` in the dev tools console\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nJupyterLab often shows the following warning in the dev tools console: \r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/591645/fe57318c-67b8-4c36-a004-4f7c36c0873d)\r\n\r\n## Reproduce\r\n\r\nUsing `4.2.0rc0` on Binder.\r\n\r\nBut this is also reproducible from the latest commit on `main`.\r\n\r\n## Expected behavior\r\n\r\nThere should likely be no warning in the dev tools.\r\n\r\n## Context\r\n\r\n- Operating System and version: Ubuntu 23.10\r\n- Browser and version: Latest Firefox and Chrome\r\n- JupyterLab version: 4.2.0rc0\r\n",
    "issue_word_count": 112,
    "test_files_count": 7,
    "non_test_files_count": 9,
    "pr_changed_files": [
      ".eslintrc.js",
      ".github/workflows/galata.yml",
      "examples/console/src/index.ts",
      "examples/filebrowser/src/index.ts",
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/apputils/test/toolbar.spec.ts",
      "packages/translation-extension/src/index.ts",
      "packages/translation/src/base.ts",
      "packages/translation/src/gettext.ts",
      "packages/translation/src/manager.ts",
      "packages/translation/src/tokens.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/apputils/test/toolbar.spec.ts"
    ],
    "base_commit": "ac9d46e7cde8e41560a082973c51d632281e86c5",
    "head_commit": "bef44dbde0f290833d25838770d75400f09f9f85",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17337",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17337",
    "dockerfile": "",
    "pr_merged_at": "2025-03-04T16:10:29.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17330",
    "pr_id": 17330,
    "issue_id": 17194,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix for issue preventing cell metadata removal\nFixes https://github.com/jupyterlab/jupyterlab/issues/17164\r\n\r\nThe root cause was that `setMetadata` method of the `ISharedBaseCell` only overrides the partial metadata (existing keys), rather than replacing the entire metadata.\r\n\r\nI have just provided a workaround to ensure the complete removal and replacement of all metadata. However, a more prominent solution would be overriding the `setMetadata` method to ensure it completely replaces the metadata.\r\n",
    "issue_word_count": 65,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/metadataform.test.ts",
      "packages/notebook-extension/src/tool-widgets/metadataEditorFields.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/metadataform.test.ts"
    ],
    "base_commit": "cc7c3df292e67f1d0e08561161a76f780104c672",
    "head_commit": "6a35503523445d7243b332349ceb6c0c7c2040de",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17330",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17330",
    "dockerfile": "",
    "pr_merged_at": "2025-02-22T20:05:27.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17327",
    "pr_id": 17327,
    "issue_id": 16794,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Allow customizing the `ServiceManager` with plugins\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\nFixes #15329 \r\nFixes #12504\r\nReplaces https://github.com/jupyterlab/jupyterlab/pull/16556\r\nReplaces https://github.com/jupyterlab/jupyterlab/pull/16783\r\nCloses https://github.com/jupyterlab/jupyterlab/pull/16141\r\nDepends on https://github.com/jupyterlab/jupyterlab/pull/16804\r\n\r\nMore references:\r\n- Based on https://github.com/jupyterlab/lumino/pull/703\r\n- Inspired by https://github.com/jupyterlab/jupyterlab/pull/13558\r\n- Alternative to #16744 \r\n- Follows a similar approach as in JupyterLite, which registers \"server\" plugins separately on a different Lumino application (the plugin registry was not usable outside an application before https://github.com/jupyterlab/lumino/pull/703): https://github.com/jupyterlite/jupyterlite/blob/eb0bcb543703213ea883dc1da948ce07494a3148/packages/server-extension/src/index.ts \r\n\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Motivation\r\n\r\nSee https://github.com/jupyterlab/jupyterlab/issues/15329#issue-1967825301\r\n\r\n## Code changes\r\n\r\n- [x] Update to the latest `@lumino` packages\r\n- [x] Resolve the service manager service first, then start the lab application\r\n- [x] Try with `IDefaultDrive` and `IContentsManager`\r\n- [x] Move all the underlying `ServiceManager` services to their own plugins\r\n- [x] Create a more explicit `ServiceManagerPlugin` plugin type\r\n- [x] ~Use a separate `PluginRegistry` for service manager plugins? Or the same one as regular plugins?~\r\n  - ~A different one clearly separates the two phases of plugin activation~\r\n  - [x] The same one would allow regular plugins to consume service manager plugins, for example requiring `IKernelManager` instead of `app.serviceManager.kernels`. \r\n- [x] Handle `IConnectionStatus`\r\n- [x] Add a section in the extension dev documentation about \"Service Manager Plugins\"\r\n- [x] ~Add to the user / developer changelog for visibility?~ Postponing for now\r\n- [x] Create a new `@jupyterlab/services-extension` package to host the service manager plugins\r\n- [x] Mock package test (usage)\r\n\r\nThis can be tested using this example extension, which disables `@jupyterlab/application-extension:default-drive` and replaces with its own implementation: https://github.com/jtpio/jupyterlab-custom-service-manager-plugins\r\n\r\n**Example providing a custom default drive**\r\n\r\n![image](https://github.com/user-attachments/assets/19511fce-9e77-428b-9e66-15b095941689)\r\n\r\n**Example providing a custom `ContentsManager` that logs each `get` call**\r\n\r\n```ts\r\nimport {\r\n  Contents,\r\n  ContentsManager,\r\n  IContentsManager,\r\n  ServiceManagerPlugin\r\n} from '@jupyterlab/services';\r\n\r\nclass CustomContents extends ContentsManager {\r\n  async get(\r\n    path: string,\r\n    options?: Contents.IFetchOptions\r\n  ): Promise<Contents.IModel> {\r\n    console.log('CustomContents.get', path);\r\n    return super.get(path, options);\r\n  }\r\n}\r\n\r\nconst contentsPlugin: ServiceManagerPlugin<Contents.IManager> = {\r\n  id: 'myextension:contents-drive',\r\n  description: 'A JupyterLab extension providing a custom contents manager',\r\n  autoStart: true,\r\n  provides: IContentsManager,\r\n  activate: (_: null): Contents.IManager => {\r\n    console.log('Using a CUSTOM contents manager plugin');\r\n    return new CustomContents();\r\n  }\r\n};\r\n\r\nexport default [\r\n  contentsPlugin,\r\n];\r\n```\r\n\r\n![image](https://github.com/user-attachments/assets/9222e69c-cd1a-4f2b-b92e-ad058285202d)\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\n\r\n## User-facing changes\r\n\r\nNone\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\n",
    "issue_word_count": 524,
    "test_files_count": 1,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/apputils-extension/src/index.ts",
      "packages/apputils-extension/src/settingconnector.ts",
      "packages/apputils-extension/src/settingsplugin.ts",
      "packages/settingregistry/src/tokens.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json"
    ],
    "base_commit": "2ea5151b2137a55ccd9995acef3b87305f43f8fb",
    "head_commit": "4fb2570f789c81d1bc227c7ca556bef60b01f53e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17327",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17327",
    "dockerfile": "",
    "pr_merged_at": "2025-03-04T08:30:34.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17314",
    "pr_id": 17314,
    "issue_id": 17295,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Bump vega from 5.24.0 to 5.26.0\nBumps [vega](https://github.com/vega/vega) from 5.24.0 to 5.26.0.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/vega/vega/releases\">vega's releases</a>.</em></p>\n<blockquote>\n<h2>v5.26.0</h2>\n<p>Changes from <a href=\"https://github.com/vega/vega/releases/tag/v5.25.0\">v5.25.0</a>:</p>\n<p><strong>vega-functions</strong></p>\n<ul>\n<li>Add geoScale expression function. (thanks <a href=\"https://github.com/binste\"><code>@â€‹binste</code></a>)</li>\n</ul>\n<p><strong>vega-scale</strong></p>\n<ul>\n<li>Fix tickMinStep calculation. (thanks <a href=\"https://github.com/kanitw\"><code>@â€‹kanitw</code></a>)</li>\n</ul>\n<p><strong>vega-scenegraph</strong></p>\n<ul>\n<li>Add experimental hybrid canvas/SVG renderer (thanks <a href=\"https://github.com/jonmmease\"><code>@â€‹jonmmease</code></a>)</li>\n<li>Fall back to textMetrics.width for user defined width function (thanks <a href=\"https://github.com/jonmmease\"><code>@â€‹jonmmease</code></a>)</li>\n</ul>\n<p><strong>vega-selections</strong></p>\n<ul>\n<li>Fix null handling in vlSelectionTest (thanks <a href=\"https://github.com/arvind\"><code>@â€‹arvind</code></a>, <a href=\"https://github.com/jonmmease\"><code>@â€‹jonmmease</code></a>)</li>\n</ul>\n<p><strong>vega-transforms</strong></p>\n<ul>\n<li>Add aggregate parameters to vega-transform, and exponential moving average. (thanks <a href=\"https://github.com/Xitian9\"><code>@â€‹Xitian9</code></a>)</li>\n</ul>\n<p><strong>vega-typings</strong></p>\n<ul>\n<li>Bump typings to a 1.0 release. (thanks <a href=\"https://github.com/domoritz\"><code>@â€‹domoritz</code></a>)</li>\n</ul>\n<p><strong>vega-voronoi</strong></p>\n<ul>\n<li>Fix reference for voronoi path point. (thanks <a href=\"https://github.com/suchanlee\"><code>@â€‹suchanlee</code></a>)</li>\n</ul>\n<h2>v5.25.0</h2>\n<p>Changes from <a href=\"https://github.com/vega/vega/releases/tag/v5.24.0\">v5.24.0</a>:</p>\n<p><strong>monorepo</strong></p>\n<ul>\n<li>Fix browser lists for IE support. (thanks <a href=\"https://github.com/domoritz\"><code>@â€‹domoritz</code></a>!)</li>\n<li>Update dependencies.</li>\n</ul>\n<p><strong>vega-cli</strong></p>\n<ul>\n<li>Add <code>ppi</code> resolution parameter for PNG output. (thanks <a href=\"https://github.com/davidanthoff\"><code>@â€‹davidanthoff</code></a>!)</li>\n<li>Return error code on failure. (thanks <a href=\"https://github.com/davidanthoff\"><code>@â€‹davidanthoff</code></a>!)</li>\n</ul>\n<p><strong>vega-expression</strong></p>\n<ul>\n<li>Add <code>hypot</code> function. (thanks <a href=\"https://github.com/domoritz\"><code>@â€‹domoritz</code></a>!)</li>\n</ul>\n<p><strong>vega-functions</strong></p>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/vega/vega/commit/3580b28ec9b89d0a042707c168080931e7745fb3\"><code>3580b28</code></a> chore: v5.26.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3823\">#3823</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/073c4ec770f74fab014a5d42620d2a9f1a2f905e\"><code>073c4ec</code></a> chore(deps-dev): bump rollup from 3.21.0 to 4.3.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3822\">#3822</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/51f9b7f232dd19089b49807a4f133d5f52f0d716\"><code>51f9b7f</code></a> chore(deps-dev): bump <code>@â€‹babel/core</code> from 7.21.4 to 7.23.2 (<a href=\"https://redirect.github.com/vega/vega/issues/3814\">#3814</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/6c846f059be157a3f5ddf2b6a2359ceae2d73adc\"><code>6c846f0</code></a> chore(deps-dev): bump <code>@â€‹types/node</code> from 18.16.1 to 20.8.10 (<a href=\"https://redirect.github.com/vega/vega/issues/3820\">#3820</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/0b95f15723ba92b5138ff18ec7c48fb1070e836b\"><code>0b95f15</code></a> chore(deps-dev): bump <code>@â€‹babel/cli</code> from 7.21.0 to 7.23.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3804\">#3804</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/ad9ed63728376e664ed406cc2c813945d34c6eaf\"><code>ad9ed63</code></a> chore(deps): bump semver from 5.7.1 to 5.7.2 (<a href=\"https://redirect.github.com/vega/vega/issues/3778\">#3778</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/09b83ee7c8dd582fbc167adbf61875986048393c\"><code>09b83ee</code></a> chore(deps): bump d3-array from 3.2.2 to 3.2.4 (<a href=\"https://redirect.github.com/vega/vega/issues/3765\">#3765</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/54a1ba31c356db15eba14b52f11388b6ef5bfe52\"><code>54a1ba3</code></a> chore(deps): bump yargs from 17.7.1 to 17.7.2 (<a href=\"https://redirect.github.com/vega/vega/issues/3744\">#3744</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/27a240be27d2b9e8c5c5700d138103c0a57e0bf9\"><code>27a240b</code></a> Bump vega typings to 1.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3791\">#3791</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/858f0a0082731312fac02345f741017327cc8511\"><code>858f0a0</code></a> feat: Add experimental hybrid renderer (<a href=\"https://redirect.github.com/vega/vega/issues/3810\">#3810</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/vega/vega/compare/v5.24.0...v5.26.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=vega&package-manager=npm_and_yarn&previous-version=5.24.0&new-version=5.26.0)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\nYou can disable automated security fix PRs for this repo from the [Security Alerts page](https://github.com/jupyterlab/jupyterlab/network/alerts).\n\n</details>",
    "issue_word_count": 1153,
    "test_files_count": 5,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-stop-on-raised-exception-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-stop-on-raised-exception-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json"
    ],
    "base_commit": "61fff142b2438fe770c2740e575a0a893bf2ded4",
    "head_commit": "93431e69648464e3d9c70a47fe6db94aab255bc5",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17314",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17314",
    "dockerfile": "",
    "pr_merged_at": "2025-02-22T12:05:05.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17313",
    "pr_id": 17313,
    "issue_id": 17295,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Bump vega from 5.24.0 to 5.26.0\nBumps [vega](https://github.com/vega/vega) from 5.24.0 to 5.26.0.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/vega/vega/releases\">vega's releases</a>.</em></p>\n<blockquote>\n<h2>v5.26.0</h2>\n<p>Changes from <a href=\"https://github.com/vega/vega/releases/tag/v5.25.0\">v5.25.0</a>:</p>\n<p><strong>vega-functions</strong></p>\n<ul>\n<li>Add geoScale expression function. (thanks <a href=\"https://github.com/binste\"><code>@â€‹binste</code></a>)</li>\n</ul>\n<p><strong>vega-scale</strong></p>\n<ul>\n<li>Fix tickMinStep calculation. (thanks <a href=\"https://github.com/kanitw\"><code>@â€‹kanitw</code></a>)</li>\n</ul>\n<p><strong>vega-scenegraph</strong></p>\n<ul>\n<li>Add experimental hybrid canvas/SVG renderer (thanks <a href=\"https://github.com/jonmmease\"><code>@â€‹jonmmease</code></a>)</li>\n<li>Fall back to textMetrics.width for user defined width function (thanks <a href=\"https://github.com/jonmmease\"><code>@â€‹jonmmease</code></a>)</li>\n</ul>\n<p><strong>vega-selections</strong></p>\n<ul>\n<li>Fix null handling in vlSelectionTest (thanks <a href=\"https://github.com/arvind\"><code>@â€‹arvind</code></a>, <a href=\"https://github.com/jonmmease\"><code>@â€‹jonmmease</code></a>)</li>\n</ul>\n<p><strong>vega-transforms</strong></p>\n<ul>\n<li>Add aggregate parameters to vega-transform, and exponential moving average. (thanks <a href=\"https://github.com/Xitian9\"><code>@â€‹Xitian9</code></a>)</li>\n</ul>\n<p><strong>vega-typings</strong></p>\n<ul>\n<li>Bump typings to a 1.0 release. (thanks <a href=\"https://github.com/domoritz\"><code>@â€‹domoritz</code></a>)</li>\n</ul>\n<p><strong>vega-voronoi</strong></p>\n<ul>\n<li>Fix reference for voronoi path point. (thanks <a href=\"https://github.com/suchanlee\"><code>@â€‹suchanlee</code></a>)</li>\n</ul>\n<h2>v5.25.0</h2>\n<p>Changes from <a href=\"https://github.com/vega/vega/releases/tag/v5.24.0\">v5.24.0</a>:</p>\n<p><strong>monorepo</strong></p>\n<ul>\n<li>Fix browser lists for IE support. (thanks <a href=\"https://github.com/domoritz\"><code>@â€‹domoritz</code></a>!)</li>\n<li>Update dependencies.</li>\n</ul>\n<p><strong>vega-cli</strong></p>\n<ul>\n<li>Add <code>ppi</code> resolution parameter for PNG output. (thanks <a href=\"https://github.com/davidanthoff\"><code>@â€‹davidanthoff</code></a>!)</li>\n<li>Return error code on failure. (thanks <a href=\"https://github.com/davidanthoff\"><code>@â€‹davidanthoff</code></a>!)</li>\n</ul>\n<p><strong>vega-expression</strong></p>\n<ul>\n<li>Add <code>hypot</code> function. (thanks <a href=\"https://github.com/domoritz\"><code>@â€‹domoritz</code></a>!)</li>\n</ul>\n<p><strong>vega-functions</strong></p>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/vega/vega/commit/3580b28ec9b89d0a042707c168080931e7745fb3\"><code>3580b28</code></a> chore: v5.26.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3823\">#3823</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/073c4ec770f74fab014a5d42620d2a9f1a2f905e\"><code>073c4ec</code></a> chore(deps-dev): bump rollup from 3.21.0 to 4.3.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3822\">#3822</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/51f9b7f232dd19089b49807a4f133d5f52f0d716\"><code>51f9b7f</code></a> chore(deps-dev): bump <code>@â€‹babel/core</code> from 7.21.4 to 7.23.2 (<a href=\"https://redirect.github.com/vega/vega/issues/3814\">#3814</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/6c846f059be157a3f5ddf2b6a2359ceae2d73adc\"><code>6c846f0</code></a> chore(deps-dev): bump <code>@â€‹types/node</code> from 18.16.1 to 20.8.10 (<a href=\"https://redirect.github.com/vega/vega/issues/3820\">#3820</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/0b95f15723ba92b5138ff18ec7c48fb1070e836b\"><code>0b95f15</code></a> chore(deps-dev): bump <code>@â€‹babel/cli</code> from 7.21.0 to 7.23.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3804\">#3804</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/ad9ed63728376e664ed406cc2c813945d34c6eaf\"><code>ad9ed63</code></a> chore(deps): bump semver from 5.7.1 to 5.7.2 (<a href=\"https://redirect.github.com/vega/vega/issues/3778\">#3778</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/09b83ee7c8dd582fbc167adbf61875986048393c\"><code>09b83ee</code></a> chore(deps): bump d3-array from 3.2.2 to 3.2.4 (<a href=\"https://redirect.github.com/vega/vega/issues/3765\">#3765</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/54a1ba31c356db15eba14b52f11388b6ef5bfe52\"><code>54a1ba3</code></a> chore(deps): bump yargs from 17.7.1 to 17.7.2 (<a href=\"https://redirect.github.com/vega/vega/issues/3744\">#3744</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/27a240be27d2b9e8c5c5700d138103c0a57e0bf9\"><code>27a240b</code></a> Bump vega typings to 1.0 (<a href=\"https://redirect.github.com/vega/vega/issues/3791\">#3791</a>)</li>\n<li><a href=\"https://github.com/vega/vega/commit/858f0a0082731312fac02345f741017327cc8511\"><code>858f0a0</code></a> feat: Add experimental hybrid renderer (<a href=\"https://redirect.github.com/vega/vega/issues/3810\">#3810</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/vega/vega/compare/v5.24.0...v5.26.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=vega&package-manager=npm_and_yarn&previous-version=5.24.0&new-version=5.26.0)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\nYou can disable automated security fix PRs for this repo from the [Security Alerts page](https://github.com/jupyterlab/jupyterlab/network/alerts).\n\n</details>",
    "issue_word_count": 1153,
    "test_files_count": 6,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json"
    ],
    "base_commit": "3d58dc9d472353c4f72824762f659c9182cc8c71",
    "head_commit": "ac44ee90d5157753985dd48965f724e5fd2741b3",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17313",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17313",
    "dockerfile": "",
    "pr_merged_at": "2025-02-27T12:59:35.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17298",
    "pr_id": 17298,
    "issue_id": 16996,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Add run-all-below button to Notebook Panel, becomes gray when starting a new notebook\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\nAdd the following settings to Notebook Panel as below:\r\nSettings Editor -> Notebook Panel -> Json Settings Editor\r\n```json\r\n{\r\n    \"toolbar\": [\r\n        {\r\n            \"name\": \"restart-and-run\",\r\n            \"disabled\": true\r\n        },\r\n        {\r\n            \"name\": \"run-all-below\",\r\n            \"args\": {},\r\n            \"command\": \"notebook:run-all-below\",\r\n            \"icon\": \"ui-components:fast-forward\",\r\n            \"disabled\": false,\r\n            \"rank\": 36\r\n        }\r\n    ]\r\n}\r\n```\r\n\r\n## Reproduce and Expected behavior\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n![image](https://github.com/user-attachments/assets/6d5ab54f-166a-4917-8ffb-c3974871f56e)\r\nRefresh the whole page with F5 before testing the following 3 scenarios:\r\n1. open a new notebook from File Browser, most of the time, the newly added `notebook:run-all-below` icon is gray and not valid to click\r\n2. if u switch to another notebook and switch back, the icon will become valid and clickable\r\n3. if u use web browser's F12 dev mode, most of the time, even if u open new notebook from File Browser, the icon is valid and clickable\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Windows 11 Pro, 23H2, 22631.4460<!-- e.g. Linux Ubuntu 21.04 -->\r\n- Browser and version: Brave [Version 1.73.91 Chromium: 131.0.6778.85 (Official Build) (64-bit)]<!-- e.g. Chrome 92 -->\r\n- JupyterLab version: <!-- e.g. 3.1.7 -->\r\njupyter_client             8.6.3\r\njupyter_core               5.7.2\r\njupyter-events             0.10.0\r\njupyter-lsp                2.2.5\r\njupyter_server             2.14.2\r\njupyter_server_terminals   0.5.3\r\njupyterlab                 4.3.1\r\njupyterlab_celltagsclasses 0.5.2\r\njupyterlab_gridwidth       0.4.3\r\njupyterlab_nasadaily       1.0.0\r\njupyterlab_notechat        1.1.2\r\njupyterlab_pygments        0.3.0\r\njupyterlab_server          2.27.3\r\n",
    "issue_word_count": 330,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-run-jupyterlab-linux.png",
      "packages/notebook-extension/src/index.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-run-jupyterlab-linux.png"
    ],
    "base_commit": "1fb48d636f90928c3b4d883d80030f9bc6da6f73",
    "head_commit": "cb67735f6ddc641d22df2f2a78532fb380578ec6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17298",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17298",
    "dockerfile": "",
    "pr_merged_at": "2025-03-03T13:32:18.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17297",
    "pr_id": 17297,
    "issue_id": 17160,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Ensure search highlight is applied to Python builtin keywords\n## References\r\n\r\nFixes #17068 \r\n\r\n## Code changes\r\n\r\nupdated the [jupyterlab/packages/codemirror/style/base.css](https://github.com/jupyterlab/jupyterlab/blob/2607c1093539850b5b618352dc94893a8b662e48/packages/codemirror/style/base.css#L70-L97) file : now the syntax is highlighted correctly\r\n\r\n## User-facing changes\r\n\r\n**Before** - \r\n![Screenshot 2025-01-12 111825](https://github.com/user-attachments/assets/00deef38-99f4-4256-a790-3082cf354405)\r\n\r\n**After** -\r\n![Screenshot 2025-01-12 110137](https://github.com/user-attachments/assets/d621366d-32ed-4d62-8810-02114f461e26)\r\n\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 75,
    "test_files_count": 7,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/file-search.test.ts",
      "galata/test/jupyterlab/file-search.test.ts-snapshots/search-results-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-in-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/highlight-visible-under-selection-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-two-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png",
      "packages/codemirror/src/theme.ts",
      "packages/codemirror/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/file-search.test.ts",
      "galata/test/jupyterlab/file-search.test.ts-snapshots/search-results-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-in-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/highlight-visible-under-selection-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-two-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png"
    ],
    "base_commit": "1476f30a7e1eb99632b96e0f5e54aa544743b857",
    "head_commit": "8569b9d0c09eeea9a60118f1ade7b6e1263be1a5",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17297",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17297",
    "dockerfile": "",
    "pr_merged_at": "2025-02-18T17:41:05.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17294",
    "pr_id": 17294,
    "issue_id": 17293,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Remove remaining `jupyter-packaging` references\n> When searching the code base of `jupyter-packaging`, there seems to be a few remaining references:\r\n> \r\n> https://github.com/jupyterlab/jupyterlab/blob/b93e83488cb610d0803ade14f2cf091369100a90/jupyterlab/tests/test_extensions.py#L243\r\n> \r\n> https://github.com/jupyterlab/jupyterlab/blob/b93e83488cb610d0803ade14f2cf091369100a90/jupyterlab/tests/test_extensions.py#L251\r\n> \r\n> https://github.com/jupyterlab/jupyterlab/blob/b93e83488cb610d0803ade14f2cf091369100a90/scripts/release_prep.sh#L17\r\n> \r\n> \r\n> _Originally posted by @jtpio in https://github.com/jupyterlab/jupyterlab/pull/17219#pullrequestreview-2617729909_\r\n            \r\nFollow-up to #17219",
    "issue_word_count": 69,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "jupyterlab/tests/test_extensions.py",
      "scripts/release_prep.sh"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/test_extensions.py"
    ],
    "base_commit": "30bd47bd991b9f3887643470f8255dcf5f36372c",
    "head_commit": "30c96c76037e2661a1216ba446abc78feeac14ba",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17294",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17294",
    "dockerfile": "",
    "pr_merged_at": "2025-02-14T15:04:56.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17274",
    "pr_id": 17274,
    "issue_id": 17213,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Dropdown for console prompt placement options should be aligned with the button\n### Problem\n\nThis menu being added in https://github.com/jupyterlab/jupyterlab/pull/13837 can be all over the place:\n\n![Image](https://github.com/user-attachments/assets/70359759-b665-490b-8ea5-fa38bb281f69)\n\n![Image](https://github.com/user-attachments/assets/c5c1c453-bcc4-4709-9de0-ede6206c655b)\n\n\n### Proposed Solution\n\nFor user to be able to anticipate where they need to move their mouse pointer too ideally it would be neatly aligned with the three dots icon. This will be possible with https://github.com/jupyterlab/lumino/pull/732 (we will need to update packages to pull it in)\n\n### Additional context\n\nAlignment is commonly the case see e.g. GNOME:\n\n![Image](https://github.com/user-attachments/assets/a5d1e3eb-5300-4b02-ae5c-17a0ac00cf26)\n\nGitHub:\n\n![Image](https://github.com/user-attachments/assets/6a109420-1d8c-4f40-ac48-11c68133da17)",
    "issue_word_count": 130,
    "test_files_count": 1,
    "non_test_files_count": 29,
    "pr_changed_files": [
      "builder/package.json",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/federated/md_package/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "jupyterlab/tests/mock_packages/mimeextension/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console-extension/src/index.ts",
      "packages/console/package.json",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer/package.json",
      "packages/debugger/package.json",
      "packages/docmanager-extension/package.json",
      "packages/docmanager/package.json",
      "packages/docregistry/package.json",
      "packages/documentsearch-extension/package.json",
      "packages/documentsearch/package.json",
      "packages/extensionmanager/package.json",
      "packages/filebrowser-extension/package.json"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/mock_packages/mimeextension/package.json"
    ],
    "base_commit": "02e2ee497dab764c05e42cb8e13c50ca3023b542",
    "head_commit": "66898db5304fef38f64aa2cc09df5e3ce88bf9e6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17274",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17274",
    "dockerfile": "",
    "pr_merged_at": "2025-02-09T13:09:27.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17271",
    "pr_id": 17271,
    "issue_id": 16174,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Update to TypeScript 5.8\nThe last update was for TypeScript 5.1, done in https://github.com/jupyterlab/jupyterlab/pull/14638.\r\n\r\nIt would be great to look into updating to the latest version to not lag behind for too long.\r\n\r\nIn https://github.com/jupyterlab/jupyterlab/pull/14638#issuecomment-1803584472 @fcollonval said:\r\n\r\n> but bumping to 5.2 or later will have some effects as we will need to change the ts configuration.\r\n\r\nLooks like this refers to the \"module and moduleResolution Must Match Under Recent Node.js settings\" section mentioned in https://devblogs.microsoft.com/typescript/announcing-typescript-5-2/#breaking-changes-and-correctness-fixes ?",
    "issue_word_count": 106,
    "test_files_count": 3,
    "non_test_files_count": 97,
    "pr_changed_files": [
      "builder/package.json",
      "buildutils/package.json",
      "buildutils/template/package.json",
      "docs/source/extension/extension_migration.rst",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "galata/extension/package.json",
      "galata/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/attachments/package.json",
      "packages/cell-toolbar-extension/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/celltags-extension/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console/package.json",
      "packages/coreutils/package.json",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer/package.json",
      "packages/debugger-extension/package.json",
      "packages/debugger/package.json",
      "packages/docmanager-extension/package.json",
      "packages/docmanager/package.json",
      "packages/docregistry/package.json",
      "packages/docregistry/src/testutils.ts",
      "packages/documentsearch-extension/package.json",
      "packages/documentsearch/package.json",
      "packages/extensionmanager-extension/package.json",
      "packages/extensionmanager/package.json",
      "packages/filebrowser-extension/package.json",
      "packages/filebrowser/package.json",
      "packages/fileeditor-extension/package.json",
      "packages/fileeditor/package.json",
      "packages/help-extension/package.json",
      "packages/htmlviewer-extension/package.json",
      "packages/htmlviewer/package.json",
      "packages/hub-extension/package.json",
      "packages/imageviewer-extension/package.json",
      "packages/imageviewer/package.json",
      "packages/inspector-extension/package.json",
      "packages/inspector/package.json",
      "packages/javascript-extension/package.json",
      "packages/json-extension/package.json",
      "packages/launcher-extension/package.json",
      "packages/launcher/package.json",
      "packages/logconsole-extension/package.json",
      "packages/logconsole/package.json",
      "packages/lsp-extension/package.json",
      "packages/lsp/package.json",
      "packages/mainmenu-extension/package.json",
      "packages/mainmenu/package.json",
      "packages/markdownviewer-extension/package.json",
      "packages/markdownviewer/package.json",
      "packages/markedparser-extension/package.json",
      "packages/mathjax-extension/package.json",
      "packages/mermaid-extension/package.json",
      "packages/mermaid/package.json",
      "packages/metadataform-extension/package.json",
      "packages/metadataform/package.json",
      "packages/metapackage/package.json",
      "packages/nbformat/package.json",
      "packages/notebook-extension/package.json",
      "packages/notebook/package.json",
      "packages/observables/package.json",
      "packages/outputarea/package.json",
      "packages/pdf-extension/package.json",
      "packages/pluginmanager-extension/package.json",
      "packages/pluginmanager/package.json",
      "packages/property-inspector/package.json",
      "packages/rendermime-extension/package.json",
      "packages/rendermime-interfaces/package.json",
      "packages/rendermime/package.json",
      "packages/running-extension/package.json",
      "packages/running/package.json",
      "packages/services/examples/browser/package.json",
      "packages/services/examples/typescript-browser-with-output/package.json",
      "packages/services/package.json",
      "packages/services/src/testutils.ts",
      "packages/settingeditor-extension/package.json",
      "packages/settingeditor/package.json",
      "packages/settingregistry/package.json",
      "packages/shortcuts-extension/package.json",
      "packages/statedb/package.json",
      "packages/statusbar-extension/package.json",
      "packages/statusbar/package.json",
      "packages/terminal-extension/package.json",
      "packages/terminal/package.json",
      "packages/testing/package.json",
      "packages/theme-dark-extension/package.json"
    ],
    "pr_changed_test_files": [
      "packages/docregistry/src/testutils.ts",
      "packages/services/src/testutils.ts",
      "packages/testing/package.json"
    ],
    "base_commit": "02e2ee497dab764c05e42cb8e13c50ca3023b542",
    "head_commit": "52a262d54a55b68c0e70829f835781575b608b1d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17271",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17271",
    "dockerfile": "",
    "pr_merged_at": "2025-02-12T15:56:23.000Z",
    "patch": "diff --git a/builder/package.json b/builder/package.json\nindex 19fc64b9eca7..6fc7063853fd 100644\n--- a/builder/package.json\n+++ b/builder/package.json\n@@ -71,7 +71,7 @@\n     \"@types/node\": \"^20.11.27\",\n     \"@types/supports-color\": \"^5.3.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/buildutils/package.json b/buildutils/package.json\nindex 11cc2fba9cfc..c61b54dcd24e 100644\n--- a/buildutils/package.json\n+++ b/buildutils/package.json\n@@ -57,7 +57,7 @@\n     \"process\": \"^0.11.10\",\n     \"semver\": \"^7.3.2\",\n     \"sort-package-json\": \"~1.53.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"verdaccio\": \"^5.25.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/buildutils/template/package.json b/buildutils/template/package.json\nindex a71ff6c3e9b4..774f1aa102bf 100644\n--- a/buildutils/template/package.json\n+++ b/buildutils/template/package.json\n@@ -40,7 +40,7 @@\n     \"@jupyterlab/testing\": \"^4.4.0-alpha.3\",\n     \"@types/jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/docs/source/extension/extension_migration.rst b/docs/source/extension/extension_migration.rst\nindex a3c75225ed04..9aefe2547410 100644\n--- a/docs/source/extension/extension_migration.rst\n+++ b/docs/source/extension/extension_migration.rst\n@@ -46,7 +46,7 @@ The **icons in use** are in the ``ui-components/style/icons/debugger`` folder, w\n TypeScript update\n ^^^^^^^^^^^^^^^^^\n \n-As a follow-up to the update to TypeScript 5.4, the ``tsconfig.json`` configuration of the ``@jupyterlab/buildutils`` package changed\n+As a follow-up to the update to TypeScript 5.5, the ``tsconfig.json`` configuration of the ``@jupyterlab/buildutils`` package changed\n the ``module`` option from ``commonjs`` to ``Node16``:\n \n .. code:: diff\n\ndiff --git a/examples/cell/package.json b/examples/cell/package.json\nindex b57b0518663c..ce862a3b639d 100644\n--- a/examples/cell/package.json\n+++ b/examples/cell/package.json\n@@ -28,7 +28,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/console/package.json b/examples/console/package.json\nindex 986db9260760..50b5e4d8900b 100644\n--- a/examples/console/package.json\n+++ b/examples/console/package.json\n@@ -25,7 +25,7 @@\n     \"mini-css-extract-plugin\": \"^2.7.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/filebrowser/package.json b/examples/filebrowser/package.json\nindex a3ceaa2011dc..a13bb7b64ff2 100644\n--- a/examples/filebrowser/package.json\n+++ b/examples/filebrowser/package.json\n@@ -29,7 +29,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/notebook/package.json b/examples/notebook/package.json\nindex de511d785e0c..5dfbd9ccc423 100644\n--- a/examples/notebook/package.json\n+++ b/examples/notebook/package.json\n@@ -34,7 +34,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/terminal/package.json b/examples/terminal/package.json\nindex 3b5ecfd2e764..7bfd4996bdcb 100644\n--- a/examples/terminal/package.json\n+++ b/examples/terminal/package.json\n@@ -21,7 +21,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/galata/extension/package.json b/galata/extension/package.json\nindex c80e110b4e0b..ac32887f35db 100644\n--- a/galata/extension/package.json\n+++ b/galata/extension/package.json\n@@ -47,7 +47,7 @@\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.4.0-alpha.3\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"jupyterlab\": {\n     \"extension\": true,\n\ndiff --git a/galata/package.json b/galata/package.json\nindex 645aaa2b8d54..724f5709c06a 100644\n--- a/galata/package.json\n+++ b/galata/package.json\n@@ -66,7 +66,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/application-extension/package.json b/packages/application-extension/package.json\nindex 9dcdf4cc5d05..a8a82f029d5d 100644\n--- a/packages/application-extension/package.json\n+++ b/packages/application-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/application/package.json b/packages/application/package.json\nindex 3926d80d9f3d..adb255b80df0 100644\n--- a/packages/application/package.json\n+++ b/packages/application/package.json\n@@ -67,7 +67,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/apputils-extension/package.json b/packages/apputils-extension/package.json\nindex 32bbfb777e53..5be1851dc6c7 100644\n--- a/packages/apputils-extension/package.json\n+++ b/packages/apputils-extension/package.json\n@@ -63,7 +63,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/apputils/package.json b/packages/apputils/package.json\nindex a08104c39c0a..50f4eed848ab 100644\n--- a/packages/apputils/package.json\n+++ b/packages/apputils/package.json\n@@ -72,7 +72,7 @@\n     \"@types/sanitize-html\": \"^2.11.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/attachments/package.json b/packages/attachments/package.json\nindex e35446933975..ce44ea377d64 100644\n--- a/packages/attachments/package.json\n+++ b/packages/attachments/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cell-toolbar-extension/package.json b/packages/cell-toolbar-extension/package.json\nindex 3eb6fe9ab63e..6face7763f68 100644\n--- a/packages/cell-toolbar-extension/package.json\n+++ b/packages/cell-toolbar-extension/package.json\n@@ -42,7 +42,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cell-toolbar/package.json b/packages/cell-toolbar/package.json\nindex cc26d1c886ed..a3d39e8fbd22 100644\n--- a/packages/cell-toolbar/package.json\n+++ b/packages/cell-toolbar/package.json\n@@ -58,7 +58,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cells/package.json b/packages/cells/package.json\nindex 5949d10b57d0..1e983a15959d 100644\n--- a/packages/cells/package.json\n+++ b/packages/cells/package.json\n@@ -77,7 +77,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/celltags-extension/package.json b/packages/celltags-extension/package.json\nindex d6d0da317a65..bacebc4f152c 100644\n--- a/packages/celltags-extension/package.json\n+++ b/packages/celltags-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codeeditor/package.json b/packages/codeeditor/package.json\nindex e75169c55578..48eea5b9616e 100644\n--- a/packages/codeeditor/package.json\n+++ b/packages/codeeditor/package.json\n@@ -63,7 +63,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codemirror-extension/package.json b/packages/codemirror-extension/package.json\nindex 7001836cdfae..3048f39234b0 100644\n--- a/packages/codemirror-extension/package.json\n+++ b/packages/codemirror-extension/package.json\n@@ -60,7 +60,7 @@\n   \"devDependencies\": {\n     \"@types/react\": \"^18.0.26\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codemirror/package.json b/packages/codemirror/package.json\nindex 0d8f34d2d8df..65e8e902c9fe 100644\n--- a/packages/codemirror/package.json\n+++ b/packages/codemirror/package.json\n@@ -79,7 +79,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/completer-extension/package.json b/packages/completer-extension/package.json\nindex d33afc278038..27524c1cf443 100644\n--- a/packages/completer-extension/package.json\n+++ b/packages/completer-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/completer/package.json b/packages/completer/package.json\nindex 56fcfe59c8fc..3142fd0801d2 100644\n--- a/packages/completer/package.json\n+++ b/packages/completer/package.json\n@@ -71,7 +71,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/console-extension/package.json b/packages/console-extension/package.json\nindex 70fde9d97e60..48deffed2f85 100644\n--- a/packages/console-extension/package.json\n+++ b/packages/console-extension/package.json\n@@ -57,7 +57,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/console/package.json b/packages/console/package.json\nindex 5c6d74b3187e..cd79720a01d8 100644\n--- a/packages/console/package.json\n+++ b/packages/console/package.json\n@@ -66,7 +66,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/coreutils/package.json b/packages/coreutils/package.json\nindex 776b873d800a..c7766cbfcfea 100644\n--- a/packages/coreutils/package.json\n+++ b/packages/coreutils/package.json\n@@ -57,7 +57,7 @@\n     \"jest-junit\": \"^15.0.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"ts-jest\": \"^29.1.0\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/csvviewer-extension/package.json b/packages/csvviewer-extension/package.json\nindex 3ef0b331816e..8631a017488a 100644\n--- a/packages/csvviewer-extension/package.json\n+++ b/packages/csvviewer-extension/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/csvviewer/package.json b/packages/csvviewer/package.json\nindex 1b075175b14a..ae6e16bd3afd 100644\n--- a/packages/csvviewer/package.json\n+++ b/packages/csvviewer/package.json\n@@ -59,7 +59,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/debugger-extension/package.json b/packages/debugger-extension/package.json\nindex bf76e881265b..8cec8ac3307c 100644\n--- a/packages/debugger-extension/package.json\n+++ b/packages/debugger-extension/package.json\n@@ -65,7 +65,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/react-dom\": \"^18.0.9\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex 8f3e25354256..5a616e6e299c 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -84,7 +84,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docmanager-extension/package.json b/packages/docmanager-extension/package.json\nindex 52725d300e4f..13194138a186 100644\n--- a/packages/docmanager-extension/package.json\n+++ b/packages/docmanager-extension/package.json\n@@ -58,7 +58,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docmanager/package.json b/packages/docmanager/package.json\nindex f2878feba049..57cb37ec5656 100644\n--- a/packages/docmanager/package.json\n+++ b/packages/docmanager/package.json\n@@ -64,7 +64,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docregistry/package.json b/packages/docregistry/package.json\nindex eda300004e96..e6a3ec07b0c9 100644\n--- a/packages/docregistry/package.json\n+++ b/packages/docregistry/package.json\n@@ -65,7 +65,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/documentsearch-extension/package.json b/packages/documentsearch-extension/package.json\nindex 61092961298a..9c2610da31e3 100644\n--- a/packages/documentsearch-extension/package.json\n+++ b/packages/documentsearch-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/documentsearch/package.json b/packages/documentsearch/package.json\nindex b622473bfcbd..0f43644d08b9 100644\n--- a/packages/documentsearch/package.json\n+++ b/packages/documentsearch/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/extensionmanager-extension/package.json b/packages/extensionmanager-extension/package.json\nindex e401a9d8ffed..cf2bac6a479a 100644\n--- a/packages/extensionmanager-extension/package.json\n+++ b/packages/extensionmanager-extension/package.json\n@@ -47,7 +47,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/extensionmanager/package.json b/packages/extensionmanager/package.json\nindex 682a55a301fd..17754d5f2418 100644\n--- a/packages/extensionmanager/package.json\n+++ b/packages/extensionmanager/package.json\n@@ -54,7 +54,7 @@\n     \"@types/semver\": \"^7.3.3\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/filebrowser-extension/package.json b/packages/filebrowser-extension/package.json\nindex e057cb092a77..0cee7654ca57 100644\n--- a/packages/filebrowser-extension/package.json\n+++ b/packages/filebrowser-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/filebrowser/package.json b/packages/filebrowser/package.json\nindex 90fdc41415cb..30c5e17e535b 100644\n--- a/packages/filebrowser/package.json\n+++ b/packages/filebrowser/package.json\n@@ -67,7 +67,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/fileeditor-extension/package.json b/packages/fileeditor-extension/package.json\nindex c3f6fbf6a019..79123a3bf60f 100644\n--- a/packages/fileeditor-extension/package.json\n+++ b/packages/fileeditor-extension/package.json\n@@ -68,7 +68,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/fileeditor/package.json b/packages/fileeditor/package.json\nindex 47b1e39da85b..d0fef2bb23ea 100644\n--- a/packages/fileeditor/package.json\n+++ b/packages/fileeditor/package.json\n@@ -63,7 +63,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/help-extension/package.json b/packages/help-extension/package.json\nindex ac725a93571f..ba1b6be80d39 100644\n--- a/packages/help-extension/package.json\n+++ b/packages/help-extension/package.json\n@@ -52,7 +52,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/htmlviewer-extension/package.json b/packages/htmlviewer-extension/package.json\nindex bcbb0c5b2543..73b24e2a3c72 100644\n--- a/packages/htmlviewer-extension/package.json\n+++ b/packages/htmlviewer-extension/package.json\n@@ -46,7 +46,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/htmlviewer/package.json b/packages/htmlviewer/package.json\nindex cce9c3c44cfe..345b10f84506 100644\n--- a/packages/htmlviewer/package.json\n+++ b/packages/htmlviewer/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/hub-extension/package.json b/packages/hub-extension/package.json\nindex a9a8547f4781..757a7ab36e6b 100644\n--- a/packages/hub-extension/package.json\n+++ b/packages/hub-extension/package.json\n@@ -49,7 +49,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/imageviewer-extension/package.json b/packages/imageviewer-extension/package.json\nindex c5383bb54b95..2d7a23a8c4d4 100644\n--- a/packages/imageviewer-extension/package.json\n+++ b/packages/imageviewer-extension/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/imageviewer/package.json b/packages/imageviewer/package.json\nindex 81194cdd3edb..3d11cea25112 100644\n--- a/packages/imageviewer/package.json\n+++ b/packages/imageviewer/package.json\n@@ -53,7 +53,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/inspector-extension/package.json b/packages/inspector-extension/package.json\nindex 82bde93f0405..fab963154200 100644\n--- a/packages/inspector-extension/package.json\n+++ b/packages/inspector-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/inspector/package.json b/packages/inspector/package.json\nindex c1469af2360b..79a58f195904 100644\n--- a/packages/inspector/package.json\n+++ b/packages/inspector/package.json\n@@ -59,7 +59,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/javascript-extension/package.json b/packages/javascript-extension/package.json\nindex 18578c1ab091..45e64bc34864 100644\n--- a/packages/javascript-extension/package.json\n+++ b/packages/javascript-extension/package.json\n@@ -37,7 +37,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/json-extension/package.json b/packages/json-extension/package.json\nindex 2140bf22e721..31eb16107675 100644\n--- a/packages/json-extension/package.json\n+++ b/packages/json-extension/package.json\n@@ -52,7 +52,7 @@\n     \"@types/react-dom\": \"^18.0.9\",\n     \"@types/react-highlight-words\": \"^0.16.4\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/launcher-extension/package.json b/packages/launcher-extension/package.json\nindex 121e0240960f..efff1bf9ae0d 100644\n--- a/packages/launcher-extension/package.json\n+++ b/packages/launcher-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/launcher/package.json b/packages/launcher/package.json\nindex b682bf519a7d..d098e183ee02 100644\n--- a/packages/launcher/package.json\n+++ b/packages/launcher/package.json\n@@ -50,7 +50,7 @@\n   \"devDependencies\": {\n     \"@types/react\": \"^18.0.26\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/logconsole-extension/package.json b/packages/logconsole-extension/package.json\nindex 0ae43c067e16..304d36a95874 100644\n--- a/packages/logconsole-extension/package.json\n+++ b/packages/logconsole-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/logconsole/package.json b/packages/logconsole/package.json\nindex 69a2635ea214..ca891509a505 100644\n--- a/packages/logconsole/package.json\n+++ b/packages/logconsole/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/lsp-extension/package.json b/packages/lsp-extension/package.json\nindex 25b01e5426d6..24432027115a 100644\n--- a/packages/lsp-extension/package.json\n+++ b/packages/lsp-extension/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/lsp/package.json b/packages/lsp/package.json\nindex 6121affc570b..e9721d2399f1 100644\n--- a/packages/lsp/package.json\n+++ b/packages/lsp/package.json\n@@ -64,7 +64,7 @@\n     \"jest\": \"^29.2.0\",\n     \"json-schema-to-typescript\": \"^8.0.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mainmenu-extension/package.json b/packages/mainmenu-extension/package.json\nindex 323580c14967..5fed9d1b0744 100644\n--- a/packages/mainmenu-extension/package.json\n+++ b/packages/mainmenu-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mainmenu/package.json b/packages/mainmenu/package.json\nindex 8c35b88abee1..70e8c95fff96 100644\n--- a/packages/mainmenu/package.json\n+++ b/packages/mainmenu/package.json\n@@ -54,7 +54,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markdownviewer-extension/package.json b/packages/markdownviewer-extension/package.json\nindex 8eda5e9d4493..e80bbac5527e 100644\n--- a/packages/markdownviewer-extension/package.json\n+++ b/packages/markdownviewer-extension/package.json\n@@ -48,7 +48,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markdownviewer/package.json b/packages/markdownviewer/package.json\nindex b688f1d54210..4ba48990aefe 100644\n--- a/packages/markdownviewer/package.json\n+++ b/packages/markdownviewer/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markedparser-extension/package.json b/packages/markedparser-extension/package.json\nindex 665739f3d312..39300585daa2 100644\n--- a/packages/markedparser-extension/package.json\n+++ b/packages/markedparser-extension/package.json\n@@ -49,7 +49,7 @@\n     \"@types/d3\": \"^7.4.0\",\n     \"@types/dompurify\": \"^2.4.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mathjax-extension/package.json b/packages/mathjax-extension/package.json\nindex 60bdbf8b316e..c4c66125a2f1 100644\n--- a/packages/mathjax-extension/package.json\n+++ b/packages/mathjax-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mermaid-extension/package.json b/packages/mermaid-extension/package.json\nindex 590fb583850a..08413b87237b 100644\n--- a/packages/mermaid-extension/package.json\n+++ b/packages/mermaid-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mermaid/package.json b/packages/mermaid/package.json\nindex da4b8bce5dcd..a2734f4f9311 100644\n--- a/packages/mermaid/package.json\n+++ b/packages/mermaid/package.json\n@@ -53,7 +53,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metadataform-extension/package.json b/packages/metadataform-extension/package.json\nindex d00a48909ce4..3bf563bb0aef 100644\n--- a/packages/metadataform-extension/package.json\n+++ b/packages/metadataform-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metadataform/package.json b/packages/metadataform/package.json\nindex deed511b0aa3..cdec325a23e9 100644\n--- a/packages/metadataform/package.json\n+++ b/packages/metadataform/package.json\n@@ -65,7 +65,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metapackage/package.json b/packages/metapackage/package.json\nindex 7a7b13a7c958..7306a95465d5 100644\n--- a/packages/metapackage/package.json\n+++ b/packages/metapackage/package.json\n@@ -141,7 +141,7 @@\n     \"jest\": \"^29.2.0\",\n     \"json-to-html\": \"~0.1.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/nbformat/package.json b/packages/nbformat/package.json\nindex 88bbd07f7670..6188f552e19c 100644\n--- a/packages/nbformat/package.json\n+++ b/packages/nbformat/package.json\n@@ -44,7 +44,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/notebook-extension/package.json b/packages/notebook-extension/package.json\nindex 65495b5a5733..43c9f13bca81 100644\n--- a/packages/notebook-extension/package.json\n+++ b/packages/notebook-extension/package.json\n@@ -78,7 +78,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/notebook/package.json b/packages/notebook/package.json\nindex 0785705f0efc..97bde799c4b2 100644\n--- a/packages/notebook/package.json\n+++ b/packages/notebook/package.json\n@@ -76,7 +76,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/observables/package.json b/packages/observables/package.json\nindex ffb0e7932426..1bb1ee04f369 100644\n--- a/packages/observables/package.json\n+++ b/packages/observables/package.json\n@@ -47,7 +47,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/outputarea/package.json b/packages/outputarea/package.json\nindex 3edeac986c04..e03a937dead4 100644\n--- a/packages/outputarea/package.json\n+++ b/packages/outputarea/package.json\n@@ -61,7 +61,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pdf-extension/package.json b/packages/pdf-extension/package.json\nindex 0df4b8489fe2..11740e6cf6b6 100644\n--- a/packages/pdf-extension/package.json\n+++ b/packages/pdf-extension/package.json\n@@ -43,7 +43,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pluginmanager-extension/package.json b/packages/pluginmanager-extension/package.json\nindex 6c658efe9574..6465467fe7ab 100644\n--- a/packages/pluginmanager-extension/package.json\n+++ b/packages/pluginmanager-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pluginmanager/package.json b/packages/pluginmanager/package.json\nindex ea8d10270018..3bb71196d133 100644\n--- a/packages/pluginmanager/package.json\n+++ b/packages/pluginmanager/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/property-inspector/package.json b/packages/property-inspector/package.json\nindex e4bc9941391b..af2abb895982 100644\n--- a/packages/property-inspector/package.json\n+++ b/packages/property-inspector/package.json\n@@ -46,7 +46,7 @@\n   \"devDependencies\": {\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime-extension/package.json b/packages/rendermime-extension/package.json\nindex ca594a434b8b..d2a909571357 100644\n--- a/packages/rendermime-extension/package.json\n+++ b/packages/rendermime-extension/package.json\n@@ -41,7 +41,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime-interfaces/package.json b/packages/rendermime-interfaces/package.json\nindex b5b70b550e28..cc7310f1a041 100644\n--- a/packages/rendermime-interfaces/package.json\n+++ b/packages/rendermime-interfaces/package.json\n@@ -35,7 +35,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime/package.json b/packages/rendermime/package.json\nindex da514d6e811e..77248f34ee8b 100644\n--- a/packages/rendermime/package.json\n+++ b/packages/rendermime/package.json\n@@ -61,7 +61,7 @@\n     \"fs-extra\": \"^10.1.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/running-extension/package.json b/packages/running-extension/package.json\nindex c897d5496086..f55d5d451292 100644\n--- a/packages/running-extension/package.json\n+++ b/packages/running-extension/package.json\n@@ -56,7 +56,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/running/package.json b/packages/running/package.json\nindex 3d4428524844..f74e307c709c 100644\n--- a/packages/running/package.json\n+++ b/packages/running/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/services/examples/browser/package.json b/packages/services/examples/browser/package.json\nindex 82986f6b390b..2694fe58cc90 100644\n--- a/packages/services/examples/browser/package.json\n+++ b/packages/services/examples/browser/package.json\n@@ -16,7 +16,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/packages/services/examples/typescript-browser-with-output/package.json b/packages/services/examples/typescript-browser-with-output/package.json\nindex b5f865f1fc30..6d782a08460c 100644\n--- a/packages/services/examples/typescript-browser-with-output/package.json\n+++ b/packages/services/examples/typescript-browser-with-output/package.json\n@@ -25,7 +25,7 @@\n     \"css-loader\": \"^6.7.1\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   },\n\ndiff --git a/packages/services/package.json b/packages/services/package.json\nindex ad93f5b0b3e5..f27e114b05bc 100644\n--- a/packages/services/package.json\n+++ b/packages/services/package.json\n@@ -63,7 +63,7 @@\n     \"@types/ws\": \"^8.5.3\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\",\n+    \"typescript\": \"~5.5.4\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   },\n\ndiff --git a/packages/settingeditor-extension/package.json b/packages/settingeditor-extension/package.json\nindex 029ae23f1833..8d0fcb2662a2 100644\n--- a/packages/settingeditor-extension/package.json\n+++ b/packages/settingeditor-extension/package.json\n@@ -52,7 +52,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/settingeditor/package.json b/packages/settingeditor/package.json\nindex 7c8480a3f212..3333ebef8778 100644\n--- a/packages/settingeditor/package.json\n+++ b/packages/settingeditor/package.json\n@@ -73,7 +73,7 @@\n     \"react-test-renderer\": \"^18.2.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"ts-jest\": \"^29.1.0\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/settingregistry/package.json b/packages/settingregistry/package.json\nindex dbd2432fc5f6..288911ac2a42 100644\n--- a/packages/settingregistry/package.json\n+++ b/packages/settingregistry/package.json\n@@ -51,7 +51,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"peerDependencies\": {\n     \"react\": \">=16\"\n\ndiff --git a/packages/shortcuts-extension/package.json b/packages/shortcuts-extension/package.json\nindex 4acd5f7a70ae..53303345b25e 100644\n--- a/packages/shortcuts-extension/package.json\n+++ b/packages/shortcuts-extension/package.json\n@@ -58,7 +58,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statedb/package.json b/packages/statedb/package.json\nindex 5d6d2190294c..f92607846c7e 100644\n--- a/packages/statedb/package.json\n+++ b/packages/statedb/package.json\n@@ -46,7 +46,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statusbar-extension/package.json b/packages/statusbar-extension/package.json\nindex f4f114a14c79..0988609eb5ad 100644\n--- a/packages/statusbar-extension/package.json\n+++ b/packages/statusbar-extension/package.json\n@@ -46,7 +46,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"@types/react-dom\": \"^18.0.9\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statusbar/package.json b/packages/statusbar/package.json\nindex 06963d32a3d1..d9beba4b8ef3 100644\n--- a/packages/statusbar/package.json\n+++ b/packages/statusbar/package.json\n@@ -50,7 +50,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/terminal-extension/package.json b/packages/terminal-extension/package.json\nindex 583046d93a85..41b0b7fd7075 100644\n--- a/packages/terminal-extension/package.json\n+++ b/packages/terminal-extension/package.json\n@@ -52,7 +52,7 @@\n   \"devDependencies\": {\n     \"@types/webpack-env\": \"^1.18.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/terminal/package.json b/packages/terminal/package.json\nindex cd9c87f74f31..38d523c1dab4 100644\n--- a/packages/terminal/package.json\n+++ b/packages/terminal/package.json\n@@ -60,7 +60,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/theme-dark-extension/package.json b/packages/theme-dark-extension/package.json\nindex 19f9c6e8cbb3..7db0f7acced3 100644\n--- a/packages/theme-dark-extension/package.json\n+++ b/packages/theme-dark-extension/package.json\n@@ -38,7 +38,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n",
    "test_patch": "diff --git a/packages/docregistry/src/testutils.ts b/packages/docregistry/src/testutils.ts\nindex 4af7e2903001..3e01df22a259 100644\n--- a/packages/docregistry/src/testutils.ts\n+++ b/packages/docregistry/src/testutils.ts\n@@ -4,7 +4,7 @@\n // We explicitly reference the jest typings since the jest.d.ts file shipped\n // with jest 26 masks the @types/jest typings\n \n-/// <reference types=\"jest\" />\n+/// <reference types=\"jest\" preserve=\"true\"/>\n \n import { ISessionContext, SessionContext } from '@jupyterlab/apputils';\n import {\n\ndiff --git a/packages/services/src/testutils.ts b/packages/services/src/testutils.ts\nindex eeebca1bda36..af0107a0edbd 100644\n--- a/packages/services/src/testutils.ts\n+++ b/packages/services/src/testutils.ts\n@@ -4,7 +4,7 @@\n // We explicitly reference the jest typings since the jest.d.ts file shipped\n // with jest 26 masks the @types/jest typings\n \n-/// <reference types=\"jest\" />\n+/// <reference types=\"jest\" preserve=\"true\"/>\n \n import { PathExt } from '@jupyterlab/coreutils';\n import { PartialJSONObject, ReadonlyJSONObject, UUID } from '@lumino/coreutils';\n\ndiff --git a/packages/testing/package.json b/packages/testing/package.json\nindex 4b4c32cd87a2..76ff9e001a55 100644\n--- a/packages/testing/package.json\n+++ b/packages/testing/package.json\n@@ -51,7 +51,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/node\": \"^20.11.27\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.4.5\"\n+    \"typescript\": \"~5.5.4\"\n   },\n   \"peerDependencies\": {\n     \"typescript\": \">=4.3\"\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17266",
    "pr_id": 17266,
    "issue_id": 17235,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "PyPI Extension Manager should not show results alphabetically in Discovery\n## Description\n\nThe discovery section of extensions should not be used for political statements by extension authors gaming the system:\n\n![Image](https://github.com/user-attachments/assets/0540935b-8847-49f9-be4c-e8fc6464e84e)\n\nNot that the white-blue-red flag is deliberate as it comes from `https://github.com/RussiaZ` account - see https://en.wikipedia.org/wiki/Z_(military_symbol). The one with blue-yellow flag at least is a real extension.\n\nEven worse, someone could use it to show more offensive content.\n\n## Reproduce\n\nOpen extension manager\n\n## Expected behavior\n\n- Ideally we would have some popularity or quality sort, but we don't (there was one on npm but not on PyPI)\n- Instead let's show extensions from Project Jupyter PyPI org first, then from jupyterlab-contrib and then random.\n\n## Context\n\n- JupyterLab version: 4.x",
    "issue_word_count": 131,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "jupyterlab/extensions/pypi.py",
      "jupyterlab/tests/test_extensions.py",
      "packages/extensionmanager/src/model.ts"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/test_extensions.py"
    ],
    "base_commit": "5ba4755e5a64eae5bb1ce807dd6bc06b6e908273",
    "head_commit": "fbe07664b99b0bc6b021963c01145542c5e8ba3d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17266",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17266",
    "dockerfile": "",
    "pr_merged_at": "2025-02-20T12:37:17.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17256",
    "pr_id": 17256,
    "issue_id": 16303,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Current workspace indicator for non-default workspace\n### Problem\r\n\r\nJupyterLab 4.2.0 includes UI for workspaces (https://github.com/jupyterlab/jupyterlab/pull/15946), which now can be switched from the sidebar:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/de4c2c7f-93df-49ba-9986-23be2566cbd7)\r\n\r\nWhile it indicates the current workspace with a little checkmark, this is often not visible because the sidebar may be hidden or showing a different panel. Often when switching the workspace the sidebar will go away because the layout of the target workspace may be different.\r\n\r\n### Proposed Solution\r\n\r\nShow the workspace indicator when the workspace is different from default (and different from an auto-generated workspace?)\r\n\r\nFor example, one of the earlier designs (https://github.com/jupyterlab/jupyterlab/issues/6944#issuecomment-649992115) included a workspace switcher in the top bar, next to the menu:\r\n\r\n![indicator](https://github.com/jupyterlab/jupyterlab/assets/5832902/76a02373-0e49-4161-bfbc-e7f147209c2c)\r\n\r\nIt could be just an indicator, or also a switcher:\r\n\r\n![indicator](https://github.com/jupyterlab/jupyterlab/assets/5832902/f6269128-6225-4e13-b484-b16c46848186)\r\n\r\nAlternatively, it could go on the status bar.\r\n\r\n### Additional context\r\n\r\nWorkspace name is often shown on the window title bar, which we already do.\r\n\r\nSome applications also show the workspace name in the file browser.",
    "issue_word_count": 202,
    "test_files_count": 2,
    "non_test_files_count": 12,
    "pr_changed_files": [
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-view-appearance-jupyterlab-linux.png",
      "galata/test/jupyterlab/workspace.test.ts",
      "packages/apputils-extension/src/index.ts",
      "packages/workspaces-extension/package.json",
      "packages/workspaces-extension/schema/indicator.json",
      "packages/workspaces-extension/src/commands.ts",
      "packages/workspaces-extension/src/index.ts",
      "packages/workspaces-extension/src/top_indicator.tsx",
      "packages/workspaces-extension/style/base.css",
      "packages/workspaces-extension/style/index.css",
      "packages/workspaces-extension/style/index.js",
      "packages/workspaces-extension/style/selector.css",
      "packages/workspaces-extension/tsconfig.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-view-appearance-jupyterlab-linux.png",
      "galata/test/jupyterlab/workspace.test.ts"
    ],
    "base_commit": "47f3326c0ea39827db353d7384b50a91fa0c44a8",
    "head_commit": "715920c607ee6452f9f6ae2a38f81dda04d74308",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17256",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17256",
    "dockerfile": "",
    "pr_merged_at": "2025-02-18T14:45:01.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17255",
    "pr_id": 17255,
    "issue_id": 16174,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Update to TypeScript 5.8\nThe last update was for TypeScript 5.1, done in https://github.com/jupyterlab/jupyterlab/pull/14638.\r\n\r\nIt would be great to look into updating to the latest version to not lag behind for too long.\r\n\r\nIn https://github.com/jupyterlab/jupyterlab/pull/14638#issuecomment-1803584472 @fcollonval said:\r\n\r\n> but bumping to 5.2 or later will have some effects as we will need to change the ts configuration.\r\n\r\nLooks like this refers to the \"module and moduleResolution Must Match Under Recent Node.js settings\" section mentioned in https://devblogs.microsoft.com/typescript/announcing-typescript-5-2/#breaking-changes-and-correctness-fixes ?",
    "issue_word_count": 106,
    "test_files_count": 1,
    "non_test_files_count": 99,
    "pr_changed_files": [
      "builder/package.json",
      "buildutils/package.json",
      "buildutils/template/package.json",
      "docs/source/extension/extension_migration.rst",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "galata/extension/package.json",
      "galata/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/attachments/package.json",
      "packages/cell-toolbar-extension/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/celltags-extension/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console/package.json",
      "packages/coreutils/package.json",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer/package.json",
      "packages/debugger-extension/package.json",
      "packages/debugger/package.json",
      "packages/docmanager-extension/package.json",
      "packages/docmanager/package.json",
      "packages/docregistry/package.json",
      "packages/documentsearch-extension/package.json",
      "packages/documentsearch/package.json",
      "packages/extensionmanager-extension/package.json",
      "packages/extensionmanager/package.json",
      "packages/filebrowser-extension/package.json",
      "packages/filebrowser/package.json",
      "packages/fileeditor-extension/package.json",
      "packages/fileeditor/package.json",
      "packages/help-extension/package.json",
      "packages/htmlviewer-extension/package.json",
      "packages/htmlviewer/package.json",
      "packages/hub-extension/package.json",
      "packages/imageviewer-extension/package.json",
      "packages/imageviewer/package.json",
      "packages/inspector-extension/package.json",
      "packages/inspector/package.json",
      "packages/javascript-extension/package.json",
      "packages/json-extension/package.json",
      "packages/launcher-extension/package.json",
      "packages/launcher/package.json",
      "packages/logconsole-extension/package.json",
      "packages/logconsole/package.json",
      "packages/lsp-extension/package.json",
      "packages/lsp/package.json",
      "packages/mainmenu-extension/package.json",
      "packages/mainmenu/package.json",
      "packages/markdownviewer-extension/package.json",
      "packages/markdownviewer/package.json",
      "packages/markedparser-extension/package.json",
      "packages/mathjax-extension/package.json",
      "packages/mermaid-extension/package.json",
      "packages/mermaid/package.json",
      "packages/metadataform-extension/package.json",
      "packages/metadataform/package.json",
      "packages/metapackage/package.json",
      "packages/nbformat/package.json",
      "packages/notebook-extension/package.json",
      "packages/notebook/package.json",
      "packages/observables/package.json",
      "packages/outputarea/package.json",
      "packages/pdf-extension/package.json",
      "packages/pluginmanager-extension/package.json",
      "packages/pluginmanager/package.json",
      "packages/property-inspector/package.json",
      "packages/rendermime-extension/package.json",
      "packages/rendermime-interfaces/package.json",
      "packages/rendermime/package.json",
      "packages/running-extension/package.json",
      "packages/running/package.json",
      "packages/services/examples/browser/package.json",
      "packages/services/examples/typescript-browser-with-output/package.json",
      "packages/services/package.json",
      "packages/settingeditor-extension/package.json",
      "packages/settingeditor/package.json",
      "packages/settingregistry/package.json",
      "packages/shortcuts-extension/package.json",
      "packages/statedb/package.json",
      "packages/statusbar-extension/package.json",
      "packages/statusbar/package.json",
      "packages/terminal-extension/package.json",
      "packages/terminal/package.json",
      "packages/testing/package.json",
      "packages/theme-dark-extension/package.json",
      "packages/theme-dark-high-contrast-extension/package.json",
      "packages/theme-light-extension/package.json"
    ],
    "pr_changed_test_files": [
      "packages/testing/package.json"
    ],
    "base_commit": "0fcb101cf09239baab346f3b5eca7c8b41321b01",
    "head_commit": "d1cdbd4065548487b966e9f450c6daf102f3873e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17255",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17255",
    "dockerfile": "",
    "pr_merged_at": "2025-02-07T12:04:42.000Z",
    "patch": "diff --git a/builder/package.json b/builder/package.json\nindex 20f7a7a0b798..19fc64b9eca7 100644\n--- a/builder/package.json\n+++ b/builder/package.json\n@@ -71,7 +71,7 @@\n     \"@types/node\": \"^20.11.27\",\n     \"@types/supports-color\": \"^5.3.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/buildutils/package.json b/buildutils/package.json\nindex f34f21493bad..11cc2fba9cfc 100644\n--- a/buildutils/package.json\n+++ b/buildutils/package.json\n@@ -57,7 +57,7 @@\n     \"process\": \"^0.11.10\",\n     \"semver\": \"^7.3.2\",\n     \"sort-package-json\": \"~1.53.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"verdaccio\": \"^5.25.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/buildutils/template/package.json b/buildutils/template/package.json\nindex 87cdd8c84242..a71ff6c3e9b4 100644\n--- a/buildutils/template/package.json\n+++ b/buildutils/template/package.json\n@@ -40,7 +40,7 @@\n     \"@jupyterlab/testing\": \"^4.4.0-alpha.3\",\n     \"@types/jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/docs/source/extension/extension_migration.rst b/docs/source/extension/extension_migration.rst\nindex c2e56914bd6b..a3c75225ed04 100644\n--- a/docs/source/extension/extension_migration.rst\n+++ b/docs/source/extension/extension_migration.rst\n@@ -46,7 +46,7 @@ The **icons in use** are in the ``ui-components/style/icons/debugger`` folder, w\n TypeScript update\n ^^^^^^^^^^^^^^^^^\n \n-As a follow-up to the update to TypeScript 5.2, the ``tsconfig.json`` configuration of the ``@jupyterlab/buildutils`` package changed\n+As a follow-up to the update to TypeScript 5.4, the ``tsconfig.json`` configuration of the ``@jupyterlab/buildutils`` package changed\n the ``module`` option from ``commonjs`` to ``Node16``:\n \n .. code:: diff\n\ndiff --git a/examples/cell/package.json b/examples/cell/package.json\nindex 4d0d21587f91..b57b0518663c 100644\n--- a/examples/cell/package.json\n+++ b/examples/cell/package.json\n@@ -28,7 +28,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/console/package.json b/examples/console/package.json\nindex 1640de34b5f9..986db9260760 100644\n--- a/examples/console/package.json\n+++ b/examples/console/package.json\n@@ -25,7 +25,7 @@\n     \"mini-css-extract-plugin\": \"^2.7.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/filebrowser/package.json b/examples/filebrowser/package.json\nindex 1da290c4a09c..a3ceaa2011dc 100644\n--- a/examples/filebrowser/package.json\n+++ b/examples/filebrowser/package.json\n@@ -29,7 +29,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/notebook/package.json b/examples/notebook/package.json\nindex e2aed253cb23..de511d785e0c 100644\n--- a/examples/notebook/package.json\n+++ b/examples/notebook/package.json\n@@ -34,7 +34,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/terminal/package.json b/examples/terminal/package.json\nindex fc858cf84da4..3b5ecfd2e764 100644\n--- a/examples/terminal/package.json\n+++ b/examples/terminal/package.json\n@@ -21,7 +21,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/galata/extension/package.json b/galata/extension/package.json\nindex fcd40966131d..c80e110b4e0b 100644\n--- a/galata/extension/package.json\n+++ b/galata/extension/package.json\n@@ -47,7 +47,7 @@\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.4.0-alpha.3\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"jupyterlab\": {\n     \"extension\": true,\n\ndiff --git a/galata/package.json b/galata/package.json\nindex 2e491bde2ced..645aaa2b8d54 100644\n--- a/galata/package.json\n+++ b/galata/package.json\n@@ -66,7 +66,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/application-extension/package.json b/packages/application-extension/package.json\nindex 8c9435a33eba..9dcdf4cc5d05 100644\n--- a/packages/application-extension/package.json\n+++ b/packages/application-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/application/package.json b/packages/application/package.json\nindex 6d499e4fb2b0..3926d80d9f3d 100644\n--- a/packages/application/package.json\n+++ b/packages/application/package.json\n@@ -67,7 +67,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/apputils-extension/package.json b/packages/apputils-extension/package.json\nindex 47f76afc82c6..32bbfb777e53 100644\n--- a/packages/apputils-extension/package.json\n+++ b/packages/apputils-extension/package.json\n@@ -63,7 +63,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/apputils/package.json b/packages/apputils/package.json\nindex 56f1eba9b251..a08104c39c0a 100644\n--- a/packages/apputils/package.json\n+++ b/packages/apputils/package.json\n@@ -72,7 +72,7 @@\n     \"@types/sanitize-html\": \"^2.11.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/attachments/package.json b/packages/attachments/package.json\nindex 5c436ea48ad6..e35446933975 100644\n--- a/packages/attachments/package.json\n+++ b/packages/attachments/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cell-toolbar-extension/package.json b/packages/cell-toolbar-extension/package.json\nindex f889398819b6..3eb6fe9ab63e 100644\n--- a/packages/cell-toolbar-extension/package.json\n+++ b/packages/cell-toolbar-extension/package.json\n@@ -42,7 +42,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cell-toolbar/package.json b/packages/cell-toolbar/package.json\nindex a2c2fde96a3d..cc26d1c886ed 100644\n--- a/packages/cell-toolbar/package.json\n+++ b/packages/cell-toolbar/package.json\n@@ -58,7 +58,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cells/package.json b/packages/cells/package.json\nindex 66deeb27274e..5949d10b57d0 100644\n--- a/packages/cells/package.json\n+++ b/packages/cells/package.json\n@@ -77,7 +77,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/celltags-extension/package.json b/packages/celltags-extension/package.json\nindex 27518adc0501..d6d0da317a65 100644\n--- a/packages/celltags-extension/package.json\n+++ b/packages/celltags-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codeeditor/package.json b/packages/codeeditor/package.json\nindex 2749fa498a86..e75169c55578 100644\n--- a/packages/codeeditor/package.json\n+++ b/packages/codeeditor/package.json\n@@ -63,7 +63,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codemirror-extension/package.json b/packages/codemirror-extension/package.json\nindex c976c3d48c4b..7001836cdfae 100644\n--- a/packages/codemirror-extension/package.json\n+++ b/packages/codemirror-extension/package.json\n@@ -60,7 +60,7 @@\n   \"devDependencies\": {\n     \"@types/react\": \"^18.0.26\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codemirror/package.json b/packages/codemirror/package.json\nindex 0262d8a3d603..0d8f34d2d8df 100644\n--- a/packages/codemirror/package.json\n+++ b/packages/codemirror/package.json\n@@ -79,7 +79,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/completer-extension/package.json b/packages/completer-extension/package.json\nindex b9c60382f857..d33afc278038 100644\n--- a/packages/completer-extension/package.json\n+++ b/packages/completer-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/completer/package.json b/packages/completer/package.json\nindex f51cac46fb1a..56fcfe59c8fc 100644\n--- a/packages/completer/package.json\n+++ b/packages/completer/package.json\n@@ -71,7 +71,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/console-extension/package.json b/packages/console-extension/package.json\nindex 851e27604cbe..70fde9d97e60 100644\n--- a/packages/console-extension/package.json\n+++ b/packages/console-extension/package.json\n@@ -57,7 +57,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/console/package.json b/packages/console/package.json\nindex 1b97868f47aa..5c6d74b3187e 100644\n--- a/packages/console/package.json\n+++ b/packages/console/package.json\n@@ -66,7 +66,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/coreutils/package.json b/packages/coreutils/package.json\nindex e7bfef6d7dd6..776b873d800a 100644\n--- a/packages/coreutils/package.json\n+++ b/packages/coreutils/package.json\n@@ -57,7 +57,7 @@\n     \"jest-junit\": \"^15.0.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"ts-jest\": \"^29.1.0\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/csvviewer-extension/package.json b/packages/csvviewer-extension/package.json\nindex 28d24da077db..3ef0b331816e 100644\n--- a/packages/csvviewer-extension/package.json\n+++ b/packages/csvviewer-extension/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/csvviewer/package.json b/packages/csvviewer/package.json\nindex e66ce710a1e0..1b075175b14a 100644\n--- a/packages/csvviewer/package.json\n+++ b/packages/csvviewer/package.json\n@@ -59,7 +59,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/debugger-extension/package.json b/packages/debugger-extension/package.json\nindex d5bf5f20179d..bf76e881265b 100644\n--- a/packages/debugger-extension/package.json\n+++ b/packages/debugger-extension/package.json\n@@ -65,7 +65,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/react-dom\": \"^18.0.9\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex 789a31e0f086..8f3e25354256 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -84,7 +84,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docmanager-extension/package.json b/packages/docmanager-extension/package.json\nindex a09aff6d9df6..52725d300e4f 100644\n--- a/packages/docmanager-extension/package.json\n+++ b/packages/docmanager-extension/package.json\n@@ -58,7 +58,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docmanager/package.json b/packages/docmanager/package.json\nindex 391eb88b89b3..f2878feba049 100644\n--- a/packages/docmanager/package.json\n+++ b/packages/docmanager/package.json\n@@ -64,7 +64,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docregistry/package.json b/packages/docregistry/package.json\nindex 7c22fbf2bf8e..eda300004e96 100644\n--- a/packages/docregistry/package.json\n+++ b/packages/docregistry/package.json\n@@ -65,7 +65,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/documentsearch-extension/package.json b/packages/documentsearch-extension/package.json\nindex 00614eb65352..61092961298a 100644\n--- a/packages/documentsearch-extension/package.json\n+++ b/packages/documentsearch-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/documentsearch/package.json b/packages/documentsearch/package.json\nindex 2aa057f1352f..b622473bfcbd 100644\n--- a/packages/documentsearch/package.json\n+++ b/packages/documentsearch/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/extensionmanager-extension/package.json b/packages/extensionmanager-extension/package.json\nindex e9c67d6b5059..e401a9d8ffed 100644\n--- a/packages/extensionmanager-extension/package.json\n+++ b/packages/extensionmanager-extension/package.json\n@@ -47,7 +47,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/extensionmanager/package.json b/packages/extensionmanager/package.json\nindex 92e3659b879b..682a55a301fd 100644\n--- a/packages/extensionmanager/package.json\n+++ b/packages/extensionmanager/package.json\n@@ -54,7 +54,7 @@\n     \"@types/semver\": \"^7.3.3\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/filebrowser-extension/package.json b/packages/filebrowser-extension/package.json\nindex be2d78ae5386..e057cb092a77 100644\n--- a/packages/filebrowser-extension/package.json\n+++ b/packages/filebrowser-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/filebrowser/package.json b/packages/filebrowser/package.json\nindex b9f5fa33fd4c..90fdc41415cb 100644\n--- a/packages/filebrowser/package.json\n+++ b/packages/filebrowser/package.json\n@@ -67,7 +67,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/fileeditor-extension/package.json b/packages/fileeditor-extension/package.json\nindex 2dc1dca9f763..c3f6fbf6a019 100644\n--- a/packages/fileeditor-extension/package.json\n+++ b/packages/fileeditor-extension/package.json\n@@ -68,7 +68,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/fileeditor/package.json b/packages/fileeditor/package.json\nindex c8a4eae901ce..47b1e39da85b 100644\n--- a/packages/fileeditor/package.json\n+++ b/packages/fileeditor/package.json\n@@ -63,7 +63,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/help-extension/package.json b/packages/help-extension/package.json\nindex 17d0940ebbb6..ac725a93571f 100644\n--- a/packages/help-extension/package.json\n+++ b/packages/help-extension/package.json\n@@ -52,7 +52,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/htmlviewer-extension/package.json b/packages/htmlviewer-extension/package.json\nindex 42524c1c1fa0..bcbb0c5b2543 100644\n--- a/packages/htmlviewer-extension/package.json\n+++ b/packages/htmlviewer-extension/package.json\n@@ -46,7 +46,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/htmlviewer/package.json b/packages/htmlviewer/package.json\nindex cb97e1f8e2fc..cce9c3c44cfe 100644\n--- a/packages/htmlviewer/package.json\n+++ b/packages/htmlviewer/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/hub-extension/package.json b/packages/hub-extension/package.json\nindex a0b81cb919e2..a9a8547f4781 100644\n--- a/packages/hub-extension/package.json\n+++ b/packages/hub-extension/package.json\n@@ -49,7 +49,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/imageviewer-extension/package.json b/packages/imageviewer-extension/package.json\nindex b770076567f2..c5383bb54b95 100644\n--- a/packages/imageviewer-extension/package.json\n+++ b/packages/imageviewer-extension/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/imageviewer/package.json b/packages/imageviewer/package.json\nindex 0f70c7e00b86..81194cdd3edb 100644\n--- a/packages/imageviewer/package.json\n+++ b/packages/imageviewer/package.json\n@@ -53,7 +53,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/inspector-extension/package.json b/packages/inspector-extension/package.json\nindex 270865c6a609..82bde93f0405 100644\n--- a/packages/inspector-extension/package.json\n+++ b/packages/inspector-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/inspector/package.json b/packages/inspector/package.json\nindex 998f59da7299..c1469af2360b 100644\n--- a/packages/inspector/package.json\n+++ b/packages/inspector/package.json\n@@ -59,7 +59,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/javascript-extension/package.json b/packages/javascript-extension/package.json\nindex 83628f51fc8a..18578c1ab091 100644\n--- a/packages/javascript-extension/package.json\n+++ b/packages/javascript-extension/package.json\n@@ -37,7 +37,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/json-extension/package.json b/packages/json-extension/package.json\nindex 7fbad6b01a27..2140bf22e721 100644\n--- a/packages/json-extension/package.json\n+++ b/packages/json-extension/package.json\n@@ -52,7 +52,7 @@\n     \"@types/react-dom\": \"^18.0.9\",\n     \"@types/react-highlight-words\": \"^0.16.4\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/launcher-extension/package.json b/packages/launcher-extension/package.json\nindex cc1b3aa2dc3a..121e0240960f 100644\n--- a/packages/launcher-extension/package.json\n+++ b/packages/launcher-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/launcher/package.json b/packages/launcher/package.json\nindex 0911d8d1bfe8..b682bf519a7d 100644\n--- a/packages/launcher/package.json\n+++ b/packages/launcher/package.json\n@@ -50,7 +50,7 @@\n   \"devDependencies\": {\n     \"@types/react\": \"^18.0.26\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/logconsole-extension/package.json b/packages/logconsole-extension/package.json\nindex 76c339f5eb79..0ae43c067e16 100644\n--- a/packages/logconsole-extension/package.json\n+++ b/packages/logconsole-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/logconsole/package.json b/packages/logconsole/package.json\nindex 30a0f161a3b6..69a2635ea214 100644\n--- a/packages/logconsole/package.json\n+++ b/packages/logconsole/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/lsp-extension/package.json b/packages/lsp-extension/package.json\nindex 8e2285c3cea4..25b01e5426d6 100644\n--- a/packages/lsp-extension/package.json\n+++ b/packages/lsp-extension/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/lsp/package.json b/packages/lsp/package.json\nindex f448e314dd2e..6121affc570b 100644\n--- a/packages/lsp/package.json\n+++ b/packages/lsp/package.json\n@@ -64,7 +64,7 @@\n     \"jest\": \"^29.2.0\",\n     \"json-schema-to-typescript\": \"^8.0.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mainmenu-extension/package.json b/packages/mainmenu-extension/package.json\nindex 428237f619a6..323580c14967 100644\n--- a/packages/mainmenu-extension/package.json\n+++ b/packages/mainmenu-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mainmenu/package.json b/packages/mainmenu/package.json\nindex 262c9a7075a8..8c35b88abee1 100644\n--- a/packages/mainmenu/package.json\n+++ b/packages/mainmenu/package.json\n@@ -54,7 +54,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markdownviewer-extension/package.json b/packages/markdownviewer-extension/package.json\nindex 6c128f39c217..8eda5e9d4493 100644\n--- a/packages/markdownviewer-extension/package.json\n+++ b/packages/markdownviewer-extension/package.json\n@@ -48,7 +48,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markdownviewer/package.json b/packages/markdownviewer/package.json\nindex 34cf1d1675dd..b688f1d54210 100644\n--- a/packages/markdownviewer/package.json\n+++ b/packages/markdownviewer/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markedparser-extension/package.json b/packages/markedparser-extension/package.json\nindex d51e5bcda6e1..665739f3d312 100644\n--- a/packages/markedparser-extension/package.json\n+++ b/packages/markedparser-extension/package.json\n@@ -49,7 +49,7 @@\n     \"@types/d3\": \"^7.4.0\",\n     \"@types/dompurify\": \"^2.4.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mathjax-extension/package.json b/packages/mathjax-extension/package.json\nindex 6df550e6a1e2..60bdbf8b316e 100644\n--- a/packages/mathjax-extension/package.json\n+++ b/packages/mathjax-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mermaid-extension/package.json b/packages/mermaid-extension/package.json\nindex 327c91fbf122..590fb583850a 100644\n--- a/packages/mermaid-extension/package.json\n+++ b/packages/mermaid-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mermaid/package.json b/packages/mermaid/package.json\nindex 87c3fef2e9f2..da4b8bce5dcd 100644\n--- a/packages/mermaid/package.json\n+++ b/packages/mermaid/package.json\n@@ -53,7 +53,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metadataform-extension/package.json b/packages/metadataform-extension/package.json\nindex 8e9419affc4e..d00a48909ce4 100644\n--- a/packages/metadataform-extension/package.json\n+++ b/packages/metadataform-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metadataform/package.json b/packages/metadataform/package.json\nindex ab59c2c5b573..deed511b0aa3 100644\n--- a/packages/metadataform/package.json\n+++ b/packages/metadataform/package.json\n@@ -65,7 +65,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metapackage/package.json b/packages/metapackage/package.json\nindex a83f51ac0429..7a7b13a7c958 100644\n--- a/packages/metapackage/package.json\n+++ b/packages/metapackage/package.json\n@@ -141,7 +141,7 @@\n     \"jest\": \"^29.2.0\",\n     \"json-to-html\": \"~0.1.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/nbformat/package.json b/packages/nbformat/package.json\nindex 53dce750927e..88bbd07f7670 100644\n--- a/packages/nbformat/package.json\n+++ b/packages/nbformat/package.json\n@@ -44,7 +44,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/notebook-extension/package.json b/packages/notebook-extension/package.json\nindex 7f0ca0df05a4..65495b5a5733 100644\n--- a/packages/notebook-extension/package.json\n+++ b/packages/notebook-extension/package.json\n@@ -78,7 +78,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/notebook/package.json b/packages/notebook/package.json\nindex 72ef2a9da262..0785705f0efc 100644\n--- a/packages/notebook/package.json\n+++ b/packages/notebook/package.json\n@@ -76,7 +76,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/observables/package.json b/packages/observables/package.json\nindex fcbbb9ac9127..ffb0e7932426 100644\n--- a/packages/observables/package.json\n+++ b/packages/observables/package.json\n@@ -47,7 +47,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/outputarea/package.json b/packages/outputarea/package.json\nindex cdec46334455..3edeac986c04 100644\n--- a/packages/outputarea/package.json\n+++ b/packages/outputarea/package.json\n@@ -61,7 +61,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pdf-extension/package.json b/packages/pdf-extension/package.json\nindex 159a17608eca..0df4b8489fe2 100644\n--- a/packages/pdf-extension/package.json\n+++ b/packages/pdf-extension/package.json\n@@ -43,7 +43,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pluginmanager-extension/package.json b/packages/pluginmanager-extension/package.json\nindex 2ca8e67aaeb0..6c658efe9574 100644\n--- a/packages/pluginmanager-extension/package.json\n+++ b/packages/pluginmanager-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pluginmanager/package.json b/packages/pluginmanager/package.json\nindex 16c8506e9c32..ea8d10270018 100644\n--- a/packages/pluginmanager/package.json\n+++ b/packages/pluginmanager/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/property-inspector/package.json b/packages/property-inspector/package.json\nindex 2a1feffe5d5e..e4bc9941391b 100644\n--- a/packages/property-inspector/package.json\n+++ b/packages/property-inspector/package.json\n@@ -46,7 +46,7 @@\n   \"devDependencies\": {\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime-extension/package.json b/packages/rendermime-extension/package.json\nindex f5d1f5008a9d..ca594a434b8b 100644\n--- a/packages/rendermime-extension/package.json\n+++ b/packages/rendermime-extension/package.json\n@@ -41,7 +41,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime-interfaces/package.json b/packages/rendermime-interfaces/package.json\nindex 7d4e6071271d..b5b70b550e28 100644\n--- a/packages/rendermime-interfaces/package.json\n+++ b/packages/rendermime-interfaces/package.json\n@@ -35,7 +35,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime/package.json b/packages/rendermime/package.json\nindex 7e4933441ece..da514d6e811e 100644\n--- a/packages/rendermime/package.json\n+++ b/packages/rendermime/package.json\n@@ -61,7 +61,7 @@\n     \"fs-extra\": \"^10.1.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/running-extension/package.json b/packages/running-extension/package.json\nindex b08aec290c28..c897d5496086 100644\n--- a/packages/running-extension/package.json\n+++ b/packages/running-extension/package.json\n@@ -56,7 +56,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/running/package.json b/packages/running/package.json\nindex ffa79f7b8a33..3d4428524844 100644\n--- a/packages/running/package.json\n+++ b/packages/running/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/services/examples/browser/package.json b/packages/services/examples/browser/package.json\nindex e9c3c17d11f8..82986f6b390b 100644\n--- a/packages/services/examples/browser/package.json\n+++ b/packages/services/examples/browser/package.json\n@@ -16,7 +16,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/packages/services/examples/typescript-browser-with-output/package.json b/packages/services/examples/typescript-browser-with-output/package.json\nindex 29454b68a5f4..b5f865f1fc30 100644\n--- a/packages/services/examples/typescript-browser-with-output/package.json\n+++ b/packages/services/examples/typescript-browser-with-output/package.json\n@@ -25,7 +25,7 @@\n     \"css-loader\": \"^6.7.1\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   },\n\ndiff --git a/packages/services/package.json b/packages/services/package.json\nindex 6391d1451bb8..ad93f5b0b3e5 100644\n--- a/packages/services/package.json\n+++ b/packages/services/package.json\n@@ -63,7 +63,7 @@\n     \"@types/ws\": \"^8.5.3\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\",\n+    \"typescript\": \"~5.4.5\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   },\n\ndiff --git a/packages/settingeditor-extension/package.json b/packages/settingeditor-extension/package.json\nindex 0784c94c24c9..029ae23f1833 100644\n--- a/packages/settingeditor-extension/package.json\n+++ b/packages/settingeditor-extension/package.json\n@@ -52,7 +52,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/settingeditor/package.json b/packages/settingeditor/package.json\nindex 0eee0b4bff28..7c8480a3f212 100644\n--- a/packages/settingeditor/package.json\n+++ b/packages/settingeditor/package.json\n@@ -73,7 +73,7 @@\n     \"react-test-renderer\": \"^18.2.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"ts-jest\": \"^29.1.0\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/settingregistry/package.json b/packages/settingregistry/package.json\nindex 971a39513bb9..dbd2432fc5f6 100644\n--- a/packages/settingregistry/package.json\n+++ b/packages/settingregistry/package.json\n@@ -51,7 +51,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"peerDependencies\": {\n     \"react\": \">=16\"\n\ndiff --git a/packages/shortcuts-extension/package.json b/packages/shortcuts-extension/package.json\nindex 1ccffd7cf4ed..4acd5f7a70ae 100644\n--- a/packages/shortcuts-extension/package.json\n+++ b/packages/shortcuts-extension/package.json\n@@ -58,7 +58,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statedb/package.json b/packages/statedb/package.json\nindex 7c5edab36398..5d6d2190294c 100644\n--- a/packages/statedb/package.json\n+++ b/packages/statedb/package.json\n@@ -46,7 +46,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statusbar-extension/package.json b/packages/statusbar-extension/package.json\nindex 87cf18c0affd..f4f114a14c79 100644\n--- a/packages/statusbar-extension/package.json\n+++ b/packages/statusbar-extension/package.json\n@@ -46,7 +46,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"@types/react-dom\": \"^18.0.9\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statusbar/package.json b/packages/statusbar/package.json\nindex 848991e457fd..06963d32a3d1 100644\n--- a/packages/statusbar/package.json\n+++ b/packages/statusbar/package.json\n@@ -50,7 +50,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/terminal-extension/package.json b/packages/terminal-extension/package.json\nindex a0672681b903..583046d93a85 100644\n--- a/packages/terminal-extension/package.json\n+++ b/packages/terminal-extension/package.json\n@@ -52,7 +52,7 @@\n   \"devDependencies\": {\n     \"@types/webpack-env\": \"^1.18.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/terminal/package.json b/packages/terminal/package.json\nindex 97890cd0f40f..cd9c87f74f31 100644\n--- a/packages/terminal/package.json\n+++ b/packages/terminal/package.json\n@@ -60,7 +60,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/theme-dark-extension/package.json b/packages/theme-dark-extension/package.json\nindex 998e1b923877..19f9c6e8cbb3 100644\n--- a/packages/theme-dark-extension/package.json\n+++ b/packages/theme-dark-extension/package.json\n@@ -38,7 +38,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/theme-dark-high-contrast-extension/package.json b/packages/theme-dark-high-contrast-extension/package.json\nindex 142ac50b4282..5bd08714e8b1 100644\n--- a/packages/theme-dark-high-contrast-extension/package.json\n+++ b/packages/theme-dark-high-contrast-extension/package.json\n@@ -38,7 +38,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/theme-light-extension/package.json b/packages/theme-light-extension/package.json\nindex b5b9062dea39..9eb9ff350586 100644\n--- a/packages/theme-light-extension/package.json\n+++ b/packages/theme-light-extension/package.json\n@@ -38,7 +38,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n",
    "test_patch": "diff --git a/packages/testing/package.json b/packages/testing/package.json\nindex ae59d97f8f99..4b4c32cd87a2 100644\n--- a/packages/testing/package.json\n+++ b/packages/testing/package.json\n@@ -51,7 +51,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/node\": \"^20.11.27\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.2.2\"\n+    \"typescript\": \"~5.4.5\"\n   },\n   \"peerDependencies\": {\n     \"typescript\": \">=4.3\"\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17244",
    "pr_id": 17244,
    "issue_id": 17212,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`GroupItem` React functional component should allow (and filter out) `null` children\n## Description\n\n`GroupItem` causes issues when we want to conditionally hide some parts of status bar, see\n\nhttps://github.com/jupyterlab/jupyterlab/pull/16846#discussion_r1925888221\n\nBecause it requires children to be an array of `JSX.Element`:\n\nhttps://github.com/jupyterlab/jupyterlab/blob/8fbbec937d30b6d87f8ced1259886c2e3a2c8641/packages/statusbar/src/components/group.tsx#L46\n\nbut it really should accept any `ReactNode` and just filter out `null`s in:\n\nhttps://github.com/jupyterlab/jupyterlab/blob/8fbbec937d30b6d87f8ced1259886c2e3a2c8641/packages/statusbar/src/components/group.tsx#L9-L27\n\n\nOnce this is done we should remove any use of `<div></div>` which was a workaround.",
    "issue_word_count": 94,
    "test_files_count": 12,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "docs/source/extension/extension_migration.rst",
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "packages/apputils/src/runningSessions.tsx",
      "packages/statusbar/src/components/group.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png"
    ],
    "base_commit": "2a1e7e531b5ad272df760b3c25e9dd6bace468b8",
    "head_commit": "eea6b4f4746d926c850238f978a34a082bd8d7ae",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17244",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17244",
    "dockerfile": "",
    "pr_merged_at": "2025-02-13T13:43:59.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17243",
    "pr_id": 17243,
    "issue_id": 17142,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fixing dialog closing unexpectedly when typing in the textarea\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\nFixes #14511 \r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\nI've added test in my first commit as told by @krassowski in discussions of this issue. This test is failing which is the expected behaviour for now:\r\n\r\n```bash\r\n â— @jupyterlab/apputils â€º Dialog â€º #handleEvent() â€º keydown â€º should not accept on enter key within textarea\r\n\r\n    expect(received).toBe(expected) // Object.is equality\r\n\r\n    Expected: true\r\n    Received: false\r\n\r\n      213 |           }\r\n      214 |   \r\n    > 215 |           expect(dialog.isVisible).toBe(true);\r\n          |                                    ^\r\n      216 |   \r\n      217 |           simulate(dialog.node, 'keydown', { key: 'Enter', keyCode: 13 });\r\n      218 |   \r\n\r\n      at Object.<anonymous> (test/dialog.spec.tsx:215:36)\r\n\r\n\r\n RUNS  test/sessioncontext.spec.ts\r\n```\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\n",
    "issue_word_count": 208,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/apputils/src/dialog.tsx",
      "packages/apputils/test/dialog.spec.tsx"
    ],
    "pr_changed_test_files": [
      "packages/apputils/test/dialog.spec.tsx"
    ],
    "base_commit": "92c0e2d7a7d2469b1cd55a3731033157acab9859",
    "head_commit": "f34d738680ec973fea0fd1c4a82b3c2fc772aa05",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17243",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17243",
    "dockerfile": "",
    "pr_merged_at": "2025-01-30T13:21:04.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17240",
    "pr_id": 17240,
    "issue_id": 17238,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix windowing crash due to out-of-bounds access\n\r\n\r\n## References\r\n\r\nAlleviates #17227\r\n\r\n## Code changes\r\n\r\nCheck if cell is available before accessing it's model for size estimation.\r\n\r\n## User-facing changes\r\n\r\nNo crash\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 27,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/windowing.ts",
      "packages/notebook/test/modelfactory.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/modelfactory.spec.ts"
    ],
    "base_commit": "fc34de7b52b3a155db1b19759fa625eba54a06a8",
    "head_commit": "155ddf7d6532dad87b0ab9043dc673bda7daf86e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17240",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17240",
    "dockerfile": "",
    "pr_merged_at": "2025-01-29T15:40:12.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17239",
    "pr_id": 17239,
    "issue_id": 16767,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Changing selected file in file browser is slow\n## Description\r\n\r\nIt can take a couple of seconds to select a file low in the listing, without a mouse, by using <kbd>Down</kbd> in folders with hundreds of files\r\n\r\n## Reproduce\r\n\r\n1. Open JupyterLab node_modules director\r\n2. Select a folder in the the filebrowser\r\n3. Press arrow down for 3 seconds\r\n4. See the delay in the render state\r\n\r\n![image](https://github.com/user-attachments/assets/31c6a0fb-227f-4d99-861d-3a2cf39394fc)\r\n\r\nZoomed in:\r\n\r\n![image](https://github.com/user-attachments/assets/bf5c5c8a-2ffe-4d52-8b5e-84b0fd81c220)\r\n\r\n## Expected behavior\r\n\r\nNo delay.\r\n\r\nBasically we should only refresh two items (the one unselected + the one selected), not the entire listing.\r\n\r\nIn case of multi-selection we should re-render the changed items only as well.\r\n\r\n## Context\r\n\r\n- Browser and version: Chrome and Firefox\r\n- JupyterLab version: 4.3.0b1\r\n",
    "issue_word_count": 133,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/test/listing.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/listing.spec.ts"
    ],
    "base_commit": "7d153eee614ee1c8c0b2ac642448fbd7143f9283",
    "head_commit": "18a4bf0aeffdcc4a5838494b0cf0bff0c297a87a",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17239",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17239",
    "dockerfile": "",
    "pr_merged_at": "2025-02-05T16:27:12.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17238",
    "pr_id": 17238,
    "issue_id": 17227,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Disappearing notebook due to uncaught exception in estimateWidgetSize\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\n\nBefore creating a new issue:\n* Search for relevant issues\n* Follow the issue reporting guidelines:\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\n-->\n\n## Description\n\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\nNotebook goes \"blank\" (can't see any of the cells anymore) suddenly when typing into a cell.\nIt happens because this.widgetCount in getEstimatedTotalSize() is greater than the length of this.cells in this.estimateWidgetSize which ends up throwing a \"TypeError: this.cells[e] is undefined\" error.\n\n![Image](https://github.com/user-attachments/assets/8312678d-1480-41f6-946d-760eb3076fa0)\n\n![Image](https://github.com/user-attachments/assets/7e81be9d-1b3c-4d08-be91-8654340c0dc8)\n\n![Image](https://github.com/user-attachments/assets/81735233-885a-41c1-ae0a-6af75df905e8)\n\n![Image](https://github.com/user-attachments/assets/4397897b-b70b-4105-ae8c-4021dcb7c73a)\n\n## Reproduce\n\n<!--Describe step-by-step instructions to reproduce the behavior-->\n\nI have a really hard time reproducing this but I'm somewhat able to in our private JupyterHub instance. Things that I tried that I think might be triggering the described problem is having a lower desktop resolution (I would test at like 1080p with scale above 100%), RTC turned on and having more than one user connected to the same notebook and cells that take up a lot of space (lots of lines). With all of that I can somewhat reproduce it often on our end. When the rendering breaks for one user it'll also break for the other user(s).\n\nThis happens with \"Windowing Mode\" set to \"full\". When set to \"defer\" or \"none\" it'll scroll back to the first cell at the top at position 0.\n\n<!--Describe how you diagnosed the issue. See the guidelines at\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\n\n## Expected behavior\n\n<!--Describe what you expected to happen-->\nFor the rendering not to randomly break when working in a notebook.\n\n## Context\n\n<!--Complete the following for context, and add any other relevant context-->\n\n- Operating System and version: Windows 11 <!-- e.g. Linux Ubuntu 21.04 -->\n- Browser and version: Firefox 128.6.0 or Chrome 132 <!-- e.g. Chrome 92 -->\n- JupyterLab version: 4.3.4 <!-- e.g. 3.1.7 -->\n\n",
    "issue_word_count": 371,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/windowing.ts",
      "packages/notebook/test/modelfactory.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/modelfactory.spec.ts"
    ],
    "base_commit": "e602b9fd69e826e3c763670d985b1f4795ba5309",
    "head_commit": "4722ed8541350767efd36fd2b31a358acab3c461",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17238",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17238",
    "dockerfile": "",
    "pr_merged_at": "2025-01-29T14:56:29.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17226",
    "pr_id": 17226,
    "issue_id": 17156,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix emission of `lastCell` from notebook run actions\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\nNone\r\n\r\n## Code changes\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\n\r\nMinor bugfix resolving issue in actions with accessing last notebook's cell. This PR e.g. enables NotebookActions.selectionExecuted to properly return the information about last cell.\r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\nNone\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\n",
    "issue_word_count": 149,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/actions.tsx",
      "packages/notebook/test/actions.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/actions.spec.ts"
    ],
    "base_commit": "dfcf532c0733364045badc76b2f5e0404044ef43",
    "head_commit": "d94127d6d3dc8036b3586e7953f4408d44ed1a44",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17226",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17226",
    "dockerfile": "",
    "pr_merged_at": "2025-01-27T19:11:24.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17221",
    "pr_id": 17221,
    "issue_id": 14947,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Flaky UI tests\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nThe `Visual Regression Tests` and `Visual Regression Documentation` CI checks are often flaky, which makes the CI checks appear as failing.\r\n\r\n## Reproduce\r\n\r\nExample run for https://github.com/jupyterlab/jupyterlab/pull/14944: https://github.com/jupyterlab/jupyterlab/actions/runs/5817952284/job/15773457526?pr=14944\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/591645/e59cfdf5-0345-4786-a953-2dd5f14c79e4)\r\n\r\n## Expected behavior\r\n\r\nThe check should not fail that often, so maintainers can review and merge PRs with more confidence.\r\n\r\n## Context\r\n\r\nFlaky tests lead to maintenance burden and CI fatigue on maintainers. One has to download the Playwright repo and carefully check the errors to assess whether the failure is related to the change.\r\n\r\nAlso other maintainers might not feel confident merging PRs if one of the checks is failing (which is understandable).",
    "issue_word_count": 167,
    "test_files_count": 2,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "galata/test/documentation/debugger.test.ts",
      "galata/test/jupyterlab/windowed-notebook.test.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/debugger.test.ts",
      "galata/test/jupyterlab/windowed-notebook.test.ts"
    ],
    "base_commit": "c8a53da7b114f58a915a68182aa4172d6aa30262",
    "head_commit": "a544b638f0f46c2a16e1ac3aafd0467b0556ec42",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17221",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17221",
    "dockerfile": "",
    "pr_merged_at": "2025-01-29T07:47:18.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17219",
    "pr_id": 17219,
    "issue_id": 17171,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Update mock packages to not use `jupyter_packaging`\nCurrently some of the mock packages used in the `usage` tests on CI depend on `jupyter_packaging`: https://github.com/jupyterlab/jupyterlab/tree/main/jupyterlab/tests/mock_packages\n\nFor example:\n\nhttps://github.com/jupyterlab/jupyterlab/blob/87cb79fe29c623f1e2f3d00e8d0d51c656ef12d4/jupyterlab/tests/mock_packages/test-hyphens/setup.py#L21\n\nHowever `jupyter_packaging` is not maintained anymore, in favor of https://github.com/jupyterlab/hatch-jupyter-builder.\n\nSo it would be great to update these mock packages to `hatch-jupyter-builder`.",
    "issue_word_count": 73,
    "test_files_count": 6,
    "non_test_files_count": 1,
    "pr_changed_files": [
      ".gitignore",
      "jupyterlab/tests/mock_packages/test-hyphens-underscore/pyproject.toml",
      "jupyterlab/tests/mock_packages/test-hyphens-underscore/setup.py",
      "jupyterlab/tests/mock_packages/test-hyphens/pyproject.toml",
      "jupyterlab/tests/mock_packages/test-hyphens/setup.py",
      "jupyterlab/tests/mock_packages/test_no_hyphens/pyproject.toml",
      "jupyterlab/tests/mock_packages/test_no_hyphens/setup.py"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/mock_packages/test-hyphens-underscore/pyproject.toml",
      "jupyterlab/tests/mock_packages/test-hyphens-underscore/setup.py",
      "jupyterlab/tests/mock_packages/test-hyphens/pyproject.toml",
      "jupyterlab/tests/mock_packages/test-hyphens/setup.py",
      "jupyterlab/tests/mock_packages/test_no_hyphens/pyproject.toml",
      "jupyterlab/tests/mock_packages/test_no_hyphens/setup.py"
    ],
    "base_commit": "2f674b04bf33c46da561aa5b74dbc92aed2777c7",
    "head_commit": "9c504713bac4ff8e42be3bf491bf986153b9ba6a",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17219",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17219",
    "dockerfile": "",
    "pr_merged_at": "2025-02-14T13:16:27.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17214",
    "pr_id": 17214,
    "issue_id": 17206,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Disabling fuzzy filtering in file browser does not work\n## Description\n\nDisabling fuzzy filtering in the file browser does not work.\n\n## Reproduce\n\n<!--Describe step-by-step instructions to reproduce the behavior-->\n\n1. Create files named \"test\" and \"tst\"\n2. Filter for \"tst\"\n3. See both are shown (ok)\n4. Open Settings Editor, go to File Browser\n5. Unclick \"Filter on file name with a fuzzy search\"\n6. Filter again\n7. See both are still shown\n\n![Image](https://github.com/user-attachments/assets/3b0382d7-f90f-4474-9809-e75a6890a8e5)\n\nThe value is hardcoded here: https://github.com/jupyterlab/jupyterlab/blob/1f6f64bbd56bc9363315114a4fe0f642252ef464/packages/filebrowser/src/browser.ts#L106\n\n## Expected behavior\n\nOnly tst shows up.\n\n## Context\n\n- Browser and version: Chrome\n- JupyterLab version: 4.3.x and 4.4.0a2",
    "issue_word_count": 115,
    "test_files_count": 1,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "galata/test/jupyterlab/settings.test.ts",
      "packages/filebrowser-extension/src/index.ts",
      "packages/filebrowser/src/browser.ts",
      "packages/filebrowser/src/model.ts",
      "packages/ui-components/src/components/search.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/settings.test.ts"
    ],
    "base_commit": "c8a53da7b114f58a915a68182aa4172d6aa30262",
    "head_commit": "66e7d7f81ba0af70ff27fa6c2180fe2aefc0570d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17214",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17214",
    "dockerfile": "",
    "pr_merged_at": "2025-01-28T15:14:35.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17210",
    "pr_id": 17210,
    "issue_id": 17176,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Browser tab's name doesn't get updated if Lab is opened in simple mode\n## Description\n\nIf JupyterLab is opened using `/doc` URL (i.e. in simple mode) the tab name does not update when switching between documents. It looks like this is more reliably reproducible if there is a workspace redirection happening.\n\nThis does not happen if JupyterLab is opened in normal mode with `/lab` and then switched to simple mode.\n\n## Reproduce\n\n1. Create an `A.ipynb` and `B.ipynb`\n2. Open http://127.0.0.1:8888/doc/tree/A.ipynb\n3. Switch between notebooks\n4. See browser title does **not** update\n\nhttps://github.com/user-attachments/assets/777474c1-c416-4ccd-ab72-eedab11b4e95\n\n## Expected behavior\n\nIt works the same way as it works:\n\nIn normal mode:\n\n6. Open http://127.0.0.1:8888/lab/tree/A.ipynb\n7. Switch between notebooks\n8. See browser title does update\n\nIn simple mode if lab was loaded with normal mode:\n\n9. Open http://127.0.0.1:8888/lab/tree/A.ipynb\n10. Switch mode to simple\n11. Switch between notebooks\n12. See browser title does update\n\nhttps://github.com/user-attachments/assets/6398ca82-aea3-4cea-9c40-203b2d0e8a15\n\n\n## Context\n\n- Browser and version: Chrome\n- JupyterLab version: 4.3.4, 4.4.0a2\n",
    "issue_word_count": 196,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/general.test.ts",
      "packages/application/src/layoutrestorer.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/general.test.ts"
    ],
    "base_commit": "ea23ac60be1ae91b0feb4a773bf46857b76f1bb0",
    "head_commit": "05b656f92e7a227540a5f2a31f85212775f6c23b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17210",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17210",
    "dockerfile": "",
    "pr_merged_at": "2025-04-22T12:22:18.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17207",
    "pr_id": 17207,
    "issue_id": 16174,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Update to TypeScript 5.8\nThe last update was for TypeScript 5.1, done in https://github.com/jupyterlab/jupyterlab/pull/14638.\r\n\r\nIt would be great to look into updating to the latest version to not lag behind for too long.\r\n\r\nIn https://github.com/jupyterlab/jupyterlab/pull/14638#issuecomment-1803584472 @fcollonval said:\r\n\r\n> but bumping to 5.2 or later will have some effects as we will need to change the ts configuration.\r\n\r\nLooks like this refers to the \"module and moduleResolution Must Match Under Recent Node.js settings\" section mentioned in https://devblogs.microsoft.com/typescript/announcing-typescript-5-2/#breaking-changes-and-correctness-fixes ?",
    "issue_word_count": 106,
    "test_files_count": 1,
    "non_test_files_count": 99,
    "pr_changed_files": [
      "builder/package.json",
      "buildutils/package.json",
      "buildutils/template/package.json",
      "buildutils/tsconfig.json",
      "docs/source/extension/extension_migration.rst",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "galata/extension/package.json",
      "galata/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/attachments/package.json",
      "packages/cell-toolbar-extension/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/celltags-extension/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console/package.json",
      "packages/coreutils/package.json",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer/package.json",
      "packages/debugger-extension/package.json",
      "packages/debugger/package.json",
      "packages/docmanager-extension/package.json",
      "packages/docmanager/package.json",
      "packages/docregistry/package.json",
      "packages/documentsearch-extension/package.json",
      "packages/documentsearch/package.json",
      "packages/extensionmanager-extension/package.json",
      "packages/extensionmanager/package.json",
      "packages/filebrowser-extension/package.json",
      "packages/filebrowser/package.json",
      "packages/fileeditor-extension/package.json",
      "packages/fileeditor/package.json",
      "packages/help-extension/package.json",
      "packages/htmlviewer-extension/package.json",
      "packages/htmlviewer/package.json",
      "packages/hub-extension/package.json",
      "packages/imageviewer-extension/package.json",
      "packages/imageviewer/package.json",
      "packages/inspector-extension/package.json",
      "packages/inspector/package.json",
      "packages/javascript-extension/package.json",
      "packages/json-extension/package.json",
      "packages/launcher-extension/package.json",
      "packages/launcher/package.json",
      "packages/logconsole-extension/package.json",
      "packages/logconsole/package.json",
      "packages/lsp-extension/package.json",
      "packages/lsp/package.json",
      "packages/mainmenu-extension/package.json",
      "packages/mainmenu/package.json",
      "packages/markdownviewer-extension/package.json",
      "packages/markdownviewer/package.json",
      "packages/markedparser-extension/package.json",
      "packages/mathjax-extension/package.json",
      "packages/mermaid-extension/package.json",
      "packages/mermaid/package.json",
      "packages/metadataform-extension/package.json",
      "packages/metadataform/package.json",
      "packages/metapackage/package.json",
      "packages/nbformat/package.json",
      "packages/notebook-extension/package.json",
      "packages/notebook/package.json",
      "packages/observables/package.json",
      "packages/outputarea/package.json",
      "packages/pdf-extension/package.json",
      "packages/pluginmanager-extension/package.json",
      "packages/pluginmanager/package.json",
      "packages/property-inspector/package.json",
      "packages/rendermime-extension/package.json",
      "packages/rendermime-interfaces/package.json",
      "packages/rendermime/package.json",
      "packages/running-extension/package.json",
      "packages/running/package.json",
      "packages/services/examples/browser/package.json",
      "packages/services/examples/typescript-browser-with-output/package.json",
      "packages/services/package.json",
      "packages/settingeditor-extension/package.json",
      "packages/settingeditor/package.json",
      "packages/settingregistry/package.json",
      "packages/shortcuts-extension/package.json",
      "packages/statedb/package.json",
      "packages/statusbar-extension/package.json",
      "packages/statusbar/package.json",
      "packages/terminal-extension/package.json",
      "packages/terminal/package.json",
      "packages/testing/package.json",
      "packages/theme-dark-extension/package.json",
      "packages/theme-dark-high-contrast-extension/package.json"
    ],
    "pr_changed_test_files": [
      "packages/testing/package.json"
    ],
    "base_commit": "b1702268170973df1c54ac9ff77b249060972485",
    "head_commit": "52d3215688e5fd29acc1bc86a460ba07bd8f2a3c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17207",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17207",
    "dockerfile": "",
    "pr_merged_at": "2025-02-06T07:13:08.000Z",
    "patch": "diff --git a/builder/package.json b/builder/package.json\nindex 25ee09542d74..20f7a7a0b798 100644\n--- a/builder/package.json\n+++ b/builder/package.json\n@@ -71,7 +71,7 @@\n     \"@types/node\": \"^20.11.27\",\n     \"@types/supports-color\": \"^5.3.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/buildutils/package.json b/buildutils/package.json\nindex 58c5f89dfc5e..f34f21493bad 100644\n--- a/buildutils/package.json\n+++ b/buildutils/package.json\n@@ -57,7 +57,7 @@\n     \"process\": \"^0.11.10\",\n     \"semver\": \"^7.3.2\",\n     \"sort-package-json\": \"~1.53.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"verdaccio\": \"^5.25.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/buildutils/template/package.json b/buildutils/template/package.json\nindex 937e89c50453..87cdd8c84242 100644\n--- a/buildutils/template/package.json\n+++ b/buildutils/template/package.json\n@@ -40,7 +40,7 @@\n     \"@jupyterlab/testing\": \"^4.4.0-alpha.3\",\n     \"@types/jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/buildutils/tsconfig.json b/buildutils/tsconfig.json\nindex 7095bede4bd5..8c5bff0d45d8 100644\n--- a/buildutils/tsconfig.json\n+++ b/buildutils/tsconfig.json\n@@ -3,7 +3,7 @@\n   \"compilerOptions\": {\n     \"outDir\": \"lib\",\n     \"rootDir\": \"src\",\n-    \"module\": \"commonjs\",\n+    \"module\": \"Node16\",\n     \"moduleResolution\": \"node16\"\n   },\n   \"include\": [\"src/*\"],\n\ndiff --git a/docs/source/extension/extension_migration.rst b/docs/source/extension/extension_migration.rst\nindex 3391fbe7b596..c2e56914bd6b 100644\n--- a/docs/source/extension/extension_migration.rst\n+++ b/docs/source/extension/extension_migration.rst\n@@ -43,6 +43,27 @@ The **icons in use** are in the ``ui-components/style/icons/debugger`` folder, w\n    * - ``import { viewBreakpointIcon } from '@jupyterlab/debugger/lib/icons';``\n      - ``import { viewBreakpointIcon } from '@jupyterlab/ui-components';``\n \n+TypeScript update\n+^^^^^^^^^^^^^^^^^\n+\n+As a follow-up to the update to TypeScript 5.2, the ``tsconfig.json`` configuration of the ``@jupyterlab/buildutils`` package changed\n+the ``module`` option from ``commonjs`` to ``Node16``:\n+\n+.. code:: diff\n+\n+   index 7095bede4bd5..8c5bff0d45d8 100644\n+   --- a/buildutils/tsconfig.json\n+   +++ b/buildutils/tsconfig.json\n+   @@ -3,7 +3,7 @@\n+     \"compilerOptions\": {\n+       \"outDir\": \"lib\",\n+       \"rootDir\": \"src\",\n+   -   \"module\": \"commonjs\",\n+   +   \"module\": \"Node16\",\n+       \"moduleResolution\": \"node16\"\n+     },\n+     \"include\": [\"src/*\"],\n+\n JupyterLab 4.2 to 4.3\n ---------------------\n \n\ndiff --git a/examples/cell/package.json b/examples/cell/package.json\nindex 518775996ff1..4d0d21587f91 100644\n--- a/examples/cell/package.json\n+++ b/examples/cell/package.json\n@@ -28,7 +28,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/console/package.json b/examples/console/package.json\nindex 81965e589721..1640de34b5f9 100644\n--- a/examples/console/package.json\n+++ b/examples/console/package.json\n@@ -25,7 +25,7 @@\n     \"mini-css-extract-plugin\": \"^2.7.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/filebrowser/package.json b/examples/filebrowser/package.json\nindex 256398fa2c80..1da290c4a09c 100644\n--- a/examples/filebrowser/package.json\n+++ b/examples/filebrowser/package.json\n@@ -29,7 +29,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/notebook/package.json b/examples/notebook/package.json\nindex e766a8825ae5..e2aed253cb23 100644\n--- a/examples/notebook/package.json\n+++ b/examples/notebook/package.json\n@@ -34,7 +34,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/examples/terminal/package.json b/examples/terminal/package.json\nindex f045822bfae2..fc858cf84da4 100644\n--- a/examples/terminal/package.json\n+++ b/examples/terminal/package.json\n@@ -21,7 +21,7 @@\n     \"mini-svg-data-uri\": \"^1.4.4\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/galata/extension/package.json b/galata/extension/package.json\nindex ae79f77539b4..fcd40966131d 100644\n--- a/galata/extension/package.json\n+++ b/galata/extension/package.json\n@@ -47,7 +47,7 @@\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.4.0-alpha.3\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"jupyterlab\": {\n     \"extension\": true,\n\ndiff --git a/galata/package.json b/galata/package.json\nindex d0f943ed0a72..1c54285ea778 100644\n--- a/galata/package.json\n+++ b/galata/package.json\n@@ -66,7 +66,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/application-extension/package.json b/packages/application-extension/package.json\nindex f67a4689769c..8c9435a33eba 100644\n--- a/packages/application-extension/package.json\n+++ b/packages/application-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/application/package.json b/packages/application/package.json\nindex f55e08723981..6d499e4fb2b0 100644\n--- a/packages/application/package.json\n+++ b/packages/application/package.json\n@@ -67,7 +67,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/apputils-extension/package.json b/packages/apputils-extension/package.json\nindex 630d3d421002..47f76afc82c6 100644\n--- a/packages/apputils-extension/package.json\n+++ b/packages/apputils-extension/package.json\n@@ -63,7 +63,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/apputils/package.json b/packages/apputils/package.json\nindex 867bd17ce575..56f1eba9b251 100644\n--- a/packages/apputils/package.json\n+++ b/packages/apputils/package.json\n@@ -72,7 +72,7 @@\n     \"@types/sanitize-html\": \"^2.11.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/attachments/package.json b/packages/attachments/package.json\nindex c1426e6e00ea..5c436ea48ad6 100644\n--- a/packages/attachments/package.json\n+++ b/packages/attachments/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cell-toolbar-extension/package.json b/packages/cell-toolbar-extension/package.json\nindex e6be4363736b..f889398819b6 100644\n--- a/packages/cell-toolbar-extension/package.json\n+++ b/packages/cell-toolbar-extension/package.json\n@@ -42,7 +42,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cell-toolbar/package.json b/packages/cell-toolbar/package.json\nindex 2f0788b7e000..a2c2fde96a3d 100644\n--- a/packages/cell-toolbar/package.json\n+++ b/packages/cell-toolbar/package.json\n@@ -58,7 +58,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/cells/package.json b/packages/cells/package.json\nindex 4579a5574358..66deeb27274e 100644\n--- a/packages/cells/package.json\n+++ b/packages/cells/package.json\n@@ -77,7 +77,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/celltags-extension/package.json b/packages/celltags-extension/package.json\nindex 4cd730d94a9f..27518adc0501 100644\n--- a/packages/celltags-extension/package.json\n+++ b/packages/celltags-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codeeditor/package.json b/packages/codeeditor/package.json\nindex e44abe921dfb..2749fa498a86 100644\n--- a/packages/codeeditor/package.json\n+++ b/packages/codeeditor/package.json\n@@ -63,7 +63,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codemirror-extension/package.json b/packages/codemirror-extension/package.json\nindex 0f54a0006f75..c976c3d48c4b 100644\n--- a/packages/codemirror-extension/package.json\n+++ b/packages/codemirror-extension/package.json\n@@ -60,7 +60,7 @@\n   \"devDependencies\": {\n     \"@types/react\": \"^18.0.26\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/codemirror/package.json b/packages/codemirror/package.json\nindex 15ee059e6e56..0262d8a3d603 100644\n--- a/packages/codemirror/package.json\n+++ b/packages/codemirror/package.json\n@@ -79,7 +79,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/completer-extension/package.json b/packages/completer-extension/package.json\nindex 4bf66683ea34..b9c60382f857 100644\n--- a/packages/completer-extension/package.json\n+++ b/packages/completer-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/completer/package.json b/packages/completer/package.json\nindex 239cf92b495b..f51cac46fb1a 100644\n--- a/packages/completer/package.json\n+++ b/packages/completer/package.json\n@@ -71,7 +71,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/console-extension/package.json b/packages/console-extension/package.json\nindex 31dcf292e610..851e27604cbe 100644\n--- a/packages/console-extension/package.json\n+++ b/packages/console-extension/package.json\n@@ -57,7 +57,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/console/package.json b/packages/console/package.json\nindex 744a40b9332d..1b97868f47aa 100644\n--- a/packages/console/package.json\n+++ b/packages/console/package.json\n@@ -66,7 +66,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/coreutils/package.json b/packages/coreutils/package.json\nindex 0b5342963b5e..e7bfef6d7dd6 100644\n--- a/packages/coreutils/package.json\n+++ b/packages/coreutils/package.json\n@@ -57,7 +57,7 @@\n     \"jest-junit\": \"^15.0.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"ts-jest\": \"^29.1.0\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/csvviewer-extension/package.json b/packages/csvviewer-extension/package.json\nindex add067725041..28d24da077db 100644\n--- a/packages/csvviewer-extension/package.json\n+++ b/packages/csvviewer-extension/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/csvviewer/package.json b/packages/csvviewer/package.json\nindex 780726b8e2f0..e66ce710a1e0 100644\n--- a/packages/csvviewer/package.json\n+++ b/packages/csvviewer/package.json\n@@ -59,7 +59,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/debugger-extension/package.json b/packages/debugger-extension/package.json\nindex 94d408e14962..d5bf5f20179d 100644\n--- a/packages/debugger-extension/package.json\n+++ b/packages/debugger-extension/package.json\n@@ -65,7 +65,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/react-dom\": \"^18.0.9\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex 740ca0ca92ec..789a31e0f086 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -84,7 +84,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docmanager-extension/package.json b/packages/docmanager-extension/package.json\nindex a82c405feac5..a09aff6d9df6 100644\n--- a/packages/docmanager-extension/package.json\n+++ b/packages/docmanager-extension/package.json\n@@ -58,7 +58,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docmanager/package.json b/packages/docmanager/package.json\nindex 168a42444847..391eb88b89b3 100644\n--- a/packages/docmanager/package.json\n+++ b/packages/docmanager/package.json\n@@ -64,7 +64,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/docregistry/package.json b/packages/docregistry/package.json\nindex 5dd6d09ad440..7c22fbf2bf8e 100644\n--- a/packages/docregistry/package.json\n+++ b/packages/docregistry/package.json\n@@ -65,7 +65,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/documentsearch-extension/package.json b/packages/documentsearch-extension/package.json\nindex f06402a007a0..00614eb65352 100644\n--- a/packages/documentsearch-extension/package.json\n+++ b/packages/documentsearch-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/documentsearch/package.json b/packages/documentsearch/package.json\nindex 3f361644c406..2aa057f1352f 100644\n--- a/packages/documentsearch/package.json\n+++ b/packages/documentsearch/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/extensionmanager-extension/package.json b/packages/extensionmanager-extension/package.json\nindex 9144aba7ddb0..e9c67d6b5059 100644\n--- a/packages/extensionmanager-extension/package.json\n+++ b/packages/extensionmanager-extension/package.json\n@@ -47,7 +47,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/extensionmanager/package.json b/packages/extensionmanager/package.json\nindex 8afddae259ca..92e3659b879b 100644\n--- a/packages/extensionmanager/package.json\n+++ b/packages/extensionmanager/package.json\n@@ -54,7 +54,7 @@\n     \"@types/semver\": \"^7.3.3\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/filebrowser-extension/package.json b/packages/filebrowser-extension/package.json\nindex b50ec6f3233f..be2d78ae5386 100644\n--- a/packages/filebrowser-extension/package.json\n+++ b/packages/filebrowser-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/filebrowser/package.json b/packages/filebrowser/package.json\nindex 97ebb1a69e24..b9f5fa33fd4c 100644\n--- a/packages/filebrowser/package.json\n+++ b/packages/filebrowser/package.json\n@@ -67,7 +67,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/fileeditor-extension/package.json b/packages/fileeditor-extension/package.json\nindex 7943a0191592..2dc1dca9f763 100644\n--- a/packages/fileeditor-extension/package.json\n+++ b/packages/fileeditor-extension/package.json\n@@ -68,7 +68,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/fileeditor/package.json b/packages/fileeditor/package.json\nindex 64e067ce3faf..c8a4eae901ce 100644\n--- a/packages/fileeditor/package.json\n+++ b/packages/fileeditor/package.json\n@@ -63,7 +63,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/help-extension/package.json b/packages/help-extension/package.json\nindex 80357c5956e1..17d0940ebbb6 100644\n--- a/packages/help-extension/package.json\n+++ b/packages/help-extension/package.json\n@@ -52,7 +52,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/htmlviewer-extension/package.json b/packages/htmlviewer-extension/package.json\nindex d3d71616ca72..42524c1c1fa0 100644\n--- a/packages/htmlviewer-extension/package.json\n+++ b/packages/htmlviewer-extension/package.json\n@@ -46,7 +46,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/htmlviewer/package.json b/packages/htmlviewer/package.json\nindex af49619fb0df..cb97e1f8e2fc 100644\n--- a/packages/htmlviewer/package.json\n+++ b/packages/htmlviewer/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/hub-extension/package.json b/packages/hub-extension/package.json\nindex a77401fda097..a0b81cb919e2 100644\n--- a/packages/hub-extension/package.json\n+++ b/packages/hub-extension/package.json\n@@ -49,7 +49,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/imageviewer-extension/package.json b/packages/imageviewer-extension/package.json\nindex 5e4fba975a97..b770076567f2 100644\n--- a/packages/imageviewer-extension/package.json\n+++ b/packages/imageviewer-extension/package.json\n@@ -45,7 +45,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/imageviewer/package.json b/packages/imageviewer/package.json\nindex b2b32cb99d01..0f70c7e00b86 100644\n--- a/packages/imageviewer/package.json\n+++ b/packages/imageviewer/package.json\n@@ -53,7 +53,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/inspector-extension/package.json b/packages/inspector-extension/package.json\nindex 582ee9178e82..270865c6a609 100644\n--- a/packages/inspector-extension/package.json\n+++ b/packages/inspector-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/inspector/package.json b/packages/inspector/package.json\nindex 6568d1a638a9..998f59da7299 100644\n--- a/packages/inspector/package.json\n+++ b/packages/inspector/package.json\n@@ -59,7 +59,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/javascript-extension/package.json b/packages/javascript-extension/package.json\nindex 6702b72d23b1..83628f51fc8a 100644\n--- a/packages/javascript-extension/package.json\n+++ b/packages/javascript-extension/package.json\n@@ -37,7 +37,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/json-extension/package.json b/packages/json-extension/package.json\nindex 88adf3eaa519..7fbad6b01a27 100644\n--- a/packages/json-extension/package.json\n+++ b/packages/json-extension/package.json\n@@ -52,7 +52,7 @@\n     \"@types/react-dom\": \"^18.0.9\",\n     \"@types/react-highlight-words\": \"^0.16.4\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/launcher-extension/package.json b/packages/launcher-extension/package.json\nindex cdea0e7df0f9..cc1b3aa2dc3a 100644\n--- a/packages/launcher-extension/package.json\n+++ b/packages/launcher-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/launcher/package.json b/packages/launcher/package.json\nindex b448ce059e65..0911d8d1bfe8 100644\n--- a/packages/launcher/package.json\n+++ b/packages/launcher/package.json\n@@ -50,7 +50,7 @@\n   \"devDependencies\": {\n     \"@types/react\": \"^18.0.26\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/logconsole-extension/package.json b/packages/logconsole-extension/package.json\nindex 2aa65dc6a653..76c339f5eb79 100644\n--- a/packages/logconsole-extension/package.json\n+++ b/packages/logconsole-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/logconsole/package.json b/packages/logconsole/package.json\nindex ebdbb9537d62..30a0f161a3b6 100644\n--- a/packages/logconsole/package.json\n+++ b/packages/logconsole/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/lsp-extension/package.json b/packages/lsp-extension/package.json\nindex 0522bf811204..8e2285c3cea4 100644\n--- a/packages/lsp-extension/package.json\n+++ b/packages/lsp-extension/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/lsp/package.json b/packages/lsp/package.json\nindex 323d80d8521d..f448e314dd2e 100644\n--- a/packages/lsp/package.json\n+++ b/packages/lsp/package.json\n@@ -64,7 +64,7 @@\n     \"jest\": \"^29.2.0\",\n     \"json-schema-to-typescript\": \"^8.0.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mainmenu-extension/package.json b/packages/mainmenu-extension/package.json\nindex 22e4781c13a7..428237f619a6 100644\n--- a/packages/mainmenu-extension/package.json\n+++ b/packages/mainmenu-extension/package.json\n@@ -55,7 +55,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mainmenu/package.json b/packages/mainmenu/package.json\nindex 84ace7b09036..262c9a7075a8 100644\n--- a/packages/mainmenu/package.json\n+++ b/packages/mainmenu/package.json\n@@ -54,7 +54,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markdownviewer-extension/package.json b/packages/markdownviewer-extension/package.json\nindex 1eea37e8974c..6c128f39c217 100644\n--- a/packages/markdownviewer-extension/package.json\n+++ b/packages/markdownviewer-extension/package.json\n@@ -48,7 +48,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markdownviewer/package.json b/packages/markdownviewer/package.json\nindex 798860fd64e6..34cf1d1675dd 100644\n--- a/packages/markdownviewer/package.json\n+++ b/packages/markdownviewer/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/markedparser-extension/package.json b/packages/markedparser-extension/package.json\nindex 97239edcec6d..d51e5bcda6e1 100644\n--- a/packages/markedparser-extension/package.json\n+++ b/packages/markedparser-extension/package.json\n@@ -49,7 +49,7 @@\n     \"@types/d3\": \"^7.4.0\",\n     \"@types/dompurify\": \"^2.4.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mathjax-extension/package.json b/packages/mathjax-extension/package.json\nindex 49a21e5304d0..6df550e6a1e2 100644\n--- a/packages/mathjax-extension/package.json\n+++ b/packages/mathjax-extension/package.json\n@@ -50,7 +50,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mermaid-extension/package.json b/packages/mermaid-extension/package.json\nindex b02ae97debd5..327c91fbf122 100644\n--- a/packages/mermaid-extension/package.json\n+++ b/packages/mermaid-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/mermaid/package.json b/packages/mermaid/package.json\nindex 348dc4d3d08c..87c3fef2e9f2 100644\n--- a/packages/mermaid/package.json\n+++ b/packages/mermaid/package.json\n@@ -53,7 +53,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metadataform-extension/package.json b/packages/metadataform-extension/package.json\nindex fdc8779abcee..8e9419affc4e 100644\n--- a/packages/metadataform-extension/package.json\n+++ b/packages/metadataform-extension/package.json\n@@ -49,7 +49,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metadataform/package.json b/packages/metadataform/package.json\nindex 96504f301a94..ab59c2c5b573 100644\n--- a/packages/metadataform/package.json\n+++ b/packages/metadataform/package.json\n@@ -65,7 +65,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/metapackage/package.json b/packages/metapackage/package.json\nindex 2d56d920cae1..a83f51ac0429 100644\n--- a/packages/metapackage/package.json\n+++ b/packages/metapackage/package.json\n@@ -141,7 +141,7 @@\n     \"jest\": \"^29.2.0\",\n     \"json-to-html\": \"~0.1.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/nbformat/package.json b/packages/nbformat/package.json\nindex 9a0c78f2be3a..53dce750927e 100644\n--- a/packages/nbformat/package.json\n+++ b/packages/nbformat/package.json\n@@ -44,7 +44,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/notebook-extension/package.json b/packages/notebook-extension/package.json\nindex c89c2307c05d..7f0ca0df05a4 100644\n--- a/packages/notebook-extension/package.json\n+++ b/packages/notebook-extension/package.json\n@@ -78,7 +78,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/notebook/package.json b/packages/notebook/package.json\nindex 17d79a3ca9ab..72ef2a9da262 100644\n--- a/packages/notebook/package.json\n+++ b/packages/notebook/package.json\n@@ -76,7 +76,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/observables/package.json b/packages/observables/package.json\nindex a6a90c5d810d..fcbbb9ac9127 100644\n--- a/packages/observables/package.json\n+++ b/packages/observables/package.json\n@@ -47,7 +47,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/outputarea/package.json b/packages/outputarea/package.json\nindex 5834b5465b38..cdec46334455 100644\n--- a/packages/outputarea/package.json\n+++ b/packages/outputarea/package.json\n@@ -61,7 +61,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pdf-extension/package.json b/packages/pdf-extension/package.json\nindex 9c368ebd4767..159a17608eca 100644\n--- a/packages/pdf-extension/package.json\n+++ b/packages/pdf-extension/package.json\n@@ -43,7 +43,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pluginmanager-extension/package.json b/packages/pluginmanager-extension/package.json\nindex 98d06b3763ba..2ca8e67aaeb0 100644\n--- a/packages/pluginmanager-extension/package.json\n+++ b/packages/pluginmanager-extension/package.json\n@@ -44,7 +44,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/pluginmanager/package.json b/packages/pluginmanager/package.json\nindex abac309b613e..16c8506e9c32 100644\n--- a/packages/pluginmanager/package.json\n+++ b/packages/pluginmanager/package.json\n@@ -55,7 +55,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/property-inspector/package.json b/packages/property-inspector/package.json\nindex 19284dc3c20a..2a1feffe5d5e 100644\n--- a/packages/property-inspector/package.json\n+++ b/packages/property-inspector/package.json\n@@ -46,7 +46,7 @@\n   \"devDependencies\": {\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime-extension/package.json b/packages/rendermime-extension/package.json\nindex 0e82852167e1..f5d1f5008a9d 100644\n--- a/packages/rendermime-extension/package.json\n+++ b/packages/rendermime-extension/package.json\n@@ -41,7 +41,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime-interfaces/package.json b/packages/rendermime-interfaces/package.json\nindex 7e50b8c0f7c3..7d4e6071271d 100644\n--- a/packages/rendermime-interfaces/package.json\n+++ b/packages/rendermime-interfaces/package.json\n@@ -35,7 +35,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/rendermime/package.json b/packages/rendermime/package.json\nindex a39776344aff..7e4933441ece 100644\n--- a/packages/rendermime/package.json\n+++ b/packages/rendermime/package.json\n@@ -61,7 +61,7 @@\n     \"fs-extra\": \"^10.1.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/running-extension/package.json b/packages/running-extension/package.json\nindex 427c47f5f633..b08aec290c28 100644\n--- a/packages/running-extension/package.json\n+++ b/packages/running-extension/package.json\n@@ -56,7 +56,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/running/package.json b/packages/running/package.json\nindex 309b5860086c..ffa79f7b8a33 100644\n--- a/packages/running/package.json\n+++ b/packages/running/package.json\n@@ -51,7 +51,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/services/examples/browser/package.json b/packages/services/examples/browser/package.json\nindex 8f21ff4fef69..e9c3c17d11f8 100644\n--- a/packages/services/examples/browser/package.json\n+++ b/packages/services/examples/browser/package.json\n@@ -16,7 +16,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   }\n\ndiff --git a/packages/services/examples/typescript-browser-with-output/package.json b/packages/services/examples/typescript-browser-with-output/package.json\nindex 1754463bf8ab..29454b68a5f4 100644\n--- a/packages/services/examples/typescript-browser-with-output/package.json\n+++ b/packages/services/examples/typescript-browser-with-output/package.json\n@@ -25,7 +25,7 @@\n     \"css-loader\": \"^6.7.1\",\n     \"rimraf\": \"~5.0.5\",\n     \"style-loader\": \"~3.3.1\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   },\n\ndiff --git a/packages/services/package.json b/packages/services/package.json\nindex 8aa6f9675a85..6391d1451bb8 100644\n--- a/packages/services/package.json\n+++ b/packages/services/package.json\n@@ -63,7 +63,7 @@\n     \"@types/ws\": \"^8.5.3\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\",\n+    \"typescript\": \"~5.2.2\",\n     \"webpack\": \"^5.76.1\",\n     \"webpack-cli\": \"^5.0.1\"\n   },\n\ndiff --git a/packages/settingeditor-extension/package.json b/packages/settingeditor-extension/package.json\nindex c9afe7a6f8e8..0784c94c24c9 100644\n--- a/packages/settingeditor-extension/package.json\n+++ b/packages/settingeditor-extension/package.json\n@@ -52,7 +52,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/settingeditor/package.json b/packages/settingeditor/package.json\nindex 24627a68e771..0eee0b4bff28 100644\n--- a/packages/settingeditor/package.json\n+++ b/packages/settingeditor/package.json\n@@ -73,7 +73,7 @@\n     \"react-test-renderer\": \"^18.2.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"ts-jest\": \"^29.1.0\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/settingregistry/package.json b/packages/settingregistry/package.json\nindex cfea3f5997f5..971a39513bb9 100644\n--- a/packages/settingregistry/package.json\n+++ b/packages/settingregistry/package.json\n@@ -51,7 +51,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"peerDependencies\": {\n     \"react\": \">=16\"\n\ndiff --git a/packages/shortcuts-extension/package.json b/packages/shortcuts-extension/package.json\nindex 9251c973443e..1ccffd7cf4ed 100644\n--- a/packages/shortcuts-extension/package.json\n+++ b/packages/shortcuts-extension/package.json\n@@ -58,7 +58,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statedb/package.json b/packages/statedb/package.json\nindex 4cb1429616fe..7c5edab36398 100644\n--- a/packages/statedb/package.json\n+++ b/packages/statedb/package.json\n@@ -46,7 +46,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statusbar-extension/package.json b/packages/statusbar-extension/package.json\nindex 90bcdc064745..87cf18c0affd 100644\n--- a/packages/statusbar-extension/package.json\n+++ b/packages/statusbar-extension/package.json\n@@ -46,7 +46,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"@types/react-dom\": \"^18.0.9\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/statusbar/package.json b/packages/statusbar/package.json\nindex 145f4a19174f..848991e457fd 100644\n--- a/packages/statusbar/package.json\n+++ b/packages/statusbar/package.json\n@@ -50,7 +50,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/terminal-extension/package.json b/packages/terminal-extension/package.json\nindex 7a4c3cc17383..a0672681b903 100644\n--- a/packages/terminal-extension/package.json\n+++ b/packages/terminal-extension/package.json\n@@ -52,7 +52,7 @@\n   \"devDependencies\": {\n     \"@types/webpack-env\": \"^1.18.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/terminal/package.json b/packages/terminal/package.json\nindex 528e97c1d322..97890cd0f40f 100644\n--- a/packages/terminal/package.json\n+++ b/packages/terminal/package.json\n@@ -60,7 +60,7 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/theme-dark-extension/package.json b/packages/theme-dark-extension/package.json\nindex 889d3bfff32f..998e1b923877 100644\n--- a/packages/theme-dark-extension/package.json\n+++ b/packages/theme-dark-extension/package.json\n@@ -38,7 +38,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n\ndiff --git a/packages/theme-dark-high-contrast-extension/package.json b/packages/theme-dark-high-contrast-extension/package.json\nindex 071fdf01a056..142ac50b4282 100644\n--- a/packages/theme-dark-high-contrast-extension/package.json\n+++ b/packages/theme-dark-high-contrast-extension/package.json\n@@ -38,7 +38,7 @@\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"publishConfig\": {\n     \"access\": \"public\"\n",
    "test_patch": "diff --git a/packages/testing/package.json b/packages/testing/package.json\nindex bdc698a35915..ae59d97f8f99 100644\n--- a/packages/testing/package.json\n+++ b/packages/testing/package.json\n@@ -51,7 +51,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/node\": \"^20.11.27\",\n     \"rimraf\": \"~5.0.5\",\n-    \"typescript\": \"~5.1.6\"\n+    \"typescript\": \"~5.2.2\"\n   },\n   \"peerDependencies\": {\n     \"typescript\": \">=4.3\"\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17196",
    "pr_id": 17196,
    "issue_id": 17195,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix \"running\" prompt state with server-side execution\n## References\r\n\r\n- Follow up to https://github.com/jupyterlab/jupyterlab/pull/16651\r\n\r\n## Code changes\r\n\r\n- [x] Adds a test demonstrating an issue where the `execution_count` being reset incorrectly overrode the execution state, resulting in no `[*]` prompt in the interface but instead only `[ ]`\r\n- [x] Fixes the issue by not changing `execution_count` when provided with the value of `null`\r\n\r\n## User-facing changes\r\n\r\n`[*]` shows up correctly when using server-side exeuction\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 70,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/cells/src/widget.ts",
      "packages/cells/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/cells/test/widget.spec.ts"
    ],
    "base_commit": "81735b19d48bfc28c375648bf2d4fbbd0c2c3b68",
    "head_commit": "5a9de2fa82ca34c9517ae0c7b6bfa1496a462326",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17196",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17196",
    "dockerfile": "",
    "pr_merged_at": "2025-01-20T16:58:55.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17194",
    "pr_id": 17194,
    "issue_id": 17164,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Cannot remove cell metadata\n## Description\r\n\r\nOnce the Cell metadata is modified with new attributes, it becomes impossible to remove any added attribute.\r\n\r\n## Reproduce\r\n\r\n1. In a notebook, create a Markdown cell\r\n2. While this cell is selected, open the Property Inspector\r\n3. Expand the Advanced Tools pane\r\n4. Under Cell metadata, between `{}`, enter something like `\"lang\": \"en\"`\r\n5. Click the check mark button.\r\n6. Delete everything between `{}`. Click again the check mark button\r\n7. Collapse the Advanced Tools pane\r\n8. Expand the Advanced Tools pane\r\n\r\nThe attribute `\"lang\": \"en\"` is back.\r\n\r\n9. Expand the Common Tools pane\r\n\r\nThe Cell metadata is now filled with the defaults of the Common Tools.\r\n\r\n10. Delete everything again. Click again the check mark button\r\n11. Collapse and Expand the Advanced Tools pane\r\n\r\nAll deleted attributes are back.\r\n\r\n## Expected behavior\r\n\r\nWhen valid metadata are saved through the Advanced Tools, nothing should overwrite what is saved by the check mark button. In the above examples, when all metadata are deleted, it should remain deleted.\r\n\r\n## Context\r\n\r\n- Operating System and version: Windows 11 Pro, version 24H2\r\n- Browser and version: Firefox 134.0\r\n- JupyterLab version: 4.3.4\r\n",
    "issue_word_count": 185,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/metadataform.test.ts",
      "packages/notebook-extension/src/tool-widgets/metadataEditorFields.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/metadataform.test.ts"
    ],
    "base_commit": "2ea5151b2137a55ccd9995acef3b87305f43f8fb",
    "head_commit": "ae846ed838a8458e31f3405d2a3bead5dd1b0d86",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17194",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17194",
    "dockerfile": "",
    "pr_merged_at": "2025-02-22T16:47:43.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17187",
    "pr_id": 17187,
    "issue_id": 17175,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "The svg(+) next to add tag is misaligned\n\n## Description\nMisaligned svg of the add tag\n\n## Reproduce\n\n1. select a cell\n2. go to property inspector\n3. the svg next to add is misalinged\n\n![Image](https://github.com/user-attachments/assets/98e1d60e-c3e3-4c82-8215-ffc268ce68a1)\n\n## Expected behavior\n\n![Image](https://github.com/user-attachments/assets/442b357f-32e9-46dd-b3ee-941edb325cb2)",
    "issue_word_count": 51,
    "test_files_count": 5,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-right-common-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/celltags-extension/src/celltag.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-right-common-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json"
    ],
    "base_commit": "2a1e7e531b5ad272df760b3c25e9dd6bace468b8",
    "head_commit": "4ebaf43cea92fc976ecd20f3243d321a13204ee0",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17187",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17187",
    "dockerfile": "",
    "pr_merged_at": "2025-02-13T14:46:25.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17173",
    "pr_id": 17173,
    "issue_id": 14255,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Code colors have insufficient contrast\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nSome colors used to render code in both Light and Dark Theme don't have enough contrast vs background (should be 7:1)\r\n\r\n![contrast](https://user-images.githubusercontent.com/93281816/226788366-585d2a2d-c205-4d60-8820-75093d9f8374.png)\r\n\r\nThis was found during a bug bash by @andrii-i .\r\n",
    "issue_word_count": 85,
    "test_files_count": 4,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/html-viewer.test.ts",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png",
      "packages/theme-dark-extension/style/variables.css",
      "packages/theme-light-extension/style/variables.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/html-viewer.test.ts",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png"
    ],
    "base_commit": "c8a53da7b114f58a915a68182aa4172d6aa30262",
    "head_commit": "87ec64d83c46c0f00ef1a7c9eacb3af824e9ce49",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17173",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17173",
    "dockerfile": "",
    "pr_merged_at": "2025-01-27T19:13:21.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17167",
    "pr_id": 17167,
    "issue_id": 15514,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Read-only cells become editable when changing notebook settings programatically\n## Description\r\n\r\nRead-only cells become editable when changing notebook settings programatically. This approach is used to change `autoStartDefaultKernel` in core JupyterLab by clicking \"Always start the preferred kernel\" checkbox. Changing settings manually does not lead to this problem.\r\n\r\nThis was originally reported for [jupyterlab-execute-time](https://github.com/deshaw/jupyterlab-execute-time/issues/107) which changes `recordTiming` programatically.\r\n\r\n## Reproduce\r\n\r\n1. Open a notebook, select a cell\r\n2. Open property inspector, switch cell to \"Read-Only\"\r\n3. Click on kernel selector\r\n4. Check \"Always start the preferred kernel\" in the dialog\r\n5. Accept\r\n6. See that the cell can be edited despite the metadata still forbidding it\r\n\r\n![breaks-read-only](https://github.com/jupyterlab/jupyterlab/assets/5832902/9f18ba88-e067-439c-a4b1-e3d08df8a1c6)\r\n\r\n## Expected behavior\r\n\r\nCells stay read-only when notebook settings are changed programatically.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.0.9 and 4.1.0a4\r\n\r\n<details>\r\n\r\n<summary>Stack trace</summary>\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/9eb7603e-d0d0-4a0f-8e50-ea80082a8770)\r\n\r\n</details>",
    "issue_word_count": 163,
    "test_files_count": 1,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "galata/test/jupyterlab/settings.test.ts",
      "packages/cells/src/widget.ts",
      "packages/codeeditor/src/editor.ts",
      "packages/codemirror/src/editor.ts",
      "packages/codemirror/src/extension.ts",
      "packages/codemirror/src/token.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/settings.test.ts"
    ],
    "base_commit": "8fbbec937d30b6d87f8ced1259886c2e3a2c8641",
    "head_commit": "db0e7e4dca3bef278b5abb3d41528868034ec13f",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17167",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17167",
    "dockerfile": "",
    "pr_merged_at": "2025-01-23T15:02:46.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17160",
    "pr_id": 17160,
    "issue_id": 17068,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Search highlight is not applied for matches on Python builtin keywords\n## Description\r\n\r\nSimilar to https://github.com/jupyterlab/jupyterlab/pull/17065 but down to higher specificity of\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/6e1174e202b6bf5a7b725d59b5ddafc5f0afbed2/packages/codemirror/src/theme.ts#L86-L88\r\n\r\nadded in https://github.com/jupyterlab/jupyterlab/pull/15805\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Type `from x import y`\r\n2. Change theme to light/dark/high contrast dark\r\n3. Search for `\"m\"\r\n4. See poor contrast due to green not being replaced by search highlight color\r\n\r\n## Expected behavior\r\n\r\nSyntax highlighting is overwritten correctly\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.3.2",
    "issue_word_count": 95,
    "test_files_count": 7,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/file-search.test.ts",
      "galata/test/jupyterlab/file-search.test.ts-snapshots/search-results-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-in-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/highlight-visible-under-selection-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-two-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png",
      "packages/codemirror/src/theme.ts",
      "packages/codemirror/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/file-search.test.ts",
      "galata/test/jupyterlab/file-search.test.ts-snapshots/search-results-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-in-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/highlight-visible-under-selection-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-two-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png"
    ],
    "base_commit": "b93e83488cb610d0803ade14f2cf091369100a90",
    "head_commit": "fc920bdc2c64702cf08c8afe8848fec584f040ad",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17160",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17160",
    "dockerfile": "",
    "pr_merged_at": "2025-02-14T21:39:55.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17142",
    "pr_id": 17142,
    "issue_id": 14511,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Dialog closes unexpectedly when typing in the textarea\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nI'm working on a JupyterLab extension where I need to create a Dialog containing a `textarea` and several `input` boxes. I have implemented a custom class that `extends ReactWidget and implements Dialog.IBodyWidget<ReactWidget>`. I pass an instance of this class as the body parameter to the `showDialog` function. The dialog mechanism is functioning correctly, but I'm encountering an issue with the `textarea`. Whenever I click inside the `textarea`, type some text, and press \"enter\", it automatically closes the dialog as if I had pressed the \"ok\" button. I suspect this issue is related to event listeners.\r\n\r\n## Reproduce\r\n\r\n1. Create a new dialog class (I used: `extends ReactWidget and implements Dialog.IBodyWidget<ReactWidget>`).\r\n2. In the `render(): JSX.Element` method add some `textarea`.\r\n3. Try to add text into the `textarea` and then press \"enter\".\r\n\r\n## Expected behavior\r\n\r\nIt should just add a new line instead of closing the dialog.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Linux 5.14.21\r\n- Browser and version: Chrome 112\r\n- JupyterLab version: 3.6.3\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\n$PATH:\r\n        /opt/conda/envs/jupyterlab-ext/bin\r\n        /opt/conda/condabin\r\n        /opt/conda/bin\r\n        /usr/local/sbin\r\n        /usr/local/bin\r\n        /usr/sbin\r\n        /usr/bin\r\n        /sbin\r\n        /bin\r\n\r\nsys.path:\r\n        /opt/conda/envs/jupyterlab-ext/bin\r\n        /opt/conda/envs/jupyterlab-ext/lib/python311.zip\r\n        /opt/conda/envs/jupyterlab-ext/lib/python3.11\r\n        /opt/conda/envs/jupyterlab-ext/lib/python3.11/lib-dynload\r\n        /opt/conda/envs/jupyterlab-ext/lib/python3.11/site-packages\r\n        /tmp/myextension\r\n\r\nsys.executable:\r\n        /opt/conda/envs/jupyterlab-ext/bin/python\r\n\r\nsys.version:\r\n        3.11.3 | packaged by conda-forge | (main, Apr  6 2023, 08:57:19) [GCC 11.3.0]\r\n\r\nplatform.platform():\r\n        Linux-5.14.21-150400.24.46-default-x86_64-with-glibc2.35\r\n\r\nwhich -a jupyter:\r\n        /opt/conda/envs/jupyterlab-ext/bin/jupyter\r\n        /opt/conda/bin/jupyter\r\n\r\npip list:\r\n        Package                       Version     Editable project location\r\n        ----------------------------- ----------- -------------------------\r\n        anyio                         3.6.2\r\n        argon2-cffi                   21.3.0\r\n        argon2-cffi-bindings          21.2.0\r\n        arrow                         1.2.3\r\n        asttokens                     2.2.1\r\n        attrs                         22.2.0\r\n        Babel                         2.12.1\r\n        backcall                      0.2.0\r\n        backports.functools-lru-cache 1.6.4\r\n        beautifulsoup4                4.12.2\r\n        binaryornot                   0.4.4\r\n        bleach                        6.0.0\r\n        boto3                         1.26.116\r\n        botocore                      1.29.118\r\n        brotlipy                      0.7.0\r\n        certifi                       2022.12.7\r\n        cffi                          1.15.1\r\n        chardet                       5.1.0\r\n        charset-normalizer            3.1.0\r\n        click                         8.1.3\r\n        comm                          0.1.3\r\n        cookiecutter                  2.1.1\r\n        cryptography                  40.0.2\r\n        debugpy                       1.6.7\r\n        decorator                     5.1.1\r\n        defusedxml                    0.7.1\r\n        deprecation                   2.1.0\r\n        entrypoints                   0.4\r\n        executing                     1.2.0\r\n        fastjsonschema                2.16.3\r\n        flit_core                     3.8.0\r\n        fqdn                          1.5.1\r\n        idna                          3.4\r\n        importlib-metadata            6.6.0\r\n        importlib-resources           5.12.0\r\n        ipykernel                     6.22.0\r\n        ipython                       8.13.1\r\n        ipython-genutils              0.2.0\r\n        isoduration                   20.11.0\r\n        jedi                          0.18.2\r\n        Jinja2                        3.1.2\r\n        jinja2-time                   0.2.0\r\n        jmespath                      1.0.1\r\n        json5                         0.9.5\r\n        jsonpointer                   2.3\r\n        jsonschema                    4.17.3\r\n        jupyter_client                8.2.0\r\n        jupyter_core                  5.3.0\r\n        jupyter-events                0.6.3\r\n        jupyter_packaging             0.12.3\r\n        jupyter_server                2.5.0\r\n        jupyter_server_terminals      0.4.4\r\n        jupyterlab                    3.5.3\r\n        jupyterlab-pygments           0.2.2\r\n        jupyterlab_server             2.22.1\r\n        MarkupSafe                    2.1.2\r\n        matplotlib-inline             0.1.6\r\n        mistune                       2.0.5\r\n        myextension                   0.1.0       /tmp/myextension\r\n        nbclassic                     0.5.6\r\n        nbclient                      0.7.4\r\n        nbconvert                     7.3.1\r\n        nbformat                      5.8.0\r\n        nest-asyncio                  1.5.6\r\n        notebook                      6.5.4\r\n        notebook_shim                 0.2.3\r\n        packaging                     23.1\r\n        pandocfilters                 1.5.0\r\n        parso                         0.8.3\r\n        pexpect                       4.8.0\r\n        pickleshare                   0.7.5\r\n        pip                           23.1.2\r\n        pkgutil_resolve_name          1.3.10\r\n        platformdirs                  3.5.0\r\n        prometheus-client             0.16.0\r\n        prompt-toolkit                3.0.38\r\n        psutil                        5.9.5\r\n        ptyprocess                    0.7.0\r\n        pure-eval                     0.2.2\r\n        pycparser                     2.21\r\n        Pygments                      2.15.1\r\n        pyOpenSSL                     23.1.1\r\n        pyrsistent                    0.19.3\r\n        PySocks                       1.7.1\r\n        python-dateutil               2.8.2\r\n        python-json-logger            2.0.7\r\n        python-slugify                8.0.1\r\n        pytz                          2023.3\r\n        PyYAML                        6.0\r\n        pyzmq                         25.0.2\r\n        requests                      2.29.0\r\n        requests-futures              1.0.0\r\n        rfc3339-validator             0.1.4\r\n        rfc3986-validator             0.1.1\r\n        s3transfer                    0.6.0\r\n        Send2Trash                    1.8.2\r\n        setuptools                    67.7.2\r\n        six                           1.16.0\r\n        sniffio                       1.3.0\r\n        soupsieve                     2.3.2.post1\r\n        stack-data                    0.6.2\r\n        terminado                     0.17.1\r\n        text-unidecode                1.3\r\n        tinycss2                      1.2.1\r\n        tomli                         2.0.1\r\n        tomlkit                       0.11.8\r\n        tornado                       6.3\r\n        traitlets                     5.9.0\r\n        typing_extensions             4.5.0\r\n        Unidecode                     1.3.6\r\n        uri-template                  1.2.0\r\n        urllib3                       1.26.15\r\n        wcwidth                       0.2.6\r\n        webcolors                     1.13\r\n        webencodings                  0.5.1\r\n        websocket-client              1.5.1\r\n        wheel                         0.40.0\r\n        zipp                          3.15.0\r\n\r\nconda list:\r\n        # packages in environment at /opt/conda/envs/jupyterlab-ext:\r\n        #\r\n        # Name                    Version                   Build  Channel\r\n        _libgcc_mutex             0.1                 conda_forge    conda-forge\r\n        _openmp_mutex             4.5                       2_gnu    conda-forge\r\n        anyio                     3.6.2              pyhd8ed1ab_0    conda-forge\r\n        argon2-cffi               21.3.0             pyhd8ed1ab_0    conda-forge\r\n        argon2-cffi-bindings      21.2.0          py311hd4cff14_3    conda-forge\r\n        arrow                     1.2.3              pyhd8ed1ab_0    conda-forge\r\n        asttokens                 2.2.1              pyhd8ed1ab_0    conda-forge\r\n        attrs                     22.2.0             pyh71513ae_0    conda-forge\r\n        babel                     2.12.1             pyhd8ed1ab_1    conda-forge\r\n        backcall                  0.2.0              pyh9f0ad1d_0    conda-forge\r\n        backports                 1.0                pyhd8ed1ab_3    conda-forge\r\n        backports.functools_lru_cache 1.6.4              pyhd8ed1ab_0    conda-forge\r\n        beautifulsoup4            4.12.2             pyha770c72_0    conda-forge\r\n        binaryornot               0.4.4                      py_1    conda-forge\r\n        bleach                    6.0.0              pyhd8ed1ab_0    conda-forge\r\n        boto3                     1.26.116                 pypi_0    pypi\r\n        botocore                  1.29.118                 pypi_0    pypi\r\n        brotlipy                  0.7.0           py311hd4cff14_1005    conda-forge\r\n        bzip2                     1.0.8                h7f98852_4    conda-forge\r\n        c-ares                    1.18.1               h7f98852_0    conda-forge\r\n        ca-certificates           2022.12.7            ha878542_0    conda-forge\r\n        certifi                   2022.12.7          pyhd8ed1ab_0    conda-forge\r\n        cffi                      1.15.1          py311h409f033_3    conda-forge\r\n        chardet                   5.1.0           py311h38be061_0    conda-forge\r\n        charset-normalizer        3.1.0              pyhd8ed1ab_0    conda-forge\r\n        click                     8.1.3           unix_pyhd8ed1ab_2    conda-forge\r\n        comm                      0.1.3              pyhd8ed1ab_0    conda-forge\r\n        cookiecutter              2.1.1              pyh6c4a22f_0    conda-forge\r\n        cryptography              40.0.2          py311h9b4c7bb_0    conda-forge\r\n        curl                      8.0.1                h588be90_0    conda-forge\r\n        debugpy                   1.6.7           py311hcafe171_0    conda-forge\r\n        decorator                 5.1.1              pyhd8ed1ab_0    conda-forge\r\n        defusedxml                0.7.1              pyhd8ed1ab_0    conda-forge\r\n        deprecation               2.1.0              pyh9f0ad1d_0    conda-forge\r\n        entrypoints               0.4                pyhd8ed1ab_0    conda-forge\r\n        executing                 1.2.0              pyhd8ed1ab_0    conda-forge\r\n        flit-core                 3.8.0              pyhd8ed1ab_0    conda-forge\r\n        fqdn                      1.5.1                    pypi_0    pypi\r\n        gettext                   0.21.1               h27087fc_0    conda-forge\r\n        git                       2.40.1          pl5321h86e50cf_0    conda-forge\r\n        icu                       70.1                 h27087fc_0    conda-forge\r\n        idna                      3.4                pyhd8ed1ab_0    conda-forge\r\n        importlib-metadata        6.6.0              pyha770c72_0    conda-forge\r\n        importlib_metadata        6.6.0                hd8ed1ab_0    conda-forge\r\n        importlib_resources       5.12.0             pyhd8ed1ab_0    conda-forge\r\n        ipykernel                 6.22.0             pyh210e3f2_0    conda-forge\r\n        ipython                   8.13.1             pyh41d4057_0    conda-forge\r\n        ipython_genutils          0.2.0                      py_1    conda-forge\r\n        isoduration               20.11.0                  pypi_0    pypi\r\n        jedi                      0.18.2             pyhd8ed1ab_0    conda-forge\r\n        jinja2                    3.1.2              pyhd8ed1ab_1    conda-forge\r\n        jinja2-time               0.2.0              pyhd8ed1ab_3    conda-forge\r\n        jmespath                  1.0.1                    pypi_0    pypi\r\n        json5                     0.9.5              pyh9f0ad1d_0    conda-forge\r\n        jsonpointer               2.3                      pypi_0    pypi\r\n        jsonschema                4.17.3             pyhd8ed1ab_0    conda-forge\r\n        jupyter-packaging         0.12.3             pyha770c72_0    conda-forge\r\n        jupyter_client            8.2.0              pyhd8ed1ab_0    conda-forge\r\n        jupyter_core              5.3.0           py311h38be061_0    conda-forge\r\n        jupyter_events            0.6.3              pyhd8ed1ab_0    conda-forge\r\n        jupyter_server            2.5.0              pyhd8ed1ab_0    conda-forge\r\n        jupyter_server_terminals  0.4.4              pyhd8ed1ab_1    conda-forge\r\n        jupyterlab                3.5.3              pyhd8ed1ab_0    conda-forge\r\n        jupyterlab_pygments       0.2.2              pyhd8ed1ab_0    conda-forge\r\n        jupyterlab_server         2.22.1             pyhd8ed1ab_0    conda-forge\r\n        keyutils                  1.6.1                h166bdaf_0    conda-forge\r\n        krb5                      1.20.1               h81ceb04_0    conda-forge\r\n        ld_impl_linux-64          2.40                 h41732ed_0    conda-forge\r\n        libcurl                   8.0.1                h588be90_0    conda-forge\r\n        libedit                   3.1.20191231         he28a2e2_2    conda-forge\r\n        libev                     4.33                 h516909a_1    conda-forge\r\n        libexpat                  2.5.0                hcb278e6_1    conda-forge\r\n        libffi                    3.4.2                h7f98852_5    conda-forge\r\n        libgcc-ng                 12.2.0              h65d4601_19    conda-forge\r\n        libgomp                   12.2.0              h65d4601_19    conda-forge\r\n        libiconv                  1.17                 h166bdaf_0    conda-forge\r\n        libnghttp2                1.52.0               h61bc06f_0    conda-forge\r\n        libnsl                    2.0.0                h7f98852_0    conda-forge\r\n        libsodium                 1.0.18               h36c2ea0_1    conda-forge\r\n        libsqlite                 3.40.0               h753d276_1    conda-forge\r\n        libssh2                   1.10.0               hf14f497_3    conda-forge\r\n        libstdcxx-ng              12.2.0              h46fd767_19    conda-forge\r\n        libuuid                   2.38.1               h0b41bf4_0    conda-forge\r\n        libuv                     1.44.2               h166bdaf_0    conda-forge\r\n        libzlib                   1.2.13               h166bdaf_4    conda-forge\r\n        markupsafe                2.1.2           py311h2582759_0    conda-forge\r\n        matplotlib-inline         0.1.6              pyhd8ed1ab_0    conda-forge\r\n        mistune                   2.0.5              pyhd8ed1ab_0    conda-forge\r\n        myextension               0.1.0                     dev_0    <develop>\r\n        nbclassic                 0.5.6              pyh8b2e9e2_0    conda-forge\r\n        nbclient                  0.7.4              pyhd8ed1ab_0    conda-forge\r\n        nbconvert-core            7.3.1              pyhd8ed1ab_0    conda-forge\r\n        nbformat                  5.8.0              pyhd8ed1ab_0    conda-forge\r\n        ncurses                   6.3                  h27087fc_1    conda-forge\r\n        nest-asyncio              1.5.6              pyhd8ed1ab_0    conda-forge\r\n        nodejs                    18.15.0              h8d033a5_0    conda-forge\r\n        notebook                  6.5.4              pyha770c72_0    conda-forge\r\n        notebook-shim             0.2.3              pyhd8ed1ab_0    conda-forge\r\n        openssl                   3.1.0                hd590300_3    conda-forge\r\n        packaging                 23.1               pyhd8ed1ab_0    conda-forge\r\n        pandocfilters             1.5.0              pyhd8ed1ab_0    conda-forge\r\n        parso                     0.8.3              pyhd8ed1ab_0    conda-forge\r\n        pcre2                     10.40                hc3806b6_0    conda-forge\r\n        perl                      5.32.1          2_h7f98852_perl5    conda-forge\r\n        pexpect                   4.8.0              pyh1a96a4e_2    conda-forge\r\n        pickleshare               0.7.5                   py_1003    conda-forge\r\n        pip                       23.1.2             pyhd8ed1ab_0    conda-forge\r\n        pkgutil-resolve-name      1.3.10             pyhd8ed1ab_0    conda-forge\r\n        platformdirs              3.5.0              pyhd8ed1ab_0    conda-forge\r\n        prometheus_client         0.16.0             pyhd8ed1ab_0    conda-forge\r\n        prompt-toolkit            3.0.38             pyha770c72_0    conda-forge\r\n        prompt_toolkit            3.0.38               hd8ed1ab_0    conda-forge\r\n        psutil                    5.9.5           py311h2582759_0    conda-forge\r\n        ptyprocess                0.7.0              pyhd3deb0d_0    conda-forge\r\n        pure_eval                 0.2.2              pyhd8ed1ab_0    conda-forge\r\n        pycparser                 2.21               pyhd8ed1ab_0    conda-forge\r\n        pygments                  2.15.1             pyhd8ed1ab_0    conda-forge\r\n        pyopenssl                 23.1.1             pyhd8ed1ab_0    conda-forge\r\n        pyrsistent                0.19.3          py311h2582759_0    conda-forge\r\n        pysocks                   1.7.1              pyha2e5f31_6    conda-forge\r\n        python                    3.11.3          h2755cc3_0_cpython    conda-forge\r\n        python-dateutil           2.8.2              pyhd8ed1ab_0    conda-forge\r\n        python-fastjsonschema     2.16.3             pyhd8ed1ab_0    conda-forge\r\n        python-json-logger        2.0.7              pyhd8ed1ab_0    conda-forge\r\n        python-slugify            8.0.1              pyhd8ed1ab_0    conda-forge\r\n        python_abi                3.11                    3_cp311    conda-forge\r\n        pytz                      2023.3             pyhd8ed1ab_0    conda-forge\r\n        pyyaml                    6.0             py311hd4cff14_5    conda-forge\r\n        pyzmq                     25.0.2          py311hd6ccaeb_0    conda-forge\r\n        readline                  8.2                  h8228510_1    conda-forge\r\n        requests                  2.29.0             pyhd8ed1ab_0    conda-forge\r\n        requests-futures          1.0.0                    pypi_0    pypi\r\n        rfc3339-validator         0.1.4              pyhd8ed1ab_0    conda-forge\r\n        rfc3986-validator         0.1.1              pyh9f0ad1d_0    conda-forge\r\n        s3transfer                0.6.0                    pypi_0    pypi\r\n        send2trash                1.8.2              pyh41d4057_0    conda-forge\r\n        setuptools                67.7.2             pyhd8ed1ab_0    conda-forge\r\n        six                       1.16.0             pyh6c4a22f_0    conda-forge\r\n        sniffio                   1.3.0              pyhd8ed1ab_0    conda-forge\r\n        soupsieve                 2.3.2.post1        pyhd8ed1ab_0    conda-forge\r\n        stack_data                0.6.2              pyhd8ed1ab_0    conda-forge\r\n        terminado                 0.17.1             pyh41d4057_0    conda-forge\r\n        text-unidecode            1.3                        py_0    conda-forge\r\n        tinycss2                  1.2.1              pyhd8ed1ab_0    conda-forge\r\n        tk                        8.6.12               h27826a3_0    conda-forge\r\n        tomli                     2.0.1              pyhd8ed1ab_0    conda-forge\r\n        tomlkit                   0.11.8             pyha770c72_0    conda-forge\r\n        tornado                   6.3             py311h2582759_0    conda-forge\r\n        traitlets                 5.9.0              pyhd8ed1ab_0    conda-forge\r\n        typing-extensions         4.5.0                hd8ed1ab_0    conda-forge\r\n        typing_extensions         4.5.0              pyha770c72_0    conda-forge\r\n        tzdata                    2023c                h71feb2d_0    conda-forge\r\n        unidecode                 1.3.6              pyhd8ed1ab_0    conda-forge\r\n        uri-template              1.2.0                    pypi_0    pypi\r\n        urllib3                   1.26.15            pyhd8ed1ab_0    conda-forge\r\n        wcwidth                   0.2.6              pyhd8ed1ab_0    conda-forge\r\n        webcolors                 1.13                     pypi_0    pypi\r\n        webencodings              0.5.1                      py_1    conda-forge\r\n        websocket-client          1.5.1              pyhd8ed1ab_0    conda-forge\r\n        wheel                     0.40.0             pyhd8ed1ab_0    conda-forge\r\n        xz                        5.2.6                h166bdaf_0    conda-forge\r\n        yaml                      0.2.5                h7f98852_2    conda-forge\r\n        zeromq                    4.3.4                h9c3ff4c_1    conda-forge\r\n        zipp                      3.15.0             pyhd8ed1ab_0    conda-forge\r\n        zlib                      1.2.13               h166bdaf_4    conda-forge\r\n        zstd                      1.5.2                h3eb15da_6    conda-forge\r\n\r\nconda env:\r\n        name: jupyterlab-ext\r\n        channels:\r\n          - conda-forge\r\n        dependencies:\r\n          - _libgcc_mutex=0.1=conda_forge\r\n          - _openmp_mutex=4.5=2_gnu\r\n          - anyio=3.6.2=pyhd8ed1ab_0\r\n          - argon2-cffi=21.3.0=pyhd8ed1ab_0\r\n          - argon2-cffi-bindings=21.2.0=py311hd4cff14_3\r\n          - arrow=1.2.3=pyhd8ed1ab_0\r\n          - asttokens=2.2.1=pyhd8ed1ab_0\r\n          - attrs=22.2.0=pyh71513ae_0\r\n          - babel=2.12.1=pyhd8ed1ab_1\r\n          - backcall=0.2.0=pyh9f0ad1d_0\r\n          - backports=1.0=pyhd8ed1ab_3\r\n          - backports.functools_lru_cache=1.6.4=pyhd8ed1ab_0\r\n          - beautifulsoup4=4.12.2=pyha770c72_0\r\n          - binaryornot=0.4.4=py_1\r\n          - bleach=6.0.0=pyhd8ed1ab_0\r\n          - brotlipy=0.7.0=py311hd4cff14_1005\r\n          - bzip2=1.0.8=h7f98852_4\r\n          - c-ares=1.18.1=h7f98852_0\r\n          - ca-certificates=2022.12.7=ha878542_0\r\n          - certifi=2022.12.7=pyhd8ed1ab_0\r\n          - cffi=1.15.1=py311h409f033_3\r\n          - chardet=5.1.0=py311h38be061_0\r\n          - charset-normalizer=3.1.0=pyhd8ed1ab_0\r\n          - click=8.1.3=unix_pyhd8ed1ab_2\r\n          - comm=0.1.3=pyhd8ed1ab_0\r\n          - cookiecutter=2.1.1=pyh6c4a22f_0\r\n          - cryptography=40.0.2=py311h9b4c7bb_0\r\n          - curl=8.0.1=h588be90_0\r\n          - debugpy=1.6.7=py311hcafe171_0\r\n          - decorator=5.1.1=pyhd8ed1ab_0\r\n          - defusedxml=0.7.1=pyhd8ed1ab_0\r\n          - deprecation=2.1.0=pyh9f0ad1d_0\r\n          - entrypoints=0.4=pyhd8ed1ab_0\r\n          - executing=1.2.0=pyhd8ed1ab_0\r\n          - flit-core=3.8.0=pyhd8ed1ab_0\r\n          - gettext=0.21.1=h27087fc_0\r\n          - git=2.40.1=pl5321h86e50cf_0\r\n          - icu=70.1=h27087fc_0\r\n          - idna=3.4=pyhd8ed1ab_0\r\n          - importlib-metadata=6.6.0=pyha770c72_0\r\n          - importlib_metadata=6.6.0=hd8ed1ab_0\r\n          - importlib_resources=5.12.0=pyhd8ed1ab_0\r\n          - ipykernel=6.22.0=pyh210e3f2_0\r\n          - ipython=8.13.1=pyh41d4057_0\r\n          - ipython_genutils=0.2.0=py_1\r\n          - jedi=0.18.2=pyhd8ed1ab_0\r\n          - jinja2=3.1.2=pyhd8ed1ab_1\r\n          - jinja2-time=0.2.0=pyhd8ed1ab_3\r\n          - json5=0.9.5=pyh9f0ad1d_0\r\n          - jsonschema=4.17.3=pyhd8ed1ab_0\r\n          - jupyter-packaging=0.12.3=pyha770c72_0\r\n          - jupyter_client=8.2.0=pyhd8ed1ab_0\r\n          - jupyter_core=5.3.0=py311h38be061_0\r\n          - jupyter_events=0.6.3=pyhd8ed1ab_0\r\n          - jupyter_server=2.5.0=pyhd8ed1ab_0\r\n          - jupyter_server_terminals=0.4.4=pyhd8ed1ab_1\r\n          - jupyterlab=3.5.3=pyhd8ed1ab_0\r\n          - jupyterlab_pygments=0.2.2=pyhd8ed1ab_0\r\n          - jupyterlab_server=2.22.1=pyhd8ed1ab_0\r\n          - keyutils=1.6.1=h166bdaf_0\r\n          - krb5=1.20.1=h81ceb04_0\r\n          - ld_impl_linux-64=2.40=h41732ed_0\r\n          - libcurl=8.0.1=h588be90_0\r\n          - libedit=3.1.20191231=he28a2e2_2\r\n          - libev=4.33=h516909a_1\r\n          - libexpat=2.5.0=hcb278e6_1\r\n          - libffi=3.4.2=h7f98852_5\r\n          - libgcc-ng=12.2.0=h65d4601_19\r\n          - libgomp=12.2.0=h65d4601_19\r\n          - libiconv=1.17=h166bdaf_0\r\n          - libnghttp2=1.52.0=h61bc06f_0\r\n          - libnsl=2.0.0=h7f98852_0\r\n          - libsodium=1.0.18=h36c2ea0_1\r\n          - libsqlite=3.40.0=h753d276_1\r\n          - libssh2=1.10.0=hf14f497_3\r\n          - libstdcxx-ng=12.2.0=h46fd767_19\r\n          - libuuid=2.38.1=h0b41bf4_0\r\n          - libuv=1.44.2=h166bdaf_0\r\n          - libzlib=1.2.13=h166bdaf_4\r\n          - markupsafe=2.1.2=py311h2582759_0\r\n          - matplotlib-inline=0.1.6=pyhd8ed1ab_0\r\n          - mistune=2.0.5=pyhd8ed1ab_0\r\n          - nbclassic=0.5.6=pyh8b2e9e2_0\r\n          - nbclient=0.7.4=pyhd8ed1ab_0\r\n          - nbconvert-core=7.3.1=pyhd8ed1ab_0\r\n          - nbformat=5.8.0=pyhd8ed1ab_0\r\n          - ncurses=6.3=h27087fc_1\r\n          - nest-asyncio=1.5.6=pyhd8ed1ab_0\r\n          - nodejs=18.15.0=h8d033a5_0\r\n          - notebook=6.5.4=pyha770c72_0\r\n          - notebook-shim=0.2.3=pyhd8ed1ab_0\r\n          - openssl=3.1.0=hd590300_3\r\n          - packaging=23.1=pyhd8ed1ab_0\r\n          - pandocfilters=1.5.0=pyhd8ed1ab_0\r\n          - parso=0.8.3=pyhd8ed1ab_0\r\n          - pcre2=10.40=hc3806b6_0\r\n          - perl=5.32.1=2_h7f98852_perl5\r\n          - pexpect=4.8.0=pyh1a96a4e_2\r\n          - pickleshare=0.7.5=py_1003\r\n          - pip=23.1.2=pyhd8ed1ab_0\r\n          - pkgutil-resolve-name=1.3.10=pyhd8ed1ab_0\r\n          - platformdirs=3.5.0=pyhd8ed1ab_0\r\n          - prometheus_client=0.16.0=pyhd8ed1ab_0\r\n          - prompt-toolkit=3.0.38=pyha770c72_0\r\n          - prompt_toolkit=3.0.38=hd8ed1ab_0\r\n          - psutil=5.9.5=py311h2582759_0\r\n          - ptyprocess=0.7.0=pyhd3deb0d_0\r\n          - pure_eval=0.2.2=pyhd8ed1ab_0\r\n          - pycparser=2.21=pyhd8ed1ab_0\r\n          - pygments=2.15.1=pyhd8ed1ab_0\r\n          - pyopenssl=23.1.1=pyhd8ed1ab_0\r\n          - pyrsistent=0.19.3=py311h2582759_0\r\n          - pysocks=1.7.1=pyha2e5f31_6\r\n          - python=3.11.3=h2755cc3_0_cpython\r\n          - python-dateutil=2.8.2=pyhd8ed1ab_0\r\n          - python-fastjsonschema=2.16.3=pyhd8ed1ab_0\r\n          - python-json-logger=2.0.7=pyhd8ed1ab_0\r\n          - python-slugify=8.0.1=pyhd8ed1ab_0\r\n          - python_abi=3.11=3_cp311\r\n          - pytz=2023.3=pyhd8ed1ab_0\r\n          - pyyaml=6.0=py311hd4cff14_5\r\n          - pyzmq=25.0.2=py311hd6ccaeb_0\r\n          - readline=8.2=h8228510_1\r\n          - requests=2.29.0=pyhd8ed1ab_0\r\n          - rfc3339-validator=0.1.4=pyhd8ed1ab_0\r\n          - rfc3986-validator=0.1.1=pyh9f0ad1d_0\r\n          - send2trash=1.8.2=pyh41d4057_0\r\n          - setuptools=67.7.2=pyhd8ed1ab_0\r\n          - six=1.16.0=pyh6c4a22f_0\r\n          - sniffio=1.3.0=pyhd8ed1ab_0\r\n          - soupsieve=2.3.2.post1=pyhd8ed1ab_0\r\n          - stack_data=0.6.2=pyhd8ed1ab_0\r\n          - terminado=0.17.1=pyh41d4057_0\r\n          - text-unidecode=1.3=py_0\r\n          - tinycss2=1.2.1=pyhd8ed1ab_0\r\n          - tk=8.6.12=h27826a3_0\r\n          - tomli=2.0.1=pyhd8ed1ab_0\r\n          - tomlkit=0.11.8=pyha770c72_0\r\n          - tornado=6.3=py311h2582759_0\r\n          - traitlets=5.9.0=pyhd8ed1ab_0\r\n          - typing-extensions=4.5.0=hd8ed1ab_0\r\n          - typing_extensions=4.5.0=pyha770c72_0\r\n          - tzdata=2023c=h71feb2d_0\r\n          - unidecode=1.3.6=pyhd8ed1ab_0\r\n          - urllib3=1.26.15=pyhd8ed1ab_0\r\n          - wcwidth=0.2.6=pyhd8ed1ab_0\r\n          - webencodings=0.5.1=py_1\r\n          - websocket-client=1.5.1=pyhd8ed1ab_0\r\n          - wheel=0.40.0=pyhd8ed1ab_0\r\n          - xz=5.2.6=h166bdaf_0\r\n          - yaml=0.2.5=h7f98852_2\r\n          - zeromq=4.3.4=h9c3ff4c_1\r\n          - zipp=3.15.0=pyhd8ed1ab_0\r\n          - zlib=1.2.13=h166bdaf_4\r\n          - zstd=1.5.2=h3eb15da_6\r\n          - pip:\r\n              - boto3==1.26.116\r\n              - botocore==1.29.118\r\n              - fqdn==1.5.1\r\n              - isoduration==20.11.0\r\n              - jmespath==1.0.1\r\n              - jsonpointer==2.3\r\n              - requests-futures==1.0.0\r\n              - s3transfer==0.6.0\r\n              - uri-template==1.2.0\r\n              - webcolors==1.13\r\n        prefix: /opt/conda/envs/jupyterlab-ext\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\nPaste the output from your command line running `jupyter lab` here, use `--debug` if possible.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nPaste the output from your browser Javascript console here, if applicable.\r\n\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 2942,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/apputils/src/dialog.tsx",
      "packages/apputils/test/dialog.spec.tsx"
    ],
    "pr_changed_test_files": [
      "packages/apputils/test/dialog.spec.tsx"
    ],
    "base_commit": "7d153eee614ee1c8c0b2ac642448fbd7143f9283",
    "head_commit": "51b00c31d56b0879e52add39d4ef1c7da1c57f41",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17142",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17142",
    "dockerfile": "",
    "pr_merged_at": "2025-01-30T10:45:50.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17136",
    "pr_id": 17136,
    "issue_id": 17114,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix sanitizer call in ToC if html data is array of strings\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\nFixes https://github.com/jupyterlab/jupyterlab/issues/16856\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\nIf the HTML data is an array of strings (e.g. as plotly generates it), the data is joined).\r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\nNo.\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\nNo.\r\n",
    "issue_word_count": 149,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/cells/src/widget.ts",
      "packages/cells/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/cells/test/widget.spec.ts"
    ],
    "base_commit": "eae4dbfb04cde4f65481f8f7196bfccb45f0b3b7",
    "head_commit": "6080cfbf9f58d468d070157c5056de04eec8099f",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17136",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17136",
    "dockerfile": "",
    "pr_merged_at": "2025-01-02T15:47:24.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17121",
    "pr_id": 17121,
    "issue_id": 16479,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "The `query` argument in `settingeditor:open` does not update query when Settings Editor is already open\n## Description\r\n\r\nExtensions can open the settings editor on a given setting by passing a `query` argument. It works great when the Settings Editor is closed, but if it is already open, the command switches to the Settings Editor tab but ignores the `query` argument.\r\n\r\n## Reproduce\r\n\r\nThis is because of the short-circuit logic in:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/130089eddb330a44f7f9d496b1e64eddcb497d6b/packages/settingeditor-extension/src/index.ts#L115-L143\r\n\r\nwhich only calls activate but does not update `query` from `args.query`.\r\n\r\n## Expected behavior\r\n\r\nThe query is respected on second and consecutive executions on `settingeditor:open` command.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.2\r\n",
    "issue_word_count": 102,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/settings.test.ts",
      "packages/settingeditor-extension/src/index.ts",
      "packages/settingeditor/src/settingseditor.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/settings.test.ts"
    ],
    "base_commit": "3f3d807425344f11361d210c88f93ead8702eb40",
    "head_commit": "9ca3171e6d9ba4362f619ee3428dac566cc6b5ea",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17121",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17121",
    "dockerfile": "",
    "pr_merged_at": "2025-01-03T11:47:54.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17114",
    "pr_id": 17114,
    "issue_id": 16856,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "HTML Sanitizer problem/crash\nIt may be a problem with Plotly, and I should file an issue there.\r\nHowever, I am observing a crash in the HTML sanitizer. It says `this.buffer.charCodeAt` is not a function.\r\nThe cause is relatively easy to find. Plotly generates HTML lines, which are an array of strings. The HTML sanitizer only allows strings (with the charCodeAt). This issue is probably relatively rare, as it only occurs when I have not installed Plotly in my development environment, and so the HTML code is usually not rendered.\r\nYou can reproduce it by creating a notebook with Plotly plots, saving it, and opening it in a clean environment without Plotly.\r\n\r\nNothing really important.",
    "issue_word_count": 113,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/cells/src/widget.ts",
      "packages/cells/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/cells/test/widget.spec.ts"
    ],
    "base_commit": "21b68de0e58cfbb0c6b94a86138abdc3e8c44f9a",
    "head_commit": "67b9de84ba4c26d0c52f207c989b2bc4a01d8757",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17114",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17114",
    "dockerfile": "",
    "pr_merged_at": "2025-01-02T13:37:42.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17093",
    "pr_id": 17093,
    "issue_id": 17082,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix consecutive invocations of inline completion\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\nFixes #17011\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\nApply inline completion suggestion and cursor position update in the same codemirror transaction to avoid document change listener react with a wrong editor position.\r\n\r\nThis is therefore done using codemirror mechanism and not the shared model.\r\n\r\n> I checked that the changes are still applied as single change for the undo manager.\r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\nContinuous inline completion works as expected.\r\n\r\nhttps://github.com/user-attachments/assets/5e88a457-6cb6-4f3c-b2bb-6e4b2e18f54a\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\nNone",
    "issue_word_count": 191,
    "test_files_count": 7,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "packages/codemirror/test/editor.spec.ts",
      "packages/completer/src/handler.ts",
      "packages/completer/src/inline.ts",
      "packages/completer/src/testutils.ts",
      "packages/completer/test/inline.spec.ts",
      "packages/console/test/utils.ts",
      "packages/debugger/test/debugger.spec.ts",
      "packages/fileeditor/test/searchprovider.spec.ts",
      "packages/notebook/src/testutils.ts"
    ],
    "pr_changed_test_files": [
      "packages/codemirror/test/editor.spec.ts",
      "packages/completer/src/testutils.ts",
      "packages/completer/test/inline.spec.ts",
      "packages/console/test/utils.ts",
      "packages/debugger/test/debugger.spec.ts",
      "packages/fileeditor/test/searchprovider.spec.ts",
      "packages/notebook/src/testutils.ts"
    ],
    "base_commit": "ee8a17c4d474021c78a3b65f4adf0e1e4a777fab",
    "head_commit": "72a49c81d08e0739d624e4ae800c3c05107c79c4",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17093",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17093",
    "dockerfile": "",
    "pr_merged_at": "2024-12-17T17:50:54.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17091",
    "pr_id": 17091,
    "issue_id": 17090,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Settings Editor Form Values Not Updating After Indirect Setting Changes\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\nWhen modifying settings through the JSON Settings Editor, the changes are applied, but the corresponding values in the Settings Editor form do not update until the page is refreshed.\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Go to settings editor\r\n2. Click on JSON Settings Editor\r\n3. Modify a setting, such as the theme, by adding a new value in the `User Preferences` section. For example:\r\n```bash\r\n{\r\n    \"theme\": \"JupyterLab Dark\"\r\n}\r\n```\r\n5. Save the settings\r\n6. Observe that the applied setting (e.g., the dark theme) takes effect, but the form in the Settings Editor still shows the previous value (e.g. Jupyter Light).\r\n![Screenshot from 2024-12-16 19-42-58](https://github.com/user-attachments/assets/df70eaac-40d3-40c6-995d-ffbc4383c81d)\r\n7. Refresh the page to see the updated form value.\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\n<!--Describe what you expected to happen-->\r\nThe form values in the Settings Editor should reflect the updated settings immediately after they are applied.\r\n\r\n## Context\r\n- Operating System and version: <!-- e.g. Linux Ubuntu 21.04 -->Ubuntu 24.04\r\n- Browser and version: <!-- e.g. Chrome 92 --> Brave\r\n- JupyterLab version: <!-- e.g. 3.1.7 --> 4.3\r\n\r\n",
    "issue_word_count": 259,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/settings.test.ts",
      "packages/settingeditor/src/SettingsFormEditor.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/settings.test.ts"
    ],
    "base_commit": "f7a203dc4065fb003a7ea0c0fda337f5125d98eb",
    "head_commit": "09f86f02ce04f391e3bdba33078a3ddff8f5a178",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17091",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17091",
    "dockerfile": "",
    "pr_merged_at": "2024-12-18T13:09:40.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17082",
    "pr_id": 17082,
    "issue_id": 17011,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Accepted inline completion trigger inline completion at the wrong position\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\nAccepting an inline completion triggers indirectly an inline completion due to `textChanged` signal.\r\n\r\n\r\n\r\n## Reproduce\r\n\r\n_custom provider_\r\n\r\nhttps://github.com/user-attachments/assets/6fa7342c-b716-490c-8814-f234090df29c\r\n\r\n_jupyter-ai with OpenAI_\r\n\r\nhttps://github.com/user-attachments/assets/c6aca399-7853-4f2f-a56b-b124418d6f22\r\n\r\nIn jupyter-ai, I was not able to reproduce the bug -> more on that later.\r\n\r\nReduce sequence flows:\r\n\r\n- Accepting the inline completion, trigger a source changed event from Yjs\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/48908a8b07128b651faab72434f8d442b99bc91c/packages/completer/src/inline.ts#L141-L148\r\n\r\n- This trigger `onTextChanged`\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/8937ac414ae9999899a3588dc41917fc016a8c78/packages/completer/src/handler.ts#L329\r\n\r\n- That triggers a `_makeInlineRequest`\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/8937ac414ae9999899a3588dc41917fc016a8c78/packages/completer/src/handler.ts#L362-L367\r\n\r\nBut the cursor position at line 364 in the above snippet is prior to the inline text as the cursor position is changed line 147 in the first snippet after changing the editor source.\r\n\r\n> The demo with jupyter-ai is not plagued with this bug because inline completion is only allowed at line ending:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/8937ac414ae9999899a3588dc41917fc016a8c78/packages/completer/src/handler.ts#L473\r\n\r\nBut actually the inline request is also started.\r\n\r\n## Expected behavior\r\n\r\nAccepting inline completion do not trigger inline completion (or at least not at the cursor position prior to the first inline completion).\r\n\r\n## Context\r\n\r\nJupyterLab 4.3.1\r\n\r\njupyter_ai                2.28.2\r\njupyter_ai_magics         2.28.2\r\nlangchain                 0.2.17\r\nlangchain-community       0.2.19\r\nlangchain-core            0.2.43\r\nlangchain-openai          0.1.25\r\nlangchain-text-splitters  0.2.4\r\nopenai                    1.55.2\r\n\r\n",
    "issue_word_count": 308,
    "test_files_count": 7,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "packages/codemirror/test/editor.spec.ts",
      "packages/completer/src/handler.ts",
      "packages/completer/src/inline.ts",
      "packages/completer/src/testutils.ts",
      "packages/completer/test/inline.spec.ts",
      "packages/console/test/utils.ts",
      "packages/debugger/test/debugger.spec.ts",
      "packages/fileeditor/test/searchprovider.spec.ts",
      "packages/notebook/src/testutils.ts"
    ],
    "pr_changed_test_files": [
      "packages/codemirror/test/editor.spec.ts",
      "packages/completer/src/testutils.ts",
      "packages/completer/test/inline.spec.ts",
      "packages/console/test/utils.ts",
      "packages/debugger/test/debugger.spec.ts",
      "packages/fileeditor/test/searchprovider.spec.ts",
      "packages/notebook/src/testutils.ts"
    ],
    "base_commit": "f7a203dc4065fb003a7ea0c0fda337f5125d98eb",
    "head_commit": "104801ae18f0e214fbace97ebb0161adfc3dbf07",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17082",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17082",
    "dockerfile": "",
    "pr_merged_at": "2024-12-17T16:16:38.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17076",
    "pr_id": 17076,
    "issue_id": 16980,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Markdown remains un-rendered after leaving cell\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nUsing the array keys to move focus to a markdown cell while in edit mode, unrenders it but when the user leave the markdown cell, it remains un-rendered even though no change was made. \r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\nConsider the gif below - \r\n![Markdown-unrendered](https://github.com/user-attachments/assets/cda3de8e-ea8a-4364-8e97-14a6d219dc79)\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\nMarkdown should go back to the rendered state. \r\n<!--Describe what you expected to happen-->\r\n\r\n## Context\r\n\r\n- JupyterLab version: v4.3.0 (I've seen this issue since atleast v4.0.x)\r\n\r\n",
    "issue_word_count": 152,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "packages/notebook-extension/schema/tracker.json",
      "packages/notebook-extension/src/index.ts",
      "packages/notebook/src/widget.ts",
      "packages/notebook/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/widget.spec.ts"
    ],
    "base_commit": "2607c1093539850b5b618352dc94893a8b662e48",
    "head_commit": "58b8eab8e6857509068f2180e64edb363a62428c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17076",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17076",
    "dockerfile": "",
    "pr_merged_at": "2024-12-27T13:31:23.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17067",
    "pr_id": 17067,
    "issue_id": 17060,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "FIM (fill in the middle) support for inline completer on typing\n### Problem\r\n\r\n_Fill-in-the-middle_ allows to add code in the middle of the code line. This is currently supported when manually invoking the inline completer, but it is not possible for user to get inline completion suggestions automatically when typing in the middle of the line (these are only returned at the end of the line); this is codified in:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/bb596b37d44cacb7aaec2c09aa5d6c8b43a3a2a8/packages/completer/src/handler.ts#L467-L473\r\n\r\n### Proposed Solution\r\n\r\nAdd an opt-in option allowing for inline completion to be auto-triggered when anywhere in the line.\r\n\r\nOf note, the manual invoke is allowed anywhere since https://github.com/jupyterlab/jupyterlab/pull/16298 included `4.1.x`.\r\n\r\n### Additional context\r\n\r\nQuoting the Codeium [blog post](https://codeium.com/blog/inline-fim-code-suggestions) (emphasis mine):\r\n\r\n> This scenario where there is text on both sides of the cursor (on the same line) and we want autocomplete suggestions is a special case of the fill-in-the-middle task called in-line fill-in-the-middle, or in-line FIM for short. **And it is not easy to get in-line FIM to work well enough to be helpful rather than distracting.**\r\n> \r\n> [...]\r\n> So what is likely going on with these AI code assistants? In the original post, we showed how TabNine didnâ€™t have generic FIM capabilities in the first place. Amazon CodeWhisperer on face value does, but they must have made some significant fundamental errors in building FIM since the suggestions are quite poor, error-prone, and often not referencing post-cursor context.\r\n> \r\n> But what about Github Copilot? They have reasonable FIM suggestions for filling in lines and using future context, so why is in-line FIM not enabled? Honestly, we are not sure. Copilot has normal FIM suggestions and it seems like there shouldnâ€™t be anything that is stopping it from exposing in-line FIM suggestions. Our guess is that they tried to enable in-line FIM, but the performance wasnâ€™t good enough, maybe from a lack of in-line FIM-like training examples or some other training knobs. All we know is that for now, Copilot has not enabled in-line FIM in production, and likely that means there is something up with the underlying model, which they are unwilling to retrain, or their FIM handling capabilities are inherently worse.\r\n\r\n\r\nThis appears like a good enough rationale for making it opt-in in JupyterLab rather than opt-out, especially because compared to GitHub Copilot or Codeium, JupyterLab does not have a set of curated supported models for which pre-processing and context provision is fine-tuned to return good enough in-line FIM to be more useful than distracting.\r\n\r\n---\r\n\r\nPreviously a broader question about FIM was opened in https://github.com/jupyterlab/jupyterlab/issues/16671 but it did not contain specific change requests - only a question about support status.\r\n\r\n--- \r\n\r\nLSP specification does not have a special trigger kind or metadata for in-line FIM.",
    "issue_word_count": 494,
    "test_files_count": 3,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "galata/test/jupyterlab/inline-completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png",
      "packages/completer-extension/src/index.ts",
      "packages/completer/src/default/inlinehistoryprovider.ts",
      "packages/completer/src/handler.ts",
      "packages/completer/src/reconciliator.ts",
      "packages/completer/src/tokens.ts",
      "packages/metapackage/test/completer/manager.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/inline-completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png",
      "packages/metapackage/test/completer/manager.spec.ts"
    ],
    "base_commit": "9b495ecfd47346b3582327e9d2e48b65836d099a",
    "head_commit": "637501b1776191946bf6ca125ae71dbcc17399a3",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17067",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17067",
    "dockerfile": "",
    "pr_merged_at": "2024-12-12T14:41:30.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17049",
    "pr_id": 17049,
    "issue_id": 17043,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix newline handling in stream outputs\n## References\r\n\r\nFixes #17039.\r\n\r\n## Code changes\r\n\r\nDon't shortcut logic when stream has a newline character.\r\n\r\n## User-facing changes\r\n\r\nStreams are correctly handled, especially progress bars.\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone.",
    "issue_word_count": 29,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/outputarea/src/model.ts",
      "packages/outputarea/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/outputarea/test/model.spec.ts"
    ],
    "base_commit": "d3bab54ae008cc675ae99ff4e38059fee6e08dd1",
    "head_commit": "7eee8c206b374a9e692fd90fa6e3917e57d5c041",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17049",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17049",
    "dockerfile": "",
    "pr_merged_at": "2024-12-06T07:23:26.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17043",
    "pr_id": 17043,
    "issue_id": 17039,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Printing carriage return (\\r) from external (c++) python module screws text-out\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nThis is a followup of https://github.com/jupyterlab/jupyterlab/issues/16995.\r\nWhile https://github.com/jupyterlab/jupyterlab/pull/16999 fixed the carriage return for the python print statement, I still get issues with \\r based progressbars created in a c++ module (exposed via pybind11). \r\n\r\nPrinting \\r from a pybind11 module seems to screw up consecutive printing calls in the respective cell. The python print statement itself is not affected and seems to work fine since  https://github.com/jupyterlab/jupyterlab/pull/16999. Still, I believe that this is a regression related to https://github.com/jupyterlab/jupyterlab/pull/16999 and not to pybind11, because a) this worked fine in 4.2.6 and b) I can use e.g. xeus-cling without pybind11 to reproduce this issue\r\n\r\n## Reproduce\r\n\r\nHere I xeus-cling to to run the following code cells (e.g. mamba install -c conda-forge jupyterlab xeus-cling). Compiling a pybind11 module and calling the exposed function from jupyterlab produces the exact same results. \r\n\r\nHere are 2 code examples to explain the problem:\r\n\r\n## Example 1: progress loop\r\n\r\n```\r\n#import <iostream>\r\n#import <string>\r\nusing namespace std;\r\n\r\ncout << \"-- begin --\" << endl;\r\nfor (size_t i=0; i <100; ++i){\r\n    cout << \"Progress: \" << i << \"\\r\" << flush;\r\n}\r\ncout << endl;\r\ncout << \"-- end --\" << endl;\r\n```\r\n\r\n### Expected result (and result when using jupyterlab==4.2.6\r\n```\r\n-- begin --\r\nProgress: 99\r\n-- end --\r\n```\r\n\r\n### Result for jupyterlab==4.3.1\r\n```\r\n-- begin --\r\nProgress: 0Progress: 1Progress: 2Progress: 3Progress: 4Progress: 5Progress: 6Progress: 7Progress: 8Progress: 9Progress: 10Progress: 11Progress: 12Progress: 13Progress: 14Progress: 15Progress: 16Progress: 17Progress: 18Progress: 19Progress: 20Progress: 21Progress: 22Progress: 23Progress: 24Progress: 25Progress: 26Progress: 27Progress: 28Progress: 29Progress: 30Progress: 31Progress: 32Progress: 33Progress: 34Progress: 35Progress: 36Progress: 37Progress: 38Progress: 39Progress: 40Progress: 41Progress: 42Progress: 43Progress: 44Progress: 45Progress: 46Progress: 47Progress: 48Progress: 49Progress: 50Progress: 51Progress: 52Progress: 53Progress: 54Progress: 55Progress: 56Progress: 57Progress: 58Progress: 59Progress: 60Progress: 61Progress: 62Progress: 63Progress: 64Progress: 65Progress: 66Progress: 67Progress: 68Progress: 69Progress: 70Progress: 71Progress: 72Progress: 73Progress: 74Progress: 75Progress: 76Progress: 77Progress: 78Progress: 79Progress: 80Progress: 81Progress: 82Progress: 83Progress: 84Progress: 85Progress: 86Progress: 87Progress: 88Progress: 89Progress: 90Progress: 91Progress: 92Progress: 93Progress: 94Progress: 95Progress: 96Progress: 97Progress: 98Progress: 99\r\n-- end --\r\n```\r\n\r\n### Result for jupyterlab==4.3.2\r\n```\r\n-- begin --\r\n\r\n-- end --\r\n9\r\n```\r\n\r\n## Example 2: consecutive print statements\r\n\r\nIt seems that this error is related to the cursor position handling in v4.3.2.\r\nBefore  calling \"cout << endl\" the code actually produces \"Progress: 99\" in jupyterlab 4.3.2. However, calling cout << endl; deletes the current line and than copies part of the line to the end of the cell. Take the following code block\r\n\r\n```\r\n#import <iostream>\r\nusing namespace std;\r\n\r\ncerr << \"--0123456789-ABCDEFGHIJKLMNOP--\\r\" << flush;\r\ncerr << endl;\r\ncerr << \"Second\" << endl;\r\n```\r\n\r\n### Expected result (jupyterlab 4.2.6 AND 4.3.1)\r\n```\r\n--0123456789-ABCDEFGHIJKLMNOP--\r\nSecond\r\n```\r\n\r\n### Result jupyterlab 4.3.2\r\n```\r\n\r\nSecond\r\n6789-ABCDEFGHIJKLMNOP--\r\n```\r\n\r\n(Notice the empty line at the beginning of the 4.3.2 output)\r\nThe behavior that part of the '\\r' text is copied to the end of the cell is carried forth with consecutive print statements. Take the following code:\r\n\r\n```\r\n#import <iostream>\r\nusing namespace std;\r\n\r\ncerr << \"--0123456789-ABCDEFGHIJKLMNOP--\\r\" << flush;\r\ncerr << endl;\r\ncerr << \"Second\" << endl;\r\ncerr << \"third\" << endl;\r\n```\r\n\r\n### Result Jupyterlab 4.3.2\r\n\r\n```\r\n\r\nSecond\r\nthird\r\nBCDEFGHIJKLMNOP--\r\n```\r\n\r\nThe behavior that part of the \\r line is moved to the end of the cell continues even when calling \\r from a pybind11 module and then calling print() from within python.\r\n\r\n## Example 3: using python loop only\r\nFor completenes, the following loop produces the correct results in jupyterlab 4.2.6 and 4.3.2\r\n\r\n```\r\nprint(\"-- begin --\")\r\nfor i in range(100):\r\n    print('Progress:',i,end='\\r')\r\nprint()\r\nprint(\"-- end --\")\r\n```\r\n\r\nThe python print statement is thus not affected.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Linux Ubuntu 24.04 (Likely operation system independent)\r\n- JupyterLab version: e.g. 4.3.2\r\n- See also this bug: https://github.com/jupyterlab/jupyterlab/issues/16995\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\nPaste the output from running `jupyter troubleshoot` from the command line here.\r\nYou may want to sanitize the paths in the output.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\nPaste the output from your command line running `jupyter lab` here, use `--debug` if possible.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nPaste the output from your browser Javascript console here, if applicable.\r\n\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 758,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/outputarea/src/model.ts",
      "packages/outputarea/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/outputarea/test/model.spec.ts"
    ],
    "base_commit": "7ff8d16493f1c8b70cd76658aee80e9453c396a0",
    "head_commit": "1d8b3d7b3229005eab507628e668e9a35a000422",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17043",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17043",
    "dockerfile": "",
    "pr_merged_at": "2024-12-05T21:33:52.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17040",
    "pr_id": 17040,
    "issue_id": 160,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Refactor completion widget and update behaviors.\n- [x] When there is only one completion match, instead of rendering a completion widget just automatically fill in the value.\n- [x] Refactor the completion widget to use the `IOptions` and `IRenderer` pattern.\n- [x] Change the behavior of the up and down arrow keys when a completion widget is open: have them cycle through options instead of stopping at the first and last items. (This is, again, closer to what `IPython` does.)\n- [x] Switch console's completion to use the `CompletionHandler` class that the notebook uses to minimize repetition.\n- [x] Use `JSONObject` where applicable to use `deepEqual` checks.\n- [x] Write unit tests for completion widget, model, and handler.\n- [x] \"Tab should not pick-up a completion.\" https://github.com/jupyter/jupyterlab/issues/68 To expand: change the behavior of the tab key when a completion widget is open. When every available option has a common initial substring, the tab key will \"fill in\" the text up to that common substring. Any other tab `keydown` will select the currently active item.\n- [x] Peg completion widget's top position to the scroll position of its semantic parent.\n",
    "issue_word_count": 184,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "jupyterlab/tests/mock_packages/test-hyphens-underscore/yarn.lock"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/mock_packages/test-hyphens-underscore/yarn.lock"
    ],
    "base_commit": "7ff8d16493f1c8b70cd76658aee80e9453c396a0",
    "head_commit": "77a2fbdc4582a8da70cd4f6535589c6606ace3fa",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17040",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17040",
    "dockerfile": "",
    "pr_merged_at": "2024-12-06T22:37:58.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17030",
    "pr_id": 17030,
    "issue_id": 17022,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Improve performance of rendering stdout/stderr\n## References\r\n\r\n- another fix for performance regression reported in #16957\r\n- follow-up to https://github.com/jupyterlab/jupyterlab/pull/16975\r\n\r\n## Code changes\r\n\r\n- [x] Adds a test for a fast path discussed in https://github.com/jupyterlab/jupyterlab/issues/16957#issuecomment-2507653383\r\n   - I initially tried to implement test timing the performance but in that case it does not work as jsdom does not use a complied implementation for sanitization of `textContent` (it's not using a real browse) and also the ANSI parsing has quite some overhead when a match is detected so the fast test case even on `main` was faster than the test case for slow path\r\n- [x] Implements the fast path when logging without ASCII escapes\r\n\r\n## User-facing changes\r\n\r\nRendering the stdout and stderr will be faster\r\n\r\n| Browser | `4.3.0` | #16975 | #16975 + this PR |\r\n|--|--|--|--|\r\n| Chrome 131.0 | 67s | 25s | 19s |\r\n| Firefox 133.0 | 136s | 35s | 21s |\r\n\r\n<details>\r\n<summary>Test case</summary>\r\n\r\n```python\r\nimport logging\r\n\r\nlogger = logging.getLogger()\r\n\r\nfor i in range(4000):\r\n    logger.error(f\"{i} XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\")\r\n```\r\n\r\n</details>\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 174,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/rendermime/src/renderers.ts",
      "packages/rendermime/test/factories.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/rendermime/test/factories.spec.ts"
    ],
    "base_commit": "21bdfee0a89891b2dbf620aaaa4beba60cbdabd6",
    "head_commit": "51799a038f53f8557442a1fce9c0abb64a899d95",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17030",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17030",
    "dockerfile": "",
    "pr_merged_at": "2024-12-03T16:11:56.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17025",
    "pr_id": 17025,
    "issue_id": 17000,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix disappearing cells (heal offsets after updating estimated sizes)\n## References\r\n\r\nFixes #16978\r\n\r\n## Code changes\r\n\r\n- Do not set `_measuredAllUntilIndex` as a side effect in `_getItemMetadata` - this is wrong as we are not actually measuring sizes there, just estimating\r\n- Update offsets in `_getItemMetadata` after changing values in `_widgetSizers` by populating estimates sizes (this is a side effect which I think should not in this getter, but this PR is a hotfix and it is not feasible to write unit tests for these scenarios)\r\n\r\n## User-facing changes\r\n\r\nCells no longer disappear after copy-paste/dragging.\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 87,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts",
      "packages/notebook/src/windowing.ts",
      "packages/ui-components/src/components/windowedlist.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts"
    ],
    "base_commit": "31a2559e62d83c4b400db7cb303ccb465d8c3f9a",
    "head_commit": "9bf5a3e801669d694324de5013ffb1ab5d4afd83",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17025",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17025",
    "dockerfile": "",
    "pr_merged_at": "2024-12-02T21:25:51.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17024",
    "pr_id": 17024,
    "issue_id": 16982,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`Debugger Variables Copy` visual regression tests do not pass with Python 3.12\n```\r\nNotice:   3 failed\r\n    [jupyterlab] â€º test/jupyterlab/debugger.test.ts:192:7 â€º Debugger Variables â€º Copy to globals should work only for local variables \r\n    [jupyterlab] â€º test/jupyterlab/debugger.test.ts:252:7 â€º Debugger Variables â€º Copy to globals not available from kernel \r\n    [jupyterlab] â€º test/jupyterlab/debugger.test.ts:289:7 â€º Debugger Variables â€º Copy to clipboard â”€\r\n```",
    "issue_word_count": 52,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      ".github/workflows/galata.yml",
      "galata/test/jupyterlab/debugger.test.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/debugger.test.ts"
    ],
    "base_commit": "5cd092d0e329ceddaeb8bb38a7d399e80720b4a0",
    "head_commit": "5f8586fd7e6ba1dbfd4b1f86df8b19b5216bca0b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17024",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17024",
    "dockerfile": "",
    "pr_merged_at": "2024-12-03T16:59:04.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17016",
    "pr_id": 17016,
    "issue_id": 16975,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix regression in standard error rendering performance\n## References\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/issues/16957\r\n\r\n## Code changes\r\n\r\nAdds caching for results on the `linkify` method which is the most expensive step when streaming large errors and standard outputs. The second most expensive step is sanitization (parsing of HTML) but that cannot be cached without compromising security.\r\n\r\n## User-facing changes\r\n\r\n### Faster stdout\r\n\r\n| Iterations | Before | After |\r\n|--|--|--|\r\n| 1000 | 4s | 3s |\r\n| 2000 | 18s | 8s |\r\n| 3000 | 42s | 22s |\r\n| 4000 | 1min 23s | 41s |\r\n\r\n```python\r\nimport sys\r\n\r\nfor i in range(4000):\r\n    print(f\"example.com {i} XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX www.\", end='')\r\n    sys.stdout.flush()\r\n```\r\n\r\n### Faster stderr\r\n\r\n| Iterations | Before | After |\r\n|--|--|--|\r\n| 1000 | 2s | 1s |\r\n| 2000 | 7s | 3s |\r\n| 3000 | 16s | 7s |\r\n| 4000 | 30s | 13s |\r\n\r\n```python\r\nimport logging\r\n\r\nlogger = logging.getLogger()\r\n\r\nfor i in range(4000):\r\n    logger.error(f\"{i} XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\")\r\n```\r\n\r\nI had to increase `--ServerApp.iopub_msg_rate_limit` to `10000` as the stream was faster than `jupyter-server` was allowing for (\"IOPub message rate exceeded\").\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone\r\n",
    "issue_word_count": 149,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/rendermime/src/renderers.ts",
      "packages/rendermime/test/factories.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/rendermime/test/factories.spec.ts"
    ],
    "base_commit": "afcb358a00e517d759a2c3884064d3e10bdce12a",
    "head_commit": "bb111985f41011b5939833666c9eb7a1533d7028",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17016",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17016",
    "dockerfile": "",
    "pr_merged_at": "2024-11-29T12:44:24.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17010",
    "pr_id": 17010,
    "issue_id": 16988,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix emission of `FileBrowserModel.onFileChanged` for drives (including `RTC:`)\n## References\r\n\r\nFixes https://github.com/jupyterlab/jupyter-collaboration/issues/406.\r\n\r\n## Code changes\r\n\r\nWhen an operation is made on a file, we emit a signal if the file is in the current directory, which may trigger a refresh of the directory content. For instance, if a file is created, it immediately appears in the file browser, instead of after the next poll.\r\nTo check if the file is in the current directory, we compare the current file browser path with the path of the file. Both may have a drive prefix (e.g. `RTC:`). To get the directory of the file, we use `PathExt.dirname()` which seems to strip the drive prefix. But the current file browser path has the drive prefix, so the outcome is that we always think that the file is not in the current directory.\r\nThis PR removes the drive prefix of the current file browser path when making this comparison.\r\n\r\n## User-facing changes\r\n\r\nOperations such as creating a file or uploading a file look immediate in the file browser, for custom drives that have a prefix.\r\n## Backwards-incompatible changes\r\n\r\nNone.",
    "issue_word_count": 184,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/model.ts",
      "packages/filebrowser/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/model.spec.ts"
    ],
    "base_commit": "97a08e6cd28345e032a8d0ac519b1e175e55c578",
    "head_commit": "20bc07c302e46efe5d1bec3804ccd173c17774c4",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17010",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17010",
    "dockerfile": "",
    "pr_merged_at": "2024-11-29T12:44:11.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17005",
    "pr_id": 17005,
    "issue_id": 16928,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Missed first keystroke on Ctrl+F when switching between notebook tabs\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\nThe first keystroke is missed when typing in an existing/previously opened search box after switching focus to it via keyboard shortcut Ctrl+F.\r\n\r\nExamples:\r\n1. When switching between notebook tabs and using Ctrl+F to bring up or switch focus to the search bo\r\n[jupyter_troubleshoot.txt](https://github.com/user-attachments/files/17639963/jupyter_troubleshoot.txt)\r\nx, the first keystroke is often missed (easy to reproduce).\r\n2. Within the same notebook tab where an existing searchbox is open, switching focus between cells and search box via Ctrl+F shortcut, sometimes the first keystroke is missed. (inconsistent, harder to reproduce)\r\n\r\n## Reproduce\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n1. Have multiple notebook tabs open\r\n2. Use Ctrl+F to bring up search box and start typing. This should work fine with no missed keystrokes\r\n3. Repeat step 2 for each open notebook tab to open the search box for the first time\r\n4. Once all notebook tabs have a search box open, switch tabs and use Ctrl+F to switch focus to the search box, start typing and the first keystroke should be missed\r\n\r\n![missed_keystroke](https://github.com/user-attachments/assets/261d87ae-7e2e-4d43-b183-176cee579d64)\r\n\r\nIn the gif above I'm typing 'test' every time I switch focus to the search box via keyboard shortcut Ctrl+F. You can see that after the first pass of opening the search box on each tab, the subsequent tab cycles show 'est' in the search box because the first 't' keystroke was missed.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\n<!--Describe what you expected to happen-->\r\nFirst keystroke is not missed when switching focus to existing search box using Ctrl+F keyboard shortcut.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Image: quay.io/jupyter/base-notebook:2024-11-04\r\n- Operating System and version: Image runs Ubuntu 24.04\r\n- Browser and version: Reproducible in Firefox 132.0.1, Edge 130.0.2849.68, Chrome 130.0.6723.92\r\n- JupyterLab version: 4.2.5, but also reproducible on 4.2.1, 4.0.5, 4.3.0 etc\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n[jupyter_troubleshoot.txt](https://github.com/user-attachments/files/17640014/jupyter_troubleshoot.txt)\r\n\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n[jupyter_debug.txt](https://github.com/user-attachments/files/17639954/jupyter_debug.txt)\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nNothing printed on browser JavaScript console\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 485,
    "test_files_count": 2,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-search.test.ts",
      "packages/documentsearch/src/searchmodel.ts",
      "packages/documentsearch/src/searchview.tsx",
      "packages/documentsearch/test/searchmodel.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-search.test.ts",
      "packages/documentsearch/test/searchmodel.spec.ts"
    ],
    "base_commit": "3734d46ca95577f32859b1cebfab33c69c379f75",
    "head_commit": "a7119901592bde98012982ef933b828d9eae2b5e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17005",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17005",
    "dockerfile": "",
    "pr_merged_at": "2024-12-03T09:23:37.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17001",
    "pr_id": 17001,
    "issue_id": 16988,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix emission of `FileBrowserModel.onFileChanged` for drives (including `RTC:`)\n## References\r\n\r\nFixes https://github.com/jupyterlab/jupyter-collaboration/issues/406.\r\n\r\n## Code changes\r\n\r\nWhen an operation is made on a file, we emit a signal if the file is in the current directory, which may trigger a refresh of the directory content. For instance, if a file is created, it immediately appears in the file browser, instead of after the next poll.\r\nTo check if the file is in the current directory, we compare the current file browser path with the path of the file. Both may have a drive prefix (e.g. `RTC:`). To get the directory of the file, we use `PathExt.dirname()` which seems to strip the drive prefix. But the current file browser path has the drive prefix, so the outcome is that we always think that the file is not in the current directory.\r\nThis PR removes the drive prefix of the current file browser path when making this comparison.\r\n\r\n## User-facing changes\r\n\r\nOperations such as creating a file or uploading a file look immediate in the file browser, for custom drives that have a prefix.\r\n## Backwards-incompatible changes\r\n\r\nNone.",
    "issue_word_count": 184,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/model.ts",
      "packages/filebrowser/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/model.spec.ts"
    ],
    "base_commit": "4f39ffe1961f7c9dac28df86e8673e5d2e7e36f8",
    "head_commit": "9eb08f27d7139ae92f78dc18e3166a4f78fc7f98",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17001",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17001",
    "dockerfile": "",
    "pr_merged_at": "2024-11-26T14:12:25.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-17000",
    "pr_id": 17000,
    "issue_id": 16978,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Disappearing cells regression in JupyterLab 4.3.1\n\r\n\r\n## Description\r\n\r\nThis was reported in Jupyter Notebook - https://github.com/jupyter/notebook/issues/7523. I narrowed it down based on logs to two issues:\r\n- notebook rendering crashes due to uncaught bad offsets regression\r\n- scroll offset is not correctly set after some operations (to be determined)\r\n\r\n## Reproduce\r\n\r\nTBD. So far I understand that this affects notebooks:\r\n- with cells which have very long outputs (this is considerably longer larger than viewport height)\r\n- at least as many cells to fit the viewport a few times\r\n- with `full` windowing mode enabled\r\n\r\n## Expected behavior\r\n\r\n- Windowing never breaks render even if the algorithms encounters an edge case/race condition\r\n- scroll offsets are always correctly populated\r\n\r\n## Context\r\n\r\n- Browser and version: All browsers are affected\r\n- JupyterLab version: 4.3.1",
    "issue_word_count": 122,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts",
      "packages/notebook/src/windowing.ts",
      "packages/ui-components/src/components/windowedlist.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts"
    ],
    "base_commit": "3734d46ca95577f32859b1cebfab33c69c379f75",
    "head_commit": "e6822d10820ff4b1ea67460f5904bd0321a97148",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/17000",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/17000",
    "dockerfile": "",
    "pr_merged_at": "2024-12-02T20:44:22.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16988",
    "pr_id": 16988,
    "issue_id": 406,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Check for coherence between command names between console and notebook\n",
    "issue_word_count": 10,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/model.ts",
      "packages/filebrowser/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/model.spec.ts"
    ],
    "base_commit": "006a459698a01a007759316aa08c25fe40f70725",
    "head_commit": "74a69ed77998f6e6c904a091288b02142c4f456b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16988",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16988",
    "dockerfile": "",
    "pr_merged_at": "2024-11-26T13:20:07.000Z",
    "patch": "diff --git a/packages/filebrowser/src/model.ts b/packages/filebrowser/src/model.ts\nindex 3d7832fbd7e0..6b3636b6327f 100644\n--- a/packages/filebrowser/src/model.ts\n+++ b/packages/filebrowser/src/model.ts\n@@ -609,10 +609,15 @@ export class FileBrowserModel implements IDisposable {\n     const path = this._model.path;\n     const { sessions } = this.manager.services;\n     const { oldValue, newValue } = change;\n+    const prefix = this.driveName.length > 0 ? this.driveName + ':' : '';\n     const value =\n-      oldValue && oldValue.path && PathExt.dirname(oldValue.path) === path\n+      oldValue &&\n+      oldValue.path &&\n+      prefix + PathExt.dirname(oldValue.path) === path\n         ? oldValue\n-        : newValue && newValue.path && PathExt.dirname(newValue.path) === path\n+        : newValue &&\n+          newValue.path &&\n+          prefix + PathExt.dirname(newValue.path) === path\n         ? newValue\n         : undefined;\n \n",
    "test_patch": "diff --git a/packages/filebrowser/test/model.spec.ts b/packages/filebrowser/test/model.spec.ts\nindex 60f8fdd79227..dc3acbb4c5b2 100644\n--- a/packages/filebrowser/test/model.spec.ts\n+++ b/packages/filebrowser/test/model.spec.ts\n@@ -152,6 +152,28 @@ describe('filebrowser/model', () => {\n         expect(called).toBe(true);\n       });\n \n+      it('should be emitted when a file is created in a drive with a name', async () => {\n+        await state.clear();\n+        const driveName = 'RTC';\n+        const modelWithName = new FileBrowserModel({\n+          manager,\n+          state,\n+          driveName\n+        });\n+\n+        let called = false;\n+        modelWithName.fileChanged.connect((sender, args) => {\n+          expect(sender).toBe(modelWithName);\n+          expect(args.type).toBe('new');\n+          expect(args.oldValue).toBeNull();\n+          expect(args.newValue!.type).toBe('file');\n+          called = true;\n+        });\n+        await manager.newUntitled({ type: 'file' });\n+        expect(called).toBe(true);\n+        modelWithName.dispose();\n+      });\n+\n       it('should be emitted when a file is renamed', async () => {\n         let called = false;\n         model.fileChanged.connect((sender, args) => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16975",
    "pr_id": 16975,
    "issue_id": 16957,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Logging to stderr is significantly slower in Jupyterlab vs IPython\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nLogging content to stderr is quite slow inside jupyterlab. Consider the following snippet - \r\n\r\n```python\r\nimport logging\r\n\r\nlogger = logging.getLogget()\r\n\r\nfor i in range(1000):\r\n    logger.error(f\"{i} XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\")\r\n```\r\n\r\nThis takes only a few milliseconds to execute in an IPython session but takes several seconds to execute in JupyterLab. FWIW, the execution time in the `nbclassic` UI is similar to IPython.\r\n\r\n## Reproduce\r\n\r\nRun the above snippet in lab and IPython (or even nbclassic)\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\nThe time taken in JupyterLab should be similar to IPython (or even nbclassic).\r\n<!--Describe what you expected to happen-->\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.3.0b3",
    "issue_word_count": 157,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/rendermime/src/renderers.ts",
      "packages/rendermime/test/factories.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/rendermime/test/factories.spec.ts"
    ],
    "base_commit": "f28b4145d421560b95ee95988c1310d13eafab14",
    "head_commit": "7485ba23c3d2b4b955c085fb4feae133f4a318bb",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16975",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16975",
    "dockerfile": "",
    "pr_merged_at": "2024-11-29T11:36:14.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16966",
    "pr_id": 16966,
    "issue_id": 16950,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix total size estimation in full windowing mode to reduce scrollbar jitter\n## References\r\n\r\nAlleviates issues caused by the rendered outputs or cells changing height:\r\n- https://github.com/jupyterlab/jupyterlab/issues/16326\r\n- https://github.com/jupyter-book/jupyterlab-myst/issues/243\r\n\r\n## Code changes\r\n\r\n1) Previously if height of a cell in the middle of the notebook changed then the sizes and offsets of all subsequent cells were discarded. After change the offset delta is instead computed and subsequent sizes and offsets are adjusted rather than being discarded.\r\n\r\n2) Previously the size estimates were only stored after the viewport window was moved away from initial null position; this constraint was now reduced to also store sizes when windowing is active but window size has not been computed yet.\r\n\r\n3) Previously if new cell was added  (or a cell was removed/type of a cell was changed) the height estimates were discarded for the purpose of scrollbar size calculation; with this PR this is no longer the case (3341517)\r\n\r\n## User-facing changes\r\n\r\n| Before (4.3.0) | After (this PR) |\r\n|--|--|\r\n| ![before](https://github.com/user-attachments/assets/2ea3ee46-9930-4d4a-8f87-28c21e2c44a3) | ![after](https://github.com/user-attachments/assets/468cfe63-d3da-4350-9d9e-6612e9010872) |\r\n\r\nBefore this change the total scrollbar length was reset after changing height of any cell other than the last. This was causing very jittrery scroll as the scrollbar height was changing as the notebook was scrolled.\r\n\r\n| Before (4.3.0) | After (this PR) |\r\n|--|--|\r\n| ![before](https://github.com/user-attachments/assets/ef7480dc-8485-4c44-8b15-2cc95238258e) | ![after](https://github.com/user-attachments/assets/979dfa0c-1755-4f90-9ce0-be4a145a466b) |\r\n\r\n\r\n## Backwards-incompatible changes\r\n\r\nNone",
    "issue_word_count": 259,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/ui-components/src/components/windowedlist.ts",
      "packages/ui-components/test/windowedlist.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/ui-components/test/windowedlist.spec.ts"
    ],
    "base_commit": "14a6f52af906b4fc63d6693b1ba0df8f3e876571",
    "head_commit": "e7ef8d31ee19bbeecadb847259a325547a330409",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16966",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16966",
    "dockerfile": "",
    "pr_merged_at": "2024-11-16T00:08:47.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16963",
    "pr_id": 16963,
    "issue_id": 16882,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Support kernel subshells (JEP91)\n[Jupyter Enhancement Proposal 91](https://github.com/ipython/ipykernel/pull/1249) was recently accepted, introducing the idea of kernel subshells which are separate threads of execution running in the same process and hence share the same namespace. An example of their use would be when running a long calculation one could create a new subshell to check on progress in that calculation. IPyKernel `main` branch contains a minimal implementation of kernel subshells (ipython/ipykernel#1249) that is backward compatible and will be included in the upcoming IPyKernel 7 release. Hopefully there will be an alpha release available soon (ipython/ipykernel#1274) for testing purposes.\r\n\r\nI propose to make kernel subshell functionality available in JupyterLab so that developers and end users can experiment with it. The idea is that the context menu for a running kernel notebook or console will include an option to create a new subshell of that kernel in a new console. There is a primitive video of this at https://github.com/jupyter/enhancement-proposals/pull/91#issuecomment-1924380771 (although the surrounding discussion is somewhat out of date).\r\n\r\nI intend to add a new boolean flag (`--LabApp.kernel_subshells` perhaps) which is `False` by default so that devs/users will have to explicitly opt into the new functionality, and if `False` there will be no change to existing UI and behaviour. Kernels self-advertise their support for subshells by including `supported_features: ['kernel subshells']` in their `kernel_info_reply` messages ([JEP92](https://github.com/jupyter/enhancement-proposals/pull/92)), and again without that there will be no change to existing UI and behaviour for a particular kernel.\r\n\r\n`IKernelConnection` will need a new optional string attribute `subshellId`, this will be `null` (or `undefined`) for the main subshell. For a subshell this is in the reply to a `create_subshell_request` message. The `subshellId` is an optional parameter of e.g. `execute_request` messages to indicate which subshell the code should be run in.\r\n\r\nI am starting work on this straight away. If anyone needs any clarification then please don't hesitate to ask.",
    "issue_word_count": 338,
    "test_files_count": 3,
    "non_test_files_count": 11,
    "pr_changed_files": [
      ".eslintrc.js",
      ".github/workflows/galata.yml",
      "galata/jupyter_server_test_config.py",
      "galata/test/jupyterlab/kernel.test.ts",
      "jupyterlab/labapp.py",
      "packages/console-extension/src/index.ts",
      "packages/notebook-extension/schema/tracker.json",
      "packages/notebook-extension/src/index.ts",
      "packages/services/src/kernel/comm.ts",
      "packages/services/src/kernel/default.ts",
      "packages/services/src/kernel/kernel.ts",
      "packages/services/src/kernel/messages.ts",
      "packages/services/test/kernel/ikernel.spec.ts",
      "scripts/ci_install.sh"
    ],
    "pr_changed_test_files": [
      "galata/jupyter_server_test_config.py",
      "galata/test/jupyterlab/kernel.test.ts",
      "packages/services/test/kernel/ikernel.spec.ts"
    ],
    "base_commit": "7e0189f3c4dc960cd7f2f7c45d8dd3d42368a148",
    "head_commit": "cd4fcdf51d41370ff45bdc4763db39b1a9a1eecd",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16963",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16963",
    "dockerfile": "",
    "pr_merged_at": "2025-01-06T07:35:09.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16960",
    "pr_id": 16960,
    "issue_id": 16953,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix prefix removal when reconciling completions from multiple sources\n## References\r\n\r\nFixes https://github.com/jupyterlab/jupyterlab/issues/16951\r\n\r\n## Code changes\r\n\r\nAccounts for the offset of the line for which completion was requested (where the cursor is).\r\n\r\n## User-facing changes\r\n\r\n| Before | After |\r\n|--|--|\r\n| ![before](https://github.com/user-attachments/assets/dc53f510-19f9-46db-9eb7-e436c4ae1aa0) | ![after](https://github.com/user-attachments/assets/8bee2a31-6e91-47d6-ba2e-4701d3a7b32a) |\r\n\r\n\r\n## Backwards-incompatible changes\r\n\r\n\r\nNone",
    "issue_word_count": 60,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/completer/src/reconciliator.ts",
      "packages/metapackage/test/completer/reconciliator.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/metapackage/test/completer/reconciliator.spec.ts"
    ],
    "base_commit": "a33465d9346c23b796b7c65c20454c9c82a62b0f",
    "head_commit": "5f096d6c82f0ac1648187cc093ccda3593e8ccb8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16960",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16960",
    "dockerfile": "",
    "pr_merged_at": "2024-11-14T11:05:22.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16955",
    "pr_id": 16955,
    "issue_id": 16943,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Disable paste for read-only markdown cells & fix replace all for markdown cells\nFixes https://github.com/jupyterlab/jupyterlab/issues/11124\r\n\r\nAnd for the issue https://github.com/jupyterlab/jupyterlab/issues/16925, the PR - https://github.com/jupyterlab/jupyterlab/pull/16940 did not address the issue for markdown cells; so, I have addressed those changes too in this PR.",
    "issue_word_count": 46,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "packages/cells/src/searchprovider.ts",
      "packages/cells/src/widget.ts",
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "base_commit": "b3c694de5256cdb1b1ca06d8072dd82e94c9d9f5",
    "head_commit": "ea97879188d0765d1f60b95ada292ed324bbd19c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16955",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16955",
    "dockerfile": "",
    "pr_merged_at": "2024-11-12T16:12:30.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16953",
    "pr_id": 16953,
    "issue_id": 16951,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Completer reconciliator prefix removal is incorrect in second and following lines\n## Description\r\n\r\nThe prefix extraction in:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/017ae3ffe5f687185cbf7b931440adfd7924fca7/packages/completer/src/reconciliator.ts#L229\r\n\r\ndoes not account for previous lines and therefore extracts incorrect fragments.\r\n\r\n## Reproduce\r\n\r\n1. Install ipython 8.27.0\r\n2. Disable jedi: `%config IPCompleter.use_jedi=False`\r\n3. Type two lines into a single cell:\r\n```python\r\nfrom_keys_1 = 0\r\ndict.fr\r\n```\r\n4. Press tab and enter\r\n5. See the result is `dict..fromkeys` \r\n\r\n![repro](https://github.com/user-attachments/assets/5946b157-4a64-4198-ace7-bff62fa48b45)\r\n\r\n## Expected behavior\r\n\r\nThe result is `dict.fromkeys`\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.3.0\r\n",
    "issue_word_count": 93,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/completer/src/reconciliator.ts",
      "packages/metapackage/test/completer/reconciliator.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/metapackage/test/completer/reconciliator.spec.ts"
    ],
    "base_commit": "017ae3ffe5f687185cbf7b931440adfd7924fca7",
    "head_commit": "b8bee4f0d8afe69b2f602e10dceccf3e91d96870",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16953",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16953",
    "dockerfile": "",
    "pr_merged_at": "2024-11-14T09:37:33.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16948",
    "pr_id": 16948,
    "issue_id": 16903,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Maintain autosave timers while disconnected\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n \r\nFixes #16798.\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\n\r\nThe autosave feature works by starting a timer.  When the timer expires, it clears itself; then, if the session is connected, it attempts a save (which then restarts the timer for the next save).  However, if the session is disconnected, the timer never gets restarted - this code just calls `_setTimer()` in that case.\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\n",
    "issue_word_count": 175,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/docmanager/src/savehandler.ts",
      "packages/docmanager/test/savehandler.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/docmanager/test/savehandler.spec.ts"
    ],
    "base_commit": "0d8446aa3504f166679e66b0abf8bce6154233dc",
    "head_commit": "6880456803258b7bbe5740699bf72e641b61b093",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16948",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16948",
    "dockerfile": "",
    "pr_merged_at": "2024-11-11T10:52:41.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16947",
    "pr_id": 16947,
    "issue_id": 16903,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Maintain autosave timers while disconnected\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n \r\nFixes #16798.\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\n\r\nThe autosave feature works by starting a timer.  When the timer expires, it clears itself; then, if the session is connected, it attempts a save (which then restarts the timer for the next save).  However, if the session is disconnected, the timer never gets restarted - this code just calls `_setTimer()` in that case.\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\n\r\n## User-facing changes\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\n",
    "issue_word_count": 175,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/docmanager/src/savehandler.ts",
      "packages/docmanager/test/savehandler.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/docmanager/test/savehandler.spec.ts"
    ],
    "base_commit": "2d687046d6f1d47f721e51f58a86d531c19c792c",
    "head_commit": "eb376d68df2aeece9aabd364d1c9cfd0ff7f5086",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16947",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16947",
    "dockerfile": "",
    "pr_merged_at": "2024-11-11T10:50:37.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16940",
    "pr_id": 16940,
    "issue_id": 16925,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`Find and Replace` / `Use Regular Expressions` / `Replace All`: reference groups are NOT handled correctly\nReporting this issue upstream: https://github.com/jupyter/notebook/issues/7503",
    "issue_word_count": 11,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/cells/src/searchprovider.ts",
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "base_commit": "c331d62ef120892d5c0f21c4ab62fdb24423c62e",
    "head_commit": "7c6814b5c09c98e4f6b43a9d72d80ed6b8561624",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16940",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16940",
    "dockerfile": "",
    "pr_merged_at": "2024-11-08T09:36:30.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16938",
    "pr_id": 16938,
    "issue_id": 16863,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Fix triggering completer on the beginning of the lines\n<!--\r\nThanks for contributing to JupyterLab!\r\nPlease fill out the following items to submit a pull request.\r\nSee the contributing guidelines for more information:\r\nhttps://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\r\n-->\r\n\r\n## References\r\n\r\nCloses #16847\r\n\r\n<!-- Note issue numbers this pull request addresses (should be at least one, see contributing guidelines above). -->\r\n\r\n<!-- Note any other pull requests that address this issue and how this pull request is different. -->\r\n\r\n## Code changes\r\n\r\n<!-- Describe the code changes and how they address the issue. -->\r\n\r\nRemoves logic in completer that removes `COMPLETER_ENABLED_CLASS` if `!line`. Also updates logic to check if line exists before checking line slice logic. These fix the issue by making sure that the cell has the appropriate class to allow the completer enable command ID to function.\r\n\r\n## User-facing changes\r\n\r\nUser will be able to activate the completer on an empty line. Functionally, a user should not notice any changes unless they are using jupyter-ai since the history completer will return an empty list at this point.\r\n\r\n<!-- Describe any visual or user interaction changes and how they address the issue. -->\r\n\r\n<!-- For visual changes, include before and after screenshots or GIF/mp4/other video demo here. -->\r\n\r\n## Backwards-incompatible changes\r\n\r\n<!-- Describe any backwards-incompatible changes to JupyterLab public APIs. -->\r\nNone that I am aware\r\n",
    "issue_word_count": 210,
    "test_files_count": 4,
    "non_test_files_count": 8,
    "pr_changed_files": [
      "docs/source/developer/css.rst",
      "galata/test/documentation/general.test.ts-snapshots/shortcuts-help-documentation-linux.png",
      "galata/test/jupyterlab/completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts",
      "packages/codeeditor/src/tokens.ts",
      "packages/codemirror/src/commands.ts",
      "packages/completer/src/default/inlinehistoryprovider.ts",
      "packages/completer/src/handler.ts",
      "packages/console-extension/schema/completer.json",
      "packages/fileeditor-extension/schema/completer.json",
      "packages/metapackage/test/completer/handler.spec.ts",
      "packages/notebook-extension/schema/completer.json"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts-snapshots/shortcuts-help-documentation-linux.png",
      "galata/test/jupyterlab/completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts",
      "packages/metapackage/test/completer/handler.spec.ts"
    ],
    "base_commit": "ee84921b644f55effab0875e510299773ec66f8b",
    "head_commit": "c12fe57ec93ce82c8055e05d4021a629ebf60988",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16938",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16938",
    "dockerfile": "",
    "pr_merged_at": "2024-11-08T09:37:16.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16903",
    "pr_id": 16903,
    "issue_id": 16798,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "fix for report of auto-save not working?\nhello - did the fix proposed in https://discourse.jupyter.org/t/auto-save-does-not-always-work/24756 ever get submitted (and merged into) JupyterLab?\r\n\r\nI have gotten a similar report from a user on one of our Jupyter instances (JupyterLab 4.2.4, JupyterHub 5.1.0), though we have not been able to reproduce the issue.",
    "issue_word_count": 58,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/docmanager/src/savehandler.ts",
      "packages/docmanager/test/savehandler.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/docmanager/test/savehandler.spec.ts"
    ],
    "base_commit": "9cc6267d2e366390b861f725e5eca3ae04e86de9",
    "head_commit": "a767a830475c1a996fdd08897db053b2f125a521",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16903",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16903",
    "dockerfile": "",
    "pr_merged_at": "2024-11-11T09:42:01.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16896",
    "pr_id": 16896,
    "issue_id": 16895,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Export custom settings to an `overrides.json` from the Settings Editor\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n<!--\r\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\r\n\r\n\r\nBefore creating a new feature request please search the issues for relevant feature requests.\r\n-->\r\n\r\n### Problem\r\n\r\nCurrently it can be quite a bit of work to construct an [`overrides.json`](https://jupyterlab.readthedocs.io/en/latest/user/directories.html#overrides-json) file by hand.\r\n\r\nIf a user would then like to encode this set of custom settings in a config file, it can become quite tedious to find the values and copy them by hand to an `overrides.json`.\r\n\r\n### Proposed Solution\r\n\r\nSometimes the good set of custom settings is found by trial and error, by modifying the settings via the Settings Editor, and see what effect they have in JupyterLab.\r\n\r\nIt could be useful to have a button to export the list of custom settings to an `overrides.json`, for example on the left side of the settings editor toolbar:\r\n\r\n![image](https://github.com/user-attachments/assets/9c12717d-3d99-4468-86b1-71ead44ae485)\r\n\r\n\r\n### Additional context\r\n\r\nSome comments in the following two issues seem to be talking about such export functionality:\r\n\r\n- https://github.com/jupyterlab/jupyterlab/issues/8148\r\n- https://github.com/jupyterlab/jupyterlab/pull/11079\r\n",
    "issue_word_count": 244,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/jupyterlab/settings.test.ts",
      "packages/settingeditor-extension/src/index.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/jupyterlab/settings.test.ts"
    ],
    "base_commit": "090fe7383422b59588f0337fe0b5ee0d74899204",
    "head_commit": "497f01736606c721f4a841c5c35f796f2d14885c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16896",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16896",
    "dockerfile": "",
    "pr_merged_at": "2024-11-05T07:59:12.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16878",
    "pr_id": 16878,
    "issue_id": 16837,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Improve the `check-links` check on CI\nThe `check-links` check has been failing on CI for the past few days with the following error:\r\n\r\n![image](https://github.com/user-attachments/assets/80e6cfeb-6c15-448f-8ab6-72a82d3d287c)\r\n\r\n```\r\nFFFFF                                                                    [ 80%]\r\n=================================== FAILURES ===================================\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+4 _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+4: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Mime+Renderers _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Mime+Renderers: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt: 429: Too Many Requests\r\n=========================== short test summary info ============================\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+4>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Mime+Renderers>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt>\r\n5 failed, 14 deselected in 1.06s\r\n```\r\n\r\nExample: https://github.com/jupyterlab/jupyterlab/actions/runs/11217234581/job/31178326655?pr=16765\r\n\r\nIt looks like it should solve itself over time, but if it keeps failing consistently maybe we should ignore the `pypi.org` link for now?",
    "issue_word_count": 507,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "c9b0f6d8c3f2ea36cf37ef11312502bc50e1ab78",
    "head_commit": "56f2ff077ff1625a4742c4e275a6ca130ae646df",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16878",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16878",
    "dockerfile": "",
    "pr_merged_at": "2024-10-18T15:58:39.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16870",
    "pr_id": 16870,
    "issue_id": 14623,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Better handling of the file browser configuration\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nCurrently the file browser sets its own default config here:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/d98ef15bfa916309c82d105a5d442d915d5dd1df/packages/filebrowser-extension/src/index.ts#L219-L247\r\n\r\nSince this happens at application startup, it can override other configuration set in different plugins.\r\n\r\n\r\n## Reproduce\r\n\r\nIn a separate plugin (for example in a custom third-party extension), use `browser.showFileCheckboxes = true` to show the file browser checkboxes by default on application startup.\r\n\r\nHowever because of the current logic with the code snippet above the default configuration will be applied again when the plugin activates.\r\n\r\nIn the following screencast we see how the checkboxes first appear and then quickly disappear:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/assets/591645/0c7dc958-2fba-4441-81ef-86db77f26002\r\n\r\n\r\n\r\n## Expected behavior\r\n\r\nOther plugins should be allowed to use public setters like `browser.showFileCheckboxes = true` to customize the behavior of the file browser, when there is no user setting available.\r\n\r\nIf there is a value in the settings, then it takes precedence.\r\n\r\n## Context\r\n\r\nThis is an issue in Notebook 7 which has to use the settings to store its default values for the file browser (checkboxes, file size column, sort notebooks first). For example: https://github.com/jupyter/notebook/pull/6892\r\n\r\nHowever since these settings are also shared with JupyterLab, they also apply in the JupyterLab interface.\r\n\r\nThe idea would be for Notebook 7 to be able to customize with the following without having the configuration being overridden by the default lab plugin:\r\n\r\n```ts\r\nbrowser.showFileCheckboxes = true\r\nbrowser.sortNotebookFirst = true\r\nbrowser.showFileSizeColumn = true\r\n```",
    "issue_word_count": 288,
    "test_files_count": 16,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png",
      "packages/filebrowser-extension/src/index.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png"
    ],
    "base_commit": "c9b0f6d8c3f2ea36cf37ef11312502bc50e1ab78",
    "head_commit": "211cc6a0d2beb98302f6361ca3d8ed8a431638f8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16870",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16870",
    "dockerfile": "",
    "pr_merged_at": "2024-10-21T11:36:25.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16866",
    "pr_id": 16866,
    "issue_id": 16865,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Bracket highlighting not working for multiple-line Python string literal concatenation\n## Description\r\nWhen you have strings on multiple lines with 1 f-string not on the last line, bracket highlighting doesn't work although it's valid syntax. \r\nIt only works properly if the f-string is on the last line.\r\n\r\nhttps://github.com/user-attachments/assets/2e24db2f-5637-4af5-bcb9-38dfb243de58\r\n\r\nI reported this issue upstream at https://github.com/codemirror/dev/issues/1454 and found upgrading @lezer/python dependency resolved this.\r\n\r\n## Reproduce\r\n1. Type any pair of brackets `()` `[]` `{}`\r\n2. Type strings on multiple lines with 1 f-string not on the last line\r\n\r\n## Expected behavior\r\nBracket highlighting works properly\r\n\r\n## Context\r\n- Operating System and version: Windows 11\r\n- Browser and version: JupyterLab Desktop 4.2.5-1 (latest)\r\n- JupyterLab version: 4.2.5 (latest)",
    "issue_word_count": 123,
    "test_files_count": 8,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "examples/notebook/example.spec.ts-snapshots/example-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-all-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-in-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/highlight-previous-element-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-selected-text-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-two-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-deleted-cell-jupyterlab-linux.png",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-all-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-replace.test.ts-snapshots/replace-in-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/highlight-previous-element-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-selected-text-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-in-two-selected-cells-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-deleted-cell-jupyterlab-linux.png"
    ],
    "base_commit": "37ddf0961b12050b3e432bf04b9f615fd5b2ee48",
    "head_commit": "f82890bbb81ca4b24e9949952332e6596a614f71",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16866",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16866",
    "dockerfile": "",
    "pr_merged_at": "2024-10-21T12:46:50.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16863",
    "pr_id": 16863,
    "issue_id": 16847,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Code completer (inline/auto) only triggers if a character is already present in the line\n## Description\r\n\r\nCode completer (inline/auto) only triggers if a character is already present in the line\r\n\r\n## Reproduce\r\n\r\n1. Enable auto-completion \r\n![Screenshot from 2024-10-09 10-28-59](https://github.com/user-attachments/assets/398467bf-9028-4afe-b9aa-9b5c8a9d496c)\r\n2. Follow the screencast:\r\n![completer-only-triggers-on-second-char](https://github.com/user-attachments/assets/06839c10-5443-4f26-87d9-58604ea25f9a)\r\n\r\nand\r\n\r\n1. Enable inline-completion: \r\n![Screenshot from 2024-10-09 10-28-49](https://github.com/user-attachments/assets/5158bd10-61ba-4306-beaa-be2832e50b3b)\r\n2. Follow the screencast:\r\n![inline-completer-does-not-triggers-on-empty-line](https://github.com/user-attachments/assets/5c6fe070-613c-43ad-a327-520455937ecd)\r\n\r\n## Expected behavior\r\n\r\n- Auto-completion triggers after first character\r\n- Inline completion can be triggered on empty line\r\n\r\n## Context\r\n\r\n- Operating System and version: Ubuntu\r\n- Browser and version: Chrome 129\r\n- JupyterLab version: 4.3.0b3\r\n",
    "issue_word_count": 140,
    "test_files_count": 4,
    "non_test_files_count": 8,
    "pr_changed_files": [
      "docs/source/developer/css.rst",
      "galata/test/documentation/general.test.ts-snapshots/shortcuts-help-documentation-linux.png",
      "galata/test/jupyterlab/completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts",
      "packages/codeeditor/src/tokens.ts",
      "packages/codemirror/src/commands.ts",
      "packages/completer/src/default/inlinehistoryprovider.ts",
      "packages/completer/src/handler.ts",
      "packages/console-extension/schema/completer.json",
      "packages/fileeditor-extension/schema/completer.json",
      "packages/metapackage/test/completer/handler.spec.ts",
      "packages/notebook-extension/schema/completer.json"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts-snapshots/shortcuts-help-documentation-linux.png",
      "galata/test/jupyterlab/completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts",
      "packages/metapackage/test/completer/handler.spec.ts"
    ],
    "base_commit": "e74ec5a798db0bd670e5193917277ce379825e39",
    "head_commit": "2f639634f20fdfe8ae906c6dd6f7a03132bf3d4c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16863",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16863",
    "dockerfile": "",
    "pr_merged_at": "2024-11-07T11:30:11.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16846",
    "pr_id": 16846,
    "issue_id": 11547,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Status bar is overpopulated with information already on the screen\nIt seems that a lot of the information currently shown in the status bar is not really necessary since it is already elsewhere on the page.\r\n\r\n<img width=\"898\" alt=\"Screenshot 2021-11-25 at 11 22 17\" src=\"https://user-images.githubusercontent.com/2397974/143424127-faeb7986-827e-47b2-ad5c-bd01f24b8628.png\">\r\n\r\nWe could easily remove:\r\n - kernel status,\r\n - notebook name,\r\n - the button that opens the left panel for open tabs, kernels, and terminal.\r\n\r\nThen we could start using that real estate for other information.",
    "issue_word_count": 84,
    "test_files_count": 9,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "packages/apputils-extension/schema/running-sessions-status.json",
      "packages/apputils-extension/src/statusbarplugin.ts",
      "packages/apputils/src/runningSessions.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png"
    ],
    "base_commit": "a3629937078ad30030ed28f88471fa75c0919039",
    "head_commit": "2431a2d3746deef647528033faaa88b6e84d69d8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16846",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16846",
    "dockerfile": "",
    "pr_merged_at": "2025-01-24T21:00:24.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16843",
    "pr_id": 16843,
    "issue_id": 16837,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Improve the `check-links` check on CI\nThe `check-links` check has been failing on CI for the past few days with the following error:\r\n\r\n![image](https://github.com/user-attachments/assets/80e6cfeb-6c15-448f-8ab6-72a82d3d287c)\r\n\r\n```\r\nFFFFF                                                                    [ 80%]\r\n=================================== FAILURES ===================================\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+4 _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+4: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Mime+Renderers _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Mime+Renderers: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt: 429: Too Many Requests\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst: https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt _\r\nhttps://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt: 429: Too Many Requests\r\n=========================== short test summary info ============================\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+4>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Mime+Renderers>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt>\r\nFAILED docs/source/user/extensions.rst::/home/runner/work/jupyterlab/jupyterlab/docs/source/user/extensions.rst <a href=https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab+%3A%3A+Extensions+%3A%3A+Prebuilt>\r\n5 failed, 14 deselected in 1.06s\r\n```\r\n\r\nExample: https://github.com/jupyterlab/jupyterlab/actions/runs/11217234581/job/31178326655?pr=16765\r\n\r\nIt looks like it should solve itself over time, but if it keeps failing consistently maybe we should ignore the `pypi.org` link for now?",
    "issue_word_count": 507,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "f3e7e4e927a80abb04d2f83fc6d84b411426b661",
    "head_commit": "450b7fe6f22e990afeabb4a19ec68f05dd2cde56",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16843",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16843",
    "dockerfile": "",
    "pr_merged_at": "2024-10-08T20:35:27.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16834",
    "pr_id": 16834,
    "issue_id": 16185,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Incorrect disposal of LSP connection due to access to undefined `serverRequests`\n## Description\r\n\r\nSometimes when switching kernels I see an uncaught error:\r\n\r\n```ts\r\nconnection.ts:271 Uncaught (in promise) TypeError: Cannot convert undefined or null to object\r\n    at Function.values (<anonymous>)\r\n    at LSPConnection.dispose (connection.ts:271:12)\r\n    at DocumentConnectionManager.unregisterDocument (connection_manager.ts:428:20)\r\n    at NotebookAdapter.disconnect (adapter.ts:304:30)\r\n    at NotebookAdapter.reloadConnection (adapter.ts:397:10)\r\n    at NotebookAdapter.onKernelChanged (notebooklspadapter.ts:209:12)\r\n```\r\n\r\nThis is raised from:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/2ceabd8c7b98e7b2c305be406ade799f387a90eb/packages/lsp/src/connection.ts#L267-L273\r\n\r\nand happens because `serverRequests` have no initializer in constructor nor in class definition: \r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/2ceabd8c7b98e7b2c305be406ade799f387a90eb/packages/lsp/src/connection.ts#L229-L232\r\n\r\nThese are only initialized after server initialization in `afterInitialized`:\r\n \r\nhttps://github.com/jupyterlab/jupyterlab/blob/2ceabd8c7b98e7b2c305be406ade799f387a90eb/packages/lsp/src/connection.ts#L481-L483\r\n\r\n\r\n## Expected behavior\r\n\r\n- Disposal of connections which have not yet initialized does not raise an error.\r\n- There is a unit test case for this scenario\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.1.5",
    "issue_word_count": 162,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/lsp/src/connection.ts",
      "packages/lsp/test/connection_manager.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/lsp/test/connection_manager.spec.ts"
    ],
    "base_commit": "f42ef9daf27d95dba542b54b3bcc93843d3acbc8",
    "head_commit": "cca5838eb9893424998903ddc7887d4473178601",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16834",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16834",
    "dockerfile": "",
    "pr_merged_at": "2024-10-18T12:49:00.000Z",
    "patch": null,
    "test_patch": null,
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16831",
    "pr_id": 16831,
    "issue_id": 16828,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "\"or\" appears when editing the only shortcut in a row\nWhen I am editing the one and only shortcut in a row, while the mouse cursor is over that row, \"Add\" disappears, but \"or\" still appears, even though there is nothing after it.\r\n\r\n![or-appears](https://github.com/user-attachments/assets/1c04c346-cc40-4e2d-a052-d68039176a72)\r\n\r\n_Originally posted by @JasonWeill in https://github.com/jupyterlab/jupyterlab/issues/16721#issuecomment-2389734588_\r\n            ",
    "issue_word_count": 70,
    "test_files_count": 2,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/settings.test.ts",
      "galata/test/jupyterlab/settings.test.ts-snapshots/settings-shortcuts-edit-jupyterlab-linux.png",
      "packages/shortcuts-extension/src/components/ShortcutItem.tsx",
      "packages/shortcuts-extension/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/settings.test.ts",
      "galata/test/jupyterlab/settings.test.ts-snapshots/settings-shortcuts-edit-jupyterlab-linux.png"
    ],
    "base_commit": "c9b0f6d8c3f2ea36cf37ef11312502bc50e1ab78",
    "head_commit": "721eab583504f3690e843b4028dc41aad8fad4ff",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16831",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16831",
    "dockerfile": "",
    "pr_merged_at": "2024-10-18T14:28:06.000Z",
    "patch": "diff --git a/packages/shortcuts-extension/src/components/ShortcutItem.tsx b/packages/shortcuts-extension/src/components/ShortcutItem.tsx\nindex c88b32716392..1fff818fc1f2 100644\n--- a/packages/shortcuts-extension/src/components/ShortcutItem.tsx\n+++ b/packages/shortcuts-extension/src/components/ShortcutItem.tsx\n@@ -258,7 +258,11 @@ export class ShortcutItem extends React.Component<\n         {this.isLocationBeingEdited(index)\n           ? this.getShortCutAsInput(binding, index)\n           : this.getShortCutForDisplayOnly(binding)}\n-        {this.getOrDiplayIfNeeded(index < nonEmptyBindings.length - 1)}\n+        {!(\n+          index === this._nonEmptyBindings.length - 1 &&\n+          Object.values(this.state.displayReplaceInput).some(Boolean)\n+        ) &&\n+          this.getOrDiplayIfNeeded(index < this._nonEmptyBindings.length - 1)}\n       </div>\n     );\n   }\n@@ -309,7 +313,7 @@ export class ShortcutItem extends React.Component<\n           )}\n           {nonEmptyBindings.length >= 1 &&\n             !this.state.displayNewInput &&\n-            !this.state.displayReplaceInput[0] &&\n+            !Object.values(this.state.displayReplaceInput).some(Boolean) &&\n             this.getAddLink()}\n           {nonEmptyBindings.length === 0 &&\n             !this.state.displayNewInput &&\n\ndiff --git a/packages/shortcuts-extension/style/base.css b/packages/shortcuts-extension/style/base.css\nindex d8a6e17c198c..5b1689b54cf8 100644\n--- a/packages/shortcuts-extension/style/base.css\n+++ b/packages/shortcuts-extension/style/base.css\n@@ -31,7 +31,7 @@\n }\n \n .jp-Shortcuts-Input {\n-  animation-duration: 0.5s;\n+  animation-duration: 0.3s;\n   animation-timing-function: ease-out;\n   animation-name: slide-animation;\n   border-width: var(--jp-border-width);\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/settings.test.ts b/galata/test/jupyterlab/settings.test.ts\nindex cb50c1b3eda4..e6c650cd0c0c 100644\n--- a/galata/test/jupyterlab/settings.test.ts\n+++ b/galata/test/jupyterlab/settings.test.ts\n@@ -288,3 +288,30 @@ test('Keyboard Shortcuts: overwriting a shortcut can be cancelled', async ({\n \n   await expect(conflict).toHaveCount(0);\n });\n+\n+test('Keyboard Shortcuts: validate \"Or\" button behavior when editing shortcuts', async ({\n+  page\n+}) => {\n+  await page.evaluate(async () => {\n+    await window.jupyterapp.commands.execute('settingeditor:open', {\n+      query: 'Keyboard Shortcuts'\n+    });\n+  });\n+\n+  const shortcutsForm = page.locator('.jp-Shortcuts-ShortcutUI');\n+  const filterInput = shortcutsForm.locator('jp-search.jp-FilterBox');\n+  await filterInput.locator('input').fill('merge cell below');\n+\n+  const shortcutsContainer = page.locator(\n+    '.jp-Shortcuts-ShortcutListContainer'\n+  );\n+  const firstRow = shortcutsContainer.locator('.jp-Shortcuts-Row').first();\n+\n+  const shortcutKey = firstRow.locator('.jp-Shortcuts-ShortcutKeys').first();\n+  await shortcutKey.click();\n+  await page.waitForTimeout(300);\n+  await firstRow.hover();\n+  expect(await firstRow.screenshot()).toMatchSnapshot(\n+    'settings-shortcuts-edit.png'\n+  );\n+});\n\ndiff --git a/galata/test/jupyterlab/settings.test.ts-snapshots/settings-shortcuts-edit-jupyterlab-linux.png b/galata/test/jupyterlab/settings.test.ts-snapshots/settings-shortcuts-edit-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..a0d396b7098a\nBinary files /dev/null and b/galata/test/jupyterlab/settings.test.ts-snapshots/settings-shortcuts-edit-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16815",
    "pr_id": 16815,
    "issue_id": 16812,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Cannot open notebooks with stream in outputs in JupyterLab 4.3.0b0-1\n## Description\r\n\r\nA critical performance regression in JupyterLab 4.3.0b0 was identified in testing: notebooks with large amount of stream data in outputs no longer open in reasonable time.\r\n\r\nWhile users are reporting that notebooks do not open at all, it appears that the time opening a notebook is now a quadratic or exponential function of stream data content, which may indicate that some previously functional notebooks will not open before the heat death of the universe.\r\n\r\nThis was most likely:\r\n- introduced in https://github.com/jupyterlab/jupyterlab/pull/16498, and\r\n- not fixed by https://github.com/jupyterlab/jupyterlab/pull/16692\r\n\r\nCC @davidbrochart\r\n\r\n## Reproduce\r\n\r\n\r\n1. Download the attached notebook [50_char_500_lines.json](https://github.com/user-attachments/files/17131015/50_char_500_lines.json) file\r\n2. Rename it to `50_char_500_lines.ipynb` - it has only one code cell and only one output\r\n3. Open it in JupyterLab 4.3\r\n4. See that it takes 10-15 seconds to open (depending on the browser)\r\n\r\nThe single output of the cell looks like this:\r\n\r\n```js\r\n{\r\n     \"name\": \"stdout\",\r\n     \"output_type\": \"stream\",\r\n     \"text\": [\r\n         \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\\n\",\r\n         /* of different lengths, repated many times */\r\n         \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\\n\"\r\n     ]\r\n}\r\n```\r\n\r\nTimings in Chrome:\r\n- 50 characters repeated in 100 lines took 0.3s to load\r\n- 50 characters repeated in 200 lines took 1.4s to load\r\n- 50 characters repeated in 500 lines took 8s to load\r\n- 50 characters repeated in 1000 lines took 30s to load\r\n\r\nTimings in Firefox:\r\n- 50 characters repeated in 500 lines took 15s to load\r\n- 50 characters repeated in 1000 lines took 93s to load\r\n\r\nI have not tested Safari but I would expect even worse timings.\r\n\r\n## Expected behavior\r\n\r\nNotebooks opens as fast as in JupyterLab 4.2 (or faster) where even the test notebook with 1000 lines takes **less than one second** to open.\r\n\r\n## Context\r\n\r\n- Browser: Chrome and Firefox\r\n- JupyterLab version: 4.3.0b0 and 4.3.0b1\r\n\r\nHere is the relevant flame graph:\r\n\r\n![image](https://github.com/user-attachments/assets/306cf581-16f6-4aa7-b680-9a75ad34cd06)\r\n",
    "issue_word_count": 336,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/outputarea/src/model.ts",
      "packages/outputarea/test/model.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/outputarea/test/model.spec.ts"
    ],
    "base_commit": "a143b0223097dd26242f2803238283cce3b8d109",
    "head_commit": "024d0189fcf06a234fb3d09cf9d59e6850a5d6e8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16815",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16815",
    "dockerfile": "",
    "pr_merged_at": "2024-09-26T14:11:30.000Z",
    "patch": "diff --git a/packages/outputarea/src/model.ts b/packages/outputarea/src/model.ts\nindex 2221829b0000..a56ff05a68a7 100644\n--- a/packages/outputarea/src/model.ts\n+++ b/packages/outputarea/src/model.ts\n@@ -519,6 +519,14 @@ namespace Private {\n     }\n   }\n \n+  /**\n+   * Like `indexOf` but allowing to use a regular expression.\n+   */\n+  function indexOfAny(text: string, re: RegExp, i: number): number {\n+    const index = text.slice(i).search(re);\n+    return index >= 0 ? index + i : index;\n+  }\n+\n   /*\n    * Handle backspaces in `newText` and concatenates to `text`, if any.\n    */\n@@ -530,7 +538,28 @@ namespace Private {\n       return text + newText;\n     }\n     let idx0 = text.length;\n-    for (let idx1 = 0; idx1 < newText.length; idx1++) {\n+    let idx1: number = -1;\n+    let lastEnd: number = 0;\n+    const regex = /[\\n\\b\\r]/;\n+    // TODO: once we upgrade eslint to 9.1.0 we can toggle `allExceptWhileTrue`\n+    // option and remove the ignore rule below.\n+    // eslint-disable-next-line no-constant-condition\n+    while (true) {\n+      idx1 = indexOfAny(newText, regex, lastEnd);\n+\n+      // Insert characters at current position.\n+      const prefix = newText.slice(\n+        lastEnd,\n+        idx1 === -1 ? newText.length : idx1\n+      );\n+      text = text.slice(0, idx0) + prefix + text.slice(idx0 + prefix.length);\n+      lastEnd = idx1 + 1;\n+\n+      if (idx1 === -1) {\n+        break;\n+      }\n+      idx0 += prefix.length;\n+\n       const newChar = newText[idx1];\n       if (newChar === '\\b') {\n         // Backspace: delete previous character if there is one and if it's not a line feed.\n@@ -555,9 +584,7 @@ namespace Private {\n         text = text + '\\n';\n         idx0 = text.length;\n       } else {\n-        // Insert character at current position.\n-        text = text.slice(0, idx0) + newChar + text.slice(idx0 + 1);\n-        idx0++;\n+        throw Error(`This should not happen`);\n       }\n     }\n     return text;\n",
    "test_patch": "diff --git a/packages/outputarea/test/model.spec.ts b/packages/outputarea/test/model.spec.ts\nindex 10bcea52cc4e..9ab09fa93ebb 100644\n--- a/packages/outputarea/test/model.spec.ts\n+++ b/packages/outputarea/test/model.spec.ts\n@@ -168,6 +168,25 @@ describe('outputarea/model', () => {\n         });\n         expect(model.get(0).toJSON().text).toBe('jupyter\\njupyter\\njupyter');\n       });\n+\n+      it('should be fast in sparse presence of returns and backspaces', () => {\n+        // locally this test run in 36 ms; setting it to 10 times\n+        // more to allow for slower runs on CI\n+        const timeout = 360;\n+        const size = 10 ** 7;\n+        const output = {\n+          name: 'stdout',\n+          output_type: 'stream',\n+          text: ['a'.repeat(size) + 'a\\b' + 'a'.repeat(size)]\n+        };\n+\n+        const start = performance.now();\n+        model.add(output);\n+        const end = performance.now();\n+\n+        expect(end - start).toBeLessThan(timeout);\n+        expect(model.get(0).toJSON().text).toHaveLength(2 * size);\n+      });\n     });\n \n     describe('#clear()', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16748",
    "pr_id": 16748,
    "issue_id": 16747,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "The running session icons on the left side of the status bar are misaligned\nHi! ðŸ‘‹ \r\n\r\n## Description\r\n\r\nRight now, the running session icons on the left side of the status bar at the bottom of the interface appear misaligned:\r\n\r\n<img width=\"1582\" alt=\"Screenshot 2024-09-05 at 11 32 49\" src=\"https://github.com/user-attachments/assets/40b0c2d9-6a41-4d3e-9395-80cd21f1a9ee\">\r\n\r\n<img width=\"1582\" alt=\"Screenshot 2024-09-05 at 11 32 57\" src=\"https://github.com/user-attachments/assets/8c314d96-2401-465d-8082-913bab36ee93\">\r\n\r\nAdditionally, the cursor, when overlaying this group, is the default one instead of the `pointer` cursor to further highlight that this element is clickable.\r\n\r\n## Reproduce\r\n\r\n1. Open JupyterLab.\r\n2. Check the left side of the status bar at the bottom of the interface.\r\n\r\n## Expected behavior\r\n\r\nThe icons are aligned (optically) and the cursor is the `pointer` one to further highlight that this group is clickable. So, I would like to suggest the following change to the [`RunningSessionsComponent` component](https://github.com/jupyterlab/jupyterlab/blob/06c5b357b59ffdd272b3ec71b8444c0a51f5146b/packages/apputils/src/runningSessions.tsx#L37-L57): \r\n\r\n```diff\r\nfunction RunningSessionsComponent(\r\n  props: RunningSessionsComponent.IProps\r\n): React.ReactElement<RunningSessionsComponent.IProps> {\r\n  return (\r\n    <GroupItem\r\n      tabIndex={0}\r\n      spacing={HALF_SPACING}\r\n      onClick={props.handleClick}\r\n      onKeyDown={props.handleKeyDown}\r\n+     style={{ cursor: 'pointer' }}\r\n    >\r\n      <GroupItem spacing={HALF_SPACING}>\r\n        <TextItem source={props.terminals} />\r\n-       <terminalIcon.react left={'1px'} top={'3px'} stylesheet={'statusBar'} />\r\n+       <terminalIcon.react verticalAlign=\"middle\" stylesheet=\"statusBar\" />\r\n      </GroupItem>\r\n      <GroupItem spacing={HALF_SPACING}>\r\n        <TextItem source={props.sessions} />\r\n-       <kernelIcon.react top={'2px'} stylesheet={'statusBar'} />\r\n+       <kernelIcon.react verticalAlign=\"middle\" stylesheet=\"statusBar\" />\r\n      </GroupItem>\r\n    </GroupItem>\r\n  );\r\n}\r\n```\r\n\r\nThe final result woud look like this:\r\n\r\n<img width=\"1582\" alt=\"image\" src=\"https://github.com/user-attachments/assets/b80c6609-6cc4-4731-9d03-497c6e3587e9\">\r\n\r\n|Before|After|\r\n|-|-|\r\n|<img width=\"1582\" alt=\"Screenshot 2024-09-05 at 11 32 57\" src=\"https://github.com/user-attachments/assets/50391836-cba2-464f-ad09-4111d61c3ded\">|<img width=\"1582\" alt=\"Screenshot 2024-09-05 at 11 49 16\" src=\"https://github.com/user-attachments/assets/16dcb0d3-f826-44b1-8b95-a63312da51bb\">|\r\n\r\n## Context\r\n\r\n- Operating System and version: macOS Sonoma 14.5\r\n- Browser and version: Chrome 127.0.6533.120\r\n- JupyterLab version: 4.3.0b1\r\n- Python version: 3.10.13\r\n\r\nLet me know what you think and if I can open a PR. Thanks!",
    "issue_word_count": 361,
    "test_files_count": 13,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "packages/apputils/src/runningSessions.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png"
    ],
    "base_commit": "06c5b357b59ffdd272b3ec71b8444c0a51f5146b",
    "head_commit": "17995b94689cf64992684e975e68ec36f9e12744",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16748",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16748",
    "dockerfile": "",
    "pr_merged_at": "2024-09-11T12:52:49.000Z",
    "patch": "diff --git a/packages/apputils/src/runningSessions.tsx b/packages/apputils/src/runningSessions.tsx\nindex 7e98baf59d70..cb2765bcd83f 100644\n--- a/packages/apputils/src/runningSessions.tsx\n+++ b/packages/apputils/src/runningSessions.tsx\n@@ -23,7 +23,7 @@ import React, { KeyboardEvent } from 'react';\n import { GroupItem, TextItem } from '@jupyterlab/statusbar';\n \n /**\n- * Half spacing between subitems in a status item.\n+ * Half spacing between subitems in a status item, in pixels.\n  */\n const HALF_SPACING = 4;\n \n@@ -43,14 +43,15 @@ function RunningSessionsComponent(\n       spacing={HALF_SPACING}\n       onClick={props.handleClick}\n       onKeyDown={props.handleKeyDown}\n+      style={{ cursor: 'pointer' }}\n     >\n       <GroupItem spacing={HALF_SPACING}>\n         <TextItem source={props.terminals} />\n-        <terminalIcon.react left={'1px'} top={'3px'} stylesheet={'statusBar'} />\n+        <terminalIcon.react verticalAlign=\"middle\" stylesheet=\"statusBar\" />\n       </GroupItem>\n       <GroupItem spacing={HALF_SPACING}>\n         <TextItem source={props.sessions} />\n-        <kernelIcon.react top={'2px'} stylesheet={'statusBar'} />\n+        <kernelIcon.react verticalAlign=\"middle\" stylesheet=\"statusBar\" />\n       </GroupItem>\n     </GroupItem>\n   );\n",
    "test_patch": "diff --git a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png\nindex da8c7d3ff8c9..f00a1043162b 100644\nBinary files a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png and b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png\nindex d4cf3953d8e9..5b13a1ccb073 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png\nindex cbc507fac95a..1c14529bc3fa 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png\nindex 2bdafd4ae09c..d81a84104459 100644\nBinary files a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png and b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png\nindex 091fd8fe2ecb..466e3aa1e363 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png\nindex a4ac514a4e11..748172514094 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png\nindex cf51c4b5af9a..edbd759f4c0d 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png\nindex 8f38ede3ba74..58952978f389 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex a6141bf4ba10..d1915748153a 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png\nindex 58a0f555743e..0b24ababa317 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png\nindex cbf8e837bf23..d47ae651ec96 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png\nindex 8eb7d8fe7eae..88204c4883a9 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png\nindex d6cb7c8c18e8..52546f69b6df 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16723",
    "pr_id": 16723,
    "issue_id": 16722,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`LogConsolePanel â€º #source â€º displays output only from the current source` test is failing on CI\nSeen in a couple of PRs now and on main:\r\n\r\n```js\r\n FAIL  test/widget.spec.ts (14.931 s)\r\n  â— LogConsolePanel â€º #source â€º displays output only from the current source\r\n\r\n    expect(received).not.toBeNull()\r\n\r\n    Received: null\r\n\r\n      101 |       const nodeA = logConsole.node.querySelector('#A')!;\r\n      102 |       const nodeB = logConsole.node.querySelector('#B')!;\r\n    > 103 |       expect(nodeA).not.toBeNull();\r\n          |                         ^\r\n      104 |       expect(anyAncestor(nodeA, isHiddenLumino)).toBe(false);\r\n      105 |       expect(nodeB).not.toBeNull();\r\n      106 |       expect(anyAncestor(nodeB, isHiddenLumino)).toBe(true);\r\n\r\n      at Object.<anonymous> (test/widget.spec.ts:103:25)\r\n\r\n\r\nError: expect(received).not.toBeNull()\r\n\r\nReceived: null\r\n\r\n    at Object.<anonymous> (test/widget.spec.ts:103:25)\r\n```\r\n\r\nThis is because we no longer allow identifier in the sanitizer by default. The test should be rewritten to use a different selector, like a class name.",
    "issue_word_count": 138,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "packages/logconsole/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/logconsole/test/widget.spec.ts"
    ],
    "base_commit": "f7ca6ad67e178995a70883ae284ecf5a7efd3d85",
    "head_commit": "95a3fe8e6c0e339cec9cea393e57d2f2b5a0e75b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16723",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16723",
    "dockerfile": "",
    "pr_merged_at": "2024-08-28T12:59:47.000Z",
    "patch": "",
    "test_patch": "diff --git a/packages/logconsole/test/widget.spec.ts b/packages/logconsole/test/widget.spec.ts\nindex 3b7c5260994f..e82470bfa2c7 100644\n--- a/packages/logconsole/test/widget.spec.ts\n+++ b/packages/logconsole/test/widget.spec.ts\n@@ -89,17 +89,17 @@ describe('LogConsolePanel', () => {\n       const loggerB = registry.getLogger('B');\n       loggerA.log({\n         type: 'html',\n-        data: '<div id=\"A\"></div>',\n+        data: '<div class=\"A\"></div>',\n         level: 'warning'\n       });\n       loggerB.log({\n         type: 'html',\n-        data: '<div id=\"B\"></div>',\n+        data: '<div class=\"B\"></div>',\n         level: 'warning'\n       });\n       logConsole.source = 'A';\n-      const nodeA = logConsole.node.querySelector('#A')!;\n-      const nodeB = logConsole.node.querySelector('#B')!;\n+      const nodeA = logConsole.node.querySelector('.A')!;\n+      const nodeB = logConsole.node.querySelector('.B')!;\n       expect(nodeA).not.toBeNull();\n       expect(anyAncestor(nodeA, isHiddenLumino)).toBe(false);\n       expect(nodeB).not.toBeNull();\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16682",
    "pr_id": 16682,
    "issue_id": 16627,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Find & replace function also replaces text in read-only cells\nFor details please refer to the issue in the notebook repo: https://github.com/jupyter/notebook/issues/7431 which can be reproduced in Jupyterlab as well.\r\n\r\n@RRosio forwarded me here.\r\n\r\nCould also be related: https://github.com/jupyterlab/jupyterlab/issues/15514",
    "issue_word_count": 51,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/cells/src/searchprovider.ts",
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "base_commit": "35bab6e06d8e4f347219f91a4f0315a4169dfe09",
    "head_commit": "17fe8ae2b5bdf877b5e9fd98dc23911b3e9e12e6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16682",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16682",
    "dockerfile": "",
    "pr_merged_at": "2024-08-19T14:30:31.000Z",
    "patch": "diff --git a/packages/cells/src/searchprovider.ts b/packages/cells/src/searchprovider.ts\nindex 1a831b882469..eac7e3c2c700 100644\n--- a/packages/cells/src/searchprovider.ts\n+++ b/packages/cells/src/searchprovider.ts\n@@ -12,6 +12,7 @@ import {\n   GenericSearchProvider,\n   IBaseSearchProvider,\n   IFilters,\n+  IReplaceOptions,\n   ISearchMatch\n } from '@jupyterlab/documentsearch';\n import { OutputArea } from '@jupyterlab/outputarea';\n@@ -249,6 +250,39 @@ class CodeCellSearchProvider extends CellSearchProvider {\n     }\n   }\n \n+  /**\n+   * Replace all matches in the cell source with the provided text\n+   *\n+   * @param newText The replacement text.\n+   * @returns Whether a replace occurred.\n+   */\n+  async replaceAllMatches(newText: string): Promise<boolean> {\n+    if (this.model.getMetadata('editable') === false)\n+      return Promise.resolve(false);\n+\n+    const result = await super.replaceAllMatches(newText);\n+    return result;\n+  }\n+\n+  /**\n+   * Replace the currently selected match with the provided text.\n+   * If no match is selected, it won't do anything.\n+   *\n+   * @param newText The replacement text.\n+   * @returns Whether a replace occurred.\n+   */\n+  async replaceCurrentMatch(\n+    newText: string,\n+    loop?: boolean,\n+    options?: IReplaceOptions\n+  ): Promise<boolean> {\n+    if (this.model.getMetadata('editable') === false)\n+      return Promise.resolve(false);\n+\n+    const result = await super.replaceCurrentMatch(newText, loop, options);\n+    return result;\n+  }\n+\n   private async _onOutputsChanged(\n     outputArea: OutputArea,\n     changes: number\n@@ -393,12 +427,33 @@ class MarkdownCellSearchProvider extends CellSearchProvider {\n    * @returns Whether a replace occurred.\n    */\n   async replaceAllMatches(newText: string): Promise<boolean> {\n+    if (this.model.getMetadata('editable') === false)\n+      return Promise.resolve(false);\n+\n     const result = await super.replaceAllMatches(newText);\n     // if the cell is rendered force update\n     if ((this.cell as MarkdownCell).rendered) {\n       this.cell.update();\n     }\n+    return result;\n+  }\n+\n+  /**\n+   * Replace the currently selected match with the provided text.\n+   * If no match is selected, it won't do anything.\n+   *\n+   * @param newText The replacement text.\n+   * @returns Whether a replace occurred.\n+   */\n+  async replaceCurrentMatch(\n+    newText: string,\n+    loop?: boolean,\n+    options?: IReplaceOptions\n+  ): Promise<boolean> {\n+    if (this.model.getMetadata('editable') === false)\n+      return Promise.resolve(false);\n \n+    const result = await super.replaceCurrentMatch(newText, loop, options);\n     return result;\n   }\n \n",
    "test_patch": "diff --git a/packages/notebook/test/searchprovider.spec.ts b/packages/notebook/test/searchprovider.spec.ts\nindex f6ff54451603..c4caa6175301 100644\n--- a/packages/notebook/test/searchprovider.spec.ts\n+++ b/packages/notebook/test/searchprovider.spec.ts\n@@ -288,6 +288,38 @@ describe('@jupyterlab/notebook', () => {\n         expect(source).toBe('rabarbar');\n         expect(provider.currentMatchIndex).toBe(null);\n       });\n+\n+      it('should not replace the current match in a read-only cell', async () => {\n+        panel.model!.sharedModel.insertCells(0, [\n+          {\n+            cell_type: 'markdown',\n+            source: 'test1',\n+            metadata: { editable: false }\n+          },\n+          { cell_type: 'code', source: 'test2', metadata: { editable: false } }\n+        ]);\n+\n+        await provider.startQuery(/test\\d/, undefined);\n+        expect(provider.currentMatchIndex).toBe(0);\n+        let replaced = await provider.replaceCurrentMatch('bar');\n+        expect(replaced).toBe(false);\n+        const source = panel.model!.cells.get(0).sharedModel.getSource();\n+        expect(source).toBe('test1');\n+\n+        await provider.highlightNext();\n+        expect(provider.currentMatchIndex).toBe(1);\n+        replaced = await provider.replaceCurrentMatch('bar');\n+        expect(replaced).toBe(false);\n+        const source1 = panel.model!.cells.get(1).sharedModel.getSource();\n+        expect(source1).toBe('test2');\n+\n+        await provider.highlightNext();\n+        expect(provider.currentMatchIndex).toBe(2);\n+        replaced = await provider.replaceCurrentMatch('bar');\n+        expect(replaced).toBe(true);\n+        const source2 = panel.model!.cells.get(2).sharedModel.getSource();\n+        expect(source2).toBe('bar test2');\n+      });\n     });\n \n     describe('#replaceAllMatches()', () => {\n@@ -354,6 +386,34 @@ describe('@jupyterlab/notebook', () => {\n         expect(source).toBe('test1\\nbar2\\nbar3\\nbar4\\ntest5');\n         await provider.endQuery();\n       });\n+\n+      it('should not replace all matches in read-only cells', async () => {\n+        panel.model!.sharedModel.insertCells(2, [\n+          {\n+            cell_type: 'markdown',\n+            source: 'test1 test2',\n+            metadata: { editable: false }\n+          },\n+          {\n+            cell_type: 'code',\n+            source: 'test1 test2 test3',\n+            metadata: { editable: false }\n+          }\n+        ]);\n+        await provider.startQuery(/test\\d/, undefined);\n+        await provider.highlightNext();\n+        const replaced = await provider.replaceAllMatches('test0');\n+        expect(replaced).toBe(true);\n+        let source = panel.model!.cells.get(0).sharedModel.getSource();\n+        expect(source).toBe('test0 test0');\n+        source = panel.model!.cells.get(1).sharedModel.getSource();\n+        expect(source).toBe('test0');\n+        source = panel.model!.cells.get(2).sharedModel.getSource();\n+        expect(source).toBe('test1 test2');\n+        source = panel.model!.cells.get(3).sharedModel.getSource();\n+        expect(source).toBe('test1 test2 test3');\n+        expect(provider.currentMatchIndex).toBe(null);\n+      });\n     });\n \n     describe('#getSelectionState()', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16679",
    "pr_id": 16679,
    "issue_id": 11165,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "The type of a non-editable cell can be changed\n## Description\r\n\r\nThe type of cells with \"editable\": false can be changed (e.g. from Code to Markdown or Raw).\r\n\r\n\r\n## Reproduce\r\n\r\nIn a new notebook, edit metadata adding  \r\n\r\n    \"editable\": false\r\n\r\nthe cell cannot be edited, but it is possible to change its type from the toolbar.\r\n\r\n## Expected behavior\r\n\r\nIt should not be possible to change the type, as in jupyter notebook.\r\n\r\n## Context\r\n\r\nReproduced in a clean env (conda create -n jlab-test --override-channels --strict-channel-priority -c conda-forge -c nodefaults jupyterlab)\r\n\r\nJupyterLab Version 3.1.13\r\nGoogle Chrome | 93.0.4577.82\r\nWindows 10 OS Version 2009\r\nJavaScript | V8 9.3.345.19\r\n\r\nI was NOT able to reproduce the problem in Jupyter notebook.\r\n",
    "issue_word_count": 125,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/actions.tsx",
      "packages/notebook/test/actions.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/actions.spec.ts"
    ],
    "base_commit": "67cb8f8347f13d52dc100f33fb532acbf36b3b23",
    "head_commit": "6f91b1d08b42756b2f6b58198c2fc0bd34d184a8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16679",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16679",
    "dockerfile": "",
    "pr_merged_at": "2024-08-17T12:13:19.000Z",
    "patch": "diff --git a/packages/notebook/src/actions.tsx b/packages/notebook/src/actions.tsx\nindex 42d5876042fd..5470e1ae5387 100644\n--- a/packages/notebook/src/actions.tsx\n+++ b/packages/notebook/src/actions.tsx\n@@ -2615,6 +2615,17 @@ namespace Private {\n         });\n         return;\n       }\n+      if (child.model.getMetadata('editable') == false) {\n+        translator = translator || nullTranslator;\n+        const trans = translator.load('jupyterlab');\n+        // Do not permit changing cell type when the cell is readonly\n+        void showDialog({\n+          title: trans.__('Cell is read-only'),\n+          body: trans.__('The cell is read-only, its type cannot be changed!'),\n+          buttons: [Dialog.okButton()]\n+        });\n+        return;\n+      }\n       if (child.model.type !== value) {\n         const raw = child.model.toJSON();\n         notebookSharedModel.transact(() => {\n",
    "test_patch": "diff --git a/packages/notebook/test/actions.spec.ts b/packages/notebook/test/actions.spec.ts\nindex 37dfb945b97c..f9a5c759fe40 100644\n--- a/packages/notebook/test/actions.spec.ts\n+++ b/packages/notebook/test/actions.spec.ts\n@@ -698,6 +698,22 @@ describe('@jupyterlab/notebook', () => {\n         NotebookActions.changeCellType(widget, 'raw');\n         expect(widget.activeCell).toBeInstanceOf(RawCell);\n       });\n+\n+      it('should not change cell type when the cell is not editable', async () => {\n+        NotebookActions.changeCellType(widget, 'markdown');\n+        let cell = widget.activeCell as MarkdownCell;\n+        expect(widget.activeCell).toBeInstanceOf(MarkdownCell);\n+        cell.model.setMetadata('editable', false);\n+\n+        // Try to change cell type\n+        NotebookActions.changeCellType(widget, 'raw');\n+        // Cell type should stay unchanged.\n+        expect(widget.activeCell).toBeInstanceOf(MarkdownCell);\n+\n+        // Should show a dialog informing user why cell type could not be changed\n+        await waitForDialog();\n+        await acceptDialog();\n+      });\n     });\n \n     describe('#run()', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16678",
    "pr_id": 16678,
    "issue_id": 16672,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Optimize SVG icons from `@jupyterlab/ui-components` and update SVGO config\nHi! ðŸ‘‹ \r\n\r\n### Problem\r\n\r\nWhile there have been efforts in the past to clean up the SVG icons available in [`@jupyterlab/ui-components`](https://github.com/jupyterlab/jupyterlab/tree/67cb8f8347f13d52dc100f33fb532acbf36b3b23/packages/ui-components/style/icons) and keep them as small as possible, it is still possible to further optimize them (as well as keep them consistent in terms of indentation, attribute order, etc.).\r\n\r\nBy doing so, either by minifying the SVG icons or pretty printing them via SVGO, as well as via some manual adjustments, it is possible to reduce the size of most icons (there are some cases where this reduction is to about half of the original size). This reduction also affects the respective packaged JS file served by JupyterLab (since SVG files are _stringified_ and included in the bundle):\r\n\r\n<img width=\"1582\" alt=\"Screenshot 2024-08-13 at 13 18 33\" src=\"https://github.com/user-attachments/assets/fbac5da9-50d8-4ded-87b5-204fee2bd4f9\">\r\n\r\n### Proposed Solution\r\n\r\nTo optimize the SVG icons, I think there are three tasks that can be done:\r\n\r\n1. Update the SVGO configuration and the respective command in the `package.json` file (see the snippet below). The YAML format is no longer supported since [SVGO 2.0.0](https://github.com/svg/svgo/releases/tag/v2.0.0).\r\n2. Run SVGO to optimize the current icons. I would suggest minifying them as much as possible by removing [`js2svg` from the configuration](https://github.com/jupyterlab/jupyterlab/blob/67cb8f8347f13d52dc100f33fb532acbf36b3b23/packages/ui-components/svgo.yaml#L70-L76), but pretty printing them works too.\r\n3. Remove attribute values â€‹â€‹and unnecessary SVG elements manually from some icons:\r\n    - Some icons, like the [`yaml.svg` icon](https://github.com/jupyterlab/jupyterlab/blob/67cb8f8347f13d52dc100f33fb532acbf36b3b23/packages/ui-components/style/icons/filetype/yaml.svg), have Adobe Illustrator classes (`st*` classes) that can be removed, if I'm correct.\r\n    - Some icons, like the [`error.svg` icon](https://github.com/jupyterlab/jupyterlab/blob/67cb8f8347f13d52dc100f33fb532acbf36b3b23/packages/ui-components/style/icons/error.svg), have an invisible placeholder element (`<path fill=\"none\" ... />`) to define, I believe, the desired frame/size for the final icon. This element can also be removed as the desired frame for the icon is maintained. This result can also be obtained via an SVGO plugin: `{ name: \"removeUselessStrokeAndFill\", params: { stroke: true, fill: true, removeNone: true } }`.\r\n\r\n```json\r\n\"scripts\": {\r\n  \"cleansvg\": \"svgo --folder style/icons --recursive\"\r\n}\r\n```\r\n\r\n### Additional context\r\n\r\n- Operating System and version: macOS Sonoma 14.5\r\n- Browser and version: Chrome 127.0.6533.89\r\n- JupyterLab version: 4.3.0a2\r\n- Python version: 3.10.13\r\n- Related issues/PRs:\r\n    - https://github.com/jupyterlab/jupyterlab/issues/16673\r\n    - https://github.com/jupyterlab/jupyterlab/pull/16666\r\n\r\nLet me know what you think and if I can open a PR. Thanks!",
    "issue_word_count": 455,
    "test_files_count": 1,
    "non_test_files_count": 99,
    "pr_changed_files": [
      "galata/test/documentation/general.test.ts-snapshots/notebook-not-trusted-documentation-linux.png",
      "packages/ui-components/package.json",
      "packages/ui-components/style/icons/arrow/caret-down-empty-thin.svg",
      "packages/ui-components/style/icons/arrow/caret-down-empty.svg",
      "packages/ui-components/style/icons/arrow/caret-down.svg",
      "packages/ui-components/style/icons/arrow/caret-left.svg",
      "packages/ui-components/style/icons/arrow/caret-right.svg",
      "packages/ui-components/style/icons/arrow/caret-up-empty-thin.svg",
      "packages/ui-components/style/icons/arrow/caret-up.svg",
      "packages/ui-components/style/icons/error.svg",
      "packages/ui-components/style/icons/filetype/console.svg",
      "packages/ui-components/style/icons/filetype/file.svg",
      "packages/ui-components/style/icons/filetype/folder-favorite.svg",
      "packages/ui-components/style/icons/filetype/folder.svg",
      "packages/ui-components/style/icons/filetype/home.svg",
      "packages/ui-components/style/icons/filetype/html5.svg",
      "packages/ui-components/style/icons/filetype/image.svg",
      "packages/ui-components/style/icons/filetype/inspector.svg",
      "packages/ui-components/style/icons/filetype/json.svg",
      "packages/ui-components/style/icons/filetype/julia.svg",
      "packages/ui-components/style/icons/filetype/keyboard.svg",
      "packages/ui-components/style/icons/filetype/launcher.svg",
      "packages/ui-components/style/icons/filetype/markdown.svg",
      "packages/ui-components/style/icons/filetype/mermaid.svg",
      "packages/ui-components/style/icons/filetype/notebook.svg",
      "packages/ui-components/style/icons/filetype/pdf.svg",
      "packages/ui-components/style/icons/filetype/python.svg",
      "packages/ui-components/style/icons/filetype/r-kernel.svg",
      "packages/ui-components/style/icons/filetype/react.svg",
      "packages/ui-components/style/icons/filetype/settings.svg",
      "packages/ui-components/style/icons/filetype/spreadsheet.svg",
      "packages/ui-components/style/icons/filetype/text-editor.svg",
      "packages/ui-components/style/icons/filetype/vega.svg",
      "packages/ui-components/style/icons/filetype/yaml.svg",
      "packages/ui-components/style/icons/history.svg",
      "packages/ui-components/style/icons/info.svg",
      "packages/ui-components/style/icons/jupyter/jupyter-favicon.svg",
      "packages/ui-components/style/icons/jupyter/jupyter.svg",
      "packages/ui-components/style/icons/jupyter/jupyterlab-wordmark.svg",
      "packages/ui-components/style/icons/licenses/copyright.svg",
      "packages/ui-components/style/icons/lock.svg",
      "packages/ui-components/style/icons/lsp/code-check.svg",
      "packages/ui-components/style/icons/output/collapse.svg",
      "packages/ui-components/style/icons/output/expand.svg",
      "packages/ui-components/style/icons/search/case-sensitive.svg",
      "packages/ui-components/style/icons/search/filter-dot.svg",
      "packages/ui-components/style/icons/search/filter.svg",
      "packages/ui-components/style/icons/search/regex.svg",
      "packages/ui-components/style/icons/search/word.svg",
      "packages/ui-components/style/icons/sidebar/build.svg",
      "packages/ui-components/style/icons/sidebar/extension.svg",
      "packages/ui-components/style/icons/sidebar/palette.svg",
      "packages/ui-components/style/icons/sidebar/running.svg",
      "packages/ui-components/style/icons/sidebar/share.svg",
      "packages/ui-components/style/icons/sidebar/tab.svg",
      "packages/ui-components/style/icons/sidebar/toc.svg",
      "packages/ui-components/style/icons/sidebar/user.svg",
      "packages/ui-components/style/icons/sidebar/users.svg",
      "packages/ui-components/style/icons/statusbar/bell.svg",
      "packages/ui-components/style/icons/statusbar/kernel.svg",
      "packages/ui-components/style/icons/statusbar/line-form.svg",
      "packages/ui-components/style/icons/statusbar/list.svg",
      "packages/ui-components/style/icons/statusbar/not-trusted.svg",
      "packages/ui-components/style/icons/statusbar/terminal.svg",
      "packages/ui-components/style/icons/statusbar/trusted.svg",
      "packages/ui-components/style/icons/toolbar/add-above.svg",
      "packages/ui-components/style/icons/toolbar/add-below.svg",
      "packages/ui-components/style/icons/toolbar/add.svg",
      "packages/ui-components/style/icons/toolbar/bug-dot.svg",
      "packages/ui-components/style/icons/toolbar/bug.svg",
      "packages/ui-components/style/icons/toolbar/check.svg",
      "packages/ui-components/style/icons/toolbar/circle-empty.svg",
      "packages/ui-components/style/icons/toolbar/circle.svg",
      "packages/ui-components/style/icons/toolbar/cleaning.svg",
      "packages/ui-components/style/icons/toolbar/clear.svg",
      "packages/ui-components/style/icons/toolbar/close.svg",
      "packages/ui-components/style/icons/toolbar/code.svg",
      "packages/ui-components/style/icons/toolbar/collapse-all.svg",
      "packages/ui-components/style/icons/toolbar/copy.svg",
      "packages/ui-components/style/icons/toolbar/cut.svg",
      "packages/ui-components/style/icons/toolbar/delete.svg",
      "packages/ui-components/style/icons/toolbar/download.svg",
      "packages/ui-components/style/icons/toolbar/duplicate.svg",
      "packages/ui-components/style/icons/toolbar/edit.svg",
      "packages/ui-components/style/icons/toolbar/ellipses.svg",
      "packages/ui-components/style/icons/toolbar/expand-all.svg",
      "packages/ui-components/style/icons/toolbar/fast-forward.svg",
      "packages/ui-components/style/icons/toolbar/file-upload.svg",
      "packages/ui-components/style/icons/toolbar/filter-list.svg",
      "packages/ui-components/style/icons/toolbar/launch.svg",
      "packages/ui-components/style/icons/toolbar/link.svg",
      "packages/ui-components/style/icons/toolbar/move-down.svg",
      "packages/ui-components/style/icons/toolbar/move-up.svg",
      "packages/ui-components/style/icons/toolbar/new-folder.svg",
      "packages/ui-components/style/icons/toolbar/numbering.svg",
      "packages/ui-components/style/icons/toolbar/offline-bolt.svg",
      "packages/ui-components/style/icons/toolbar/paste.svg",
      "packages/ui-components/style/icons/toolbar/redo.svg",
      "packages/ui-components/style/icons/toolbar/refresh.svg",
      "packages/ui-components/style/icons/toolbar/run.svg"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts-snapshots/notebook-not-trusted-documentation-linux.png"
    ],
    "base_commit": "67cb8f8347f13d52dc100f33fb532acbf36b3b23",
    "head_commit": "4c33503c4c1a941b748c24bf4da1dcdd1589aa8c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16678",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16678",
    "dockerfile": "",
    "pr_merged_at": "2024-08-19T17:41:43.000Z",
    "patch": "diff --git a/packages/ui-components/package.json b/packages/ui-components/package.json\nindex cb5473c0b8eb..b17e65c163e1 100644\n--- a/packages/ui-components/package.json\n+++ b/packages/ui-components/package.json\n@@ -31,7 +31,7 @@\n     \"build\": \"tsc -b\",\n     \"build:test\": \"tsc --build tsconfig.test.json\",\n     \"clean\": \"rimraf lib && rimraf tsconfig.tsbuildinfo\",\n-    \"cleansvg\": \"svgo --config svgo.yaml\",\n+    \"clean:svg\": \"svgo --folder style/icons --recursive\",\n     \"docs:init\": \"bash docs/build.sh\",\n     \"test\": \"jest\",\n     \"test:cov\": \"jest --collect-coverage\",\n@@ -68,7 +68,7 @@\n     \"@types/react\": \"^18.0.26\",\n     \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n-    \"svgo\": \"^3.0.1\",\n+    \"svgo\": \"^3.3.2\",\n     \"typescript\": \"~5.1.6\"\n   },\n   \"peerDependencies\": {\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-down-empty-thin.svg b/packages/ui-components/style/icons/arrow/caret-down-empty-thin.svg\nindex 90040f3adbd3..d54e1e3e36d6 100644\n--- a/packages/ui-components/style/icons/arrow/caret-down-empty-thin.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-down-empty-thin.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 20 20\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-\t\t<polygon class=\"st1\" points=\"9.9,13.6 3.6,7.4 4.4,6.6 9.9,12.2 15.4,6.7 16.1,7.4 \"/>\n-\t</g>\n+  <path fill=\"#616161\" d=\"M9.9 13.6 3.6 7.4l.8-.8 5.5 5.6 5.5-5.5.7.7z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-down-empty.svg b/packages/ui-components/style/icons/arrow/caret-down-empty.svg\nindex c2a4da11e2da..047058254e78 100644\n--- a/packages/ui-components/style/icons/arrow/caret-down-empty.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-down-empty.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n-  <g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-    <path d=\"M5.2,5.9L9,9.7l3.8-3.8l1.2,1.2l-4.9,5l-4.9-5L5.2,5.9z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M5.2 5.9 9 9.7l3.8-3.8L14 7.1l-4.9 5-4.9-5z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-down.svg b/packages/ui-components/style/icons/arrow/caret-down.svg\nindex 54448ab94b08..560ff987ac52 100644\n--- a/packages/ui-components/style/icons/arrow/caret-down.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-down.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n-  <g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-    <path d=\"M5.2,7.5L9,11.2l3.8-3.8H5.2z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M5.2 7.5 9 11.2l3.8-3.8H5.2z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-left.svg b/packages/ui-components/style/icons/arrow/caret-left.svg\nindex 4944990c6488..4487e617958b 100644\n--- a/packages/ui-components/style/icons/arrow/caret-left.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-left.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-\t\t<path d=\"M10.8,12.8L7.1,9l3.8-3.8l0,7.6H10.8z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M10.8 12.8 7.1 9l3.8-3.8v7.6z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-right.svg b/packages/ui-components/style/icons/arrow/caret-right.svg\nindex f13b99b57534..f8d14bd4dedb 100644\n--- a/packages/ui-components/style/icons/arrow/caret-right.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-right.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n-  <g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-    <path d=\"M7.2,5.2L10.9,9l-3.8,3.8V5.2H7.2z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M7.2 5.2 10.9 9l-3.8 3.8V5.2z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-up-empty-thin.svg b/packages/ui-components/style/icons/arrow/caret-up-empty-thin.svg\nindex 77262ca73379..c160e35b9cf4 100644\n--- a/packages/ui-components/style/icons/arrow/caret-up-empty-thin.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-up-empty-thin.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 20 20\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-\t\t<polygon class=\"st1\" points=\"15.4,13.3 9.9,7.7 4.4,13.2 3.6,12.5 9.9,6.3 16.1,12.6 \"/>\n-\t</g>\n+  <path fill=\"#616161\" d=\"M15.4 13.3 9.9 7.7l-5.5 5.5-.8-.7 6.3-6.2 6.2 6.3z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/arrow/caret-up.svg b/packages/ui-components/style/icons/arrow/caret-up.svg\nindex d2eeff450ae2..878df7648c4e 100644\n--- a/packages/ui-components/style/icons/arrow/caret-up.svg\n+++ b/packages/ui-components/style/icons/arrow/caret-up.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-\t\t<path d=\"M5.2,10.5L9,6.8l3.8,3.8H5.2z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M5.2 10.5 9 6.8l3.8 3.8H5.2z\" class=\"jp-icon3\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/error.svg b/packages/ui-components/style/icons/error.svg\nindex c51e0322398c..4224bf9414d7 100644\n--- a/packages/ui-components/style/icons/error.svg\n+++ b/packages/ui-components/style/icons/error.svg\n@@ -1,4 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-<g class=\"jp-icon3\" fill=\"#616161\"><circle cx=\"12\" cy=\"19\" r=\"2\"/><path d=\"M10 3h4v12h-4z\"/></g>\n-<path fill=\"none\" d=\"M0 0h24v24H0z\"/>\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n+    <circle cx=\"12\" cy=\"19\" r=\"2\"/>\n+    <path d=\"M10 3h4v12h-4z\"/>\n+  </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/console.svg b/packages/ui-components/style/icons/filetype/console.svg\nindex f9493e5ec48c..d794606a02a8 100644\n--- a/packages/ui-components/style/icons/filetype/console.svg\n+++ b/packages/ui-components/style/icons/filetype/console.svg\n@@ -1,8 +1,4 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 200 200\">\n-  <g class=\"jp-console-icon-background-color jp-icon-selectable\" fill=\"#0288D1\">\n-    <path d=\"M20 19.8h160v159.9H20z\"/>\n-  </g>\n-  <g class=\"jp-console-icon-color jp-icon-selectable-inverse\" fill=\"#fff\">\n-    <path d=\"M105 127.3h40v12.8h-40zM51.1 77L74 99.9l-23.3 23.3 10.5 10.5 23.3-23.3L95 99.9 84.5 89.4 61.6 66.5z\"/>\n-  </g>\n+  <path fill=\"#0288D1\" d=\"M20 19.8h160v159.9H20z\" class=\"jp-console-icon-background-color jp-icon-selectable\"/>\n+  <path fill=\"#fff\" d=\"M105 127.3h40v12.8h-40zM51.1 77 74 99.9l-23.3 23.3 10.5 10.5 23.3-23.3L95 99.9 84.5 89.4 61.6 66.5z\" class=\"jp-console-icon-color jp-icon-selectable-inverse\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/file.svg b/packages/ui-components/style/icons/filetype/file.svg\nindex 47791590cff8..ba55bfe732e5 100644\n--- a/packages/ui-components/style/icons/filetype/file.svg\n+++ b/packages/ui-components/style/icons/filetype/file.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M19.3 8.2l-5.5-5.5c-.3-.3-.7-.5-1.2-.5H3.9c-.8.1-1.6.9-1.6 1.8v14.1c0 .9.7 1.6 1.6 1.6h14.2c.9 0 1.6-.7 1.6-1.6V9.4c.1-.5-.1-.9-.4-1.2zm-5.8-3.3l3.4 3.6h-3.4V4.9zm3.9 12.7H4.7c-.1 0-.2 0-.2-.2V4.7c0-.2.1-.3.2-.3h7.2v4.4s0 .8.3 1.1c.3.3 1.1.3 1.1.3h4.3v7.2s-.1.2-.2.2z\"/>\n+  <path fill=\"#616161\" d=\"m19.3 8.2-5.5-5.5c-.3-.3-.7-.5-1.2-.5H3.9c-.8.1-1.6.9-1.6 1.8v14.1c0 .9.7 1.6 1.6 1.6h14.2c.9 0 1.6-.7 1.6-1.6V9.4c.1-.5-.1-.9-.4-1.2m-5.8-3.3 3.4 3.6h-3.4zm3.9 12.7H4.7c-.1 0-.2 0-.2-.2V4.7c0-.2.1-.3.2-.3h7.2v4.4s0 .8.3 1.1 1.1.3 1.1.3h4.3v7.2s-.1.2-.2.2\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/folder-favorite.svg b/packages/ui-components/style/icons/filetype/folder-favorite.svg\nindex 24cd4e9cc527..1d13569e2a57 100644\n--- a/packages/ui-components/style/icons/filetype/folder-favorite.svg\n+++ b/packages/ui-components/style/icons/filetype/folder-favorite.svg\n@@ -1,3 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 0 24 24\" width=\"24px\" fill=\"#000000\">\n-  <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/><path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-2.06 11L15 15.28 12.06 17l.78-3.33-2.59-2.24 3.41-.29L15 8l1.34 3.14 3.41.29-2.59 2.24.78 3.33z\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"#000\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-2.06 11L15 15.28 12.06 17l.78-3.33-2.59-2.24 3.41-.29L15 8l1.34 3.14 3.41.29-2.59 2.24z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/folder.svg b/packages/ui-components/style/icons/filetype/folder.svg\nindex 2bb8a9291073..418b76b0f253 100644\n--- a/packages/ui-components/style/icons/filetype/folder.svg\n+++ b/packages/ui-components/style/icons/filetype/folder.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z\"/>\n+  <path fill=\"#616161\" d=\"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/home.svg b/packages/ui-components/style/icons/filetype/home.svg\nindex 4ff34d4fa971..a1e761fccb1e 100644\n--- a/packages/ui-components/style/icons/filetype/home.svg\n+++ b/packages/ui-components/style/icons/filetype/home.svg\n@@ -1,3 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 0 24 24\" width=\"24px\" fill=\"#000000\">\n-  <path d=\"M0 0h24v24H0z\" fill=\"none\"/><path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"#000\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/html5.svg b/packages/ui-components/style/icons/filetype/html5.svg\nindex e099cd876a08..87a285df5edf 100644\n--- a/packages/ui-components/style/icons/filetype/html5.svg\n+++ b/packages/ui-components/style/icons/filetype/html5.svg\n@@ -1,7 +1,7 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 512 512\">\n-  <path class=\"jp-icon0 jp-icon-selectable\" fill=\"#000\" d=\"M108.4 0h23v22.8h21.2V0h23v69h-23V46h-21v23h-23.2M206 23h-20.3V0h63.7v23H229v46h-23m53.5-69h24.1l14.8 24.3L313.2 0h24.1v69h-23V34.8l-16.1 24.8-16.1-24.8V69h-22.6m89.2-69h23v46.2h32.6V69h-55.6\"/>\n-  <path class=\"jp-icon-selectable\" fill=\"#e44d26\" d=\"M107.6 471l-33-370.4h362.8l-33 370.2L255.7 512\"/>\n-  <path class=\"jp-icon-selectable\" fill=\"#f16529\" d=\"M256 480.5V131h148.3L376 447\"/>\n-  <path class=\"jp-icon-selectable-inverse\" fill=\"#ebebeb\" d=\"M142 176.3h114v45.4h-64.2l4.2 46.5h60v45.3H154.4m2 22.8H202l3.2 36.3 50.8 13.6v47.4l-93.2-26\"/>\n-  <path class=\"jp-icon-selectable-inverse\" fill=\"#fff\" d=\"M369.6 176.3H255.8v45.4h109.6m-4.1 46.5H255.8v45.4h56l-5.3 59-50.7 13.6v47.2l93-25.8\"/>\n+  <path fill=\"#000\" d=\"M108.4 0h23v22.8h21.2V0h23v69h-23V46h-21v23h-23.2M206 23h-20.3V0h63.7v23H229v46h-23m53.5-69h24.1l14.8 24.3L313.2 0h24.1v69h-23V34.8l-16.1 24.8-16.1-24.8V69h-22.6m89.2-69h23v46.2h32.6V69h-55.6\" class=\"jp-icon0 jp-icon-selectable\"/>\n+  <path fill=\"#e44d26\" d=\"m107.6 471-33-370.4h362.8l-33 370.2L255.7 512\" class=\"jp-icon-selectable\"/>\n+  <path fill=\"#f16529\" d=\"M256 480.5V131h148.3L376 447\" class=\"jp-icon-selectable\"/>\n+  <path fill=\"#ebebeb\" d=\"M142 176.3h114v45.4h-64.2l4.2 46.5h60v45.3H154.4m2 22.8H202l3.2 36.3 50.8 13.6v47.4l-93.2-26\" class=\"jp-icon-selectable-inverse\"/>\n+  <path fill=\"#fff\" d=\"M369.6 176.3H255.8v45.4h109.6m-4.1 46.5H255.8v45.4h56l-5.3 59-50.7 13.6v47.2l93-25.8\" class=\"jp-icon-selectable-inverse\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/image.svg b/packages/ui-components/style/icons/filetype/image.svg\nindex d56a330107ad..325ca1081058 100644\n--- a/packages/ui-components/style/icons/filetype/image.svg\n+++ b/packages/ui-components/style/icons/filetype/image.svg\n@@ -1,4 +1,4 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <path class=\"jp-icon-brand4 jp-icon-selectable-inverse\" fill=\"#FFF\" d=\"M2.2 2.2h17.5v17.5H2.2z\"/>\n-  <path class=\"jp-icon-brand0 jp-icon-selectable\" fill=\"#3F51B5\" d=\"M2.2 2.2v17.5h17.5l.1-17.5H2.2zm12.1 2.2c1.2 0 2.2 1 2.2 2.2s-1 2.2-2.2 2.2-2.2-1-2.2-2.2 1-2.2 2.2-2.2zM4.4 17.6l3.3-8.8 3.3 6.6 2.2-3.2 4.4 5.4H4.4z\"/>\n+  <path fill=\"#FFF\" d=\"M2.2 2.2h17.5v17.5H2.2z\" class=\"jp-icon-brand4 jp-icon-selectable-inverse\"/>\n+  <path fill=\"#3F51B5\" d=\"M2.2 2.2v17.5h17.5l.1-17.5zm12.1 2.2c1.2 0 2.2 1 2.2 2.2s-1 2.2-2.2 2.2-2.2-1-2.2-2.2 1-2.2 2.2-2.2M4.4 17.6l3.3-8.8 3.3 6.6 2.2-3.2 4.4 5.4z\" class=\"jp-icon-brand0 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/inspector.svg b/packages/ui-components/style/icons/filetype/inspector.svg\nindex 584efeb90e52..982b8647912a 100644\n--- a/packages/ui-components/style/icons/filetype/inspector.svg\n+++ b/packages/ui-components/style/icons/filetype/inspector.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <path class=\"jp-inspector-icon-color jp-icon-selectable\" fill=\"#616161\" d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z\"/>\n+  <path fill=\"#616161\" d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m-5 14H4v-4h11zm0-5H4V9h11zm5 5h-4V9h4z\" class=\"jp-inspector-icon-color jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/json.svg b/packages/ui-components/style/icons/filetype/json.svg\nindex aaa7087a95a8..088762c410b0 100644\n--- a/packages/ui-components/style/icons/filetype/json.svg\n+++ b/packages/ui-components/style/icons/filetype/json.svg\n@@ -1,6 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <g class=\"jp-json-icon-color jp-icon-selectable\" fill=\"#F9A825\">\n-    <path d=\"M20.2 11.8c-1.6 0-1.7.5-1.7 1 0 .4.1.9.1 1.3.1.5.1.9.1 1.3 0 1.7-1.4 2.3-3.5 2.3h-.9v-1.9h.5c1.1 0 1.4 0 1.4-.8 0-.3 0-.6-.1-1 0-.4-.1-.8-.1-1.2 0-1.3 0-1.8 1.3-2-1.3-.2-1.3-.7-1.3-2 0-.4.1-.8.1-1.2.1-.4.1-.7.1-1 0-.8-.4-.7-1.4-.8h-.5V4.1h.9c2.2 0 3.5.7 3.5 2.3 0 .4-.1.9-.1 1.3-.1.5-.1.9-.1 1.3 0 .5.2 1 1.7 1v1.8zM1.8 10.1c1.6 0 1.7-.5 1.7-1 0-.4-.1-.9-.1-1.3-.1-.5-.1-.9-.1-1.3 0-1.6 1.4-2.3 3.5-2.3h.9v1.9h-.5c-1 0-1.4 0-1.4.8 0 .3 0 .6.1 1 0 .2.1.6.1 1 0 1.3 0 1.8-1.3 2C6 11.2 6 11.7 6 13c0 .4-.1.8-.1 1.2-.1.3-.1.7-.1 1 0 .8.3.8 1.4.8h.5v1.9h-.9c-2.1 0-3.5-.6-3.5-2.3 0-.4.1-.9.1-1.3.1-.5.1-.9.1-1.3 0-.5-.2-1-1.7-1v-1.9z\"/>\n+  <g fill=\"#F9A825\" class=\"jp-json-icon-color jp-icon-selectable\">\n+    <path d=\"M20.2 11.8c-1.6 0-1.7.5-1.7 1 0 .4.1.9.1 1.3.1.5.1.9.1 1.3 0 1.7-1.4 2.3-3.5 2.3h-.9v-1.9h.5c1.1 0 1.4 0 1.4-.8 0-.3 0-.6-.1-1 0-.4-.1-.8-.1-1.2 0-1.3 0-1.8 1.3-2-1.3-.2-1.3-.7-1.3-2 0-.4.1-.8.1-1.2.1-.4.1-.7.1-1 0-.8-.4-.7-1.4-.8h-.5V4.1h.9c2.2 0 3.5.7 3.5 2.3 0 .4-.1.9-.1 1.3-.1.5-.1.9-.1 1.3 0 .5.2 1 1.7 1zM1.8 10.1c1.6 0 1.7-.5 1.7-1 0-.4-.1-.9-.1-1.3-.1-.5-.1-.9-.1-1.3 0-1.6 1.4-2.3 3.5-2.3h.9v1.9h-.5c-1 0-1.4 0-1.4.8 0 .3 0 .6.1 1 0 .2.1.6.1 1 0 1.3 0 1.8-1.3 2C6 11.2 6 11.7 6 13c0 .4-.1.8-.1 1.2-.1.3-.1.7-.1 1 0 .8.3.8 1.4.8h.5v1.9h-.9c-2.1 0-3.5-.6-3.5-2.3 0-.4.1-.9.1-1.3.1-.5.1-.9.1-1.3 0-.5-.2-1-1.7-1z\"/>\n     <circle cx=\"11\" cy=\"13.8\" r=\"2.1\"/>\n     <circle cx=\"11\" cy=\"8.2\" r=\"2.1\"/>\n   </g>\n\ndiff --git a/packages/ui-components/style/icons/filetype/julia.svg b/packages/ui-components/style/icons/filetype/julia.svg\nindex dcf156f72d2c..0b0adad4ff96 100644\n--- a/packages/ui-components/style/icons/filetype/julia.svg\n+++ b/packages/ui-components/style/icons/filetype/julia.svg\n@@ -1,11 +1,5 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 325 300\">\n-  <g class=\"jp-brand0 jp-icon-selectable\" fill=\"#cb3c33\">\n-    <path d=\"M 150.898438 225 C 150.898438 266.421875 117.320312 300 75.898438 300 C 34.476562 300 0.898438 266.421875 0.898438 225 C 0.898438 183.578125 34.476562 150 75.898438 150 C 117.320312 150 150.898438 183.578125 150.898438 225\"/>\n-  </g>\n-  <g class=\"jp-brand0 jp-icon-selectable\" fill=\"#389826\">\n-    <path d=\"M 237.5 75 C 237.5 116.421875 203.921875 150 162.5 150 C 121.078125 150 87.5 116.421875 87.5 75 C 87.5 33.578125 121.078125 0 162.5 0 C 203.921875 0 237.5 33.578125 237.5 75\"/>\n-  </g>\n-  <g class=\"jp-brand0 jp-icon-selectable\" fill=\"#9558b2\">\n-    <path d=\"M 324.101562 225 C 324.101562 266.421875 290.523438 300 249.101562 300 C 207.679688 300 174.101562 266.421875 174.101562 225 C 174.101562 183.578125 207.679688 150 249.101562 150 C 290.523438 150 324.101562 183.578125 324.101562 225\"/>\n-  </g>\n+  <path fill=\"#cb3c33\" d=\"M150.898 225c0 41.422-33.578 75-75 75s-75-33.578-75-75 33.579-75 75-75 75 33.578 75 75\" class=\"jp-brand0 jp-icon-selectable\"/>\n+  <path fill=\"#389826\" d=\"M237.5 75c0 41.422-33.578 75-75 75s-75-33.578-75-75 33.578-75 75-75 75 33.578 75 75\" class=\"jp-brand0 jp-icon-selectable\"/>\n+  <path fill=\"#9558b2\" d=\"M324.102 225c0 41.422-33.579 75-75 75s-75-33.578-75-75 33.578-75 75-75 75 33.578 75 75\" class=\"jp-brand0 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/keyboard.svg b/packages/ui-components/style/icons/filetype/keyboard.svg\nindex ddb8485cf1b5..26869fee2613 100644\n--- a/packages/ui-components/style/icons/filetype/keyboard.svg\n+++ b/packages/ui-components/style/icons/filetype/keyboard.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z\"/>\n+  <path fill=\"#616161\" d=\"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m-9 3h2v2h-2zm0 3h2v2h-2zM8 8h2v2H8zm0 3h2v2H8zm-1 2H5v-2h2zm0-3H5V8h2zm9 7H8v-2h8zm0-4h-2v-2h2zm0-3h-2V8h2zm3 3h-2v-2h2zm0-3h-2V8h2z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/launcher.svg b/packages/ui-components/style/icons/filetype/launcher.svg\nindex d7e2a167d3c0..897788338ef7 100644\n--- a/packages/ui-components/style/icons/filetype/launcher.svg\n+++ b/packages/ui-components/style/icons/filetype/launcher.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z\"/>\n+  <path fill=\"#616161\" d=\"M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/markdown.svg b/packages/ui-components/style/icons/filetype/markdown.svg\nindex e709276e7a68..d531fb4e86fa 100644\n--- a/packages/ui-components/style/icons/filetype/markdown.svg\n+++ b/packages/ui-components/style/icons/filetype/markdown.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <path class=\"jp-icon-contrast0 jp-icon-selectable\" fill=\"#7B1FA2\" d=\"M5 14.9h12l-6.1 6zm9.4-6.8c0-1.3-.1-2.9-.1-4.5-.4 1.4-.9 2.9-1.3 4.3l-1.3 4.3h-2L8.5 7.9c-.4-1.3-.7-2.9-1-4.3-.1 1.6-.1 3.2-.2 4.6L7 12.4H4.8l.7-11h3.3L10 5c.4 1.2.7 2.7 1 3.9.3-1.2.7-2.6 1-3.9l1.2-3.7h3.3l.6 11h-2.4l-.3-4.2z\"/>\n+  <path fill=\"#7B1FA2\" d=\"M5 14.9h12l-6.1 6zm9.4-6.8c0-1.3-.1-2.9-.1-4.5-.4 1.4-.9 2.9-1.3 4.3l-1.3 4.3h-2L8.5 7.9c-.4-1.3-.7-2.9-1-4.3-.1 1.6-.1 3.2-.2 4.6L7 12.4H4.8l.7-11h3.3L10 5c.4 1.2.7 2.7 1 3.9.3-1.2.7-2.6 1-3.9l1.2-3.7h3.3l.6 11h-2.4z\" class=\"jp-icon-contrast0 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/mermaid.svg b/packages/ui-components/style/icons/filetype/mermaid.svg\nindex 43210681df72..9ac2a4ef8439 100644\n--- a/packages/ui-components/style/icons/filetype/mermaid.svg\n+++ b/packages/ui-components/style/icons/filetype/mermaid.svg\n@@ -1,5 +1,3 @@\n-<svg width=\"16\" version=\"1.1\" viewBox=\"0 0 491 675\" xmlns=\"http://www.w3.org/2000/svg\">\n- <g class=\"jp-icon-contrast2 jp-icon-selectable\" fill=\"#ff3670\">\n-  <path d=\"m85 92c-46 0-85 37-85 85v321c0 46 37 85 85 85h321c46 0 85-37 85-85v-321c0-46-37-85-85-85zm-2 111c72-3.1 139 41 162 109 25-67 91-112 162-109 2.4 57-25 111-72 144-24 16-39 44-39 74v51h-104v-51c0.08-29-15-57-39-74-47-32-75-86-72-144z\"/>\n- </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" version=\"1.1\" viewBox=\"0 0 491 675\">\n+  <path fill=\"#ff3670\" d=\"M85 92c-46 0-85 37-85 85v321c0 46 37 85 85 85h321c46 0 85-37 85-85V177c0-46-37-85-85-85zm-2 111c72-3.1 139 41 162 109 25-67 91-112 162-109 2.4 57-25 111-72 144-24 16-39 44-39 74v51H192v-51c.08-29-15-57-39-74-47-32-75-86-72-144z\" class=\"jp-icon-contrast2 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/notebook.svg b/packages/ui-components/style/icons/filetype/notebook.svg\nindex 077a399dfef4..c480083cdcc9 100644\n--- a/packages/ui-components/style/icons/filetype/notebook.svg\n+++ b/packages/ui-components/style/icons/filetype/notebook.svg\n@@ -1,6 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <g class=\"jp-notebook-icon-color jp-icon-selectable\" fill=\"#EF6C00\">\n-    <path d=\"M18.7 3.3v15.4H3.3V3.3h15.4m1.5-1.5H1.8v18.3h18.3l.1-18.3z\"/>\n-    <path d=\"M16.5 16.5l-5.4-4.3-5.6 4.3v-11h11z\"/>\n+  <g fill=\"#EF6C00\" class=\"jp-notebook-icon-color jp-icon-selectable\">\n+    <path d=\"M18.7 3.3v15.4H3.3V3.3zm1.5-1.5H1.8v18.3h18.3z\"/>\n+    <path d=\"m16.5 16.5-5.4-4.3-5.6 4.3v-11h11z\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/pdf.svg b/packages/ui-components/style/icons/filetype/pdf.svg\nindex fcf12cbf3d59..994b68a8bdb0 100644\n--- a/packages/ui-components/style/icons/filetype/pdf.svg\n+++ b/packages/ui-components/style/icons/filetype/pdf.svg\n@@ -1,6 +1,3 @@\n-<svg\n-   xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 22 22\" width=\"16\">\n-    <path transform=\"rotate(45)\" class=\"jp-icon-selectable\" fill=\"#FF2A2A\"\n-       d=\"m 22.344369,-3.0163642 h 5.638604 v 1.5792433 h -3.549227 v 1.50869299 h 3.337576 V 1.6508154 h -3.337576 v 3.4352613 h -2.089377 z m -7.136444,1.5792433 v 4.9439543 h 0.74892 q 1.280761,0 1.953703,-0.6349535 0.678369,-0.6349535 0.678369,-1.8451641 0,-1.20478355 -0.672942,-1.83431011 -0.672942,-0.62952659 -1.95913,-0.62952659 z m -2.089377,-1.5792433 h 2.203343 q 1.845164,0 2.746039,0.2659207 0.906301,0.2604937 1.552108,0.8900203 0.56983,0.5481223 0.846605,1.26448006 0.276774,0.71635781 0.276774,1.62265894 0,0.9171551 -0.276774,1.6389399 -0.276775,0.7163578 -0.846605,1.26448 -0.651234,0.6295266 -1.562962,0.8954473 -0.911728,0.2604937 -2.735185,0.2604937 h -2.203343 z m -8.1458565,0 h 3.467823 q 1.5466816,0 2.3715785,0.689223 0.830324,0.6837961 0.830324,1.95370314 0,1.27533397 -0.830324,1.96455706 Q 9.9871961,2.274915 8.4405145,2.274915 H 7.0620684 V 5.0860767 H 4.9726915 Z m 2.0893769,1.5141199 v 2.26303943 h 1.155941 q 0.6078188,0 0.9388629,-0.29305547 0.3310441,-0.29848241 0.3310441,-0.84117772 0,-0.54269531 -0.3310441,-0.83575074 -0.3310441,-0.2930555 -0.9388629,-0.2930555 z\"\n-/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n+  <path fill=\"#FF2A2A\" d=\"m17.933 13.667 3.987 3.987-1.117 1.117-2.51-2.51-1.066 1.067 2.36 2.36-1.117 1.117-2.36-2.36-2.43 2.429-1.477-1.478zm-6.163-3.93-3.496 3.496.53.53q.905.906 1.83.932.929.031 1.784-.825.852-.852.822-1.773t-.94-1.83zm-.36-2.594 1.557 1.558q1.305 1.305 1.754 2.13.456.825.468 1.727.015.79-.296 1.493-.31.702-.951 1.343-.649.648-1.355.963-.702.31-1.493.295-.905-.015-1.738-.472-.829-.46-2.118-1.75L5.68 12.874zm-5.76-5.76L8.1 3.835Q9.195 4.93 9.291 6q.103 1.07-.795 1.968-.901.902-1.976.802-1.067-.1-2.16-1.193l-.975-.975L1.397 8.59-.08 7.113Zm.406 2.548-1.6 1.6.817.818q.43.43.871.457.445.023.829-.361t.357-.825-.457-.871z\" class=\"jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/python.svg b/packages/ui-components/style/icons/filetype/python.svg\nindex 81cd42772de5..906930c066f5 100644\n--- a/packages/ui-components/style/icons/filetype/python.svg\n+++ b/packages/ui-components/style/icons/filetype/python.svg\n@@ -1,4 +1,4 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"-10 -10 131.16136169433594 132.38899993896484\">\n-  <path class=\"jp-icon-selectable\" fill=\"#306998\" d=\"M 54.918785,9.1927421e-4 C 50.335132,0.02221727 45.957846,0.41313697 42.106285,1.0946693 30.760069,3.0991731 28.700036,7.2947714 28.700035,15.032169 v 10.21875 h 26.8125 v 3.40625 h -26.8125 -10.0625 c -7.792459,0 -14.6157588,4.683717 -16.7499998,13.59375 -2.46181998,10.212966 -2.57101508,16.586023 0,27.25 1.9059283,7.937852 6.4575432,13.593748 14.2499998,13.59375 h 9.21875 v -12.25 c 0,-8.849902 7.657144,-16.656248 16.75,-16.65625 h 26.78125 c 7.454951,0 13.406253,-6.138164 13.40625,-13.625 v -25.53125 c 0,-7.2663386 -6.12998,-12.7247771 -13.40625,-13.9374997 C 64.281548,0.32794397 59.502438,-0.02037903 54.918785,9.1927421e-4 Z m -14.5,8.21875012579 c 2.769547,0 5.03125,2.2986456 5.03125,5.1249996 -2e-6,2.816336 -2.261703,5.09375 -5.03125,5.09375 -2.779476,-1e-6 -5.03125,-2.277415 -5.03125,-5.09375 -10e-7,-2.826353 2.251774,-5.1249996 5.03125,-5.1249996 z\"/>\n-  <path class=\"jp-icon-selectable\" fill=\"#ffd43b\" d=\"m 85.637535,28.657169 v 11.90625 c 0,9.230755 -7.825895,16.999999 -16.75,17 h -26.78125 c -7.335833,0 -13.406249,6.278483 -13.40625,13.625 v 25.531247 c 0,7.266344 6.318588,11.540324 13.40625,13.625004 8.487331,2.49561 16.626237,2.94663 26.78125,0 6.750155,-1.95439 13.406253,-5.88761 13.40625,-13.625004 V 86.500919 h -26.78125 v -3.40625 h 26.78125 13.406254 c 7.792461,0 10.696251,-5.435408 13.406241,-13.59375 2.79933,-8.398886 2.68022,-16.475776 0,-27.25 -1.92578,-7.757441 -5.60387,-13.59375 -13.406241,-13.59375 z m -15.0625,64.65625 c 2.779478,3e-6 5.03125,2.277417 5.03125,5.093747 -2e-6,2.826354 -2.251775,5.125004 -5.03125,5.125004 -2.76955,0 -5.03125,-2.29865 -5.03125,-5.125004 2e-6,-2.81633 2.261697,-5.093747 5.03125,-5.093747 z\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"-10 -10 131.161 132.389\">\n+  <path fill=\"#306998\" d=\"M54.919 0c-4.584.022-8.961.413-12.813 1.095C30.76 3.099 28.7 7.295 28.7 15.032v10.219h26.813v3.406H18.638c-7.793 0-14.616 4.684-16.75 13.594-2.462 10.213-2.571 16.586 0 27.25 1.905 7.938 6.457 13.594 14.25 13.594h9.218v-12.25c0-8.85 7.657-16.657 16.75-16.657h26.782c7.454 0 13.406-6.138 13.406-13.625v-25.53c0-7.267-6.13-12.726-13.406-13.938C64.282.328 59.502-.02 54.918 0m-14.5 8.22c2.77 0 5.031 2.298 5.031 5.125 0 2.816-2.262 5.093-5.031 5.093-2.78 0-5.031-2.277-5.031-5.093 0-2.827 2.251-5.125 5.03-5.125\" class=\"jp-icon-selectable\"/>\n+  <path fill=\"#ffd43b\" d=\"M85.638 28.657v11.906c0 9.231-7.826 17-16.75 17H42.106c-7.336 0-13.406 6.279-13.406 13.625V96.72c0 7.266 6.319 11.54 13.406 13.625 8.488 2.495 16.627 2.946 26.782 0 6.75-1.955 13.406-5.888 13.406-13.625V86.5H55.513v-3.405H95.7c7.793 0 10.696-5.436 13.406-13.594 2.8-8.399 2.68-16.476 0-27.25-1.925-7.758-5.604-13.594-13.406-13.594zM70.575 93.313c2.78 0 5.031 2.278 5.031 5.094 0 2.827-2.251 5.125-5.031 5.125-2.77 0-5.031-2.298-5.031-5.125 0-2.816 2.261-5.094 5.031-5.094\" class=\"jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/r-kernel.svg b/packages/ui-components/style/icons/filetype/r-kernel.svg\nindex 2392f4cdb53a..25175ee593da 100644\n--- a/packages/ui-components/style/icons/filetype/r-kernel.svg\n+++ b/packages/ui-components/style/icons/filetype/r-kernel.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <path class=\"jp-icon-contrast3 jp-icon-selectable\" fill=\"#2196F3\" d=\"M4.4 2.5c1.2-.1 2.9-.3 4.9-.3 2.5 0 4.1.4 5.2 1.3 1 .7 1.5 1.9 1.5 3.5 0 2-1.4 3.5-2.9 4.1 1.2.4 1.7 1.6 2.2 3 .6 1.9 1 3.9 1.3 4.6h-3.8c-.3-.4-.8-1.7-1.2-3.7s-1.2-2.6-2.6-2.6h-.9v6.4H4.4V2.5zm3.7 6.9h1.4c1.9 0 2.9-.9 2.9-2.3s-1-2.3-2.8-2.3c-.7 0-1.3 0-1.6.2v4.5h.1v-.1z\"/>\n+  <path fill=\"#2196F3\" d=\"M4.4 2.5c1.2-.1 2.9-.3 4.9-.3 2.5 0 4.1.4 5.2 1.3 1 .7 1.5 1.9 1.5 3.5 0 2-1.4 3.5-2.9 4.1 1.2.4 1.7 1.6 2.2 3 .6 1.9 1 3.9 1.3 4.6h-3.8c-.3-.4-.8-1.7-1.2-3.7s-1.2-2.6-2.6-2.6h-.9v6.4H4.4zm3.7 6.9h1.4c1.9 0 2.9-.9 2.9-2.3s-1-2.3-2.8-2.3c-.7 0-1.3 0-1.6.2v4.5h.1z\" class=\"jp-icon-contrast3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/react.svg b/packages/ui-components/style/icons/filetype/react.svg\nindex b47d776d03a3..c0ed4c397569 100644\n--- a/packages/ui-components/style/icons/filetype/react.svg\n+++ b/packages/ui-components/style/icons/filetype/react.svg\n@@ -1,6 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"150 150 541.9 295.3\">\n-  <g class=\"jp-icon-brand2 jp-icon-selectable\" fill=\"#61DAFB\">\n-    <path d=\"M666.3 296.5c0-32.5-40.7-63.3-103.1-82.4 14.4-63.6 8-114.2-20.2-130.4-6.5-3.8-14.1-5.6-22.4-5.6v22.3c4.6 0 8.3.9 11.4 2.6 13.6 7.8 19.5 37.5 14.9 75.7-1.1 9.4-2.9 19.3-5.1 29.4-19.6-4.8-41-8.5-63.5-10.9-13.5-18.5-27.5-35.3-41.6-50 32.6-30.3 63.2-46.9 84-46.9V78c-27.5 0-63.5 19.6-99.9 53.6-36.4-33.8-72.4-53.2-99.9-53.2v22.3c20.7 0 51.4 16.5 84 46.6-14 14.7-28 31.4-41.3 49.9-22.6 2.4-44 6.1-63.6 11-2.3-10-4-19.7-5.2-29-4.7-38.2 1.1-67.9 14.6-75.8 3-1.8 6.9-2.6 11.5-2.6V78.5c-8.4 0-16 1.8-22.6 5.6-28.1 16.2-34.4 66.7-19.9 130.1-62.2 19.2-102.7 49.9-102.7 82.3 0 32.5 40.7 63.3 103.1 82.4-14.4 63.6-8 114.2 20.2 130.4 6.5 3.8 14.1 5.6 22.5 5.6 27.5 0 63.5-19.6 99.9-53.6 36.4 33.8 72.4 53.2 99.9 53.2 8.4 0 16-1.8 22.6-5.6 28.1-16.2 34.4-66.7 19.9-130.1 62-19.1 102.5-49.9 102.5-82.3zm-130.2-66.7c-3.7 12.9-8.3 26.2-13.5 39.5-4.1-8-8.4-16-13.1-24-4.6-8-9.5-15.8-14.4-23.4 14.2 2.1 27.9 4.7 41 7.9zm-45.8 106.5c-7.8 13.5-15.8 26.3-24.1 38.2-14.9 1.3-30 2-45.2 2-15.1 0-30.2-.7-45-1.9-8.3-11.9-16.4-24.6-24.2-38-7.6-13.1-14.5-26.4-20.8-39.8 6.2-13.4 13.2-26.8 20.7-39.9 7.8-13.5 15.8-26.3 24.1-38.2 14.9-1.3 30-2 45.2-2 15.1 0 30.2.7 45 1.9 8.3 11.9 16.4 24.6 24.2 38 7.6 13.1 14.5 26.4 20.8 39.8-6.3 13.4-13.2 26.8-20.7 39.9zm32.3-13c5.4 13.4 10 26.8 13.8 39.8-13.1 3.2-26.9 5.9-41.2 8 4.9-7.7 9.8-15.6 14.4-23.7 4.6-8 8.9-16.1 13-24.1zM421.2 430c-9.3-9.6-18.6-20.3-27.8-32 9 .4 18.2.7 27.5.7 9.4 0 18.7-.2 27.8-.7-9 11.7-18.3 22.4-27.5 32zm-74.4-58.9c-14.2-2.1-27.9-4.7-41-7.9 3.7-12.9 8.3-26.2 13.5-39.5 4.1 8 8.4 16 13.1 24 4.7 8 9.5 15.8 14.4 23.4zM420.7 163c9.3 9.6 18.6 20.3 27.8 32-9-.4-18.2-.7-27.5-.7-9.4 0-18.7.2-27.8.7 9-11.7 18.3-22.4 27.5-32zm-74 58.9c-4.9 7.7-9.8 15.6-14.4 23.7-4.6 8-8.9 16-13 24-5.4-13.4-10-26.8-13.8-39.8 13.1-3.1 26.9-5.8 41.2-7.9zm-90.5 125.2c-35.4-15.1-58.3-34.9-58.3-50.6 0-15.7 22.9-35.6 58.3-50.6 8.6-3.7 18-7 27.7-10.1 5.7 19.6 13.2 40 22.5 60.9-9.2 20.8-16.6 41.1-22.2 60.6-9.9-3.1-19.3-6.5-28-10.2zM310 490c-13.6-7.8-19.5-37.5-14.9-75.7 1.1-9.4 2.9-19.3 5.1-29.4 19.6 4.8 41 8.5 63.5 10.9 13.5 18.5 27.5 35.3 41.6 50-32.6 30.3-63.2 46.9-84 46.9-4.5-.1-8.3-1-11.3-2.7zm237.2-76.2c4.7 38.2-1.1 67.9-14.6 75.8-3 1.8-6.9 2.6-11.5 2.6-20.7 0-51.4-16.5-84-46.6 14-14.7 28-31.4 41.3-49.9 22.6-2.4 44-6.1 63.6-11 2.3 10.1 4.1 19.8 5.2 29.1zm38.5-66.7c-8.6 3.7-18 7-27.7 10.1-5.7-19.6-13.2-40-22.5-60.9 9.2-20.8 16.6-41.1 22.2-60.6 9.9 3.1 19.3 6.5 28.1 10.2 35.4 15.1 58.3 34.9 58.3 50.6-.1 15.7-23 35.6-58.4 50.6zM320.8 78.4z\"/>\n+  <g fill=\"#61DAFB\" class=\"jp-icon-brand2 jp-icon-selectable\">\n+    <path d=\"M666.3 296.5c0-32.5-40.7-63.3-103.1-82.4 14.4-63.6 8-114.2-20.2-130.4-6.5-3.8-14.1-5.6-22.4-5.6v22.3c4.6 0 8.3.9 11.4 2.6 13.6 7.8 19.5 37.5 14.9 75.7-1.1 9.4-2.9 19.3-5.1 29.4-19.6-4.8-41-8.5-63.5-10.9-13.5-18.5-27.5-35.3-41.6-50 32.6-30.3 63.2-46.9 84-46.9V78c-27.5 0-63.5 19.6-99.9 53.6-36.4-33.8-72.4-53.2-99.9-53.2v22.3c20.7 0 51.4 16.5 84 46.6-14 14.7-28 31.4-41.3 49.9-22.6 2.4-44 6.1-63.6 11-2.3-10-4-19.7-5.2-29-4.7-38.2 1.1-67.9 14.6-75.8 3-1.8 6.9-2.6 11.5-2.6V78.5c-8.4 0-16 1.8-22.6 5.6-28.1 16.2-34.4 66.7-19.9 130.1-62.2 19.2-102.7 49.9-102.7 82.3 0 32.5 40.7 63.3 103.1 82.4-14.4 63.6-8 114.2 20.2 130.4 6.5 3.8 14.1 5.6 22.5 5.6 27.5 0 63.5-19.6 99.9-53.6 36.4 33.8 72.4 53.2 99.9 53.2 8.4 0 16-1.8 22.6-5.6 28.1-16.2 34.4-66.7 19.9-130.1 62-19.1 102.5-49.9 102.5-82.3m-130.2-66.7c-3.7 12.9-8.3 26.2-13.5 39.5-4.1-8-8.4-16-13.1-24-4.6-8-9.5-15.8-14.4-23.4 14.2 2.1 27.9 4.7 41 7.9m-45.8 106.5c-7.8 13.5-15.8 26.3-24.1 38.2-14.9 1.3-30 2-45.2 2-15.1 0-30.2-.7-45-1.9-8.3-11.9-16.4-24.6-24.2-38-7.6-13.1-14.5-26.4-20.8-39.8 6.2-13.4 13.2-26.8 20.7-39.9 7.8-13.5 15.8-26.3 24.1-38.2 14.9-1.3 30-2 45.2-2 15.1 0 30.2.7 45 1.9 8.3 11.9 16.4 24.6 24.2 38 7.6 13.1 14.5 26.4 20.8 39.8-6.3 13.4-13.2 26.8-20.7 39.9m32.3-13c5.4 13.4 10 26.8 13.8 39.8-13.1 3.2-26.9 5.9-41.2 8 4.9-7.7 9.8-15.6 14.4-23.7 4.6-8 8.9-16.1 13-24.1M421.2 430c-9.3-9.6-18.6-20.3-27.8-32 9 .4 18.2.7 27.5.7 9.4 0 18.7-.2 27.8-.7-9 11.7-18.3 22.4-27.5 32m-74.4-58.9c-14.2-2.1-27.9-4.7-41-7.9 3.7-12.9 8.3-26.2 13.5-39.5 4.1 8 8.4 16 13.1 24q7.05 12 14.4 23.4M420.7 163c9.3 9.6 18.6 20.3 27.8 32-9-.4-18.2-.7-27.5-.7-9.4 0-18.7.2-27.8.7 9-11.7 18.3-22.4 27.5-32m-74 58.9c-4.9 7.7-9.8 15.6-14.4 23.7-4.6 8-8.9 16-13 24-5.4-13.4-10-26.8-13.8-39.8 13.1-3.1 26.9-5.8 41.2-7.9m-90.5 125.2c-35.4-15.1-58.3-34.9-58.3-50.6s22.9-35.6 58.3-50.6c8.6-3.7 18-7 27.7-10.1 5.7 19.6 13.2 40 22.5 60.9-9.2 20.8-16.6 41.1-22.2 60.6-9.9-3.1-19.3-6.5-28-10.2M310 490c-13.6-7.8-19.5-37.5-14.9-75.7 1.1-9.4 2.9-19.3 5.1-29.4 19.6 4.8 41 8.5 63.5 10.9 13.5 18.5 27.5 35.3 41.6 50-32.6 30.3-63.2 46.9-84 46.9-4.5-.1-8.3-1-11.3-2.7m237.2-76.2c4.7 38.2-1.1 67.9-14.6 75.8-3 1.8-6.9 2.6-11.5 2.6-20.7 0-51.4-16.5-84-46.6 14-14.7 28-31.4 41.3-49.9 22.6-2.4 44-6.1 63.6-11 2.3 10.1 4.1 19.8 5.2 29.1m38.5-66.7c-8.6 3.7-18 7-27.7 10.1-5.7-19.6-13.2-40-22.5-60.9 9.2-20.8 16.6-41.1 22.2-60.6 9.9 3.1 19.3 6.5 28.1 10.2 35.4 15.1 58.3 34.9 58.3 50.6-.1 15.7-23 35.6-58.4 50.6M320.8 78.4\"/>\n     <circle cx=\"420.9\" cy=\"296.5\" r=\"45.7\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/settings.svg b/packages/ui-components/style/icons/filetype/settings.svg\nindex 23f64f5062ed..bdd39286e26b 100644\n--- a/packages/ui-components/style/icons/filetype/settings.svg\n+++ b/packages/ui-components/style/icons/filetype/settings.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <path class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" d=\"M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65A.488.488 0 0014 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z\"/>\n+  <path fill=\"#616161\" d=\"M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65A.49.49 0 0 0 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/spreadsheet.svg b/packages/ui-components/style/icons/filetype/spreadsheet.svg\nindex 646389e1c92e..c3fb4e12f68a 100644\n--- a/packages/ui-components/style/icons/filetype/spreadsheet.svg\n+++ b/packages/ui-components/style/icons/filetype/spreadsheet.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <path class=\"jp-icon-contrast1 jp-icon-selectable\" fill=\"#4CAF50\" d=\"M2.2 2.2v17.6h17.6V2.2H2.2zm15.4 7.7h-5.5V4.4h5.5v5.5zM9.9 4.4v5.5H4.4V4.4h5.5zm-5.5 7.7h5.5v5.5H4.4v-5.5zm7.7 5.5v-5.5h5.5v5.5h-5.5z\"/>\n+  <path fill=\"#4CAF50\" d=\"M2.2 2.2v17.6h17.6V2.2zm15.4 7.7h-5.5V4.4h5.5zM9.9 4.4v5.5H4.4V4.4zm-5.5 7.7h5.5v5.5H4.4zm7.7 5.5v-5.5h5.5v5.5z\" class=\"jp-icon-contrast1 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/text-editor.svg b/packages/ui-components/style/icons/filetype/text-editor.svg\nindex d9d83475bdfc..9f9cf6215471 100644\n--- a/packages/ui-components/style/icons/filetype/text-editor.svg\n+++ b/packages/ui-components/style/icons/filetype/text-editor.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <path class=\"jp-text-editor-icon-color jp-icon-selectable\" fill=\"#616161\" d=\"M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z\"/>\n+  <path fill=\"#616161\" d=\"M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z\" class=\"jp-text-editor-icon-color jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/vega.svg b/packages/ui-components/style/icons/filetype/vega.svg\nindex a9d7e6ca36d3..a9886f548cd9 100644\n--- a/packages/ui-components/style/icons/filetype/vega.svg\n+++ b/packages/ui-components/style/icons/filetype/vega.svg\n@@ -1,6 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <g class=\"jp-icon1 jp-icon-selectable\" fill=\"#212121\">\n-    <path d=\"M10.6 5.4l2.2-3.2H2.2v7.3l4-6.6z\"/>\n-    <path d=\"M15.8 2.2l-4.4 6.6L7 6.3l-4.8 8v5.5h17.6V2.2h-4zm-7 15.4H5.5v-4.4h3.3v4.4zm4.4 0H9.8V9.8h3.4v7.8zm4.4 0h-3.4V6.5h3.4v11.1z\"/>\n+  <g fill=\"#212121\" class=\"jp-icon1 jp-icon-selectable\">\n+    <path d=\"m10.6 5.4 2.2-3.2H2.2v7.3l4-6.6z\"/>\n+    <path d=\"m15.8 2.2-4.4 6.6L7 6.3l-4.8 8v5.5h17.6V2.2zm-7 15.4H5.5v-4.4h3.3zm4.4 0H9.8V9.8h3.4zm4.4 0h-3.4V6.5h3.4z\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/filetype/yaml.svg b/packages/ui-components/style/icons/filetype/yaml.svg\nindex 6ec3858d0d14..b70641e97802 100644\n--- a/packages/ui-components/style/icons/filetype/yaml.svg\n+++ b/packages/ui-components/style/icons/filetype/yaml.svg\n@@ -1,7 +1,7 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 22 22\">\n-  <g class=\"jp-icon-contrast2 jp-icon-selectable\" fill=\"#D81B60\">\n-    <path d=\"M7.2 18.6v-5.4L3 5.6h3.3l1.4 3.1c.3.9.6 1.6 1 2.5.3-.8.6-1.6 1-2.5l1.4-3.1h3.4l-4.4 7.6v5.5l-2.9-.1z\"/>\n-    <circle class=\"st0\" cx=\"17.6\" cy=\"16.5\" r=\"2.1\"/>\n-    <circle class=\"st0\" cx=\"17.6\" cy=\"11\" r=\"2.1\"/>\n+  <g fill=\"#D81B60\" class=\"jp-icon-contrast2 jp-icon-selectable\">\n+    <path d=\"M7.2 18.6v-5.4L3 5.6h3.3l1.4 3.1c.3.9.6 1.6 1 2.5.3-.8.6-1.6 1-2.5l1.4-3.1h3.4l-4.4 7.6v5.5z\"/>\n+    <circle cx=\"17.6\" cy=\"16.5\" r=\"2.1\"/>\n+    <circle cx=\"17.6\" cy=\"11\" r=\"2.1\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/history.svg b/packages/ui-components/style/icons/history.svg\nindex 6b56253dfd45..f9d47d2c051e 100644\n--- a/packages/ui-components/style/icons/history.svg\n+++ b/packages/ui-components/style/icons/history.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-<g class=\"jp-icon3\" fill=\"#616161\"><path d=\"M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3\" /></g>\n+  <path fill=\"#616161\" d=\"M13.5 8H12v5l4.28 2.54.72-1.21-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9 9 9 0 0 0-9-9\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/info.svg b/packages/ui-components/style/icons/info.svg\nindex 3e63698eb1d3..cde16224e970 100644\n--- a/packages/ui-components/style/icons/info.svg\n+++ b/packages/ui-components/style/icons/info.svg\n@@ -1,18 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 50.978 50.978\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\">\n-\t\t<path d=\"M43.52,7.458C38.711,2.648,32.307,0,25.489,0C18.67,0,12.266,2.648,7.458,7.458\n-\t\t\tc-9.943,9.941-9.943,26.119,0,36.062c4.809,4.809,11.212,7.456,18.031,7.458c0,0,0.001,0,0.002,0\n-\t\t\tc6.816,0,13.221-2.648,18.029-7.458c4.809-4.809,7.457-11.212,7.457-18.03C50.977,18.67,48.328,12.266,43.52,7.458z\n-\t\t\t M42.106,42.105c-4.432,4.431-10.332,6.872-16.615,6.872h-0.002c-6.285-0.001-12.187-2.441-16.617-6.872\n-\t\t\tc-9.162-9.163-9.162-24.071,0-33.233C13.303,4.44,19.204,2,25.489,2c6.284,0,12.186,2.44,16.617,6.872\n-\t\t\tc4.431,4.431,6.871,10.332,6.871,16.617C48.977,31.772,46.536,37.675,42.106,42.105z\"/>\n-\t\t<path d=\"M23.578,32.218c-0.023-1.734,0.143-3.059,0.496-3.972c0.353-0.913,1.11-1.997,2.272-3.253\n-\t\t\tc0.468-0.536,0.923-1.062,1.367-1.575c0.626-0.753,1.104-1.478,1.436-2.175c0.331-0.707,0.495-1.541,0.495-2.5\n-\t\t\tc0-1.096-0.26-2.088-0.779-2.979c-0.565-0.879-1.501-1.336-2.806-1.369c-1.802,0.057-2.985,0.667-3.55,1.832\n-\t\t\tc-0.301,0.535-0.503,1.141-0.607,1.814c-0.139,0.707-0.207,1.432-0.207,2.174h-2.937c-0.091-2.208,0.407-4.114,1.493-5.719\n-\t\t\tc1.062-1.64,2.855-2.481,5.378-2.527c2.16,0.023,3.874,0.608,5.141,1.758c1.278,1.16,1.929,2.764,1.95,4.811\n-\t\t\tc0,1.142-0.137,2.111-0.41,2.911c-0.309,0.845-0.731,1.593-1.268,2.243c-0.492,0.65-1.068,1.318-1.73,2.002\n-\t\t\tc-0.65,0.697-1.313,1.479-1.987,2.346c-0.239,0.377-0.429,0.777-0.565,1.199c-0.16,0.959-0.217,1.951-0.171,2.979\n-\t\t\tC26.589,32.218,23.578,32.218,23.578,32.218z M23.578,38.22v-3.484h3.076v3.484H23.578z\"/>\n-\t</g>\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n+    <path d=\"M43.52 7.458C38.711 2.648 32.307 0 25.489 0 18.67 0 12.266 2.648 7.458 7.458c-9.943 9.941-9.943 26.119 0 36.062 4.809 4.809 11.212 7.456 18.031 7.458h.002c6.816 0 13.221-2.648 18.029-7.458 4.809-4.809 7.457-11.212 7.457-18.03 0-6.82-2.649-13.224-7.457-18.032m-1.414 34.647c-4.432 4.431-10.332 6.872-16.615 6.872h-.002c-6.285-.001-12.187-2.441-16.617-6.872-9.162-9.163-9.162-24.071 0-33.233C13.303 4.44 19.204 2 25.489 2c6.284 0 12.186 2.44 16.617 6.872 4.431 4.431 6.871 10.332 6.871 16.617 0 6.283-2.441 12.186-6.871 16.616\"/>\n+    <path d=\"M23.578 32.218q-.034-2.602.496-3.972t2.272-3.253q.702-.805 1.367-1.575.939-1.13 1.436-2.175.496-1.061.495-2.5 0-1.643-.779-2.979-.848-1.319-2.806-1.369-2.703.085-3.55 1.832a5.3 5.3 0 0 0-.607 1.814 11.3 11.3 0 0 0-.207 2.174h-2.937q-.136-3.312 1.493-5.719 1.593-2.459 5.378-2.527 3.24.034 5.141 1.758 1.918 1.74 1.95 4.811 0 1.712-.41 2.911a7.6 7.6 0 0 1-1.268 2.243 22 22 0 0 1-1.73 2.002 34 34 0 0 0-1.987 2.346 5.2 5.2 0 0 0-.565 1.199q-.24 1.438-.171 2.979zm0 6.002v-3.484h3.076v3.484z\"/>\n+  </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/jupyter/jupyter-favicon.svg b/packages/ui-components/style/icons/jupyter/jupyter-favicon.svg\nindex 8baf11296250..6a630fc9b6fd 100644\n--- a/packages/ui-components/style/icons/jupyter/jupyter-favicon.svg\n+++ b/packages/ui-components/style/icons/jupyter/jupyter-favicon.svg\n@@ -1,6 +1,3 @@\n-<svg width=\"152\" height=\"165\" viewBox=\"0 0 152 165\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n-   <g class=\"jp-jupyter-icon-color\" fill=\"#F37726\">\n-    <path transform=\"translate(0.078947, 110.582927)\" d=\"M75.9422842,29.5804561 C43.3023947,29.5804561 14.7967832,17.6534634 0,0 C5.51083211,15.8406829 15.7815389,29.5667732 29.3904947,39.2784171 C42.9997,48.9898537 59.2737,54.2067805 75.9605789,54.2067805 C92.6474579,54.2067805 108.921458,48.9898537 122.530663,39.2784171 C136.139453,29.5667732 146.410284,15.8406829 151.921158,0 C137.087868,17.6534634 108.582589,29.5804561 75.9422842,29.5804561 L75.9422842,29.5804561 Z\" />\n-    <path transform=\"translate(0.037368, 0.704878)\" d=\"M75.9784579,24.6264073 C108.618763,24.6264073 137.124458,36.5534415 151.921158,54.2067805 C146.410284,38.366222 136.139453,24.6401317 122.530663,14.9284878 C108.921458,5.2168439 92.6474579,0 75.9605789,0 C59.2737,0 42.9997,5.2168439 29.3904947,14.9284878 C15.7815389,24.6401317 5.51083211,38.366222 0,54.2067805 C14.8330816,36.5899293 43.3385684,24.6264073 75.9784579,24.6264073 L75.9784579,24.6264073 Z\" />\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"152\" height=\"165\" version=\"1.1\" viewBox=\"0 0 152 165\">\n+  <path fill=\"#F37726\" d=\"M76.021 140.163c-32.64 0-61.145-11.927-75.942-29.58 5.51 15.84 15.781 29.567 29.39 39.278a80.17 80.17 0 0 0 46.57 14.929 80.17 80.17 0 0 0 46.57-14.929c13.61-9.711 23.88-23.437 29.391-39.278-14.833 17.653-43.338 29.58-75.979 29.58m-.005-114.832c32.64 0 61.146 11.927 75.943 29.58a80.9 80.9 0 0 0-29.391-39.278A80.16 80.16 0 0 0 75.998.705a80.16 80.16 0 0 0-46.57 14.928A80.9 80.9 0 0 0 .038 54.912c14.832-17.617 43.338-29.58 75.978-29.58\" class=\"jp-jupyter-icon-color\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/jupyter/jupyter.svg b/packages/ui-components/style/icons/jupyter/jupyter.svg\nindex f7a2bec90ab7..bc7ba182fba3 100644\n--- a/packages/ui-components/style/icons/jupyter/jupyter.svg\n+++ b/packages/ui-components/style/icons/jupyter/jupyter.svg\n@@ -1,13 +1,4 @@\n-<svg width=\"39\" height=\"51\" viewBox=\"0 0 39 51\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g transform=\"translate(-1638 -2281)\">\n-     <g class=\"jp-jupyter-icon-color\" fill=\"#F37726\">\n-      <path transform=\"translate(1639.74 2311.98)\" d=\"M 18.2646 7.13411C 10.4145 7.13411 3.55872 4.2576 0 0C 1.32539 3.8204 3.79556 7.13081 7.0686 9.47303C 10.3417 11.8152 14.2557 13.0734 18.269 13.0734C 22.2823 13.0734 26.1963 11.8152 29.4694 9.47303C 32.7424 7.13081 35.2126 3.8204 36.538 0C 32.9705 4.2576 26.1148 7.13411 18.2646 7.13411Z\"/>\n-      <path transform=\"translate(1639.73 2285.48)\" d=\"M 18.2733 5.93931C 26.1235 5.93931 32.9793 8.81583 36.538 13.0734C 35.2126 9.25303 32.7424 5.94262 29.4694 3.6004C 26.1963 1.25818 22.2823 0 18.269 0C 14.2557 0 10.3417 1.25818 7.0686 3.6004C 3.79556 5.94262 1.32539 9.25303 0 13.0734C 3.56745 8.82463 10.4232 5.93931 18.2733 5.93931Z\"/>\n-    </g>\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-      <path transform=\"translate(1669.3 2281.31)\" d=\"M 5.89353 2.844C 5.91889 3.43165 5.77085 4.01367 5.46815 4.51645C 5.16545 5.01922 4.72168 5.42015 4.19299 5.66851C 3.6643 5.91688 3.07444 6.00151 2.49805 5.91171C 1.92166 5.8219 1.38463 5.5617 0.954898 5.16401C 0.52517 4.76633 0.222056 4.24903 0.0839037 3.67757C -0.0542483 3.10611 -0.02123 2.50617 0.178781 1.95364C 0.378793 1.4011 0.736809 0.920817 1.20754 0.573538C 1.67826 0.226259 2.24055 0.0275919 2.82326 0.00267229C 3.60389 -0.0307115 4.36573 0.249789 4.94142 0.782551C 5.51711 1.31531 5.85956 2.05676 5.89353 2.844Z\"/>\n-      <path transform=\"translate(1639.8 2323.81)\" d=\"M 7.42789 3.58338C 7.46008 4.3243 7.27355 5.05819 6.89193 5.69213C 6.51031 6.32607 5.95075 6.83156 5.28411 7.1446C 4.61747 7.45763 3.87371 7.56414 3.14702 7.45063C 2.42032 7.33712 1.74336 7.0087 1.20184 6.50695C 0.660328 6.0052 0.27861 5.35268 0.105017 4.63202C -0.0685757 3.91135 -0.0262361 3.15494 0.226675 2.45856C 0.479587 1.76217 0.931697 1.15713 1.52576 0.720033C 2.11983 0.282935 2.82914 0.0334395 3.56389 0.00313344C 4.54667 -0.0374033 5.50529 0.316706 6.22961 0.987835C 6.95393 1.65896 7.38484 2.59235 7.42789 3.58338L 7.42789 3.58338Z\"/>\n-      <path transform=\"translate(1638.36 2286.06)\" d=\"M 2.27471 4.39629C 1.84363 4.41508 1.41671 4.30445 1.04799 4.07843C 0.679268 3.8524 0.385328 3.52114 0.203371 3.12656C 0.0214136 2.73198 -0.0403798 2.29183 0.0258116 1.86181C 0.0920031 1.4318 0.283204 1.03126 0.575213 0.710883C 0.867222 0.39051 1.24691 0.164708 1.66622 0.0620592C 2.08553 -0.0405897 2.52561 -0.0154714 2.93076 0.134235C 3.33591 0.283941 3.68792 0.551505 3.94222 0.90306C 4.19652 1.25462 4.34169 1.67436 4.35935 2.10916C 4.38299 2.69107 4.17678 3.25869 3.78597 3.68746C 3.39516 4.11624 2.85166 4.37116 2.27471 4.39629L 2.27471 4.39629Z\"/>\n-    </g>\n-  </g>>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"39\" height=\"51\" viewBox=\"0 0 39 51\">\n+  <path fill=\"#F37726\" d=\"M20.005 38.114c-7.85 0-14.706-2.876-18.265-7.134a19.5 19.5 0 0 0 7.069 9.473 19.24 19.24 0 0 0 11.2 3.6c4.013 0 7.927-1.258 11.2-3.6a19.5 19.5 0 0 0 7.069-9.473c-3.567 4.258-10.423 7.134-18.273 7.134m-.002-27.694c7.85 0 14.706 2.876 18.265 7.133a19.5 19.5 0 0 0-7.069-9.473A19.24 19.24 0 0 0 20 4.48a19.24 19.24 0 0 0-11.2 3.6 19.5 19.5 0 0 0-7.069 9.473c3.567-4.248 10.423-7.134 18.273-7.134\" class=\"jp-jupyter-icon-color\"/>\n+  <path fill=\"#616161\" d=\"M37.194 3.154a3 3 0 0 1-.426 1.672 2.96 2.96 0 0 1-1.275 1.153 2.93 2.93 0 0 1-3.238-.505 3 3 0 0 1-.776-3.21c.2-.553.558-1.033 1.029-1.38a2.93 2.93 0 0 1 3.733.209c.576.532.919 1.274.953 2.061M9.228 46.393a3.77 3.77 0 0 1-.536 2.11 3.73 3.73 0 0 1-1.608 1.452 3.69 3.69 0 0 1-4.082-.638 3.75 3.75 0 0 1-1.097-1.875 3.8 3.8 0 0 1 .122-2.173 3.74 3.74 0 0 1 1.299-1.739 3.696 3.696 0 0 1 4.704.268 3.76 3.76 0 0 1 1.198 2.595M2.635 9.456a2.17 2.17 0 0 1-1.227-.318 2.2 2.2 0 0 1-.845-.951A2.22 2.22 0 0 1 .935 5.77a2.16 2.16 0 0 1 2.356-.577c.405.15.757.418 1.011.77a2.21 2.21 0 0 1-.156 2.783 2.17 2.17 0 0 1-1.511.71\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/jupyter/jupyterlab-wordmark.svg b/packages/ui-components/style/icons/jupyter/jupyterlab-wordmark.svg\nindex 71dbb3e603ff..ca5c1f19ff7a 100644\n--- a/packages/ui-components/style/icons/jupyter/jupyterlab-wordmark.svg\n+++ b/packages/ui-components/style/icons/jupyter/jupyterlab-wordmark.svg\n@@ -1,43 +1,4 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" viewBox=\"0 0 1860.8 475\">\n-  <g class=\"jp-icon2\" fill=\"#4E4E4E\" transform=\"translate(480.136401, 64.271493)\">\n-    <g transform=\"translate(0.000000, 58.875566)\">\n-      <g transform=\"translate(0.087603, 0.140294)\">\n-        <path d=\"M-426.9,169.8c0,48.7-3.7,64.7-13.6,76.4c-10.8,10-25,15.5-39.7,15.5l3.7,29 c22.8,0.3,44.8-7.9,61.9-23.1c17.8-18.5,24-44.1,24-83.3V0H-427v170.1L-426.9,169.8L-426.9,169.8z\"/>\n-      </g>\n-    </g>\n-    <g transform=\"translate(155.045296, 56.837104)\">\n-      <g transform=\"translate(1.562453, 1.799842)\">\n-        <path d=\"M-312,148c0,21,0,39.5,1.7,55.4h-31.8l-2.1-33.3h-0.8c-6.7,11.6-16.4,21.3-28,27.9 c-11.6,6.6-24.8,10-38.2,9.8c-31.4,0-69-17.7-69-89V0h36.4v112.7c0,38.7,11.6,64.7,44.6,64.7c10.3-0.2,20.4-3.5,28.9-9.4 c8.5-5.9,15.1-14.3,18.9-23.9c2.2-6.1,3.3-12.5,3.3-18.9V0.2h36.4V148H-312L-312,148z\"/>\n-      </g>\n-    </g>\n-    <g transform=\"translate(390.013322, 53.479638)\">\n-      <g transform=\"translate(1.706458, 0.231425)\">\n-        <path d=\"M-478.6,71.4c0-26-0.8-47-1.7-66.7h32.7l1.7,34.8h0.8c7.1-12.5,17.5-22.8,30.1-29.7 c12.5-7,26.7-10.3,41-9.8c48.3,0,84.7,41.7,84.7,103.3c0,73.1-43.7,109.2-91,109.2c-12.1,0.5-24.2-2.2-35-7.8 c-10.8-5.6-19.9-13.9-26.6-24.2h-0.8V291h-36v-220L-478.6,71.4L-478.6,71.4z M-442.6,125.6c0.1,5.1,0.6,10.1,1.7,15.1 c3,12.3,9.9,23.3,19.8,31.1c9.9,7.8,22.1,12.1,34.7,12.1c38.5,0,60.7-31.9,60.7-78.5c0-40.7-21.1-75.6-59.5-75.6 c-12.9,0.4-25.3,5.1-35.3,13.4c-9.9,8.3-16.9,19.7-19.6,32.4c-1.5,4.9-2.3,10-2.5,15.1V125.6L-442.6,125.6L-442.6,125.6z\"/>\n-      </g>\n-    </g>\n-    <g transform=\"translate(606.740726, 56.837104)\">\n-      <g transform=\"translate(0.751226, 1.989299)\">\n-        <path d=\"M-440.8,0l43.7,120.1c4.5,13.4,9.5,29.4,12.8,41.7h0.8c3.7-12.2,7.9-27.7,12.8-42.4 l39.7-119.2h38.5L-346.9,145c-26,69.7-43.7,105.4-68.6,127.2c-12.5,11.7-27.9,20-44.6,23.9l-9.1-31.1 c11.7-3.9,22.5-10.1,31.8-18.1c13.2-11.1,23.7-25.2,30.6-41.2c1.5-2.8,2.5-5.7,2.9-8.8c-0.3-3.3-1.2-6.6-2.5-9.7L-480.2,0.1 h39.7L-440.8,0L-440.8,0z\"/>\n-      </g>\n-    </g>\n-    <g transform=\"translate(822.748104, 0.000000)\">\n-      <g transform=\"translate(1.464050, 0.378914)\">\n-        <path d=\"M-413.7,0v58.3h52v28.2h-52V196c0,25,7,39.5,27.3,39.5c7.1,0.1,14.2-0.7,21.1-2.5 l1.7,27.7c-10.3,3.7-21.3,5.4-32.2,5c-7.3,0.4-14.6-0.7-21.3-3.4c-6.8-2.7-12.9-6.8-17.9-12.1c-10.3-10.9-14.1-29-14.1-52.9 V86.5h-31V58.3h31V9.6L-413.7,0L-413.7,0z\"/>\n-      </g>\n-    </g>\n-    <g transform=\"translate(974.433286, 53.479638)\">\n-      <g transform=\"translate(0.990034, 0.610339)\">\n-        <path d=\"M-445.8,113c0.8,50,32.2,70.6,68.6,70.6c19,0.6,37.9-3,55.3-10.5l6.2,26.4 c-20.9,8.9-43.5,13.1-66.2,12.6c-61.5,0-98.3-41.2-98.3-102.5C-480.2,48.2-444.7,0-386.5,0c65.2,0,82.7,58.3,82.7,95.7 c-0.1,5.8-0.5,11.5-1.2,17.2h-140.6H-445.8L-445.8,113z M-339.2,86.6c0.4-23.5-9.5-60.1-50.4-60.1 c-36.8,0-52.8,34.4-55.7,60.1H-339.2L-339.2,86.6L-339.2,86.6z\"/>\n-      </g>\n-    </g>\n-    <g transform=\"translate(1201.961058, 53.479638)\">\n-      <g transform=\"translate(1.179640, 0.705068)\">\n-        <path d=\"M-478.6,68c0-23.9-0.4-44.5-1.7-63.4h31.8l1.2,39.9h1.7c9.1-27.3,31-44.5,55.3-44.5 c3.5-0.1,7,0.4,10.3,1.2v34.8c-4.1-0.9-8.2-1.3-12.4-1.2c-25.6,0-43.7,19.7-48.7,47.4c-1,5.7-1.6,11.5-1.7,17.2v108.3h-36V68 L-478.6,68z\"/>\n-      </g>\n-    </g>\n-  </g>\n-\n-  <g class=\"jp-jupyter-icon-color\" fill=\"#F37726\">\n-    <path d=\"M1352.3,326.2h37V28h-37V326.2z M1604.8,326.2c-2.5-13.9-3.4-31.1-3.4-48.7v-76 c0-40.7-15.1-83.1-77.3-83.1c-25.6,0-50,7.1-66.8,18.1l8.4,24.4c14.3-9.2,34-15.1,53-15.1c41.6,0,46.2,30.2,46.2,47v4.2 c-78.6-0.4-122.3,26.5-122.3,75.6c0,29.4,21,58.4,62.2,58.4c29,0,50.9-14.3,62.2-30.2h1.3l2.9,25.6H1604.8z M1565.7,257.7 c0,3.8-0.8,8-2.1,11.8c-5.9,17.2-22.7,34-49.2,34c-18.9,0-34.9-11.3-34.9-35.3c0-39.5,45.8-46.6,86.2-45.8V257.7z M1698.5,326.2 l1.7-33.6h1.3c15.1,26.9,38.7,38.2,68.1,38.2c45.4,0,91.2-36.1,91.2-108.8c0.4-61.7-35.3-103.7-85.7-103.7 c-32.8,0-56.3,14.7-69.3,37.4h-0.8V28h-36.6v245.7c0,18.1-0.8,38.6-1.7,52.5H1698.5z M1704.8,208.2c0-5.9,1.3-10.9,2.1-15.1 c7.6-28.1,31.1-45.4,56.3-45.4c39.5,0,60.5,34.9,60.5,75.6c0,46.6-23.1,78.1-61.8,78.1c-26.9,0-48.3-17.6-55.5-43.3 c-0.8-4.2-1.7-8.8-1.7-13.4V208.2z\"/>\n-  </g>\n+  <path fill=\"#4E4E4E\" d=\"M53.324 293.087c0 48.7-3.7 64.7-13.6 76.4-10.8 10-25 15.5-39.7 15.5l3.7 29c22.8.3 44.8-7.9 61.9-23.1 17.8-18.5 24-44.1 24-83.3v-184.3h-36.4v170.1zm271.42-22.179c0 21 0 39.5 1.7 55.4h-31.8l-2.1-33.3h-.8c-6.7 11.6-16.4 21.3-28 27.9s-24.8 10-38.2 9.8c-31.4 0-69-17.7-69-89v-118.8h36.4v112.7c0 38.7 11.6 64.7 44.6 64.7 10.3-.2 20.4-3.5 28.9-9.4s15.1-14.3 18.9-23.9c2.2-6.1 3.3-12.5 3.3-18.9v-125h36.4v147.8zm68.512-81.525c0-26-.8-47-1.7-66.7h32.7l1.7 34.8h.8c7.1-12.5 17.5-22.8 30.1-29.7 12.5-7 26.7-10.3 41-9.8 48.3 0 84.7 41.7 84.7 103.3 0 73.1-43.7 109.2-91 109.2-12.1.5-24.2-2.2-35-7.8s-19.9-13.9-26.6-24.2h-.8v110.5h-36v-220zm36 54.2c.1 5.1.6 10.1 1.7 15.1 3 12.3 9.9 23.3 19.8 31.1s22.1 12.1 34.7 12.1c38.5 0 60.7-31.9 60.7-78.5 0-40.7-21.1-75.6-59.5-75.6-12.9.4-25.3 5.1-35.3 13.4-9.9 8.3-16.9 19.7-19.6 32.4-1.5 4.9-2.3 10-2.5 15.1zm217.572-120.485 43.7 120.1c4.5 13.4 9.5 29.4 12.8 41.7h.8c3.7-12.2 7.9-27.7 12.8-42.4l39.7-119.2h38.5l-54.4 144.8c-26 69.7-43.7 105.4-68.6 127.2-12.5 11.7-27.9 20-44.6 23.9l-9.1-31.1c11.7-3.9 22.5-10.1 31.8-18.1 13.2-11.1 23.7-25.2 30.6-41.2 1.5-2.8 2.5-5.7 2.9-8.8-.3-3.3-1.2-6.6-2.5-9.7l-73.8-187.1h39.7zM890.649 64.65v58.3h52v28.2h-52v109.5c0 25 7 39.5 27.3 39.5 7.1.1 14.2-.7 21.1-2.5l1.7 27.7c-10.3 3.7-21.3 5.4-32.2 5-7.3.4-14.6-.7-21.3-3.4-6.8-2.7-12.9-6.8-17.9-12.1-10.3-10.9-14.1-29-14.1-52.9v-110.8h-31v-28.2h31v-48.7zm119.111 166.711c.8 50 32.2 70.6 68.6 70.6 19 .6 37.9-3 55.3-10.5l6.2 26.4c-20.9 8.9-43.5 13.1-66.2 12.6-61.5 0-98.3-41.2-98.3-102.5 0-61.4 35.5-109.6 93.7-109.6 65.2 0 82.7 58.3 82.7 95.7-.1 5.8-.5 11.5-1.2 17.2h-140.8zm106.6-26.4c.4-23.5-9.5-60.1-50.4-60.1-36.8 0-52.8 34.4-55.7 60.1zm88.317-18.505c0-23.9-.4-44.5-1.7-63.4h31.8l1.2 39.9h1.7c9.1-27.3 31-44.5 55.3-44.5 3.5-.1 7 .4 10.3 1.2v34.8c-4.1-.9-8.2-1.3-12.4-1.2-25.6 0-43.7 19.7-48.7 47.4-1 5.7-1.6 11.5-1.7 17.2v108.3h-36v-139.7z\" class=\"jp-icon2\"/>\n+  <path fill=\"#F37726\" d=\"M1352.3 326.2h37V28h-37zm252.5 0c-2.5-13.9-3.4-31.1-3.4-48.7v-76c0-40.7-15.1-83.1-77.3-83.1-25.6 0-50 7.1-66.8 18.1l8.4 24.4c14.3-9.2 34-15.1 53-15.1 41.6 0 46.2 30.2 46.2 47v4.2c-78.6-.4-122.3 26.5-122.3 75.6 0 29.4 21 58.4 62.2 58.4 29 0 50.9-14.3 62.2-30.2h1.3l2.9 25.6h33.6zm-39.1-68.5c0 3.8-.8 8-2.1 11.8-5.9 17.2-22.7 34-49.2 34-18.9 0-34.9-11.3-34.9-35.3 0-39.5 45.8-46.6 86.2-45.8zm132.8 68.5 1.7-33.6h1.3c15.1 26.9 38.7 38.2 68.1 38.2 45.4 0 91.2-36.1 91.2-108.8.4-61.7-35.3-103.7-85.7-103.7-32.8 0-56.3 14.7-69.3 37.4h-.8V28h-36.6v245.7c0 18.1-.8 38.6-1.7 52.5zm6.3-118c0-5.9 1.3-10.9 2.1-15.1 7.6-28.1 31.1-45.4 56.3-45.4 39.5 0 60.5 34.9 60.5 75.6 0 46.6-23.1 78.1-61.8 78.1-26.9 0-48.3-17.6-55.5-43.3-.8-4.2-1.7-8.8-1.7-13.4v-36.5z\" class=\"jp-jupyter-icon-color\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/licenses/copyright.svg b/packages/ui-components/style/icons/licenses/copyright.svg\nindex 9014da9b5817..f2ca8e3964c1 100644\n--- a/packages/ui-components/style/icons/licenses/copyright.svg\n+++ b/packages/ui-components/style/icons/licenses/copyright.svg\n@@ -1,5 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" enable-background=\"new 0 0 24 24\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M11.88,9.14c1.28,0.06,1.61,1.15,1.63,1.66h1.79c-0.08-1.98-1.49-3.19-3.45-3.19C9.64,7.61,8,9,8,12.14 c0,1.94,0.93,4.24,3.84,4.24c2.22,0,3.41-1.65,3.44-2.95h-1.79c-0.03,0.59-0.45,1.38-1.63,1.44C10.55,14.83,10,13.81,10,12.14 C10,9.25,11.28,9.16,11.88,9.14z M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8 s3.59-8,8-8s8,3.59,8,8S16.41,20,12,20z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M11.88 9.14c1.28.06 1.61 1.15 1.63 1.66h1.79c-.08-1.98-1.49-3.19-3.45-3.19C9.64 7.61 8 9 8 12.14c0 1.94.93 4.24 3.84 4.24 2.22 0 3.41-1.65 3.44-2.95h-1.79c-.03.59-.45 1.38-1.63 1.44-1.31-.04-1.86-1.06-1.86-2.73 0-2.89 1.28-2.98 1.88-3M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/lock.svg b/packages/ui-components/style/icons/lock.svg\nindex 5f8336cf66fd..f872fc564060 100644\n--- a/packages/ui-components/style/icons/lock.svg\n+++ b/packages/ui-components/style/icons/lock.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 23\">\n-  <path class=\"jp-icon4\" fill=\"#333333\" d=\"M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z\" />\n+  <path fill=\"#333\" d=\"M12 17a2 2 0 0 0 2-2 2 2 0 0 0-2-2 2 2 0 0 0-2 2 2 2 0 0 0 2 2m6-9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h1V6a5 5 0 0 1 5-5 5 5 0 0 1 5 5v2zm-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3\" class=\"jp-icon4\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/lsp/code-check.svg b/packages/ui-components/style/icons/lsp/code-check.svg\nindex c469d86d73e8..2d7bcb45f28a 100644\n--- a/packages/ui-components/style/icons/lsp/code-check.svg\n+++ b/packages/ui-components/style/icons/lsp/code-check.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\" shape-rendering=\"geometricPrecision\">\n-    <path d=\"M6.59,3.41L2,8L6.59,12.6L8,11.18L4.82,8L8,4.82L6.59,3.41M12.41,3.41L11,4.82L14.18,8L11,11.18L12.41,12.6L17,8L12.41,3.41M21.59,11.59L13.5,19.68L9.83,16L8.42,17.41L13.5,22.5L23,13L21.59,11.59Z\" />\n-  </g>\n+  <path fill=\"#616161\" d=\"M6.59 3.41 2 8l4.59 4.6L8 11.18 4.82 8 8 4.82zm5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8zm9.18 8.18-8.09 8.09L9.83 16l-1.41 1.41 5.08 5.09L23 13z\" class=\"jp-icon3 jp-icon-selectable\" shape-rendering=\"geometricPrecision\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/output/collapse.svg b/packages/ui-components/style/icons/output/collapse.svg\nindex 400d62fea838..4ad1d21f9e8a 100644\n--- a/packages/ui-components/style/icons/output/collapse.svg\n+++ b/packages/ui-components/style/icons/output/collapse.svg\n@@ -1,7 +1,7 @@\n-<svg width=\"16\" viewBox=\"0 0 8.5 10.5\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon-output\" fill=\"#BDBDBD\">\n-    <path d=\"M.019 0h8.458v1.064H.019zM0 9.52h8.491v1.059H0zM4.776 2.912H3.72V1.323h1.056z\" />\n-    <path d=\"M4.244 5.243l-1.06-1.167-1.06-1.167h4.24l-1.06 1.167zM4.772 9.257H3.716V7.665h1.056z\" />\n-    <path d=\"M4.242 5.332L5.302 6.5l1.06 1.167h-4.24l1.06-1.167z\" />\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 8.5 10.5\">\n+  <g fill=\"#BDBDBD\" class=\"jp-icon-output\">\n+    <path d=\"M.019 0h8.458v1.064H.019zM0 9.52h8.491v1.059H0zm4.776-6.608H3.72V1.323h1.056z\"/>\n+    <path d=\"m4.244 5.243-1.06-1.167-1.06-1.167h4.24l-1.06 1.167zm.528 4.014H3.716V7.665h1.056z\"/>\n+    <path d=\"M4.242 5.332 5.302 6.5l1.06 1.167h-4.24L3.182 6.5z\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/output/expand.svg b/packages/ui-components/style/icons/output/expand.svg\nindex dc0bf99e095f..3a5c889ecaa6 100644\n--- a/packages/ui-components/style/icons/output/expand.svg\n+++ b/packages/ui-components/style/icons/output/expand.svg\n@@ -1,7 +1,7 @@\n-<svg width=\"16\" viewBox=\"0 0 8.5 10.5\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon-output\" fill=\"#BDBDBD\">\n-    <path d=\"M.019 0h8.458v1.064H.019zM0 9.521h8.491v1.059H0zM3.712 3.699h1.056v1.589H3.712z\" />\n-    <path d=\"M4.244 1.368l1.06 1.167 1.06 1.167h-4.24l1.06-1.167zM3.712 5.288h1.056V6.88H3.712z\" />\n-    <path d=\"M4.242 9.213l-1.06-1.167-1.06-1.167h4.24l-1.06 1.167z\" />\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 8.5 10.5\">\n+  <g fill=\"#BDBDBD\" class=\"jp-icon-output\">\n+    <path d=\"M.019 0h8.458v1.064H.019zM0 9.521h8.491v1.059H0zm3.712-5.822h1.056v1.589H3.712z\"/>\n+    <path d=\"m4.244 1.368 1.06 1.167 1.06 1.167h-4.24l1.06-1.167zm-.532 3.92h1.056V6.88H3.712z\"/>\n+    <path d=\"m4.242 9.213-1.06-1.167-1.06-1.167h4.24l-1.06 1.167z\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/search/case-sensitive.svg b/packages/ui-components/style/icons/search/case-sensitive.svg\nindex 6047c859456b..6f5a6aadfa59 100644\n--- a/packages/ui-components/style/icons/search/case-sensitive.svg\n+++ b/packages/ui-components/style/icons/search/case-sensitive.svg\n@@ -1,9 +1,4 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 20 20\">\n-  <g class=\"jp-icon2\" fill=\"#414141\">\n-    <rect x=\"2\" y=\"2\" width=\"16\" height=\"16\"/>\n-  </g>\n-  <g class=\"jp-icon-accent2\" fill=\"#FFF\">\n-    <path d=\"M7.6,8h0.9l3.5,8h-1.1L10,14H6l-0.9,2H4L7.6,8z M8,9.1L6.4,13h3.2L8,9.1z\"/>\n-    <path d=\"M16.6,9.8c-0.2,0.1-0.4,0.1-0.7,0.1c-0.2,0-0.4-0.1-0.6-0.2c-0.1-0.1-0.2-0.4-0.2-0.7 c-0.3,0.3-0.6,0.5-0.9,0.7c-0.3,0.1-0.7,0.2-1.1,0.2c-0.3,0-0.5,0-0.7-0.1c-0.2-0.1-0.4-0.2-0.6-0.3c-0.2-0.1-0.3-0.3-0.4-0.5 c-0.1-0.2-0.1-0.4-0.1-0.7c0-0.3,0.1-0.6,0.2-0.8c0.1-0.2,0.3-0.4,0.4-0.5C12,7,12.2,6.9,12.5,6.8c0.2-0.1,0.5-0.1,0.7-0.2 c0.3-0.1,0.5-0.1,0.7-0.1c0.2,0,0.4-0.1,0.6-0.1c0.2,0,0.3-0.1,0.4-0.2c0.1-0.1,0.2-0.2,0.2-0.4c0-1-1.1-1-1.3-1 c-0.4,0-1.4,0-1.4,1.2h-0.9c0-0.4,0.1-0.7,0.2-1c0.1-0.2,0.3-0.4,0.5-0.6c0.2-0.2,0.5-0.3,0.8-0.3C13.3,4,13.6,4,13.9,4 c0.3,0,0.5,0,0.8,0.1c0.3,0,0.5,0.1,0.7,0.2c0.2,0.1,0.4,0.3,0.5,0.5C16,5,16,5.2,16,5.6v2.9c0,0.2,0,0.4,0,0.5 c0,0.1,0.1,0.2,0.3,0.2c0.1,0,0.2,0,0.3,0V9.8z M15.2,6.9c-1.2,0.6-3.1,0.2-3.1,1.4c0,1.4,3.1,1,3.1-0.5V6.9z\"/>\n-  </g>\n+  <path fill=\"#414141\" d=\"M2 2h16v16H2z\" class=\"jp-icon2\"/>\n+  <path fill=\"#FFF\" d=\"M7.6 8h.9l3.5 8h-1.1l-.9-2H6l-.9 2H4zM8 9.1 6.4 13h3.2zm8.6.7c-.2.1-.4.1-.7.1-.2 0-.4-.1-.6-.2-.1-.1-.2-.4-.2-.7-.3.3-.6.5-.9.7-.3.1-.7.2-1.1.2-.3 0-.5 0-.7-.1l-.6-.3c-.2-.1-.3-.3-.4-.5s-.1-.4-.1-.7.1-.6.2-.8.3-.4.4-.5c.1 0 .3-.1.6-.2.2-.1.5-.1.7-.2.3-.1.5-.1.7-.1s.4-.1.6-.1.3-.1.4-.2.2-.2.2-.4c0-1-1.1-1-1.3-1-.4 0-1.4 0-1.4 1.2h-.9c0-.4.1-.7.2-1 .1-.2.3-.4.5-.6s.5-.3.8-.3c.3-.1.6-.1.9-.1s.5 0 .8.1c.3 0 .5.1.7.2s.4.3.5.5.1.4.1.8V9c0 .1.1.2.3.2h.3zm-1.4-2.9c-1.2.6-3.1.2-3.1 1.4 0 1.4 3.1 1 3.1-.5z\" class=\"jp-icon-accent2\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/search/filter-dot.svg b/packages/ui-components/style/icons/search/filter-dot.svg\nindex 4ae72dd6cd7d..7b08fff34fd0 100644\n--- a/packages/ui-components/style/icons/search/filter-dot.svg\n+++ b/packages/ui-components/style/icons/search/filter-dot.svg\n@@ -1,8 +1,4 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#FFF\">\n-    <path d=\"M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H9.97L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L14.03,12H14Z\" />\n-  </g>\n-  <g class=\"jp-icon-dot\" fill=\"#FFF\">\n-    <circle cx=\"18\" cy=\"17\" r=\"3\"></circle>\n-  </g>\n+  <path fill=\"#FFF\" d=\"M14 12v7.88c.04.3-.06.62-.29.83a.996.996 0 0 1-1.41 0l-2.01-2.01a.99.99 0 0 1-.29-.83V12h-.03L4.21 4.62a1 1 0 0 1 .17-1.4c.19-.14.4-.22.62-.22h14c.22 0 .43.08.62.22a1 1 0 0 1 .17 1.4L14.03 12z\" class=\"jp-icon3\"/>\n+  <circle cx=\"18\" cy=\"17\" r=\"3\" fill=\"#FFF\" class=\"jp-icon-dot\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/search/filter.svg b/packages/ui-components/style/icons/search/filter.svg\nindex 92166e025ab5..2e4ea915c7bb 100644\n--- a/packages/ui-components/style/icons/search/filter.svg\n+++ b/packages/ui-components/style/icons/search/filter.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#FFF\">\n-    <path d=\"M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H9.97L4.21,4.62C3.87,4.19 3.95,3.56 4.38,3.22C4.57,3.08 4.78,3 5,3V3H19V3C19.22,3 19.43,3.08 19.62,3.22C20.05,3.56 20.13,4.19 19.79,4.62L14.03,12H14Z\" />\n-  </g>\n+  <path fill=\"#FFF\" d=\"M14 12v7.88c.04.3-.06.62-.29.83a.996.996 0 0 1-1.41 0l-2.01-2.01a.99.99 0 0 1-.29-.83V12h-.03L4.21 4.62a1 1 0 0 1 .17-1.4c.19-.14.4-.22.62-.22h14c.22 0 .43.08.62.22a1 1 0 0 1 .17 1.4L14.03 12z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/search/regex.svg b/packages/ui-components/style/icons/search/regex.svg\nindex 92725b80d70e..76d533682b1f 100644\n--- a/packages/ui-components/style/icons/search/regex.svg\n+++ b/packages/ui-components/style/icons/search/regex.svg\n@@ -1,12 +1,9 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 20 20\">\n-  <g class=\"jp-icon2\" fill=\"#414141\">\n-    <rect x=\"2\" y=\"2\" width=\"16\" height=\"16\"/>\n-  </g>\n-\n-  <g class=\"jp-icon-accent2\" fill=\"#FFF\">\n-    <circle class=\"st2\" cx=\"5.5\" cy=\"14.5\" r=\"1.5\"/>\n-    <rect x=\"12\" y=\"4\" class=\"st2\" width=\"1\" height=\"8\"/>\n-    <rect x=\"8.5\" y=\"7.5\" transform=\"matrix(0.866 -0.5 0.5 0.866 -2.3255 7.3219)\" class=\"st2\" width=\"8\" height=\"1\"/>\n-    <rect x=\"12\" y=\"4\" transform=\"matrix(0.5 -0.866 0.866 0.5 -0.6779 14.8252)\" class=\"st2\" width=\"1\" height=\"8\"/>\n+  <path fill=\"#414141\" d=\"M2 2h16v16H2z\" class=\"jp-icon2\"/>\n+  <g fill=\"#FFF\" class=\"jp-icon-accent2\">\n+    <circle cx=\"5.5\" cy=\"14.5\" r=\"1.5\"/>\n+    <path d=\"M12 4h1v8h-1z\"/>\n+    <path d=\"m8.786 9.567 6.928-4 .5.866-6.928 4z\"/>\n+    <path d=\"m8.786 6.433.5-.866 6.928 4-.5.866z\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/search/word.svg b/packages/ui-components/style/icons/search/word.svg\nindex 8723eff9b7fb..6f8c01246a58 100644\n--- a/packages/ui-components/style/icons/search/word.svg\n+++ b/packages/ui-components/style/icons/search/word.svg\n@@ -1,10 +1,4 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 20 20\">\n- <g class=\"jp-icon2\" fill=\"#414141\">\n-  <rect x=\"2\" y=\"2\" width=\"16\" height=\"16\"/>\n- </g>\n- <g class=\"jp-icon-accent2\" transform=\"translate(.43 .0401)\" fill=\"#fff\">\n-  <path d=\"m4.14 8.76q0.0682-1.89 2.42-1.89 1.16 0 1.68 0.42 0.567 0.41 0.567 1.16v3.47q0 0.462 0.514 0.462 0.103 0 0.2-0.0231v0.714q-0.399 0.103-0.651 0.103-0.452 0-0.693-0.22-0.231-0.2-0.284-0.662-0.956 0.872-2 0.872-0.903 0-1.47-0.472-0.525-0.472-0.525-1.26 0-0.262 0.0452-0.472 0.0567-0.22 0.116-0.378 0.0682-0.168 0.231-0.304 0.158-0.147 0.262-0.242 0.116-0.0914 0.368-0.168 0.262-0.0914 0.399-0.126 0.136-0.0452 0.472-0.103 0.336-0.0578 0.504-0.0798 0.158-0.0231 0.567-0.0798 0.556-0.0682 0.777-0.221 0.22-0.152 0.22-0.441v-0.252q0-0.43-0.357-0.662-0.336-0.231-0.976-0.231-0.662 0-0.998 0.262-0.336 0.252-0.399 0.798zm1.89 3.68q0.788 0 1.26-0.41 0.504-0.42 0.504-0.903v-1.05q-0.284 0.136-0.861 0.231-0.567 0.0914-0.987 0.158-0.42 0.0682-0.766 0.326-0.336 0.252-0.336 0.704t0.304 0.704 0.861 0.252z\" stroke-width=\"1.05\"/>\n-  <path d=\"m10 4.56h0.945v3.15q0.651-0.976 1.89-0.976 1.16 0 1.89 0.84 0.682 0.84 0.682 2.31 0 1.47-0.704 2.42-0.704 0.882-1.89 0.882-1.26 0-1.89-1.02v0.766h-0.85zm2.62 3.04q-0.746 0-1.16 0.64-0.452 0.63-0.452 1.68 0 1.05 0.452 1.68t1.16 0.63q0.777 0 1.26-0.63 0.494-0.64 0.494-1.68 0-1.05-0.472-1.68-0.462-0.64-1.26-0.64z\" stroke-width=\"1.05\"/>\n-  <path d=\"m2.73 15.8 13.6 0.0081c0.0069 0 0-2.6 0-2.6 0-0.0078-1.15 0-1.15 0-0.0069 0-0.0083 1.5-0.0083 1.5-2e-3 -0.0014-11.3-0.0014-11.3-0.0014l-0.00592-1.5c0-0.0078-1.17 0.0013-1.17 0.0013z\" stroke-width=\".975\"/>\n- </g>\n+  <path fill=\"#414141\" d=\"M2 2h16v16H2z\" class=\"jp-icon2\"/>\n+  <path fill=\"#fff\" d=\"M4.57 8.8q.068-1.89 2.42-1.89 1.16 0 1.68.42.567.41.567 1.16v3.47q0 .462.514.462.103 0 .2-.023v.714q-.399.103-.651.103-.452 0-.693-.22-.231-.2-.284-.662-.956.872-2 .872-.903 0-1.47-.472-.525-.472-.525-1.26 0-.262.045-.472.057-.22.116-.378.068-.168.231-.304l.262-.242q.116-.091.368-.168.262-.091.4-.126.135-.045.471-.103t.504-.08l.567-.08q.556-.068.777-.22.22-.153.22-.442v-.252q0-.43-.357-.662-.336-.23-.976-.23-.662 0-.998.261-.336.252-.399.798zm1.89 3.68q.788 0 1.26-.41.504-.42.504-.903v-1.05q-.284.136-.861.231l-.987.158q-.42.068-.766.326-.336.252-.336.704t.304.704.861.252zm3.97-7.88h.945v3.15q.651-.976 1.89-.976 1.16 0 1.89.84.682.84.682 2.31t-.704 2.42q-.704.882-1.89.882-1.26 0-1.89-1.02v.766h-.85zm2.62 3.04q-.746 0-1.16.64-.452.63-.452 1.68t.452 1.68 1.16.63q.777 0 1.26-.63.494-.64.494-1.68 0-1.05-.472-1.68-.462-.64-1.26-.64zm-9.89 8.2 13.6.008c.007 0 0-2.6 0-2.6 0-.008-1.15 0-1.15 0-.007 0-.008 1.5-.008 1.5l-11.3-.001-.006-1.5c0-.008-1.17.001-1.17.001z\" class=\"jp-icon-accent2\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/build.svg b/packages/ui-components/style/icons/sidebar/build.svg\nindex 352f6ed83355..cf9151acea70 100644\n--- a/packages/ui-components/style/icons/sidebar/build.svg\n+++ b/packages/ui-components/style/icons/sidebar/build.svg\n@@ -1,6 +1,3 @@\n-<svg width=\"16\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M14.9 17.45C16.25 17.45 17.35 16.35 17.35 15C17.35 13.65 16.25 12.55 14.9 12.55C13.54 12.55 12.45 13.65 12.45 15C12.45 16.35 13.54 17.45 14.9 17.45ZM20.1 15.68L21.58 16.84C21.71 16.95 21.75 17.13 21.66 17.29L20.26 19.71C20.17 19.86 20 19.92 19.83 19.86L18.09 19.16C17.73 19.44 17.33 19.67 16.91 19.85L16.64 21.7C16.62 21.87 16.47 22 16.3 22H13.5C13.32 22 13.18 21.87 13.15 21.7L12.89 19.85C12.46 19.67 12.07 19.44 11.71 19.16L9.96002 19.86C9.81002 19.92 9.62002 19.86 9.54002 19.71L8.14002 17.29C8.05002 17.13 8.09002 16.95 8.22002 16.84L9.70002 15.68L9.65001 15L9.70002 14.31L8.22002 13.16C8.09002 13.05 8.05002 12.86 8.14002 12.71L9.54002 10.29C9.62002 10.13 9.81002 10.07 9.96002 10.13L11.71 10.84C12.07 10.56 12.46 10.32 12.89 10.15L13.15 8.28998C13.18 8.12998 13.32 7.99998 13.5 7.99998H16.3C16.47 7.99998 16.62 8.12998 16.64 8.28998L16.91 10.15C17.33 10.32 17.73 10.56 18.09 10.84L19.83 10.13C20 10.07 20.17 10.13 20.26 10.29L21.66 12.71C21.75 12.86 21.71 13.05 21.58 13.16L20.1 14.31L20.15 15L20.1 15.68Z\"/>\n-    <path d=\"M7.32966 7.44454C8.0831 7.00954 8.33932 6.05332 7.90432 5.29988C7.46932 4.54643 6.5081 4.28156 5.75466 4.71656C5.39176 4.92608 5.12695 5.27118 5.01849 5.67594C4.91004 6.08071 4.96682 6.51198 5.17634 6.87488C5.61134 7.62832 6.57622 7.87954 7.32966 7.44454ZM9.65718 4.79593L10.8672 4.95179C10.9628 4.97741 11.0402 5.07133 11.0382 5.18793L11.0388 6.98893C11.0455 7.10054 10.9616 7.19518 10.855 7.21054L9.66001 7.38083L9.23915 8.13188L9.66961 9.25745C9.70729 9.36271 9.66934 9.47699 9.57408 9.53199L8.01523 10.432C7.91131 10.492 7.79337 10.4677 7.72105 10.3824L6.98748 9.43188L6.10931 9.43083L5.34704 10.3905C5.28909 10.4702 5.17383 10.4905 5.07187 10.4339L3.51245 9.53293C3.41049 9.47633 3.37647 9.35741 3.41075 9.25679L3.86347 8.14093L3.61749 7.77488L3.42347 7.37883L2.23075 7.21297C2.12647 7.19235 2.04049 7.10342 2.04245 6.98682L2.04187 5.18582C2.04383 5.06922 2.11909 4.97958 2.21704 4.96922L3.42065 4.79393L3.86749 4.02788L3.41105 2.91731C3.37337 2.81204 3.41131 2.69776 3.51523 2.63776L5.07408 1.73776C5.16934 1.68276 5.28729 1.70704 5.35961 1.79231L6.11915 2.72788L6.98001 2.73893L7.72496 1.78922C7.79156 1.70458 7.91548 1.67922 8.00879 1.74082L9.56821 2.64182C9.67017 2.69842 9.71285 2.81234 9.68723 2.90797L9.21718 4.03383L9.46316 4.39988L9.65718 4.79593Z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M14.9 17.45c1.35 0 2.45-1.1 2.45-2.45s-1.1-2.45-2.45-2.45c-1.36 0-2.45 1.1-2.45 2.45s1.09 2.45 2.45 2.45m5.2-1.77 1.48 1.16c.13.11.17.29.08.45l-1.4 2.42a.35.35 0 0 1-.43.15l-1.74-.7c-.36.28-.76.51-1.18.69l-.27 1.85c-.02.17-.17.3-.34.3h-2.8c-.18 0-.32-.13-.35-.3l-.26-1.85c-.43-.18-.82-.41-1.18-.69l-1.75.7c-.15.06-.34 0-.42-.15l-1.4-2.42a.35.35 0 0 1 .08-.45l1.48-1.16-.05-.68.05-.69-1.48-1.15a.35.35 0 0 1-.08-.45l1.4-2.42c.08-.16.27-.22.42-.16l1.75.71c.36-.28.75-.52 1.18-.69l.26-1.86c.03-.16.17-.29.35-.29h2.8c.17 0 .32.13.34.29l.27 1.86c.42.17.82.41 1.18.69l1.74-.71c.17-.06.34 0 .43.16l1.4 2.42c.09.15.05.34-.08.45l-1.48 1.15.05.69zM7.33 7.445A1.566 1.566 0 0 0 7.904 5.3a1.575 1.575 0 1 0-.574 2.145m2.327-2.65 1.21.157c.096.025.173.12.171.236v1.8a.214.214 0 0 1-.183.223l-1.195.17-.42.75.43 1.126c.037.106 0 .22-.096.275l-1.559.9a.23.23 0 0 1-.294-.05l-.734-.95-.878-.001-.762.96c-.058.08-.173.1-.275.043l-1.56-.901a.23.23 0 0 1-.101-.276l.452-1.116-.246-.366-.194-.396-1.192-.166a.23.23 0 0 1-.189-.226V5.186c.002-.117.077-.206.175-.217l1.204-.175.446-.766-.456-1.11a.23.23 0 0 1 .104-.28l1.56-.9a.225.225 0 0 1 .285.054l.76.936.86.01.745-.949a.214.214 0 0 1 .284-.048l1.56.9a.24.24 0 0 1 .118.267l-.47 1.126.246.366z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/extension.svg b/packages/ui-components/style/icons/sidebar/extension.svg\nindex 2e10e7264ead..6e9ca5fdc50b 100644\n--- a/packages/ui-components/style/icons/sidebar/extension.svg\n+++ b/packages/ui-components/style/icons/sidebar/extension.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5a2.5 2.5 0 0 0-5 0V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5a2.5 2.5 0 0 0 0-5\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/palette.svg b/packages/ui-components/style/icons/sidebar/palette.svg\nindex 1756b78e82e9..3a6c1d30c80c 100644\n--- a/packages/ui-components/style/icons/sidebar/palette.svg\n+++ b/packages/ui-components/style/icons/sidebar/palette.svg\n@@ -1,6 +1,6 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M18 13V20H4V6H9.02C9.07 5.29 9.24 4.62 9.5 4H4C2.9 4 2 4.9 2 6V20C2 21.1 2.9 22 4 22H18C19.1 22 20 21.1 20 20V15L18 13ZM19.3 8.89C19.74 8.19 20 7.38 20 6.5C20 4.01 17.99 2 15.5 2C13.01 2 11 4.01 11 6.5C11 8.99 13.01 11 15.49 11C16.37 11 17.19 10.74 17.88 10.3L21 13.42L22.42 12L19.3 8.89ZM15.5 9C14.12 9 13 7.88 13 6.5C13 5.12 14.12 4 15.5 4C16.88 4 18 5.12 18 6.5C18 7.88 16.88 9 15.5 9Z\"/>\n-    <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4 6H9.01894C9.00639 6.16502 9 6.33176 9 6.5C9 8.81577 10.211 10.8487 12.0343 12H9V14H16V12.9811C16.5703 12.9377 17.12 12.8207 17.6396 12.6396L18 13V20H4V6ZM8 8H6V10H8V8ZM6 12H8V14H6V12ZM8 16H6V18H8V16ZM9 16H16V18H9V16Z\"/>\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n+    <path d=\"M18 13v7H4V6h5.02c.05-.71.22-1.38.48-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-5zm1.3-4.11c.44-.7.7-1.51.7-2.39C20 4.01 17.99 2 15.5 2S11 4.01 11 6.5s2.01 4.5 4.49 4.5c.88 0 1.7-.26 2.39-.7L21 13.42 22.42 12zM15.5 9a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5\"/>\n+    <path fill-rule=\"evenodd\" d=\"M4 6h5.019a6.5 6.5 0 0 0 3.015 6H9v2h7v-1.019c.57-.043 1.12-.16 1.64-.341L18 13v7H4zm4 2H6v2h2zm-2 4h2v2H6zm2 4H6v2h2zm1 0h7v2H9z\" clip-rule=\"evenodd\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/running.svg b/packages/ui-components/style/icons/sidebar/running.svg\nindex 8d871ba1417f..356283d0d8e2 100644\n--- a/packages/ui-components/style/icons/sidebar/running.svg\n+++ b/packages/ui-components/style/icons/sidebar/running.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 512 512\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm96 328c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h160c8.8 0 16 7.2 16 16v160z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8m96 328c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h160c8.8 0 16 7.2 16 16z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/share.svg b/packages/ui-components/style/icons/sidebar/share.svg\nindex 1973931b20f1..ce0d36bbac93 100644\n--- a/packages/ui-components/style/icons/sidebar/share.svg\n+++ b/packages/ui-components/style/icons/sidebar/share.svg\n@@ -1,5 +1,3 @@\n-<svg width=\"16\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M 18 2 C 16.35499 2 15 3.3549904 15 5 C 15 5.1909529 15.021791 5.3771224 15.056641 5.5585938 L 7.921875 9.7207031 C 7.3985399 9.2778539 6.7320771 9 6 9 C 4.3549904 9 3 10.35499 3 12 C 3 13.64501 4.3549904 15 6 15 C 6.7320771 15 7.3985399 14.722146 7.921875 14.279297 L 15.056641 18.439453 C 15.021555 18.621514 15 18.808386 15 19 C 15 20.64501 16.35499 22 18 22 C 19.64501 22 21 20.64501 21 19 C 21 17.35499 19.64501 16 18 16 C 17.26748 16 16.601593 16.279328 16.078125 16.722656 L 8.9433594 12.558594 C 8.9782095 12.377122 9 12.190953 9 12 C 9 11.809047 8.9782095 11.622878 8.9433594 11.441406 L 16.078125 7.2792969 C 16.60146 7.7221461 17.267923 8 18 8 C 19.64501 8 21 6.6450096 21 5 C 21 3.3549904 19.64501 2 18 2 z M 18 4 C 18.564129 4 19 4.4358706 19 5 C 19 5.5641294 18.564129 6 18 6 C 17.435871 6 17 5.5641294 17 5 C 17 4.4358706 17.435871 4 18 4 z M 6 11 C 6.5641294 11 7 11.435871 7 12 C 7 12.564129 6.5641294 13 6 13 C 5.4358706 13 5 12.564129 5 12 C 5 11.435871 5.4358706 11 6 11 z M 18 18 C 18.564129 18 19 18.435871 19 19 C 19 19.564129 18.564129 20 18 20 C 17.435871 20 17 19.564129 17 19 C 17 18.435871 17.435871 18 18 18 z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M18 2c-1.645 0-3 1.355-3 3 0 .191.022.377.057.559L7.922 9.72A2.97 2.97 0 0 0 6 9c-1.645 0-3 1.355-3 3s1.355 3 3 3c.732 0 1.399-.278 1.922-.72l7.135 4.16A3 3 0 0 0 15 19c0 1.645 1.355 3 3 3s3-1.355 3-3-1.355-3-3-3a2.97 2.97 0 0 0-1.922.723l-7.135-4.164C8.978 12.377 9 12.19 9 12s-.022-.377-.057-.559l7.135-4.162C16.601 7.722 17.268 8 18 8c1.645 0 3-1.355 3-3s-1.355-3-3-3m0 2c.564 0 1 .436 1 1s-.436 1-1 1-1-.436-1-1 .436-1 1-1M6 11c.564 0 1 .436 1 1s-.436 1-1 1-1-.436-1-1 .436-1 1-1m12 7c.564 0 1 .436 1 1s-.436 1-1 1-1-.436-1-1 .436-1 1-1\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/tab.svg b/packages/ui-components/style/icons/sidebar/tab.svg\nindex a03560f9750b..a070e68bead1 100644\n--- a/packages/ui-components/style/icons/sidebar/tab.svg\n+++ b/packages/ui-components/style/icons/sidebar/tab.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h10v4h8v10z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H3V5h10v4h8z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/toc.svg b/packages/ui-components/style/icons/sidebar/toc.svg\nindex ecd38c0da9cc..7c713411a3e6 100644\n--- a/packages/ui-components/style/icons/sidebar/toc.svg\n+++ b/packages/ui-components/style/icons/sidebar/toc.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\">\n-    <path d=\"M7,5H21V7H7V5M7,13V11H21V13H7M4,4.5A1.5,1.5 0 0,1 5.5,6A1.5,1.5 0 0,1 4,7.5A1.5,1.5 0 0,1 2.5,6A1.5,1.5 0 0,1 4,4.5M4,10.5A1.5,1.5 0 0,1 5.5,12A1.5,1.5 0 0,1 4,13.5A1.5,1.5 0 0,1 2.5,12A1.5,1.5 0 0,1 4,10.5M7,19V17H21V19H7M4,16.5A1.5,1.5 0 0,1 5.5,18A1.5,1.5 0 0,1 4,19.5A1.5,1.5 0 0,1 2.5,18A1.5,1.5 0 0,1 4,16.5Z\" />\n-  </g>\n+  <path fill=\"#616161\" d=\"M7 5h14v2H7zm0 8v-2h14v2zM4 4.5A1.5 1.5 0 0 1 5.5 6 1.5 1.5 0 0 1 4 7.5 1.5 1.5 0 0 1 2.5 6 1.5 1.5 0 0 1 4 4.5m0 6A1.5 1.5 0 0 1 5.5 12 1.5 1.5 0 0 1 4 13.5 1.5 1.5 0 0 1 2.5 12 1.5 1.5 0 0 1 4 10.5M7 19v-2h14v2zm-3-2.5A1.5 1.5 0 0 1 5.5 18 1.5 1.5 0 0 1 4 19.5 1.5 1.5 0 0 1 2.5 18 1.5 1.5 0 0 1 4 16.5\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/user.svg b/packages/ui-components/style/icons/sidebar/user.svg\nindex c4451a70add3..3ed08f926669 100644\n--- a/packages/ui-components/style/icons/sidebar/user.svg\n+++ b/packages/ui-components/style/icons/sidebar/user.svg\n@@ -1,5 +1,3 @@\n-<svg width=\"16\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0m-4 7a7 7 0 0 0-7 7h14a7 7 0 0 0-7-7\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/sidebar/users.svg b/packages/ui-components/style/icons/sidebar/users.svg\nindex b5e1235b0191..29eed05199ae 100644\n--- a/packages/ui-components/style/icons/sidebar/users.svg\n+++ b/packages/ui-components/style/icons/sidebar/users.svg\n@@ -1,10 +1,6 @@\n-<svg width=\"24\" height=\"24\" version=\"1.1\" viewBox=\"0 0 36 24\" xmlns=\"http://www.w3.org/2000/svg\">\n- <g class=\"jp-icon3\" transform=\"matrix(1.7327 0 0 1.7327 -3.6282 .099577)\" fill=\"#616161\">\n-  <path transform=\"matrix(1.5,0,0,1.5,0,-6)\" d=\"m12.186 7.5098c-1.0535 0-1.9757 0.5665-2.4785 1.4102 0.75061 0.31277 1.3974 0.82648 1.873 1.4727h3.4863c0-1.592-1.2889-2.8828-2.8809-2.8828z\"/>\n-  <path d=\"m20.465 2.3895a2.1885 2.1885 0 0 1-2.1884 2.1885 2.1885 2.1885 0 0 1-2.1885-2.1885 2.1885 2.1885 0 0 1 2.1885-2.1885 2.1885 2.1885 0 0 1 2.1884 2.1885z\"/>\n-  <path transform=\"matrix(1.5,0,0,1.5,0,-6)\" d=\"m3.5898 8.4219c-1.1126 0-2.0137 0.90111-2.0137 2.0137h2.8145c0.26797-0.37309 0.5907-0.70435 0.95898-0.97852-0.34433-0.61688-1.0031-1.0352-1.7598-1.0352z\"/>\n-  <path d=\"m6.9154 4.623a1.5294 1.5294 0 0 1-1.5294 1.5294 1.5294 1.5294 0 0 1-1.5294-1.5294 1.5294 1.5294 0 0 1 1.5294-1.5294 1.5294 1.5294 0 0 1 1.5294 1.5294z\"/>\n-  <path d=\"m6.135 13.535c0-3.2392 2.6259-5.865 5.865-5.865 3.2392 0 5.865 2.6259 5.865 5.865z\"/>\n-  <circle cx=\"12\" cy=\"3.7685\" r=\"2.9685\"/>\n- </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" version=\"1.1\" viewBox=\"0 0 36 24\">\n+  <g fill=\"#616161\" class=\"jp-icon3\" transform=\"translate(-3.628 .1)scale(1.7327)\">\n+    <path d=\"M18.279 5.265c-1.58 0-2.964.85-3.718 2.115a6.7 6.7 0 0 1 2.81 2.21h5.23a4.32 4.32 0 0 0-4.322-4.325m2.186-2.875a2.19 2.19 0 0 1-2.188 2.188 2.19 2.19 0 0 1-2.189-2.189A2.19 2.19 0 0 1 18.277.201a2.19 2.19 0 0 1 2.188 2.188M5.385 6.633a3.02 3.02 0 0 0-3.02 3.02h4.22a6.7 6.7 0 0 1 1.44-1.467 3.02 3.02 0 0 0-2.64-1.553m1.53-2.01a1.53 1.53 0 0 1-1.529 1.53 1.53 1.53 0 0 1-1.53-1.53 1.53 1.53 0 0 1 1.53-1.53 1.53 1.53 0 0 1 1.53 1.53m-.781 8.912a5.865 5.865 0 0 1 11.73 0z\"/>\n+    <circle cx=\"12\" cy=\"3.768\" r=\"2.969\"/>\n+  </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/bell.svg b/packages/ui-components/style/icons/statusbar/bell.svg\nindex ac328725d887..554ac36b493c 100644\n--- a/packages/ui-components/style/icons/statusbar/bell.svg\n+++ b/packages/ui-components/style/icons/statusbar/bell.svg\n@@ -1,4 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\">\n-   <path class=\"jp-icon2 jp-icon-selectable\" fill=\"#333333\"\n-      d=\"m8 0.29c-1.4 0-2.7 0.73-3.6 1.8-1.2 1.5-1.4 3.4-1.5 5.2-0.18 2.2-0.44 4-2.3 5.3l0.28 1.3h5c0.026 0.66 0.32 1.1 0.71 1.5 0.84 0.61 2 0.61 2.8 0 0.52-0.4 0.6-1 0.71-1.5h5l0.28-1.3c-1.9-0.97-2.2-3.3-2.3-5.3-0.13-1.8-0.26-3.7-1.5-5.2-0.85-1-2.2-1.8-3.6-1.8zm0 1.4c0.88 0 1.9 0.55 2.5 1.3 0.88 1.1 1.1 2.7 1.2 4.4 0.13 1.7 0.23 3.6 1.3 5.2h-10c1.1-1.6 1.2-3.4 1.3-5.2 0.13-1.7 0.3-3.3 1.2-4.4 0.59-0.72 1.6-1.3 2.5-1.3zm-0.74 12h1.5c-0.0015 0.28 0.015 0.79-0.74 0.79-0.73 0.0016-0.72-0.53-0.74-0.79z\" />\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\">\n+  <path fill=\"#333\" d=\"M8 .29c-1.4 0-2.7.73-3.6 1.8-1.2 1.5-1.4 3.4-1.5 5.2-.18 2.2-.44 4-2.3 5.3l.28 1.3h5c.026.66.32 1.1.71 1.5.84.61 2 .61 2.8 0 .52-.4.6-1 .71-1.5h5l.28-1.3c-1.9-.97-2.2-3.3-2.3-5.3-.13-1.8-.26-3.7-1.5-5.2-.85-1-2.2-1.8-3.6-1.8zm0 1.4c.88 0 1.9.55 2.5 1.3.88 1.1 1.1 2.7 1.2 4.4.13 1.7.23 3.6 1.3 5.2H3c1.1-1.6 1.2-3.4 1.3-5.2.13-1.7.3-3.3 1.2-4.4.59-.72 1.6-1.3 2.5-1.3m-.74 12h1.5c-.001.28.015.79-.74.79-.73.002-.72-.53-.74-.79z\" class=\"jp-icon2 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/kernel.svg b/packages/ui-components/style/icons/statusbar/kernel.svg\nindex 24986ff5fe4f..a605cbf53a1c 100644\n--- a/packages/ui-components/style/icons/statusbar/kernel.svg\n+++ b/packages/ui-components/style/icons/statusbar/kernel.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-    <path class=\"jp-icon2\" fill=\"#616161\" d=\"M15 9H9v6h6V9zm-2 4h-2v-2h2v2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2zm-4 6H7V7h10v10z\"/>\n+  <path fill=\"#616161\" d=\"M15 9H9v6h6zm-2 4h-2v-2h2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2zm-4 6H7V7h10z\" class=\"jp-icon2\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/line-form.svg b/packages/ui-components/style/icons/statusbar/line-form.svg\nindex 720dc6da8b98..ac8f051c0269 100644\n--- a/packages/ui-components/style/icons/statusbar/line-form.svg\n+++ b/packages/ui-components/style/icons/statusbar/line-form.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-    <path fill=\"white\" d=\"M5.88 4.12L13.76 12l-7.88 7.88L8 22l10-10L8 2z\"/>\n+  <path fill=\"#fff\" d=\"M5.88 4.12 13.76 12l-7.88 7.88L8 22l10-10L8 2z\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/list.svg b/packages/ui-components/style/icons/statusbar/list.svg\nindex 40ec017af163..02a6e86fc928 100644\n--- a/packages/ui-components/style/icons/statusbar/list.svg\n+++ b/packages/ui-components/style/icons/statusbar/list.svg\n@@ -1,3 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-    <path class=\"jp-icon2 jp-icon-selectable\" fill=\"#616161\" d=\"M19 5v14H5V5h14m1.1-2H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9zM11 7h6v2h-6V7zm0 4h6v2h-6v-2zm0 4h6v2h-6zM7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7z\"/>\n+  <path fill=\"#616161\" d=\"M19 5v14H5V5zm1.1-2H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9M11 7h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6zM7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7z\" class=\"jp-icon2 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/not-trusted.svg b/packages/ui-components/style/icons/statusbar/not-trusted.svg\nindex 79f61bdc9c31..5de838de70c0 100644\n--- a/packages/ui-components/style/icons/statusbar/not-trusted.svg\n+++ b/packages/ui-components/style/icons/statusbar/not-trusted.svg\n@@ -1,5 +1,3 @@\n-<svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 25 25\">\n-    <path class=\"jp-icon2\" stroke=\"#333333\" stroke-width=\"2\" transform=\"translate(3 3)\" d=\"M1.86094 11.4409C0.826448 8.77027 0.863779 6.05764 1.24907 4.19932C2.48206 3.93347 4.08068 3.40347 5.60102 2.8449C7.23549 2.2444 8.85666 1.5815 9.9876 1.09539C11.0597 1.58341 12.6094 2.2444 14.218 2.84339C15.7503 3.41394 17.3995 3.95258 18.7539 4.21385C19.1364 6.07177 19.1709 8.77722 18.139 11.4409C17.0303 14.3032 14.6668 17.1844 9.99999 18.9354C5.33319 17.1844 2.96968 14.3032 1.86094 11.4409Z\"/>\n-    <path class=\"jp-icon2\" stroke=\"#333333\" stroke-width=\"2\" transform=\"translate(9.31592 9.32031)\" d=\"M7.36842 0L0 7.36479\"/>\n-    <path class=\"jp-icon2\" stroke=\"#333333\" stroke-width=\"2\" transform=\"translate(9.31592 16.6836) scale(1 -1)\" d=\"M7.36842 0L0 7.36479\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" fill=\"none\" viewBox=\"0 0 25 25\">\n+  <path stroke=\"#333\" stroke-width=\"2\" d=\"M4.86 14.44c-1.034-2.67-.996-5.382-.61-7.24 1.232-.267 2.83-.797 4.351-1.355a92 92 0 0 0 4.387-1.75 68 68 0 0 0 4.23 1.748c1.532.57 3.182 1.11 4.536 1.37.382 1.859.417 4.564-.615 7.228-1.109 2.862-3.472 5.743-8.139 7.494-4.667-1.75-7.03-4.632-8.14-7.494Zm11.824-5.12-7.368 7.365m7.368-.001L9.316 9.319\" class=\"jp-icon2\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/terminal.svg b/packages/ui-components/style/icons/statusbar/terminal.svg\nindex faabfde3d8ca..fd01df623c70 100644\n--- a/packages/ui-components/style/icons/statusbar/terminal.svg\n+++ b/packages/ui-components/style/icons/statusbar/terminal.svg\n@@ -1,4 +1,4 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\" >\n-    <rect class=\"jp-terminal-icon-background-color jp-icon-selectable\" width=\"20\" height=\"20\" transform=\"translate(2 2)\" fill=\"#333333\"/>\n-    <path class=\"jp-terminal-icon-color jp-icon-selectable-inverse\" d=\"M5.05664 8.76172C5.05664 8.59766 5.03125 8.45312 4.98047 8.32812C4.93359 8.19922 4.85547 8.08203 4.74609 7.97656C4.64062 7.87109 4.5 7.77539 4.32422 7.68945C4.15234 7.59961 3.94336 7.51172 3.69727 7.42578C3.30273 7.28516 2.94336 7.13672 2.61914 6.98047C2.29492 6.82422 2.01758 6.64258 1.78711 6.43555C1.56055 6.22852 1.38477 5.98828 1.25977 5.71484C1.13477 5.4375 1.07227 5.10938 1.07227 4.73047C1.07227 4.39844 1.12891 4.0957 1.24219 3.82227C1.35547 3.54492 1.51562 3.30469 1.72266 3.10156C1.92969 2.89844 2.17969 2.73437 2.47266 2.60938C2.76562 2.48438 3.0918 2.4043 3.45117 2.36914V1.10938H4.38867V2.38086C4.74023 2.42773 5.05664 2.52344 5.33789 2.66797C5.61914 2.8125 5.85742 3.00195 6.05273 3.23633C6.25195 3.4668 6.4043 3.74023 6.50977 4.05664C6.61914 4.36914 6.67383 4.7207 6.67383 5.11133H5.04492C5.04492 4.63867 4.9375 4.28125 4.72266 4.03906C4.50781 3.79297 4.2168 3.66992 3.84961 3.66992C3.65039 3.66992 3.47656 3.69727 3.32812 3.75195C3.18359 3.80273 3.06445 3.87695 2.9707 3.97461C2.87695 4.06836 2.80664 4.17969 2.75977 4.30859C2.7168 4.4375 2.69531 4.57812 2.69531 4.73047C2.69531 4.88281 2.7168 5.01953 2.75977 5.14062C2.80664 5.25781 2.88281 5.36719 2.98828 5.46875C3.09766 5.57031 3.24023 5.66797 3.41602 5.76172C3.5918 5.85156 3.81055 5.94336 4.07227 6.03711C4.4668 6.18555 4.82422 6.33984 5.14453 6.5C5.46484 6.65625 5.73828 6.83984 5.96484 7.05078C6.19531 7.25781 6.37109 7.5 6.49219 7.77734C6.61719 8.05078 6.67969 8.375 6.67969 8.75C6.67969 9.09375 6.62305 9.4043 6.50977 9.68164C6.39648 9.95508 6.23438 10.1914 6.02344 10.3906C5.8125 10.5898 5.55859 10.75 5.26172 10.8711C4.96484 10.9883 4.63281 11.0645 4.26562 11.0996V12.248H3.33398V11.0996C3.00195 11.0684 2.67969 10.9961 2.36719 10.8828C2.05469 10.7656 1.77734 10.5977 1.53516 10.3789C1.29688 10.1602 1.10547 9.88477 0.960938 9.55273C0.816406 9.2168 0.744141 8.81445 0.744141 8.3457H2.37891C2.37891 8.62695 2.41992 8.86328 2.50195 9.05469C2.58398 9.24219 2.68945 9.39258 2.81836 9.50586C2.95117 9.61523 3.10156 9.69336 3.26953 9.74023C3.4375 9.78711 3.60938 9.81055 3.78516 9.81055C4.20312 9.81055 4.51953 9.71289 4.73438 9.51758C4.94922 9.32227 5.05664 9.07031 5.05664 8.76172ZM13.418 12.2715H8.07422V11H13.418V12.2715Z\" transform=\"translate(3.95264 6)\" fill=\"white\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#333\" d=\"M2 2h20v20H2z\" class=\"jp-terminal-icon-background-color jp-icon-selectable\"/>\n+  <path fill=\"#fff\" d=\"M9.01 14.762q0-.246-.077-.434a.9.9 0 0 0-.234-.351 1.6 1.6 0 0 0-.422-.288 5 5 0 0 0-.627-.263q-.592-.211-1.078-.446a3.5 3.5 0 0 1-.832-.544 2.2 2.2 0 0 1-.528-.721 2.4 2.4 0 0 1-.187-.985q0-.498.17-.908a2.1 2.1 0 0 1 .48-.72q.31-.306.75-.493.44-.188.979-.24V7.11h.937v1.272q.527.07.95.287.421.217.714.568.3.345.457.82.165.47.164 1.055H8.998q0-.709-.323-1.072-.322-.37-.873-.37-.299 0-.521.083a.9.9 0 0 0-.358.223.9.9 0 0 0-.21.334q-.066.194-.065.421 0 .23.064.41a.9.9 0 0 0 .229.329q.165.152.428.293.263.134.656.275.591.223 1.072.463.48.235.82.55.346.312.528.727.187.41.187.973 0 .515-.17.932-.17.41-.486.709t-.762.48a3.7 3.7 0 0 1-.996.229v1.148h-.931V17.1a4 4 0 0 1-.967-.217 2.6 2.6 0 0 1-.832-.504 2.4 2.4 0 0 1-.574-.826q-.217-.505-.217-1.207h1.635q0 .421.123.709.123.281.316.45.2.165.451.235.252.07.516.07.627 0 .949-.292a.98.98 0 0 0 .322-.756m8.36 3.51h-5.343V17h5.344z\" class=\"jp-terminal-icon-color jp-icon-selectable-inverse\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/statusbar/trusted.svg b/packages/ui-components/style/icons/statusbar/trusted.svg\nindex bd7c0db01380..e38cf15e9384 100644\n--- a/packages/ui-components/style/icons/statusbar/trusted.svg\n+++ b/packages/ui-components/style/icons/statusbar/trusted.svg\n@@ -1,4 +1,4 @@\n-<svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 25\">\n-    <path class=\"jp-icon2\" stroke=\"#333333\" stroke-width=\"2\" transform=\"translate(2 3)\" d=\"M1.86094 11.4409C0.826448 8.77027 0.863779 6.05764 1.24907 4.19932C2.48206 3.93347 4.08068 3.40347 5.60102 2.8449C7.23549 2.2444 8.85666 1.5815 9.9876 1.09539C11.0597 1.58341 12.6094 2.2444 14.218 2.84339C15.7503 3.41394 17.3995 3.95258 18.7539 4.21385C19.1364 6.07177 19.1709 8.77722 18.139 11.4409C17.0303 14.3032 14.6668 17.1844 9.99999 18.9354C5.3332 17.1844 2.96968 14.3032 1.86094 11.4409Z\"/>\n-    <path class=\"jp-icon2\" fill=\"#333333\" stroke=\"#333333\" transform=\"translate(8 9.86719)\" d=\"M2.86015 4.86535L0.726549 2.99959L0 3.63045L2.86015 6.13157L8 0.630872L7.27857 0L2.86015 4.86535Z\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" fill=\"none\" viewBox=\"0 0 24 25\">\n+  <path stroke=\"#333\" stroke-width=\"2\" d=\"M3.86 14.44c-1.034-2.67-.996-5.382-.61-7.24 1.232-.267 2.83-.797 4.351-1.355a92 92 0 0 0 4.387-1.75 68 68 0 0 0 4.23 1.748c1.532.57 3.182 1.11 4.536 1.37.382 1.859.417 4.564-.615 7.228-1.109 2.862-3.472 5.743-8.139 7.494-4.667-1.75-7.03-4.632-8.14-7.494Z\" class=\"jp-icon2\"/>\n+  <path fill=\"#333\" stroke=\"#333\" d=\"m10.86 14.733-2.133-1.866-.727.63L10.86 16 16 10.5l-.721-.632z\" class=\"jp-icon2\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/add-above.svg b/packages/ui-components/style/icons/toolbar/add-above.svg\nindex 1db837646a69..148de8dbeb75 100644\n--- a/packages/ui-components/style/icons/toolbar/add-above.svg\n+++ b/packages/ui-components/style/icons/toolbar/add-above.svg\n@@ -1,11 +1,11 @@\n-<svg width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-<g clip-path=\"url(#clip0_137_19492)\">\n-<path class=\"jp-icon3\" d=\"M4.75 4.93066H6.625V6.80566C6.625 7.01191 6.79375 7.18066 7 7.18066C7.20625 7.18066 7.375 7.01191 7.375 6.80566V4.93066H9.25C9.45625 4.93066 9.625 4.76191 9.625 4.55566C9.625 4.34941 9.45625 4.18066 9.25 4.18066H7.375V2.30566C7.375 2.09941 7.20625 1.93066 7 1.93066C6.79375 1.93066 6.625 2.09941 6.625 2.30566V4.18066H4.75C4.54375 4.18066 4.375 4.34941 4.375 4.55566C4.375 4.76191 4.54375 4.93066 4.75 4.93066Z\" fill=\"#616161\" stroke=\"#616161\" stroke-width=\"0.7\"/>\n-</g>\n-<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M11.5 9.5V11.5L2.5 11.5V9.5L11.5 9.5ZM12 8C12.5523 8 13 8.44772 13 9V12C13 12.5523 12.5523 13 12 13L2 13C1.44772 13 1 12.5523 1 12V9C1 8.44772 1.44771 8 2 8L12 8Z\" fill=\"#616161\"/>\n-<defs>\n-<clipPath id=\"clip0_137_19492\">\n-<rect class=\"jp-icon3\" width=\"6\" height=\"6\" fill=\"white\" transform=\"matrix(-1 0 0 1 10 1.55566)\"/>\n-</clipPath>\n-</defs>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 14 14\">\n+  <g clip-path=\"url(#addabovea)\">\n+    <path fill=\"#616161\" stroke=\"#616161\" stroke-width=\".7\" d=\"M4.75 4.93h1.875v1.876c0 .206.169.375.375.375a.376.376 0 0 0 .375-.375V4.93H9.25a.376.376 0 0 0 .375-.375.376.376 0 0 0-.375-.375H7.375V2.306A.376.376 0 0 0 7 1.93a.376.376 0 0 0-.375.375V4.18H4.75a.376.376 0 0 0-.375.375c0 .206.169.375.375.375Z\" class=\"jp-icon3\"/>\n+  </g>\n+  <path fill=\"#616161\" fill-rule=\"evenodd\" d=\"M11.5 9.5v2h-9v-2zM12 8a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z\" class=\"jp-icon3\" clip-rule=\"evenodd\"/>\n+  <defs>\n+    <clipPath id=\"addabovea\">\n+      <path fill=\"#fff\" d=\"M10 1.556H4v6h6z\" class=\"jp-icon3\"/>\n+    </clipPath>\n+  </defs>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/add-below.svg b/packages/ui-components/style/icons/toolbar/add-below.svg\nindex 1b7019da7a20..51a4c8a83371 100644\n--- a/packages/ui-components/style/icons/toolbar/add-below.svg\n+++ b/packages/ui-components/style/icons/toolbar/add-below.svg\n@@ -1,11 +1,11 @@\n-<svg width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-<g clip-path=\"url(#clip0_137_19498)\">\n-<path class=\"jp-icon3\" d=\"M9.25 10.0693L7.375 10.0693L7.375 8.19434C7.375 7.98809 7.20625 7.81934 7 7.81934C6.79375 7.81934 6.625 7.98809 6.625 8.19434L6.625 10.0693L4.75 10.0693C4.54375 10.0693 4.375 10.2381 4.375 10.4443C4.375 10.6506 4.54375 10.8193 4.75 10.8193L6.625 10.8193L6.625 12.6943C6.625 12.9006 6.79375 13.0693 7 13.0693C7.20625 13.0693 7.375 12.9006 7.375 12.6943L7.375 10.8193L9.25 10.8193C9.45625 10.8193 9.625 10.6506 9.625 10.4443C9.625 10.2381 9.45625 10.0693 9.25 10.0693Z\" fill=\"#616161\" stroke=\"#616161\" stroke-width=\"0.7\"/>\n-</g>\n-<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.5 5.5L2.5 3.5L11.5 3.5L11.5 5.5L2.5 5.5ZM2 7C1.44772 7 1 6.55228 1 6L1 3C1 2.44772 1.44772 2 2 2L12 2C12.5523 2 13 2.44772 13 3L13 6C13 6.55229 12.5523 7 12 7L2 7Z\" fill=\"#616161\"/>\n-<defs>\n-<clipPath id=\"clip0_137_19498\">\n-<rect class=\"jp-icon3\" width=\"6\" height=\"6\" fill=\"white\" transform=\"matrix(1 1.74846e-07 1.74846e-07 -1 4 13.4443)\"/>\n-</clipPath>\n-</defs>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 14 14\">\n+  <g clip-path=\"url(#addbelowa)\">\n+    <path fill=\"#616161\" stroke=\"#616161\" stroke-width=\".7\" d=\"M9.25 10.07H7.375V8.193A.376.376 0 0 0 7 7.82a.376.376 0 0 0-.375.375v1.875H4.75a.376.376 0 0 0-.375.375c0 .207.169.375.375.375h1.875v1.875c0 .207.169.375.375.375a.376.376 0 0 0 .375-.375V10.82H9.25a.376.376 0 0 0 .375-.375.376.376 0 0 0-.375-.375Z\" class=\"jp-icon3\"/>\n+  </g>\n+  <path fill=\"#616161\" fill-rule=\"evenodd\" d=\"M2.5 5.5v-2h9v2zM2 7a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1z\" class=\"jp-icon3\" clip-rule=\"evenodd\"/>\n+  <defs>\n+    <clipPath id=\"addbelowa\">\n+      <path fill=\"#fff\" d=\"M4 13.444h6v-6H4z\" class=\"jp-icon3\"/>\n+    </clipPath>\n+  </defs>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/add.svg b/packages/ui-components/style/icons/toolbar/add.svg\nindex d1efcdb67850..8ee56ce22b36 100644\n--- a/packages/ui-components/style/icons/toolbar/add.svg\n+++ b/packages/ui-components/style/icons/toolbar/add.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/bug-dot.svg b/packages/ui-components/style/icons/toolbar/bug-dot.svg\nindex 2e607f980906..2daef6373260 100644\n--- a/packages/ui-components/style/icons/toolbar/bug-dot.svg\n+++ b/packages/ui-components/style/icons/toolbar/bug-dot.svg\n@@ -1,6 +1,6 @@\n-<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-    <g class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\">\n-        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M17.19 8H20V10H17.91C17.96 10.33 18 10.66 18 11V12H20V14H18.5H18V14.0275C15.75 14.2762 14 16.1837 14 18.5C14 19.208 14.1635 19.8779 14.4549 20.4739C13.7063 20.8117 12.8757 21 12 21C9.78 21 7.85 19.79 6.81 18H4V16H6.09C6.04 15.67 6 15.34 6 15V14H4V12H6V11C6 10.66 6.04 10.33 6.09 10H4V8H6.81C7.26 7.22 7.88 6.55 8.62 6.04L7 4.41L8.41 3L10.59 5.17C11.04 5.06 11.51 5 12 5C12.49 5 12.96 5.06 13.42 5.17L15.59 3L17 4.41L15.37 6.04C16.12 6.55 16.74 7.22 17.19 8ZM10 16H14V14H10V16ZM10 12H14V10H10V12Z\" fill=\"#616161\"/>\n-        <path d=\"M22 18.5C22 20.433 20.433 22 18.5 22C16.567 22 15 20.433 15 18.5C15 16.567 16.567 15 18.5 15C20.433 15 22 16.567 22 18.5Z\" fill=\"#616161\"/>\n-    </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\">\n+  <g fill=\"#616161\" class=\"jp-icon3 jp-icon-selectable\">\n+    <path fill-rule=\"evenodd\" d=\"M17.19 8H20v2h-2.09c.05.33.09.66.09 1v1h2v2h-2v.027a4.5 4.5 0 0 0-3.545 6.447A5.997 5.997 0 0 1 6.81 18H4v-2h2.09c-.05-.33-.09-.66-.09-1v-1H4v-2h2v-1c0-.34.04-.67.09-1H4V8h2.81c.45-.78 1.07-1.45 1.81-1.96L7 4.41 8.41 3l2.18 2.17c.45-.11.92-.17 1.41-.17s.96.06 1.42.17L15.59 3 17 4.41l-1.63 1.63c.75.51 1.37 1.18 1.82 1.96M10 16h4v-2h-4zm0-4h4v-2h-4z\" clip-rule=\"evenodd\"/>\n+    <path d=\"M22 18.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0\"/>\n+  </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/bug.svg b/packages/ui-components/style/icons/toolbar/bug.svg\nindex 603c54258a0c..c94f4eb501ef 100644\n--- a/packages/ui-components/style/icons/toolbar/bug.svg\n+++ b/packages/ui-components/style/icons/toolbar/bug.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\">\n-    <path d=\"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M20 8h-2.81a6 6 0 0 0-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5s-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/check.svg b/packages/ui-components/style/icons/toolbar/check.svg\nindex 7e87e0da94ed..425708fbafcb 100644\n--- a/packages/ui-components/style/icons/toolbar/check.svg\n+++ b/packages/ui-components/style/icons/toolbar/check.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\">\n-    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\" class=\"jp-icon3 jp-icon-selectable\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/circle-empty.svg b/packages/ui-components/style/icons/toolbar/circle-empty.svg\nindex 2cc4dbb1f4a6..93eb29c810de 100644\n--- a/packages/ui-components/style/icons/toolbar/circle-empty.svg\n+++ b/packages/ui-components/style/icons/toolbar/circle-empty.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/circle.svg b/packages/ui-components/style/icons/toolbar/circle.svg\nindex c4ec2c1d490d..cff800698471 100644\n--- a/packages/ui-components/style/icons/toolbar/circle.svg\n+++ b/packages/ui-components/style/icons/toolbar/circle.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 18 18\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <circle cx=\"9\" cy=\"9\" r=\"8\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n+  <circle cx=\"9\" cy=\"9\" r=\"8\" fill=\"#616161\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/cleaning.svg b/packages/ui-components/style/icons/toolbar/cleaning.svg\nindex ca2164570768..8e2e427da191 100644\n--- a/packages/ui-components/style/icons/toolbar/cleaning.svg\n+++ b/packages/ui-components/style/icons/toolbar/cleaning.svg\n@@ -1,5 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M16,11h-1V3c0-1.1-0.9-2-2-2h-2C9.9,1,9,1.9,9,3v8H8c-2.76,0-5,2.24-5,5v7h18v-7C21,13.24,18.76,11,16,11z M19,21h-2v-3 c0-0.55-0.45-1-1-1s-1,0.45-1,1v3h-2v-3c0-0.55-0.45-1-1-1s-1,0.45-1,1v3H9v-3c0-0.55-0.45-1-1-1s-1,0.45-1,1v3H5v-5 c0-1.65,1.35-3,3-3h8c1.65,0,3,1.35,3,3V21z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M16 11h-1V3c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v8H8c-2.76 0-5 2.24-5 5v7h18v-7c0-2.76-2.24-5-5-5m3 10h-2v-3c0-.55-.45-1-1-1s-1 .45-1 1v3h-2v-3c0-.55-.45-1-1-1s-1 .45-1 1v3H9v-3c0-.55-.45-1-1-1s-1 .45-1 1v3H5v-5c0-1.65 1.35-3 3-3h8c1.65 0 3 1.35 3 3z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/clear.svg b/packages/ui-components/style/icons/toolbar/clear.svg\nindex 10e35a557e60..b95bbad26f79 100644\n--- a/packages/ui-components/style/icons/toolbar/clear.svg\n+++ b/packages/ui-components/style/icons/toolbar/clear.svg\n@@ -1,11 +1,10 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <mask id=\"donutHole\">\n-    <rect width=\"24\" height=\"24\" fill=\"white\" />\n-    <circle cx=\"12\" cy=\"12\" r=\"8\" fill=\"black\"/>\n+  <mask id=\"cleara\">\n+    <path fill=\"#fff\" d=\"M0 0h24v24H0z\"/>\n+    <circle cx=\"12\" cy=\"12\" r=\"8\" fill=\"#000\"/>\n   </mask>\n-\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <rect height=\"18\" width=\"2\" x=\"11\" y=\"3\" transform=\"rotate(315, 12, 12)\"/>\n-    <circle cx=\"12\" cy=\"12\" r=\"10\" mask=\"url(#donutHole)\"/>\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n+    <path d=\"M4.929 6.343 6.343 4.93l12.728 12.728-1.414 1.414z\"/>\n+    <circle cx=\"12\" cy=\"12\" r=\"10\" mask=\"url(#cleara)\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/close.svg b/packages/ui-components/style/icons/toolbar/close.svg\nindex d8994afa5cd9..625b88f9a8c8 100644\n--- a/packages/ui-components/style/icons/toolbar/close.svg\n+++ b/packages/ui-components/style/icons/toolbar/close.svg\n@@ -1,13 +1,5 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon-none jp-icon-selectable-inverse jp-icon3-hover\" fill=\"none\">\n-    <circle cx=\"12\" cy=\"12\" r=\"11\"/>\n-  </g>\n-\n-  <g class=\"jp-icon3 jp-icon-selectable jp-icon-accent2-hover\" fill=\"#616161\">\n-    <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\n-  </g>\n-\n-  <g class=\"jp-icon-none jp-icon-busy\" fill=\"none\">\n-    <circle cx=\"12\" cy=\"12\" r=\"7\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <circle cx=\"12\" cy=\"12\" r=\"11\" fill=\"none\" class=\"jp-icon-none jp-icon-selectable-inverse jp-icon3-hover\"/>\n+  <path fill=\"#616161\" d=\"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" class=\"jp-icon3 jp-icon-selectable jp-icon-accent2-hover\"/>\n+  <circle cx=\"12\" cy=\"12\" r=\"7\" fill=\"none\" class=\"jp-icon-none jp-icon-busy\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/code.svg b/packages/ui-components/style/icons/toolbar/code.svg\nindex 13b1e997a0a3..4c2dbf556611 100644\n--- a/packages/ui-components/style/icons/toolbar/code.svg\n+++ b/packages/ui-components/style/icons/toolbar/code.svg\n@@ -1,5 +1,3 @@\n-<svg width=\"22\" height=\"22\" viewBox=\"0 0 28 28\" xmlns=\"http://www.w3.org/2000/svg\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\">\n-\t\t<path d=\"M11.4 18.6L6.8 14L11.4 9.4L10 8L4 14L10 20L11.4 18.6ZM16.6 18.6L21.2 14L16.6 9.4L18 8L24 14L18 20L16.6 18.6V18.6Z\"/>\n-\t</g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" viewBox=\"0 0 28 28\">\n+  <path fill=\"#616161\" d=\"M11.4 18.6 6.8 14l4.6-4.6L10 8l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L18 8l6 6-6 6z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/collapse-all.svg b/packages/ui-components/style/icons/toolbar/collapse-all.svg\nindex c82f2d7cb284..15943f7cca55 100644\n--- a/packages/ui-components/style/icons/toolbar/collapse-all.svg\n+++ b/packages/ui-components/style/icons/toolbar/collapse-all.svg\n@@ -1,9 +1,7 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-        <path\n-            d=\"M8 2c1 0 11 0 12 0s2 1 2 2c0 1 0 11 0 12s0 2-2 2C20 14 20 4 20 4S10 4 6 4c0-2 1-2 2-2z\" />\n-        <path\n-            d=\"M18 8c0-1-1-2-2-2S5 6 4 6s-2 1-2 2c0 1 0 11 0 12s1 2 2 2c1 0 11 0 12 0s2-1 2-2c0-1 0-11 0-12zm-2 0v12H4V8z\" />\n-        <path d=\"M6 13v2h8v-2z\" />\n-    </g>\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n+    <path d=\"M8 2h12c1 0 2 1 2 2v12c0 1 0 2-2 2V4H6c0-2 1-2 2-2\"/>\n+    <path d=\"M18 8c0-1-1-2-2-2H4C3 6 2 7 2 8v12c0 1 1 2 2 2h12c1 0 2-1 2-2zm-2 0v12H4V8z\"/>\n+    <path d=\"M6 13v2h8v-2z\"/>\n+  </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/copy.svg b/packages/ui-components/style/icons/toolbar/copy.svg\nindex 87ecbb5698a5..fe5fb5ad6b89 100644\n--- a/packages/ui-components/style/icons/toolbar/copy.svg\n+++ b/packages/ui-components/style/icons/toolbar/copy.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 18 18\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M11.9,1H3.2C2.4,1,1.7,1.7,1.7,2.5v10.2h1.5V2.5h8.7V1z M14.1,3.9h-8c-0.8,0-1.5,0.7-1.5,1.5v10.2c0,0.8,0.7,1.5,1.5,1.5h8 c0.8,0,1.5-0.7,1.5-1.5V5.4C15.5,4.6,14.9,3.9,14.1,3.9z M14.1,15.5h-8V5.4h8V15.5z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n+  <path fill=\"#616161\" d=\"M11.9 1H3.2c-.8 0-1.5.7-1.5 1.5v10.2h1.5V2.5h8.7zm2.2 2.9h-8c-.8 0-1.5.7-1.5 1.5v10.2c0 .8.7 1.5 1.5 1.5h8c.8 0 1.5-.7 1.5-1.5V5.4c-.1-.8-.7-1.5-1.5-1.5m0 11.6h-8V5.4h8z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/cut.svg b/packages/ui-components/style/icons/toolbar/cut.svg\nindex 424803807a1c..d32e3cac07cc 100644\n--- a/packages/ui-components/style/icons/toolbar/cut.svg\n+++ b/packages/ui-components/style/icons/toolbar/cut.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1L9.64 7.64zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm6-7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5.5.22.5.5-.22.5-.5.5zM19 3l-6 6 2 2 7-7V3z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2m0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2m6-7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5.5.22.5.5-.22.5-.5.5M19 3l-6 6 2 2 7-7V3z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/delete.svg b/packages/ui-components/style/icons/toolbar/delete.svg\nindex d586a7dfd403..d1c15c6707fb 100644\n--- a/packages/ui-components/style/icons/toolbar/delete.svg\n+++ b/packages/ui-components/style/icons/toolbar/delete.svg\n@@ -1,4 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"16px\" height=\"16px\">\n-    <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n-    <path class=\"jp-icon3\" fill=\"#626262\" d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\" />\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#626262\" d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/download.svg b/packages/ui-components/style/icons/toolbar/download.svg\nindex 11aaa1ce0bfa..989979709a23 100644\n--- a/packages/ui-components/style/icons/toolbar/download.svg\n+++ b/packages/ui-components/style/icons/toolbar/download.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/duplicate.svg b/packages/ui-components/style/icons/toolbar/duplicate.svg\nindex 9dff82e44fb4..f7c8c9da4928 100644\n--- a/packages/ui-components/style/icons/toolbar/duplicate.svg\n+++ b/packages/ui-components/style/icons/toolbar/duplicate.svg\n@@ -1,4 +1,4 @@\n-<svg width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-<path class=\"jp-icon3\" fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M2.79998 0.875H8.89582C9.20061 0.875 9.44998 1.13914 9.44998 1.46198C9.44998 1.78482 9.20061 2.04896 8.89582 2.04896H3.35415C3.04936 2.04896 2.79998 2.3131 2.79998 2.63594V9.67969C2.79998 10.0025 2.55061 10.2667 2.24582 10.2667C1.94103 10.2667 1.69165 10.0025 1.69165 9.67969V2.04896C1.69165 1.40328 2.1904 0.875 2.79998 0.875ZM5.36665 11.9V4.55H11.0833V11.9H5.36665ZM4.14165 4.14167C4.14165 3.69063 4.50728 3.325 4.95832 3.325H11.4917C11.9427 3.325 12.3083 3.69063 12.3083 4.14167V12.3083C12.3083 12.7594 11.9427 13.125 11.4917 13.125H4.95832C4.50728 13.125 4.14165 12.7594 4.14165 12.3083V4.14167Z\" fill=\"#616161\"/>\n-<path class=\"jp-icon3\" d=\"M9.43574 8.26507H8.36431V9.3365C8.36431 9.45435 8.26788 9.55078 8.15002 9.55078C8.03217 9.55078 7.93574 9.45435 7.93574 9.3365V8.26507H6.86431C6.74645 8.26507 6.65002 8.16864 6.65002 8.05078C6.65002 7.93292 6.74645 7.8365 6.86431 7.8365H7.93574V6.76507C7.93574 6.64721 8.03217 6.55078 8.15002 6.55078C8.26788 6.55078 8.36431 6.64721 8.36431 6.76507V7.8365H9.43574C9.5536 7.8365 9.65002 7.93292 9.65002 8.05078C9.65002 8.16864 9.5536 8.26507 9.43574 8.26507Z\" fill=\"#616161\" stroke=\"#616161\" stroke-width=\"0.5\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 14 14\">\n+  <path fill=\"#616161\" fill-rule=\"evenodd\" d=\"M2.8.875h6.096c.305 0 .554.264.554.587s-.25.587-.554.587H3.354c-.305 0-.554.264-.554.587V9.68c0 .322-.25.587-.554.587s-.554-.264-.554-.587V2.049c0-.646.498-1.174 1.108-1.174M5.367 11.9V4.55h5.716v7.35zM4.142 4.142c0-.451.365-.817.816-.817h6.534c.45 0 .816.366.816.817v8.166a.817.817 0 0 1-.816.817H4.958a.817.817 0 0 1-.816-.817z\" class=\"jp-icon3\" clip-rule=\"evenodd\"/>\n+  <path fill=\"#616161\" stroke=\"#616161\" stroke-width=\".5\" d=\"M9.436 8.265H8.364v1.071a.215.215 0 0 1-.214.215.215.215 0 0 1-.214-.215v-1.07H6.864a.215.215 0 0 1-.214-.215c0-.118.096-.215.214-.215h1.072v-1.07a.214.214 0 1 1 .428-.001v1.072h1.072c.118 0 .214.096.214.214a.215.215 0 0 1-.214.214Z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/edit.svg b/packages/ui-components/style/icons/toolbar/edit.svg\nindex 8601528807b6..ea04cf7563e6 100644\n--- a/packages/ui-components/style/icons/toolbar/edit.svg\n+++ b/packages/ui-components/style/icons/toolbar/edit.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/ellipses.svg b/packages/ui-components/style/icons/toolbar/ellipses.svg\nindex 21da9263d588..db43abf05798 100644\n--- a/packages/ui-components/style/icons/toolbar/ellipses.svg\n+++ b/packages/ui-components/style/icons/toolbar/ellipses.svg\n@@ -1,5 +1,5 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n     <circle cx=\"5\" cy=\"12\" r=\"2\"/>\n     <circle cx=\"12\" cy=\"12\" r=\"2\"/>\n     <circle cx=\"19\" cy=\"12\" r=\"2\"/>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/expand-all.svg b/packages/ui-components/style/icons/toolbar/expand-all.svg\nindex 88d130d4f665..89fc851277ef 100644\n--- a/packages/ui-components/style/icons/toolbar/expand-all.svg\n+++ b/packages/ui-components/style/icons/toolbar/expand-all.svg\n@@ -1,9 +1,7 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-        <path\n-            d=\"M8 2c1 0 11 0 12 0s2 1 2 2c0 1 0 11 0 12s0 2-2 2C20 14 20 4 20 4S10 4 6 4c0-2 1-2 2-2z\" />\n-        <path\n-            d=\"M18 8c0-1-1-2-2-2S5 6 4 6s-2 1-2 2c0 1 0 11 0 12s1 2 2 2c1 0 11 0 12 0s2-1 2-2c0-1 0-11 0-12zm-2 0v12H4V8z\" />\n-        <path d=\"M11 10H9v3H6v2h3v3h2v-3h3v-2h-3z\" />\n-    </g>\n+  <g fill=\"#616161\" class=\"jp-icon3\">\n+    <path d=\"M8 2h12c1 0 2 1 2 2v12c0 1 0 2-2 2V4H6c0-2 1-2 2-2\"/>\n+    <path d=\"M18 8c0-1-1-2-2-2H4C3 6 2 7 2 8v12c0 1 1 2 2 2h12c1 0 2-1 2-2zm-2 0v12H4V8z\"/>\n+    <path d=\"M11 10H9v3H6v2h3v3h2v-3h3v-2h-3z\"/>\n+  </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/fast-forward.svg b/packages/ui-components/style/icons/toolbar/fast-forward.svg\nindex 8b5780514eb1..13b3b222d3be 100644\n--- a/packages/ui-components/style/icons/toolbar/fast-forward.svg\n+++ b/packages/ui-components/style/icons/toolbar/fast-forward.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-        <path d=\"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z\"/>\n-    </g>\n+  <path fill=\"#616161\" d=\"m4 18 8.5-6L4 6zm9-12v12l8.5-6z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/file-upload.svg b/packages/ui-components/style/icons/toolbar/file-upload.svg\nindex 8c93861371f8..fc7e2d7358d1 100644\n--- a/packages/ui-components/style/icons/toolbar/file-upload.svg\n+++ b/packages/ui-components/style/icons/toolbar/file-upload.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/filter-list.svg b/packages/ui-components/style/icons/toolbar/filter-list.svg\nindex 7224ac8e8b81..5525383b40d2 100644\n--- a/packages/ui-components/style/icons/toolbar/filter-list.svg\n+++ b/packages/ui-components/style/icons/toolbar/filter-list.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/launch.svg b/packages/ui-components/style/icons/toolbar/launch.svg\nindex fc8dca9b74e9..677963d4f221 100644\n--- a/packages/ui-components/style/icons/toolbar/launch.svg\n+++ b/packages/ui-components/style/icons/toolbar/launch.svg\n@@ -1,6 +1,6 @@\n-<svg viewBox=\"0 0 32 32\" width=\"32\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3 jp-icon-selectable\" fill=\"#616161\">\n-    <path d=\"M26,28H6a2.0027,2.0027,0,0,1-2-2V6A2.0027,2.0027,0,0,1,6,4H16V6H6V26H26V16h2V26A2.0027,2.0027,0,0,1,26,28Z\"/>\n-    <polygon points=\"20 2 20 4 26.586 4 18 12.586 19.414 14 28 5.414 28 12 30 12 30 2 20 2\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" viewBox=\"0 0 32 32\">\n+  <g fill=\"#616161\" class=\"jp-icon3 jp-icon-selectable\">\n+    <path d=\"M26 28H6a2.003 2.003 0 0 1-2-2V6a2.003 2.003 0 0 1 2-2h10v2H6v20h20V16h2v10a2.003 2.003 0 0 1-2 2\"/>\n+    <path d=\"M20 2v2h6.586L18 12.586 19.414 14 28 5.414V12h2V2z\"/>\n   </g>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/link.svg b/packages/ui-components/style/icons/toolbar/link.svg\nindex 308b089a8e68..7f229ccc9e65 100644\n--- a/packages/ui-components/style/icons/toolbar/link.svg\n+++ b/packages/ui-components/style/icons/toolbar/link.svg\n@@ -1,5 +1,3 @@\n-<svg viewBox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/move-down.svg b/packages/ui-components/style/icons/toolbar/move-down.svg\nindex b34f274084b1..7ce13475d86d 100644\n--- a/packages/ui-components/style/icons/toolbar/move-down.svg\n+++ b/packages/ui-components/style/icons/toolbar/move-down.svg\n@@ -1,3 +1,3 @@\n-<svg width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-<path class=\"jp-icon3\" d=\"M12.471 7.52899C12.7632 7.23684 12.7632 6.76316 12.471 6.47101V6.47101C12.179 6.17905 11.7057 6.17884 11.4135 6.47054L7.75 10.1275V1.75C7.75 1.33579 7.41421 1 7 1V1C6.58579 1 6.25 1.33579 6.25 1.75V10.1275L2.59726 6.46822C2.30338 6.17381 1.82641 6.17359 1.53226 6.46774V6.46774C1.2383 6.7617 1.2383 7.2383 1.53226 7.53226L6.29289 12.2929C6.68342 12.6834 7.31658 12.6834 7.70711 12.2929L12.471 7.52899Z\" fill=\"#616161\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 14 14\">\n+  <path fill=\"#616161\" d=\"M12.471 7.529a.748.748 0 0 0-1.057-1.058L7.75 10.127V1.75a.75.75 0 0 0-1.5 0v8.378l-3.653-3.66a.753.753 0 1 0-1.065 1.064l4.76 4.76a1 1 0 0 0 1.415 0z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/move-up.svg b/packages/ui-components/style/icons/toolbar/move-up.svg\nindex 2fc3fb6f60bd..3adcc32d08d3 100644\n--- a/packages/ui-components/style/icons/toolbar/move-up.svg\n+++ b/packages/ui-components/style/icons/toolbar/move-up.svg\n@@ -1,3 +1,3 @@\n-<svg width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n-<path class=\"jp-icon3\" d=\"M1.52899 6.47101C1.23684 6.76316 1.23684 7.23684 1.52899 7.52899V7.52899C1.82095 7.82095 2.29426 7.82116 2.58649 7.52946L6.25 3.8725V12.25C6.25 12.6642 6.58579 13 7 13V13C7.41421 13 7.75 12.6642 7.75 12.25V3.8725L11.4027 7.53178C11.6966 7.82619 12.1736 7.82641 12.4677 7.53226V7.53226C12.7617 7.2383 12.7617 6.7617 12.4677 6.46774L7.70711 1.70711C7.31658 1.31658 6.68342 1.31658 6.29289 1.70711L1.52899 6.47101Z\" fill=\"#616161\"/>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 14 14\">\n+  <path fill=\"#616161\" d=\"M1.529 6.471a.748.748 0 0 0 1.057 1.058L6.25 3.873v8.377a.75.75 0 0 0 1.5 0V3.873l3.653 3.659a.753.753 0 1 0 1.065-1.064l-4.76-4.76a1 1 0 0 0-1.415 0z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/new-folder.svg b/packages/ui-components/style/icons/toolbar/new-folder.svg\nindex 73119a79f249..351541e7b3db 100644\n--- a/packages/ui-components/style/icons/toolbar/new-folder.svg\n+++ b/packages/ui-components/style/icons/toolbar/new-folder.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-1 8h-3v3h-2v-3h-3v-2h3V9h2v3h3v2z\"/>\n-  </g>\n+  <path fill=\"#616161\" d=\"M20 6h-8l-2-2H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-1 8h-3v3h-2v-3h-3v-2h3V9h2v3h3z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/numbering.svg b/packages/ui-components/style/icons/toolbar/numbering.svg\nindex 4cabc1a0f27e..5e0ab95c53ee 100644\n--- a/packages/ui-components/style/icons/toolbar/numbering.svg\n+++ b/packages/ui-components/style/icons/toolbar/numbering.svg\n@@ -1,5 +1,3 @@\n-<svg width=\"22\" height=\"22\" viewBox=\"0 0 28 28\" xmlns=\"http://www.w3.org/2000/svg\">\n-\t<g class=\"jp-icon3\" fill=\"#616161\">\n-\t\t<path d=\"M4 19H6V19.5H5V20.5H6V21H4V22H7V18H4V19ZM5 10H6V6H4V7H5V10ZM4 13H5.8L4 15.1V16H7V15H5.2L7 12.9V12H4V13ZM9 7V9H23V7H9ZM9 21H23V19H9V21ZM9 15H23V13H9V15Z\"/>\n-\t</g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" viewBox=\"0 0 28 28\">\n+  <path fill=\"#616161\" d=\"M4 19h2v.5H5v1h1v.5H4v1h3v-4H4zm1-9h1V6H4v1h1zm-1 3h1.8L4 15.1v.9h3v-1H5.2L7 12.9V12H4zm5-6v2h14V7zm0 14h14v-2H9zm0-6h14v-2H9z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/offline-bolt.svg b/packages/ui-components/style/icons/toolbar/offline-bolt.svg\nindex fca6a91db29b..104f32143bca 100644\n--- a/packages/ui-components/style/icons/toolbar/offline-bolt.svg\n+++ b/packages/ui-components/style/icons/toolbar/offline-bolt.svg\n@@ -1,5 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"16\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-    <path d=\"M12 2.02c-5.51 0-9.98 4.47-9.98 9.98s4.47 9.98 9.98 9.98 9.98-4.47 9.98-9.98S17.51 2.02 12 2.02zM11.48 20v-6.26H8L13 4v6.26h3.35L11.48 20z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M12 2.02c-5.51 0-9.98 4.47-9.98 9.98s4.47 9.98 9.98 9.98 9.98-4.47 9.98-9.98S17.51 2.02 12 2.02M11.48 20v-6.26H8L13 4v6.26h3.35z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/paste.svg b/packages/ui-components/style/icons/toolbar/paste.svg\nindex 12067fccf6f0..845dd3117892 100644\n--- a/packages/ui-components/style/icons/toolbar/paste.svg\n+++ b/packages/ui-components/style/icons/toolbar/paste.svg\n@@ -1,5 +1,3 @@\n-<svg height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-        <path d=\"M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z\"/>\n-    </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m7 18H5V4h2v3h10V4h2z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/redo.svg b/packages/ui-components/style/icons/toolbar/redo.svg\nindex 0a36593a0081..5795f5ecf979 100644\n--- a/packages/ui-components/style/icons/toolbar/redo.svg\n+++ b/packages/ui-components/style/icons/toolbar/redo.svg\n@@ -1,5 +1,3 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"16\">\n-  <g class=\"jp-icon3\" fill=\"#616161\">\n-      <path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z\"/>\n-  </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"24\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16a8 8 0 0 1 7.6-5.5c1.95 0 3.73.72 5.12 1.88L13 16h9V7z\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/refresh.svg b/packages/ui-components/style/icons/toolbar/refresh.svg\nindex 540adb09e772..e839801b1f5f 100644\n--- a/packages/ui-components/style/icons/toolbar/refresh.svg\n+++ b/packages/ui-components/style/icons/toolbar/refresh.svg\n@@ -1,5 +1,3 @@\n <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" viewBox=\"0 0 18 18\">\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-        <path d=\"M9 13.5c-2.49 0-4.5-2.01-4.5-4.5S6.51 4.5 9 4.5c1.24 0 2.36.52 3.17 1.33L10 8h5V3l-1.76 1.76C12.15 3.68 10.66 3 9 3 5.69 3 3.01 5.69 3.01 9S5.69 15 9 15c2.97 0 5.43-2.16 5.9-5h-1.52c-.46 2-2.24 3.5-4.38 3.5z\"/>\n-    </g>\n+  <path fill=\"#616161\" d=\"M9 13.5c-2.49 0-4.5-2.01-4.5-4.5S6.51 4.5 9 4.5c1.24 0 2.36.52 3.17 1.33L10 8h5V3l-1.76 1.76A6 6 0 0 0 9 3C5.69 3 3.01 5.69 3.01 9S5.69 15 9 15a5.98 5.98 0 0 0 5.9-5h-1.52c-.46 2-2.24 3.5-4.38 3.5\" class=\"jp-icon3\"/>\n </svg>\n\ndiff --git a/packages/ui-components/style/icons/toolbar/run.svg b/packages/ui-components/style/icons/toolbar/run.svg\nindex bb8517650b4c..4aecb3c82294 100644\n--- a/packages/ui-components/style/icons/toolbar/run.svg\n+++ b/packages/ui-components/style/icons/toolbar/run.svg\n@@ -1,5 +1,3 @@\n-<svg height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\">\n-    <g class=\"jp-icon3\" fill=\"#616161\">\n-        <path d=\"M8 5v14l11-7z\"/>\n-    </g>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n+  <path fill=\"#616161\" d=\"M8 5v14l11-7z\" class=\"jp-icon3\"/>\n </svg>\n",
    "test_patch": "diff --git a/galata/test/documentation/general.test.ts-snapshots/notebook-not-trusted-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/notebook-not-trusted-documentation-linux.png\nindex 53b091866e5e..0ac3723e6e80 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/notebook-not-trusted-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/notebook-not-trusted-documentation-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16647",
    "pr_id": 16647,
    "issue_id": 16633,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "JupyterLab suppresses left mouse up while holding shift.\n## Description\r\n\r\nWhen left clicking in an interactive plot, JupyterLab suppresses the mouse up event while `shift` is held. This only applies to left clicks, right clicks are correctly forwarded to the plot even if `shift` is held. This only happens in JupyterLab, I ran the interactive plot outside of JupyterLab and left mouse up events were properly forwarded to the plot.\r\n\r\nhttps://github.com/user-attachments/assets/6a39d729-16cd-4cca-8d27-b1ec848f2263\r\n\r\n## Reproduce\r\n\r\nDisplay an interactive plot and `shift` + `left click` in the plot.\r\n\r\n## Expected behavior\r\n\r\nLeft mouse up events should be forwarded regardless if the `shift` key state.\r\n\r\n## Context\r\n\r\n- Operating System and version: MacOS\r\n- Browser and version: Brave\r\n- JupyterLab version: 4.2.4\r\n\r\nThe plot element has `data-lm-suppress-shortcuts=true` and `data-jp-suppress-context-menu` set.",
    "issue_word_count": 138,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/widget.ts",
      "packages/notebook/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/widget.spec.ts"
    ],
    "base_commit": "653c22621f996249862093d0bb0f23b1279b0f52",
    "head_commit": "3bf72c65f4e8c695cf8f5a08bb797d163b20376b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16647",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16647",
    "dockerfile": "",
    "pr_merged_at": "2024-08-09T17:20:34.000Z",
    "patch": "diff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex cdee8d78f365..624f5714cee4 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -2691,6 +2691,13 @@ export class Notebook extends StaticNotebook {\n         }\n         // Enter selecting mode\n         this._mouseMode = 'select';\n+\n+        // We don't want to block the shift-click mouse up handler\n+        // when the current cell is (and remains) the active cell.\n+        this._selectData = {\n+          startedOnActiveCell: index == this.activeCellIndex,\n+          startingCellIndex: this.activeCellIndex\n+        };\n         document.addEventListener('mouseup', this, true);\n         document.addEventListener('mousemove', this, true);\n       } else if (button === 0 && !shiftKey) {\n@@ -2736,8 +2743,21 @@ export class Notebook extends StaticNotebook {\n    * Handle the `'mouseup'` event on the document.\n    */\n   private _evtDocumentMouseup(event: MouseEvent): void {\n-    event.preventDefault();\n-    event.stopPropagation();\n+    const [, index] = this._findEventTargetAndCell(event);\n+\n+    let shouldPreventDefault = true;\n+    if (this._mouseMode === 'select' && this._selectData) {\n+      // User did not move the mouse over to a difference cell, so there was no selection\n+      const { startedOnActiveCell, startingCellIndex } = this._selectData;\n+      if (startedOnActiveCell && index === startingCellIndex) {\n+        shouldPreventDefault = false;\n+      }\n+      this._selectData = null;\n+    }\n+    if (shouldPreventDefault) {\n+      event.preventDefault();\n+      event.stopPropagation();\n+    }\n \n     // Remove the event listeners we put on the document\n     document.removeEventListener('mousemove', this, true);\n@@ -2746,8 +2766,6 @@ export class Notebook extends StaticNotebook {\n     if (this._mouseMode === 'couldDrag') {\n       // We didn't end up dragging if we are here, so treat it as a click event.\n \n-      const [, index] = this._findEventTargetAndCell(event);\n-\n       this.deselectAll();\n       this.activeCellIndex = index;\n       // Focus notebook if active cell changes but does not have focus.\n@@ -3159,6 +3177,10 @@ export class Notebook extends StaticNotebook {\n     pressY: number;\n     index: number;\n   } | null = null;\n+  private _selectData: {\n+    startedOnActiveCell: boolean;\n+    startingCellIndex: number;\n+  } | null = null;\n   private _mouseMode: 'select' | 'couldDrag' | null = null;\n   private _activeCellChanged = new Signal<this, Cell | null>(this);\n   private _stateChanged = new Signal<this, IChangedArgs<any>>(this);\n",
    "test_patch": "diff --git a/packages/notebook/test/widget.spec.ts b/packages/notebook/test/widget.spec.ts\nindex a1a3a465ed71..f4fe3038b2a1 100644\n--- a/packages/notebook/test/widget.spec.ts\n+++ b/packages/notebook/test/widget.spec.ts\n@@ -1233,6 +1233,21 @@ describe('@jupyter/notebook', () => {\n         it('should extend selection if invoked with shift', () => {\n           widget.activeCellIndex = 3;\n \n+          // shift click no-op\n+          simulate(widget.widgets[3].node, 'mousedown', { shiftKey: true });\n+          expect(widget.activeCellIndex).toBe(3);\n+          expect(selected(widget)).toEqual([]);\n+          // test that selecting mode handler does not prevent default\n+          // if no cells were selected; in the selecting mode we listen\n+          // to the `mouseup` event to stop selecting when the mouse button gets\n+          // released; this event gets default prevented as handled by the notebook.\n+          const mouseUpEvent = new MouseEvent('mouseup', {\n+            bubbles: true,\n+            cancelable: true\n+          });\n+          widget.widgets[3].node.dispatchEvent(mouseUpEvent);\n+          expect(mouseUpEvent.defaultPrevented).toBe(false);\n+\n           // shift click below\n           simulate(widget.widgets[4].node, 'mousedown', { shiftKey: true });\n           expect(widget.activeCellIndex).toBe(4);\n@@ -1252,6 +1267,27 @@ describe('@jupyter/notebook', () => {\n           simulate(widget.widgets[2].node, 'mousedown', { shiftKey: true });\n           expect(widget.activeCellIndex).toBe(2);\n           expect(selected(widget)).toEqual([2, 3]);\n+\n+          // shift click deselect\n+          simulate(widget.widgets[3].node, 'mousedown', { shiftKey: true });\n+          expect(widget.activeCellIndex).toBe(3);\n+          expect(selected(widget)).toEqual([]);\n+\n+          // shift click select by dragging from active cell\n+          expect(widget.activeCellIndex).toBe(3);\n+          simulate(widget.widgets[3].node, 'mousedown', { shiftKey: true });\n+          expect(widget.activeCellIndex).toBe(3);\n+          simulate(widget.widgets[4].node, 'mousemove', { shiftKey: true });\n+          expect(selected(widget)).toEqual([3, 4]);\n+          // test that selecting mode mouse up handler prevents default;\n+          // in selecting mode we listen to the `mouseup` event to stop\n+          // selecting when the mouse button gets released\n+          const blockedMouseUpEvent = new MouseEvent('mouseup', {\n+            bubbles: true,\n+            cancelable: true\n+          });\n+          widget.widgets[4].node.dispatchEvent(blockedMouseUpEvent);\n+          expect(blockedMouseUpEvent.defaultPrevented).toBe(true);\n         });\n \n         it('should not extend a selection if there is text selected in the output', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16639",
    "pr_id": 16639,
    "issue_id": 16553,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Galata helper to create a notebook for a specified kernel. \n### Problem\r\nI want to leverage the Playwright helpers that Galata provides to interact with notebooks. However, we want to start a notebook with a different kernel specified from the normal. \r\n\r\nI would like the method page.notebook.createNew to have an optional field to specify the name of the kernel to use.\r\nAlternatively, I'd like to be able to switch the kernel a notebook is using more easily. \r\n\r\n### Proposed Solution\r\n\r\nMy proposed solution would be to update the createNew function to have a second optional argument called `options` which is a json structure which contains a field called `kernel` which specifies the name of the kernel you want to open.\r\n\r\nI've got a rough working prototype with the code changes at the end of this issue.\r\nWhich I've tested with a custom kernel locally - not sure of the best way to update the tests in the repo to validate this new behaviour.\r\n\r\nSome guidance on whether this is an appropriate change would be appreciated. \r\n\r\nFor file: `galata/src/helpers/notebook.ts`\r\n```ts\r\n  /**\r\n   * Create a new notebook\r\n   *\r\n   * @param name Name of the notebook (optional)\r\n   * @param options Options for creating the notebook (optional)\r\n   * @param options.kernel Name of the kernel to use for the notebook (optional)\r\n   * @returns Name of the created notebook or null if it failed\r\n   */\r\n  async createNew(name?: string, options?: { kernel?: string }): Promise<string | null> {\r\n    await this.menu.clickMenuItem('File>New>Notebook');\r\n\r\n    const page = this.page;\r\n    await page.locator('.jp-Dialog').waitFor();\r\n\r\n    /************ New code *******************/\r\n    if (options?.kernel) {\r\n      await page.getByRole('dialog').getByRole('combobox').selectOption(`{\"name\":\"${options.kernel}\"}`);\r\n    }\r\n   /*****************************************/\r\n\r\n    await page.click('.jp-Dialog .jp-mod-accept');\r\n\r\n    const activeTab = this.activity.getTabLocator();\r\n    if (!(await activeTab.count())) {\r\n      return null;\r\n    }\r\n\r\n    const label = activeTab.locator('div.lm-TabBar-tabLabel');\r\n    if (!(await label.count())) {\r\n      return null;\r\n    }\r\n\r\n    const assignedName = await label.textContent();\r\n\r\n    if (!name) {\r\n      return assignedName;\r\n    }\r\n\r\n    const currentDir = await this.filebrowser.getCurrentDirectory();\r\n    await this.contents.renameFile(\r\n      `${currentDir}/${assignedName}`,\r\n      `${currentDir}/${name}`\r\n    );\r\n    const renamedTab = this.activity.getTabLocator(name);\r\n\r\n    return (await renamedTab.count()) ? name : null;\r\n  }\r\n```\r\n\r\n\r\n",
    "issue_word_count": 338,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/src/helpers/notebook.ts",
      "galata/test/galata/notebook.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/galata/notebook.spec.ts"
    ],
    "base_commit": "3e0b84aa4be48163e72ca837648e3c2f328933fd",
    "head_commit": "cd95e14ff30aaf08a2434465e7d1d00a4f82de97",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16639",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16639",
    "dockerfile": "",
    "pr_merged_at": "2024-08-08T18:40:25.000Z",
    "patch": "diff --git a/galata/src/helpers/notebook.ts b/galata/src/helpers/notebook.ts\nindex 770d441497d6..29b9d9de1c4e 100644\n--- a/galata/src/helpers/notebook.ts\n+++ b/galata/src/helpers/notebook.ts\n@@ -1414,16 +1414,36 @@ export class NotebookHelper {\n   }\n \n   /**\n-   * Create a new notebook\n+   * Creates a new notebook.\n    *\n-   * @param name Name of the notebook\n-   * @returns Name of the created notebook or null if it failed\n+   * @param name - The name of the notebook. If provided, the notebook will be renamed to this name.\n+   * @param options - Parameters for creating the notebook.\n+   * @param options.kernel - The kernel to use for the notebook.\n+   * @returns A Promise that resolves to the name of the created notebook, or `null` if the notebook creation failed.\n    */\n-  async createNew(name?: string): Promise<string | null> {\n+  async createNew(\n+    name?: string,\n+    options?: { kernel?: string | null }\n+  ): Promise<string | null> {\n     await this.menu.clickMenuItem('File>New>Notebook');\n \n     const page = this.page;\n     await page.locator('.jp-Dialog').waitFor();\n+\n+    if (options && options.kernel !== undefined) {\n+      if (options.kernel === null) {\n+        await page\n+          .getByRole('dialog')\n+          .getByRole('combobox')\n+          .selectOption('null');\n+      } else {\n+        await page\n+          .getByRole('dialog')\n+          .getByRole('combobox')\n+          .selectOption(`{\"name\":\"${options.kernel}\"}`);\n+      }\n+    }\n+\n     await page.click('.jp-Dialog .jp-mod-accept');\n \n     const activeTab = this.activity.getTabLocator();\n",
    "test_patch": "diff --git a/galata/test/galata/notebook.spec.ts b/galata/test/galata/notebook.spec.ts\nindex 10607d030f58..98e4d7abcea7 100644\n--- a/galata/test/galata/notebook.spec.ts\n+++ b/galata/test/galata/notebook.spec.ts\n@@ -18,6 +18,32 @@ test.describe('Notebook Tests', () => {\n       true\n     );\n   });\n+  test('Create New Notebook with kernel', async ({ page, tmpPath }) => {\n+    const fileName = 'create_kernel_test.ipynb';\n+    await page.notebook.createNew(fileName, { kernel: 'python3' });\n+    await page.getByRole('main').getByText(fileName).waitFor();\n+\n+    expect(await page.contents.fileExists(`${tmpPath}/${fileName}`)).toEqual(\n+      true\n+    );\n+    const toolbar = page.getByRole('toolbar', { name: 'notebook actions' });\n+    await expect(toolbar.getByText('Python 3 (ipykernel)')).toBeVisible();\n+  });\n+\n+  test('Create New Notebook with kernel - no kernel', async ({\n+    page,\n+    tmpPath\n+  }) => {\n+    const fileName = 'create_no_kernel_test.ipynb';\n+    await page.notebook.createNew(fileName, { kernel: null });\n+    await page.getByRole('main').getByText(fileName).waitFor();\n+\n+    expect(await page.contents.fileExists(`${tmpPath}/${fileName}`)).toEqual(\n+      true\n+    );\n+    const toolbar = page.getByRole('toolbar', { name: 'notebook actions' });\n+    await expect(toolbar.getByText('No Kernel')).toBeVisible();\n+  });\n \n   test('Create Markdown cell', async ({ page }) => {\n     await page.notebook.createNew();\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16628",
    "pr_id": 16628,
    "issue_id": 16623,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Error rendering .ipynb file with array value in a \"text/plain\" cell output data field\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nI am re-using the notebook component outside of JupyterLab. While trying to load an .ipynb file with the following structure, I receive an unhandled exception and the page does not load. The relevant part of the structure is that the output data contains a string[] and not a string.\r\n\r\n```\r\n  {\r\n   \"cell_type\": \"code\",\r\n   \"execution_count\": 6,\r\n   \"metadata\": {},\r\n   \"outputs\": [\r\n    {\r\n     \"data\": {\r\n      \"text/plain\": [\r\n       \"Success: 0 rows affected\"\r\n      ]\r\n     }\r\n      ...\r\n    }\r\n```\r\n\r\n## Reproduce\r\n\r\nload an .ipynb file with an array instead of a string in the ouput.data[\"text/plain\"] field\r\n\r\n\r\nDebugging in the browser led me to [the code here](https://github.com/jupyterlab/jupyterlab/blob/main/packages/notebook/src/windowing.ts#L64):\r\n\r\n\r\n```\r\n  estimateWidgetSize = (index: number): number => {\r\n    const model = this.cells[index].model;\r\n    const height = this.cellsEstimatedHeight.get(model.id);\r\n    if (typeof height === 'number') {\r\n      return height;\r\n    }\r\n\r\n    const nLines = model.sharedModel.getSource().split('\\n').length;\r\n    let outputsLines = 0;\r\n    if (model instanceof CodeCellModel) {\r\n      for (let outputIdx = 0; outputIdx < model.outputs.length; outputIdx++) {\r\n        const output = model.outputs.get(outputIdx);\r\n        outputsLines = ((output.data['text/plain'] as string) ?? '').split(        // <--- error occurs here\r\n          '\\n'\r\n        ).length;\r\n      }\r\n    }\r\n    return (\r\n      NotebookViewModel.DEFAULT_EDITOR_LINE_HEIGHT * (nLines + outputsLines) +\r\n      NotebookViewModel.DEFAULT_CELL_MARGIN\r\n    );\r\n  };\r\n```\r\n\r\nI believe the issue is that simply casting an array to string `output.data['text/plain'] as string` results in undefined rather than a string, so the call to `split` fails. I think we need to check whether the value is a string or string[] and handle accordingly.\r\n\r\n## Expected behavior\r\n\r\nthe notebook file renders\r\n\r\n## Context\r\n\r\n- Operating System and version: Mac Sonomo 14.5\r\n- Browser and version: Chrome Version 126.0.6478.185\r\n- JupyterLab version: 4.2.3\r\n\r\n",
    "issue_word_count": 308,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/windowing.ts",
      "packages/notebook/test/modelfactory.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/modelfactory.spec.ts"
    ],
    "base_commit": "967c3d537db12c81fa0f0827e6db97c26316a054",
    "head_commit": "c0e764f15e520c614913b55c8b36cb252e4f8da4",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16628",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16628",
    "dockerfile": "",
    "pr_merged_at": "2024-08-01T17:31:21.000Z",
    "patch": "diff --git a/packages/notebook/src/windowing.ts b/packages/notebook/src/windowing.ts\nindex acee95551fca..4b7204f9b88a 100644\n--- a/packages/notebook/src/windowing.ts\n+++ b/packages/notebook/src/windowing.ts\n@@ -61,9 +61,12 @@ export class NotebookViewModel extends WindowedListModel {\n     if (model instanceof CodeCellModel) {\n       for (let outputIdx = 0; outputIdx < model.outputs.length; outputIdx++) {\n         const output = model.outputs.get(outputIdx);\n-        outputsLines = ((output.data['text/plain'] as string) ?? '').split(\n-          '\\n'\n-        ).length;\n+        const data = output.data['text/plain'];\n+        if (typeof data === 'string') {\n+          outputsLines += data.split('\\n').length;\n+        } else if (Array.isArray(data)) {\n+          outputsLines += data.join('').split('\\n').length;\n+        }\n       }\n     }\n     return (\n",
    "test_patch": "diff --git a/packages/notebook/test/modelfactory.spec.ts b/packages/notebook/test/modelfactory.spec.ts\nindex 517e8dd39d29..fa98b016f4e1 100644\n--- a/packages/notebook/test/modelfactory.spec.ts\n+++ b/packages/notebook/test/modelfactory.spec.ts\n@@ -1,7 +1,13 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { NotebookModel, NotebookModelFactory } from '@jupyterlab/notebook';\n+import { createStandaloneCell, YCodeCell } from '@jupyter/ydoc';\n+import { Cell, CodeCellModel, ICodeCellModel } from '@jupyterlab/cells';\n+import {\n+  NotebookModel,\n+  NotebookModelFactory,\n+  NotebookViewModel\n+} from '@jupyterlab/notebook';\n \n describe('@jupyterlab/notebook', () => {\n   describe('NotebookModelFactory', () => {\n@@ -79,4 +85,76 @@ describe('@jupyterlab/notebook', () => {\n       });\n     });\n   });\n+\n+  describe('NotebookViewModel', () => {\n+    let notebook: NotebookViewModelTest;\n+\n+    beforeEach(() => {\n+      notebook = new NotebookViewModelTest([]);\n+    });\n+\n+    test('should calculate height based on number of lines in source and output (string output)', () => {\n+      const outputObj = [\n+        {\n+          output_type: 'execute_result',\n+          data: {\n+            'text/plain': '15',\n+            'text/html': ['<div>\\n', ' <p>15</p>\\n', '</div>']\n+          },\n+          execution_count: 2,\n+          metadata: {}\n+        }\n+      ];\n+      const sharedModel = createStandaloneCell({\n+        cell_type: 'code',\n+        execution_count: 1,\n+        outputs: outputObj,\n+        source: ['sum([1, 2, 3, 4, 5])'],\n+        metadata: {}\n+      }) as YCodeCell;\n+\n+      const model: ICodeCellModel = new CodeCellModel({ sharedModel });\n+      expect(model.executionCount).toBe(1);\n+      notebook.cells.push({ model } as Cell<ICodeCellModel>);\n+\n+      const height = notebook.estimateWidgetSize(0);\n+      expect(height).toBe(56); // (1 source_line + 1 output_line) * 17 (line_height) + 22 (cell_margin)\n+    });\n+\n+    test('should calculate height based on number of lines in source and output (string[] output)', () => {\n+      const outputObj = [\n+        {\n+          output_type: 'execute_result',\n+          data: {\n+            'text/plain': [\n+              'Output line 1\\n',\n+              'Output line 2\\n',\n+              'Output line 3\\n'\n+            ],\n+            'text/html': []\n+          },\n+          execution_count: 4,\n+          metadata: {}\n+        }\n+      ];\n+      const sharedModel = createStandaloneCell({\n+        cell_type: 'code',\n+        execution_count: 1,\n+        outputs: outputObj,\n+        source: ['for i in range(3):\\n', '    print(f\"Output line {i+1}\")'],\n+        metadata: {}\n+      }) as YCodeCell;\n+\n+      const model: ICodeCellModel = new CodeCellModel({ sharedModel });\n+      expect(model.executionCount).toBe(1);\n+      notebook.cells.push({ model } as Cell<ICodeCellModel>);\n+\n+      const height = notebook.estimateWidgetSize(0);\n+      expect(height).toBe(124); // (2 source_line + 4 output_line) * 17 (line_height) + 22 (cell_margin)\n+    });\n+  });\n });\n+\n+class NotebookViewModelTest extends NotebookViewModel {\n+  public cells: Cell[] = [];\n+}\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16615",
    "pr_id": 16615,
    "issue_id": 16608,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Improve upgrade notification styling\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n<!--\r\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\r\n\r\n\r\nBefore creating a new feature request please search the issues for relevant feature requests.\r\n-->\r\n\r\n### Problem\r\n\r\nThe upgrade popup has a few usability problems:\r\n\r\n1. The button labels are so long that they flow to a second line\r\n2. The button labels are left-justified, not centered like other buttons in Jupyter are\r\n3. The \"Open changelog\" button label is styled like a link, including an underline, even though it works like a button\r\n4. The tooltip for \"Do not check for updates\" starts with \"If pressed, you will not be prompted\", which is verbose.\r\n\r\n![image](https://github.com/user-attachments/assets/f57b90d8-5058-406b-b397-2c3c687a1990)\r\n\r\n\r\n### Proposed Solution\r\n\r\n1. Shorten \"Do not check for updates\" to \"Ignore\" and shorten \"Open changelog\" to \"Changelog\"\r\n2. Center-align button label text\r\n3. Style \"[Open] changelog\" as text, not as a link\r\n4. Shorten the tooltips to be commands, not conditional statements: for example, \"Do not prompt me if a new JupyterLab version is available.\"\r\n",
    "issue_word_count": 228,
    "test_files_count": 2,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/announcements.test.ts",
      "jupyterlab/handlers/announcements.py",
      "jupyterlab/tests/test_announcements.py",
      "packages/apputils-extension/src/announcements.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/announcements.test.ts",
      "jupyterlab/tests/test_announcements.py"
    ],
    "base_commit": "eb678f70df0376080df2e80d47b74a989ac552c9",
    "head_commit": "f8e0bc2e5cc96c5cd36c2051369e0d3a340d2b2e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16615",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16615",
    "dockerfile": "",
    "pr_merged_at": "2024-08-08T12:32:41.000Z",
    "patch": "diff --git a/jupyterlab/handlers/announcements.py b/jupyterlab/handlers/announcements.py\nindex 4381f7c5ed42..b896fd4661e3 100644\n--- a/jupyterlab/handlers/announcements.py\n+++ b/jupyterlab/handlers/announcements.py\n@@ -110,7 +110,7 @@ async def __call__(self) -> Awaitable[Tuple[str, Tuple[str, str]]]:\n                 trans = translator.load(\"jupyterlab\")\n                 return (\n                     trans.__(f\"A newer version ({last_version}) of JupyterLab is available.\"),\n-                    (trans.__(\"Open changelog\"), f\"{JUPYTERLAB_RELEASE_URL}{last_version}\"),\n+                    (trans.__(\"Read moreâ€¦\"), f\"{JUPYTERLAB_RELEASE_URL}{last_version}\"),\n                 )\n             else:\n                 return None\n\ndiff --git a/packages/apputils-extension/src/announcements.ts b/packages/apputils-extension/src/announcements.ts\nindex 64417d72f1ec..757a00845a9e 100644\n--- a/packages/apputils-extension/src/announcements.ts\n+++ b/packages/apputils-extension/src/announcements.ts\n@@ -240,9 +240,9 @@ export const announcements: JupyterFrontEndPlugin<void> = {\n               let notificationId: string;\n               options.actions = [\n                 {\n-                  label: trans.__('Do not check for updates'),\n+                  label: trans.__('Ignore all updates'),\n                   caption: trans.__(\n-                    'If pressed, you will not be prompted if a new JupyterLab version is found.'\n+                    'Do not prompt me if a new JupyterLab version is available.'\n                   ),\n                   callback: () => {\n                     settings\n@@ -266,7 +266,9 @@ export const announcements: JupyterFrontEndPlugin<void> = {\n                   callback: () => {\n                     window.open(link[1], '_blank', 'noreferrer');\n                   },\n-                  displayType: 'link'\n+                  // Because the link to the changelog is the primary option,\n+                  // display it in an accent color.\n+                  displayType: 'accent'\n                 });\n               }\n               if (!state.seen) {\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/announcements.test.ts b/galata/test/jupyterlab/announcements.test.ts\nindex 7974a1b0abfc..24c4c3df4b45 100644\n--- a/galata/test/jupyterlab/announcements.test.ts\n+++ b/galata/test/jupyterlab/announcements.test.ts\n@@ -28,7 +28,7 @@ test('Announcements requires user agreement', async ({ page }) => {\n test.describe('Update available', () => {\n   const id = 'update-id';\n   const message = 'A newer version (1000.0) of JupyterLab is available.';\n-  const actionLabel = 'Changelog';\n+  const actionLabel = 'Read moreâ€¦';\n \n   test.use({\n     autoGoto: false,\n\ndiff --git a/jupyterlab/tests/test_announcements.py b/jupyterlab/tests/test_announcements.py\nindex 5c5274462726..3bfdad7fd0f9 100644\n--- a/jupyterlab/tests/test_announcements.py\n+++ b/jupyterlab/tests/test_announcements.py\n@@ -62,7 +62,7 @@ async def test_CheckForUpdateHandler_get_pypi_success(mock_client, labserverapp,\n     payload = json.loads(response.body)\n     assert payload[\"notification\"][\"message\"] == message\n     assert payload[\"notification\"][\"link\"] == [\n-        \"Open changelog\",\n+        \"Read moreâ€¦\",\n         \"https://github.com/jupyterlab/jupyterlab/releases/tag/v1000.0.0\",\n     ]\n     assert payload[\"notification\"][\"options\"] == {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16590",
    "pr_id": 16590,
    "issue_id": 601,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Esc should dismiss completer. \nAll is in the title, \n\nafter pressing tab, the completer pops-up, I think having esc dismissing the completer is something that sounds reasonable. \n\nThoughts ? \n",
    "issue_word_count": 29,
    "test_files_count": 2,
    "non_test_files_count": 13,
    "pr_changed_files": [
      "dev_mode/index.js",
      "examples/filebrowser/src/index.ts",
      "examples/notebook/src/index.ts",
      "packages/application/src/frontend.ts",
      "packages/coreutils/src/plugins.ts",
      "packages/csvviewer-extension/package.json",
      "packages/docmanager-extension/src/index.tsx",
      "packages/docmanager/src/manager.ts",
      "packages/docmanager/src/tokens.ts",
      "packages/docmanager/src/widgetmanager.ts",
      "packages/docmanager/test/manager.spec.ts",
      "packages/docmanager/test/widgetmanager.spec.ts",
      "packages/docregistry/src/registry.ts",
      "packages/filebrowser/src/listing.ts",
      "packages/rendermime-extension/src/index.ts"
    ],
    "pr_changed_test_files": [
      "packages/docmanager/test/manager.spec.ts",
      "packages/docmanager/test/widgetmanager.spec.ts"
    ],
    "base_commit": "f122f8cdfd593b4cb148cd6b6babdda2965faae6",
    "head_commit": "031d7ecbdb85d2e7c733c04f5987ddedb236245e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16590",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16590",
    "dockerfile": "",
    "pr_merged_at": "2024-08-02T09:12:28.000Z",
    "patch": "diff --git a/dev_mode/index.js b/dev_mode/index.js\nindex 0ea232b071da..8ae03ae44555 100644\n--- a/dev_mode/index.js\n+++ b/dev_mode/index.js\n@@ -64,6 +64,7 @@ export async function main() {\n   var deferred = [];\n   var ignorePlugins = [];\n   var register = [];\n+  var entrypoints = {}\n \n \n   const federatedExtensionPromises = [];\n@@ -175,6 +176,24 @@ export async function main() {\n \n       const pkgPlugins = pkgJson['jupyterlab']['plugins'];\n       if (pkgPlugins) {\n+        const entryPointData = pkgJson['jupyterlab']['entrypoint'];\n+\n+        if(entryPointData){\n+          Object.entries(entryPointData).forEach(([entryPoint, data]) => {\n+            if (!entrypoints[entryPoint]) {\n+              entrypoints[entryPoint] = []\n+            }\n+            data.forEach(pluginData=>{\n+              entrypoints[entryPoint].push({\n+                extension: '{{@key}}',\n+                data : pluginData,\n+                activate: () => {\n+                  return pluginRegistry.activatePlugin(pluginData.pluginId)\n+                }\n+              })\n+            })\n+          });\n+        }\n         for(let plugin of processPlugins(pkgPlugins, '{{@key}}')) {\n           register.push({...plugin, loader: async () => {\n             const candidate = modulesCache.get('{{@key}}{{#if this}}/{{this}}{{/if}}');\n@@ -183,7 +202,6 @@ export async function main() {\n             }\n             const delegate = new PromiseDelegate();\n             modulesCache.set('{{@key}}{{#if this}}/{{this}}{{/if}}', delegate.promise);\n-            console.debug('Loading {{@key}}{{#if this}}/{{this}}{{/if}}â€¦');\n             let ext = await import('{{@key}}{{#if this}}/{{this}}{{/if}}');\n             ext.__scope__ = '{{@key}}';\n             delegate.resolve(ext);\n@@ -225,6 +243,7 @@ export async function main() {\n \n   const lab = new JupyterLab({\n     pluginRegistry,\n+    entrypoints,\n     mimeExtensions,\n     disabled: {\n       matches: disabled,\n\ndiff --git a/examples/filebrowser/src/index.ts b/examples/filebrowser/src/index.ts\nindex 18146abc3482..5610b5687ea2 100644\n--- a/examples/filebrowser/src/index.ts\n+++ b/examples/filebrowser/src/index.ts\n@@ -151,9 +151,8 @@ function createApp(\n           type: 'file',\n           path: fbModel.path\n         })\n-        .then(model => {\n-          docManager.open(model.path);\n-        });\n+        .then(model => docManager.open(model.path))\n+        .catch(console.error);\n     }\n   });\n   fbWidget.toolbar.insertItem(0, 'create', creator);\n@@ -184,7 +183,7 @@ function createApp(\n     mnemonic: 0,\n     execute: () => {\n       for (const item of fbWidget.selectedItems()) {\n-        docManager.openOrReveal(item.path);\n+        docManager.openOrReveal(item.path).catch(console.error);\n       }\n     }\n   });\n\ndiff --git a/examples/notebook/src/index.ts b/examples/notebook/src/index.ts\nindex d574466bcfc4..ad5c463a5a19 100644\n--- a/examples/notebook/src/index.ts\n+++ b/examples/notebook/src/index.ts\n@@ -56,12 +56,10 @@ import { COMMAND_IDS, setupCommands } from './commands';\n \n function main(): void {\n   const manager = new ServiceManager();\n-  void manager.ready.then(() => {\n-    createApp(manager);\n-  });\n+  void manager.ready.then(() => createApp(manager)).catch(console.error);\n }\n \n-function createApp(manager: ServiceManager.IManager): void {\n+async function createApp(manager: ServiceManager.IManager): Promise<void> {\n   // Initialize the command registry with the bindings.\n   const commands = new CommandRegistry();\n   const useCapture = true;\n@@ -216,7 +214,7 @@ function createApp(manager: ServiceManager.IManager): void {\n   docRegistry.addWidgetFactory(wFactory);\n \n   const notebookPath = PageConfig.getOption('notebookPath');\n-  const nbWidget = docManager.open(notebookPath) as NotebookPanel;\n+  const nbWidget = (await docManager.open(notebookPath)) as NotebookPanel;\n   const palette = new CommandPalette({ commands });\n   palette.addClass('notebookCommandPalette');\n \n\ndiff --git a/packages/application/src/frontend.ts b/packages/application/src/frontend.ts\nindex c982e0d37fec..7122c2833f36 100644\n--- a/packages/application/src/frontend.ts\n+++ b/packages/application/src/frontend.ts\n@@ -2,6 +2,7 @@\n // Distributed under the terms of the Modified BSD License.\n \n import { CommandLinker } from '@jupyterlab/apputils';\n+import { IEntrypoint } from '@jupyterlab/coreutils';\n import { DocumentRegistry } from '@jupyterlab/docregistry';\n import { ServiceManager } from '@jupyterlab/services';\n import { ContextMenuSvg } from '@jupyterlab/ui-components';\n@@ -66,7 +67,11 @@ export abstract class JupyterFrontEnd<\n \n     this.commandLinker =\n       options.commandLinker || new CommandLinker({ commands: this.commands });\n-    this.docRegistry = options.docRegistry || new DocumentRegistry();\n+    this.docRegistry =\n+      options.docRegistry ||\n+      new DocumentRegistry({\n+        entrypoints: options.entrypoints\n+      });\n     this.restored =\n       options.restored ||\n       this.started.then(() => restored).catch(() => restored);\n@@ -220,6 +225,7 @@ export namespace JupyterFrontEnd {\n    */\n   export interface IOptions<T extends IShell = IShell, U = any>\n     extends Application.IOptions<T> {\n+    entrypoints?: Record<string, IEntrypoint[]>;\n     /**\n      * The document registry instance used by the application.\n      */\n\ndiff --git a/packages/coreutils/src/plugins.ts b/packages/coreutils/src/plugins.ts\nindex 2be7fd306748..33ed55c53170 100644\n--- a/packages/coreutils/src/plugins.ts\n+++ b/packages/coreutils/src/plugins.ts\n@@ -31,6 +31,23 @@ export interface IPluginModule {\n   default: IPlugin<any, any> | IPlugin<any, any>[];\n }\n \n+export interface IEntrypoint {\n+  /**\n+   *  The name of the widget factory.\n+   */\n+  extension: string;\n+\n+  /**\n+   * function tha will active the widget factory\n+   */\n+  activate: () => Promise<void>;\n+\n+  /**\n+   * data from the package json\n+   */\n+  data: any;\n+}\n+\n export interface IPlugin2<T = any, U = any>\n   extends Omit<\n     IPlugin<T, U>,\n\ndiff --git a/packages/csvviewer-extension/package.json b/packages/csvviewer-extension/package.json\nindex c5b417adbc67..3b4000e57322 100644\n--- a/packages/csvviewer-extension/package.json\n+++ b/packages/csvviewer-extension/package.json\n@@ -92,7 +92,31 @@\n         ],\n         \"autoStart\": false\n       }\n-    ]\n+    ],\n+    \"entrypoint\": {\n+      \"widgetFactory\": [\n+        {\n+          \"pluginId\": \"@jupyterlab/csvviewer-extension:csv\",\n+          \"name\": \"CSVTable\",\n+          \"fileTypes\": [\n+            \"csv\"\n+          ],\n+          \"defaultFor\": [\n+            \"csv\"\n+          ]\n+        },\n+        {\n+          \"pluginId\": \"@jupyterlab/csvviewer-extension:tsv\",\n+          \"name\": \"TSVTable\",\n+          \"fileTypes\": [\n+            \"tsv\"\n+          ],\n+          \"defaultFor\": [\n+            \"tsv\"\n+          ]\n+        }\n+      ]\n+    }\n   },\n   \"styleModule\": \"style/index.js\"\n }\n\ndiff --git a/packages/docmanager-extension/src/index.tsx b/packages/docmanager-extension/src/index.tsx\nindex 28b4c3892c2a..d8325ebc1943 100644\n--- a/packages/docmanager-extension/src/index.tsx\n+++ b/packages/docmanager-extension/src/index.tsx\n@@ -719,7 +719,8 @@ function addCommands(\n         (args['options'] as DocumentRegistry.IOpenOptions) || void 0;\n       return docManager.services.contents\n         .get(path, { content: false })\n-        .then(() => docManager.openOrReveal(path, factory, kernel, options));\n+        .then(() => docManager.openOrReveal(path, factory, kernel, options))\n+        .catch(console.error);\n     },\n     iconClass: args => (args['icon'] as string) || '',\n     label: args =>\n@@ -1132,10 +1133,14 @@ function addLabCommands(\n         return;\n       }\n       // Clone the widget.\n-      const child = docManager.cloneWidget(widget);\n-      if (child) {\n-        widgetOpener.open(child, options);\n-      }\n+      docManager\n+        .cloneWidget(widget)\n+        .then(child => {\n+          if (child) {\n+            widgetOpener.open(child, options);\n+          }\n+        })\n+        .catch(console.error);\n     }\n   });\n \n\ndiff --git a/packages/docmanager/src/manager.ts b/packages/docmanager/src/manager.ts\nindex d41247f6617c..dbde35b923c3 100644\n--- a/packages/docmanager/src/manager.ts\n+++ b/packages/docmanager/src/manager.ts\n@@ -246,7 +246,7 @@ export class DocumentManager implements IDocumentManager {\n    *  Uses the same widget factory and context as the source, or returns\n    *  `undefined` if the source widget is not managed by this manager.\n    */\n-  cloneWidget(widget: Widget): IDocumentWidget | undefined {\n+  async cloneWidget(widget: Widget): Promise<IDocumentWidget | undefined> {\n     return this._widgetManager.cloneWidget(widget);\n   }\n \n@@ -315,11 +315,11 @@ export class DocumentManager implements IDocumentManager {\n    * This function will return `undefined` if a valid widget factory\n    * cannot be found.\n    */\n-  createNew(\n+  async createNew(\n     path: string,\n     widgetName = 'default',\n     kernel?: Partial<Kernel.IModel>\n-  ): Widget | undefined {\n+  ): Promise<Widget | undefined> {\n     return this._createOrOpenDocument('create', path, widgetName, kernel);\n   }\n \n@@ -431,12 +431,12 @@ export class DocumentManager implements IDocumentManager {\n    * This function will return `undefined` if a valid widget factory\n    * cannot be found.\n    */\n-  open(\n+  async open(\n     path: string,\n     widgetName = 'default',\n     kernel?: Partial<Kernel.IModel>,\n     options?: DocumentRegistry.IOpenOptions\n-  ): IDocumentWidget | undefined {\n+  ): Promise<IDocumentWidget | undefined> {\n     return this._createOrOpenDocument(\n       'open',\n       path,\n@@ -462,12 +462,12 @@ export class DocumentManager implements IDocumentManager {\n    * This function will return `undefined` if a valid widget factory\n    * cannot be found.\n    */\n-  openOrReveal(\n+  async openOrReveal(\n     path: string,\n     widgetName = 'default',\n     kernel?: Partial<Kernel.IModel>,\n     options?: DocumentRegistry.IOpenOptions\n-  ): IDocumentWidget | undefined {\n+  ): Promise<IDocumentWidget | undefined> {\n     const widget = this.findWidget(path, widgetName);\n     if (widget) {\n       this._opener.open(widget, {\n@@ -627,13 +627,13 @@ export class DocumentManager implements IDocumentManager {\n    * The two cases differ in how the document context is handled, but the creation\n    * of the widget and launching of the kernel are identical.\n    */\n-  private _createOrOpenDocument(\n+  private async _createOrOpenDocument(\n     which: 'open' | 'create',\n     path: string,\n     widgetName = 'default',\n     kernel?: Partial<Kernel.IModel>,\n     options?: DocumentRegistry.IOpenOptions\n-  ): IDocumentWidget | undefined {\n+  ): Promise<IDocumentWidget | undefined> {\n     const widgetFactory = this._widgetFactoryFor(path, widgetName);\n     if (!widgetFactory) {\n       return undefined;\n@@ -672,7 +672,10 @@ export class DocumentManager implements IDocumentManager {\n       throw new Error(`Invalid argument 'which': ${which}`);\n     }\n \n-    const widget = this._widgetManager.createWidget(widgetFactory, context);\n+    const widget = await this._widgetManager.createWidget(\n+      widgetFactory,\n+      context\n+    );\n     this._opener.open(widget, { type: widgetFactory.name, ...options });\n \n     // If the initial opening of the context fails, dispose of the widget.\n\ndiff --git a/packages/docmanager/src/tokens.ts b/packages/docmanager/src/tokens.ts\nindex e70e35b26277..68fb775e22b2 100644\n--- a/packages/docmanager/src/tokens.ts\n+++ b/packages/docmanager/src/tokens.ts\n@@ -95,7 +95,7 @@ export interface IDocumentManager extends IDisposable {\n    *  Uses the same widget factory and context as the source, or returns\n    *  `undefined` if the source widget is not managed by this manager.\n    */\n-  cloneWidget(widget: Widget): IDocumentWidget | undefined;\n+  cloneWidget(widget: Widget): Promise<IDocumentWidget | undefined>;\n \n   /**\n    * Close all of the open documents.\n@@ -153,7 +153,7 @@ export interface IDocumentManager extends IDisposable {\n     path: string,\n     widgetName?: string,\n     kernel?: Partial<Kernel.IModel>\n-  ): Widget | undefined;\n+  ): Promise<Widget | undefined>;\n \n   /**\n    * Delete a file.\n@@ -223,7 +223,7 @@ export interface IDocumentManager extends IDisposable {\n     widgetName?: string,\n     kernel?: Partial<Kernel.IModel>,\n     options?: DocumentRegistry.IOpenOptions\n-  ): IDocumentWidget | undefined;\n+  ): Promise<IDocumentWidget | undefined>;\n \n   /**\n    * Open a file and return the widget used to view it.\n@@ -246,7 +246,7 @@ export interface IDocumentManager extends IDisposable {\n     widgetName?: string,\n     kernel?: Partial<Kernel.IModel>,\n     options?: DocumentRegistry.IOpenOptions\n-  ): IDocumentWidget | undefined;\n+  ): Promise<IDocumentWidget | undefined>;\n \n   /**\n    * Overwrite a file.\n\ndiff --git a/packages/docmanager/src/widgetmanager.ts b/packages/docmanager/src/widgetmanager.ts\nindex c5d3bf385db7..17783a2212fd 100644\n--- a/packages/docmanager/src/widgetmanager.ts\n+++ b/packages/docmanager/src/widgetmanager.ts\n@@ -93,11 +93,11 @@ export class DocumentWidgetManager implements IDisposable {\n    *\n    * @throws If the factory is not registered.\n    */\n-  createWidget(\n+  async createWidget(\n     factory: DocumentRegistry.WidgetFactory,\n     context: DocumentRegistry.Context\n-  ): IDocumentWidget {\n-    const widget = factory.createNew(context);\n+  ): Promise<IDocumentWidget> {\n+    const widget = await Promise.resolve(factory.createNew(context));\n     this._initializeWidget(widget, factory, context);\n     return widget;\n   }\n@@ -204,7 +204,7 @@ export class DocumentWidgetManager implements IDisposable {\n    *  Uses the same widget factory and context as the source, or throws\n    *  if the source widget is not managed by this manager.\n    */\n-  cloneWidget(widget: Widget): IDocumentWidget | undefined {\n+  async cloneWidget(widget: Widget): Promise<IDocumentWidget | undefined> {\n     const context = Private.contextProperty.get(widget);\n     if (!context) {\n       return undefined;\n@@ -213,7 +213,9 @@ export class DocumentWidgetManager implements IDisposable {\n     if (!factory) {\n       return undefined;\n     }\n-    const newWidget = factory.createNew(context, widget as IDocumentWidget);\n+    const newWidget = await Promise.resolve(\n+      factory.createNew(context, widget as IDocumentWidget)\n+    );\n     this._initializeWidget(newWidget, factory, context);\n     return newWidget;\n   }\n\ndiff --git a/packages/docregistry/src/registry.ts b/packages/docregistry/src/registry.ts\nindex ca9049af5a5a..9031b719bf23 100644\n--- a/packages/docregistry/src/registry.ts\n+++ b/packages/docregistry/src/registry.ts\n@@ -5,6 +5,7 @@ import { ISessionContext, ToolbarRegistry } from '@jupyterlab/apputils';\n import { CodeEditor } from '@jupyterlab/codeeditor';\n import {\n   IChangedArgs as IChangedArgsGeneric,\n+  IEntrypoint,\n   PathExt\n } from '@jupyterlab/coreutils';\n import { IObservableList } from '@jupyterlab/observables';\n@@ -61,6 +62,17 @@ export class DocumentRegistry implements IDisposable {\n       };\n       this._fileTypes.push(value);\n     });\n+\n+    const entrypoints = options.entrypoints;\n+    if (entrypoints) {\n+      for (const entrypoint of entrypoints.widgetFactory) {\n+        const factory = new DummyWidgetFactory({\n+          ...entrypoint,\n+          documentRegistry: this\n+        });\n+        this.addWidgetFactory(factory);\n+      }\n+    }\n   }\n \n   /**\n@@ -117,10 +129,13 @@ export class DocumentRegistry implements IDisposable {\n    */\n   addWidgetFactory(factory: DocumentRegistry.WidgetFactory): IDisposable {\n     const name = factory.name.toLowerCase();\n+    const oldFactory = this._widgetFactories[name];\n+    const isDummyFactory =\n+      oldFactory && oldFactory instanceof DummyWidgetFactory;\n     if (!name || name === 'default') {\n       throw Error('Invalid factory name');\n     }\n-    if (this._widgetFactories[name]) {\n+    if (this._widgetFactories[name] && !isDummyFactory) {\n       console.warn(`Duplicate registered factory ${name}`);\n       return new DisposableDelegate(Private.noOp);\n     }\n@@ -365,7 +380,6 @@ export class DocumentRegistry implements IDisposable {\n \n     // Get the ordered matching file types.\n     const fts = this.getFileTypesForPath(PathExt.basename(path));\n-\n     // Start with any user overrides for the defaults.\n     fts.forEach(ft => {\n       if (ft.name in this._defaultWidgetFactoryOverrides) {\n@@ -445,7 +459,6 @@ export class DocumentRegistry implements IDisposable {\n     const ftNames = this.getFileTypesForPath(PathExt.basename(path)).map(\n       ft => ft.name\n     );\n-\n     // Start with any user overrides for the defaults.\n     for (const name in ftNames) {\n       if (name in this._defaultWidgetFactoryOverrides) {\n@@ -789,6 +802,11 @@ export namespace DocumentRegistry {\n      * The application language translator.\n      */\n     translator?: ITranslator;\n+\n+    /**\n+     * Document registry entry points.\n+     */\n+    entrypoints?: Record<string, IEntrypoint[]>;\n   }\n \n   /**\n@@ -1144,7 +1162,7 @@ export namespace DocumentRegistry {\n      * #### Notes\n      * It should emit the [widgetCreated] signal with the new widget.\n      */\n-    createNew(context: IContext<U>, source?: T): T;\n+    createNew(context: IContext<U>, source?: T): T | Promise<T>;\n   }\n \n   /**\n@@ -1591,3 +1609,43 @@ namespace Private {\n     /* no-op */\n   }\n }\n+\n+class DummyWidgetFactory\n+  implements\n+    DocumentRegistry.IWidgetFactory<\n+      IDocumentWidget<Widget, DocumentRegistry.IModel>,\n+      DocumentRegistry.IModel\n+    >\n+{\n+  constructor(options: any) {\n+    this.activate = options.activate;\n+    this.documentRegistry = options.documentRegistry;\n+    this.fileTypes = options.data.fileTypes;\n+    this.name = options.data.name;\n+    this.widgetCreated = new Signal(this);\n+    this.isDisposed = false;\n+    this.dispose = () => {\n+      this.isDisposed = true;\n+    };\n+    this.defaultFor = options.data.defaultFor;\n+  }\n+\n+  // @ts-ignore\n+  async createNew(context, source): Promise<IDocumentWidget<Widget>> {\n+    await this.activate();\n+    const factory = this.documentRegistry.getWidgetFactory(this.name);\n+    if (!factory) {\n+      throw Error(`Cannot find widget factory ${this.name}`);\n+    }\n+    return factory.createNew(context, source);\n+  }\n+\n+  private activate: () => Promise<void>;\n+  private documentRegistry: DocumentRegistry;\n+  fileTypes: string[];\n+  widgetCreated: Signal<this, any>;\n+  isDisposed: boolean;\n+  dispose: () => void;\n+  name: string;\n+  defaultFor?: readonly string[] | undefined;\n+}\n\ndiff --git a/packages/filebrowser/src/listing.ts b/packages/filebrowser/src/listing.ts\nindex 2ec90b0c5e78..b5221d3ab136 100644\n--- a/packages/filebrowser/src/listing.ts\n+++ b/packages/filebrowser/src/listing.ts\n@@ -1212,7 +1212,7 @@ export class DirListing extends Widget {\n         );\n     } else {\n       const path = item.path;\n-      this._manager.openOrReveal(path);\n+      this._manager.openOrReveal(path).catch(console.error);\n     }\n   }\n \n@@ -1706,31 +1706,31 @@ export class DirListing extends Widget {\n \n     if (item && item.type !== 'directory') {\n       const otherPaths = selectedPaths.slice(1).reverse();\n-      this._drag.mimeData.setData(FACTORY_MIME, () => {\n+      this._drag.mimeData.setData(FACTORY_MIME, async () => {\n         if (!item) {\n           return;\n         }\n         const path = item.path;\n         let widget = this._manager.findWidget(path);\n         if (!widget) {\n-          widget = this._manager.open(item.path);\n+          widget = await this._manager.open(item.path);\n         }\n         if (otherPaths.length) {\n           const firstWidgetPlaced = new PromiseDelegate<void>();\n           void firstWidgetPlaced.promise.then(() => {\n             let prevWidget = widget;\n-            otherPaths.forEach(path => {\n+            otherPaths.forEach(async path => {\n               const options: DocumentRegistry.IOpenOptions = {\n                 ref: prevWidget?.id,\n                 mode: 'tab-after'\n               };\n-              prevWidget = this._manager.openOrReveal(\n+              prevWidget = await this._manager.openOrReveal(\n                 path,\n                 void 0,\n                 void 0,\n                 options\n               );\n-              this._manager.openOrReveal(item!.path);\n+              this._manager.openOrReveal(item!.path).catch(console.error);\n             });\n           });\n           firstWidgetPlaced.resolve(void 0);\n\ndiff --git a/packages/rendermime-extension/src/index.ts b/packages/rendermime-extension/src/index.ts\nindex b1e8a0332861..ab4985a5394b 100644\n--- a/packages/rendermime-extension/src/index.ts\n+++ b/packages/rendermime-extension/src/index.ts\n@@ -93,13 +93,14 @@ function activate(\n             // if applicable.\n             const factory =\n               docManager.registry.defaultRenderedWidgetFactory(path);\n-            const widget = docManager.openOrReveal(path, factory.name);\n-\n-            // Handle the hash if one has been provided.\n-            if (widget && id) {\n-              widget.setFragment(id);\n-            }\n-          });\n+            return docManager.openOrReveal(path, factory.name).then(widget => {\n+              // Handle the hash if one has been provided.\n+              if (widget && id) {\n+                widget.setFragment(id);\n+              }\n+            });\n+          })\n+          .catch(console.error);\n       }\n     });\n   }\n",
    "test_patch": "diff --git a/packages/docmanager/test/manager.spec.ts b/packages/docmanager/test/manager.spec.ts\nindex a321ff802732..b414f5de7280 100644\n--- a/packages/docmanager/test/manager.spec.ts\n+++ b/packages/docmanager/test/manager.spec.ts\n@@ -137,7 +137,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.open(model.path)!;\n+        widget = (await manager.open(model.path))!;\n         expect(widget.hasClass('WidgetFactory')).toBe(true);\n         await dismissDialog();\n       });\n@@ -153,7 +153,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'test'\n         });\n         const id = session.kernel!.id;\n-        widget = manager.open(session.path, 'default', { id })!;\n+        widget = (await manager.open(session.path, 'default', { id }))!;\n         context = manager.contextForWidget(widget)!;\n         await context.ready;\n         await context.sessionContext.ready;\n@@ -166,7 +166,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.open(model.path, 'default')!;\n+        widget = (await manager.open(model.path, 'default'))!;\n         context = manager.contextForWidget(widget)!;\n         await dismissDialog();\n         expect(context.sessionContext.session?.kernel).toBeFalsy();\n@@ -177,7 +177,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.open(model.path, 'foo');\n+        widget = await manager.open(model.path, 'foo');\n         expect(widget).toBeUndefined();\n       });\n \n@@ -192,7 +192,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.open(model.path, 'foo');\n+        widget = await manager.open(model.path, 'foo');\n         expect(widget).toBeUndefined();\n       });\n     });\n@@ -203,7 +203,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path)!;\n+        widget = (await manager.createNew(model.path))!;\n         expect(widget.hasClass('WidgetFactory')).toBe(true);\n         await dismissDialog();\n       });\n@@ -219,7 +219,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'test'\n         });\n         const id = session.kernel!.id;\n-        widget = manager.createNew(session.path, 'default', { id })!;\n+        widget = (await manager.createNew(session.path, 'default', { id }))!;\n         context = manager.contextForWidget(widget)!;\n         await context.ready;\n         await context.sessionContext.ready;\n@@ -232,7 +232,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path, 'default')!;\n+        widget = (await manager.createNew(model.path, 'default'))!;\n         context = manager.contextForWidget(widget)!;\n         await dismissDialog();\n         expect(context.sessionContext.session?.kernel).toBeFalsy();\n@@ -243,7 +243,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path, 'foo');\n+        widget = await manager.createNew(model.path, 'foo');\n         expect(widget).toBeUndefined();\n       });\n \n@@ -258,7 +258,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path, 'foo');\n+        widget = await manager.createNew(model.path, 'foo');\n         expect(widget).toBeUndefined();\n       });\n     });\n@@ -269,7 +269,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path);\n+        widget = await manager.createNew(model.path);\n         expect(manager.findWidget(model.path, 'test')).toBe(widget);\n         await dismissDialog();\n       });\n@@ -279,7 +279,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path);\n+        widget = await manager.createNew(model.path);\n         expect(manager.findWidget(model.path)).toBe(widget);\n         await dismissDialog();\n       });\n@@ -298,7 +298,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path, 'test2');\n+        widget = await manager.createNew(model.path, 'test2');\n         expect(manager.findWidget(model.path)).toBeUndefined();\n       });\n \n@@ -312,7 +312,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path, 'test2');\n+        widget = await manager.createNew(model.path, 'test2');\n         expect(manager.findWidget(model.path, null)).toBe(widget);\n         await dismissDialog();\n       });\n@@ -324,7 +324,7 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path)!;\n+        widget = (await manager.createNew(model.path))!;\n         context = manager.contextForWidget(widget)!;\n         expect(context.path).toBe(model.path);\n         await dismissDialog();\n@@ -342,33 +342,35 @@ describe('@jupyterlab/docmanager', () => {\n           type: 'file',\n           ext: '.txt'\n         });\n-        widget = manager.createNew(model.path)!;\n-        const clone = manager.cloneWidget(widget)!;\n+        widget = (await manager.createNew(model.path))!;\n+        const clone = (await manager.cloneWidget(widget))!;\n         expect(manager.contextForWidget(widget)).toBe(\n           manager.contextForWidget(clone)\n         );\n         await dismissDialog();\n       });\n \n-      it('should return undefined if the source widget is not managed', () => {\n+      it('should return undefined if the source widget is not managed', async () => {\n         widget = new Widget();\n-        expect(manager.cloneWidget(widget)).toBeUndefined();\n+        const clonedWidget = await manager.cloneWidget(widget);\n+        expect(clonedWidget).toBeUndefined();\n       });\n \n-      it('should allow widget factories to have custom clone behavior', () => {\n-        widget = manager.createNew('foo', 'CloneTestWidget')!;\n-        const clonedWidget: CloneTestWidget = manager.cloneWidget(\n+      it('should allow widget factories to have custom clone behavior', async () => {\n+        widget = (await manager.createNew('foo', 'CloneTestWidget'))!;\n+        const clonedWidget: CloneTestWidget = (await manager.cloneWidget(\n           widget\n-        ) as CloneTestWidget;\n+        )) as CloneTestWidget;\n         expect(clonedWidget.counter).toBe(1);\n-        const newWidget: CloneTestWidget = manager.createNew(\n+        const newWidget: CloneTestWidget = (await manager.createNew(\n           'bar',\n           'CloneTestWidget'\n-        ) as CloneTestWidget;\n+        )) as CloneTestWidget;\n         expect(newWidget.counter).toBe(0);\n-        expect(\n-          (manager.cloneWidget(clonedWidget) as CloneTestWidget).counter\n-        ).toBe(2);\n+        const newClonedWidget = (await manager.cloneWidget(\n+          clonedWidget\n+        )) as CloneTestWidget;\n+        expect(newClonedWidget.counter).toBe(2);\n       });\n     });\n \n@@ -381,8 +383,8 @@ describe('@jupyterlab/docmanager', () => {\n           ext: '.txt'\n         });\n         path = model.path;\n-        widget = manager.createNew(path)!;\n-        const clone = manager.cloneWidget(widget)!;\n+        widget = (await manager.createNew(path))!;\n+        const clone = (await manager.cloneWidget(widget))!;\n \n         widget.disposed.connect(() => {\n           called++;\n@@ -409,12 +411,12 @@ describe('@jupyterlab/docmanager', () => {\n           ext: '.txt'\n         });\n         path = model.path;\n-        const widget0 = manager.createNew(path)!;\n+        const widget0 = (await manager.createNew(path))!;\n         widget0.disposed.connect(() => {\n           called++;\n         });\n         await dismissDialog();\n-        const widget1 = manager.createNew(path)!;\n+        const widget1 = (await manager.createNew(path))!;\n         widget1.disposed.connect(() => {\n           called++;\n         });\n\ndiff --git a/packages/docmanager/test/widgetmanager.spec.ts b/packages/docmanager/test/widgetmanager.spec.ts\nindex 595672d27150..7a4b99e120da 100644\n--- a/packages/docmanager/test/widgetmanager.spec.ts\n+++ b/packages/docmanager/test/widgetmanager.spec.ts\n@@ -108,19 +108,19 @@ describe('@jupyterlab/docmanager', () => {\n     });\n \n     describe('#createWidget()', () => {\n-      it('should create a widget', () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n+      it('should create a widget', async () => {\n+        const widget = await manager.createWidget(widgetFactory, context);\n \n         expect(widget).toBeInstanceOf(Widget);\n       });\n \n-      it('should emit the widgetCreated signal', () => {\n+      it('should emit the widgetCreated signal', async () => {\n         let called = false;\n \n         widgetFactory.widgetCreated.connect(() => {\n           called = true;\n         });\n-        manager.createWidget(widgetFactory, context);\n+        await manager.createWidget(widgetFactory, context);\n         expect(called).toBe(true);\n       });\n     });\n@@ -155,9 +155,8 @@ describe('@jupyterlab/docmanager', () => {\n     });\n \n     describe('#findWidget()', () => {\n-      it('should find a registered widget', () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n-\n+      it('should find a registered widget', async () => {\n+        const widget = await manager.createWidget(widgetFactory, context);\n         expect(manager.findWidget(context, 'test')).toBe(widget);\n       });\n \n@@ -167,8 +166,8 @@ describe('@jupyterlab/docmanager', () => {\n     });\n \n     describe('#contextForWidget()', () => {\n-      it('should return the context for a widget', () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n+      it('should return the context for a widget', async () => {\n+        const widget = await manager.createWidget(widgetFactory, context);\n \n         expect(manager.contextForWidget(widget)).toBe(context);\n       });\n@@ -179,24 +178,25 @@ describe('@jupyterlab/docmanager', () => {\n     });\n \n     describe('#cloneWidget()', () => {\n-      it('should create a new widget with the same context using the same factory', () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n-        const clone = manager.cloneWidget(widget)!;\n+      it('should create a new widget with the same context using the same factory', async () => {\n+        const widget = await manager.createWidget(widgetFactory, context);\n+        const clone = (await manager.cloneWidget(widget))!;\n \n         expect(clone.hasClass('WidgetFactory')).toBe(true);\n         expect(clone.hasClass('jp-Document')).toBe(true);\n         expect(manager.contextForWidget(clone)).toBe(context);\n       });\n \n-      it('should return undefined if the source widget is not managed', () => {\n-        expect(manager.cloneWidget(new Widget())).toBeUndefined();\n+      it('should return undefined if the source widget is not managed', async () => {\n+        const clonedWidget = await manager.cloneWidget(new Widget());\n+        expect(clonedWidget).toBeUndefined();\n       });\n     });\n \n     describe('#closeWidgets()', () => {\n       it('should close all of the widgets associated with a context', async () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n-        const clone = manager.cloneWidget(widget)!;\n+        const widget = await manager.createWidget(widgetFactory, context);\n+        const clone = (await manager.cloneWidget(widget))!;\n \n         await manager.closeWidgets(context);\n         expect(widget.isDisposed).toBe(true);\n@@ -216,15 +216,15 @@ describe('@jupyterlab/docmanager', () => {\n         );\n       });\n \n-      it('should return false for close-request messages', () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n+      it('should return false for close-request messages', async () => {\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const msg = new Message('close-request');\n \n         expect(manager.messageHook(widget, msg)).toBe(false);\n       });\n \n-      it('should return true for other messages', () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n+      it('should return true for other messages', async () => {\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const msg = new Message('foo');\n \n         expect(manager.messageHook(widget, msg)).toBe(true);\n@@ -235,7 +235,7 @@ describe('@jupyterlab/docmanager', () => {\n       it('should set the title of the widget', async () => {\n         await context.initialize(true);\n \n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const delegate = new PromiseDelegate();\n \n         widget.title.changed.connect(async () => {\n@@ -252,7 +252,7 @@ describe('@jupyterlab/docmanager', () => {\n \n     describe('#onClose()', () => {\n       it('should be called when a widget is closed', async () => {\n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const delegate = new PromiseDelegate();\n \n         widget.disposed.connect(async () => {\n@@ -266,7 +266,7 @@ describe('@jupyterlab/docmanager', () => {\n \n       it('should ask confirmation when a widget is closing', async () => {\n         manager.confirmClosingDocument = true;\n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n \n         widget.close();\n         await dismissDialog();\n@@ -277,7 +277,7 @@ describe('@jupyterlab/docmanager', () => {\n \n       it('should confirm widget close action', async () => {\n         manager.confirmClosingDocument = true;\n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const delegate = new PromiseDelegate();\n \n         widget.close();\n@@ -294,7 +294,7 @@ describe('@jupyterlab/docmanager', () => {\n         // Populate the model with content.\n         context.model.fromString('foo');\n \n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const closed = manager.onClose(widget);\n \n         await Promise.all([dangerDialog(), closed]);\n@@ -306,7 +306,7 @@ describe('@jupyterlab/docmanager', () => {\n         manager.confirmClosingDocument = true;\n         context.model.fromString('foo');\n \n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const closed = manager.onClose(widget);\n \n         await Promise.all([dangerDialog(), closed]);\n@@ -315,7 +315,7 @@ describe('@jupyterlab/docmanager', () => {\n       });\n \n       it('should not prompt if the factory is readonly', async () => {\n-        const readonly = manager.createWidget(readOnlyFactory, context);\n+        const readonly = await manager.createWidget(readOnlyFactory, context);\n \n         await manager.onClose(readonly);\n \n@@ -326,8 +326,8 @@ describe('@jupyterlab/docmanager', () => {\n         // Populate the model with content.\n         context.model.fromString('foo');\n \n-        const one = manager.createWidget(widgetFactory, context);\n-        const two = manager.createWidget(widgetFactory, context);\n+        const one = await manager.createWidget(widgetFactory, context);\n+        const two = await manager.createWidget(widgetFactory, context);\n \n         await manager.onClose(one);\n \n@@ -340,8 +340,8 @@ describe('@jupyterlab/docmanager', () => {\n         // Populate the model with content.\n         context.model.fromString('foo');\n \n-        const writable = manager.createWidget(widgetFactory, context);\n-        const readonly = manager.createWidget(readOnlyFactory, context);\n+        const writable = await manager.createWidget(widgetFactory, context);\n+        const readonly = await manager.createWidget(readOnlyFactory, context);\n         const closed = manager.onClose(writable);\n \n         await dangerDialog();\n@@ -354,7 +354,7 @@ describe('@jupyterlab/docmanager', () => {\n \n       it('should close the widget', async () => {\n         context.model.fromString('foo');\n-        const widget = manager.createWidget(widgetFactory, context);\n+        const widget = await manager.createWidget(widgetFactory, context);\n         const promise = manager.onClose(widget);\n         await dismissDialog();\n         await promise;\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16584",
    "pr_id": 16584,
    "issue_id": 16583,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Wrong format when trying to download licenses in JSON format\nHi! ðŸ‘‹ \r\n\r\n## Description\r\n\r\nWhen trying to download the licenses available on the Licenses page in JSON format, I got a CSV file. If I'm correct, the format (`id`) is incorrectly specified for this option: https://github.com/jupyterlab/jupyterlab/blob/7bae8e3238967a0a776028150b49a4903759bc90/packages/help-extension/src/licenses.tsx#L171-L190\r\n\r\n## Reproduce\r\n\r\n1. Go to _Help_ > _Licenses_ in the top menu.\r\n2. Press the `Download All Licenses as JSON` button in the toolbar (it's the rightmost button).\r\n3. Check the exported `jupyterlab-licenses.csv` file\r\n\r\n<img width=\"1582\" alt=\"image\" src=\"https://github.com/user-attachments/assets/95fefccd-c1a2-4f72-97d9-332be75d8152\">\r\n\r\n<img width=\"1582\" alt=\"image\" src=\"https://github.com/user-attachments/assets/8755962a-6e47-4ab4-8277-a3e7fc9ba952\">\r\n\r\n## Expected behavior\r\n\r\nGet a JSON file instead of a CSV file.\r\n\r\n## Context\r\n\r\n- Operating System and version: macOS Sonoma 14.5\r\n- Browser and version: Chrome 126.0.6478.127\r\n- JupyterLab version: 4.3.0a2\r\n- Python version: 3.10.13\r\n\r\nLet me know what you think and if I can open a PR. Thanks!",
    "issue_word_count": 180,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/help.test.ts",
      "galata/test/jupyterlab/utils.ts",
      "packages/help-extension/src/licenses.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/help.test.ts",
      "galata/test/jupyterlab/utils.ts"
    ],
    "base_commit": "7bae8e3238967a0a776028150b49a4903759bc90",
    "head_commit": "0ef37c7c2d044a4bee82b365681423056bb903e1",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16584",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16584",
    "dockerfile": "",
    "pr_merged_at": "2024-07-16T08:54:20.000Z",
    "patch": "diff --git a/packages/help-extension/src/licenses.tsx b/packages/help-extension/src/licenses.tsx\nindex 411a16817710..cca126d1beb0 100644\n--- a/packages/help-extension/src/licenses.tsx\n+++ b/packages/help-extension/src/licenses.tsx\n@@ -183,7 +183,7 @@ export namespace Licenses {\n       icon: spreadsheetIcon\n     },\n     json: {\n-      id: 'csv',\n+      id: 'json',\n       title: 'JSON',\n       icon: jsonIcon\n     }\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/help.test.ts b/galata/test/jupyterlab/help.test.ts\nindex 75d12f315b86..0afcc0735b35 100644\n--- a/galata/test/jupyterlab/help.test.ts\n+++ b/galata/test/jupyterlab/help.test.ts\n@@ -4,6 +4,23 @@\n  */\n \n import { expect, test } from '@jupyterlab/galata';\n+import { readFile } from 'fs/promises';\n+\n+import { isBlank, isValidJSON } from './utils';\n+\n+const licenseFormats = [\n+  {\n+    name: 'Markdown',\n+    extension: 'md',\n+    validation: (value: string) => !isBlank(value)\n+  },\n+  {\n+    name: 'CSV',\n+    extension: 'csv',\n+    validation: (value: string) => !isBlank(value)\n+  },\n+  { name: 'JSON', extension: 'json', validation: isValidJSON }\n+];\n \n test('Switch back and forth to reference page', async ({ page }) => {\n   // The goal is to test switching back and forth with a tab containing an iframe\n@@ -30,3 +47,29 @@ test('Switch back and forth to reference page', async ({ page }) => {\n     page.locator('.jp-MarkdownCell .jp-InputArea-editor')\n   ).toHaveText(cellContent);\n });\n+\n+test.describe('Licenses', () => {\n+  licenseFormats.forEach(licenseFormat => {\n+    test(`Exporting licenses as ${licenseFormat.name} must download a ${licenseFormat.name} file`, async ({\n+      page\n+    }) => {\n+      await page.menu.clickMenuItem('Help>Licenses');\n+\n+      const downloadPromise = page.waitForEvent('download');\n+      await page\n+        .getByRole('button', {\n+          name: `Download All Licenses as ${licenseFormat.name}`\n+        })\n+        .click();\n+      const download = await downloadPromise;\n+\n+      const fileName = download.suggestedFilename();\n+      const fileContent = await readFile(await download.path(), {\n+        encoding: 'utf8'\n+      });\n+\n+      expect(fileName).toBe(`jupyterlab-licenses.${licenseFormat.extension}`);\n+      expect(licenseFormat.validation(fileContent)).toBeTruthy();\n+    });\n+  });\n+});\n\ndiff --git a/galata/test/jupyterlab/utils.ts b/galata/test/jupyterlab/utils.ts\nindex 2e455e254c8c..d4606f55cd92 100644\n--- a/galata/test/jupyterlab/utils.ts\n+++ b/galata/test/jupyterlab/utils.ts\n@@ -73,3 +73,22 @@ export async function dragCellTo(\n   await page.waitForCondition(options.stopCondition);\n   await page.mouse.up();\n }\n+\n+/**\n+ * Check if a given string value is valid JSON.\n+ */\n+export function isValidJSON(value: string): boolean {\n+  try {\n+    JSON.parse(value);\n+    return true;\n+  } catch (e) {\n+    return false;\n+  }\n+}\n+\n+/**\n+ * Check if a given string value is empty (excluding spaces).\n+ */\n+export function isBlank(value: string): boolean {\n+  return value.trim().length === 0;\n+}\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16566",
    "pr_id": 16566,
    "issue_id": 14235,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Placeholder for property inspector should be consistent with TOC\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nFollow up to #13988. See also #14234.\r\n\r\nThe new TOC placeholder has a headline and explanation in gray text near the top of the pane. The property inspector displays a placeholder in black text, centered vertically, with no headline.\r\n\r\n![image](https://user-images.githubusercontent.com/93281816/226477711-1fbdfb70-9db1-49d8-b7d0-a084d2bad69c.png)\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Create a new Markdown file.\r\n2. Open property inspector.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\nProperty inspector placeholder uses similar styling to TOC placeholder, including alignment and sizing of text.\r\n",
    "issue_word_count": 156,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-property-inspector-jupyterlab-linux.png",
      "packages/property-inspector/src/index.ts",
      "packages/property-inspector/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-property-inspector-jupyterlab-linux.png"
    ],
    "base_commit": "c4490110093280be3a2859749fb6b5675df3c0f2",
    "head_commit": "1fac5b8f8125b40d6634473fb7b623d8c1d80c4a",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16566",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16566",
    "dockerfile": "",
    "pr_merged_at": "2024-07-10T14:38:50.000Z",
    "patch": "diff --git a/packages/property-inspector/src/index.ts b/packages/property-inspector/src/index.ts\nindex bc9fced68b7b..698566f42941 100644\n--- a/packages/property-inspector/src/index.ts\n+++ b/packages/property-inspector/src/index.ts\n@@ -186,8 +186,15 @@ export class SideBarPropertyInspectorProvider extends PropertyInspectorProvider\n     } else {\n       const node = document.createElement('div');\n       const content = document.createElement('div');\n-      content.textContent = this._trans.__('No properties to inspect.');\n+      const placeholderHeadline = document.createElement('h3');\n+      const placeholderText = document.createElement('p');\n+      placeholderHeadline.textContent = this._trans.__('No Properties');\n+      placeholderText.textContent = this._trans.__(\n+        'The property inspector allows to view and edit properties of a selected notebook.'\n+      );\n       content.className = 'jp-PropertyInspector-placeholderContent';\n+      content.appendChild(placeholderHeadline);\n+      content.appendChild(placeholderText);\n       node.appendChild(content);\n       this._placeholder = new Widget({ node });\n       this._placeholder.addClass('jp-PropertyInspector-placeholder');\n\ndiff --git a/packages/property-inspector/style/base.css b/packages/property-inspector/style/base.css\nindex 06e3dddfb199..abd26f09d06f 100644\n--- a/packages/property-inspector/style/base.css\n+++ b/packages/property-inspector/style/base.css\n@@ -14,11 +14,14 @@\n }\n \n .jp-PropertyInspector-placeholder {\n-  display: flex;\n-  align-items: center;\n-  justify-content: center;\n+  text-align: center;\n }\n \n .jp-PropertyInspector-placeholderContent {\n+  color: var(--jp-content-font-color2);\n   padding: 8px;\n }\n+\n+.jp-PropertyInspector-placeholderContent > h3 {\n+  margin-bottom: var(--jp-content-heading-margin-bottom);\n+}\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-property-inspector-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-property-inspector-jupyterlab-linux.png\nindex d5e1350c6d27..1620b06d0b59 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-property-inspector-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-property-inspector-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16565",
    "pr_id": 16565,
    "issue_id": 16065,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Consider adding additional shortcut for accepting inline completions\n### Problem\r\n\r\nCurrently inline completions are accepted using <kbd>Alt</kbd> + <kbd>End</kbd>.\r\n\r\nProblems:\r\n- this shortcut is not very convenient to use (<kbd>Alt</kbd> and <kbd>End</kbd> are far away on most keyboards)\r\n- other applications use a different shortcut\r\n\r\nDesign constraints:\r\n-  using just <kbd>End</kbd> or just <kbd>â†’</kbd> is not desirable as these would interfere with the native cursor movement behaviour\r\n- ideally there would be a natural variant of the shortcut for partial acceptance (https://github.com/jupyterlab/jupyterlab/issues/15531); for example if the \"accept all\" is <kbd>Ctrl</kbd>+<kbd>â†’</kbd>, we could use <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>â†’</kbd> for word-by-word acceptance (there are also line-by-line and character-by-character options)\r\n- the shortcut should be intuitive to the users coming from other applications:\r\n   - fish uses:\r\n      - <kbd>End</kbd> or <kbd>â†’</kbd> for full acceptance\r\n      - <kbd>Alt</kbd>+<kbd>â†’</kbd> or <kbd>Alt</kbd>+<kbd>F</kbd> for word-by-word\r\n   - IPython uses:\r\n       - <kbd>End</kbd> or <kbd>Ctrl</kbd>+<kbd>F</kbd> for full acceptance\r\n       - <kbd>Alt</kbd>+<kbd>F</kbd> for word-by-word\r\n       - <kbd>Ctrl</kbd>+<kbd>â†’</kbd> for token-by-token (word-by-word but with a better implementation)\r\n       - <kbd>Alt</kbd>+<kbd>â†’</kbd> for character-by-character\r\n    - Copilot uses:\r\n       - <kbd>Tab</kbd> for full acceptance\r\n       - <kbd>Ctrl</kbd>+<kbd>â†’</kbd> for word-by-word\r\n- using <kbd>Tab</kbd> might be surprising because we use it to invoke completer\r\n- the shortcut should ideally not interfere with any browser or OS shortcuts\r\n\r\n### Proposed Solution\r\n\r\nAdd a default shortcut other than <kbd>Alt</kbd> + <kbd>End</kbd> for accepting the inline suggestion.\r\n\r\n### Additional context\r\n\r\nWe can keep <kbd>Alt</kbd> + <kbd>End</kbd> to avoid breaking the experience of users that got used to it (we can have multiple shortcuts here).",
    "issue_word_count": 313,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png",
      "packages/completer-extension/schema/inline-completer.json"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png"
    ],
    "base_commit": "f7ca6ad67e178995a70883ae284ecf5a7efd3d85",
    "head_commit": "b4955587ebc8a27d0b45229130d7449965f22f20",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16565",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16565",
    "dockerfile": "",
    "pr_merged_at": "2024-08-28T14:42:06.000Z",
    "patch": "diff --git a/packages/completer-extension/schema/inline-completer.json b/packages/completer-extension/schema/inline-completer.json\nindex 53f9ef54fc44..9fc42d39cdc6 100644\n--- a/packages/completer-extension/schema/inline-completer.json\n+++ b/packages/completer-extension/schema/inline-completer.json\n@@ -17,6 +17,11 @@\n       \"selector\": \".jp-mod-completer-enabled\",\n       \"preventDefault\": false\n     },\n+    {\n+      \"command\": \"inline-completer:accept\",\n+      \"keys\": [\"Tab\"],\n+      \"selector\": \".jp-mod-inline-completer-active\"\n+    },\n     {\n       \"command\": \"inline-completer:accept\",\n       \"keys\": [\"Alt End\"],\n",
    "test_patch": "diff --git a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\nindex a268c211b129..20498bf59fb5 100644\n--- a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n+++ b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n@@ -1309,7 +1309,7 @@\n     \"label\": \"Accept Inline Completion\",\n     \"caption\": \"\",\n     \"shortcuts\": [\n-      \"Alt End\"\n+      \"Tab\"\n     ]\n   },\n   {\n\ndiff --git a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png\nindex b37032fe58bd..4b871db39e28 100644\nBinary files a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png and b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16537",
    "pr_id": 16537,
    "issue_id": 601,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Esc should dismiss completer. \nAll is in the title, \n\nafter pressing tab, the completer pops-up, I think having esc dismissing the completer is something that sounds reasonable. \n\nThoughts ? \n",
    "issue_word_count": 29,
    "test_files_count": 7,
    "non_test_files_count": 93,
    "pr_changed_files": [
      ".github/workflows/linuxjs-tests.yml",
      ".github/workflows/linuxtests.yml",
      "builder/package.json",
      "dev_mode/index.js",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/federated/md_package/package.json",
      "examples/federated/middle_package/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "galata/extension/package.json",
      "galata/extension/src/global.ts",
      "galata/package.json",
      "galata/test/documentation/plugins.test.ts",
      "galata/test/jupyterlab/toolbars.test.ts",
      "jupyterlab/tests/mock_packages/interop/token/package.json",
      "jupyterlab/tests/mock_packages/mimeextension/package.json",
      "packages/application-extension/package.json",
      "packages/application/package.json",
      "packages/apputils-extension/package.json",
      "packages/apputils/package.json",
      "packages/attachments/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/celltags-extension/package.json",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer-extension/package.json",
      "packages/completer/package.json",
      "packages/console-extension/package.json",
      "packages/console/package.json",
      "packages/coreutils/package.json",
      "packages/coreutils/src/index.ts",
      "packages/coreutils/src/plugins.ts",
      "packages/csvviewer-extension/package.json",
      "packages/csvviewer-extension/src/index.ts",
      "packages/csvviewer/package.json",
      "packages/debugger/package.json",
      "packages/docmanager-extension/package.json",
      "packages/docmanager/package.json",
      "packages/docregistry/package.json",
      "packages/documentsearch-extension/package.json",
      "packages/documentsearch/package.json",
      "packages/extensionmanager/package.json",
      "packages/filebrowser-extension/package.json",
      "packages/filebrowser/package.json",
      "packages/fileeditor-extension/package.json",
      "packages/fileeditor/package.json",
      "packages/help-extension/package.json",
      "packages/htmlviewer/package.json",
      "packages/imageviewer/package.json",
      "packages/inspector-extension/package.json",
      "packages/inspector/package.json",
      "packages/json-extension/package.json",
      "packages/launcher-extension/package.json",
      "packages/launcher/package.json",
      "packages/logconsole-extension/package.json",
      "packages/logconsole/package.json",
      "packages/lsp-extension/package.json",
      "packages/lsp/package.json",
      "packages/mainmenu-extension/package.json",
      "packages/mainmenu/package.json",
      "packages/markdownviewer/package.json",
      "packages/markedparser-extension/package.json",
      "packages/mathjax-extension/package.json",
      "packages/mermaid/package.json",
      "packages/metadataform-extension/package.json",
      "packages/metadataform/package.json",
      "packages/nbformat/package.json",
      "packages/notebook-extension/package.json",
      "packages/notebook/package.json",
      "packages/observables/package.json",
      "packages/outputarea/package.json",
      "packages/pdf-extension/package.json",
      "packages/pluginmanager-extension/package.json",
      "packages/pluginmanager/package.json",
      "packages/property-inspector/package.json",
      "packages/rendermime-interfaces/package.json",
      "packages/rendermime/package.json",
      "packages/running-extension/package.json",
      "packages/running/package.json",
      "packages/services/examples/browser/package.json",
      "packages/services/package.json",
      "packages/settingeditor-extension/package.json",
      "packages/settingeditor/package.json",
      "packages/settingregistry/package.json",
      "packages/shortcuts-extension/package.json",
      "packages/statedb/package.json",
      "packages/statusbar/package.json",
      "packages/terminal-extension/package.json",
      "packages/terminal/package.json",
      "packages/testing/package.json",
      "packages/toc/package.json",
      "packages/tooltip-extension/package.json",
      "packages/tooltip/package.json",
      "packages/translation/package.json",
      "packages/ui-components/examples/simple-windowed-list/package.json",
      "packages/ui-components/package.json"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxjs-tests.yml",
      ".github/workflows/linuxtests.yml",
      "galata/test/documentation/plugins.test.ts",
      "galata/test/jupyterlab/toolbars.test.ts",
      "jupyterlab/tests/mock_packages/interop/token/package.json",
      "jupyterlab/tests/mock_packages/mimeextension/package.json",
      "packages/testing/package.json"
    ],
    "base_commit": "7512a97cf8b8ed227fec76d3489ab01a46c0bbb0",
    "head_commit": "9d4c4646389bb8302374976ca85350630f3de8e1",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16537",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16537",
    "dockerfile": "",
    "pr_merged_at": "2024-07-01T15:49:20.000Z",
    "patch": "diff --git a/builder/package.json b/builder/package.json\nindex ec72f0c3fb39..0a96f4d30c7d 100644\n--- a/builder/package.json\n+++ b/builder/package.json\n@@ -33,18 +33,18 @@\n     \"watch\": \"tsc -w --listEmittedFiles\"\n   },\n   \"dependencies\": {\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/application\": \"^2.3.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/dragdrop\": \"^2.1.4\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/application\": \"^2.4.0\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/dragdrop\": \"^2.1.5\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"ajv\": \"^8.12.0\",\n     \"commander\": \"^9.4.1\",\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/dev_mode/index.js b/dev_mode/index.js\nindex 9ad74dd92f6d..0ea232b071da 100644\n--- a/dev_mode/index.js\n+++ b/dev_mode/index.js\n@@ -3,7 +3,8 @@\n  * Distributed under the terms of the Modified BSD License.\n  */\n \n-import { PageConfig } from '@jupyterlab/coreutils';\n+import { PromiseDelegate } from '@lumino/coreutils';\n+import { PageConfig, PluginRegistry2 } from '@jupyterlab/coreutils';\n \n import './style.js';\n \n@@ -19,43 +20,46 @@ async function createModule(scope, module) {\n   }\n }\n \n+const modulesCache = new Map();\n+\n /**\n  * The main entry point for the application.\n  */\n export async function main() {\n \n-   // Handle a browser test.\n-   // Set up error handling prior to loading extensions.\n-   var browserTest = PageConfig.getOption('browserTest');\n-   if (browserTest.toLowerCase() === 'true') {\n-     var el = document.createElement('div');\n-     el.id = 'browserTest';\n-     document.body.appendChild(el);\n-     el.textContent = '[]';\n-     el.style.display = 'none';\n-     var errors = [];\n-     var reported = false;\n-     var timeout = 25000;\n-\n-     var report = function() {\n-       if (reported) {\n-         return;\n-       }\n-       reported = true;\n-       el.className = 'completed';\n-     }\n-\n-     window.onerror = function(msg, url, line, col, error) {\n-       errors.push(String(error));\n-       el.textContent = JSON.stringify(errors)\n-     };\n-     console.error = function(message) {\n-       errors.push(String(message));\n-       el.textContent = JSON.stringify(errors)\n-     };\n+  // Handle a browser test.\n+  // Set up error handling prior to loading extensions.\n+  var browserTest = PageConfig.getOption('browserTest');\n+  if (browserTest.toLowerCase() === 'true') {\n+    var el = document.createElement('div');\n+    el.id = 'browserTest';\n+    document.body.appendChild(el);\n+    el.textContent = '[]';\n+    el.style.display = 'none';\n+    var errors = [];\n+    var reported = false;\n+    var timeout = 25000;\n+\n+    var report = function() {\n+      if (reported) {\n+        return;\n+      }\n+      reported = true;\n+      el.className = 'completed';\n+    }\n+\n+    window.onerror = function(msg, url, line, col, error) {\n+      errors.push(String(error));\n+      el.textContent = JSON.stringify(errors)\n+    };\n+    console.error = function(message) {\n+      errors.push(String(message));\n+      el.textContent = JSON.stringify(errors)\n+    };\n   }\n \n-  var JupyterLab = require('@jupyterlab/application').JupyterLab;\n+  const pluginRegistry = new PluginRegistry2();\n+  var JupyterLab = (await import('@jupyterlab/application')).JupyterLab;\n   var disabled = [];\n   var deferred = [];\n   var ignorePlugins = [];\n@@ -90,34 +94,18 @@ export async function main() {\n \n   const allPlugins = [];\n \n-  /**\n-   * Iterate over active plugins in an extension.\n-   *\n-   * #### Notes\n-   * This also populates the disabled, deferred, and ignored arrays.\n-   */\n-  function* activePlugins(extension) {\n-    // Handle commonjs or es2015 modules\n-    let exports;\n-    if (extension.hasOwnProperty('__esModule')) {\n-      exports = extension.default;\n-    } else {\n-      // CommonJS exports.\n-      exports = extension;\n-    }\n-\n-    let plugins = Array.isArray(exports) ? exports : [exports];\n+  function* processPlugins(plugins, scope) {\n     for (let plugin of plugins) {\n       const isDisabled = PageConfig.Extension.isDisabled(plugin.id);\n       allPlugins.push({\n         id: plugin.id,\n         description: plugin.description,\n-        requires: plugin.requires ?? [],\n-        optional: plugin.optional ?? [],\n-        provides: plugin.provides ?? null,\n+        requires: plugin.requires ? plugin.requires.map(token => typeof token === 'string' ? { name: token } : token) : [],\n+        optional: plugin.optional ? plugin.optional.map(token => typeof token === 'string' ? { name: token } : token) : [],\n+        provides: plugin.provides ? plugin.provides : null,\n         autoStart: plugin.autoStart,\n         enabled: !isDisabled,\n-        extension: extension.__scope__\n+        extension: scope\n       });\n       if (isDisabled) {\n         disabled.push(plugin.id);\n@@ -131,6 +119,26 @@ export async function main() {\n     }\n   }\n \n+  /**\n+   * Iterate over active plugins in an extension.\n+   *\n+   * #### Notes\n+   * This also populates the disabled, deferred, and ignored arrays.\n+   */\n+  function* activePlugins(extension) {\n+    // Handle commonjs or es2015 modules\n+    let exports;\n+    if (extension.hasOwnProperty('__esModule')) {\n+      exports = extension.default;\n+    } else {\n+      // CommonJS exports.\n+      exports = extension;\n+    }\n+\n+    let plugins = Array.isArray(exports) ? exports : [exports];\n+    yield* processPlugins(plugins, extension.__scope__);\n+  }\n+\n   // Handle the registered mime extensions.\n   const mimeExtensions = [];\n   {{#each jupyterlab_mime_extensions}}\n@@ -163,10 +171,34 @@ export async function main() {\n   {{#each jupyterlab_extensions}}\n   if (!queuedFederated.includes('{{@key}}')) {\n     try {\n-      let ext = require('{{@key}}{{#if this}}/{{this}}{{/if}}');\n-      ext.__scope__ = '{{@key}}';\n-      for (let plugin of activePlugins(ext)) {\n-        register.push(plugin);\n+      const pkgJson = await import('{{@key}}/package.json');\n+\n+      const pkgPlugins = pkgJson['jupyterlab']['plugins'];\n+      if (pkgPlugins) {\n+        for(let plugin of processPlugins(pkgPlugins, '{{@key}}')) {\n+          register.push({...plugin, loader: async () => {\n+            const candidate = modulesCache.get('{{@key}}{{#if this}}/{{this}}{{/if}}');\n+            if(candidate) {\n+              return (await candidate);\n+            }\n+            const delegate = new PromiseDelegate();\n+            modulesCache.set('{{@key}}{{#if this}}/{{this}}{{/if}}', delegate.promise);\n+            console.debug('Loading {{@key}}{{#if this}}/{{this}}{{/if}}â€¦');\n+            let ext = await import('{{@key}}{{#if this}}/{{this}}{{/if}}');\n+            ext.__scope__ = '{{@key}}';\n+            delegate.resolve(ext);\n+            return ext;\n+          }})\n+        }\n+      } else {\n+        const delegate = new PromiseDelegate();\n+        modulesCache.set('{{@key}}{{#if this}}/{{this}}{{/if}}', delegate.promise);\n+        let ext = await import('{{@key}}{{#if this}}/{{this}}{{/if}}');\n+        ext.__scope__ = '{{@key}}';\n+        delegate.resolve(ext);\n+        for (let plugin of activePlugins(ext)) {\n+          register.push(plugin);\n+        }\n       }\n     } catch (e) {\n       console.error(e);\n@@ -192,6 +224,7 @@ export async function main() {\n   });\n \n   const lab = new JupyterLab({\n+    pluginRegistry,\n     mimeExtensions,\n     disabled: {\n       matches: disabled,\n@@ -205,10 +238,15 @@ export async function main() {\n     },\n     availablePlugins: allPlugins\n   });\n-  register.forEach(function(item) { lab.registerPluginModule(item); });\n+  register.forEach(function(item) { pluginRegistry.registerPlugin(item); });\n \n   lab.start({ ignorePlugins, bubblingKeydown: true });\n \n+  // FIXME to delete - for testing set csv plugin loaded at arbitrary later time\n+  // setTimeout(() => {\n+  //   pluginRegistry.activatePlugin(\"@jupyterlab/csvviewer-extension:csv\")\n+  // }, 8000)\n+\n   // Expose global app instance when in dev mode or when toggled explicitly.\n   var exposeAppInBrowser = (PageConfig.getOption('exposeAppInBrowser') || '').toLowerCase() === 'true';\n   var devMode = (PageConfig.getOption('devMode') || '').toLowerCase() === 'true';\n@@ -226,5 +264,4 @@ export async function main() {\n     // Handle failures to restore after the timeout has elapsed.\n     window.setTimeout(function() { report(errors); }, timeout);\n   }\n-\n }\n\ndiff --git a/examples/cell/package.json b/examples/cell/package.json\nindex 36639d15086f..4a6905a39569 100644\n--- a/examples/cell/package.json\n+++ b/examples/cell/package.json\n@@ -19,8 +19,8 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/theme-light-extension\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/examples/console/package.json b/examples/console/package.json\nindex fb90ca704cb3..ccc45d4139dd 100644\n--- a/examples/console/package.json\n+++ b/examples/console/package.json\n@@ -17,8 +17,8 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/theme-light-extension\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/examples/federated/md_package/package.json b/examples/federated/md_package/package.json\nindex ce6b5318ab20..60c150b3879d 100644\n--- a/examples/federated/md_package/package.json\n+++ b/examples/federated/md_package/package.json\n@@ -11,7 +11,7 @@\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/example-federated-middle\": \"^3.2.0-alpha.1\",\n     \"@jupyterlab/markdownviewer-extension\": \"^4.3.0-alpha.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.3.0-alpha.1\",\n\ndiff --git a/examples/federated/middle_package/package.json b/examples/federated/middle_package/package.json\nindex 0a19a12cfd99..5cad08ef6c80 100644\n--- a/examples/federated/middle_package/package.json\n+++ b/examples/federated/middle_package/package.json\n@@ -7,7 +7,7 @@\n     \"clean\": \"rimraf ../labextensions/@jupyterlab/example-federated-middle\"\n   },\n   \"dependencies\": {\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.3.0-alpha.1\",\n\ndiff --git a/examples/filebrowser/package.json b/examples/filebrowser/package.json\nindex 2ccbe66f0286..eb0c2fe95fbe 100644\n--- a/examples/filebrowser/package.json\n+++ b/examples/filebrowser/package.json\n@@ -20,8 +20,8 @@\n     \"@jupyterlab/theme-light-extension\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/examples/notebook/package.json b/examples/notebook/package.json\nindex 51233cdf77c8..df3a8eae12cb 100644\n--- a/examples/notebook/package.json\n+++ b/examples/notebook/package.json\n@@ -25,8 +25,8 @@\n     \"@jupyterlab/theme-light-extension\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/examples/terminal/package.json b/examples/terminal/package.json\nindex fd02accd3554..80dfbc052e85 100644\n--- a/examples/terminal/package.json\n+++ b/examples/terminal/package.json\n@@ -13,7 +13,7 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/terminal\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/theme-light-extension\": \"^4.3.0-alpha.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/galata/extension/package.json b/galata/extension/package.json\nindex e6e254ad126b..870eb875fb59 100644\n--- a/galata/extension/package.json\n+++ b/galata/extension/package.json\n@@ -40,9 +40,9 @@\n     \"@jupyterlab/nbformat\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/notebook\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/signaling\": \"^2.1.3\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.3.0-alpha.1\",\n\ndiff --git a/galata/extension/src/global.ts b/galata/extension/src/global.ts\nindex c3ee005549a9..c74635b64624 100644\n--- a/galata/extension/src/global.ts\n+++ b/galata/extension/src/global.ts\n@@ -41,28 +41,26 @@ export class GalataInpage implements IGalataInpage {\n   async getPlugin<K extends keyof IPluginNameToInterfaceMap>(\n     pluginId: K\n   ): Promise<IPluginNameToInterfaceMap[K] | undefined> {\n-    return new Promise((resolve, reject) => {\n-      const app = this._app;\n-      const hasPlugin = app.hasPlugin(pluginId);\n-\n-      if (hasPlugin) {\n-        try {\n-          const appAny = app as any;\n-          const plugin: any = appAny._plugins\n-            ? appAny._plugins.get(pluginId)\n-            : undefined;\n-          if (plugin.activated) {\n-            resolve(plugin.service);\n-          } else {\n-            void app.activatePlugin(pluginId).then(response => {\n-              resolve(plugin.service);\n-            });\n-          }\n-        } catch (error) {\n-          console.error('Failed to get plugin', error);\n+    const app = this._app;\n+    const hasPlugin = app.hasPlugin(pluginId);\n+\n+    if (hasPlugin) {\n+      try {\n+        const appAny = app as any;\n+        const plugins = appAny.pluginRegistry?._plugins ?? appAny._plugins;\n+        const plugin: any = plugins?.get(pluginId);\n+        if (!plugin) {\n+          return undefined;\n         }\n+\n+        if (!plugin.activated) {\n+          await app.activatePlugin(pluginId);\n+        }\n+        return plugin.service;\n+      } catch (error) {\n+        console.error('Failed to get plugin', error);\n       }\n-    });\n+    }\n   }\n \n   /**\n\ndiff --git a/galata/package.json b/galata/package.json\nindex 69f9dc146fbb..37e4009b5b71 100644\n--- a/galata/package.json\n+++ b/galata/package.json\n@@ -53,7 +53,7 @@\n     \"@jupyterlab/notebook\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n     \"@playwright/test\": \"^1.45.0\",\n     \"@stdlib/stats\": \"~0.0.13\",\n     \"fs-extra\": \"^10.1.0\",\n\ndiff --git a/packages/application-extension/package.json b/packages/application-extension/package.json\nindex cdd9e7618e6f..1c3fa8a73750 100644\n--- a/packages/application-extension/package.json\n+++ b/packages/application-extension/package.json\n@@ -46,11 +46,11 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/application/package.json b/packages/application/package.json\nindex 142c8f7dcbc1..b7d7fa1ddb1a 100644\n--- a/packages/application/package.json\n+++ b/packages/application/package.json\n@@ -51,16 +51,16 @@\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/application\": \"^2.3.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/application\": \"^2.4.0\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/apputils-extension/package.json b/packages/apputils-extension/package.json\nindex cf171cffcae8..b04e5203d1b2 100644\n--- a/packages/apputils-extension/package.json\n+++ b/packages/apputils-extension/package.json\n@@ -50,13 +50,13 @@\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/workspaces\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\",\n     \"react-dom\": \"^18.2.0\",\n     \"react-toastify\": \"^9.0.8\"\n\ndiff --git a/packages/apputils/package.json b/packages/apputils/package.json\nindex 3a4802aa5927..6e0ab45e19ae 100644\n--- a/packages/apputils/package.json\n+++ b/packages/apputils/package.json\n@@ -53,15 +53,15 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@types/react\": \"^18.0.26\",\n     \"react\": \"^18.2.0\",\n     \"sanitize-html\": \"~2.12.1\"\n\ndiff --git a/packages/attachments/package.json b/packages/attachments/package.json\nindex ee4f24af8d75..55eb009667fc 100644\n--- a/packages/attachments/package.json\n+++ b/packages/attachments/package.json\n@@ -40,8 +40,8 @@\n     \"@jupyterlab/observables\": \"^5.3.0-alpha.1\",\n     \"@jupyterlab/rendermime\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\"\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/cell-toolbar/package.json b/packages/cell-toolbar/package.json\nindex 1070d85214ca..4b0a6c452771 100644\n--- a/packages/cell-toolbar/package.json\n+++ b/packages/cell-toolbar/package.json\n@@ -47,11 +47,11 @@\n     \"@jupyterlab/notebook\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/observables\": \"^5.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/cells/package.json b/packages/cells/package.json\nindex 8619d3c1f571..c13c54938146 100644\n--- a/packages/cells/package.json\n+++ b/packages/cells/package.json\n@@ -60,15 +60,15 @@\n     \"@jupyterlab/toc\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/dragdrop\": \"^2.1.4\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/dragdrop\": \"^2.1.5\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/celltags-extension/package.json b/packages/celltags-extension/package.json\nindex f9d46d8ddab4..1b641ca76be3 100644\n--- a/packages/celltags-extension/package.json\n+++ b/packages/celltags-extension/package.json\n@@ -44,7 +44,7 @@\n     \"@jupyterlab/notebook\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"react\": \"^18.2.0\"\n   },\n\ndiff --git a/packages/codeeditor/package.json b/packages/codeeditor/package.json\nindex 421f03d5ec5f..c40d631c0361 100644\n--- a/packages/codeeditor/package.json\n+++ b/packages/codeeditor/package.json\n@@ -50,12 +50,12 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/dragdrop\": \"^2.1.4\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/dragdrop\": \"^2.1.5\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/codemirror-extension/package.json b/packages/codemirror-extension/package.json\nindex bfdd4ea58242..51fdc22d7695 100644\n--- a/packages/codemirror-extension/package.json\n+++ b/packages/codemirror-extension/package.json\n@@ -51,8 +51,8 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"@rjsf/validator-ajv8\": \"^5.13.4\",\n     \"react\": \"^18.2.0\"\n\ndiff --git a/packages/codemirror/package.json b/packages/codemirror/package.json\nindex 08295ae768ab..0cc4a214a5b8 100644\n--- a/packages/codemirror/package.json\n+++ b/packages/codemirror/package.json\n@@ -67,9 +67,9 @@\n     \"@lezer/generator\": \"^1.7.0\",\n     \"@lezer/highlight\": \"^1.2.0\",\n     \"@lezer/markdown\": \"^1.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"yjs\": \"^13.5.40\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/completer-extension/package.json b/packages/completer-extension/package.json\nindex 88c34e38a204..290a080478ec 100644\n--- a/packages/completer-extension/package.json\n+++ b/packages/completer-extension/package.json\n@@ -42,8 +42,8 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"react\": \"^18.2.0\"\n   },\n\ndiff --git a/packages/completer/package.json b/packages/completer/package.json\nindex 16f2d750a408..7c2116fe6c09 100644\n--- a/packages/completer/package.json\n+++ b/packages/completer/package.json\n@@ -58,13 +58,13 @@\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/console-extension/package.json b/packages/console-extension/package.json\nindex bc891010d961..442549f2baaf 100644\n--- a/packages/console-extension/package.json\n+++ b/packages/console-extension/package.json\n@@ -49,11 +49,11 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/console/package.json b/packages/console/package.json\nindex 0aeb7b08f093..dc6cb6548d69 100644\n--- a/packages/console/package.json\n+++ b/packages/console/package.json\n@@ -53,12 +53,12 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/dragdrop\": \"^2.1.4\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/dragdrop\": \"^2.1.5\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/coreutils/package.json b/packages/coreutils/package.json\nindex 0c4a7efc64ee..67bf734c1c70 100644\n--- a/packages/coreutils/package.json\n+++ b/packages/coreutils/package.json\n@@ -39,9 +39,10 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"minimist\": \"~1.2.0\",\n     \"path-browserify\": \"^1.0.0\",\n     \"url-parse\": \"~1.5.4\"\n\ndiff --git a/packages/coreutils/src/index.ts b/packages/coreutils/src/index.ts\nindex ed6c4ff2e2f0..e8e1c8f65931 100644\n--- a/packages/coreutils/src/index.ts\n+++ b/packages/coreutils/src/index.ts\n@@ -11,6 +11,7 @@ export * from './lru';\n export * from './markdowncodeblocks';\n export * from './pageconfig';\n export * from './path';\n+export * from './plugins';\n export * from './signal';\n export * from './text';\n export * from './time';\n\ndiff --git a/packages/coreutils/src/plugins.ts b/packages/coreutils/src/plugins.ts\nnew file mode 100644\nindex 000000000000..2be7fd306748\n--- /dev/null\n+++ b/packages/coreutils/src/plugins.ts\n@@ -0,0 +1,884 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+import { topologicSort } from '@lumino/algorithm';\n+import { IPlugin, type PluginRegistry, type Token } from '@lumino/coreutils';\n+\n+export interface IToken {\n+  /**\n+   * Token purpose description.\n+   */\n+  readonly description?: string;\n+  /**\n+   * The human readable name for the token.\n+   *\n+   * #### Notes\n+   * This can be useful for debugging and logging.\n+   */\n+  readonly name: string;\n+}\n+\n+/**\n+ * The interface for a module that exports a plugin or plugins as\n+ * the default value.\n+ */\n+export interface IPluginModule {\n+  /**\n+   * The default export.\n+   */\n+  default: IPlugin<any, any> | IPlugin<any, any>[];\n+}\n+\n+export interface IPlugin2<T = any, U = any>\n+  extends Omit<\n+    IPlugin<T, U>,\n+    'activate' | 'requires' | 'optional' | 'provides'\n+  > {\n+  /**\n+   * The types of required services for the plugin, if any.\n+   *\n+   * #### Notes\n+   * These tokens correspond to the services that are required by\n+   * the plugin for correct operation.\n+   *\n+   * When the plugin is activated, a concrete instance of each type\n+   * will be passed to the `activate()` function, in the order they\n+   * are specified in the `requires` array.\n+   */\n+  requires?: Token<any>[] | string[];\n+  /**\n+   * The types of optional services for the plugin, if any.\n+   *\n+   * #### Notes\n+   * These tokens correspond to the services that can be used by the\n+   * plugin if available, but are not necessarily required.\n+   *\n+   * The optional services will be passed to the `activate()` function\n+   * following all required services. If an optional service cannot be\n+   * resolved, `null` will be passed in its place.\n+   */\n+  optional?: Token<any>[] | string[];\n+  /**\n+   * The type of service provided by the plugin, if any.\n+   *\n+   * #### Notes\n+   * This token corresponds to the service exported by the plugin.\n+   *\n+   * When the plugin is activated, the return value of `activate()`\n+   * is used as the concrete instance of the type.\n+   */\n+  provides?: IToken | null;\n+  /**\n+   * A function invoked to activate the plugin.\n+   *\n+   * @param app - The application provided by {@link PluginRegistry.application} .\n+   *\n+   * @param args - The services specified by the `requires` property.\n+   *\n+   * @returns The provided service, or a promise to the service.\n+   *\n+   * #### Notes\n+   * This function will be called whenever the plugin is manually\n+   * activated, or when another plugin being activated requires\n+   * the service it provides.\n+   *\n+   * This function will not be called unless all of its required\n+   * services can be fulfilled.\n+   */\n+  activate?: (app: T, ...args: any[]) => U | Promise<U>;\n+\n+  /**\n+   * Callback to load the plugin module.\n+   *\n+   * @returns The module containing the plugin\n+   */\n+  loader?: () => Promise<IPluginModule>;\n+}\n+\n+/**\n+ * Plugin registry.\n+ */\n+export class PluginRegistry2<T = any> {\n+  constructor(options: PluginRegistry2.IOptions = {}) {\n+    if (options.validatePlugin) {\n+      console.info(\n+        'Plugins may be rejected by the custom validation plugin method.'\n+      );\n+      this._validatePlugin = options.validatePlugin;\n+    }\n+  }\n+\n+  /**\n+   * The application object.\n+   *\n+   * It will be provided as first argument to the\n+   * plugins activation and deactivation functions.\n+   *\n+   * It can only be set once.\n+   *\n+   * By default, it is `null`.\n+   */\n+  get application(): T {\n+    return this._application;\n+  }\n+  set application(v: T) {\n+    if (this._application !== null) {\n+      throw Error(\n+        'PluginRegistry.application is already set. It cannot be overridden.'\n+      );\n+    }\n+\n+    this._application = v;\n+  }\n+\n+  /**\n+   * The list of all the deferred plugins.\n+   */\n+  get deferredPlugins(): string[] {\n+    return Array.from(this._plugins)\n+      .filter(([id, plugin]) => plugin.autoStart === 'defer')\n+      .map(([id, plugin]) => id);\n+  }\n+\n+  /**\n+   * Get a plugin description.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @returns The plugin description.\n+   */\n+  getPluginDescription(id: string): string {\n+    return this._plugins.get(id)?.description ?? '';\n+  }\n+\n+  /**\n+   * Test whether a plugin is registered with the application.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @returns `true` if the plugin is registered, `false` otherwise.\n+   */\n+  hasPlugin(id: string): boolean {\n+    return this._plugins.has(id);\n+  }\n+\n+  /**\n+   * Test whether a plugin is activated with the application.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @returns `true` if the plugin is activated, `false` otherwise.\n+   */\n+  isPluginActivated(id: string): boolean {\n+    return this._plugins.get(id)?.activated ?? false;\n+  }\n+\n+  /**\n+   * List the IDs of the plugins registered with the application.\n+   *\n+   * @returns A new array of the registered plugin IDs.\n+   */\n+  listPlugins(): string[] {\n+    return Array.from(this._plugins.keys());\n+  }\n+\n+  /**\n+   * Register a plugin with the application.\n+   *\n+   * @param plugin - The plugin to register.\n+   *\n+   * #### Notes\n+   * An error will be thrown if a plugin with the same ID is already\n+   * registered, or if the plugin has a circular dependency.\n+   *\n+   * If the plugin provides a service which has already been provided\n+   * by another plugin, the new service will override the old service.\n+   */\n+  registerPlugin(plugin: IPlugin2<T, any>): void {\n+    // Throw an error if the plugin ID is already registered.\n+    if (this._plugins.has(plugin.id)) {\n+      throw new TypeError(`Plugin '${plugin.id}' is already registered.`);\n+    }\n+\n+    if (!this._validatePlugin(plugin)) {\n+      throw new Error(`Plugin '${plugin.id}' is not valid.`);\n+    }\n+\n+    // Create the normalized plugin data.\n+    const data = Private.createPluginData(plugin);\n+\n+    // Ensure the plugin does not cause a cyclic dependency.\n+    Private.ensureNoCycle(data, this._plugins, this._services);\n+\n+    // Add the service token to the service map.\n+    if (data.provides) {\n+      this._services.set(data.provides.name, data.id);\n+    }\n+\n+    // Add the plugin to the plugin map.\n+    this._plugins.set(data.id, data);\n+  }\n+\n+  /**\n+   * Register multiple plugins with the application.\n+   *\n+   * @param plugins - The plugins to register.\n+   *\n+   * #### Notes\n+   * This calls `registerPlugin()` for each of the given plugins.\n+   */\n+  registerPlugins(plugins: IPlugin2<T, any>[]): void {\n+    for (const plugin of plugins) {\n+      this.registerPlugin(plugin);\n+    }\n+  }\n+\n+  /**\n+   * Deregister a plugin with the application.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @param force - Whether to deregister the plugin even if it is active.\n+   */\n+  deregisterPlugin(id: string, force?: boolean): void {\n+    const plugin = this._plugins.get(id);\n+    if (!plugin) {\n+      return;\n+    }\n+\n+    if (plugin.activated && !force) {\n+      throw new Error(`Plugin '${id}' is still active.`);\n+    }\n+\n+    this._plugins.delete(id);\n+  }\n+\n+  /**\n+   * Activate the plugin with the given ID.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @returns A promise which resolves when the plugin is activated\n+   *   or rejects with an error if it cannot be activated.\n+   */\n+  async activatePlugin(id: string): Promise<void> {\n+    // Reject the promise if the plugin is not registered.\n+    const plugin = this._plugins.get(id);\n+    if (!plugin) {\n+      throw new ReferenceError(`Plugin '${id}' is not registered.`);\n+    }\n+\n+    // Resolve immediately if the plugin is already activated.\n+    if (plugin.activated) {\n+      return;\n+    }\n+\n+    // Return the pending resolver promise if it exists.\n+    if (plugin.promise) {\n+      return plugin.promise;\n+    }\n+\n+    // Resolve the required services for the plugin.\n+    const required = plugin.requires.map(t => this.resolveRequiredService(t));\n+\n+    // Resolve the optional services for the plugin.\n+    const optional = plugin.optional.map(t => this.resolveOptionalService(t));\n+\n+    // Setup the resolver promise for the plugin.\n+    plugin.promise = Promise.all([...required, ...optional])\n+      .then(services => plugin!.activate(this.application, ...services))\n+      .then(service => {\n+        plugin!.service = service;\n+        plugin!.activated = true;\n+        plugin!.promise = null;\n+      })\n+      .catch(error => {\n+        plugin!.promise = null;\n+        throw error;\n+      });\n+\n+    // Return the pending resolver promise.\n+    return plugin.promise;\n+  }\n+\n+  /**\n+   * Activate all the deferred plugins.\n+   *\n+   * @returns A promise which will resolve when each plugin is activated\n+   * or rejects with an error if one cannot be activated.\n+   */\n+  async activatePlugins(\n+    kind: 'startUp' | 'defer',\n+    options: PluginRegistry.IStartOptions = {}\n+  ): Promise<void> {\n+    switch (kind) {\n+      case 'defer': {\n+        const promises = this.deferredPlugins\n+          .filter(pluginId => this._plugins.get(pluginId)!.autoStart)\n+          .map(pluginId => {\n+            return this.activatePlugin(pluginId);\n+          });\n+        await Promise.all(promises);\n+        break;\n+      }\n+      case 'startUp': {\n+        // Collect the ids of the startup plugins.\n+        const startups = Private.collectStartupPlugins(this._plugins, options);\n+\n+        // Generate the activation promises.\n+        const promises = startups.map(async id => {\n+          try {\n+            return await this.activatePlugin(id);\n+          } catch (error) {\n+            console.error(`Plugin '${id}' failed to activate.`, error);\n+          }\n+        });\n+        await Promise.all(promises);\n+        break;\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Deactivate the plugin and its downstream dependents if and only if the\n+   * plugin and its dependents all support `deactivate`.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @returns A list of IDs of downstream plugins deactivated with this one.\n+   */\n+  async deactivatePlugin(id: string): Promise<string[]> {\n+    // Reject the promise if the plugin is not registered.\n+    const plugin = this._plugins.get(id);\n+    if (!plugin) {\n+      throw new ReferenceError(`Plugin '${id}' is not registered.`);\n+    }\n+\n+    // Bail early if the plugin is not activated.\n+    if (!plugin.activated) {\n+      return [];\n+    }\n+\n+    // Check that this plugin can deactivate.\n+    if (!plugin.deactivate) {\n+      throw new TypeError(`Plugin '${id}'#deactivate() method missing`);\n+    }\n+\n+    // Find the optimal deactivation order for plugins downstream of this one.\n+    const manifest = Private.findDependents(id, this._plugins, this._services);\n+    const downstream = manifest.map(id => this._plugins.get(id)!);\n+\n+    // Check that all downstream plugins can deactivate.\n+    for (const plugin of downstream) {\n+      if (!plugin.canBeDeactivated) {\n+        throw new TypeError(\n+          `Plugin ${plugin.id}#deactivate() method missing (depends on ${id})`\n+        );\n+      }\n+    }\n+\n+    // Deactivate all downstream plugins.\n+    for (const plugin of downstream) {\n+      const services = [...plugin.requires, ...plugin.optional].map(service => {\n+        const id = this._services.get(service);\n+        return id ? this._plugins.get(id)!.service : null;\n+      });\n+\n+      // Await deactivation so the next plugins only receive active services.\n+      await plugin.deactivate!(this.application, ...services);\n+      plugin.service = null;\n+      plugin.activated = false;\n+    }\n+\n+    // Remove plugin ID and return manifest of deactivated plugins.\n+    manifest.pop();\n+    return manifest;\n+  }\n+\n+  /**\n+   * Resolve a required service of a given type.\n+   *\n+   * @param token - The token for the service type of interest.\n+   *\n+   * @returns A promise which resolves to an instance of the requested\n+   *   service, or rejects with an error if it cannot be resolved.\n+   *\n+   * #### Notes\n+   * Services are singletons. The same instance will be returned each\n+   * time a given service token is resolved.\n+   *\n+   * If the plugin which provides the service has not been activated,\n+   * resolving the service will automatically activate the plugin.\n+   *\n+   * User code will not typically call this method directly. Instead,\n+   * the required services for the user's plugins will be resolved\n+   * automatically when the plugin is activated.\n+   */\n+  async resolveRequiredService<U>(token: Token<U> | string): Promise<U> {\n+    // Reject the promise if there is no provider for the type.\n+    const serviceName = (token as Token<U>).name ?? token;\n+    const id = this._services.get(serviceName);\n+    if (!id) {\n+      throw new TypeError(`No provider for: ${serviceName}.`);\n+    }\n+\n+    // Activate the plugin if necessary.\n+    const plugin = this._plugins.get(id)!;\n+    if (!plugin.activated) {\n+      await this.activatePlugin(id);\n+    }\n+\n+    return plugin.service;\n+  }\n+\n+  /**\n+   * Resolve an optional service of a given type.\n+   *\n+   * @param token - The token for the service type of interest.\n+   *\n+   * @returns A promise which resolves to an instance of the requested\n+   *   service, or `null` if it cannot be resolved.\n+   *\n+   * #### Notes\n+   * Services are singletons. The same instance will be returned each\n+   * time a given service token is resolved.\n+   *\n+   * If the plugin which provides the service has not been activated,\n+   * resolving the service will automatically activate the plugin.\n+   *\n+   * User code will not typically call this method directly. Instead,\n+   * the optional services for the user's plugins will be resolved\n+   * automatically when the plugin is activated.\n+   */\n+  async resolveOptionalService<U>(token: Token<U> | string): Promise<U | null> {\n+    // Resolve with `null` if there is no provider for the type.\n+    const id = this._services.get((token as Token<U>).name ?? token);\n+    if (!id) {\n+      return null;\n+    }\n+\n+    // Activate the plugin if necessary.\n+    const plugin = this._plugins.get(id)!;\n+    if (!plugin.activated) {\n+      try {\n+        await this.activatePlugin(id);\n+      } catch (reason) {\n+        console.error(reason);\n+        return null;\n+      }\n+    }\n+\n+    return plugin.service;\n+  }\n+\n+  private _application: any = null;\n+  private _validatePlugin: (plugin: IPlugin2) => boolean = () => true;\n+  private _plugins = new Map<string, Private.IPluginData<T>>();\n+  private _services = new Map<string, string>();\n+}\n+\n+/**\n+ * PluginRegistry namespace\n+ */\n+export namespace PluginRegistry2 {\n+  /**\n+   * PluginRegistry constructor options.\n+   */\n+  export interface IOptions {\n+    /**\n+     * Validate that a plugin is allowed to be registered.\n+     *\n+     * Default is `() => true`.\n+     *\n+     * @param plugin The plugin to validate\n+     * @returns Whether the plugin can be registered or not.\n+     *\n+     * #### Notes\n+     * We recommend you print a console message with the reason\n+     * a plugin is invalid.\n+     */\n+    validatePlugin?: (plugin: IPlugin2<any, any>) => boolean;\n+  }\n+}\n+\n+/**\n+ * The namespace for the module implementation details.\n+ */\n+namespace Private {\n+  /**\n+   * An object which holds the full application state for a plugin.\n+   */\n+  export interface IPluginData<T = any> {\n+    /**\n+     * The human readable ID of the plugin.\n+     */\n+    readonly id: string;\n+\n+    /**\n+     * The description of the plugin.\n+     */\n+    readonly description: string;\n+\n+    /**\n+     * Whether the plugin should be activated on application start or waiting for being\n+     * required. If the value is 'defer' then the plugin should be activated only after\n+     * the application is started.\n+     */\n+    readonly autoStart: boolean | 'defer';\n+\n+    /**\n+     * The types of required services for the plugin, or `[]`.\n+     */\n+    readonly requires: string[];\n+\n+    /**\n+     * The types of optional services for the the plugin, or `[]`.\n+     */\n+    readonly optional: string[];\n+\n+    /**\n+     * The type of service provided by the plugin, or `null`.\n+     */\n+    readonly provides: IToken | null;\n+\n+    /**\n+     * The function which activates the plugin.\n+     */\n+    readonly activate: (app: T, ...args: any[]) => Promise<any>;\n+\n+    readonly canBeDeactivated: boolean;\n+\n+    /**\n+     * The optional function which deactivates the plugin.\n+     */\n+    readonly deactivate: (app: T, ...args: any[]) => Promise<void>;\n+\n+    /**\n+     * Whether the plugin has been activated.\n+     */\n+    activated: boolean;\n+\n+    /**\n+     * The resolved service for the plugin, or `null`.\n+     */\n+    service: any | null;\n+\n+    /**\n+     * The pending resolver promise, or `null`.\n+     */\n+    promise: Promise<void> | null;\n+  }\n+\n+  class PluginData<T = any, U = any> implements IPluginData<T> {\n+    private _loader: () => Promise<\n+      Pick<IPlugin<any, any>, 'activate' | 'deactivate'>\n+    >;\n+    private _activated = false;\n+    private _promise: Promise<void> | null = null;\n+    private _service: U | null = null;\n+    private _canBeDeactivated: boolean = true;\n+\n+    constructor(plugin: IPlugin2<T, U>) {\n+      if (!plugin.activate && !plugin.loader) {\n+        throw Error(\n+          'A plugin must provide an activate method or a loader for the plugin'\n+        );\n+      }\n+\n+      this.id = plugin.id;\n+      this.description = plugin.description ?? '';\n+      this.provides = plugin.provides ?? null;\n+      this.autoStart = plugin.autoStart ?? false;\n+      this.requires = plugin.requires\n+        ? plugin.requires.map(p => (p as Token<any>).name ?? p)\n+        : [];\n+      this.optional = plugin.optional\n+        ? plugin.optional.map(p => (p as Token<any>).name ?? p)\n+        : [];\n+\n+      this._canBeDeactivated = plugin.deactivate === null ? false : true;\n+\n+      if (plugin.loader) {\n+        this._loader = async () => {\n+          const module = await plugin.loader!();\n+\n+          let plugins = module.default;\n+          // Handle commonjs exports.\n+          if (!module.hasOwnProperty('__esModule')) {\n+            plugins = module as any;\n+          }\n+          if (!Array.isArray(plugins)) {\n+            plugins = [plugins];\n+          }\n+\n+          const plugin_ = plugins.find(p => p.id === plugin.id);\n+          if (!plugin_) {\n+            throw Error(\n+              `Unable to load plugin ${plugin.id} with the provided loader.`\n+            );\n+          }\n+\n+          return {\n+            activate: plugin_.activate.bind(plugin_),\n+            deactivate: plugin_.deactivate?.bind(plugin_) ?? null\n+          };\n+        };\n+      } else {\n+        this._loader = () =>\n+          Promise.resolve({\n+            activate: plugin.activate!.bind(plugin),\n+            deactivate: plugin.deactivate?.bind(plugin) ?? null\n+          });\n+      }\n+    }\n+\n+    /**\n+     * The human readable ID of the plugin.\n+     */\n+    readonly id: string;\n+\n+    /**\n+     * The description of the plugin.\n+     */\n+    readonly description: string;\n+\n+    /**\n+     * Whether the plugin should be activated on application start or waiting for being\n+     * required. If the value is 'defer' then the plugin should be activated only after\n+     * the application is started.\n+     */\n+    readonly autoStart: boolean | 'defer';\n+\n+    /**\n+     * The types of required services for the plugin, or `[]`.\n+     */\n+    readonly requires: string[];\n+\n+    /**\n+     * The types of optional services for the the plugin, or `[]`.\n+     */\n+    readonly optional: string[];\n+\n+    /**\n+     * The type of service provided by the plugin, or `null`.\n+     */\n+    readonly provides: IToken | null;\n+\n+    /**\n+     * The function which activates the plugin.\n+     */\n+    async activate(app: T, ...args: any[]): Promise<any> {\n+      const obj = await this._loader();\n+      return obj.activate(app, ...args);\n+    }\n+\n+    /**\n+     * The optional function which deactivates the plugin.\n+     */\n+    async deactivate(app: T, ...args: any[]): Promise<void> {\n+      const obj = await this._loader();\n+\n+      if (!obj.deactivate) {\n+        console.warn(`Plugin ${this.id}#deactivate() method missing`);\n+      } else {\n+        await obj.deactivate(app, ...args);\n+      }\n+    }\n+\n+    /**\n+     * Whether the plugin has been activated.\n+     */\n+    get activated(): boolean {\n+      return this._activated;\n+    }\n+    set activated(a: boolean) {\n+      this._activated = a;\n+    }\n+\n+    get canBeDeactivated(): boolean {\n+      return this._canBeDeactivated;\n+    }\n+\n+    /**\n+     * The resolved service for the plugin, or `null`.\n+     */\n+    get service(): U | null {\n+      return this._service;\n+    }\n+    set service(s: U | null) {\n+      this._service = s;\n+    }\n+\n+    /**\n+     * The pending resolver promise, or `null`.\n+     */\n+    get promise(): Promise<void> | null {\n+      return this._promise;\n+    }\n+    set promise(p: Promise<void> | null) {\n+      this._promise = p;\n+    }\n+  }\n+\n+  /**\n+   * Create a normalized plugin data object for the given plugin.\n+   */\n+  export function createPluginData<T>(plugin: IPlugin2): IPluginData<T> {\n+    return new PluginData(plugin);\n+  }\n+\n+  /**\n+   * Ensure no cycle is present in the plugin resolution graph.\n+   *\n+   * If a cycle is detected, an error will be thrown.\n+   */\n+  export function ensureNoCycle(\n+    plugin: IPluginData,\n+    plugins: Map<string, IPluginData>,\n+    services: Map<string, string>\n+  ): void {\n+    const dependencies = [...plugin.requires, ...plugin.optional];\n+    const visit = (token: string): boolean => {\n+      if (token === plugin.provides?.name) {\n+        return true;\n+      }\n+      const id = services.get(token);\n+      if (!id) {\n+        return false;\n+      }\n+      const visited = plugins.get(id)!;\n+      const dependencies = [...visited.requires, ...visited.optional];\n+      if (dependencies.length === 0) {\n+        return false;\n+      }\n+      trace.push(id);\n+      if (dependencies.some(visit)) {\n+        return true;\n+      }\n+      trace.pop();\n+      return false;\n+    };\n+\n+    // Bail early if there cannot be a cycle.\n+    if (!plugin.provides || dependencies.length === 0) {\n+      return;\n+    }\n+\n+    // Setup a stack to trace service resolution.\n+    const trace = [plugin.id];\n+\n+    // Throw an exception if a cycle is present.\n+    if (dependencies.some(visit)) {\n+      throw new ReferenceError(`Cycle detected: ${trace.join(' -> ')}.`);\n+    }\n+  }\n+\n+  /**\n+   * Find dependents in deactivation order.\n+   *\n+   * @param id - The ID of the plugin of interest.\n+   *\n+   * @param plugins - The map containing all plugins.\n+   *\n+   * @param services - The map containing all services.\n+   *\n+   * @returns A list of dependent plugin IDs in order of deactivation\n+   *\n+   * #### Notes\n+   * The final item of the returned list is always the plugin of interest.\n+   */\n+  export function findDependents(\n+    id: string,\n+    plugins: Map<string, IPluginData>,\n+    services: Map<string, string>\n+  ): string[] {\n+    const edges = new Array<[string, string]>();\n+    const add = (id: string): void => {\n+      const plugin = plugins.get(id)!;\n+      // FIXME In the case of missing optional dependencies, we may consider\n+      // deactivating and reactivating the plugin without the missing service.\n+      const dependencies = [...plugin.requires, ...plugin.optional];\n+      edges.push(\n+        ...dependencies.reduce<[string, string][]>((acc, dep) => {\n+          const service = services.get(dep);\n+          if (service) {\n+            // An edge is oriented from dependent to provider.\n+            acc.push([id, service]);\n+          }\n+          return acc;\n+        }, [])\n+      );\n+    };\n+\n+    for (const id of plugins.keys()) {\n+      add(id);\n+    }\n+\n+    // Filter edges\n+    // - Get all packages that dependent on the package to be deactivated\n+    const newEdges = edges.filter(edge => edge[1] === id);\n+    let oldSize = 0;\n+    while (newEdges.length > oldSize) {\n+      const previousSize = newEdges.length;\n+      // Get all packages that dependent on packages that will be deactivated\n+      const packagesOfInterest = new Set(newEdges.map(edge => edge[0]));\n+      for (const poi of packagesOfInterest) {\n+        edges\n+          .filter(edge => edge[1] === poi)\n+          .forEach(edge => {\n+            // We check it is not already included to deal with circular dependencies\n+            if (!newEdges.includes(edge)) {\n+              newEdges.push(edge);\n+            }\n+          });\n+      }\n+      oldSize = previousSize;\n+    }\n+\n+    const sorted = topologicSort(newEdges);\n+    const index = sorted.findIndex(candidate => candidate === id);\n+\n+    if (index === -1) {\n+      return [id];\n+    }\n+\n+    return sorted.slice(0, index + 1);\n+  }\n+\n+  /**\n+   * Collect the IDs of the plugins to activate on startup.\n+   */\n+  export function collectStartupPlugins(\n+    plugins: Map<string, IPluginData>,\n+    options: PluginRegistry.IStartOptions\n+  ): string[] {\n+    // Create a set to hold the plugin IDs.\n+    const collection = new Set<string>();\n+\n+    // Collect the auto-start (non deferred) plugins.\n+    for (const id of plugins.keys()) {\n+      if (plugins.get(id)!.autoStart === true) {\n+        collection.add(id);\n+      }\n+    }\n+\n+    // Add the startup plugins.\n+    if (options.startPlugins) {\n+      for (const id of options.startPlugins) {\n+        collection.add(id);\n+      }\n+    }\n+\n+    // Remove the ignored plugins.\n+    if (options.ignorePlugins) {\n+      for (const id of options.ignorePlugins) {\n+        collection.delete(id);\n+      }\n+    }\n+\n+    // Return the collected startup plugins.\n+    return Array.from(collection);\n+  }\n+}\n\ndiff --git a/packages/csvviewer-extension/package.json b/packages/csvviewer-extension/package.json\nindex a4f6a7a12a9e..e91cca192a25 100644\n--- a/packages/csvviewer-extension/package.json\n+++ b/packages/csvviewer-extension/package.json\n@@ -46,8 +46,8 @@\n     \"@jupyterlab/observables\": \"^5.3.0-alpha.1\",\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/datagrid\": \"^2.3.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/datagrid\": \"^2.4.0\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n@@ -58,7 +58,41 @@\n   },\n   \"jupyterlab\": {\n     \"extension\": true,\n-    \"schemaDir\": \"schema\"\n+    \"schemaDir\": \"schema\",\n+    \"plugins\": [\n+      {\n+        \"id\": \"@jupyterlab/csvviewer-extension:csv\",\n+        \"description\": \"Adds viewer for CSV file types\",\n+        \"requires\": [\n+          \"@jupyterlab/translation:ITranslator\"\n+        ],\n+        \"optional\": [\n+          \"@jupyterlab/application:ILayoutRestorer\",\n+          \"@jupyterlab/apputils:IThemeManager\",\n+          \"@jupyterlab/mainmenu:IMainMenu\",\n+          \"@jupyterlab/documentsearch:ISearchProviderRegistry\",\n+          \"@jupyterlab/coreutils:ISettingRegistry\",\n+          \"@jupyterlab/apputils:IToolbarWidgetRegistry\"\n+        ],\n+        \"autoStart\": false\n+      },\n+      {\n+        \"id\": \"@jupyterlab/csvviewer-extension:tsv\",\n+        \"description\": \"Adds viewer for TSV file types.\",\n+        \"requires\": [\n+          \"@jupyterlab/translation:ITranslator\"\n+        ],\n+        \"optional\": [\n+          \"@jupyterlab/application:ILayoutRestorer\",\n+          \"@jupyterlab/apputils:IThemeManager\",\n+          \"@jupyterlab/mainmenu:IMainMenu\",\n+          \"@jupyterlab/documentsearch:ISearchProviderRegistry\",\n+          \"@jupyterlab/coreutils:ISettingRegistry\",\n+          \"@jupyterlab/apputils:IToolbarWidgetRegistry\"\n+        ],\n+        \"autoStart\": false\n+      }\n+    ]\n   },\n   \"styleModule\": \"style/index.js\"\n }\n\ndiff --git a/packages/csvviewer-extension/src/index.ts b/packages/csvviewer-extension/src/index.ts\nindex b9c7b13774aa..23a819a625b3 100644\n--- a/packages/csvviewer-extension/src/index.ts\n+++ b/packages/csvviewer-extension/src/index.ts\n@@ -146,14 +146,15 @@ function activateCsv(\n   let style: DataGrid.Style = Private.LIGHT_STYLE;\n   let rendererConfig: TextRenderConfig = Private.LIGHT_TEXT_CONFIG;\n \n-  if (restorer) {\n-    // Handle state restoration.\n-    void restorer.restore(tracker, {\n-      command: 'docmanager:open',\n-      args: widget => ({ path: widget.context.path, factory: FACTORY_CSV }),\n-      name: widget => widget.context.path\n-    });\n-  }\n+  // FIXME restorer is not possible for plugin not activated at start-up\n+  // if (restorer) {\n+  //   // Handle state restoration.\n+  //   void restorer.restore(tracker, {\n+  //     command: 'docmanager:open',\n+  //     args: widget => ({ path: widget.context.path, factory: FACTORY_CSV }),\n+  //     name: widget => widget.context.path\n+  //   });\n+  // }\n \n   app.docRegistry.addWidgetFactory(factory);\n   const ft = app.docRegistry.getFileType('csv');\n@@ -306,14 +307,15 @@ function activateTsv(\n   let style: DataGrid.Style = Private.LIGHT_STYLE;\n   let rendererConfig: TextRenderConfig = Private.LIGHT_TEXT_CONFIG;\n \n-  if (restorer) {\n-    // Handle state restoration.\n-    void restorer.restore(tracker, {\n-      command: 'docmanager:open',\n-      args: widget => ({ path: widget.context.path, factory: FACTORY_TSV }),\n-      name: widget => widget.context.path\n-    });\n-  }\n+  // FIXME restorer is not possible for plugin not activated at start-up\n+  // if (restorer) {\n+  //   // Handle state restoration.\n+  //   void restorer.restore(tracker, {\n+  //     command: 'docmanager:open',\n+  //     args: widget => ({ path: widget.context.path, factory: FACTORY_TSV }),\n+  //     name: widget => widget.context.path\n+  //   });\n+  // }\n \n   app.docRegistry.addWidgetFactory(factory);\n   const ft = app.docRegistry.getFileType('tsv');\n\ndiff --git a/packages/csvviewer/package.json b/packages/csvviewer/package.json\nindex 8a0c44dd1bdd..1fca56dcfec7 100644\n--- a/packages/csvviewer/package.json\n+++ b/packages/csvviewer/package.json\n@@ -45,12 +45,12 @@\n     \"@jupyterlab/docregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/datagrid\": \"^2.3.1\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/datagrid\": \"^2.4.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex eaa4f258c00e..c69990ccff5c 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -67,15 +67,15 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/datagrid\": \"^2.3.1\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/datagrid\": \"^2.4.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@vscode/debugprotocol\": \"^1.51.0\",\n     \"react\": \"^18.2.0\"\n   },\n\ndiff --git a/packages/docmanager-extension/package.json b/packages/docmanager-extension/package.json\nindex ba74a7d4f4de..d7abe8c93b40 100644\n--- a/packages/docmanager-extension/package.json\n+++ b/packages/docmanager-extension/package.json\n@@ -48,12 +48,12 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/docmanager/package.json b/packages/docmanager/package.json\nindex 2e184c7d44a5..bd436166cfc6 100644\n--- a/packages/docmanager/package.json\n+++ b/packages/docmanager/package.json\n@@ -49,14 +49,14 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/docregistry/package.json b/packages/docregistry/package.json\nindex 24664415a015..c49416aa4f84 100644\n--- a/packages/docregistry/package.json\n+++ b/packages/docregistry/package.json\n@@ -51,13 +51,13 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/documentsearch-extension/package.json b/packages/documentsearch-extension/package.json\nindex 3eeff30a6f9b..7042c5a3a8d9 100644\n--- a/packages/documentsearch-extension/package.json\n+++ b/packages/documentsearch-extension/package.json\n@@ -39,8 +39,8 @@\n     \"@jupyterlab/documentsearch\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/documentsearch/package.json b/packages/documentsearch/package.json\nindex f910ff511543..13d9b903c4e3 100644\n--- a/packages/documentsearch/package.json\n+++ b/packages/documentsearch/package.json\n@@ -41,13 +41,13 @@\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/extensionmanager/package.json b/packages/extensionmanager/package.json\nindex 7c01040880ae..36a29a2db63a 100644\n--- a/packages/extensionmanager/package.json\n+++ b/packages/extensionmanager/package.json\n@@ -41,9 +41,9 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\",\n     \"react-paginate\": \"^6.3.2\",\n     \"semver\": \"^7.3.2\"\n\ndiff --git a/packages/filebrowser-extension/package.json b/packages/filebrowser-extension/package.json\nindex edcde2240333..07639d5ab558 100644\n--- a/packages/filebrowser-extension/package.json\n+++ b/packages/filebrowser-extension/package.json\n@@ -49,9 +49,9 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/filebrowser/package.json b/packages/filebrowser/package.json\nindex 82413eb04ec2..d2332022cf38 100644\n--- a/packages/filebrowser/package.json\n+++ b/packages/filebrowser/package.json\n@@ -50,16 +50,16 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/dragdrop\": \"^2.1.4\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/dragdrop\": \"^2.1.5\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/fileeditor-extension/package.json b/packages/fileeditor-extension/package.json\nindex 4da0edfd6610..ffe2f524eb5a 100644\n--- a/packages/fileeditor-extension/package.json\n+++ b/packages/fileeditor-extension/package.json\n@@ -61,10 +61,10 @@\n     \"@jupyterlab/toc\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/fileeditor/package.json b/packages/fileeditor/package.json\nindex 4e43eb0ff3fb..282571b686c9 100644\n--- a/packages/fileeditor/package.json\n+++ b/packages/fileeditor/package.json\n@@ -51,10 +51,10 @@\n     \"@jupyterlab/toc\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\",\n     \"regexp-match-indices\": \"^1.0.2\"\n   },\n\ndiff --git a/packages/help-extension/package.json b/packages/help-extension/package.json\nindex 856590e043b1..0f8ed096bab6 100644\n--- a/packages/help-extension/package.json\n+++ b/packages/help-extension/package.json\n@@ -44,10 +44,10 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/htmlviewer/package.json b/packages/htmlviewer/package.json\nindex 569858ebcf6d..8166d4d81aa7 100644\n--- a/packages/htmlviewer/package.json\n+++ b/packages/htmlviewer/package.json\n@@ -38,9 +38,9 @@\n     \"@jupyterlab/docregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/imageviewer/package.json b/packages/imageviewer/package.json\nindex 6478a2a0dae8..e79c45476e7e 100644\n--- a/packages/imageviewer/package.json\n+++ b/packages/imageviewer/package.json\n@@ -44,9 +44,9 @@\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/docregistry\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/inspector-extension/package.json b/packages/inspector-extension/package.json\nindex 23ebc495d686..3268fdbd72bf 100644\n--- a/packages/inspector-extension/package.json\n+++ b/packages/inspector-extension/package.json\n@@ -45,7 +45,7 @@\n     \"@jupyterlab/notebook\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/inspector/package.json b/packages/inspector/package.json\nindex 2504e2adcf6c..23a8a55ab4a6 100644\n--- a/packages/inspector/package.json\n+++ b/packages/inspector/package.json\n@@ -48,11 +48,11 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/json-extension/package.json b/packages/json-extension/package.json\nindex dde90ad4eca4..aae5e35a13cf 100644\n--- a/packages/json-extension/package.json\n+++ b/packages/json-extension/package.json\n@@ -38,9 +38,9 @@\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n     \"@lezer/highlight\": \"^1.2.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\",\n     \"react-dom\": \"^18.2.0\",\n     \"react-highlight-words\": \"^0.20.0\",\n\ndiff --git a/packages/launcher-extension/package.json b/packages/launcher-extension/package.json\nindex 2635d08d3855..fe5491235a30 100644\n--- a/packages/launcher-extension/package.json\n+++ b/packages/launcher-extension/package.json\n@@ -43,9 +43,9 @@\n     \"@jupyterlab/launcher\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/launcher/package.json b/packages/launcher/package.json\nindex 84f615235628..eee2f6e601b7 100644\n--- a/packages/launcher/package.json\n+++ b/packages/launcher/package.json\n@@ -39,12 +39,12 @@\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/logconsole-extension/package.json b/packages/logconsole-extension/package.json\nindex 6de1684dd183..a4ccfd4fae90 100644\n--- a/packages/logconsole-extension/package.json\n+++ b/packages/logconsole-extension/package.json\n@@ -43,9 +43,9 @@\n     \"@jupyterlab/statusbar\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/logconsole/package.json b/packages/logconsole/package.json\nindex e2b90a8effc3..8975590a2560 100644\n--- a/packages/logconsole/package.json\n+++ b/packages/logconsole/package.json\n@@ -44,11 +44,11 @@\n     \"@jupyterlab/rendermime\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/lsp-extension/package.json b/packages/lsp-extension/package.json\nindex a3316fdfdc24..fda1295310df 100644\n--- a/packages/lsp-extension/package.json\n+++ b/packages/lsp-extension/package.json\n@@ -43,9 +43,9 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"react\": \"^18.2.0\"\n   },\n\ndiff --git a/packages/lsp/package.json b/packages/lsp/package.json\nindex 9ad7323feb9a..5b192ef22dc5 100644\n--- a/packages/lsp/package.json\n+++ b/packages/lsp/package.json\n@@ -48,10 +48,10 @@\n     \"@jupyterlab/docregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"lodash.mergewith\": \"^4.6.1\",\n     \"vscode-jsonrpc\": \"^6.0.0\",\n     \"vscode-languageserver-protocol\": \"^3.17.0\",\n\ndiff --git a/packages/mainmenu-extension/package.json b/packages/mainmenu-extension/package.json\nindex bcd86a484d4e..3bb410e489ba 100644\n--- a/packages/mainmenu-extension/package.json\n+++ b/packages/mainmenu-extension/package.json\n@@ -47,11 +47,11 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/mainmenu/package.json b/packages/mainmenu/package.json\nindex fa824b5a27d2..dbad1c9323d0 100644\n--- a/packages/mainmenu/package.json\n+++ b/packages/mainmenu/package.json\n@@ -44,10 +44,10 @@\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/markdownviewer/package.json b/packages/markdownviewer/package.json\nindex 13277e47a318..6a6938cb62b0 100644\n--- a/packages/markdownviewer/package.json\n+++ b/packages/markdownviewer/package.json\n@@ -42,10 +42,10 @@\n     \"@jupyterlab/rendermime\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/toc\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/markedparser-extension/package.json b/packages/markedparser-extension/package.json\nindex 3b9a78661672..f41fa4b379ca 100644\n--- a/packages/markedparser-extension/package.json\n+++ b/packages/markedparser-extension/package.json\n@@ -40,7 +40,7 @@\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/mermaid\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/rendermime\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n     \"marked\": \"^9.1.2\",\n     \"marked-gfm-heading-id\": \"^3.1.0\",\n     \"marked-mangle\": \"^1.1.4\"\n\ndiff --git a/packages/mathjax-extension/package.json b/packages/mathjax-extension/package.json\nindex 015c4c9623c3..20ba63631e76 100644\n--- a/packages/mathjax-extension/package.json\n+++ b/packages/mathjax-extension/package.json\n@@ -45,7 +45,7 @@\n   \"dependencies\": {\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/rendermime\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n     \"mathjax-full\": \"^3.2.2\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/mermaid/package.json b/packages/mermaid/package.json\nindex ae835da05314..f30df28ce003 100644\n--- a/packages/mermaid/package.json\n+++ b/packages/mermaid/package.json\n@@ -44,8 +44,8 @@\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"mermaid\": \"^10.7.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/metadataform-extension/package.json b/packages/metadataform-extension/package.json\nindex 607193077477..cd74c8288c6b 100644\n--- a/packages/metadataform-extension/package.json\n+++ b/packages/metadataform-extension/package.json\n@@ -45,7 +45,7 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/metadataform/package.json b/packages/metadataform/package.json\nindex dc9b5f882570..e403ec693e3b 100644\n--- a/packages/metadataform/package.json\n+++ b/packages/metadataform/package.json\n@@ -51,9 +51,9 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@rjsf/core\": \"^5.13.4\",\n     \"@rjsf/validator-ajv8\": \"^5.13.4\",\n     \"json-schema\": \"^0.4.0\",\n\ndiff --git a/packages/nbformat/package.json b/packages/nbformat/package.json\nindex 0e51e7a79bb5..e73bca092e37 100644\n--- a/packages/nbformat/package.json\n+++ b/packages/nbformat/package.json\n@@ -37,7 +37,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/notebook-extension/package.json b/packages/notebook-extension/package.json\nindex 7b209b306338..a1ed64cdc797 100644\n--- a/packages/notebook-extension/package.json\n+++ b/packages/notebook-extension/package.json\n@@ -66,13 +66,13 @@\n     \"@jupyterlab/toc\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"react\": \"^18.2.0\"\n   },\n\ndiff --git a/packages/notebook/package.json b/packages/notebook/package.json\nindex ab56257c9961..8e14106912c6 100644\n--- a/packages/notebook/package.json\n+++ b/packages/notebook/package.json\n@@ -58,17 +58,17 @@\n     \"@jupyterlab/toc\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/dragdrop\": \"^2.1.4\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/dragdrop\": \"^2.1.5\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/observables/package.json b/packages/observables/package.json\nindex 7520a1cc6a15..bcf3cb312cd7 100644\n--- a/packages/observables/package.json\n+++ b/packages/observables/package.json\n@@ -36,11 +36,11 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/outputarea/package.json b/packages/outputarea/package.json\nindex 358b276dd170..741f1143096f 100644\n--- a/packages/outputarea/package.json\n+++ b/packages/outputarea/package.json\n@@ -48,13 +48,13 @@\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/pdf-extension/package.json b/packages/pdf-extension/package.json\nindex 93bc3f11f578..cbd99caa3227 100644\n--- a/packages/pdf-extension/package.json\n+++ b/packages/pdf-extension/package.json\n@@ -37,9 +37,9 @@\n   },\n   \"dependencies\": {\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/pluginmanager-extension/package.json b/packages/pluginmanager-extension/package.json\nindex 054561b3482f..24f838f68be3 100644\n--- a/packages/pluginmanager-extension/package.json\n+++ b/packages/pluginmanager-extension/package.json\n@@ -40,7 +40,7 @@\n     \"@jupyterlab/pluginmanager\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/pluginmanager/package.json b/packages/pluginmanager/package.json\nindex 3fb6aaac296c..0f3f7eba45e9 100644\n--- a/packages/pluginmanager/package.json\n+++ b/packages/pluginmanager/package.json\n@@ -45,9 +45,9 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/property-inspector/package.json b/packages/property-inspector/package.json\nindex 199843dcd9a6..c40479edbd43 100644\n--- a/packages/property-inspector/package.json\n+++ b/packages/property-inspector/package.json\n@@ -37,10 +37,10 @@\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/rendermime-interfaces/package.json b/packages/rendermime-interfaces/package.json\nindex 1b1b64d65599..14b506c2a022 100644\n--- a/packages/rendermime-interfaces/package.json\n+++ b/packages/rendermime-interfaces/package.json\n@@ -30,8 +30,8 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@lumino/coreutils\": \"^1.11.0 || ^2.1.2\",\n-    \"@lumino/widgets\": \"^1.37.2 || ^2.3.2\"\n+    \"@lumino/coreutils\": \"^1.11.0 || ^2.2.0\",\n+    \"@lumino/widgets\": \"^1.37.2 || ^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/rendermime/package.json b/packages/rendermime/package.json\nindex bb90ad88640d..deaf3923d589 100644\n--- a/packages/rendermime/package.json\n+++ b/packages/rendermime/package.json\n@@ -48,10 +48,10 @@\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"lodash.escape\": \"^4.0.1\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/running-extension/package.json b/packages/running-extension/package.json\nindex ce67a3614cc1..2eac270c8fa5 100644\n--- a/packages/running-extension/package.json\n+++ b/packages/running-extension/package.json\n@@ -48,10 +48,10 @@\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/running/package.json b/packages/running/package.json\nindex 5d96844741ca..38f9b97aa877 100644\n--- a/packages/running/package.json\n+++ b/packages/running/package.json\n@@ -40,12 +40,12 @@\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/services/examples/browser/package.json b/packages/services/examples/browser/package.json\nindex 9476b75e8cc9..5942f5904c1c 100644\n--- a/packages/services/examples/browser/package.json\n+++ b/packages/services/examples/browser/package.json\n@@ -12,7 +12,7 @@\n   \"dependencies\": {\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/services/package.json b/packages/services/package.json\nindex 9f59e9d98d00..89ee5798d2a4 100644\n--- a/packages/services/package.json\n+++ b/packages/services/package.json\n@@ -50,11 +50,11 @@\n     \"@jupyterlab/nbformat\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"ws\": \"^8.11.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/settingeditor-extension/package.json b/packages/settingeditor-extension/package.json\nindex 7b27c583b9f2..017dab453fb5 100644\n--- a/packages/settingeditor-extension/package.json\n+++ b/packages/settingeditor-extension/package.json\n@@ -47,7 +47,7 @@\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/disposable\": \"^2.1.2\"\n+    \"@lumino/disposable\": \"^2.1.3\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/settingeditor/package.json b/packages/settingeditor/package.json\nindex 523981cb40df..6661e499ad13 100644\n--- a/packages/settingeditor/package.json\n+++ b/packages/settingeditor/package.json\n@@ -50,14 +50,14 @@\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@rjsf/core\": \"^5.13.4\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"@rjsf/validator-ajv8\": \"^5.13.4\",\n\ndiff --git a/packages/settingregistry/package.json b/packages/settingregistry/package.json\nindex 98bb7ce43db6..6ceb96b87fe2 100644\n--- a/packages/settingregistry/package.json\n+++ b/packages/settingregistry/package.json\n@@ -38,10 +38,10 @@\n   \"dependencies\": {\n     \"@jupyterlab/nbformat\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"ajv\": \"^8.12.0\",\n     \"json5\": \"^2.2.3\"\n\ndiff --git a/packages/shortcuts-extension/package.json b/packages/shortcuts-extension/package.json\nindex f68b74c35f1c..abce93391fa9 100644\n--- a/packages/shortcuts-extension/package.json\n+++ b/packages/shortcuts-extension/package.json\n@@ -44,13 +44,13 @@\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/keyboard\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/keyboard\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/statedb/package.json b/packages/statedb/package.json\nindex 09fcb3baac52..48a31928ebf9 100644\n--- a/packages/statedb/package.json\n+++ b/packages/statedb/package.json\n@@ -35,11 +35,11 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\"\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/statusbar/package.json b/packages/statusbar/package.json\nindex f3feff17450c..1c2f8408b85d 100644\n--- a/packages/statusbar/package.json\n+++ b/packages/statusbar/package.json\n@@ -37,12 +37,12 @@\n   },\n   \"dependencies\": {\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/terminal-extension/package.json b/packages/terminal-extension/package.json\nindex b25cfa36cd3e..cb48bee0e36c 100644\n--- a/packages/terminal-extension/package.json\n+++ b/packages/terminal-extension/package.json\n@@ -47,7 +47,7 @@\n     \"@jupyterlab/terminal\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"@types/webpack-env\": \"^1.18.0\",\n\ndiff --git a/packages/terminal/package.json b/packages/terminal/package.json\nindex e70e6a387d7c..7784e52ebafd 100644\n--- a/packages/terminal/package.json\n+++ b/packages/terminal/package.json\n@@ -44,10 +44,10 @@\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/domutils\": \"^2.0.1\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/domutils\": \"^2.0.2\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@xterm/addon-canvas\": \"~0.7.0\",\n     \"@xterm/addon-fit\": \"~0.10.0\",\n     \"@xterm/addon-web-links\": \"~0.11.0\",\n\ndiff --git a/packages/toc/package.json b/packages/toc/package.json\nindex f82abe023482..8ea8955b0712 100644\n--- a/packages/toc/package.json\n+++ b/packages/toc/package.json\n@@ -48,11 +48,11 @@\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n\ndiff --git a/packages/tooltip-extension/package.json b/packages/tooltip-extension/package.json\nindex 75a0f911e833..d1a664cce0e4 100644\n--- a/packages/tooltip-extension/package.json\n+++ b/packages/tooltip-extension/package.json\n@@ -47,9 +47,9 @@\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/tooltip\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/tooltip/package.json b/packages/tooltip/package.json\nindex f7498f84b247..614c1087c49f 100644\n--- a/packages/tooltip/package.json\n+++ b/packages/tooltip/package.json\n@@ -40,9 +40,9 @@\n     \"@jupyterlab/rendermime\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/translation/package.json b/packages/translation/package.json\nindex 0c1c93a8bc14..5499aa8d6345 100644\n--- a/packages/translation/package.json\n+++ b/packages/translation/package.json\n@@ -41,7 +41,7 @@\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n     \"@jupyterlab/statedb\": \"^4.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.3.0-alpha.1\",\n\ndiff --git a/packages/ui-components/examples/simple-windowed-list/package.json b/packages/ui-components/examples/simple-windowed-list/package.json\nindex a2938bb2a150..51fb4b9c1765 100644\n--- a/packages/ui-components/examples/simple-windowed-list/package.json\n+++ b/packages/ui-components/examples/simple-windowed-list/package.json\n@@ -14,8 +14,8 @@\n     \"@jupyterlab/observables\": \"^5.3.0-alpha.1\",\n     \"@jupyterlab/theme-light-extension\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.3.0-alpha.1\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"devDependencies\": {\n     \"css-loader\": \"^6.7.1\",\n\ndiff --git a/packages/ui-components/package.json b/packages/ui-components/package.json\nindex e0471aa58b85..98cada9ce042 100644\n--- a/packages/ui-components/package.json\n+++ b/packages/ui-components/package.json\n@@ -46,16 +46,16 @@\n     \"@jupyterlab/observables\": \"^5.3.0-alpha.1\",\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.3.0-alpha.1\",\n-    \"@lumino/algorithm\": \"^2.0.1\",\n-    \"@lumino/commands\": \"^2.3.0\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/disposable\": \"^2.1.2\",\n-    \"@lumino/messaging\": \"^2.0.1\",\n-    \"@lumino/polling\": \"^2.1.2\",\n-    \"@lumino/properties\": \"^2.0.1\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/virtualdom\": \"^2.0.1\",\n-    \"@lumino/widgets\": \"^2.3.2\",\n+    \"@lumino/algorithm\": \"^2.0.2\",\n+    \"@lumino/commands\": \"^2.3.1\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/disposable\": \"^2.1.3\",\n+    \"@lumino/messaging\": \"^2.0.2\",\n+    \"@lumino/polling\": \"^2.1.3\",\n+    \"@lumino/properties\": \"^2.0.2\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n+    \"@lumino/virtualdom\": \"^2.0.2\",\n+    \"@lumino/widgets\": \"^2.4.0\",\n     \"@rjsf/core\": \"^5.13.4\",\n     \"@rjsf/utils\": \"^5.13.4\",\n     \"react\": \"^18.2.0\",\n",
    "test_patch": "diff --git a/.github/workflows/linuxjs-tests.yml b/.github/workflows/linuxjs-tests.yml\nindex 8fe4712b219f..dc5737d42926 100644\n--- a/.github/workflows/linuxjs-tests.yml\n+++ b/.github/workflows/linuxjs-tests.yml\n@@ -2,9 +2,9 @@ name: Linux JS Tests\n \n on:\n   push:\n-    branches: [main]\n+    branches: [poc/plugin-data-based]\n   pull_request:\n-    branches: [main]\n+    branches: [poc/plugin-data-based]\n   release:\n     types: [published]\n \n\ndiff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex fdd5c092bb4a..9703a4b5ebfc 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -13,7 +13,9 @@ jobs:\n     name: Linux\n     strategy:\n       matrix:\n-        group: [integrity, integrity2, integrity3, release_test, docs, usage, usage2, splice_source, python, examples, interop, nonode, lint]\n+        group: [integrity, integrity2, integrity3, release_test, docs, usage, usage2, python, examples, interop, nonode, lint]\n+        # FIXME can we drop splice_source\n+        # group: [integrity, integrity2, integrity3, release_test, docs, usage, usage2, splice_source, python, examples, interop, nonode, lint]\n         # This will be used by the base setup action\n         python-version: [\"3.8\", \"3.12\"]\n         include:\n\ndiff --git a/galata/test/documentation/plugins.test.ts b/galata/test/documentation/plugins.test.ts\nindex 464cffa58f69..cb51d21676ca 100644\n--- a/galata/test/documentation/plugins.test.ts\n+++ b/galata/test/documentation/plugins.test.ts\n@@ -2,7 +2,6 @@\n // Distributed under the terms of the Modified BSD License.\n \n import { test } from '@jupyterlab/galata';\n-import { Token } from '@lumino/coreutils';\n import { expect } from '@playwright/test';\n import * as fs from 'fs-extra';\n \n@@ -27,10 +26,11 @@ test('All plugins and tokens must have a description', async ({\n \n       plugins[id] = window.jupyterapp.getPluginDescription(id);\n       const plugin = (\n-        (window.jupyterapp as any)._plugins as Map<\n+        (window.jupyterapp as any).pluginRegistry?._plugins ??\n+        ((window.jupyterapp as any)._plugins as Map<\n           string,\n-          { provides: Token<any> | null }\n-        >\n+          { provides: { name: string; description: string } | null }\n+        >)\n       ).get(id);\n       if (plugin?.provides) {\n         const token = plugin.provides;\n\ndiff --git a/galata/test/jupyterlab/toolbars.test.ts b/galata/test/jupyterlab/toolbars.test.ts\nindex e18fb507017f..f0af45eec178 100644\n--- a/galata/test/jupyterlab/toolbars.test.ts\n+++ b/galata/test/jupyterlab/toolbars.test.ts\n@@ -17,6 +17,11 @@ toolbars.forEach(([plugin, parameter]) => {\n   test(`Toolbar commands for ${plugin} must exists`, async ({ page }) => {\n     const [toolbarItems, commands] = await page.evaluate(\n       async ([plugin, parameter]) => {\n+        if (window.jupyterapp.hasPlugin(plugin)) {\n+          // Ensure to activate the plugin\n+          await window.jupyterapp.activatePlugin(plugin);\n+        }\n+\n         const settings = await window.galata.getPlugin(\n           '@jupyterlab/apputils-extension:settings'\n         );\n\ndiff --git a/jupyterlab/tests/mock_packages/interop/token/package.json b/jupyterlab/tests/mock_packages/interop/token/package.json\nindex 8cdcd60eba7b..644bcdc74059 100644\n--- a/jupyterlab/tests/mock_packages/interop/token/package.json\n+++ b/jupyterlab/tests/mock_packages/interop/token/package.json\n@@ -3,6 +3,6 @@\n   \"version\": \"4.3.0-alpha.1\",\n   \"private\": true,\n   \"dependencies\": {\n-    \"@lumino/coreutils\": \"^2.1.2\"\n+    \"@lumino/coreutils\": \"^2.2.0\"\n   }\n }\n\ndiff --git a/jupyterlab/tests/mock_packages/mimeextension/package.json b/jupyterlab/tests/mock_packages/mimeextension/package.json\nindex 5a6da31a73e4..9222769eeda9 100644\n--- a/jupyterlab/tests/mock_packages/mimeextension/package.json\n+++ b/jupyterlab/tests/mock_packages/mimeextension/package.json\n@@ -3,7 +3,7 @@\n   \"version\": \"0.3.0\",\n   \"private\": true,\n   \"dependencies\": {\n-    \"@lumino/widgets\": \"^2.3.2\"\n+    \"@lumino/widgets\": \"^2.4.0\"\n   },\n   \"jupyterlab\": {\n     \"mimeExtension\": true\n\ndiff --git a/packages/testing/package.json b/packages/testing/package.json\nindex f0a4e221f1b0..dfec4f4d4a08 100644\n--- a/packages/testing/package.json\n+++ b/packages/testing/package.json\n@@ -36,8 +36,8 @@\n     \"@babel/core\": \"^7.10.2\",\n     \"@babel/preset-env\": \"^7.10.2\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n-    \"@lumino/coreutils\": \"^2.1.2\",\n-    \"@lumino/signaling\": \"^2.1.2\",\n+    \"@lumino/coreutils\": \"^2.2.0\",\n+    \"@lumino/signaling\": \"^2.1.3\",\n     \"deepmerge\": \"^4.2.2\",\n     \"fs-extra\": \"^10.1.0\",\n     \"identity-obj-proxy\": \"^3.0.0\",\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16523",
    "pr_id": 16523,
    "issue_id": 15871,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Settings editor does not load tabs of some plugins on first open\n## Description\r\n\r\nWhen \"Settings\" Editor is opened before the loading/transformation of settings completed, the tabs for packages which were not ready are not shown. Closing and re-opening the \"Settings\" Editor after the settings for remaining packages got loaded helps.\r\n\r\nThis especially affects `Code Completion` and `Inline Completer` settings (both using `jupyter.lab.transform`), but it was also reported for extensions which do not use `jupyter.lab.transform` but are just loaded later, e.g.:\r\n- https://github.com/deshaw/jupyterlab-execute-time/issues/98\r\n\r\nAnother report for this issue was in: https://github.com/jupyter-lsp/jupyterlab-lsp/issues/1053\r\n\r\n## Reproduce\r\n\r\n1. Open \"Settings Editor\"\r\n2. Take a note of the list of \"SETTINGS\"\r\n3. Refresh page (so that JupyterLab loads with \"Settings Editor\" already open)\r\n4. Compare the list of \"SETTINGS\" now with the one from step (2)\r\n5. See that a number of tabs is now missing\r\n\r\n| On first open | After reopening |\r\n|--|--|\r\n|  ![Screenshot from 2024-02-25 17-04-28](https://github.com/jupyterlab/jupyterlab/assets/5832902/427d810e-ea8a-4ba1-9b4d-67f67bd6a79e) | ![Screenshot from 2024-02-25 17-04-08](https://github.com/jupyterlab/jupyterlab/assets/5832902/fc347988-e710-4974-bbe5-7906ba7c3a51) |\r\n\r\n\r\n## Expected behavior\r\n\r\nSettings for all plugins are are shown regardless of when they get loaded/activated/transformed.\r\n\r\nThere are two options:\r\n- (a) the \"Settings\" widget shows with whatever is ready and additional tabs show up as new plugins finish loading or as transformation of settings gets completed\r\n- (b) the \"Settings\" widget only opens once all plugins are ready\r\n\r\nI think we should go for (a) because (b) might lead to the \"Settings\" widget not showing up in a reasonable time at all.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.1.2",
    "issue_word_count": 294,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "packages/settingeditor/src/pluginlist.tsx",
      "packages/settingeditor/src/settingseditor.tsx",
      "packages/settingeditor/test/pluginlist.spec.tsx",
      "packages/settingregistry/src/settingregistry.ts"
    ],
    "pr_changed_test_files": [
      "packages/settingeditor/test/pluginlist.spec.tsx"
    ],
    "base_commit": "f3643454fd59f8f71001af262a1d8e9a82ca477c",
    "head_commit": "537deff0de9b3dbbcd17e24c79f6465b34e5ab2e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16523",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16523",
    "dockerfile": "",
    "pr_merged_at": "2024-07-03T11:12:30.000Z",
    "patch": "diff --git a/packages/settingeditor/src/pluginlist.tsx b/packages/settingeditor/src/pluginlist.tsx\nindex 416358205453..ad185a6880ff 100644\n--- a/packages/settingeditor/src/pluginlist.tsx\n+++ b/packages/settingeditor/src/pluginlist.tsx\n@@ -17,7 +17,7 @@ import {\n   updateFilterFunction\n } from '@jupyterlab/ui-components';\n import { StringExt } from '@lumino/algorithm';\n-import { PartialJSONObject } from '@lumino/coreutils';\n+import { PartialJSONObject, PromiseDelegate } from '@lumino/coreutils';\n import { Message } from '@lumino/messaging';\n import { ISignal, Signal } from '@lumino/signaling';\n \n@@ -50,13 +50,21 @@ export class PluginList extends ReactWidget {\n    */\n   constructor(options: PluginList.IOptions) {\n     super();\n-    this.registry = options.registry;\n+    this._registry = this.registry = options.registry;\n     this.translator = options.translator || nullTranslator;\n     this.addClass('jp-PluginList');\n     this._confirm = options.confirm;\n-    this.registry.pluginChanged.connect(() => {\n-      this.update();\n-    }, this);\n+    this._model = options.model ?? new PluginList.Model(options);\n+    this._model.ready\n+      .then(() => {\n+        this.update();\n+        this._model.changed.connect(() => {\n+          this.update();\n+        });\n+      })\n+      .catch(reason => {\n+        console.error(`Failed to load the plugin list model:\\n${reason}`);\n+      });\n     this.mapPlugins = this.mapPlugins.bind(this);\n     this.setFilter = this.setFilter.bind(this);\n     this.setFilter(\n@@ -66,42 +74,15 @@ export class PluginList extends ReactWidget {\n     this._evtMousedown = this._evtMousedown.bind(this);\n     this._query = options.query ?? '';\n \n-    this._allPlugins = PluginList.sortPlugins(this.registry).filter(plugin => {\n-      const { schema } = plugin;\n-      const deprecated = schema['jupyter.lab.setting-deprecated'] === true;\n-      const editable = Object.keys(schema.properties || {}).length > 0;\n-      const extensible = schema.additionalProperties !== false;\n-      // Filters out a couple of plugins that take too long to load in the new settings editor.\n-      const correctEditor =\n-        // If this is the json settings editor, anything is fine\n-        this._confirm ||\n-        // If this is the new settings editor, remove context menu / main menu settings.\n-        (!this._confirm && !(options.toSkip ?? []).includes(plugin.id));\n-\n-      return !deprecated && correctEditor && (editable || extensible);\n-    });\n-\n-    /**\n-     * Loads all settings and stores them for easy access when displaying search results.\n-     */\n-    const loadSettings = async () => {\n-      for (const plugin of this._allPlugins) {\n-        const pluginSettings = (await this.registry.load(\n-          plugin.id\n-        )) as Settings;\n-        this._settings[plugin.id] = pluginSettings;\n-      }\n-      this.update();\n-    };\n-    void loadSettings();\n-\n     this._errors = {};\n   }\n \n   /**\n    * The setting registry.\n+   * @deprecated - it was not intended as a public property\n    */\n   readonly registry: ISettingRegistry;\n+  private _registry: ISettingRegistry;\n \n   /**\n    * A signal emitted when a list user interaction happens.\n@@ -375,9 +356,9 @@ export class PluginList extends ReactWidget {\n         ? trans._p('schema', schema.description)\n         : '';\n     const itemTitle = `${description}\\n${id}\\n${version}`;\n-    const icon = this.getHint(ICON_KEY, this.registry, plugin);\n-    const iconClass = this.getHint(ICON_CLASS_KEY, this.registry, plugin);\n-    const iconTitle = this.getHint(ICON_LABEL_KEY, this.registry, plugin);\n+    const icon = this.getHint(ICON_KEY, this._registry, plugin);\n+    const iconClass = this.getHint(ICON_CLASS_KEY, this._registry, plugin);\n+    const iconTitle = this.getHint(ICON_LABEL_KEY, this._registry, plugin);\n     const filteredProperties = this._filter\n       ? this._filter(plugin)?.map(fieldValue => {\n           const highlightedIndices = StringExt.matchSumOfSquares(\n@@ -428,7 +409,7 @@ export class PluginList extends ReactWidget {\n   render(): JSX.Element {\n     const trans = this.translator.load('jupyterlab');\n     // Filter all plugins based on search value before displaying list.\n-    const allPlugins = this._allPlugins.filter(plugin => {\n+    const allPlugins = this._model.plugins.filter(plugin => {\n       if (!this._filter) {\n         return false;\n       }\n@@ -437,7 +418,7 @@ export class PluginList extends ReactWidget {\n     });\n \n     const modifiedPlugins = allPlugins.filter(plugin => {\n-      return this._settings[plugin.id]?.isModified;\n+      return this._model.settings[plugin.id]?.isModified;\n     });\n     const modifiedItems = modifiedPlugins.map(this.mapPlugins);\n     const otherItems = allPlugins\n@@ -481,14 +462,13 @@ export class PluginList extends ReactWidget {\n   private _changed = new Signal<this, void>(this);\n   private _errors: { [id: string]: boolean };\n   private _filter: SettingsEditor.PluginSearchFilter;\n+  private _model: PluginList.Model;\n   private _query: string | undefined;\n   private _handleSelectSignal = new Signal<this, string>(this);\n   private _updateFilterSignal = new Signal<\n     this,\n     SettingsEditor.PluginSearchFilter\n   >(this);\n-  private _allPlugins: ISettingRegistry.IPlugin[] = [];\n-  private _settings: { [id: string]: Settings } = {};\n   private _confirm?: (id: string) => Promise<void>;\n   private _scrollTop: number | undefined = 0;\n   private _selection = '';\n@@ -512,13 +492,19 @@ export namespace PluginList {\n      */\n     confirm?: (id: string) => Promise<void>;\n \n+    /**\n+     * Model for the plugin list.\n+     */\n+    model?: PluginList.Model;\n+\n     /**\n      * The setting registry for the plugin list.\n      */\n     registry: ISettingRegistry;\n \n     /**\n-     * List of plugins to skip\n+     * List of plugins to skip.\n+     * @deprecated - pass a `model` with `toSkip` option instead\n      */\n     toSkip?: string[];\n \n@@ -535,6 +521,9 @@ export namespace PluginList {\n \n   /**\n    * Sort a list of plugins by title and ID.\n+   * @deprecated - prior to 4.3 this function was used to reimplement\n+   * the same ordering between the plugin list and editor; it is no\n+   * longer needed as the order is now tracked by the model.\n    */\n   export function sortPlugins(\n     registry: ISettingRegistry\n@@ -545,4 +534,154 @@ export namespace PluginList {\n         return (a.schema.title || a.id).localeCompare(b.schema.title || b.id);\n       });\n   }\n+\n+  /**\n+   * Model for plugin list\n+   */\n+  export class Model {\n+    /**\n+     * Create a new plugin list model.\n+     */\n+    constructor(options: PluginList.Model.IOptions) {\n+      this._toSkip = options.toSkip ?? [];\n+      this._registry = options.registry;\n+      this._registry.pluginChanged.connect(async (_emitter, pluginId) => {\n+        let changed = false;\n+        // Either plugin can be missing (if plugin was not loaded at all yet)\n+        // or just plugin's settings may be missing (if transform step has no completed).\n+        if (!this._plugins.map(plugin => plugin.id).includes(pluginId)) {\n+          this._plugins = this._loadPlugins();\n+          changed = true;\n+        }\n+        if (!this._settings[pluginId]) {\n+          const pluginsToLoad = this._plugins.filter(\n+            plugin => plugin.id === pluginId\n+          );\n+          await this._loadSettings(pluginsToLoad);\n+          changed = true;\n+        }\n+        if (changed) {\n+          this._changed.emit();\n+        }\n+      }, this);\n+      this._plugins = this._loadPlugins();\n+      this._loadSettings(this._plugins)\n+        .then(() => {\n+          this._ready.resolve(undefined);\n+        })\n+        .catch(reason => {\n+          console.error(`Failed to load the settings:\\n${reason}`);\n+        });\n+    }\n+\n+    /**\n+     * A list of loaded plugins.\n+     */\n+    get plugins(): ISettingRegistry.IPlugin[] {\n+      return this._plugins;\n+    }\n+\n+    /**\n+     * A promise which resolves when an initial loading of plugins completed.\n+     *\n+     * Note: this does not guarantee that all `plugins` nor `settings` are available\n+     * as these can be also loaded later as plugins are added or transformed.\n+     */\n+    get ready(): Promise<void> {\n+      return this._ready.promise;\n+    }\n+\n+    /**\n+     * Settings keyed by plugin name.\n+     *\n+     * Note: settings for plugins can be loaded later than the plugin\n+     * itself, which is the case for plugins using a `transform` step.\n+     */\n+    get settings(): Record<string, Settings> {\n+      return this._settings;\n+    }\n+\n+    /**\n+     * Signal emitted when list of plugins change.\n+     *\n+     * This signal will be emitted when new plugins are added to the registry,\n+     * when settings schema of an already present plugin changes, and when the\n+     * settings state changes from default to modified or vice versa.\n+     */\n+    get changed(): ISignal<PluginList.Model, void> {\n+      return this._changed;\n+    }\n+\n+    /**\n+     * Loads, sorts and filters plugins from the registry.\n+     */\n+    private _loadPlugins(): ISettingRegistry.IPlugin[] {\n+      return this._sortPlugins(this._registry).filter(plugin => {\n+        const { schema } = plugin;\n+        const deprecated = schema['jupyter.lab.setting-deprecated'] === true;\n+        const editable = Object.keys(schema.properties || {}).length > 0;\n+        const extensible = schema.additionalProperties !== false;\n+        const correctEditor = !this._toSkip.includes(plugin.id);\n+\n+        return !deprecated && correctEditor && (editable || extensible);\n+      });\n+    }\n+\n+    /**\n+     * Loads settings and stores them for easy access when displaying search results.\n+     */\n+    private async _loadSettings(plugins: ISettingRegistry.IPlugin[]) {\n+      for (const plugin of plugins) {\n+        const pluginSettings = (await this._registry.load(\n+          plugin.id\n+        )) as Settings;\n+        pluginSettings.changed.connect(() => {\n+          if (pluginSettings.isModified !== this._settingsModified[plugin.id]) {\n+            this._changed.emit();\n+            this._settingsModified[plugin.id] = pluginSettings.isModified;\n+          }\n+        });\n+        this._settings[plugin.id] = pluginSettings;\n+        this._settingsModified[plugin.id] = pluginSettings.isModified;\n+      }\n+    }\n+\n+    private _sortPlugins(\n+      registry: ISettingRegistry\n+    ): ISettingRegistry.IPlugin[] {\n+      return Object.keys(registry.plugins)\n+        .map(plugin => registry.plugins[plugin]!)\n+        .sort((a, b) => {\n+          return (a.schema.title || a.id).localeCompare(b.schema.title || b.id);\n+        });\n+    }\n+\n+    private _plugins: ISettingRegistry.IPlugin[] = [];\n+    private _changed: Signal<PluginList.Model, void> = new Signal(this);\n+    private _ready = new PromiseDelegate<void>();\n+    private _registry: ISettingRegistry;\n+    private _settings: Record<string, Settings> = {};\n+    private _settingsModified: Record<string, boolean> = {};\n+    private _toSkip: string[];\n+  }\n+\n+  /**\n+   * A namespace for `PluginList.Model` statics.\n+   */\n+  export namespace Model {\n+    /**\n+     * The instantiation options for a plugin list model.\n+     */\n+    export interface IOptions {\n+      /**\n+       * The setting registry for the plugin list model.\n+       */\n+      registry: ISettingRegistry;\n+\n+      /**\n+       * List of plugins to skip.\n+       */\n+      toSkip?: string[];\n+    }\n+  }\n }\n\ndiff --git a/packages/settingeditor/src/settingseditor.tsx b/packages/settingeditor/src/settingseditor.tsx\nindex 3cf07bb23cc7..8fa2effc4c8c 100644\n--- a/packages/settingeditor/src/settingseditor.tsx\n+++ b/packages/settingeditor/src/settingseditor.tsx\n@@ -5,10 +5,14 @@\n \n import { ILabStatus } from '@jupyterlab/application';\n import { showDialog } from '@jupyterlab/apputils';\n-import { ISettingRegistry, Settings } from '@jupyterlab/settingregistry';\n+import { ISettingRegistry } from '@jupyterlab/settingregistry';\n import { IStateDB } from '@jupyterlab/statedb';\n import { ITranslator, nullTranslator } from '@jupyterlab/translation';\n-import { IFormRendererRegistry, ReactWidget } from '@jupyterlab/ui-components';\n+import {\n+  IFormRendererRegistry,\n+  ReactWidget,\n+  UseSignal\n+} from '@jupyterlab/ui-components';\n import { CommandRegistry } from '@lumino/commands';\n import { IDisposable } from '@lumino/disposable';\n import { Message } from '@lumino/messaging';\n@@ -30,39 +34,28 @@ export class SettingsEditor extends SplitPanel {\n     });\n     this.translator = options.translator || nullTranslator;\n     this._status = options.status;\n-    const list = (this._list = new PluginList({\n+    this._listModel = new PluginList.Model({\n+      registry: options.registry,\n+      // Filters out a couple of plugins that take too long to load in the new settings editor.\n+      toSkip: options.toSkip\n+    });\n+    this._list = new PluginList({\n       registry: options.registry,\n-      toSkip: options.toSkip,\n       translator: this.translator,\n-      query: options.query\n-    }));\n-    this.addWidget(list);\n+      query: options.query,\n+      model: this._listModel\n+    });\n+    this._listModel.changed.connect(() => {\n+      this.update();\n+    });\n+    this.addWidget(this._list);\n     this.setDirtyState = this.setDirtyState.bind(this);\n \n-    /**\n-     * Initializes the settings panel after loading the schema for all plugins.\n-     */\n-    void Promise.all(\n-      PluginList.sortPlugins(options.registry)\n-        .filter(plugin => {\n-          const { schema } = plugin;\n-          const deprecated = schema['jupyter.lab.setting-deprecated'] === true;\n-          const editable = Object.keys(schema.properties || {}).length > 0;\n-          const extensible = schema.additionalProperties !== false;\n-\n-          return !deprecated && (editable || extensible);\n-        })\n-        .map(async plugin => await options.registry.load(plugin.id))\n-    )\n-      .then(settings => {\n-        const settingsPanel = ReactWidget.create(\n+    const settingsPanel = ReactWidget.create(\n+      <UseSignal signal={this._listModel.changed}>\n+        {() => (\n           <SettingsPanel\n-            settings={\n-              settings.filter(\n-                pluginSettings =>\n-                  !(options.toSkip ?? []).includes(pluginSettings.id)\n-              ) as Settings[]\n-            }\n+            settings={[...Object.values(this._listModel.settings)]}\n             editorRegistry={options.editorRegistry}\n             handleSelectSignal={this._list.handleSelectSignal}\n             onSelect={(id: string) => (this._list.selection = id)}\n@@ -72,11 +65,16 @@ export class SettingsEditor extends SplitPanel {\n             translator={this.translator}\n             initialFilter={this._list.filter}\n           />\n-        );\n+        )}\n+      </UseSignal>\n+    );\n+    // Initializes the settings panel after loading the schema for all plugins.\n+    this._listModel.ready\n+      .then(() => {\n         this.addWidget(settingsPanel);\n       })\n       .catch(reason => {\n-        console.error(`Fail to load the setting plugins:\\n${reason}`);\n+        console.error(`Failed to load the setting plugins:\\n${reason}`);\n       });\n   }\n \n@@ -152,6 +150,7 @@ export class SettingsEditor extends SplitPanel {\n   private _status: ILabStatus;\n   private _dirty: boolean = false;\n   private _list: PluginList;\n+  private _listModel: PluginList.Model;\n   private _saveStateChange = new Signal<this, SettingsEditor.SaveState>(this);\n }\n \n\ndiff --git a/packages/settingregistry/src/settingregistry.ts b/packages/settingregistry/src/settingregistry.ts\nindex 803ce7567931..81be301125f9 100644\n--- a/packages/settingregistry/src/settingregistry.ts\n+++ b/packages/settingregistry/src/settingregistry.ts\n@@ -559,6 +559,13 @@ export class SettingRegistry implements ISettingRegistry {\n     return this._save(plugin);\n   }\n \n+  /**\n+   * A promise which resolves when the pre-fetched plugins passed to the registry finished pre-loading.\n+   */\n+  protected get ready() {\n+    return this._ready;\n+  }\n+\n   /**\n    * Load a plugin into the registry.\n    */\n",
    "test_patch": "diff --git a/packages/settingeditor/test/pluginlist.spec.tsx b/packages/settingeditor/test/pluginlist.spec.tsx\nnew file mode 100644\nindex 000000000000..76f3caf77c4e\n--- /dev/null\n+++ b/packages/settingeditor/test/pluginlist.spec.tsx\n@@ -0,0 +1,235 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+import { PluginList } from '../src/pluginlist';\n+import { signalToPromise } from '@jupyterlab/coreutils';\n+import { StateDB } from '@jupyterlab/statedb';\n+import { ISettingRegistry, SettingRegistry } from '@jupyterlab/settingregistry';\n+\n+class TestConnector extends StateDB {\n+  schemas: { [key: string]: ISettingRegistry.ISchema } = {};\n+\n+  async fetch(id: string): Promise<ISettingRegistry.IPlugin | undefined> {\n+    const fetched = await super.fetch(id);\n+    if (!fetched && !this.schemas[id]) {\n+      return undefined;\n+    }\n+\n+    const schema: ISettingRegistry.ISchema = this.schemas[id] || {\n+      type: 'object'\n+    };\n+    const composite = {};\n+    const user = {};\n+    const raw = (fetched as string) || '{ }';\n+    const version = 'test';\n+    return { id, data: { composite, user }, raw, schema, version };\n+  }\n+\n+  async list(): Promise<any> {\n+    return Promise.reject('list method not implemented');\n+  }\n+}\n+\n+class TestRegistry extends SettingRegistry {\n+  get preloaded() {\n+    return this.ready;\n+  }\n+}\n+\n+describe('@jupyterlab/settingeditor', () => {\n+  describe('PluginList.Model', () => {\n+    let connector: TestConnector;\n+    let registry: TestRegistry;\n+\n+    const id = 'test-id';\n+    const schema: ISettingRegistry.ISchema = {\n+      type: 'object',\n+      properties: {\n+        testSetting: {\n+          type: 'string',\n+          default: 'example'\n+        }\n+      }\n+    };\n+    const transformSchema = {\n+      'jupyter.lab.transform': true,\n+      ...schema\n+    };\n+\n+    beforeAll(() => {\n+      connector = new TestConnector();\n+    });\n+\n+    beforeEach(() => {\n+      registry = new TestRegistry({ connector });\n+    });\n+\n+    afterEach(async () => {\n+      connector.schemas = {};\n+      await connector.clear();\n+    });\n+\n+    describe('#changed', () => {\n+      it('should emit when a new plugin is loaded', async () => {\n+        connector.schemas[id] = schema;\n+\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        await registry.load(id);\n+\n+        await expect(signalToPromise(model.changed)).resolves.not.toThrow();\n+      });\n+\n+      it('should emit when the transform of a plugin resolves', async () => {\n+        connector.schemas[id] = transformSchema;\n+        const plugin = await connector.fetch(id);\n+\n+        // Preload the plugin\n+        registry = new TestRegistry({ connector, plugins: [plugin!] });\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        // Register transforms\n+        registry.transform(id, {\n+          fetch: p => p\n+        });\n+        // Load with transformer\n+        await registry.load(id);\n+\n+        await expect(signalToPromise(model.changed)).resolves.not.toThrow();\n+      });\n+\n+      it('should emit when settings change', async () => {\n+        connector.schemas[id] = schema;\n+\n+        const settings = await registry.load(id);\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        // Change to a non-default value\n+        await Promise.all([\n+          settings.set('testSetting', 'test'),\n+          expect(signalToPromise(model.changed)).resolves.not.toThrow()\n+        ]);\n+\n+        // Change back to the default\n+        await Promise.all([\n+          settings.set('testSetting', 'example'),\n+          expect(signalToPromise(model.changed)).resolves.not.toThrow()\n+        ]);\n+      });\n+    });\n+\n+    describe('#plugins', () => {\n+      it('should load plugins loaded after the model has initialised', async () => {\n+        connector.schemas[id] = schema;\n+\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+        expect(model.plugins).toHaveLength(0);\n+\n+        await registry.load(id);\n+\n+        await signalToPromise(model.changed);\n+        expect(model.plugins).toHaveLength(1);\n+        expect(model.plugins[0].id).toBe(id);\n+      });\n+\n+      it('should include pre-loaded plugins', async () => {\n+        connector.schemas[id] = schema;\n+        const plugin = await connector.fetch(id);\n+\n+        // Passing a plugin without transform will lead to pre-loading\n+        registry = new TestRegistry({ connector, plugins: [plugin!] });\n+        await registry.preloaded;\n+\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        expect(model.plugins).toHaveLength(1);\n+        expect(model.plugins[0].id).toBe(id);\n+      });\n+\n+      it('should include pre-fetched plugins once their transform is applied', async () => {\n+        connector.schemas[id] = transformSchema;\n+        const plugin = await connector.fetch(id);\n+\n+        // Passing a plugin with transform will cache it (but not load yet!)\n+        registry = new TestRegistry({ connector, plugins: [plugin!] });\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        expect(model.plugins).toHaveLength(0);\n+\n+        // Register transforms\n+        registry.transform(id, {\n+          fetch: p => p\n+        });\n+        // Load with transformer\n+        await registry.load(id);\n+\n+        await signalToPromise(model.changed);\n+        expect(model.plugins).toHaveLength(1);\n+      });\n+    });\n+\n+    describe('#settings', () => {\n+      it('should load settings for plugins loaded after the model has initialised', async () => {\n+        connector.schemas[id] = schema;\n+\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+        expect(Object.keys(model.settings)).toHaveLength(0);\n+\n+        await registry.load(id);\n+\n+        await signalToPromise(model.changed);\n+        expect(Object.keys(model.settings)).toHaveLength(1);\n+        expect(model.settings[id].id).toBe(id);\n+      });\n+\n+      it('should include settings for pre-loaded plugins', async () => {\n+        connector.schemas[id] = schema;\n+        const plugin = await connector.fetch(id);\n+\n+        // Passing a plugin without transform will lead to pre-loading\n+        registry = new TestRegistry({ connector, plugins: [plugin!] });\n+        await registry.preloaded;\n+\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        expect(Object.keys(model.settings)).toHaveLength(1);\n+        expect(model.settings[id].id).toBe(id);\n+      });\n+\n+      it('includes settings for pre-fetched plugins once their transform is applied', async () => {\n+        connector.schemas[id] = transformSchema;\n+        const plugin = await connector.fetch(id);\n+\n+        // Passing a plugin with transform will cache it (but not load yet!)\n+        registry = new TestRegistry({ connector, plugins: [plugin!] });\n+        await registry.preloaded;\n+\n+        const model = new PluginList.Model({ registry });\n+        await model.ready;\n+\n+        expect(Object.keys(model.settings)).toHaveLength(0);\n+\n+        // Register transforms\n+        registry.transform(id, {\n+          fetch: p => {\n+            p.schema['transformed'] = true;\n+            return p;\n+          }\n+        });\n+        // Load with transformer\n+        await registry.load(id);\n+\n+        await signalToPromise(model.changed);\n+        expect(Object.keys(model.settings)).toHaveLength(1);\n+        expect(model.settings[id].schema.transformed).toBe(true);\n+      });\n+    });\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16508",
    "pr_id": 16508,
    "issue_id": 16500,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Configure is not called for inline completion providers if no documents are open\n## Description\r\n\r\n`IInlineCompletionProvider.configure()` is not called for providers if no notebook is open. This means that initial initialization does not take place after settings are loaded.\r\n\r\n## Reproduce\r\n\r\n1. Launch https://github.com/krassowski/jupyterlab-transformers-completer\r\n2. See that the model download does not automatically\r\n3. Open a notebook\r\n4. Refresh browser tab\r\n5. See that models are now downloading automatically\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/ae123cb82015540804964f76ba4e56f21799ea27/packages/completer/src/manager.ts#L267-L284\r\n\r\n## Expected behavior\r\n\r\nShould immediately call `configure()` as needed. In jupyterlab-transformers-completer it would manifest by the download starting with no notebooks/files open:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/a834459f-39ef-42fc-9fee-d660d97051be)\r\n\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.2\r\n",
    "issue_word_count": 131,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/completer/src/manager.ts",
      "packages/metapackage/test/completer/manager.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/metapackage/test/completer/manager.spec.ts"
    ],
    "base_commit": "ae123cb82015540804964f76ba4e56f21799ea27",
    "head_commit": "b4b1ad84b39254da7b7a64a8786c5893cb36b306",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16508",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16508",
    "dockerfile": "",
    "pr_merged_at": "2024-06-21T09:51:41.000Z",
    "patch": "diff --git a/packages/completer/src/manager.ts b/packages/completer/src/manager.ts\nindex b8b328730ff7..b70f3cf410d3 100644\n--- a/packages/completer/src/manager.ts\n+++ b/packages/completer/src/manager.ts\n@@ -266,15 +266,12 @@ export class CompletionProviderManager implements ICompletionProviderManager {\n       },\n       configure: (settings: IInlineCompleterSettings) => {\n         this._inlineCompleterSettings = settings;\n-        this._panelHandlers.forEach((handler, handlerId) => {\n-          for (const [\n-            providerId,\n-            provider\n-          ] of this._inlineProviders.entries()) {\n-            if (provider.configure) {\n-              provider.configure(settings.providers[providerId]);\n-            }\n+        for (const [providerId, provider] of this._inlineProviders.entries()) {\n+          if (provider.configure) {\n+            provider.configure(settings.providers[providerId]);\n           }\n+        }\n+        this._panelHandlers.forEach((handler, handlerId) => {\n           if (handler.inlineCompleter) {\n             handler.inlineCompleter.configure(settings);\n           }\n",
    "test_patch": "diff --git a/packages/metapackage/test/completer/manager.spec.ts b/packages/metapackage/test/completer/manager.spec.ts\nindex 915f787a0086..977f2c0b71ca 100644\n--- a/packages/metapackage/test/completer/manager.spec.ts\n+++ b/packages/metapackage/test/completer/manager.spec.ts\n@@ -11,6 +11,10 @@ import {\n   ContextCompleterProvider,\n   ICompletionContext,\n   ICompletionProvider,\n+  IInlineCompleterActions,\n+  IInlineCompleterSettings,\n+  IInlineCompletionProvider,\n+  InlineCompleter,\n   ProviderReconciliator\n } from '@jupyterlab/completer';\n import { Context } from '@jupyterlab/docregistry';\n@@ -21,6 +25,7 @@ import {\n } from '@jupyterlab/notebook';\n import { ServiceManager } from '@jupyterlab/services';\n import { createStandaloneCell } from '@jupyter/ydoc';\n+import { nullTranslator } from '@jupyterlab/translation';\n \n import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';\n import { NBTestUtils } from '@jupyterlab/notebook/lib/testutils';\n@@ -270,5 +275,72 @@ describe('completer/manager', () => {\n         manager.selected.disconnect(callback);\n       });\n     });\n+\n+    describe('#inline', () => {\n+      let inline: IInlineCompleterActions;\n+      beforeEach(() => {\n+        manager.setInlineCompleterFactory({\n+          factory: options =>\n+            new InlineCompleter({\n+              ...options,\n+              trans: nullTranslator.load('jupyterlab')\n+            })\n+        });\n+        inline = manager.inline!;\n+      });\n+\n+      describe('#configure', () => {\n+        it('should call `configure()` method of each provider', () => {\n+          const provider1: IInlineCompletionProvider = {\n+            fetch: async () => {\n+              return { items: [] };\n+            },\n+            name: 'an inline provider',\n+            identifier: 'test-provider-1',\n+            configure: jest.fn()\n+          };\n+          const provider2: IInlineCompletionProvider = {\n+            fetch: async () => {\n+              return { items: [] };\n+            },\n+            name: 'a second inline provider',\n+            identifier: 'test-provider-2',\n+            configure: jest.fn()\n+          };\n+          manager.registerInlineProvider(provider1);\n+          manager.registerInlineProvider(provider2);\n+          expect(provider1.configure).toHaveBeenCalledTimes(0);\n+\n+          const sharedConfig = {\n+            debouncerDelay: 0,\n+            timeout: 10000\n+          };\n+          inline.configure({\n+            providers: {\n+              'test-provider-1': {\n+                ...sharedConfig,\n+                enabled: true\n+              },\n+              'test-provider-2': {\n+                ...sharedConfig,\n+                enabled: false\n+              }\n+            } as IInlineCompleterSettings['providers']\n+          } as IInlineCompleterSettings);\n+          expect(provider1.configure).toHaveBeenCalledTimes(1);\n+          expect(provider1.configure).toHaveBeenLastCalledWith(\n+            expect.objectContaining({\n+              enabled: true\n+            })\n+          );\n+          expect(provider2.configure).toHaveBeenCalledTimes(1);\n+          expect(provider2.configure).toHaveBeenLastCalledWith(\n+            expect.objectContaining({\n+              enabled: false\n+            })\n+          );\n+        });\n+      });\n+    });\n   });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16507",
    "pr_id": 16507,
    "issue_id": 16364,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Inline completer should not resize the cell editor aggressively when streaming \n## Description\r\n\r\nWhen inline completions are streaming sometimes the editor height changes aggressively. This is not accessible especially if user prefer reduced motion.\r\n\r\n## Reproduce\r\n\r\n1. Use https://github.com/krassowski/jupyterlab-transformers-completer\r\n2. Change settings to always stream\r\n3. Start typing and invoke inline completer\r\n4. See how the cell height changes drastically when streaming and when switching between alternative suggestions\r\n\r\n## Expected behavior\r\n\r\nIdeas to explore:\r\n- adding a configurable maximum height for the ghost text, e.g. 3-4 lines of code\r\n   - as a variation on this, expanding the following lines of the ghost text only when user stops typing, after a configurable timeout - if they started reading the suggestion they will be interested to see more lines - this allows to reduce the max height to 2-3 lines without detriment to users ability to read the entire thing before accepting\r\n- if there are multiple suggestions of variable height keeping reserved space for the suggestion with the most lines so that when user cycles between suggestions the cell does not resize\r\n- keeping some constant reserved space, e.g. minimum editor height when inline completer is enabled\r\n- keeping the empty space for a while after last suggestion was invalidated so that the editor does not bounce when a new suggestion comes in (this is already implemented but the timeout is very short - maybe we should increase it or make it configurable)\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.0",
    "issue_word_count": 247,
    "test_files_count": 1,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "packages/completer-extension/schema/inline-completer.json",
      "packages/completer/src/ghost.ts",
      "packages/completer/src/inline.ts",
      "packages/completer/src/tokens.ts",
      "packages/completer/style/base.css",
      "packages/completer/test/inline.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/completer/test/inline.spec.ts"
    ],
    "base_commit": "47893922a06b35641db013d5637ad6ac141ffe86",
    "head_commit": "d425b0c349b13ef6f5ffe884c2e3d231fffc4c15",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16507",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16507",
    "dockerfile": "",
    "pr_merged_at": "2024-07-03T14:43:15.000Z",
    "patch": "diff --git a/packages/completer-extension/schema/inline-completer.json b/packages/completer-extension/schema/inline-completer.json\nindex de4dc2ef9d96..9eed7309b223 100644\n--- a/packages/completer-extension/schema/inline-completer.json\n+++ b/packages/completer-extension/schema/inline-completer.json\n@@ -61,6 +61,33 @@\n         { \"const\": \"uncover\", \"title\": \"Uncover\" }\n       ],\n       \"default\": \"uncover\"\n+    },\n+    \"minLines\": {\n+      \"title\": \"Reserve lines for inline completion\",\n+      \"description\": \"Number of lines to reserve for the ghost text with inline completion suggestion.\",\n+      \"type\": \"number\",\n+      \"default\": 0,\n+      \"minimum\": 0\n+    },\n+    \"maxLines\": {\n+      \"title\": \"Limit inline completion lines\",\n+      \"description\": \"Number of lines of inline completion to show before collapsing. Setting zero disables the limit.\",\n+      \"type\": \"number\",\n+      \"default\": 0,\n+      \"minimum\": 0\n+    },\n+    \"reserveSpaceForLongest\": {\n+      \"title\": \"Reserve space for the longest candidate\",\n+      \"description\": \"When multiple completions are returned, reserve blank space for up to as many lines as in the longest completion candidate to avoid resizing editor when cycling between the suggestions.\",\n+      \"type\": \"boolean\",\n+      \"default\": false\n+    },\n+    \"editorResizeDelay\": {\n+      \"title\": \"Editor resize delay\",\n+      \"description\": \"When an inline completion gets cancelled the editor may change its size rapidly. When typing in the editor, the completions may get dismissed frequently causing a noticeable jitter of the editor height. Adding a delay prevents the jitter on typing. The value should be in milliseconds.\",\n+      \"type\": \"number\",\n+      \"default\": 1000,\n+      \"minimum\": 0\n     }\n   },\n   \"additionalProperties\": false,\n\ndiff --git a/packages/completer/src/ghost.ts b/packages/completer/src/ghost.ts\nindex c3047f7ca4e1..2bdae122bc88 100644\n--- a/packages/completer/src/ghost.ts\n+++ b/packages/completer/src/ghost.ts\n@@ -15,6 +15,7 @@ const GHOST_TEXT_CLASS = 'jp-GhostText';\n const STREAMED_TOKEN_CLASS = 'jp-GhostText-streamedToken';\n const STREAMING_INDICATOR_CLASS = 'jp-GhostText-streamingIndicator';\n const ERROR_INDICATOR_CLASS = 'jp-GhostText-errorIndicator';\n+const HIDDEN_LINES_CLASS = 'jp-GhostText-hiddenLines';\n \n /**\n  * Ghost text content and placement.\n@@ -40,6 +41,14 @@ export interface IGhostText {\n    * Whether streaming is in progress.\n    */\n   streaming?: boolean;\n+  /**\n+   * Maximum number of lines to show.\n+   */\n+  maxLines?: number;\n+  /**\n+   * Minimum number of lines to reserve (to avoid frequent resizing).\n+   */\n+  minLines?: number;\n   /**\n    * An error occurred in the request.\n    */\n@@ -69,6 +78,16 @@ export class GhostTextManager {\n    */\n   static streamingAnimation: 'none' | 'uncover' = 'uncover';\n \n+  /**\n+   * Delay for removal of line spacer.\n+   */\n+  static spacerRemovalDelay: number = 700;\n+\n+  /**\n+   * Duration for line spacer removal.\n+   */\n+  static spacerRemovalDuration: number = 300;\n+\n   /**\n    * Place ghost text in an editor.\n    */\n@@ -198,33 +217,72 @@ class GhostTextWidget extends WidgetType {\n       this._clearErrorTimeout = null;\n     }\n \n-    const content = this.content;\n-\n-    if (this.isSpacer) {\n-      dom.innerText = content;\n-      return;\n-    }\n-\n+    let content = this.content;\n+    let hiddenContent = '';\n     let addition = this.options.addedPart;\n+\n     if (addition) {\n       if (addition.startsWith('\\n')) {\n         // Show the new line straight away to ensure proper positioning.\n         addition = addition.substring(1);\n       }\n-      dom.innerText = content.substring(0, content.length - addition.length);\n+      content = content.substring(0, content.length - addition.length);\n+    }\n+\n+    if (this.options.maxLines) {\n+      // Split into content to show immediately and the hidden part\n+      const lines = content.split('\\n');\n+      content = lines.slice(0, this.options.maxLines).join('\\n');\n+      hiddenContent = lines.slice(this.options.maxLines).join('\\n');\n+    }\n+\n+    const minLines = Math.min(\n+      this.options.minLines ?? 0,\n+      this.options.maxLines ?? Infinity\n+    );\n+    const linesToAdd = Math.max(0, minLines - content.split('\\n').length + 1);\n+    const placeHolderLines = new Array(linesToAdd).fill('').join('\\n');\n+\n+    if (this.isSpacer) {\n+      dom.innerText = content + placeHolderLines;\n+      return;\n+    }\n+    dom.innerText = content;\n+\n+    let streamedTokenHost = dom;\n+\n+    if (hiddenContent.length > 0) {\n+      const hiddenWrapper = document.createElement('span');\n+      hiddenWrapper.className = 'jp-GhostText-hiddenWrapper';\n+      dom.appendChild(hiddenWrapper);\n+      const expandOnHover = document.createElement('span');\n+      expandOnHover.className = 'jp-GhostText-expandHidden';\n+      expandOnHover.innerText = 'â‡“';\n+      const hiddenPart = document.createElement('span');\n+      hiddenWrapper.appendChild(expandOnHover);\n+      hiddenPart.className = HIDDEN_LINES_CLASS;\n+      hiddenPart.innerText = '\\n' + hiddenContent;\n+      hiddenWrapper.appendChild(hiddenPart);\n+      streamedTokenHost = hiddenPart;\n+    }\n+\n+    if (addition) {\n       const addedPart = document.createElement('span');\n       addedPart.className = STREAMED_TOKEN_CLASS;\n       addedPart.innerText = addition;\n-      dom.appendChild(addedPart);\n-    } else {\n-      // just set text\n-      dom.innerText = content;\n+      streamedTokenHost.appendChild(addedPart);\n     }\n+\n     // Add \"streaming-in-progress\" indicator\n     if (this.options.streaming) {\n       const streamingIndicator = document.createElement('span');\n       streamingIndicator.className = STREAMING_INDICATOR_CLASS;\n-      dom.appendChild(streamingIndicator);\n+      streamedTokenHost.appendChild(streamingIndicator);\n+    }\n+\n+    if (placeHolderLines.length > 0) {\n+      const placeholderLinesNode = document.createTextNode(placeHolderLines);\n+      streamedTokenHost.appendChild(placeholderLinesNode);\n     }\n   }\n   destroy(dom: HTMLElement) {\n@@ -266,6 +324,9 @@ class TransientLineSpacerWidget extends TransientSpacerWidget {\n   toDOM() {\n     const wrap = super.toDOM();\n     wrap.classList.add(TRANSIENT_LINE_SPACER_CLASS);\n+    wrap.style.animationDelay = GhostTextManager.spacerRemovalDelay + 'ms';\n+    wrap.style.animationDuration =\n+      GhostTextManager.spacerRemovalDuration + 'ms';\n     return wrap;\n   }\n }\n\ndiff --git a/packages/completer/src/inline.ts b/packages/completer/src/inline.ts\nindex 1c78094067d9..020b4d997b2b 100644\n--- a/packages/completer/src/inline.ts\n+++ b/packages/completer/src/inline.ts\n@@ -199,6 +199,17 @@ export class InlineCompleter extends Widget {\n       this._updateShortcutsVisibility();\n     }\n     GhostTextManager.streamingAnimation = settings.streamingAnimation;\n+    GhostTextManager.spacerRemovalDelay = Math.max(\n+      0,\n+      settings.editorResizeDelay - 300\n+    );\n+    GhostTextManager.spacerRemovalDuration = Math.max(\n+      0,\n+      Math.min(300, settings.editorResizeDelay - 300)\n+    );\n+    this._minLines = settings.minLines;\n+    this._maxLines = settings.maxLines;\n+    this._reserveSpaceForLongest = settings.reserveSpaceForLongest;\n   }\n \n   /**\n@@ -408,12 +419,26 @@ export class InlineCompleter extends Widget {\n     }\n \n     const view = (editor as CodeMirrorEditor).editor;\n+\n+    let minLines: number;\n+    if (this._reserveSpaceForLongest) {\n+      const items = this.model?.completions?.items ?? [];\n+      const longest = Math.max(\n+        ...items.map(i => i.insertText.split('\\n').length)\n+      );\n+      minLines = Math.max(this._minLines, longest);\n+    } else {\n+      minLines = this._minLines;\n+    }\n+\n     this._ghostManager.placeGhost(view, {\n       from: editor.getOffsetAt(model.cursor),\n       content: text,\n       providerId: item.provider.identifier,\n       addedPart: item.lastStreamed,\n       streaming: item.streaming,\n+      minLines: minLines,\n+      maxLines: this._maxLines,\n       onPointerOver: this._onPointerOverGhost.bind(this),\n       onPointerLeave: this._onPointerLeaveGhost.bind(this),\n       error: item.error\n@@ -492,6 +517,8 @@ export class InlineCompleter extends Widget {\n   private _editor: CodeEditor.IEditor | null | undefined = null;\n   private _ghostManager: GhostTextManager;\n   private _lastItem: CompletionHandler.IInlineItem | null = null;\n+  private _maxLines: number;\n+  private _minLines: number;\n   private _model: InlineCompleter.IModel | null = null;\n   private _providerWidget = new Widget();\n   private _showShortcuts = InlineCompleter.defaultSettings.showShortcuts;\n@@ -500,6 +527,7 @@ export class InlineCompleter extends Widget {\n   private _trans: TranslationBundle;\n   private _toolbar = new Toolbar<Widget>();\n   private _progressBar: HTMLElement;\n+  private _reserveSpaceForLongest: boolean;\n }\n \n /**\n@@ -539,7 +567,11 @@ export namespace InlineCompleter {\n     showWidget: 'onHover',\n     showShortcuts: true,\n     streamingAnimation: 'uncover',\n-    providers: {}\n+    providers: {},\n+    minLines: 2,\n+    maxLines: 4,\n+    editorResizeDelay: 1000,\n+    reserveSpaceForLongest: false\n   };\n \n   /**\n\ndiff --git a/packages/completer/src/tokens.ts b/packages/completer/src/tokens.ts\nindex e908ea3105af..0ee077e7691f 100644\n--- a/packages/completer/src/tokens.ts\n+++ b/packages/completer/src/tokens.ts\n@@ -457,6 +457,22 @@ export interface IInlineCompleterSettings {\n    * Transition effect used when streaming tokens from model.\n    */\n   streamingAnimation: 'none' | 'uncover';\n+  /**\n+   * Minimum lines to show.\n+   */\n+  minLines: number;\n+  /**\n+   * Maximum lines to show.\n+   */\n+  maxLines: number;\n+  /**\n+   * Delay between resizing the editor after an incline completion was cancelled.\n+   */\n+  editorResizeDelay: number;\n+  /*\n+   * Reserve space for the longest of the completions candidates.\n+   */\n+  reserveSpaceForLongest: boolean;\n   /**\n    * Provider settings.\n    */\n\ndiff --git a/packages/completer/style/base.css b/packages/completer/style/base.css\nindex 8b27bd2cf20a..3ec4399cb94c 100644\n--- a/packages/completer/style/base.css\n+++ b/packages/completer/style/base.css\n@@ -227,6 +227,7 @@\n }\n \n .jp-GhostText-lineSpacer {\n+  /* duration and delay are overwritten by inline styles */\n   animation: jp-GhostText-hide 300ms 700ms ease-out forwards;\n }\n \n@@ -240,6 +241,24 @@\n   }\n }\n \n+.jp-GhostText-expandHidden {\n+  border: 1px solid var(--jp-border-color0);\n+  border-radius: var(--jp-border-radius);\n+  background: var(--jp-layout-color0);\n+  color: var(--jp-content-font-color3);\n+  padding: 0 4px;\n+  margin: 0 4px;\n+  cursor: default;\n+}\n+\n+.jp-GhostText-hiddenWrapper:hover > .jp-GhostText-hiddenLines {\n+  display: inline;\n+}\n+\n+.jp-GhostText-hiddenLines {\n+  display: none;\n+}\n+\n .jp-GhostText[data-animation='uncover'] {\n   position: relative;\n }\n",
    "test_patch": "diff --git a/packages/completer/test/inline.spec.ts b/packages/completer/test/inline.spec.ts\nindex 57fd6acd09da..75996e475ab5 100644\n--- a/packages/completer/test/inline.spec.ts\n+++ b/packages/completer/test/inline.spec.ts\n@@ -40,6 +40,8 @@ describe('completer/inline', () => {\n     let editorWidget: CodeEditorWrapper;\n     let model: InlineCompleter.Model;\n     let suggestionsAbc: CompletionHandler.IInlineItem[];\n+    const findInHost = (selector: string) =>\n+      editorWidget.editor.host.querySelector(selector);\n \n     beforeEach(() => {\n       editorWidget = createEditorWidget();\n@@ -87,9 +89,6 @@ describe('completer/inline', () => {\n     });\n \n     describe('#_setText()', () => {\n-      const findInHost = (selector: string) =>\n-        editorWidget.editor.host.querySelector(selector);\n-\n       it('should render the completion as it is streamed', async () => {\n         Widget.attach(editorWidget, document.body);\n         Widget.attach(completer, document.body);\n@@ -258,6 +257,71 @@ describe('completer/inline', () => {\n         });\n         expect(completer.node.dataset.showShortcuts).toBe('false');\n       });\n+\n+      it('`maxLines` should limit the number of lines visible', async () => {\n+        Widget.attach(editorWidget, document.body);\n+        Widget.attach(completer, document.body);\n+        completer.configure({\n+          ...InlineCompleter.defaultSettings,\n+          maxLines: 3\n+        });\n+        const item: CompletionHandler.IInlineItem = {\n+          ...itemDefaults,\n+          insertText: 'line1\\nline2\\nline3\\nline4\\nline5'\n+        };\n+        model.setCompletions({ items: [item] });\n+\n+        const ghost = findInHost(`.${GHOST_TEXT_CLASS}`) as HTMLElement;\n+        expect(ghost.innerText).toBe('line1\\nline2\\nline3');\n+      });\n+\n+      const getGhostTextContent = () => {\n+        const ghost = findInHost(`.${GHOST_TEXT_CLASS}`) as HTMLElement;\n+        // jest-dom does not support textContent/innerText properly, we need to extract it manually\n+        return (\n+          ghost.innerText +\n+          [...ghost.childNodes].map(node => node.textContent).join('')\n+        );\n+      };\n+\n+      it('`minLines` should add empty lines when needed', async () => {\n+        Widget.attach(editorWidget, document.body);\n+        Widget.attach(completer, document.body);\n+        completer.configure({\n+          ...InlineCompleter.defaultSettings,\n+          minLines: 3\n+        });\n+        const item: CompletionHandler.IInlineItem = {\n+          ...itemDefaults,\n+          insertText: 'line1'\n+        };\n+        model.setCompletions({ items: [item] });\n+\n+        expect(getGhostTextContent()).toBe('line1\\n\\n');\n+      });\n+\n+      it('`reserveSpaceForLongest` should add empty lines when needed', async () => {\n+        Widget.attach(editorWidget, document.body);\n+        Widget.attach(completer, document.body);\n+        completer.configure({\n+          ...InlineCompleter.defaultSettings,\n+          reserveSpaceForLongest: true\n+        });\n+        model.setCompletions({\n+          items: [\n+            {\n+              ...itemDefaults,\n+              insertText: 'line1'\n+            },\n+            {\n+              ...itemDefaults,\n+              insertText: 'line1\\nline2\\nline3'\n+            }\n+          ]\n+        });\n+\n+        expect(getGhostTextContent()).toBe('line1\\n\\n');\n+      });\n     });\n \n     describe('#cycle()', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16498",
    "pr_id": 16498,
    "issue_id": 16515,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Backspace handling in stream outputs is broken\n## Description\r\n\r\nBackspace characters (`\"\\b\"`) are not properly handled in code cell stream outputs.\r\n\r\n## Reproduce\r\n\r\nCreate a notebook and run the following cell:\r\n\r\n```py\r\n# print(\"abc\\b\")    # âœ…: ab\r\n# print(\"abc\\b\\b\")  # âœ…: a\r\nprint(\"abc\\b\\b\\b\")  # âŒ: ab\r\n```\r\n\r\nI think the bug is in [fixBackspace](https://github.com/jupyterlab/jupyterlab/blob/806fae5f763c3dab9aa2ff40cd665cb4da6e27d6/packages/outputarea/src/model.ts#L490).\r\n\r\n## Expected behavior\r\n\r\nAs many characters should be removed as there are backspaces (until reaching a newline).\r\nThis is fixed in https://github.com/jupyterlab/jupyterlab/pull/16498.\r\n\r\n## Context\r\n\r\n- Operating System and version: Linux Ubuntu 24.04\r\n- Browser and version: Firefox 127.0.1\r\n- JupyterLab version: 4.2.2",
    "issue_word_count": 113,
    "test_files_count": 2,
    "non_test_files_count": 23,
    "pr_changed_files": [
      "dev_mode/package.json",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/notebook/package.json",
      "packages/cell-toolbar/package.json",
      "packages/cells/package.json",
      "packages/cells/src/model.ts",
      "packages/cells/src/widget.ts",
      "packages/cells/test/model.spec.ts",
      "packages/codeeditor/package.json",
      "packages/codemirror-extension/package.json",
      "packages/codemirror/package.json",
      "packages/completer/package.json",
      "packages/console/package.json",
      "packages/debugger/package.json",
      "packages/docregistry/package.json",
      "packages/fileeditor/package.json",
      "packages/notebook-extension/package.json",
      "packages/notebook/package.json",
      "packages/outputarea/src/model.ts",
      "packages/outputarea/src/widget.ts",
      "packages/outputarea/test/widget.spec.ts",
      "packages/rendermime/src/outputmodel.ts",
      "packages/services/package.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "packages/cells/test/model.spec.ts",
      "packages/outputarea/test/widget.spec.ts"
    ],
    "base_commit": "616c523da082f57d681ebaa1f1104423a6e567a1",
    "head_commit": "c199f3d2a324967d87681d1576472ac3c8f9bff3",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16498",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16498",
    "dockerfile": "",
    "pr_merged_at": "2024-08-07T12:30:50.000Z",
    "patch": "diff --git a/dev_mode/package.json b/dev_mode/package.json\nindex b5b3660526e6..8d6e8d967082 100644\n--- a/dev_mode/package.json\n+++ b/dev_mode/package.json\n@@ -22,7 +22,7 @@\n     \"@codemirror/view\": \"^6.9.6\",\n     \"@jupyter/react-components\": \"^0.16.6\",\n     \"@jupyter/web-components\": \"^0.16.6\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"~4.3.0-alpha.2\",\n     \"@jupyterlab/application-extension\": \"~4.3.0-alpha.2\",\n     \"@jupyterlab/apputils\": \"~4.4.0-alpha.2\",\n\ndiff --git a/examples/cell/package.json b/examples/cell/package.json\nindex 30a0ad81cdaf..ded2d3cdd9ac 100644\n--- a/examples/cell/package.json\n+++ b/examples/cell/package.json\n@@ -8,7 +8,7 @@\n   },\n   \"dependencies\": {\n     \"@jupyter/web-components\": \"^0.16.6\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/cells\": \"^4.3.0-alpha.2\",\n\ndiff --git a/examples/console/package.json b/examples/console/package.json\nindex a597cbb86da1..e81fd1aa6e57 100644\n--- a/examples/console/package.json\n+++ b/examples/console/package.json\n@@ -8,7 +8,7 @@\n   },\n   \"dependencies\": {\n     \"@jupyter/web-components\": \"^0.16.6\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/console\": \"^4.3.0-alpha.2\",\n\ndiff --git a/examples/notebook/package.json b/examples/notebook/package.json\nindex ff141df9ddab..ca59a3e31c30 100644\n--- a/examples/notebook/package.json\n+++ b/examples/notebook/package.json\n@@ -8,7 +8,7 @@\n   },\n   \"dependencies\": {\n     \"@jupyter/web-components\": \"^0.16.6\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/cell-toolbar/package.json b/packages/cell-toolbar/package.json\nindex 446eaaf114e1..d6d0479f8634 100644\n--- a/packages/cell-toolbar/package.json\n+++ b/packages/cell-toolbar/package.json\n@@ -40,7 +40,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/cells\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/docregistry\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/cells/package.json b/packages/cells/package.json\nindex 5f98ff50ba93..20f2990d7da3 100644\n--- a/packages/cells/package.json\n+++ b/packages/cells/package.json\n@@ -44,7 +44,7 @@\n   \"dependencies\": {\n     \"@codemirror/state\": \"^6.4.1\",\n     \"@codemirror/view\": \"^6.26.3\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/attachments\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/cells/src/model.ts b/packages/cells/src/model.ts\nindex 1c2c04fd0744..ced9b774574c 100644\n--- a/packages/cells/src/model.ts\n+++ b/packages/cells/src/model.ts\n@@ -13,7 +13,7 @@ import { IChangedArgs } from '@jupyterlab/coreutils';\n \n import * as nbformat from '@jupyterlab/nbformat';\n \n-import { ObservableValue } from '@jupyterlab/observables';\n+import { IObservableString, ObservableValue } from '@jupyterlab/observables';\n \n import { IOutputAreaModel, OutputAreaModel } from '@jupyterlab/outputarea';\n \n@@ -759,8 +759,37 @@ export class CodeCellModel extends CellModel implements ICodeCellModel {\n     globalModelDBMutex(() => {\n       switch (event.type) {\n         case 'add': {\n+          for (const output of event.newValues) {\n+            if (output.type === 'stream') {\n+              output.streamText!.changed.connect(\n+                (\n+                  sender: IObservableString,\n+                  textEvent: IObservableString.IChangedArgs\n+                ) => {\n+                  const codeCell = this.sharedModel as YCodeCell;\n+                  if (textEvent.type === 'remove') {\n+                    codeCell.removeStreamOutput(\n+                      event.newIndex,\n+                      textEvent.start\n+                    );\n+                  } else {\n+                    codeCell.appendStreamOutput(\n+                      event.newIndex,\n+                      textEvent.value\n+                    );\n+                  }\n+                },\n+                this\n+              );\n+            }\n+          }\n           const outputs = event.newValues.map(output => output.toJSON());\n-          codeCell.updateOutputs(event.newIndex, event.newIndex, outputs);\n+          codeCell.updateOutputs(\n+            event.newIndex,\n+            event.newIndex,\n+            outputs,\n+            'silent-change'\n+          );\n           break;\n         }\n         case 'set': {\n@@ -768,12 +797,18 @@ export class CodeCellModel extends CellModel implements ICodeCellModel {\n           codeCell.updateOutputs(\n             event.oldIndex,\n             event.oldIndex + newValues.length,\n-            newValues\n+            newValues,\n+            'silent-change'\n           );\n           break;\n         }\n         case 'remove':\n-          codeCell.updateOutputs(event.oldIndex, event.oldValues.length);\n+          codeCell.updateOutputs(\n+            event.oldIndex,\n+            event.oldValues.length,\n+            [],\n+            'silent-change'\n+          );\n           break;\n         default:\n           throw new Error(`Invalid event type: ${event.type}`);\n@@ -790,8 +825,23 @@ export class CodeCellModel extends CellModel implements ICodeCellModel {\n   ): void {\n     if (change.outputsChange) {\n       globalModelDBMutex(() => {\n-        this.outputs.clear();\n-        slot.getOutputs().forEach(output => this._outputs.add(output));\n+        let retain = 0;\n+        for (const outputsChange of change.outputsChange!) {\n+          if ('retain' in outputsChange) {\n+            retain += outputsChange.retain!;\n+          }\n+          if ('delete' in outputsChange) {\n+            for (let i = 0; i < outputsChange.delete!; i++) {\n+              this._outputs.remove(retain);\n+            }\n+          }\n+          if ('insert' in outputsChange) {\n+            // Inserting an output always results in appending it.\n+            for (const output of outputsChange.insert!) {\n+              this._outputs.add(output.toJSON());\n+            }\n+          }\n+        }\n       });\n     }\n \n\ndiff --git a/packages/cells/src/widget.ts b/packages/cells/src/widget.ts\nindex 8dc3d9452a0d..6c4b7639771d 100644\n--- a/packages/cells/src/widget.ts\n+++ b/packages/cells/src/widget.ts\n@@ -1390,26 +1390,30 @@ export class CodeCell extends Cell<ICodeCellModel> {\n     // to changes in metadata until we have fully committed our changes.\n     // Otherwise setting one key can trigger a write to the other key to\n     // maintain the synced consistency.\n-    this.model.sharedModel.transact(() => {\n-      super.saveCollapseState();\n+    this.model.sharedModel.transact(\n+      () => {\n+        super.saveCollapseState();\n \n-      const collapsed = this.model.getMetadata('collapsed');\n+        const collapsed = this.model.getMetadata('collapsed');\n \n-      if (\n-        (this.outputHidden && collapsed === true) ||\n-        (!this.outputHidden && collapsed === undefined)\n-      ) {\n-        return;\n-      }\n+        if (\n+          (this.outputHidden && collapsed === true) ||\n+          (!this.outputHidden && collapsed === undefined)\n+        ) {\n+          return;\n+        }\n \n-      // Do not set jupyter.outputs_hidden since it is redundant. See\n-      // and https://github.com/jupyter/nbformat/issues/137\n-      if (this.outputHidden) {\n-        this.model.setMetadata('collapsed', true);\n-      } else {\n-        this.model.deleteMetadata('collapsed');\n-      }\n-    }, false);\n+        // Do not set jupyter.outputs_hidden since it is redundant. See\n+        // and https://github.com/jupyter/nbformat/issues/137\n+        if (this.outputHidden) {\n+          this.model.setMetadata('collapsed', true);\n+        } else {\n+          this.model.deleteMetadata('collapsed');\n+        }\n+      },\n+      false,\n+      'silent-change'\n+    );\n   }\n \n   /**\n@@ -1722,9 +1726,13 @@ export namespace CodeCell {\n     const model = cell.model;\n     const code = model.sharedModel.getSource();\n     if (!code.trim() || !sessionContext.session?.kernel) {\n-      model.sharedModel.transact(() => {\n-        model.clearExecution();\n-      }, false);\n+      model.sharedModel.transact(\n+        () => {\n+          model.clearExecution();\n+        },\n+        false,\n+        'silent-change'\n+      );\n       return;\n     }\n     const cellId = { cellId: model.sharedModel.getId() };\n@@ -1734,10 +1742,14 @@ export namespace CodeCell {\n       ...cellId\n     };\n     const { recordTiming } = metadata;\n-    model.sharedModel.transact(() => {\n-      model.clearExecution();\n-      cell.outputHidden = false;\n-    }, false);\n+    model.sharedModel.transact(\n+      () => {\n+        model.clearExecution();\n+        cell.outputHidden = false;\n+      },\n+      false,\n+      'silent-change'\n+    );\n     // note: in future we would like to distinguish running from scheduled\n     model.executionState = 'running';\n     model.trusted = true;\n\ndiff --git a/packages/codeeditor/package.json b/packages/codeeditor/package.json\nindex a5b70d8f2916..d2632800a0e7 100644\n--- a/packages/codeeditor/package.json\n+++ b/packages/codeeditor/package.json\n@@ -42,7 +42,7 @@\n   },\n   \"dependencies\": {\n     \"@codemirror/state\": \"^6.4.1\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.2\",\n     \"@jupyterlab/nbformat\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/codemirror-extension/package.json b/packages/codemirror-extension/package.json\nindex cbf3dfb5c4ae..efdcf1157ba6 100644\n--- a/packages/codemirror-extension/package.json\n+++ b/packages/codemirror-extension/package.json\n@@ -43,7 +43,7 @@\n     \"@codemirror/legacy-modes\": \"^6.4.0\",\n     \"@codemirror/search\": \"^6.5.6\",\n     \"@codemirror/view\": \"^6.26.3\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/codemirror/package.json b/packages/codemirror/package.json\nindex 0f5da03756f0..8e3e5be14ab1 100644\n--- a/packages/codemirror/package.json\n+++ b/packages/codemirror/package.json\n@@ -57,7 +57,7 @@\n     \"@codemirror/search\": \"^6.5.6\",\n     \"@codemirror/state\": \"^6.4.1\",\n     \"@codemirror/view\": \"^6.26.3\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.2\",\n     \"@jupyterlab/documentsearch\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/completer/package.json b/packages/completer/package.json\nindex 381b86c9fbe8..4de131624a6e 100644\n--- a/packages/completer/package.json\n+++ b/packages/completer/package.json\n@@ -47,7 +47,7 @@\n   \"dependencies\": {\n     \"@codemirror/state\": \"^6.4.1\",\n     \"@codemirror/view\": \"^6.26.3\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/console/package.json b/packages/console/package.json\nindex 3709fce8d48d..7b804091a67b 100644\n--- a/packages/console/package.json\n+++ b/packages/console/package.json\n@@ -42,7 +42,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/cells\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex 9d17269352eb..fd0844f9ec0d 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -51,7 +51,7 @@\n     \"@codemirror/state\": \"^6.4.1\",\n     \"@codemirror/view\": \"^6.26.3\",\n     \"@jupyter/react-components\": \"^0.16.6\",\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/cells\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/docregistry/package.json b/packages/docregistry/package.json\nindex 28add772d6cd..96fc0ad0ef07 100644\n--- a/packages/docregistry/package.json\n+++ b/packages/docregistry/package.json\n@@ -41,7 +41,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.2\",\n\ndiff --git a/packages/fileeditor/package.json b/packages/fileeditor/package.json\nindex 4221535c9da1..2e5c1841f892 100644\n--- a/packages/fileeditor/package.json\n+++ b/packages/fileeditor/package.json\n@@ -39,7 +39,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/notebook-extension/package.json b/packages/notebook-extension/package.json\nindex 40a1fb5ecd92..d89e77cd9ee9 100644\n--- a/packages/notebook-extension/package.json\n+++ b/packages/notebook-extension/package.json\n@@ -36,7 +36,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/cells\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/notebook/package.json b/packages/notebook/package.json\nindex 01941ec56184..c9979ded8d89 100644\n--- a/packages/notebook/package.json\n+++ b/packages/notebook/package.json\n@@ -40,7 +40,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.2\",\n     \"@jupyterlab/cells\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/codeeditor\": \"^4.3.0-alpha.2\",\n\ndiff --git a/packages/outputarea/src/model.ts b/packages/outputarea/src/model.ts\nindex 11ff15a2fa8a..ac23935d55bd 100644\n--- a/packages/outputarea/src/model.ts\n+++ b/packages/outputarea/src/model.ts\n@@ -2,7 +2,11 @@\n // Distributed under the terms of the Modified BSD License.\n \n import * as nbformat from '@jupyterlab/nbformat';\n-import { IObservableList, ObservableList } from '@jupyterlab/observables';\n+import {\n+  IObservableList,\n+  IObservableString,\n+  ObservableList\n+} from '@jupyterlab/observables';\n import { IOutputModel, OutputModel } from '@jupyterlab/rendermime';\n import { map } from '@lumino/algorithm';\n import { JSONExt } from '@lumino/coreutils';\n@@ -56,6 +60,11 @@ export interface IOutputAreaModel extends IDisposable {\n    */\n   add(output: nbformat.IOutput): number;\n \n+  /**\n+   * Remove an output at a given index.\n+   */\n+  remove(index: number): void;\n+\n   /**\n    * Set the value at the specified index.\n    */\n@@ -255,13 +264,20 @@ export class OutputAreaModel implements IOutputAreaModel {\n     return this._add(output);\n   }\n \n+  /**\n+   * Remove an output at a given index.\n+   */\n+  remove(index: number): void {\n+    this.list.remove(index)?.dispose();\n+  }\n+\n   /**\n    * Clear all of the output.\n    *\n    * @param wait Delay clearing the output until the next message is added.\n    */\n   clear(wait: boolean = false): void {\n-    this._lastStream = '';\n+    this._lastStreamName = '';\n     if (wait) {\n       this.clearNext = true;\n       return;\n@@ -309,44 +325,45 @@ export class OutputAreaModel implements IOutputAreaModel {\n     // Consolidate outputs if they are stream outputs of the same kind.\n     if (\n       nbformat.isStream(value) &&\n-      this._lastStream &&\n-      value.name === this._lastName &&\n+      value.name === this._lastStreamName &&\n       this.shouldCombine({\n         value,\n         lastModel: this.list.get(this.length - 1)\n       })\n     ) {\n-      // In order to get a list change event, we add the previous\n-      // text to the current item and replace the previous item.\n-      // This also replaces the metadata of the last item.\n-      this._lastStream += value.text as string;\n-      this._lastStream = Private.removeOverwrittenChars(this._lastStream);\n-      value.text = this._lastStream;\n-      const item = this._createItem({ value, trusted });\n-      const index = this.length - 1;\n-      const prev = this.list.get(index);\n-      this.list.set(index, item);\n-      prev.dispose();\n+      // We append the new text to the current text.\n+      // This creates a text change event.\n+      const prev = this.list.get(this.length - 1) as IOutputModel;\n+      const curText = prev.streamText!;\n+      const newText =\n+        typeof value.text === 'string' ? value.text : value.text.join('');\n+      Private.addText(curText, newText);\n       return this.length;\n     }\n \n+    let newText = '';\n     if (nbformat.isStream(value)) {\n-      value.text = Private.removeOverwrittenChars(value.text as string);\n+      newText =\n+        typeof value.text === 'string' ? value.text : value.text.join('');\n+      value.text = '';\n     }\n \n     // Create the new item.\n     const item = this._createItem({ value, trusted });\n \n+    // Add the item to our list and return the new length.\n+    const length = this.list.push(item);\n+\n     // Update the stream information.\n     if (nbformat.isStream(value)) {\n-      this._lastStream = value.text as string;\n-      this._lastName = value.name;\n+      this._lastStreamName = value.name;\n+      const curText = item.streamText!;\n+      Private.addText(curText, newText);\n     } else {\n-      this._lastStream = '';\n+      this._lastStreamName = '';\n     }\n \n-    // Add the item to our list and return the new length.\n-    return this.list.push(item);\n+    return length;\n   }\n \n   /**\n@@ -437,8 +454,7 @@ export class OutputAreaModel implements IOutputAreaModel {\n     }\n   }\n \n-  private _lastStream = '';\n-  private _lastName: 'stdout' | 'stderr';\n+  private _lastStreamName: '' | 'stdout' | 'stderr' = '';\n   private _trusted = false;\n   private _isDisposed = false;\n   private _stateChanged = new Signal<OutputAreaModel, number>(this);\n@@ -484,38 +500,63 @@ namespace Private {\n     }\n   }\n \n-  /**\n-   * Remove characters that are overridden by backspace characters.\n-   */\n-  function fixBackspace(txt: string): string {\n-    let tmp = txt;\n-    do {\n-      txt = tmp;\n-      // Cancel out anything-but-newline followed by backspace\n-      tmp = txt.replace(/[^\\n]\\x08/gm, ''); // eslint-disable-line no-control-regex\n-    } while (tmp.length < txt.length);\n-    return txt;\n-  }\n-\n-  /**\n-   * Remove chunks that should be overridden by the effect of\n-   * carriage return characters.\n-   */\n-  function fixCarriageReturn(txt: string): string {\n-    txt = txt.replace(/\\r+\\n/gm, '\\n'); // \\r followed by \\n --> newline\n-    while (txt.search(/\\r[^$]/g) > -1) {\n-      const base = txt.match(/^(.*)\\r+/m)![1];\n-      let insert = txt.match(/\\r+(.*)$/m)![1];\n-      insert = insert + base.slice(insert.length, base.length);\n-      txt = txt.replace(/\\r+.*$/m, '\\r').replace(/^.*\\r/m, insert);\n-    }\n-    return txt;\n-  }\n-\n   /*\n-   * Remove characters overridden by backspaces and carriage returns\n-   */\n-  export function removeOverwrittenChars(text: string): string {\n-    return fixCarriageReturn(fixBackspace(text));\n+   * Concatenate a string to an observable string, handling backspaces.\n+   */\n+  export function addText(curText: IObservableString, newText: string): void {\n+    let text = curText.text;\n+    let idx0 = text.length;\n+    for (let idx1 = 0; idx1 < newText.length; idx1++) {\n+      const newChar = newText[idx1];\n+      if (newChar === '\\b') {\n+        // Backspace: delete previous character if there is one and if it's not a line feed.\n+        if (idx0 > 0 && text[idx0 - 1] !== '\\n') {\n+          text = text.slice(0, idx0 - 1) + text.slice(idx0 + 1);\n+          idx0--;\n+        }\n+      } else if (newChar === '\\r') {\n+        // Carriage return: go back to beginning of line.\n+        let done = false;\n+        while (!done) {\n+          if (idx0 === 0) {\n+            done = true;\n+          } else if (text[idx0 - 1] === '\\n') {\n+            done = true;\n+          } else {\n+            idx0--;\n+          }\n+        }\n+      } else if (newChar === '\\n') {\n+        // Insert new line at end of text.\n+        text = text + '\\n';\n+        idx0 = text.length;\n+      } else {\n+        // Insert character at current position.\n+        text = text.slice(0, idx0) + newChar + text.slice(idx0 + 1);\n+        idx0++;\n+      }\n+    }\n+    // Compute the difference between current text and new text.\n+    let done = false;\n+    let idx = 0;\n+    while (!done) {\n+      if (idx === text.length) {\n+        if (idx !== curText.text.length) {\n+          curText.remove(idx, curText.text.length);\n+          done = true;\n+        }\n+      } else if (idx === curText.text.length) {\n+        if (idx !== text.length) {\n+          curText.insert(curText.text.length, text.slice(idx));\n+          done = true;\n+        }\n+      } else if (text[idx] !== curText.text[idx]) {\n+        curText.remove(idx, curText.text.length);\n+        curText.insert(idx, text.slice(idx));\n+        done = true;\n+      } else {\n+        idx++;\n+      }\n+    }\n   }\n }\n\ndiff --git a/packages/outputarea/src/widget.ts b/packages/outputarea/src/widget.ts\nindex 5f51560d791f..2ec8ed169aa5 100644\n--- a/packages/outputarea/src/widget.ts\n+++ b/packages/outputarea/src/widget.ts\n@@ -3,6 +3,7 @@\n \n import { ISessionContext, WidgetTracker } from '@jupyterlab/apputils';\n import * as nbformat from '@jupyterlab/nbformat';\n+import { IObservableString } from '@jupyterlab/observables';\n import { IOutputModel, IRenderMimeRegistry } from '@jupyterlab/rendermime';\n import { IRenderMime } from '@jupyterlab/rendermime-interfaces';\n import { Kernel, KernelMessage } from '@jupyterlab/services';\n@@ -283,7 +284,19 @@ export class OutputArea extends Widget {\n   ): void {\n     switch (args.type) {\n       case 'add':\n-        this._insertOutput(args.newIndex, args.newValues[0]);\n+        const output = args.newValues[0];\n+        this._insertOutput(args.newIndex, output);\n+        if (output.type === 'stream') {\n+          // A stream ouput has been added, follow changes to the text.\n+          output.streamText!.changed.connect(\n+            (\n+              sender: IObservableString,\n+              event: IObservableString.IChangedArgs\n+            ) => {\n+              this._setOutput(args.newIndex, output);\n+            }\n+          );\n+        }\n         break;\n       case 'remove':\n         if (this.widgets.length) {\n\ndiff --git a/packages/rendermime/src/outputmodel.ts b/packages/rendermime/src/outputmodel.ts\nindex 3650bbc307f0..f21b9add4b94 100644\n--- a/packages/rendermime/src/outputmodel.ts\n+++ b/packages/rendermime/src/outputmodel.ts\n@@ -3,7 +3,12 @@\n | Distributed under the terms of the Modified BSD License.\n |----------------------------------------------------------------------------*/\n import * as nbformat from '@jupyterlab/nbformat';\n-import { IObservableJSON, ObservableJSON } from '@jupyterlab/observables';\n+import {\n+  IObservableJSON,\n+  IObservableString,\n+  ObservableJSON,\n+  ObservableString\n+} from '@jupyterlab/observables';\n import { IRenderMime } from '@jupyterlab/rendermime-interfaces';\n import {\n   JSONExt,\n@@ -35,6 +40,11 @@ export interface IOutputModel extends IRenderMime.IMimeModel {\n    */\n   readonly executionCount: nbformat.ExecutionCount;\n \n+  /**\n+   * The observable text, present when the output `type` is set to `\"stream\"`.\n+   */\n+  readonly streamText?: IObservableString;\n+\n   /**\n    * Whether the output is trusted.\n    */\n@@ -80,8 +90,14 @@ export class OutputModel implements IOutputModel {\n    */\n   constructor(options: IOutputModel.IOptions) {\n     const { data, metadata, trusted } = Private.getBundleOptions(options);\n-    this._data = new ObservableJSON({ values: data as JSONObject });\n     this._rawData = data;\n+    if (options.value !== undefined && nbformat.isStream(options.value)) {\n+      this._text = new ObservableString(\n+        typeof options.value.text === 'string'\n+          ? options.value.text\n+          : options.value.text.join('')\n+      );\n+    }\n     this._metadata = new ObservableJSON({ values: metadata as JSONObject });\n     this._rawMetadata = metadata;\n     this.trusted = trusted;\n@@ -131,7 +147,7 @@ export class OutputModel implements IOutputModel {\n    * Dispose of the resources used by the output model.\n    */\n   dispose(): void {\n-    this._data.dispose();\n+    this._text?.dispose();\n     this._metadata.dispose();\n     Signal.clearData(this);\n   }\n@@ -140,7 +156,11 @@ export class OutputModel implements IOutputModel {\n    * The data associated with the model.\n    */\n   get data(): ReadonlyPartialJSONObject {\n-    return this._rawData;\n+    return Private.getData(this.toJSON());\n+  }\n+\n+  get streamText(): IObservableString | undefined {\n+    return this._text;\n   }\n \n   /**\n@@ -159,7 +179,6 @@ export class OutputModel implements IOutputModel {\n    */\n   setData(options: IRenderMime.IMimeModel.ISetDataOptions): void {\n     if (options.data) {\n-      this._updateObservable(this._data, options.data);\n       this._rawData = options.data;\n     }\n     if (options.metadata) {\n@@ -177,11 +196,14 @@ export class OutputModel implements IOutputModel {\n     for (const key in this._raw) {\n       output[key] = Private.extract(this._raw, key);\n     }\n+    if (this._text !== undefined) {\n+      output['text'] = this._text.text;\n+    }\n     switch (this.type) {\n       case 'display_data':\n       case 'execute_result':\n       case 'update_display_data':\n-        output['data'] = this.data as PartialJSONObject;\n+        output['data'] = this._rawData as PartialJSONObject;\n         output['metadata'] = this.metadata as PartialJSONObject;\n         break;\n       default:\n@@ -223,7 +245,7 @@ export class OutputModel implements IOutputModel {\n   private _raw: PartialJSONObject = {};\n   private _rawMetadata: ReadonlyPartialJSONObject;\n   private _rawData: ReadonlyPartialJSONObject;\n-  private _data: IObservableJSON;\n+  private _text?: IObservableString = undefined;\n   private _metadata: IObservableJSON;\n }\n \n\ndiff --git a/packages/services/package.json b/packages/services/package.json\nindex 81d6be2c7f53..fa946379f94b 100644\n--- a/packages/services/package.json\n+++ b/packages/services/package.json\n@@ -45,7 +45,7 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/ydoc\": \"^2.0.1\",\n+    \"@jupyter/ydoc\": \"^3.0.0-a2\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.2\",\n     \"@jupyterlab/nbformat\": \"^4.3.0-alpha.2\",\n     \"@jupyterlab/settingregistry\": \"^4.3.0-alpha.2\",\n\ndiff --git a/yarn.lock b/yarn.lock\nindex a9e95ce89099..c8620ad56cb7 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2074,9 +2074,9 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@jupyter/ydoc@npm:^2.0.1\":\n-  version: 2.0.1\n-  resolution: \"@jupyter/ydoc@npm:2.0.1\"\n+\"@jupyter/ydoc@npm:^3.0.0-a2\":\n+  version: 3.0.0-a2\n+  resolution: \"@jupyter/ydoc@npm:3.0.0-a2\"\n   dependencies:\n     \"@jupyterlab/nbformat\": ^3.0.0 || ^4.0.0-alpha.21 || ^4.0.0\n     \"@lumino/coreutils\": ^1.11.0 || ^2.0.0\n@@ -2084,7 +2084,7 @@ __metadata:\n     \"@lumino/signaling\": ^1.10.0 || ^2.0.0\n     y-protocols: ^1.0.5\n     yjs: ^13.5.40\n-  checksum: f5f29e1ff3327ebc1cf326f53634e03c4c7bf7733d235087fe26975c16eebd404f23c2f3ba88b6e04b1927846be7162b09b8b8719a4b29e51d0299c745018cbb\n+  checksum: 4d4e48ce604544f90ee584f7c9bae4efaa8e2b7dd01ab1f6d2a97f8f9d221be7055a60bd128eb1010f8ff4a478c53827f47eb60875e8fc67bfba5298a068b2a0\n   languageName: node\n   linkType: hard\n \n@@ -2408,7 +2408,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/cell-toolbar@workspace:packages/cell-toolbar\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/cells\": ^4.3.0-alpha.2\n     \"@jupyterlab/docregistry\": ^4.3.0-alpha.2\n@@ -2434,7 +2434,7 @@ __metadata:\n   dependencies:\n     \"@codemirror/state\": ^6.4.1\n     \"@codemirror/view\": ^6.26.3\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/attachments\": ^4.3.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n@@ -2490,7 +2490,7 @@ __metadata:\n   resolution: \"@jupyterlab/codeeditor@workspace:packages/codeeditor\"\n   dependencies:\n     \"@codemirror/state\": ^6.4.1\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/coreutils\": ^6.3.0-alpha.2\n     \"@jupyterlab/nbformat\": ^4.3.0-alpha.2\n@@ -2523,7 +2523,7 @@ __metadata:\n     \"@codemirror/legacy-modes\": ^6.4.0\n     \"@codemirror/search\": ^6.5.6\n     \"@codemirror/view\": ^6.26.3\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/application\": ^4.3.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.2\n@@ -2566,7 +2566,7 @@ __metadata:\n     \"@codemirror/search\": ^6.5.6\n     \"@codemirror/state\": ^6.4.1\n     \"@codemirror/view\": ^6.26.3\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n     \"@jupyterlab/coreutils\": ^6.3.0-alpha.2\n     \"@jupyterlab/documentsearch\": ^4.3.0-alpha.2\n@@ -2613,7 +2613,7 @@ __metadata:\n   dependencies:\n     \"@codemirror/state\": ^6.4.1\n     \"@codemirror/view\": ^6.26.3\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.2\n@@ -2669,7 +2669,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/console@workspace:packages/console\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/cells\": ^4.3.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n@@ -2797,7 +2797,7 @@ __metadata:\n     \"@codemirror/state\": ^6.4.1\n     \"@codemirror/view\": ^6.26.3\n     \"@jupyter/react-components\": ^0.16.6\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/application\": ^4.3.0-alpha.2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/cells\": ^4.3.0-alpha.2\n@@ -2893,7 +2893,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/docregistry@workspace:packages/docregistry\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n     \"@jupyterlab/coreutils\": ^6.3.0-alpha.2\n@@ -3014,7 +3014,7 @@ __metadata:\n   resolution: \"@jupyterlab/example-cell@workspace:examples/cell\"\n   dependencies:\n     \"@jupyter/web-components\": ^0.16.6\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/application\": ^4.3.0-alpha.2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/cells\": ^4.3.0-alpha.2\n@@ -3043,7 +3043,7 @@ __metadata:\n   resolution: \"@jupyterlab/example-console@workspace:examples/console\"\n   dependencies:\n     \"@jupyter/web-components\": ^0.16.6\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/application\": ^4.3.0-alpha.2\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.2\n     \"@jupyterlab/console\": ^4.3.0-alpha.2\n@@ -3189,7 +3189,7 @@ __metadata:\n   resolution: \"@jupyterlab/example-notebook@workspace:examples/notebook\"\n   dependencies:\n     \"@jupyter/web-components\": ^0.16.6\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/application\": ^4.3.0-alpha.2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.2\n@@ -3430,7 +3430,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/fileeditor@workspace:packages/fileeditor\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.2\n@@ -4198,7 +4198,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/notebook-extension@workspace:packages/notebook-extension\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/application\": ^4.3.0-alpha.2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/cells\": ^4.3.0-alpha.2\n@@ -4246,7 +4246,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/notebook@workspace:packages/notebook\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.2\n     \"@jupyterlab/cells\": ^4.3.0-alpha.2\n     \"@jupyterlab/codeeditor\": ^4.3.0-alpha.2\n@@ -4520,7 +4520,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/services@workspace:packages/services\"\n   dependencies:\n-    \"@jupyter/ydoc\": ^2.0.1\n+    \"@jupyter/ydoc\": ^3.0.0-a2\n     \"@jupyterlab/coreutils\": ^6.3.0-alpha.2\n     \"@jupyterlab/nbformat\": ^4.3.0-alpha.2\n     \"@jupyterlab/settingregistry\": ^4.3.0-alpha.2\n",
    "test_patch": "diff --git a/packages/cells/test/model.spec.ts b/packages/cells/test/model.spec.ts\nindex f3ef0c0b7ac3..a389f4648ef3 100644\n--- a/packages/cells/test/model.spec.ts\n+++ b/packages/cells/test/model.spec.ts\n@@ -614,7 +614,9 @@ describe('cells/model', () => {\n         } as any;\n         model['onOutputsChange'](null as any, newEvent0);\n         expect(sharedModel.ymodel.get('outputs').length).toBe(1);\n-        expect(sharedModel.ymodel.get('outputs').get(0)).toEqual(output0);\n+        expect(sharedModel.ymodel.get('outputs').get(0).toJSON()).toEqual(\n+          output0\n+        );\n \n         const newEvent1 = {\n           type: 'add',\n@@ -625,7 +627,9 @@ describe('cells/model', () => {\n         } as any;\n         model['onOutputsChange'](null as any, newEvent1);\n         expect(sharedModel.ymodel.get('outputs').length).toBe(2);\n-        expect(sharedModel.ymodel.get('outputs').get(1)).toEqual(output1);\n+        expect(sharedModel.ymodel.get('outputs').get(1).toJSON()).toEqual(\n+          output1\n+        );\n       });\n \n       it('should set new items correctly', () => {\n@@ -644,7 +648,9 @@ describe('cells/model', () => {\n         } as any;\n         model['onOutputsChange'](null as any, newEvent0);\n         expect(sharedModel.ymodel.get('outputs').length).toBe(2);\n-        expect(sharedModel.ymodel.get('outputs').get(0)).toEqual(output2);\n+        expect(sharedModel.ymodel.get('outputs').get(0).toJSON()).toEqual(\n+          output2\n+        );\n         const newEvent1 = {\n           type: 'set',\n           newValues: [{ toJSON: () => output2 }],\n@@ -654,7 +660,9 @@ describe('cells/model', () => {\n         } as any;\n         model['onOutputsChange'](null as any, newEvent1);\n         expect(sharedModel.ymodel.get('outputs').length).toBe(2);\n-        expect(sharedModel.ymodel.get('outputs').get(1)).toEqual(output2);\n+        expect(sharedModel.ymodel.get('outputs').get(1).toJSON()).toEqual(\n+          output2\n+        );\n       });\n \n       it('should remove items correctly', () => {\n\ndiff --git a/packages/outputarea/test/widget.spec.ts b/packages/outputarea/test/widget.spec.ts\nindex e4aec01ff024..38687a8d5c17 100644\n--- a/packages/outputarea/test/widget.spec.ts\n+++ b/packages/outputarea/test/widget.spec.ts\n@@ -323,15 +323,28 @@ describe('outputarea/widget', () => {\n         expect(widget.widgets.length).toBe(0);\n       });\n \n-      it('should handle a set', () => {\n+      it('should handle stream outputs of same name', () => {\n         widget.model.clear();\n+        // An initial stdout stream creates an output.\n         widget.model.add(DEFAULT_OUTPUTS[0]);\n+        expect(widget.methods).toEqual(\n+          expect.arrayContaining(['onModelChanged'])\n+        );\n+        // Another stdout stream only changes the \"text\" of the last output.\n         widget.methods = [];\n         widget.model.add(DEFAULT_OUTPUTS[0]);\n+        expect(widget.methods).toEqual([]);\n+        // A stderr stream creates a new output.\n+        widget.methods = [];\n+        widget.model.add(DEFAULT_OUTPUTS[1]);\n         expect(widget.methods).toEqual(\n           expect.arrayContaining(['onModelChanged'])\n         );\n-        expect(widget.widgets.length).toBe(1);\n+        // Another stderr stream only changes the \"text\" of the last output.\n+        widget.methods = [];\n+        widget.model.add(DEFAULT_OUTPUTS[1]);\n+        expect(widget.methods).toEqual([]);\n+        expect(widget.widgets.length).toBe(2);\n       });\n \n       it('should rerender when preferred mimetype changes', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16496",
    "pr_id": 16496,
    "issue_id": 15423,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Some focus indicators have poor visibility in dark mode\n## Description\r\n\r\nSome (default?) focus indicators like these three are poorly visible and inconsistent with other focus indicators we use\r\n\r\n![Screenshot from 2023-11-17 18-23-57](https://github.com/jupyterlab/jupyterlab/assets/5832902/524892c3-e190-453f-bd9b-27547868d3e8)\r\n![Screenshot from 2023-11-17 18-27-58](https://github.com/jupyterlab/jupyterlab/assets/5832902/b6ce79ad-5f63-4920-a312-66ab24f497a9)\r\n![Screenshot from 2023-11-17 18-23-42](https://github.com/jupyterlab/jupyterlab/assets/5832902/01666128-0605-407f-9382-82485608e5b7)\r\n\r\n## Expected behavior\r\n\r\nFocus indicators use the same, recognisable and contrastive style (colour/borders width/round radius) across application. Like:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/91b26583-6a88-451b-9fff-e5ecfb4b752f)\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/d89075eb-9e04-472f-a994-626fd2a7b03e)\r\n\r\n\r\n\r\n## Context\r\n\r\n- Operating System and version: Ubuntu\r\n- Browser and version: Chrome\r\n- JupyterLab version: 4.1.0a03",
    "issue_word_count": 148,
    "test_files_count": 32,
    "non_test_files_count": 22,
    "pr_changed_files": [
      "dev_mode/package.json",
      "examples/cell/package.json",
      "examples/console/package.json",
      "examples/filebrowser/package.json",
      "examples/notebook/example.spec.ts-snapshots/example-linux.png",
      "examples/notebook/package.json",
      "examples/terminal/package.json",
      "galata/test/documentation/customization.test.ts-snapshots/customized-notebook-toolbar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-notebook-toolbar-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-run-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-sidebar-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-variables-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-allowed-list-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-blocked-list-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-default-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-disabled-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-enabled-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-search-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-altair-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png",
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-off-jupyterlab-linux.png",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png",
      "galata/test/jupyterlab/notification.test.ts-snapshots/notification-center-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-extensionmanager-main-view-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-debugger-sidebar-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png",
      "packages/application/style/sidepanel.css",
      "packages/application/style/tabs.css",
      "packages/debugger/package.json",
      "packages/notebook/style/base.css",
      "packages/notebook/style/toolbar.css",
      "packages/running/src/index.tsx",
      "packages/running/style/base.css",
      "packages/ui-components/package.json",
      "packages/ui-components/src/components/htmlselect.tsx",
      "packages/ui-components/src/components/search.tsx",
      "packages/ui-components/src/components/toolbar.tsx",
      "packages/ui-components/style/base.css",
      "packages/ui-components/style/sidepanel.css",
      "packages/ui-components/style/toolbar.css",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/customization.test.ts-snapshots/customized-notebook-toolbar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-notebook-toolbar-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-run-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-sidebar-documentation-linux.png",
      "galata/test/documentation/debugger.test.ts-snapshots/debugger-variables-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-allowed-list-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-blocked-list-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-default-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-disabled-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-enabled-documentation-linux.png",
      "galata/test/documentation/extension_manager.test.ts-snapshots/extensions-search-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-altair-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png",
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-off-jupyterlab-linux.png",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png",
      "galata/test/jupyterlab/notification.test.ts-snapshots/notification-center-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-extensionmanager-main-view-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-debugger-sidebar-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png"
    ],
    "base_commit": "654be6c76f97052c9f5feb73cf7da28264e93d44",
    "head_commit": "f5a9a8d587297c7c4abe9e37c7ac05f09e471e3b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16496",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16496",
    "dockerfile": "",
    "pr_merged_at": "2024-07-05T07:57:16.000Z",
    "patch": "diff --git a/dev_mode/package.json b/dev_mode/package.json\nindex 97b474417055..59b5bcc627e0 100644\n--- a/dev_mode/package.json\n+++ b/dev_mode/package.json\n@@ -20,8 +20,8 @@\n     \"@codemirror/language\": \"^6.0.0\",\n     \"@codemirror/state\": \"^6.2.0\",\n     \"@codemirror/view\": \"^6.9.6\",\n-    \"@jupyter/react-components\": \"^0.15.3\",\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/react-components\": \"^0.16.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyter/ydoc\": \"^2.0.1\",\n     \"@jupyterlab/application\": \"~4.3.0-alpha.1\",\n     \"@jupyterlab/application-extension\": \"~4.3.0-alpha.1\",\n\ndiff --git a/examples/cell/package.json b/examples/cell/package.json\nindex 36639d15086f..37f4716f3ddc 100644\n--- a/examples/cell/package.json\n+++ b/examples/cell/package.json\n@@ -7,7 +7,7 @@\n     \"clean\": \"rimraf build\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyter/ydoc\": \"^2.0.1\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n\ndiff --git a/examples/console/package.json b/examples/console/package.json\nindex fb90ca704cb3..6d69fed8452e 100644\n--- a/examples/console/package.json\n+++ b/examples/console/package.json\n@@ -7,7 +7,7 @@\n     \"clean\": \"rimraf build\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyter/ydoc\": \"^2.0.1\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.1\",\n\ndiff --git a/examples/filebrowser/package.json b/examples/filebrowser/package.json\nindex 2ccbe66f0286..c87833b60620 100644\n--- a/examples/filebrowser/package.json\n+++ b/examples/filebrowser/package.json\n@@ -7,7 +7,7 @@\n     \"clean\": \"rimraf build\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n     \"@jupyterlab/codemirror\": \"^4.3.0-alpha.1\",\n\ndiff --git a/examples/notebook/example.spec.ts-snapshots/example-linux.png b/examples/notebook/example.spec.ts-snapshots/example-linux.png\nindex 8a09ec72d3b8..1b04cd720b22 100644\nBinary files a/examples/notebook/example.spec.ts-snapshots/example-linux.png and b/examples/notebook/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/notebook/package.json b/examples/notebook/package.json\nindex 51233cdf77c8..1593393f32a7 100644\n--- a/examples/notebook/package.json\n+++ b/examples/notebook/package.json\n@@ -7,7 +7,7 @@\n     \"clean\": \"rimraf build\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyter/ydoc\": \"^2.0.1\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n\ndiff --git a/examples/terminal/package.json b/examples/terminal/package.json\nindex fd02accd3554..6e3bbce21e4f 100644\n--- a/examples/terminal/package.json\n+++ b/examples/terminal/package.json\n@@ -7,7 +7,7 @@\n     \"clean\": \"rimraf build\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.3.0-alpha.1\",\n\ndiff --git a/packages/application/style/sidepanel.css b/packages/application/style/sidepanel.css\nindex 7d8209b5a99e..e9e402f86597 100644\n--- a/packages/application/style/sidepanel.css\n+++ b/packages/application/style/sidepanel.css\n@@ -53,8 +53,9 @@\n }\n \n .jp-SideBar .lm-TabBar-tab:focus-visible {\n-  outline: 4px solid var(--jp-accept-color-active, var(--jp-brand-color1));\n-  outline-offset: -1px;\n+  /* --accent-fill-focus is computed by the jp toolkit to ensure accessibility */\n+  outline: 2px solid var(--accent-fill-focus, var(--jp-brand-color1));\n+  outline-offset: -3px;\n }\n \n .jp-SideBar .lm-TabBar-tab.lm-mod-current::after {\n\ndiff --git a/packages/application/style/tabs.css b/packages/application/style/tabs.css\nindex da03446184cd..2deb2ef2e51d 100644\n--- a/packages/application/style/tabs.css\n+++ b/packages/application/style/tabs.css\n@@ -60,6 +60,22 @@\n   position: relative;\n }\n \n+.lm-DockPanel-tabBar .lm-TabBar-tab:focus-visible,\n+.lm-DockPanel-tabBar .lm-TabBar-addButton:focus-visible,\n+.lm-TabPanel-tabBar .lm-TabBar-tab:focus-visible {\n+  border: 1px solid var(--accent-fill-focus);\n+  border-bottom: none;\n+\n+  /* Thicken the border by 1px within the element border */\n+  box-shadow: 0 0 0 1px inset var(--accent-fill-focus);\n+  outline: none;\n+}\n+\n+.lm-DockPanel-tabBar .lm-TabBar-tab:not(.lm-mod-current):focus-visible::after,\n+.lm-TabPanel-tabBar .lm-TabBar-tab:not(.lm-mod-current):focus-visible::after {\n+  border-bottom-color: var(--accent-fill-focus);\n+}\n+\n .lm-DockPanel-tabBar .lm-TabBar-tab:hover:not(.lm-mod-current),\n .lm-TabPanel-tabBar .lm-TabBar-tab:hover:not(.lm-mod-current) {\n   background: var(--jp-layout-color1);\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex eaa4f258c00e..1ade72b016bf 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -50,7 +50,7 @@\n   \"dependencies\": {\n     \"@codemirror/state\": \"^6.4.1\",\n     \"@codemirror/view\": \"^6.26.3\",\n-    \"@jupyter/react-components\": \"^0.15.3\",\n+    \"@jupyter/react-components\": \"^0.16.3\",\n     \"@jupyter/ydoc\": \"^2.0.1\",\n     \"@jupyterlab/application\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/apputils\": \"^4.4.0-alpha.1\",\n\ndiff --git a/packages/notebook/style/base.css b/packages/notebook/style/base.css\nindex 2f7fb43c560b..b2360ea6da0b 100644\n--- a/packages/notebook/style/base.css\n+++ b/packages/notebook/style/base.css\n@@ -288,11 +288,6 @@\n   line-height: 1.4;\n }\n \n-.jp-NotebookTools .jp-select-wrapper {\n-  margin-top: 4px;\n-  margin-bottom: 0;\n-}\n-\n .jp-NumberSetter input {\n   width: 100%;\n   margin-top: 4px;\n\ndiff --git a/packages/notebook/style/toolbar.css b/packages/notebook/style/toolbar.css\nindex c14228aaff39..6e31c9b21b5b 100644\n--- a/packages/notebook/style/toolbar.css\n+++ b/packages/notebook/style/toolbar.css\n@@ -8,7 +8,7 @@\n |----------------------------------------------------------------------------*/\n \n :root {\n-  --jp-notebook-toolbar-padding: 2px 5px 2px 2px;\n+  --jp-notebook-toolbar-padding: 0 5px 0 2px;\n }\n \n /*-----------------------------------------------------------------------------\n@@ -24,23 +24,6 @@\n   contain: style size !important;\n }\n \n-.jp-Toolbar-item.jp-Notebook-toolbarCellType .jp-select-wrapper.jp-mod-focused {\n-  border: none;\n-  box-shadow: none;\n-}\n-\n-.jp-Notebook-toolbarCellTypeDropdown select {\n-  height: 24px;\n-  font-size: var(--jp-ui-font-size1);\n-  line-height: 14px;\n-  border-radius: 0;\n-  display: block;\n-}\n-\n-.jp-Notebook-toolbarCellTypeDropdown select:focus-visible {\n-  outline-color: var(--accent-fill-focus);\n-}\n-\n .jp-Toolbar > .jp-Toolbar-responsive-opener {\n   margin-left: auto;\n }\n\ndiff --git a/packages/running/src/index.tsx b/packages/running/src/index.tsx\nindex aab5427bf298..59f588e1c011 100644\n--- a/packages/running/src/index.tsx\n+++ b/packages/running/src/index.tsx\n@@ -678,10 +678,10 @@ class Section extends PanelWithToolbar {\n     const inTreeView = hasNesting && !this._buttons['switch-view'].pressed;\n \n     this._buttons['switch-view'].node.style.display = hasNesting\n-      ? 'block'\n+      ? 'flex'\n       : 'none';\n     this._buttons['collapse-expand'].node.style.display = inTreeView\n-      ? 'block'\n+      ? 'flex'\n       : 'none';\n \n     this._buttons['collapse-expand'].enabled = enabled;\n\ndiff --git a/packages/running/style/base.css b/packages/running/style/base.css\nindex 6198f586634a..03e6d4b07b79 100644\n--- a/packages/running/style/base.css\n+++ b/packages/running/style/base.css\n@@ -94,10 +94,6 @@\n   color: var(--jp-ui-font-color3);\n }\n \n-.jp-RunningSessions-collapseButton {\n-  margin: 4px 2px;\n-}\n-\n .jp-RunningSessions-collapseButton[aria-pressed='true'] {\n   box-shadow: none;\n }\n@@ -181,31 +177,12 @@ span.jp-RunningSessions-icon > svg {\n \n .jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent {\n   color: var(--jp-warn-color1);\n-  background-color: transparent;\n-  border-radius: 2px;\n-  overflow: hidden;\n-  white-space: nowrap;\n-  text-overflow: ellipsis;\n-}\n-\n-.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent:hover {\n-  background-color: var(--jp-layout-color2);\n-}\n-\n-.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent:focus {\n-  border: none;\n-  box-shadow: none;\n-  background-color: var(--jp-layout-color2);\n }\n \n .jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent[disabled] {\n   color: var(--jp-ui-font-color2);\n }\n \n-.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent[disabled]:hover {\n-  background: none;\n-}\n-\n /*-----------------------------------------------------------------------------\n | SearchableSessions\n |----------------------------------------------------------------------------*/\n@@ -241,6 +218,9 @@ span.jp-RunningSessions-icon > svg {\n \n .jp-SearchableSessions-filter {\n   overflow: visible;\n+\n+  /* Required to display correctly the filter box and its focus highlight */\n+  padding: 0 2px;\n }\n \n .jp-SearchableSessions-filter > .jp-FilterBox {\n\ndiff --git a/packages/ui-components/package.json b/packages/ui-components/package.json\nindex e0471aa58b85..cf4691f9dd49 100644\n--- a/packages/ui-components/package.json\n+++ b/packages/ui-components/package.json\n@@ -40,8 +40,8 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@jupyter/react-components\": \"^0.15.3\",\n-    \"@jupyter/web-components\": \"^0.15.3\",\n+    \"@jupyter/react-components\": \"^0.16.3\",\n+    \"@jupyter/web-components\": \"^0.16.3\",\n     \"@jupyterlab/coreutils\": \"^6.3.0-alpha.1\",\n     \"@jupyterlab/observables\": \"^5.3.0-alpha.1\",\n     \"@jupyterlab/rendermime-interfaces\": \"^3.11.0-alpha.1\",\n\ndiff --git a/packages/ui-components/src/components/htmlselect.tsx b/packages/ui-components/src/components/htmlselect.tsx\nindex ed9fcc594ede..5de412fcd238 100644\n--- a/packages/ui-components/src/components/htmlselect.tsx\n+++ b/packages/ui-components/src/components/htmlselect.tsx\n@@ -95,8 +95,8 @@ export class HTMLSelect extends React.Component<IHTMLSelectProps> {\n           {...{\n             tag: 'span',\n             stylesheet: 'select',\n-            right: '7px',\n-            top: '5px',\n+            right: '4px',\n+            top: '8px',\n             ...iconProps\n           }}\n         />\n\ndiff --git a/packages/ui-components/src/components/search.tsx b/packages/ui-components/src/components/search.tsx\nindex 9218c3853ea8..215134b9e5aa 100644\n--- a/packages/ui-components/src/components/search.tsx\n+++ b/packages/ui-components/src/components/search.tsx\n@@ -2,7 +2,7 @@\n // Distributed under the terms of the Modified BSD License.\n import { ReactWidget } from './vdom';\n import { StringExt } from '@lumino/algorithm';\n-import React, { useEffect, useState } from 'react';\n+import React, { useCallback, useEffect, useState } from 'react';\n import { Search } from '@jupyter/react-components';\n import { searchIcon } from '../icon';\n \n@@ -177,26 +177,30 @@ export const FilterBox = (props: IFilterBoxProps): JSX.Element => {\n   /**\n    * Handler for search input changes.\n    */\n-  const handleChange = (e: React.FormEvent<HTMLElement>) => {\n-    const target = e.target as HTMLInputElement;\n-    setFilter(target.value);\n-    props.updateFilter(\n-      updateFilterFunction(\n-        target.value,\n-        props.useFuzzyFilter,\n-        props.caseSensitive\n-      ),\n-      target.value\n-    );\n-  };\n+  const handleChange = useCallback(\n+    (e: Event) => {\n+      const target = e.target as HTMLInputElement;\n+      setFilter(target.value);\n+      props.updateFilter(\n+        updateFilterFunction(\n+          target.value,\n+          props.useFuzzyFilter,\n+          props.caseSensitive\n+        ),\n+        target.value\n+      );\n+    },\n+    [props.updateFilter, props.useFuzzyFilter, props.caseSensitive]\n+  );\n \n   // Show the icon by default, or if the caller specifically requests it\n   const showSearchIcon = props.showIcon ?? true;\n \n+  // Cast typing is required because HTMLInputElement and JupyterSearch element types don't exactly match\n   return (\n     <Search\n       className=\"jp-FilterBox\"\n-      ref={props.inputRef}\n+      ref={props.inputRef as React.Ref<any>}\n       value={filter}\n       onChange={handleChange}\n       onInput={handleChange}\n\ndiff --git a/packages/ui-components/src/components/toolbar.tsx b/packages/ui-components/src/components/toolbar.tsx\nindex 4c1b8ad653e4..7fa2645d953b 100644\n--- a/packages/ui-components/src/components/toolbar.tsx\n+++ b/packages/ui-components/src/components/toolbar.tsx\n@@ -863,7 +863,7 @@ export function ToolbarButtonComponent(\n       onMouseDown={handleMouseDown}\n       onKeyDown={handleKeyDown}\n       title={title}\n-      minimal\n+      scale=\"xsmall\"\n     >\n       {(props.icon || props.iconClass) && (\n         <LabIcon.resolveReact\n\ndiff --git a/packages/ui-components/style/base.css b/packages/ui-components/style/base.css\nindex a2686de3cf7e..29332d90db4b 100644\n--- a/packages/ui-components/style/base.css\n+++ b/packages/ui-components/style/base.css\n@@ -22,6 +22,11 @@\n @import './toolbar.css';\n @import './windowedlist.css';\n \n+:root {\n+  /* Increase default density for Jupyter toolkit components */\n+  --density: -4;\n+}\n+\n body {\n   color: var(--jp-ui-font-color1);\n   font-size: var(--jp-ui-font-size1);\n@@ -156,6 +161,11 @@ input::placeholder {\n   padding: 6px;\n }\n \n+.jp-HTMLSelect.jp-DefaultStyle {\n+  /* Leave space for the focus outline */\n+  padding: 0 2px;\n+}\n+\n .jp-HTMLSelect.jp-DefaultStyle select {\n   background-color: initial;\n   border: none;\n@@ -184,6 +194,10 @@ input::placeholder {\n   cursor: not-allowed;\n }\n \n+.jp-HTMLSelect.jp-DefaultStyle select:focus-visible {\n+  outline: 2px solid var(--accent-fill-focus, var(--jp-brand-color1));\n+}\n+\n /* Use our own theme for hover and option styles */\n /* stylelint-disable-next-line selector-max-type */\n .jp-HTMLSelect.jp-DefaultStyle select:hover,\n\ndiff --git a/packages/ui-components/style/sidepanel.css b/packages/ui-components/style/sidepanel.css\nindex 13bf1bb24537..45a0c7901544 100644\n--- a/packages/ui-components/style/sidepanel.css\n+++ b/packages/ui-components/style/sidepanel.css\n@@ -46,6 +46,9 @@\n   box-sizing: border-box;\n   line-height: 25px;\n   margin: 0;\n+\n+  /* padding to allow for focus outline */\n+  padding: 2px;\n   display: flex;\n   align-items: center;\n   background: var(--jp-layout-color1);\n@@ -56,8 +59,9 @@\n }\n \n .lm-AccordionPanel .jp-AccordionPanel-title:focus-visible {\n-  outline: 4px solid var(--jp-accept-color-active, var(--jp-brand-color1));\n-  outline-offset: -1px;\n+  /* --accent-fill-focus is computed by the jp toolkit to ensure accessibility */\n+  outline: 2px solid var(--accent-fill-focus, var(--jp-brand-color1));\n+  outline-offset: -2px;\n }\n \n .jp-AccordionPanel-title {\n\ndiff --git a/packages/ui-components/style/toolbar.css b/packages/ui-components/style/toolbar.css\nindex 230974e1cc7f..4f3458cc4410 100644\n--- a/packages/ui-components/style/toolbar.css\n+++ b/packages/ui-components/style/toolbar.css\n@@ -23,7 +23,7 @@\n   box-shadow: var(--jp-toolbar-box-shadow);\n   background: var(--jp-toolbar-background);\n   min-height: var(--jp-toolbar-micro-height);\n-  padding: 2px;\n+  padding: 0 2px;\n   z-index: 8;\n }\n \n@@ -34,9 +34,6 @@\n   height: 100%;\n   display: flex;\n   align-items: center;\n-\n-  /* Increase density for toolbar items */\n-  --density: -4;\n }\n \n .jp-Toolbar::part(positioning-region) {\n\ndiff --git a/yarn.lock b/yarn.lock\nindex c535e7e15421..b1b487016f19 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2052,26 +2052,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@jupyter/react-components@npm:^0.15.3\":\n-  version: 0.15.3\n-  resolution: \"@jupyter/react-components@npm:0.15.3\"\n+\"@jupyter/react-components@npm:^0.16.3\":\n+  version: 0.16.3\n+  resolution: \"@jupyter/react-components@npm:0.16.3\"\n   dependencies:\n-    \"@jupyter/web-components\": ^0.15.3\n-    \"@microsoft/fast-react-wrapper\": ^0.3.22\n+    \"@jupyter/web-components\": ^0.16.3\n     react: \">=17.0.0 <19.0.0\"\n-  checksum: 1a6b256314259c6465c4b6d958575710536b82234a7bf0fba3e889a07e1f19ff8ab321450be354359876f92c45dbcc9d21a840237ff4a619806d9de696f55496\n+  checksum: 4eef89daacce6173162d61b42d18d3d9311e6728329dd0181199f50cfaaab6d8aadce6c4d290597c5096ac0940b83fc45495d3f59706d67c217b2395ee0ab4a3\n   languageName: node\n   linkType: hard\n \n-\"@jupyter/web-components@npm:^0.15.3\":\n-  version: 0.15.3\n-  resolution: \"@jupyter/web-components@npm:0.15.3\"\n+\"@jupyter/web-components@npm:^0.16.3\":\n+  version: 0.16.3\n+  resolution: \"@jupyter/web-components@npm:0.16.3\"\n   dependencies:\n     \"@microsoft/fast-colors\": ^5.3.1\n     \"@microsoft/fast-element\": ^1.12.0\n     \"@microsoft/fast-foundation\": ^2.49.4\n     \"@microsoft/fast-web-utilities\": ^5.4.1\n-  checksum: a0980af934157bfdbdb6cc169c0816c1b2e57602d524c56bdcef746a4c25dfeb8f505150d83207c8695ed89b5486cf53d35a3382584d25ef64db666e4e16e45b\n+  checksum: f47b87864c0d89ca1d86e05b206e10d059cc9f7d5b9e295c2e965a1f16d3bb84f49354668c40f9c79f72050cc3aae60ed5a91e254381ec86e25b02bec0480eab\n   languageName: node\n   linkType: hard\n \n@@ -2797,7 +2796,7 @@ __metadata:\n   dependencies:\n     \"@codemirror/state\": ^6.4.1\n     \"@codemirror/view\": ^6.26.3\n-    \"@jupyter/react-components\": ^0.15.3\n+    \"@jupyter/react-components\": ^0.16.3\n     \"@jupyter/ydoc\": ^2.0.1\n     \"@jupyterlab/application\": ^4.3.0-alpha.1\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.1\n@@ -3014,7 +3013,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/example-cell@workspace:examples/cell\"\n   dependencies:\n-    \"@jupyter/web-components\": ^0.15.3\n+    \"@jupyter/web-components\": ^0.16.3\n     \"@jupyter/ydoc\": ^2.0.1\n     \"@jupyterlab/application\": ^4.3.0-alpha.1\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.1\n@@ -3043,7 +3042,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/example-console@workspace:examples/console\"\n   dependencies:\n-    \"@jupyter/web-components\": ^0.15.3\n+    \"@jupyter/web-components\": ^0.16.3\n     \"@jupyter/ydoc\": ^2.0.1\n     \"@jupyterlab/application\": ^4.3.0-alpha.1\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.1\n@@ -3159,7 +3158,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/example-filebrowser@workspace:examples/filebrowser\"\n   dependencies:\n-    \"@jupyter/web-components\": ^0.15.3\n+    \"@jupyter/web-components\": ^0.16.3\n     \"@jupyterlab/application\": ^4.3.0-alpha.1\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.1\n     \"@jupyterlab/codemirror\": ^4.3.0-alpha.1\n@@ -3189,7 +3188,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/example-notebook@workspace:examples/notebook\"\n   dependencies:\n-    \"@jupyter/web-components\": ^0.15.3\n+    \"@jupyter/web-components\": ^0.16.3\n     \"@jupyter/ydoc\": ^2.0.1\n     \"@jupyterlab/application\": ^4.3.0-alpha.1\n     \"@jupyterlab/apputils\": ^4.4.0-alpha.1\n@@ -3277,7 +3276,7 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/example-terminal@workspace:examples/terminal\"\n   dependencies:\n-    \"@jupyter/web-components\": ^0.15.3\n+    \"@jupyter/web-components\": ^0.16.3\n     \"@jupyterlab/application\": ^4.3.0-alpha.1\n     \"@jupyterlab/coreutils\": ^6.3.0-alpha.1\n     \"@jupyterlab/services\": ^7.3.0-alpha.1\n@@ -4958,8 +4957,8 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/ui-components@workspace:packages/ui-components\"\n   dependencies:\n-    \"@jupyter/react-components\": ^0.15.3\n-    \"@jupyter/web-components\": ^0.15.3\n+    \"@jupyter/react-components\": ^0.16.3\n+    \"@jupyter/web-components\": ^0.16.3\n     \"@jupyterlab/coreutils\": ^6.3.0-alpha.1\n     \"@jupyterlab/observables\": ^5.3.0-alpha.1\n     \"@jupyterlab/rendermime-interfaces\": ^3.11.0-alpha.1\n@@ -5419,18 +5418,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@microsoft/fast-react-wrapper@npm:^0.3.22\":\n-  version: 0.3.22\n-  resolution: \"@microsoft/fast-react-wrapper@npm:0.3.22\"\n-  dependencies:\n-    \"@microsoft/fast-element\": ^1.12.0\n-    \"@microsoft/fast-foundation\": ^2.49.4\n-  peerDependencies:\n-    react: \">=16.9.0\"\n-  checksum: 6c7c0992dbaf91b32bc53b9d7ac21c7c8a89e6f45cc1b015cea1d1f3e766184ac7cea159479e34ddd30c347291cd5939e8d55696712086187deae37687054328\n-  languageName: node\n-  linkType: hard\n-\n \"@microsoft/fast-web-utilities@npm:^5.4.1\":\n   version: 5.4.1\n   resolution: \"@microsoft/fast-web-utilities@npm:5.4.1\"\n",
    "test_patch": "diff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-notebook-toolbar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-notebook-toolbar-documentation-linux.png\nindex bf7a1e722e1e..fd572fe285ae 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-notebook-toolbar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-notebook-toolbar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-notebook-toolbar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-notebook-toolbar-documentation-linux.png\nindex 249438da90cc..c32e1d8cd8bf 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-notebook-toolbar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-notebook-toolbar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/debugger.test.ts-snapshots/debugger-run-documentation-linux.png b/galata/test/documentation/debugger.test.ts-snapshots/debugger-run-documentation-linux.png\nindex 845d17715b09..d769be493044 100644\nBinary files a/galata/test/documentation/debugger.test.ts-snapshots/debugger-run-documentation-linux.png and b/galata/test/documentation/debugger.test.ts-snapshots/debugger-run-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/debugger.test.ts-snapshots/debugger-sidebar-documentation-linux.png b/galata/test/documentation/debugger.test.ts-snapshots/debugger-sidebar-documentation-linux.png\nindex 88e4f63039f7..ddc21b7e96d6 100644\nBinary files a/galata/test/documentation/debugger.test.ts-snapshots/debugger-sidebar-documentation-linux.png and b/galata/test/documentation/debugger.test.ts-snapshots/debugger-sidebar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/debugger.test.ts-snapshots/debugger-variables-documentation-linux.png b/galata/test/documentation/debugger.test.ts-snapshots/debugger-variables-documentation-linux.png\nindex dc10dfa83b7e..587bde0044d3 100644\nBinary files a/galata/test/documentation/debugger.test.ts-snapshots/debugger-variables-documentation-linux.png and b/galata/test/documentation/debugger.test.ts-snapshots/debugger-variables-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png\nindex dbda86331c45..2bdafd4ae09c 100644\nBinary files a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png and b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png\nindex eb7d4a950070..acbcb0f97593 100644\nBinary files a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png and b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-allowed-list-documentation-linux.png b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-allowed-list-documentation-linux.png\nindex 1fa0ab814e73..7b6b4551512e 100644\nBinary files a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-allowed-list-documentation-linux.png and b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-allowed-list-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-blocked-list-documentation-linux.png b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-blocked-list-documentation-linux.png\nindex 0aa6d01ba2ad..7b6b4551512e 100644\nBinary files a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-blocked-list-documentation-linux.png and b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-blocked-list-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-default-documentation-linux.png b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-default-documentation-linux.png\nindex 492655ac6636..68fada4d0424 100644\nBinary files a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-default-documentation-linux.png and b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-default-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-disabled-documentation-linux.png b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-disabled-documentation-linux.png\nindex add06c61fbc2..d2743e702bd5 100644\nBinary files a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-disabled-documentation-linux.png and b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-disabled-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-enabled-documentation-linux.png b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-enabled-documentation-linux.png\nindex 4936dbf50537..15222f83e46e 100644\nBinary files a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-enabled-documentation-linux.png and b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-enabled-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-search-documentation-linux.png b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-search-documentation-linux.png\nindex b9a409ef1c3e..2ba647e651f5 100644\nBinary files a/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-search-documentation-linux.png and b/galata/test/documentation/extension_manager.test.ts-snapshots/extensions-search-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png\nindex c41a1d4b5695..b2693d35b23e 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/command-palette-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-formats-altair-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-formats-altair-documentation-linux.png\nindex d8bd48ef61e1..32de00d0405a 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-formats-altair-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-formats-altair-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png\nindex 08f4d86c8ed7..36d561f8c219 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png\nindex abfbb3f63c10..83719e770372 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png\nindex 666b66051d3e..072ac496f644 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png\nindex ecc496f09a0f..1cbb6fd9d1ea 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png\nindex 6921fc9768bd..0f25aeadbfd4 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-change-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex c28110299554..4c2bbd1e1a0a 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png\nindex e0b6695f032a..84bce3c7a208 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png b/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png\nindex b6125c7ef445..914f3f2969fa 100644\nBinary files a/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png and b/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\nindex c43f88cef0d7..ec5c140e8b2a 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n@@ -55,7 +55,7 @@\n   \"@jupyterlab/completer-extension:base-service\": \"Adds context and kernel completion providers.\",\n   \"@jupyterlab/completer-extension:inline-history\": \"Adds inline completion provider suggesting code from execution history.\",\n   \"@jupyterlab/completer-extension:inline-completer-factory\": \"Provides a factory for inline completer.\",\n-  \"@jupyterlab/completer-extension:inline-completer\": \"Provides a factory for inline completer.\",\n+  \"@jupyterlab/completer-extension:inline-completer\": \"Registers the inline completer factory; adds inline completer commands, shortcuts and settings.\",\n   \"@jupyterlab/console-extension:factory\": \"Provides the console widget content factory.\",\n   \"@jupyterlab/console-extension:tracker\": \"Provides the console widget tracker.\",\n   \"@jupyterlab/console-extension:foreign\": \"Add foreign handler of IOPub messages to the console.\",\n\ndiff --git a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png\nindex 85ad0da98f2e..9f33168213b5 100644\nBinary files a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png and b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png differ\n\ndiff --git a/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png b/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png\nindex 33e2142ef1a0..631d51669007 100644\nBinary files a/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png and b/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-off-jupyterlab-linux.png b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-off-jupyterlab-linux.png\nindex 3fdb134493a7..417216799190 100644\nBinary files a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-off-jupyterlab-linux.png and b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-off-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png\nindex 0a982c042372..b37032fe58bd 100644\nBinary files a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png and b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notification.test.ts-snapshots/notification-center-jupyterlab-linux.png b/galata/test/jupyterlab/notification.test.ts-snapshots/notification-center-jupyterlab-linux.png\nindex bb4c2b972e78..0a9bd68671e5 100644\nBinary files a/galata/test/jupyterlab/notification.test.ts-snapshots/notification-center-jupyterlab-linux.png and b/galata/test/jupyterlab/notification.test.ts-snapshots/notification-center-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-extensionmanager-main-view-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-extensionmanager-main-view-jupyterlab-linux.png\nindex 7aa15959dd91..1b8fca2a4688 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-extensionmanager-main-view-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-extensionmanager-main-view-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-debugger-sidebar-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-debugger-sidebar-jupyterlab-linux.png\nindex ed56ce3c6bc6..87960e6e9334 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-debugger-sidebar-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-debugger-sidebar-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png\nindex 96151e8fcaba..c8efa71a5331 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16493",
    "pr_id": 16493,
    "issue_id": 16364,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Inline completer should not resize the cell editor aggressively when streaming \n## Description\r\n\r\nWhen inline completions are streaming sometimes the editor height changes aggressively. This is not accessible especially if user prefer reduced motion.\r\n\r\n## Reproduce\r\n\r\n1. Use https://github.com/krassowski/jupyterlab-transformers-completer\r\n2. Change settings to always stream\r\n3. Start typing and invoke inline completer\r\n4. See how the cell height changes drastically when streaming and when switching between alternative suggestions\r\n\r\n## Expected behavior\r\n\r\nIdeas to explore:\r\n- adding a configurable maximum height for the ghost text, e.g. 3-4 lines of code\r\n   - as a variation on this, expanding the following lines of the ghost text only when user stops typing, after a configurable timeout - if they started reading the suggestion they will be interested to see more lines - this allows to reduce the max height to 2-3 lines without detriment to users ability to read the entire thing before accepting\r\n- if there are multiple suggestions of variable height keeping reserved space for the suggestion with the most lines so that when user cycles between suggestions the cell does not resize\r\n- keeping some constant reserved space, e.g. minimum editor height when inline completer is enabled\r\n- keeping the empty space for a while after last suggestion was invalidated so that the editor does not bounce when a new suggestion comes in (this is already implemented but the timeout is very short - maybe we should increase it or make it configurable)\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.0",
    "issue_word_count": 247,
    "test_files_count": 3,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/inline-completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png",
      "packages/completer/src/ghost.ts",
      "packages/completer/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/inline-completer.test.ts",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png",
      "galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png"
    ],
    "base_commit": "5e4cae5d0b3b4f080caf7afffbfb381bdf80cc5b",
    "head_commit": "f84f27b163a6009d6eb39a11e3d0e7e6ab83698d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16493",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16493",
    "dockerfile": "",
    "pr_merged_at": "2024-06-19T18:51:10.000Z",
    "patch": "diff --git a/packages/completer/src/ghost.ts b/packages/completer/src/ghost.ts\nindex a74a087c4db7..c3047f7ca4e1 100644\n--- a/packages/completer/src/ghost.ts\n+++ b/packages/completer/src/ghost.ts\n@@ -199,8 +199,14 @@ class GhostTextWidget extends WidgetType {\n     }\n \n     const content = this.content;\n+\n+    if (this.isSpacer) {\n+      dom.innerText = content;\n+      return;\n+    }\n+\n     let addition = this.options.addedPart;\n-    if (addition && !this.isSpacer) {\n+    if (addition) {\n       if (addition.startsWith('\\n')) {\n         // Show the new line straight away to ensure proper positioning.\n         addition = addition.substring(1);\n@@ -215,7 +221,7 @@ class GhostTextWidget extends WidgetType {\n       dom.innerText = content;\n     }\n     // Add \"streaming-in-progress\" indicator\n-    if (!this.isSpacer && this.options.streaming) {\n+    if (this.options.streaming) {\n       const streamingIndicator = document.createElement('span');\n       streamingIndicator.className = STREAMING_INDICATOR_CLASS;\n       dom.appendChild(streamingIndicator);\n\ndiff --git a/packages/completer/style/base.css b/packages/completer/style/base.css\nindex 8e3b725ca360..8b27bd2cf20a 100644\n--- a/packages/completer/style/base.css\n+++ b/packages/completer/style/base.css\n@@ -218,6 +218,11 @@\n   opacity: 0;\n   display: inline-block;\n   vertical-align: top;\n+  /* stylelint-disable-next-line csstree/validator */\n+  text-wrap: none;\n+}\n+\n+.jp-GhostText-letterSpacer {\n   max-width: 0;\n }\n \n",
    "test_patch": "diff --git a/galata/test/jupyterlab/inline-completer.test.ts b/galata/test/jupyterlab/inline-completer.test.ts\nindex 0578e16dbc20..590d211d12bb 100644\n--- a/galata/test/jupyterlab/inline-completer.test.ts\n+++ b/galata/test/jupyterlab/inline-completer.test.ts\n@@ -6,6 +6,7 @@ import { expect, galata, test } from '@jupyterlab/galata';\n const fileName = 'notebook.ipynb';\n const COMPLETER_SELECTOR = '.jp-InlineCompleter';\n const GHOST_SELECTOR = '.jp-GhostText';\n+const GHOST_LINE_SPACER_CLASS = '.jp-GhostText-lineSpacer';\n const PLUGIN_ID = '@jupyterlab/completer-extension:inline-completer';\n const SHORTCUTS_ID = '@jupyterlab/shortcuts-extension:shortcuts';\n \n@@ -21,7 +22,10 @@ test.describe('Inline Completer', () => {\n   test.beforeEach(async ({ page }) => {\n     await page.notebook.createNew(fileName);\n     await page.notebook.setCell(0, 'code', 'suggestion_1 = 1');\n-    await page.notebook.addCell('code', 'suggestion_2 = 2');\n+    await page.notebook.addCell(\n+      'code',\n+      'suggestion_2 = 2\\n# second line\\n# third line'\n+    );\n     await page.notebook.addCell('code', 's');\n     await page.notebook.runCell(0, true);\n     await page.notebook.runCell(1, true);\n@@ -197,17 +201,17 @@ test.describe('Inline Completer', () => {\n     });\n \n     test('Ghost text updates on typing', async ({ page }) => {\n+      const cellEditor = await page.notebook.getCellInputLocator(2);\n       await page.keyboard.press('u');\n \n       // Ghost text shows up\n-      const ghostText = page.locator(GHOST_SELECTOR);\n+      const ghostText = cellEditor.locator(GHOST_SELECTOR);\n       await ghostText.waitFor();\n \n       // Ghost text should be updated from \"ggestion\" to \"estion\"\n       await page.keyboard.type('gg');\n       await expect(ghostText).toHaveText(/estion.*/);\n \n-      const cellEditor = await page.notebook.getCellInputLocator(2);\n       const imageName = 'editor-with-ghost-text.png';\n       expect(await cellEditor!.screenshot()).toMatchSnapshot(imageName);\n \n@@ -216,5 +220,49 @@ test.describe('Inline Completer', () => {\n       await page.waitForTimeout(50);\n       await expect(ghostText).toBeHidden();\n     });\n+\n+    test('Empty space is retained to avoid jitter', async ({ page }) => {\n+      const cellEditor = (await page.notebook.getCellInputLocator(2))!;\n+      const measureEditorHeight = async () =>\n+        (await cellEditor.boundingBox())!.height;\n+      const noGhostTextHeight = await measureEditorHeight();\n+\n+      await page.keyboard.type('uggestion_2');\n+\n+      // Ghost text shows up\n+      const ghostText = cellEditor.locator(\n+        `${GHOST_SELECTOR}:not(${GHOST_LINE_SPACER_CLASS})`\n+      );\n+      const lineSpacer = cellEditor.locator(GHOST_LINE_SPACER_CLASS);\n+\n+      await ghostText.waitFor();\n+      await expect(lineSpacer).toBeHidden();\n+      await expect(ghostText).toHaveText(/ = 2# second line# third line/);\n+\n+      const ghostTextShownHeight = await measureEditorHeight();\n+      expect(ghostTextShownHeight).toBeGreaterThan(noGhostTextHeight);\n+\n+      // Ghost text should disappear and line spacer appear\n+      await page.keyboard.type('x');\n+\n+      await lineSpacer.waitFor();\n+      await expect(lineSpacer).toBeVisible();\n+      await expect(ghostText).toBeHidden();\n+\n+      const spacerExpandedHeight = await measureEditorHeight();\n+      expect(ghostTextShownHeight).toEqual(spacerExpandedHeight);\n+\n+      // By default the hiding animation starts after 700ms and lasts for 300ms\n+\n+      // When animation starts the editor height should reduce\n+      await page.waitForTimeout(750);\n+      const spacerAnimatingHeight = await measureEditorHeight();\n+      expect(spacerAnimatingHeight).toBeLessThan(ghostTextShownHeight);\n+\n+      // After animation is done the height should be back to the initial height\n+      await page.waitForTimeout(300);\n+      const finalHeight = await measureEditorHeight();\n+      expect(noGhostTextHeight).toEqual(finalHeight);\n+    });\n   });\n });\n\ndiff --git a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png\nindex f6c3843afb8f..a0c3dc18734b 100644\nBinary files a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png and b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/editor-with-ghost-text-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png\nindex d9e7d030670d..0a982c042372 100644\nBinary files a/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png and b/galata/test/jupyterlab/inline-completer.test.ts-snapshots/inline-completer-shortcuts-on-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16470",
    "pr_id": 16470,
    "issue_id": 15629,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Default file browser creates new files and folders in a custom drive if installed\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n\r\nWhen a custom drive is installed, the default file browser might try to create files and directories in the installed drive, instead of the default file browser.\r\n\r\n## Reproduce\r\n\r\n- Install the latest JupyterLab version: `pip install jupyterlab==4.0.10`\r\n- Install a custom drive, for example [jupyterlab-github](https://github.com/jupyterlab/jupyterlab-github/): `pip install jupyterlab-github`\r\n- Click on the GitHub drive input area\r\n- Go back to the default file browser, click on the icon to create a new directory\r\n\r\n[jupyterlab-drive-focus-issue.webm](https://github.com/jupyterlab/jupyterlab/assets/591645/0df44b69-0d4b-45d5-b138-3ba5aeb87ce1)\r\n\r\n## Expected behavior\r\n\r\nAfter switching drives, it should be possible to create a new directory in the default filebrowser.\r\n\r\n## Context\r\n\r\n- Operating System and version: Linux Ubuntu 23.04\r\n- Browser and version: Firefox 118 & Chromium 120\r\n- JupyterLab version: 4.0.10\r\n\r\nThis was initially noticed in https://github.com/jupyterlite/jupyterlite/pull/1263 and https://github.com/jupyter/notebook/issues/7210.\r\n\r\nThanks @brichet for reproducing the issue in JupyterLab 4 as well.",
    "issue_word_count": 219,
    "test_files_count": 2,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "packages/apputils-extension/src/notificationplugin.tsx",
      "packages/apputils/src/mainareawidget.ts",
      "packages/apputils/src/toolbar/registry.ts",
      "packages/notebook/test/default-toolbar.spec.ts",
      "packages/toc-extension/src/index.ts",
      "packages/ui-components/src/components/toolbar.tsx",
      "packages/ui-components/test/toolbar.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/default-toolbar.spec.ts",
      "packages/ui-components/test/toolbar.spec.ts"
    ],
    "base_commit": "2458fd1466287c2a4f9951937a00319ac35d9f34",
    "head_commit": "ad88846e513c135b507b9775be9385802da957b1",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16470",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16470",
    "dockerfile": "",
    "pr_merged_at": "2024-08-01T10:50:23.000Z",
    "patch": "diff --git a/packages/apputils-extension/src/notificationplugin.tsx b/packages/apputils-extension/src/notificationplugin.tsx\nindex 55486cf6f74d..6080b17c0c03 100644\n--- a/packages/apputils-extension/src/notificationplugin.tsx\n+++ b/packages/apputils-extension/src/notificationplugin.tsx\n@@ -169,7 +169,7 @@ function NotificationCenter(props: INotificationCenterProps): JSX.Element {\n             </span>\n             <span className=\"jp-Toolbar-item jp-Toolbar-spacer\"></span>\n             <ToolbarButtonComponent\n-              actualOnClick={true}\n+              noFocusOnClick={false}\n               onClick={() => {\n                 manager.dismiss();\n               }}\n@@ -178,7 +178,7 @@ function NotificationCenter(props: INotificationCenterProps): JSX.Element {\n               enabled={manager.count > 0}\n             />\n             <ToolbarButtonComponent\n-              actualOnClick={true}\n+              noFocusOnClick={false}\n               onClick={onClose}\n               icon={closeIcon}\n               tooltip={trans.__('Hide notifications')}\n\ndiff --git a/packages/apputils/src/mainareawidget.ts b/packages/apputils/src/mainareawidget.ts\nindex 0592dbc6c7db..d6f197f1967d 100644\n--- a/packages/apputils/src/mainareawidget.ts\n+++ b/packages/apputils/src/mainareawidget.ts\n@@ -45,7 +45,8 @@ export class MainAreaWidget<T extends Widget = Widget>\n     const content = (this._content = options.content);\n     content.node.setAttribute('role', 'region');\n     content.node.setAttribute('aria-label', trans.__('notebook content'));\n-    const toolbar = (this._toolbar = options.toolbar || new ReactiveToolbar());\n+    const toolbar = (this._toolbar =\n+      options.toolbar || new ReactiveToolbar({ noFocusOnClick: true }));\n     toolbar.node.setAttribute('role', 'toolbar');\n     toolbar.node.setAttribute('aria-label', trans.__('notebook actions'));\n     const contentHeader = (this._contentHeader =\n\ndiff --git a/packages/apputils/src/toolbar/registry.ts b/packages/apputils/src/toolbar/registry.ts\nindex 6cb0613e7623..2516ff7419fb 100644\n--- a/packages/apputils/src/toolbar/registry.ts\n+++ b/packages/apputils/src/toolbar/registry.ts\n@@ -149,6 +149,9 @@ export function createDefaultFactory(\n         const id = tId ?? '';\n         const args = { toolbar: true, ...tArgs };\n         const icon = tIcon ? LabIcon.resolve({ icon: tIcon }) : undefined;\n+\n+        const toolbar = (widget as any).toolbar as Toolbar;\n+\n         // If there is an icon, undefined label will results in no label\n         // otherwise the label will be set using the setting or the command label\n         const label = icon ?? commands.icon(id, args) ? tLabel ?? '' : tLabel;\n@@ -158,7 +161,8 @@ export function createDefaultFactory(\n           args,\n           icon,\n           label,\n-          caption: tCaption as string\n+          caption: tCaption as string,\n+          noFocusOnClick: toolbar?.noFocusOnClick ?? false\n         });\n       }\n       case 'spacer':\n\ndiff --git a/packages/toc-extension/src/index.ts b/packages/toc-extension/src/index.ts\nindex e0e9e69af392..a34cd7802657 100644\n--- a/packages/toc-extension/src/index.ts\n+++ b/packages/toc-extension/src/index.ts\n@@ -241,7 +241,7 @@ async function activateTOC(\n   const menuButton = new ToolbarButton({\n     tooltip: trans.__('More actionsâ€¦'),\n     icon: ellipsesIcon,\n-    actualOnClick: true,\n+    noFocusOnClick: false,\n     onClick: () => {\n       const bbox = menuButton.node.getBoundingClientRect();\n       toolbarMenu.open(bbox.x, bbox.bottom);\n\ndiff --git a/packages/ui-components/src/components/toolbar.tsx b/packages/ui-components/src/components/toolbar.tsx\nindex 47bd3f7d8a9c..5fc58fcac93a 100644\n--- a/packages/ui-components/src/components/toolbar.tsx\n+++ b/packages/ui-components/src/components/toolbar.tsx\n@@ -177,6 +177,7 @@ export class Toolbar<T extends Widget = Widget> extends Widget {\n     super({ node: document.createElement('jp-toolbar') });\n     this.addClass(TOOLBAR_CLASS);\n     this.layout = options.layout ?? new ToolbarLayout();\n+    this.noFocusOnClick = options.noFocusOnClick ?? false;\n   }\n \n   /**\n@@ -238,6 +239,9 @@ export class Toolbar<T extends Widget = Widget> extends Widget {\n \n     Private.nameProperty.set(widget, name);\n     widget.node.dataset['jpItemName'] = name;\n+    if (this.noFocusOnClick) {\n+      widget.node.dataset['noFocusOnClick'] = 'true';\n+    }\n     return true;\n   }\n \n@@ -360,6 +364,8 @@ export class Toolbar<T extends Widget = Widget> extends Widget {\n   protected onBeforeDetach(msg: Message): void {\n     this.node.removeEventListener('click', this);\n   }\n+\n+  noFocusOnClick: boolean;\n }\n \n /**\n@@ -369,8 +375,8 @@ export class ReactiveToolbar extends Toolbar<Widget> {\n   /**\n    * Construct a new toolbar widget.\n    */\n-  constructor() {\n-    super();\n+  constructor(options: Toolbar.IOptions = {}) {\n+    super(options);\n     this.insertItem(0, TOOLBAR_OPENER_NAME, this.popupOpener);\n     this.popupOpener.hide();\n     this._resizer = new Throttler(async (callTwice = false) => {\n@@ -452,7 +458,7 @@ export class ReactiveToolbar extends Toolbar<Widget> {\n     if (widget instanceof ToolbarPopupOpener) {\n       status = super.insertItem(index, name, widget);\n     } else {\n-      // Insert the widget in the toolbar at axpected index if possible, otherwise\n+      // Insert the widget in the toolbar at expected index if possible, otherwise\n       // before the popup opener. This position may change when invoking the resizer\n       // at the end of this function.\n       const j = Math.max(\n@@ -730,6 +736,10 @@ export namespace Toolbar {\n      * Toolbar widget layout.\n      */\n     layout?: Layout;\n+    /**\n+     * Do not give the focus to the button on click.\n+     */\n+    noFocusOnClick?: boolean;\n   }\n \n   /**\n@@ -780,12 +790,10 @@ export namespace ToolbarButtonComponent {\n     disabledTooltip?: string;\n \n     /**\n-     * Trigger the button on the actual onClick event rather than onMouseDown.\n-     *\n-     * See note in ToolbarButtonComponent below as to why the default is to\n-     * trigger on onMouseDown.\n+     * Trigger the button on onMouseDown event rather than onClick, to avoid giving\n+     * the focus on the button.\n      */\n-    actualOnClick?: boolean;\n+    noFocusOnClick?: boolean;\n \n     /**\n      * The application language translator.\n@@ -802,29 +810,34 @@ export namespace ToolbarButtonComponent {\n export function ToolbarButtonComponent(\n   props: ToolbarButtonComponent.IProps\n ): JSX.Element {\n-  const actualOnClick = props.actualOnClick ?? false;\n-\n   // In some browsers, a button click event moves the focus from the main\n   // content to the button (see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus).\n-  // We avoid a click event by calling preventDefault in mousedown, and\n-  // we bind the button action to `mousedown`.\n-  const handleMouseDown = actualOnClick\n-    ? undefined\n-    : (event: React.MouseEvent) => {\n-        // Fire action only when left button is pressed.\n-        if (event.button === 0) {\n-          event.preventDefault();\n-          props.onClick?.();\n+  const handleClick =\n+    props.noFocusOnClick ?? false\n+      ? undefined\n+      : (event: React.MouseEvent) => {\n+          if (event.button === 0) {\n+            props.onClick?.();\n+            // In safari, the focus do not move to the button on click (see\n+            // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus).\n+            (event.target as HTMLElement).focus();\n+          }\n+        };\n+\n+  // To avoid focusing the button, we avoid a click event by calling preventDefault in\n+  // mousedown, and we bind the button action to `mousedown`.\n+  // Currently this is mostly useful for the notebook panel, to retrieve the focused\n+  // cell before the click event.\n+  const handleMouseDown =\n+    props.noFocusOnClick ?? false\n+      ? (event: React.MouseEvent) => {\n+          // Fire action only when left button is pressed.\n+          if (event.button === 0) {\n+            event.preventDefault();\n+            props.onClick?.();\n+          }\n         }\n-      };\n-\n-  const handleClick = actualOnClick\n-    ? (event: React.MouseEvent) => {\n-        if (event.button === 0) {\n-          props.onClick?.();\n-        }\n-      }\n-    : undefined;\n+      : undefined;\n \n   const handleKeyDown = (event: React.KeyboardEvent) => {\n     const { key } = event;\n@@ -967,6 +980,7 @@ export class ToolbarButton extends ReactWidget {\n     return (\n       <ToolbarButtonComponent\n         {...this.props}\n+        noFocusOnClick={this.props.noFocusOnClick}\n         pressed={this.pressed}\n         enabled={this.enabled}\n         onClick={this.onClick}\n@@ -1011,6 +1025,11 @@ export namespace CommandToolbarButtonComponent {\n      * Overrides command caption\n      */\n     caption?: string;\n+    /**\n+     * Trigger the button on onMouseDown event rather than onClick, to avoid giving\n+     * the focus on the button.\n+     */\n+    noFocusOnClick?: boolean;\n   }\n }\n \n@@ -1327,6 +1346,7 @@ namespace Private {\n     return {\n       className,\n       dataset: { 'data-command': options.id },\n+      noFocusOnClick: options.noFocusOnClick,\n       icon,\n       iconClass,\n       tooltip: options.caption ?? tooltip,\n",
    "test_patch": "diff --git a/packages/notebook/test/default-toolbar.spec.ts b/packages/notebook/test/default-toolbar.spec.ts\nindex 5767ed292a4b..a327c9d7e5ab 100644\n--- a/packages/notebook/test/default-toolbar.spec.ts\n+++ b/packages/notebook/test/default-toolbar.spec.ts\n@@ -48,7 +48,7 @@ describe('@jupyterlab/notebook', () => {\n           const promise = signalToPromise(context.fileChanged);\n           await framePromise();\n           await button.renderPromise;\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           await expect(promise).resolves.not.toThrow();\n           button.dispose();\n         });\n@@ -69,7 +69,7 @@ describe('@jupyterlab/notebook', () => {\n           Widget.attach(button, document.body);\n           await framePromise();\n           await button.renderPromise;\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           expect(panel.content.activeCellIndex).toBe(1);\n           expect(panel.content.activeCell).toBeInstanceOf(CodeCell);\n           button.dispose();\n@@ -91,7 +91,7 @@ describe('@jupyterlab/notebook', () => {\n           Widget.attach(button, document.body);\n           await framePromise();\n           await button.renderPromise;\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           expect(panel.content.widgets.length).toBe(count - 1);\n           expect(utils.clipboard.hasData(JUPYTER_CELL_MIME)).toBe(true);\n           button.dispose();\n@@ -113,7 +113,7 @@ describe('@jupyterlab/notebook', () => {\n           Widget.attach(button, document.body);\n           await framePromise();\n           await button.renderPromise;\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           expect(panel.content.widgets.length).toBe(count);\n           expect(utils.clipboard.hasData(JUPYTER_CELL_MIME)).toBe(true);\n           button.dispose();\n@@ -138,7 +138,7 @@ describe('@jupyterlab/notebook', () => {\n           await framePromise();\n           await button.renderPromise;\n           NotebookActions.copy(panel.content);\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           await sleep();\n           expect(panel.content.widgets.length).toBe(count + 1);\n           button.dispose();\n@@ -270,7 +270,7 @@ describe('@jupyterlab/notebook', () => {\n               delegate.resolve(void 0);\n             }\n           });\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           await expect(delegate.promise).resolves.not.toThrow();\n           button.dispose();\n         });\n@@ -303,7 +303,7 @@ describe('@jupyterlab/notebook', () => {\n               delegate.resolve(void 0);\n             }\n           });\n-          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n           await acceptDialog();\n           await expect(delegate.promise).resolves.not.toThrow();\n           button.dispose();\n\ndiff --git a/packages/ui-components/test/toolbar.spec.ts b/packages/ui-components/test/toolbar.spec.ts\nindex fd2c8cfa54bc..2a4f35a46c51 100644\n--- a/packages/ui-components/test/toolbar.spec.ts\n+++ b/packages/ui-components/test/toolbar.spec.ts\n@@ -49,6 +49,39 @@ describe('@jupyterlab/ui-components', () => {\n       Widget.attach(button, document.body);\n       await framePromise();\n \n+      expect(button.hasClass('jp-CommandToolbarButton')).toBe(true);\n+      simulate(button.node.firstElementChild!, 'click');\n+      expect(options.execute).toHaveBeenCalledTimes(1);\n+    });\n+\n+    it('should not trigger command on mousedown', async () => {\n+      options.execute = jest.fn();\n+      commands.addCommand(id, options);\n+      const button = new CommandToolbarButton({\n+        commands,\n+        id\n+      });\n+\n+      Widget.attach(button, document.body);\n+      await framePromise();\n+\n+      expect(button.hasClass('jp-CommandToolbarButton')).toBe(true);\n+      simulate(button.node.firstElementChild!, 'mousedown');\n+      expect(options.execute).toHaveBeenCalledTimes(0);\n+    });\n+\n+    it('should trigger command on mousedown', async () => {\n+      options.execute = jest.fn();\n+      commands.addCommand(id, options);\n+      const button = new CommandToolbarButton({\n+        commands,\n+        id,\n+        noFocusOnClick: true\n+      });\n+\n+      Widget.attach(button, document.body);\n+      await framePromise();\n+\n       expect(button.hasClass('jp-CommandToolbarButton')).toBe(true);\n       simulate(button.node.firstElementChild!, 'mousedown');\n       expect(options.execute).toHaveBeenCalledTimes(1);\n@@ -515,6 +548,37 @@ describe('@jupyterlab/ui-components', () => {\n           Widget.attach(button, document.body);\n           await framePromise();\n           await button.renderPromise;\n+          simulate(button.node.firstChild as HTMLElement, 'click');\n+          expect(called).toBe(true);\n+          button.dispose();\n+        });\n+      });\n+      describe('mousedown', () => {\n+        it('should not activate the callback on mouse down', async () => {\n+          let called = false;\n+          const button = new ToolbarButton({\n+            onClick: () => {\n+              called = true;\n+            }\n+          });\n+          Widget.attach(button, document.body);\n+          await framePromise();\n+          await button.renderPromise;\n+          simulate(button.node.firstChild as HTMLElement, 'mousedown');\n+          expect(called).toBe(false);\n+          button.dispose();\n+        });\n+        it('should activate the callback on mouse down', async () => {\n+          let called = false;\n+          const button = new ToolbarButton({\n+            onClick: () => {\n+              called = true;\n+            },\n+            noFocusOnClick: true\n+          });\n+          Widget.attach(button, document.body);\n+          await framePromise();\n+          await button.renderPromise;\n           simulate(button.node.firstChild as HTMLElement, 'mousedown');\n           expect(called).toBe(true);\n           button.dispose();\n@@ -676,7 +740,7 @@ describe('@jupyterlab/ui-components', () => {\n         });\n         Widget.attach(widget, document.body);\n         await framePromise();\n-        simulate(widget.node.firstChild as HTMLElement, 'mousedown');\n+        simulate(widget.node.firstChild as HTMLElement, 'click');\n         expect(mockCalled).toBe(true);\n \n         mockCalled = false;\n@@ -687,7 +751,7 @@ describe('@jupyterlab/ui-components', () => {\n         widget.onClick = mockOnClickUpdated;\n         await framePromise();\n         await widget.renderPromise;\n-        simulate(widget.node.firstChild as HTMLElement, 'mousedown');\n+        simulate(widget.node.firstChild as HTMLElement, 'click');\n         expect(mockCalled).toBe(false);\n         expect(mockUpdatedCalled).toBe(true);\n         widget.dispose();\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16446",
    "pr_id": 16446,
    "issue_id": 14125,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Large empty space in file browser toolbar\n## Description\r\n\r\n![Screenshot from 2023-03-04 11-25-16](https://user-images.githubusercontent.com/5832902/222897269-d0104780-4770-40c0-b99d-764353552f7d.png)\r\n\r\n## Reproduce\r\n\r\n1. Open file browser\r\n2. Resize the sidebar to dimensions as on screenshot\r\n\r\n## Expected behavior\r\n\r\nSpace is utilised efficiently.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.0.0a",
    "issue_word_count": 55,
    "test_files_count": 25,
    "non_test_files_count": 9,
    "pr_changed_files": [
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "examples/filebrowser/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/notebook-ui-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-required-warning-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png",
      "packages/filebrowser-extension/schema/widget.json",
      "packages/filebrowser-extension/src/index.ts",
      "packages/filebrowser/src/browser.ts",
      "packages/filebrowser/style/base.css",
      "packages/ui-components/src/components/search.tsx",
      "packages/workspaces-extension/src/commands.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/notebook-ui-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-required-warning-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png"
    ],
    "base_commit": "841b339771d15a5ae0f0f63455eb7ed66b56d921",
    "head_commit": "bad14f5cdf8ade7e48f9fce9f7c7e487bad883f4",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16446",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16446",
    "dockerfile": "",
    "pr_merged_at": "2024-07-03T13:42:00.000Z",
    "patch": "diff --git a/examples/app/example.spec.ts-snapshots/example-linux.png b/examples/app/example.spec.ts-snapshots/example-linux.png\nindex 7496485a875f..fd1ca7f4bb52 100644\nBinary files a/examples/app/example.spec.ts-snapshots/example-linux.png and b/examples/app/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/federated/example.spec.ts-snapshots/example-linux.png b/examples/federated/example.spec.ts-snapshots/example-linux.png\nindex e4edf402f994..313033964c8f 100644\nBinary files a/examples/federated/example.spec.ts-snapshots/example-linux.png and b/examples/federated/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/filebrowser/example.spec.ts-snapshots/example-linux.png b/examples/filebrowser/example.spec.ts-snapshots/example-linux.png\nindex 3b7b592e2da3..1b309bed3728 100644\nBinary files a/examples/filebrowser/example.spec.ts-snapshots/example-linux.png and b/examples/filebrowser/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/packages/filebrowser-extension/schema/widget.json b/packages/filebrowser-extension/schema/widget.json\nindex e331aa2ac942..101c96a3d9cc 100644\n--- a/packages/filebrowser-extension/schema/widget.json\n+++ b/packages/filebrowser-extension/schema/widget.json\n@@ -10,7 +10,11 @@\n       },\n       { \"name\": \"uploader\", \"rank\": 20 },\n       { \"name\": \"refresh\", \"command\": \"filebrowser:refresh\", \"rank\": 30 },\n-      { \"name\": \"fileNameSearcher\", \"rank\": 40 }\n+      {\n+        \"name\": \"toggle-file-filter\",\n+        \"command\": \"filebrowser:toggle-file-filter\",\n+        \"rank\": 40\n+      }\n     ]\n   },\n   \"jupyter.lab.menus\": {\n\ndiff --git a/packages/filebrowser-extension/src/index.ts b/packages/filebrowser-extension/src/index.ts\nindex 7fd012490f54..4974acf1851e 100644\n--- a/packages/filebrowser-extension/src/index.ts\n+++ b/packages/filebrowser-extension/src/index.ts\n@@ -49,10 +49,9 @@ import {\n   downloadIcon,\n   editIcon,\n   fileIcon,\n-  FilenameSearcher,\n+  filterIcon,\n   folderIcon,\n   IDisposableMenuItem,\n-  IScore,\n   linkIcon,\n   markdownIcon,\n   newFolderIcon,\n@@ -66,12 +65,11 @@ import { map } from '@lumino/algorithm';\n import { CommandRegistry } from '@lumino/commands';\n import { ContextMenu } from '@lumino/widgets';\n \n-const FILE_BROWSER_FACTORY = 'FileBrowser';\n-const FILE_BROWSER_PLUGIN_ID = '@jupyterlab/filebrowser-extension:browser';\n /**\n- * The class name added to the filebrowser filterbox node.\n+ * Toolbar factory for the top toolbar in the widget\n  */\n-const FILTERBOX_CLASS = 'jp-FileBrowser-filterBox';\n+const FILE_BROWSER_FACTORY = 'FileBrowser';\n+const FILE_BROWSER_PLUGIN_ID = '@jupyterlab/filebrowser-extension:browser';\n \n /**\n  * The command IDs used by the file browser plugin.\n@@ -129,6 +127,8 @@ namespace CommandIDs {\n   // For main browser only.\n   export const toggleBrowser = 'filebrowser:toggle-main';\n \n+  export const toggleFileFilter = 'filebrowser:toggle-file-filter';\n+\n   export const toggleNavigateToCurrentDirectory =\n     'filebrowser:toggle-navigate-to-current-directory';\n \n@@ -465,7 +465,7 @@ const browserWidget: JupyterFrontEndPlugin<void> = {\n     const { tracker } = factory;\n     const trans = translator.load('jupyterlab');\n \n-    // Toolbar\n+    // Top-level toolbar\n     toolbarRegistry.addFactory(\n       FILE_BROWSER_FACTORY,\n       'uploader',\n@@ -473,28 +473,6 @@ const browserWidget: JupyterFrontEndPlugin<void> = {\n         new Uploader({ model: browser.model, translator })\n     );\n \n-    toolbarRegistry.addFactory(\n-      FILE_BROWSER_FACTORY,\n-      'fileNameSearcher',\n-      (browser: FileBrowser) => {\n-        const searcher = FilenameSearcher({\n-          updateFilter: (\n-            filterFn: (item: string) => Partial<IScore> | null,\n-            query?: string\n-          ) => {\n-            browser.model.setFilter(value => {\n-              return filterFn(value.name.toLowerCase());\n-            });\n-          },\n-          useFuzzyFilter: true,\n-          placeholder: trans.__('Filter files by name'),\n-          forceRefresh: true\n-        });\n-        searcher.addClass(FILTERBOX_CLASS);\n-        return searcher;\n-      }\n-    );\n-\n     setToolbar(\n       browser,\n       createToolbarFactory(\n@@ -1255,6 +1233,20 @@ function addCommands(\n     label: trans.__('Shut Down Kernel')\n   });\n \n+  commands.addCommand(CommandIDs.toggleFileFilter, {\n+    execute: () => {\n+      // Update toggled state, then let the toolbar button update\n+      browser.showFileFilter = !browser.showFileFilter;\n+      commands.notifyCommandChanged(CommandIDs.toggleFileFilter);\n+    },\n+    isToggled: () => {\n+      const toggled = browser.showFileFilter;\n+      return toggled;\n+    },\n+    icon: filterIcon.bindprops({ stylesheet: 'menuItem' }),\n+    label: trans.__('Toggle File Filter')\n+  });\n+\n   commands.addCommand(CommandIDs.toggleLastModified, {\n     label: trans.__('Show Last Modified Column'),\n     isToggled: () => browser.showLastModifiedColumn,\n\ndiff --git a/packages/filebrowser/src/browser.ts b/packages/filebrowser/src/browser.ts\nindex 9fcdf4d90023..2fcc21917429 100644\n--- a/packages/filebrowser/src/browser.ts\n+++ b/packages/filebrowser/src/browser.ts\n@@ -6,8 +6,14 @@ import { PathExt } from '@jupyterlab/coreutils';\n import { IDocumentManager } from '@jupyterlab/docmanager';\n import { Contents, ServerConnection } from '@jupyterlab/services';\n import { ITranslator, nullTranslator } from '@jupyterlab/translation';\n-import { SidePanel } from '@jupyterlab/ui-components';\n+import {\n+  FilenameSearcher,\n+  IScore,\n+  SidePanel,\n+  Toolbar\n+} from '@jupyterlab/ui-components';\n import { Panel } from '@lumino/widgets';\n+import { createRef } from 'react';\n import { BreadCrumbs } from './crumbs';\n import { DirListing } from './listing';\n import { FilterFileBrowserModel } from './model';\n@@ -32,11 +38,21 @@ const CRUMBS_CLASS = 'jp-FileBrowser-crumbs';\n  */\n const TOOLBAR_CLASS = 'jp-FileBrowser-toolbar';\n \n+/**\n+ * The class name added to the filebrowser filter toolbar node.\n+ */\n+const FILTER_TOOLBAR_CLASS = 'jp-FileBrowser-filterToolbar';\n+\n /**\n  * The class name added to the filebrowser listing node.\n  */\n const LISTING_CLASS = 'jp-FileBrowser-listing';\n \n+/**\n+ * The class name added to the filebrowser filterbox node.\n+ */\n+const FILTERBOX_CLASS = 'jp-FileBrowser-filterBox';\n+\n /**\n  * A widget which hosts a file browser.\n  *\n@@ -76,6 +92,29 @@ export class FileBrowser extends SidePanel {\n     this.crumbs = new BreadCrumbs({ model, translator });\n     this.crumbs.addClass(CRUMBS_CLASS);\n \n+    // The filter toolbar appears immediately below the breadcrumbs and above the directory listing.\n+    const searcher = FilenameSearcher({\n+      updateFilter: (\n+        filterFn: (item: string) => Partial<IScore> | null,\n+        query?: string\n+      ) => {\n+        this.model.setFilter(value => {\n+          return filterFn(value.name.toLowerCase());\n+        });\n+      },\n+      useFuzzyFilter: true,\n+      placeholder: this._trans.__('Filter files by name'),\n+      forceRefresh: false,\n+      showIcon: false,\n+      inputRef: this._fileFilterRef\n+    });\n+    searcher.addClass(FILTERBOX_CLASS);\n+\n+    this.filterToolbar = new Toolbar();\n+    this.filterToolbar.addClass(FILTER_TOOLBAR_CLASS);\n+    this.filterToolbar.addItem('fileNameSearcher', searcher);\n+    this.filterToolbar.setHidden(!this.showFileFilter);\n+\n     this.listing = this.createDirListing({\n       model,\n       renderer,\n@@ -84,6 +123,7 @@ export class FileBrowser extends SidePanel {\n     this.listing.addClass(LISTING_CLASS);\n \n     this.mainPanel.addWidget(this.crumbs);\n+    this.mainPanel.addWidget(this.filterToolbar);\n     this.mainPanel.addWidget(this.listing);\n \n     this.addWidget(this.mainPanel);\n@@ -180,6 +220,37 @@ export class FileBrowser extends SidePanel {\n     }\n   }\n \n+  /**\n+   * Whether to show a text box to filter files by name.\n+   */\n+  get showFileFilter(): boolean {\n+    return this._showFileFilter;\n+  }\n+\n+  set showFileFilter(value: boolean) {\n+    // If the old value was true and the new value is false, clear the filter\n+    const oldValue = this.showFileFilter;\n+    if (oldValue && !value) {\n+      // Clear the search box input\n+      if (this._fileFilterRef.current) {\n+        this._fileFilterRef.current.value = '';\n+      }\n+\n+      // Set a filter that doesn't exclude anything.\n+      this.model.setFilter(value => {\n+        return {};\n+      });\n+      this.model.refresh().catch(console.warn);\n+    }\n+    this._showFileFilter = value;\n+\n+    // Update widget visibility\n+    this.filterToolbar.setHidden(!this.showFileFilter);\n+    if (this.showFileFilter) {\n+      this._fileFilterRef.current?.focus();\n+    }\n+  }\n+\n   /**\n    * Whether to sort notebooks above other files\n    */\n@@ -426,18 +497,21 @@ export class FileBrowser extends SidePanel {\n     }\n   }\n \n+  protected filterToolbar: Toolbar;\n   protected listing: DirListing;\n   protected crumbs: BreadCrumbs;\n   protected mainPanel: Panel;\n \n-  private _manager: IDocumentManager;\n   private _directoryPending: Promise<Contents.IModel> | null = null;\n   private _filePending: Promise<Contents.IModel> | null = null;\n+  private _fileFilterRef = createRef<HTMLInputElement>();\n+  private _manager: IDocumentManager;\n   private _navigateToCurrentDirectory: boolean;\n-  private _showLastModifiedColumn: boolean = true;\n+  private _showFileCheckboxes: boolean = false;\n+  private _showFileFilter: boolean = false;\n   private _showFileSizeColumn: boolean = false;\n   private _showHiddenFiles: boolean = false;\n-  private _showFileCheckboxes: boolean = false;\n+  private _showLastModifiedColumn: boolean = true;\n   private _sortNotebooksFirst: boolean = false;\n }\n \n\ndiff --git a/packages/filebrowser/style/base.css b/packages/filebrowser/style/base.css\nindex 2da8824abbd2..3dcb9267ae79 100644\n--- a/packages/filebrowser/style/base.css\n+++ b/packages/filebrowser/style/base.css\n@@ -29,6 +29,20 @@\n   row-gap: 12px;\n }\n \n+.jp-FileBrowser-filterToolbar {\n+  display: flex;\n+  flex: 0 0 auto;\n+  flex-direction: column;\n+}\n+\n+.jp-FileBrowser-filterToolbar.jp-Toolbar {\n+  border-bottom: none;\n+  height: auto;\n+  margin: 0 12px 6px;\n+  box-shadow: none;\n+  padding: 0;\n+}\n+\n .jp-FileBrowser-Panel {\n   flex: 1 1 auto;\n   display: flex;\n@@ -64,7 +78,8 @@\n | Buttons\n |----------------------------------------------------------------------------*/\n \n-.jp-FileBrowser-toolbar > .jp-Toolbar-item {\n+.jp-FileBrowser-toolbar > .jp-Toolbar-item,\n+.jp-FileBrowser-filterToolbar > .jp-Toolbar-item {\n   flex: 0 0 auto;\n   padding-left: 0;\n   align-items: center;\n@@ -72,7 +87,7 @@\n }\n \n .jp-FileBrowser-toolbar > .jp-Toolbar-item .jp-ToolbarButtonComponent {\n-  width: 40px;\n+  width: 28px;\n }\n \n /*-----------------------------------------------------------------------------\n@@ -99,7 +114,11 @@\n   display: none;\n }\n \n-.jp-FileBrowser-toolbar > .jp-FileBrowser-filterBox {\n+.jp-FileBrowser-filterToolbar > .jp-FileBrowser-filterBox {\n+  width: 100%;\n+}\n+\n+.jp-FileBrowser-filterBox > .jp-FilterBox {\n   width: 100%;\n }\n \n\ndiff --git a/packages/ui-components/src/components/search.tsx b/packages/ui-components/src/components/search.tsx\nindex 92aee8df1388..9218c3853ea8 100644\n--- a/packages/ui-components/src/components/search.tsx\n+++ b/packages/ui-components/src/components/search.tsx\n@@ -40,6 +40,11 @@ export interface IFilterBoxProps {\n    */\n   placeholder?: string;\n \n+  /**\n+   * Whether to show a search icon in the box.\n+   */\n+  showIcon?: boolean;\n+\n   /**\n    * A function to callback when filter is updated.\n    */\n@@ -185,6 +190,9 @@ export const FilterBox = (props: IFilterBoxProps): JSX.Element => {\n     );\n   };\n \n+  // Show the icon by default, or if the caller specifically requests it\n+  const showSearchIcon = props.showIcon ?? true;\n+\n   return (\n     <Search\n       className=\"jp-FilterBox\"\n@@ -195,7 +203,7 @@ export const FilterBox = (props: IFilterBoxProps): JSX.Element => {\n       placeholder={props.placeholder}\n       disabled={props.disabled}\n     >\n-      <searchIcon.react slot=\"end\" tag={null} />\n+      {showSearchIcon && <searchIcon.react slot=\"end\" tag={null} />}\n     </Search>\n   );\n };\n@@ -204,13 +212,5 @@ export const FilterBox = (props: IFilterBoxProps): JSX.Element => {\n  * A widget which hosts a input textbox to filter on file names.\n  */\n export const FilenameSearcher = (props: IFilterBoxProps): ReactWidget => {\n-  return ReactWidget.create(\n-    <FilterBox\n-      updateFilter={props.updateFilter}\n-      useFuzzyFilter={props.useFuzzyFilter}\n-      placeholder={props.placeholder}\n-      forceRefresh={props.forceRefresh}\n-      caseSensitive={props.caseSensitive}\n-    />\n-  );\n+  return ReactWidget.create(<FilterBox {...props} />);\n };\n\ndiff --git a/packages/workspaces-extension/src/commands.ts b/packages/workspaces-extension/src/commands.ts\nindex 2552935fa599..fa101d9f6d16 100644\n--- a/packages/workspaces-extension/src/commands.ts\n+++ b/packages/workspaces-extension/src/commands.ts\n@@ -362,7 +362,7 @@ export const commandsPlugin: JupyterFrontEndPlugin<IWorkspaceCommands> = {\n               ? {}\n               : null,\n           label: trans.__(\n-            'You choose one or more workspace files to import. A Jupyter Workspace File has %1 extension.',\n+            'Choose one or more workspace files to import. A Jupyter workspace file has the extension \"%1\".',\n             WORKSPACE_EXT\n           ),\n           translator\n",
    "test_patch": "diff --git a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\nindex ef0786f28178..b0d4885f396b 100644\n--- a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n+++ b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n@@ -928,6 +928,12 @@\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n+  {\n+    \"id\": \"filebrowser:toggle-file-filter\",\n+    \"label\": \"Toggle File Filter\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n   {\n     \"id\": \"filebrowser:toggle-file-size\",\n     \"label\": \"Show File Size Column\",\n\ndiff --git a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png\nindex 350bb1832da3..90efa1abc9c3 100644\nBinary files a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png and b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png\nindex 03326041e688..f50833f69d78 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png\nindex 9dafcfb0e774..7d8b1c73dd46 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png\nindex 1a11b772fea0..d9f9a74ad523 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png\nindex 09241c02a1e8..a21188ce2672 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png\nindex da8e6b8a8e1e..f70246583e65 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png\nindex d3bd8de17932..becc14c2a37d 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png\nindex 0e72aaf94293..70e205c88973 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png\nindex d23915a54cbc..fd45c2040ada 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png\nindex 803caf9a7c08..ca90d76d2f8c 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png\nindex 460ce150895e..1e603109d274 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png\nindex 6be1b059333f..abfbb3f63c10 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/notebook-ui-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/notebook-ui-documentation-linux.png\nindex e4dce8a43f8c..144ef6bbf1f8 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/notebook-ui-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/notebook-ui-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png\nindex bcb50c40eae4..393397dd3221 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png\nindex f91bf0da82bc..ca2890bdda3b 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png\nindex 54a62bf76c51..67b372c1f459 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex 1b6f6272d634..c28110299554 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png\nindex ea9f03589c4a..437d43f47b36 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-required-warning-documentation-linux.png b/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-required-warning-documentation-linux.png\nindex 64e3d96937cc..0220da98b192 100644\nBinary files a/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-required-warning-documentation-linux.png and b/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-plugin-required-warning-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png\nindex c3d40a1dba7b..a2a7c52c208b 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png\nindex 752093fe1e8d..f9f04dc0868c 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png\nindex b0cf732bff14..56e21a64090e 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png\nindex f5ebec412b66..36aa92a89378 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png\nindex 936b73318f13..e02be9df9a8b 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16443",
    "pr_id": 16443,
    "issue_id": 16352,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "table of contents won't show async function\n## Description\r\n\r\nWhen opening the table of contents widget for  a .py file, only the non-async functions are bookmarked\r\n## Reproduce\r\n\r\n1. Create a .py file with an async function\r\n2. Open the table of contents widget\r\n3. Function is not there \r\n![screenshot](https://github.com/jupyterlab/jupyterlab/assets/44308120/8c7263b2-2002-408b-8489-3858048d3cb0)\r\n## Expected behavior\r\n\r\nTable of contents shows all my functions \r\n\r\n## Context\r\n\r\n- Operating System and version:  Linux Ubuntu 20.04 \r\n- Browser and version: Firefox 126\r\n- JupyterLab version: 4.2.0 \r\n\r\nLet me know if you really need all those details and I will try again\r\n\r\n - I tried to save them and github would not accept them because there were too many characters\r\n\r\n<details><summary>Browser Output</summary>\r\n<pre>\r\nTypeError: i is undefined\r\n    getHover hover.ts:321\r\n    factory jlab_core.b91074b1e57242ddcd31.js:1\r\n    _execute jlab_core.b91074b1e57242ddcd31.js:1\r\n    o jlab_core.b91074b1e57242ddcd31.js:1\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 153,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/fileeditor/src/toc/python.ts",
      "packages/fileeditor/test/python.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/fileeditor/test/python.spec.ts"
    ],
    "base_commit": "2c718c1be098f11d602a7b82b534a8654419533f",
    "head_commit": "2aed481f85baec4ded92652796554c8741bdab36",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16443",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16443",
    "dockerfile": "",
    "pr_merged_at": "2024-06-06T07:59:05.000Z",
    "patch": "diff --git a/packages/fileeditor/src/toc/python.ts b/packages/fileeditor/src/toc/python.ts\nindex 85a49f07aa3d..1d3fd14b683e 100644\n--- a/packages/fileeditor/src/toc/python.ts\n+++ b/packages/fileeditor/src/toc/python.ts\n@@ -17,9 +17,9 @@ try {\n   // https://github.com/tc39/proposal-regexp-match-indices was accepted\n   // in May 2021 (https://github.com/tc39/proposals/blob/main/finished-proposals.md)\n   // So we will fallback to the polyfill regexp-match-indices if not available\n-  KEYWORDS = new RegExp('^\\\\s*(class |def |from |import )', 'd');\n+  KEYWORDS = new RegExp('^\\\\s*(class |def |async def |from |import )', 'd');\n } catch {\n-  KEYWORDS = new RegExp('^\\\\s*(class |def |from |import )');\n+  KEYWORDS = new RegExp('^\\\\s*(class |def |async def |from |import )');\n }\n \n /**\n",
    "test_patch": "diff --git a/packages/fileeditor/test/python.spec.ts b/packages/fileeditor/test/python.spec.ts\nindex dc4fdbaf5cf1..596a63eefd16 100644\n--- a/packages/fileeditor/test/python.spec.ts\n+++ b/packages/fileeditor/test/python.spec.ts\n@@ -25,6 +25,16 @@ describe('@jupyterlab/fileeditor', () => {\n             }\n           ]\n         ],\n+        [\n+          'async def async_function():',\n+          [\n+            {\n+              text: 'async def async_function():',\n+              level: 1,\n+              line: 0\n+            }\n+          ]\n+        ],\n         [\n           'class Klass:',\n           [\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16437",
    "pr_id": 16437,
    "issue_id": 16422,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Code comments in tilde (`~`) fences incorrectly shown as headings in TOC\n## Description\r\n\r\nCode comments in tilde (`~`) fences incorrectly shown as headings in TOC. Code fences using `~` are part of GFM spec, and we are using GFM in Markdown cells https://github.github.com/gfm/#fenced-code-blocks\r\n\r\nSimilar to https://github.com/jupyterlab/jupyterlab/issues/16403\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/fd04bbb2-bb2e-41c8-a497-be785263560b)\r\n\r\n## Reproduce\r\n\r\nPaste:\r\n\r\n```\r\n~~~\r\n# test\r\n~~~\r\n```\r\n\r\ninto a Markdown cell\r\n\r\nopen TOC\r\n\r\n## Expected behavior\r\n\r\nno heading in TOC\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.1",
    "issue_word_count": 90,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/toc/src/utils/markdown.ts",
      "packages/toc/test/markdown.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/toc/test/markdown.spec.ts"
    ],
    "base_commit": "066dc21bfaf6785a49e0145a981d261a49da4f56",
    "head_commit": "ecbbadfdbabe25892f1278da177a6a189e502ae3",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16437",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16437",
    "dockerfile": "",
    "pr_merged_at": "2024-06-05T10:47:27.000Z",
    "patch": "diff --git a/packages/toc/src/utils/markdown.ts b/packages/toc/src/utils/markdown.ts\nindex b18de258d18b..108bf5aa93ae 100644\n--- a/packages/toc/src/utils/markdown.ts\n+++ b/packages/toc/src/utils/markdown.ts\n@@ -75,7 +75,8 @@ export function getHeadings(text: string): IMarkdownHeading[] {\n   // Iterate over the lines to get the header level and text for each line:\n   const headings = new Array<IMarkdownHeading>();\n   let isCodeBlock;\n-  let startBackticks = 0;\n+  let openingFence = 0;\n+  let fenceType;\n   let lineIdx = 0;\n \n   // Don't check for Markdown headings if in a YAML frontmatter block.\n@@ -105,16 +106,18 @@ export function getHeadings(text: string): IMarkdownHeading[] {\n     }\n \n     // Don't check for Markdown headings if in a code block\n-    if (line.startsWith('```')) {\n-      const backticks = extractLeadingBackticks(line);\n-      if (backticks === 0) continue;\n-      else if (startBackticks === 0) {\n+    if (line.startsWith('```') || line.startsWith('~~~')) {\n+      const closingFence = extractLeadingFences(line);\n+      if (closingFence === 0) continue;\n+      if (openingFence === 0) {\n+        fenceType = line.charAt(0);\n         isCodeBlock = !isCodeBlock;\n-        startBackticks = backticks;\n+        openingFence = closingFence;\n         continue;\n-      } else if (backticks !== 0 && backticks >= startBackticks) {\n+      } else if (fenceType === line.charAt(0) && closingFence >= openingFence) {\n         isCodeBlock = !isCodeBlock;\n-        startBackticks = 0;\n+        openingFence = 0;\n+        fenceType = '';\n       }\n     }\n     if (isCodeBlock) {\n@@ -133,8 +136,11 @@ export function getHeadings(text: string): IMarkdownHeading[] {\n   return headings;\n }\n \n-function extractLeadingBackticks(line: string) {\n-  const match = line.match(/^(`{3,})/);\n+// Returns the length of ``` or ~~~ fences.\n+function extractLeadingFences(line: string) {\n+  let match;\n+  if (line.startsWith('`')) match = line.match(/^(`{3,})/);\n+  else match = line.match(/^(~{3,})/);\n   return match ? match[0].length : 0;\n }\n \n",
    "test_patch": "diff --git a/packages/toc/test/markdown.spec.ts b/packages/toc/test/markdown.spec.ts\nindex 4c7196a40e2a..179d5b842c49 100644\n--- a/packages/toc/test/markdown.spec.ts\n+++ b/packages/toc/test/markdown.spec.ts\n@@ -218,6 +218,9 @@ describe('TableOfContentsUtils', () => {\n         ['```\\n# Title\\n```', []],\n         ['```\\nTitle\\n--\\n```', []],\n         ['```\\n<h1>Title</h1>\\n```', []],\n+        ['~~~\\n# Title\\n~~~', []],\n+        ['~~~\\nTitle\\n--\\n~~~', []],\n+        ['~~~\\n<h1>Title</h1>\\n~~~', []],\n         ['---\\n<h1>Title</h1>\\n---', []],\n         ['---\\n# Title\\n---', []],\n         [\n@@ -337,7 +340,9 @@ front: matter\n           }\n         ]\n       ],\n-      ['````\\n```# Title-1\\n```\\n````', []],\n+      ['````\\n```# Title\\n```\\n````', []],\n+      ['````\\n~~~~# Title\\n~~~\\n````', []],\n+      ['~~~~\\n```# Title\\n```\\n~~~~~', []],\n       [\n         '````\\n```# Title-1\\n```\\n````\\n# Title-2\\n````\\n`````',\n         [\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16430",
    "pr_id": 16430,
    "issue_id": 14947,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Flaky UI tests\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nThe `Visual Regression Tests` and `Visual Regression Documentation` CI checks are often flaky, which makes the CI checks appear as failing.\r\n\r\n## Reproduce\r\n\r\nExample run for https://github.com/jupyterlab/jupyterlab/pull/14944: https://github.com/jupyterlab/jupyterlab/actions/runs/5817952284/job/15773457526?pr=14944\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/591645/e59cfdf5-0345-4786-a953-2dd5f14c79e4)\r\n\r\n## Expected behavior\r\n\r\nThe check should not fail that often, so maintainers can review and merge PRs with more confidence.\r\n\r\n## Context\r\n\r\nFlaky tests lead to maintenance burden and CI fatigue on maintainers. One has to download the Playwright repo and carefully check the errors to assess whether the failure is related to the change.\r\n\r\nAlso other maintainers might not feel confident merging PRs if one of the checks is failing (which is understandable).",
    "issue_word_count": 170,
    "test_files_count": 6,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/src/helpers/notebook.ts",
      "galata/test/documentation/extension_manager.test.ts",
      "galata/test/jupyterlab/console.test.ts",
      "galata/test/jupyterlab/notebook-max-outputs.test.ts",
      "galata/test/jupyterlab/notebook-search.test.ts",
      "galata/test/jupyterlab/settings.test.ts",
      "galata/test/jupyterlab/texteditor.test.ts",
      "packages/docmanager-extension/src/index.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/extension_manager.test.ts",
      "galata/test/jupyterlab/console.test.ts",
      "galata/test/jupyterlab/notebook-max-outputs.test.ts",
      "galata/test/jupyterlab/notebook-search.test.ts",
      "galata/test/jupyterlab/settings.test.ts",
      "galata/test/jupyterlab/texteditor.test.ts"
    ],
    "base_commit": "066dc21bfaf6785a49e0145a981d261a49da4f56",
    "head_commit": "6fd44da2e1b20656a3876e956c1b1f1128c52c7c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16430",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16430",
    "dockerfile": "",
    "pr_merged_at": "2024-06-06T11:48:30.000Z",
    "patch": "diff --git a/galata/src/helpers/notebook.ts b/galata/src/helpers/notebook.ts\nindex 03f1af7af52c..770d441497d6 100644\n--- a/galata/src/helpers/notebook.ts\n+++ b/galata/src/helpers/notebook.ts\n@@ -1260,7 +1260,7 @@ export class NotebookHelper {\n \n     await this._setCellMode(cell, 'Edit');\n     await cell.getByRole('textbox').press('Control+A');\n-    await cell.getByRole('textbox').type(source, { delay: 0 });\n+    await cell.getByRole('textbox').pressSequentially(source);\n     await this._setCellMode(cell, 'Command');\n \n     if (cellType === 'code') {\n\ndiff --git a/packages/docmanager-extension/src/index.tsx b/packages/docmanager-extension/src/index.tsx\nindex 121b39c72fc0..28b4c3892c2a 100644\n--- a/packages/docmanager-extension/src/index.tsx\n+++ b/packages/docmanager-extension/src/index.tsx\n@@ -689,7 +689,7 @@ function addCommands(\n   });\n \n   commands.addCommand(CommandIDs.newUntitled, {\n-    execute: args => {\n+    execute: async args => {\n       const errorTitle = (args['error'] as string) || trans.__('Error');\n       const path =\n         typeof args['path'] === 'undefined' ? '' : (args['path'] as string);\n@@ -710,7 +710,7 @@ function addCommands(\n   });\n \n   commands.addCommand(CommandIDs.open, {\n-    execute: args => {\n+    execute: async args => {\n       const path =\n         typeof args['path'] === 'undefined' ? '' : (args['path'] as string);\n       const factory = (args['factory'] as string) || void 0;\n",
    "test_patch": "diff --git a/galata/test/documentation/extension_manager.test.ts b/galata/test/documentation/extension_manager.test.ts\nindex 002e9303797f..6883a24d6d70 100644\n--- a/galata/test/documentation/extension_manager.test.ts\n+++ b/galata/test/documentation/extension_manager.test.ts\n@@ -89,7 +89,7 @@ test.describe('Extension Manager', () => {\n     await page\n       .locator('.jp-extensionmanager-view')\n       .getByRole('searchbox')\n-      .type('drawio');\n+      .fill('drawio');\n \n     await page.evaluate(() => {\n       (document.activeElement as HTMLElement).blur();\n\ndiff --git a/galata/test/jupyterlab/console.test.ts b/galata/test/jupyterlab/console.test.ts\nindex 2d588e8d74be..ff7e0ac176b4 100644\n--- a/galata/test/jupyterlab/console.test.ts\n+++ b/galata/test/jupyterlab/console.test.ts\n@@ -42,7 +42,7 @@ test.describe('Console', () => {\n     await expect.soft(cursor).toBeHidden();\n \n     // Try to type something into the editor\n-    await cellEditor.type('more text');\n+    await cellEditor.pressSequentially('more text');\n \n     // Expect the editor content to not change\n     expect(await cellEditor.innerText()).toBe('2 + 2');\n\ndiff --git a/galata/test/jupyterlab/notebook-max-outputs.test.ts b/galata/test/jupyterlab/notebook-max-outputs.test.ts\nindex 5414fe4b2479..b5474a67959d 100644\n--- a/galata/test/jupyterlab/notebook-max-outputs.test.ts\n+++ b/galata/test/jupyterlab/notebook-max-outputs.test.ts\n@@ -20,7 +20,7 @@ test('Limit cell outputs', async ({ page }) => {\n \n   await page.locator(\n     '.jp-Cell-inputArea >> .cm-editor >> .cm-content[contenteditable=\"true\"]'\n-  ).type(`from IPython.display import display, Markdown\n+  ).fill(`from IPython.display import display, Markdown\n \n for i in range(10):\n     display(Markdown('_Markdown_ **text**'))\n@@ -39,7 +39,7 @@ test(\"Don't limit cell outputs if input is requested\", async ({ page }) => {\n \n   await page.locator(\n     '.jp-Cell-inputArea >> .cm-editor >> .cm-content[contenteditable=\"true\"]'\n-  ).type(`from IPython.display import display, Markdown\n+  ).fill(`from IPython.display import display, Markdown\n \n for i in range(10):\n     display(Markdown('_Markdown_ **text**'))\n@@ -61,7 +61,7 @@ test('Display input value', async ({ page }) => {\n \n   await page.locator(\n     '.jp-Cell-inputArea >> .cm-editor >> .cm-content[contenteditable=\"true\"]'\n-  ).type(`from IPython.display import display, Markdown\n+  ).fill(`from IPython.display import display, Markdown\n \n for i in range(10):\n     display(Markdown('_Markdown_ **text**'))\n\ndiff --git a/galata/test/jupyterlab/notebook-search.test.ts b/galata/test/jupyterlab/notebook-search.test.ts\nindex f43424d638c7..bbe304c9ff79 100644\n--- a/galata/test/jupyterlab/notebook-search.test.ts\n+++ b/galata/test/jupyterlab/notebook-search.test.ts\n@@ -61,8 +61,8 @@ test.describe('Notebook Search', () => {\n \n     await page.fill('[placeholder=\"Find\"]', '14');\n     await page.press('[placeholder=\"Find\"]', 'ArrowLeft');\n-    await page.type('[placeholder=\"Find\"]', '2');\n-    await page.type('[placeholder=\"Find\"]', '3');\n+    await page.locator('[placeholder=\"Find\"]').pressSequentially('2');\n+    await page.locator('[placeholder=\"Find\"]').pressSequentially('3');\n \n     await expect(page.locator('[placeholder=\"Find\"]')).toHaveValue('1234');\n   });\n\ndiff --git a/galata/test/jupyterlab/settings.test.ts b/galata/test/jupyterlab/settings.test.ts\nindex f52ab1b3cf94..ecd9fb5fca31 100644\n--- a/galata/test/jupyterlab/settings.test.ts\n+++ b/galata/test/jupyterlab/settings.test.ts\n@@ -52,7 +52,7 @@ test.describe('change font-size', () => {\n     markdownFile: Locator\n   ) => {\n     await markdownFile.focus();\n-    await markdownFile.type('markdown cell');\n+    await markdownFile.pressSequentially('markdown cell');\n     await page.keyboard.press('Control');\n     await page.keyboard.press('s');\n   };\n@@ -214,7 +214,7 @@ test('Check codemirror settings can all be set at the same time.', async ({\n     'Highlight trailing white space',\n     'Highlight white space'\n   ];\n-  let locators = [];\n+  let locators: Locator[] = [];\n   for (const selectText of textList) {\n     let locator = page.getByLabel(selectText);\n     await locator.click();\n\ndiff --git a/galata/test/jupyterlab/texteditor.test.ts b/galata/test/jupyterlab/texteditor.test.ts\nindex 0c498b920eb4..7f4e3d43c5d0 100644\n--- a/galata/test/jupyterlab/texteditor.test.ts\n+++ b/galata/test/jupyterlab/texteditor.test.ts\n@@ -31,9 +31,9 @@ test.describe('Text Editor Tests', () => {\n \n     // Add two rulers\n     await page.locator('#root').getByRole('button', { name: 'Add' }).click();\n-    await page.locator('input[id=\"root_rulers_0\"]').type('50');\n+    await page.locator('input[id=\"root_rulers_0\"]').fill('50');\n     await page.locator('#root').getByRole('button', { name: 'Add' }).click();\n-    await page.locator('input[id=\"root_rulers_1\"]').type('75');\n+    await page.locator('input[id=\"root_rulers_1\"]').fill('75');\n \n     await page.activity.activateTab(DEFAULT_NAME);\n \n@@ -57,10 +57,9 @@ test.describe('Text Editor Tests', () => {\n \n     await page.locator(`[role=\"main\"] >> text=${DEFAULT_NAME}`).waitFor();\n \n-    await page.type(\n-      '.cm-content',\n-      'Not active\\nActive line with >>selected text<<\\nNot active'\n-    );\n+    await page\n+      .locator('.jp-FileEditorCodeWrapper .cm-content')\n+      .fill('Not active\\nActive line with >>selected text<<\\nNot active');\n \n     await page.keyboard.press('ArrowUp');\n     await page.keyboard.press('End');\n@@ -80,8 +79,7 @@ test.describe('Text Editor Tests', () => {\n \n     await page.locator(`[role=\"main\"] >> text=${DEFAULT_NAME}`).waitFor();\n \n-    await page.type(\n-      '.cm-content',\n+    await page.locator('.jp-FileEditorCodeWrapper .cm-content').fill(\n       `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam urna\n libero, dictum a egestas non, placerat vel neque. In imperdiet iaculis fermentum.\n Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia\n@@ -118,7 +116,9 @@ ut elit.`\n       await page.menu.clickMenuItem('File>New>Text File');\n \n       await page.locator(`[role=\"main\"] >> text=${DEFAULT_NAME}`).waitFor();\n-      await page.type('.cm-content', 'text editor');\n+      await page\n+        .locator('.jp-FileEditorCodeWrapper .cm-content')\n+        .fill('text editor');\n     };\n     const changeFontSize = async (page: IJupyterLabPageFixture, menuOption) => {\n       await page.click('text=Settings');\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16420",
    "pr_id": 16420,
    "issue_id": 16403,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Comments in nested markdown code blocks incorrectly being identified as TOC headings\n> I've also noticed issues with items incorrectly being identified as TOC items.\r\n> \r\n> For example, if I have a code block inside a MyST / jupyterlab-myst rendered admonition block, and the code block contains a # prefixed comment, that is parsed as a header / contents list item:\r\n> \r\n> <img width=\"825\" alt=\"image\" src=\"https://github.com/jupyterlab/jupyterlab/assets/82988/d7c29c23-2a5c-4cfc-9e23-4805e67a5b2d\">\r\n> \r\n> I also note the item inside the code block inside the admonition block is only rendered into TOC if there is whitespace after the #.\r\n> \r\n> _Originally posted by @psychemedia in https://github.com/jupyterlab/jupyterlab/issues/16401#issuecomment-2139626432_\r\n            ",
    "issue_word_count": 114,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/toc/src/utils/markdown.ts",
      "packages/toc/test/markdown.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/toc/test/markdown.spec.ts"
    ],
    "base_commit": "0c13a5b75784190141f151a4b8a2ca32bd3f8559",
    "head_commit": "b3490a8c21b8d9b25cc52b397b077c28f8682c83",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16420",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16420",
    "dockerfile": "",
    "pr_merged_at": "2024-06-03T19:16:34.000Z",
    "patch": "diff --git a/packages/toc/src/utils/markdown.ts b/packages/toc/src/utils/markdown.ts\nindex 92b45cc33d5e..b18de258d18b 100644\n--- a/packages/toc/src/utils/markdown.ts\n+++ b/packages/toc/src/utils/markdown.ts\n@@ -75,6 +75,7 @@ export function getHeadings(text: string): IMarkdownHeading[] {\n   // Iterate over the lines to get the header level and text for each line:\n   const headings = new Array<IMarkdownHeading>();\n   let isCodeBlock;\n+  let startBackticks = 0;\n   let lineIdx = 0;\n \n   // Don't check for Markdown headings if in a YAML frontmatter block.\n@@ -105,7 +106,16 @@ export function getHeadings(text: string): IMarkdownHeading[] {\n \n     // Don't check for Markdown headings if in a code block\n     if (line.startsWith('```')) {\n-      isCodeBlock = !isCodeBlock;\n+      const backticks = extractLeadingBackticks(line);\n+      if (backticks === 0) continue;\n+      else if (startBackticks === 0) {\n+        isCodeBlock = !isCodeBlock;\n+        startBackticks = backticks;\n+        continue;\n+      } else if (backticks !== 0 && backticks >= startBackticks) {\n+        isCodeBlock = !isCodeBlock;\n+        startBackticks = 0;\n+      }\n     }\n     if (isCodeBlock) {\n       continue;\n@@ -123,6 +133,11 @@ export function getHeadings(text: string): IMarkdownHeading[] {\n   return headings;\n }\n \n+function extractLeadingBackticks(line: string) {\n+  const match = line.match(/^(`{3,})/);\n+  return match ? match[0].length : 0;\n+}\n+\n const MARKDOWN_MIME_TYPE = [\n   'text/x-ipythongfm',\n   'text/x-markdown',\n",
    "test_patch": "diff --git a/packages/toc/test/markdown.spec.ts b/packages/toc/test/markdown.spec.ts\nindex d8cebcefcc66..4c7196a40e2a 100644\n--- a/packages/toc/test/markdown.spec.ts\n+++ b/packages/toc/test/markdown.spec.ts\n@@ -323,6 +323,48 @@ front: matter\n       });\n     });\n \n+    it.each<[string, TableOfContentsUtils.Markdown.IMarkdownHeading[]]>([\n+      [\n+        '# Title',\n+        [\n+          {\n+            text: 'Title',\n+            level: 1,\n+            line: 0,\n+            raw: '# Title',\n+            prefix: '1. ',\n+            skip: false\n+          }\n+        ]\n+      ],\n+      ['````\\n```# Title-1\\n```\\n````', []],\n+      [\n+        '````\\n```# Title-1\\n```\\n````\\n# Title-2\\n````\\n`````',\n+        [\n+          {\n+            text: 'Title-2',\n+            level: 1,\n+            line: 4,\n+            raw: '# Title-2',\n+            prefix: '1. ',\n+            skip: false\n+          }\n+        ]\n+      ]\n+    ])('should verify comments in nested codeblocks in %s', (src, headers) => {\n+      const headings = TableOfContentsUtils.filterHeadings(\n+        TableOfContentsUtils.Markdown.getHeadings(src),\n+        {\n+          maximalDepth: 6,\n+          numberHeaders: true\n+        }\n+      );\n+      expect(headings).toHaveLength(headers.length);\n+      for (let i = 0; i < headers.length; i++) {\n+        expect(headings[i]).toEqual(headers[i]);\n+      }\n+    });\n+\n     it.each<[string]>([\n       ['### Title <a class=\"tocSkip\"></a>'],\n       ['### Title <a title=\"noisy title\" class=\"jp-toc-ignore\"></a>'],\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16351",
    "pr_id": 16351,
    "issue_id": 16349,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Check links CI keeps failing on links to medium blog posts\nFor example:\r\n\r\n```\r\n_ /home/runner/work/jupyterlab/jupyterlab/CHANGELOG.md: https://blog.jupyter.org/recent-keyboard-navigation-improvements-in-jupyter-4df32f97628d _\r\nhttps://blog.jupyter.org/recent-keyboard-navigation-improvements-in-jupyter-4df32f97628d: 429: Too Many Requests\r\n```\r\n\r\nSince Jupyter controls the blog posts, should we add `blog.jupyter.org` to ignore list?",
    "issue_word_count": 63,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "44b82c8c55880a02c088ebd9576da807dc471b48",
    "head_commit": "a08b20bcacf2d583a9b339e9ccba8785e3f96452",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16351",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16351",
    "dockerfile": "",
    "pr_merged_at": "2024-05-23T06:42:08.000Z",
    "patch": "",
    "test_patch": "diff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex 10e68c560c30..a5e9006a09df 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -153,4 +153,4 @@ jobs:\n       - uses: jupyterlab/maintainer-tools/.github/actions/check-links@v1\n         with:\n           ignore_glob: \"docs/api packages/ui-components/docs/source/ui_components.rst images\"\n-          ignore_links: \".*/images/[\\\\w-]+.png https://docs.github.com/en/.* https://jupyterlab.github.io https://mybinder.org/v2/gh/jupyterlab/.* https://github.com/[^/]+/?$\"\n+          ignore_links: \".*/images/[\\\\w-]+.png https://docs.github.com/en/.* https://jupyterlab.github.io https://mybinder.org/v2/gh/jupyterlab/.* https://github.com/[^/]+/?$ https://blog.jupyter.org/.*\"\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16348",
    "pr_id": 16348,
    "issue_id": 16339,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Console not working with Interaction mode set to Terminal\n## Description\r\n\r\nI cannot use any Code Console when I've set the Interaction Mode to Terminal in the Code Console Settings tab.\r\nProblems:\r\n1. I cannot send any command.\r\n2. Code completer does not work properly, does not accept Enter.\r\n\r\n## Reproduce\r\n\r\n1. Go to 'Settings'\r\n2. Click on 'Code Console' on the left\r\n3. Change Interaction Mode to 'Terminal'\r\n4. Start a any Console i.e. 'Python 3 (ipykernel)'\r\n5. Try to send anything i.e. '1+1'\r\n\r\n## Expected behavior\r\n\r\nA working Code Console.\r\n\r\n## Context\r\n\r\n- Operating System and version: Archlinux\r\n- Browser and version: Chrome\r\n- JupyterLab version: 4.2.0\r\n",
    "issue_word_count": 108,
    "test_files_count": 1,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "galata/test/jupyterlab/console.test.ts",
      "packages/codemirror/src/commands.ts",
      "packages/console/package.json",
      "packages/console/src/widget.ts",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/console.test.ts"
    ],
    "base_commit": "44b82c8c55880a02c088ebd9576da807dc471b48",
    "head_commit": "d881fb808fbcf2cf30141778bcddb728c4b0a0f5",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16348",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16348",
    "dockerfile": "",
    "pr_merged_at": "2024-05-22T06:08:01.000Z",
    "patch": "diff --git a/packages/codemirror/src/commands.ts b/packages/codemirror/src/commands.ts\nindex 20e09080ab2b..32de4d209547 100644\n--- a/packages/codemirror/src/commands.ts\n+++ b/packages/codemirror/src/commands.ts\n@@ -22,6 +22,11 @@ import {\n  */\n const CODE_RUNNER_SELECTOR = '[data-jp-code-runner]';\n \n+/**\n+ * Selector for a widget that can run code in terminal mode.\n+ */\n+const TERMINAL_CODE_RUNNER_SELECTOR = '[data-jp-interaction-mode=\"terminal\"]';\n+\n /**\n  * Selector for a widget that can open a tooltip.\n  */\n@@ -77,6 +82,10 @@ export namespace StateCommands {\n       // do not prevent default to allow completer `enter` action\n       return false;\n     }\n+    if (target.dom.closest(TERMINAL_CODE_RUNNER_SELECTOR)) {\n+      // do not prevent default to allow for the cell to run\n+      return false;\n+    }\n \n     const arg = { state: target.state, dispatch: target.dispatch };\n     return insertNewlineAndIndent(arg);\n\ndiff --git a/packages/console/package.json b/packages/console/package.json\nindex f830ca0e284b..e7d80aeecf00 100644\n--- a/packages/console/package.json\n+++ b/packages/console/package.json\n@@ -42,8 +42,6 @@\n     \"watch\": \"tsc -b --watch\"\n   },\n   \"dependencies\": {\n-    \"@codemirror/state\": \"^6.4.1\",\n-    \"@codemirror/view\": \"^6.26.3\",\n     \"@jupyter/ydoc\": \"^2.0.1\",\n     \"@jupyterlab/apputils\": \"^4.3.0\",\n     \"@jupyterlab/cells\": \"^4.2.0\",\n\ndiff --git a/packages/console/src/widget.ts b/packages/console/src/widget.ts\nindex e79adfbdf1a7..8cc85deab949 100644\n--- a/packages/console/src/widget.ts\n+++ b/packages/console/src/widget.ts\n@@ -1,8 +1,6 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { Prec } from '@codemirror/state';\n-import { EditorView } from '@codemirror/view';\n import { createStandaloneCell, ISharedRawCell } from '@jupyter/ydoc';\n import { DOMUtils, ISessionContext } from '@jupyterlab/apputils';\n import {\n@@ -94,11 +92,6 @@ const JUPYTER_CELL_MIME = 'application/vnd.jupyter.cells';\n  * The data attribute added to a widget that can undo.\n  */\n const UNDOER = 'jpUndoer';\n-/**\n- * The data attribute Whether the console interaction mimics the notebook\n- * or terminal keyboard shortcuts.\n- */\n-const INTERACTION_MODE = 'jpInteractionMode';\n \n /**\n  * A widget containing a Jupyter console.\n@@ -788,33 +781,17 @@ export class CodeConsole extends Widget {\n    * Create the options used to initialize a code cell widget.\n    */\n   private _createCodeCellOptions(): CodeCell.IOptions {\n-    const { node } = this;\n     const contentFactory = this.contentFactory;\n     const modelFactory = this.modelFactory;\n     const model = modelFactory.createCodeCell({});\n     const rendermime = this.rendermime;\n     const editorConfig = this.editorConfig;\n \n-    // Suppress the default \"Enter\" key handling.\n-    const onKeyDown = EditorView.domEventHandlers({\n-      keydown: (event: KeyboardEvent, view: EditorView) => {\n-        if (\n-          event.keyCode === 13 &&\n-          node.dataset[INTERACTION_MODE] === 'terminal'\n-        ) {\n-          event.preventDefault();\n-          return true;\n-        }\n-        return false;\n-      }\n-    });\n-\n     return {\n       model,\n       rendermime,\n       contentFactory,\n       editorConfig,\n-      editorExtensions: [Prec.high(onKeyDown)],\n       placeholder: false,\n       translator: this._translator\n     };\n\ndiff --git a/yarn.lock b/yarn.lock\nindex d0929a72f948..cc1aaa4b99c5 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2670,8 +2670,6 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/console@workspace:packages/console\"\n   dependencies:\n-    \"@codemirror/state\": ^6.4.1\n-    \"@codemirror/view\": ^6.26.3\n     \"@jupyter/ydoc\": ^2.0.1\n     \"@jupyterlab/apputils\": ^4.3.0\n     \"@jupyterlab/cells\": ^4.2.0\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/console.test.ts b/galata/test/jupyterlab/console.test.ts\nindex 6a12e9663637..2d588e8d74be 100644\n--- a/galata/test/jupyterlab/console.test.ts\n+++ b/galata/test/jupyterlab/console.test.ts\n@@ -1,28 +1,34 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { expect, test } from '@jupyterlab/galata';\n+import {\n+  expect,\n+  galata,\n+  IJupyterLabPageFixture,\n+  test\n+} from '@jupyterlab/galata';\n \n const CELL_EDITOR_SELECTOR = '.jp-InputArea-editor';\n const CODE_MIRROR_CURSOR = '.cm-cursor';\n+const EXECUTED_CELL = '[aria-label=\"Code Cell Content with Output\"]';\n \n-test.describe('Console', () => {\n-  test.beforeEach(async ({ page }) => {\n-    await page.menu.clickMenuItem('File>New>Console');\n+async function setupConsole(page: IJupyterLabPageFixture) {\n+  await page.menu.clickMenuItem('File>New>Console');\n \n-    await page.click('button:has-text(\"Select\")');\n+  await page.click('button:has-text(\"Select\")');\n \n-    await page.locator('[aria-label=\"Code Cell Content\"]').waitFor();\n-    await page.locator('text=| Idle').waitFor();\n-  });\n+  await page.locator('[aria-label=\"Code Cell Content\"]').waitFor();\n+  await page.locator('text=| Idle').waitFor();\n+}\n+\n+test.describe('Console', () => {\n+  test.beforeEach(async ({ page }) => setupConsole(page));\n \n   test('Executed cells should become read-only', async ({ page }) => {\n     await page.keyboard.type('2 + 2');\n     await page.keyboard.press('Shift+Enter');\n \n-    const executedCell = page.locator(\n-      '[aria-label=\"Code Cell Content with Output\"]'\n-    );\n+    const executedCell = page.locator(EXECUTED_CELL);\n     await executedCell.waitFor();\n \n     const cellEditor = executedCell.locator(CELL_EDITOR_SELECTOR);\n@@ -42,3 +48,27 @@ test.describe('Console', () => {\n     expect(await cellEditor.innerText()).toBe('2 + 2');\n   });\n });\n+\n+test.describe('Console (terminal mode)', () => {\n+  test.use({\n+    mockSettings: {\n+      ...galata.DEFAULT_SETTINGS,\n+      '@jupyterlab/console-extension:tracker': {\n+        ...galata.DEFAULT_SETTINGS['@jupyterlab/console-extension:tracker'],\n+        interactionMode: 'terminal'\n+      }\n+    }\n+  });\n+\n+  test.beforeEach(async ({ page }) => setupConsole(page));\n+\n+  test('Cells get executed with Enter ', async ({ page }) => {\n+    await page.keyboard.type('2**22');\n+    await page.keyboard.press('Enter');\n+\n+    const executedCell = page.locator(EXECUTED_CELL);\n+    await executedCell.waitFor();\n+\n+    await expect(executedCell).toContainText('4194304');\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16343",
    "pr_id": 16343,
    "issue_id": 16319,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Shift + tab does not open inspector tooltip on 4.2.0\n## Description\r\n\r\nShift + tab does not open inspector tooltip on 4.2.0\r\n\r\nas reported on https://stackoverflow.com/questions/78464382/shift-tab-isnt-showing-docstring-anymore\r\n\r\n## Reproduce\r\n\r\n1. Type `int`\r\n2. Press Shift + Tab\r\n\r\n\r\n## Expected behavior\r\n\r\n- There is an integration test case for this shortcut\r\n- The shortcut works\r\n\r\n## Context\r\n\r\n- Works in 4.1.0\r\n- Works in 4.2.0b0\r\n- Does not work in 4.2.0b1 - it could be related to https://github.com/jupyterlab/jupyterlab/pull/16078 or another PR merged in 4.2.0b1 (https://github.com/jupyterlab/jupyterlab/releases/tag/v4.2.0b1)",
    "issue_word_count": 107,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/inspector-tooltip.test.ts",
      "packages/codemirror/src/commands.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/inspector-tooltip.test.ts"
    ],
    "base_commit": "44b82c8c55880a02c088ebd9576da807dc471b48",
    "head_commit": "7d2c35d48bfca9dc0364549aa5eac1b68e2cf365",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16343",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16343",
    "dockerfile": "",
    "pr_merged_at": "2024-05-22T16:56:21.000Z",
    "patch": "diff --git a/packages/codemirror/src/commands.ts b/packages/codemirror/src/commands.ts\nindex 20e09080ab2b..4fc7c68b8713 100644\n--- a/packages/codemirror/src/commands.ts\n+++ b/packages/codemirror/src/commands.ts\n@@ -141,7 +141,7 @@ export namespace StateCommands {\n     dispatch: (transaction: Transaction) => void;\n   }): boolean {\n     if (target.dom.closest(TOOLTIP_OPENER_SELECTOR)) {\n-      return true;\n+      return false;\n     }\n     return indentLess(target);\n   }\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/inspector-tooltip.test.ts b/galata/test/jupyterlab/inspector-tooltip.test.ts\nnew file mode 100644\nindex 000000000000..e5ecf013a980\n--- /dev/null\n+++ b/galata/test/jupyterlab/inspector-tooltip.test.ts\n@@ -0,0 +1,30 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { expect, test } from '@jupyterlab/galata';\n+\n+const fileName = 'notebook.ipynb';\n+const TOOLTIP_SELECTOR = '.jp-Tooltip';\n+\n+test.describe('Inspector (contextual help) tooltip', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.notebook.createNew(fileName);\n+  });\n+\n+  test('Should show up on Shift + Tab', async ({ page }) => {\n+    await page.notebook.setCell(0, 'code', 'int');\n+    await page.notebook.enterCellEditingMode(0);\n+    // Ensure the cursor is at the end of the cell, after \"int\"\n+    await page.keyboard.press('End');\n+    // Ensure kernel is ready\n+    await page.locator('text=| Idle').waitFor();\n+    const tooltip = page.locator(TOOLTIP_SELECTOR);\n+    // There should be no tooltip yet\n+    await expect(tooltip).toHaveCount(0);\n+    // Invoke the tooltip\n+    await page.keyboard.press('Shift+Tab');\n+    // There should be a tooltip now\n+    await expect(tooltip).toHaveCount(1);\n+    await expect(tooltip).toContainText('int');\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16341",
    "pr_id": 16341,
    "issue_id": 13916,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Add button closing dangling kernels\n> The \"dangling\" kernel is actually a real live kernel session that still exists but had no visibility before.\r\n\r\nIt was visible before too (and is on 3.x and 2.x). This is the where users refer to when they run low on memory (killing old kernels from closed notebooks that were previously closed). Maybe we even should have a button for \"Kill all kernels which do not have any notebook/console\".\r\n\r\nOn this use-case we could have something like this:\r\n\r\n![Screenshot from 2023-01-24 19-53-59](https://user-images.githubusercontent.com/5832902/214395002-c1fbba37-d280-49d3-a28d-d233cd922843.png)\r\n\r\n> Note: the numbers in circles on the graphic are irrelevant; those were from an exploration suggesting how to show the number of documents/widgets connected to the kernel.\r\n\r\n_Originally posted by @krassowski in https://github.com/jupyterlab/jupyterlab/issues/13779#issuecomment-1402523525_\r\n",
    "issue_word_count": 150,
    "test_files_count": 3,
    "non_test_files_count": 8,
    "pr_changed_files": [
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png",
      "packages/running-extension/src/index.ts",
      "packages/running-extension/src/kernels.tsx",
      "packages/running-extension/tsconfig.json",
      "packages/running/src/index.tsx",
      "packages/ui-components/src/components/toolbar.tsx",
      "packages/ui-components/src/icon/iconimports.ts",
      "packages/ui-components/style/deprecated.css",
      "packages/ui-components/style/icons/toolbar/cleaning.svg"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png"
    ],
    "base_commit": "eb678f70df0376080df2e80d47b74a989ac552c9",
    "head_commit": "b1097d909688dd97b2751a2ec6c12eea94c436f6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16341",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16341",
    "dockerfile": "",
    "pr_merged_at": "2024-08-10T20:17:32.000Z",
    "patch": "diff --git a/packages/running-extension/src/index.ts b/packages/running-extension/src/index.ts\nindex 7c1b86f03d63..c48522326b0e 100644\n--- a/packages/running-extension/src/index.ts\n+++ b/packages/running-extension/src/index.ts\n@@ -39,6 +39,7 @@ export namespace CommandIDs {\n   export const kernelNewNotebook = 'running:kernel-new-notebook';\n   export const kernelOpenSession = 'running:kernel-open-session';\n   export const kernelShutDown = 'running:kernel-shut-down';\n+  export const kernelShutDownUnused = 'running:kernel-shut-down-unused';\n   export const showPanel = 'running:show-panel';\n   export const showModal = 'running:show-modal';\n }\n\ndiff --git a/packages/running-extension/src/kernels.tsx b/packages/running-extension/src/kernels.tsx\nindex a460c3b2ba09..1debeef399a3 100644\n--- a/packages/running-extension/src/kernels.tsx\n+++ b/packages/running-extension/src/kernels.tsx\n@@ -2,13 +2,16 @@\n // Distributed under the terms of the Modified BSD License.\n \n import { JupyterFrontEnd } from '@jupyterlab/application';\n+import { Dialog, showDialog } from '@jupyterlab/apputils';\n import { PathExt } from '@jupyterlab/coreutils';\n import { IRenderMime } from '@jupyterlab/rendermime-interfaces';\n import { IRunningSessionManagers, IRunningSessions } from '@jupyterlab/running';\n-import { Kernel, KernelSpec, Session } from '@jupyterlab/services';\n+import { Kernel, KernelAPI, KernelSpec, Session } from '@jupyterlab/services';\n import { ITranslator } from '@jupyterlab/translation';\n import {\n+  cleaningIcon,\n   closeIcon,\n+  CommandToolbarButton,\n   consoleIcon,\n   IDisposableMenuItem,\n   jupyterIcon,\n@@ -20,8 +23,8 @@ import {\n import { CommandRegistry } from '@lumino/commands';\n import { Throttler } from '@lumino/polling';\n import { Signal } from '@lumino/signaling';\n-import { CommandIDs } from '.';\n import React, { ReactNode } from 'react';\n+import { CommandIDs } from '.';\n \n const KERNEL_ITEM_CLASS = 'jp-mod-kernel';\n const KERNELSPEC_ITEM_CLASS = 'jp-mod-kernelspec';\n@@ -41,14 +44,83 @@ export async function addKernelRunningSessionManager(\n   const { runningChanged, RunningKernel } = Private;\n   const throttler = new Throttler(() => runningChanged.emit(undefined), 100);\n   const trans = translator.load('jupyterlab');\n+  const shutdownUnusedLabel = trans.__('Shut Down Unused');\n+  let shutdownUnusedEnabled = false;\n+  const shutdownUnusedThrottler = new Throttler(\n+    checkShutdownUnusedEnabled,\n+    10000\n+  );\n \n   // Throttle signal emissions from the kernel and session managers.\n-  kernels.runningChanged.connect(() => void throttler.invoke());\n+  kernels.runningChanged.connect(() => {\n+    void throttler.invoke();\n+    void shutdownUnusedThrottler.invoke();\n+  });\n   sessions.runningChanged.connect(() => void throttler.invoke());\n \n   // Wait until the relevant services are ready.\n   await Promise.all([kernels.ready, kernelspecs.ready, sessions.ready]);\n \n+  function getUnusedKernels() {\n+    // Identifies unused kernels\n+    return Array.from(kernels.running()).filter(\n+      kernel => (kernel.connections ?? 1) < 1\n+    );\n+  }\n+\n+  async function checkShutdownUnusedEnabled() {\n+    const wasEnabled = shutdownUnusedEnabled;\n+    shutdownUnusedEnabled = getUnusedKernels().length > 0;\n+    if (wasEnabled !== shutdownUnusedEnabled) {\n+      commands.notifyCommandChanged(CommandIDs.kernelShutDownUnused);\n+    }\n+  }\n+\n+  commands.addCommand(CommandIDs.kernelShutDownUnused, {\n+    label: args => (args.toolbar ? '' : shutdownUnusedLabel),\n+    icon: args => (args.toolbar ? cleaningIcon : undefined),\n+    execute: async () => {\n+      const unusedKernels = getUnusedKernels();\n+\n+      if (unusedKernels.length === 0) {\n+        return;\n+      }\n+\n+      const confirmed = await showDialog({\n+        title: shutdownUnusedLabel,\n+        body: (\n+          <>\n+            {trans.__(\n+              'Are you sure you want to shut down the following unused kernels?'\n+            )}\n+            <ul>\n+              {unusedKernels.map(kernel => (\n+                <li key={kernel.id}>\n+                  {trans.__('%1 (%2)', kernel.name, kernel.id.slice(0, 8))}\n+                </li>\n+              ))}\n+            </ul>\n+          </>\n+        ),\n+        buttons: [\n+          Dialog.cancelButton(),\n+          Dialog.warnButton({ label: shutdownUnusedLabel })\n+        ]\n+      });\n+\n+      if (confirmed.button.accept) {\n+        await Promise.allSettled(\n+          unusedKernels.map(kernel => KernelAPI.shutdownKernel(kernel.id))\n+        );\n+        await Promise.all([\n+          kernels.refreshRunning(),\n+          sessions.refreshRunning()\n+        ]);\n+      }\n+    },\n+    isEnabled: () => shutdownUnusedEnabled\n+  });\n+\n   // Add the kernels pane to the running sidebar.\n   managers.add({\n     name: trans.__('Kernels'),\n@@ -96,7 +168,15 @@ export async function addKernelRunningSessionManager(\n         'Are you sure you want to permanently shut down the running kernel?',\n         'Are you sure you want to permanently shut down the %1 running kernels?',\n         kernels.runningCount\n-      )\n+      ),\n+    toolbarButtons: [\n+      new CommandToolbarButton({\n+        commands,\n+        id: CommandIDs.kernelShutDownUnused,\n+        caption: shutdownUnusedLabel,\n+        args: { toolbar: true }\n+      })\n+    ]\n   });\n \n   // Add running kernels commands to the registry.\n\ndiff --git a/packages/running-extension/tsconfig.json b/packages/running-extension/tsconfig.json\nindex 292a12327796..07ef586f2826 100644\n--- a/packages/running-extension/tsconfig.json\n+++ b/packages/running-extension/tsconfig.json\n@@ -3,7 +3,7 @@\n   \"compilerOptions\": {\n     \"outDir\": \"lib\",\n     \"rootDir\": \"src\",\n-    \"lib\": [\"DOM\", \"DOM.Iterable\", \"ES2019\", \"ES2020.Intl\"]\n+    \"lib\": [\"DOM\", \"DOM.Iterable\", \"ES2020\", \"ES2020.Intl\"]\n   },\n   \"include\": [\"src/*\"],\n   \"references\": [\n\ndiff --git a/packages/running/src/index.tsx b/packages/running/src/index.tsx\nindex 5ee96ce02de2..82fdaf1be607 100644\n--- a/packages/running/src/index.tsx\n+++ b/packages/running/src/index.tsx\n@@ -16,6 +16,7 @@ import {\n import {\n   closeIcon,\n   collapseAllIcon,\n+  CommandToolbarButton,\n   expandAllIcon,\n   FilterBox,\n   getTreeItemElement,\n@@ -663,6 +664,16 @@ class Section extends PanelWithToolbar {\n     this._updateButtons();\n     this._manager.runningChanged.connect(this._updateButtons, this);\n \n+    // Add manager-specific buttons\n+    if (this._manager.toolbarButtons) {\n+      this._manager.toolbarButtons.forEach(button =>\n+        this.toolbar.addItem(\n+          button instanceof CommandToolbarButton ? button.commandId : button.id,\n+          button\n+        )\n+      );\n+    }\n+\n     for (const name of ['collapse-expand', 'switch-view', 'shutdown-all']) {\n       this.toolbar.addItem(\n         name,\n@@ -1199,6 +1210,11 @@ export namespace IRunningSessions {\n      */\n     shutdownItemIcon?: LabIcon;\n \n+    /**\n+     * Used to add arbitrary buttons to this section\n+     */\n+    toolbarButtons?: (ToolbarButton | CommandToolbarButton)[];\n+\n     /**\n      * Whether the manager supports tree view for its items\n      * or only a flat list.\n\ndiff --git a/packages/ui-components/src/components/toolbar.tsx b/packages/ui-components/src/components/toolbar.tsx\nindex 5fc58fcac93a..86334937acd2 100644\n--- a/packages/ui-components/src/components/toolbar.tsx\n+++ b/packages/ui-components/src/components/toolbar.tsx\n@@ -1115,6 +1115,12 @@ export class CommandToolbarButton extends ReactWidget {\n   render(): JSX.Element {\n     return <CommandToolbarButtonComponent {...this.props} />;\n   }\n+  /**\n+   * Identifier of the underlying command.\n+   */\n+  get commandId(): string {\n+    return this.props.id;\n+  }\n }\n \n /**\n\ndiff --git a/packages/ui-components/src/icon/iconimports.ts b/packages/ui-components/src/icon/iconimports.ts\nindex 257ccf4ea5fc..6d00f7a4040e 100644\n--- a/packages/ui-components/src/icon/iconimports.ts\n+++ b/packages/ui-components/src/icon/iconimports.ts\n@@ -26,6 +26,7 @@ import caseSensitiveSvgstr from '../../style/icons/search/case-sensitive.svg';\n import checkSvgstr from '../../style/icons/toolbar/check.svg';\n import circleEmptySvgstr from '../../style/icons/toolbar/circle-empty.svg';\n import circleSvgstr from '../../style/icons/toolbar/circle.svg';\n+import cleaningSvgstr from '../../style/icons/toolbar/cleaning.svg';\n import clearSvgstr from '../../style/icons/toolbar/clear.svg';\n import closeSvgstr from '../../style/icons/toolbar/close.svg';\n import codeCheckSvgstr from '../../style/icons/lsp/code-check.svg';\n@@ -132,6 +133,7 @@ export const caseSensitiveIcon = new LabIcon({ name: 'ui-components:case-sensiti\n export const checkIcon = new LabIcon({ name: 'ui-components:check', svgstr: checkSvgstr });\n export const circleEmptyIcon = new LabIcon({ name: 'ui-components:circle-empty', svgstr: circleEmptySvgstr });\n export const circleIcon = new LabIcon({ name: 'ui-components:circle', svgstr: circleSvgstr });\n+export const cleaningIcon = new LabIcon({ name: 'ui-components:cleaning', svgstr: cleaningSvgstr });\n export const clearIcon = new LabIcon({ name: 'ui-components:clear', svgstr: clearSvgstr });\n export const closeIcon = new LabIcon({ name: 'ui-components:close', svgstr: closeSvgstr });\n export const codeCheckIcon = new LabIcon({ name: 'ui-components:code-check', svgstr: codeCheckSvgstr });\n\ndiff --git a/packages/ui-components/style/deprecated.css b/packages/ui-components/style/deprecated.css\nindex d518949f4b3c..12f208dc4a6b 100644\n--- a/packages/ui-components/style/deprecated.css\n+++ b/packages/ui-components/style/deprecated.css\n@@ -30,6 +30,7 @@\n   --jp-icon-check: url('icons/toolbar/check.svg');\n   --jp-icon-circle-empty: url('icons/toolbar/circle-empty.svg');\n   --jp-icon-circle: url('icons/toolbar/circle.svg');\n+  --jp-icon-cleaning: url('icons/toolbar/cleaning.svg');\n   --jp-icon-clear: url('icons/toolbar/clear.svg');\n   --jp-icon-close: url('icons/toolbar/close.svg');\n   --jp-icon-code-check: url('icons/lsp/code-check.svg');\n@@ -192,6 +193,10 @@\n   background-image: var(--jp-icon-circle);\n }\n \n+.jp-CleaningIcon {\n+  background-image: var(--jp-icon-cleaning);\n+}\n+\n .jp-ClearIcon {\n   background-image: var(--jp-icon-clear);\n }\n\ndiff --git a/packages/ui-components/style/icons/toolbar/cleaning.svg b/packages/ui-components/style/icons/toolbar/cleaning.svg\nnew file mode 100644\nindex 000000000000..ca2164570768\n--- /dev/null\n+++ b/packages/ui-components/style/icons/toolbar/cleaning.svg\n@@ -0,0 +1,5 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n+  <g class=\"jp-icon3\" fill=\"#616161\">\n+    <path d=\"M16,11h-1V3c0-1.1-0.9-2-2-2h-2C9.9,1,9,1.9,9,3v8H8c-2.76,0-5,2.24-5,5v7h18v-7C21,13.24,18.76,11,16,11z M19,21h-2v-3 c0-0.55-0.45-1-1-1s-1,0.45-1,1v3h-2v-3c0-0.55-0.45-1-1-1s-1,0.45-1,1v3H9v-3c0-0.55-0.45-1-1-1s-1,0.45-1,1v3H5v-5 c0-1.65,1.35-3,3-3h8c1.65,0,3,1.35,3,3V21z\"/>\n+  </g>\n+</svg>\n",
    "test_patch": "diff --git a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png\nindex e729d4458b65..f29d79389f62 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png\nindex 093e01673858..11a6f6100f13 100644\nBinary files a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png and b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png\nindex 6b964d5bd564..349b03f71951 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16324",
    "pr_id": 16324,
    "issue_id": 15801,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "4.2 Release Plan\n## Current Status\r\n\r\n`4.1.0` was released two weeks ago. A first [`4.1.1`](https://github.com/jupyterlab/jupyterlab/releases/tag/v4.1.1) patch version was released on Monday.\r\n\r\nThis is an issue to track the features for the `4.2` release.\r\n\r\n## Features\r\n\r\nThere are currently 85 items in the `4.2.0` milestone: https://github.com/jupyterlab/jupyterlab/milestone/76.\r\n\r\nWe can document major planned features for coordination. PR ready by the feature freeze date will be reviewed, but please aim to share things you plan to contribute to 4.2.0 ahead (by commenting in this issue, or editing this list if you have access) to allow time for discussion.\r\n\r\n**Feel free to edit this list or comment below to add more items**:\r\n- [ ] https://github.com/jupyterlab/jupyterlab/pull/15448 (implemented in `jupyter-collaboration` extension)\r\n- [ ] https://github.com/jupyterlab/jupyterlab/pull/15157 (deferred to 4.3)\r\n- [x] https://github.com/jupyterlab/jupyterlab/pull/15483\r\n- [x] https://github.com/jupyterlab/jupyterlab/pull/15946\r\n- [x] https://github.com/jupyterlab/jupyterlab/pull/15964\r\n- [x] https://github.com/jupyterlab/jupyterlab/pull/15962\r\n- [x] https://github.com/jupyterlab/jupyterlab/pull/15845\r\n- [x] https://github.com/jupyterlab/jupyterlab/pull/15623\r\n- [ ] https://github.com/jupyterlab/jupyterlab/pull/15155 (deferred)\r\n\r\n## Timeline (provisional)\r\n\r\n- feature freeze: 27 March (beta0 release; no additional pull requests adding new features would be considered past this date)\r\n- first release candidate: 17 April (rc0 release if no release blockers identified)\r\n- final release: <s>1 May</s> 3 May  (at a minimum one week after RC)",
    "issue_word_count": 258,
    "test_files_count": 5,
    "non_test_files_count": 32,
    "pr_changed_files": [
      ".github/pull_request_template.md",
      ".github/workflows/check-release.yml",
      ".github/workflows/codeql-analysis.yml",
      ".github/workflows/docker-test.yml",
      ".github/workflows/linuxjs-tests.yml",
      ".github/workflows/linuxtests.yml",
      ".github/workflows/macostests.yml",
      ".github/workflows/windowstests.yml",
      "CHANGELOG.md",
      "CONTRIBUTING.md",
      "README.md",
      "RELEASE.md",
      "buildutils/src/ensure-repo.ts",
      "docs/source/conf.py",
      "docs/source/developer/accessibility.rst",
      "docs/source/developer/components.rst",
      "docs/source/developer/contributing.rst",
      "docs/source/developer/css.rst",
      "docs/source/developer/repo.rst",
      "docs/source/extension/extension_dev.rst",
      "docs/source/extension/extension_migration.rst",
      "docs/source/extension/extension_multiple_ui.rst",
      "docs/source/extension/extension_tutorial.rst",
      "docs/source/extension/internationalization.rst",
      "docs/source/getting_started/faq.rst",
      "docs/source/getting_started/overview.rst",
      "docs/source/user/index.md",
      "galata/README.md",
      "packages/apputils-extension/src/announcements.ts",
      "packages/extensionmanager/src/widget.tsx",
      "packages/help-extension/src/index.tsx",
      "packages/javascript-extension/README.md",
      "packages/json-extension/README.md",
      "packages/services/README.md",
      "packages/ui-components/docs/source/intro.rst",
      "packages/ui-components/docs/source/labicon.rst",
      "packages/vega5-extension/README.md"
    ],
    "pr_changed_test_files": [
      ".github/workflows/docker-test.yml",
      ".github/workflows/linuxjs-tests.yml",
      ".github/workflows/linuxtests.yml",
      ".github/workflows/macostests.yml",
      ".github/workflows/windowstests.yml"
    ],
    "base_commit": "7ae2d436fc410b0cff51042a3350ba71f54f4445",
    "head_commit": "01bd75876690c9782eefa41fea91c763ac5bfba8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16324",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16324",
    "dockerfile": "",
    "pr_merged_at": "2024-05-14T07:22:06.000Z",
    "patch": "diff --git a/.github/pull_request_template.md b/.github/pull_request_template.md\nindex 9f3671a8ce8d..5813523788f8 100644\n--- a/.github/pull_request_template.md\n+++ b/.github/pull_request_template.md\n@@ -2,7 +2,7 @@\n Thanks for contributing to JupyterLab!\n Please fill out the following items to submit a pull request.\n See the contributing guidelines for more information:\n-https://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md\n+https://github.com/jupyterlab/jupyterlab/blob/4.2.x/CONTRIBUTING.md\n -->\n \n ## References\n\ndiff --git a/.github/workflows/check-release.yml b/.github/workflows/check-release.yml\nindex 37ef8dfcd612..3b0d22eb7700 100644\n--- a/.github/workflows/check-release.yml\n+++ b/.github/workflows/check-release.yml\n@@ -2,9 +2,9 @@ name: Check Release\n \n on:\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n-    branches: [main]\n+    branches: [4.2.x]\n   release:\n     types: [published]\n \n\ndiff --git a/.github/workflows/codeql-analysis.yml b/.github/workflows/codeql-analysis.yml\nindex 2fc415830193..fb45ab1450ec 100644\n--- a/.github/workflows/codeql-analysis.yml\n+++ b/.github/workflows/codeql-analysis.yml\n@@ -7,10 +7,10 @@ name: \"CodeQL\"\n \n on:\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n     # The branches below must be a subset of the branches above\n-    branches: [main]\n+    branches: [4.2.x]\n   schedule:\n     - cron: '0 8 * * 3'\n \n\ndiff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 4af81ae93651..d81cba91e64d 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -8,9 +8,9 @@\n \n ### Workspaces UI\n \n-It is now possible to switch and manage [workspaces](https://jupyterlab.readthedocs.io/en/latest/user/workspaces.html) from within JupyterLab.\n+It is now possible to switch and manage [workspaces](https://jupyterlab.readthedocs.io/en/stable/user/workspaces.html) from within JupyterLab.\n \n-<img alt=\"A context menu opened over the sidebar with workspaces list. The menu has options to manage the workspace over which it was opened - clone, rename, reset, delete, export, and import.\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.2-workspaces-sidebar.png\" class=\"jp-screenshot\">\n+<img alt=\"A context menu opened over the sidebar with workspaces list. The menu has options to manage the workspace over which it was opened - clone, rename, reset, delete, export, and import.\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.2-workspaces-sidebar.png\" class=\"jp-screenshot\">\n \n ### Recently opened/closed files\n \n@@ -20,19 +20,19 @@ Users are now able to:\n \n - re-open recently used files from the main menu:\n \n-   <img alt=\"An 'Open Recent' sub-menu in the 'File' menu allowing to re-open recently used files\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.2-recent-submenu.png\" class=\"jp-screenshot\">\n+   <img alt=\"An 'Open Recent' sub-menu in the 'File' menu allowing to re-open recently used files\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.2-recent-submenu.png\" class=\"jp-screenshot\">\n \n - re-open recently closed files from the sidebar:\n \n-   <img alt=\"A new 'Recently Closed' section in the 'Running' sidebar\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.2-recent-sidebar.png\" class=\"jp-screenshot\">\n+   <img alt=\"A new 'Recently Closed' section in the 'Running' sidebar\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.2-recent-sidebar.png\" class=\"jp-screenshot\">\n \n - quickly jump to open tabs/recently closed files by using a new searchable modal dialog (press <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>A</kbd> to open the dialog, or click on the \\[â†—\\] icon in the sidebar):\n \n-   <img alt=\"A modal dialog for quickly jumping to open/closed files\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.2-recent-modal.png\" class=\"jp-screenshot\">\n+   <img alt=\"A modal dialog for quickly jumping to open/closed files\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.2-recent-modal.png\" class=\"jp-screenshot\">\n \n ### Full notebook windowing mode by default\n \n-Notebooks in the `full` windowing mode only render the visible cells, significantly improving the performance of the application. One limitation of `full` mode is that the search function in your browser may produce false negatives; using the [JupyterLab search function](https://jupyterlab.readthedocs.io/en/latest/user/interface.html#searching) is recommended. To revert to the behaviour from JupyterLab 4.1, go to Settings â†’ Settings Editor â†’ Notebook, scroll to \"Windowing mode\", and choose `defer`.\n+Notebooks in the `full` windowing mode only render the visible cells, significantly improving the performance of the application. One limitation of `full` mode is that the search function in your browser may produce false negatives; using the [JupyterLab search function](https://jupyterlab.readthedocs.io/en/stable/user/interface.html#searching) is recommended. To revert to the behaviour from JupyterLab 4.1, go to Settings â†’ Settings Editor â†’ Notebook, scroll to \"Windowing mode\", and choose `defer`.\n \n ### Improved Shortcuts Editor\n \n@@ -42,14 +42,14 @@ Among the numerous improvements and bug fixes for the keyboard shortcuts editor:\n - shortcuts are correctly sorted when using a language pack,\n - shortcuts with different arguments are now correctly displayed as individual entries.\n \n-<img alt=\"A context menu opened over a keybinding in the Keyboard Shortcuts setting panel within the Settings widget\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.2-delete-shortcut.png\" class=\"jp-screenshot\">\n+<img alt=\"A context menu opened over a keybinding in the Keyboard Shortcuts setting panel within the Settings widget\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.2-delete-shortcut.png\" class=\"jp-screenshot\">\n \n ### Dark high contrast theme\n \n A new theme, JupyterLab Dark High Contrast, which is intended to benefit users with the need for higher contrast, following the WCAG AAA accessibility standard for color contrast.\n To select this theme, from the menu bar, choose Settings â†’ Theme â†’ JupyterLab Dark High Contrast. Please provide feedback and suggestions on further improvements to this theme.\n \n-<img alt=\"A dark high contrast theme\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.2-dark-high-contrast.png\" class=\"jp-screenshot\">\n+<img alt=\"A dark high contrast theme\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.2-dark-high-contrast.png\" class=\"jp-screenshot\">\n \n ### Keyboard shortcuts improvements\n \n@@ -60,7 +60,7 @@ Following feedback from users, implementation of certain shortcuts was moved fro\n \n ## v4.1\n \n-JupyterLab 4.1 includes a number of new features (described below), bug fixes, and enhancements for extension developers. This release is compatible with extensions supporting JupyterLab 4.0. Extension authors are recommended to consult the [Extension Migration Guide](https://jupyterlab.readthedocs.io/en/latest/extension/extension_migration.html#jupyterlab-4-0-to-4-1) which lists deprecations and changes to the public API.\n+JupyterLab 4.1 includes a number of new features (described below), bug fixes, and enhancements for extension developers. This release is compatible with extensions supporting JupyterLab 4.0. Extension authors are recommended to consult the [Extension Migration Guide](https://jupyterlab.readthedocs.io/en/stable/extension/extension_migration.html#jupyterlab-4-0-to-4-1) which lists deprecations and changes to the public API.\n \n ### Custom CSS\n \n@@ -69,7 +69,7 @@ Themes are the recommended way for customizing the JupyterLab look and feel,\n while custom CSS is intended for minor personal adjustments.\n \n To opt in, start JupyterLab with the `--custom-css` flag.\n-The location of the `custom.css` file is documented in the section on [customizing the user interface](https://jupyterlab.readthedocs.io/en/latest/user/interface_customization.html#custom-css).\n+The location of the `custom.css` file is documented in the section on [customizing the user interface](https://jupyterlab.readthedocs.io/en/stable/user/interface_customization.html#custom-css).\n \n ```{note}\n `custom.css` is also available in Jupyter Notebook;\n@@ -97,7 +97,7 @@ C -->|Two| E[Result 2]\n \n which renders as:\n \n-<img alt=\"Rendered Mermaid diagram going from left to right with modern look; the diagram contains blueish square node with text Hard pointing to round square node with text Round; over the arrow connecting the two nodes there is a word Text; the second node further connects to a rhombus-shaped node with text Decision which then connects to two further nodes, Result 1 and Result 2.\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.1-merimad-diagram.png\" class=\"jp-screenshot\">\n+<img alt=\"Rendered Mermaid diagram going from left to right with modern look; the diagram contains blueish square node with text Hard pointing to round square node with text Round; over the arrow connecting the two nodes there is a word Text; the second node further connects to a rhombus-shaped node with text Decision which then connects to two further nodes, Result 1 and Result 2.\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.1-merimad-diagram.png\" class=\"jp-screenshot\">\n \n ### Inline completer\n \n@@ -106,7 +106,7 @@ allowing generative AI models to provide multi-line completions.\n The suggestions are provided by plugins implementing the ``IInlineCompletionProvider`` API;\n by default a single provider which uses kernel history is available.\n \n-<img alt=\"In a code cell with `def fac` content a ghost text containing a suggestion representing further code of factorial function is shown; over the code cell there is a floating widget allowing to accept the suggestion and iterate between alternative suggestions\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.1-inline-completer.png\" class=\"jp-screenshot\">\n+<img alt=\"In a code cell with `def fac` content a ghost text containing a suggestion representing further code of factorial function is shown; over the code cell there is a floating widget allowing to accept the suggestion and iterate between alternative suggestions\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.1-inline-completer.png\" class=\"jp-screenshot\">\n \n The suggestions can be invoked as-you-type or manually using a configurable shortcut (by default <kbd>Alt</kbd> + <kbd>\\\\</kbd>).\n The default keyboard shortcuts are displayed in the small widget shown when hovering over the ghost suggestion:\n@@ -152,14 +152,14 @@ Paths to code files detected in tracebacks returned by kernels on execution erro\n These links will open the corresponding file for editing, if it is in the Jupyter root directory,\n or they will open a read-only preview if the file is outside of the root directory and the active kernel supports the debugger.\n \n-<img alt=\"A link to the file with definition of imported module is shown in the traceback\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.1-traceback-links.png\" class=\"jp-screenshot\">\n+<img alt=\"A link to the file with definition of imported module is shown in the traceback\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.1-traceback-links.png\" class=\"jp-screenshot\">\n \n ### Error indicator in the table of contents\n \n When a cell fails during execution, an error indicator will be displayed by the corresponding heading,\n increasing awareness of the notebook state and enabling users to quickly navigate to the cell which requires attention.\n \n-<img alt=\"Error indicator in the shape of a triangle with exclamation sign (using âš  UTF character) shown next to one of the headings in the table of contents panel\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.1-toc-error-indicator.png\" class=\"jp-screenshot\">\n+<img alt=\"Error indicator in the shape of a triangle with exclamation sign (using âš  UTF character) shown next to one of the headings in the table of contents panel\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.1-toc-error-indicator.png\" class=\"jp-screenshot\">\n \n ### Plugin Manager\n \n@@ -167,18 +167,18 @@ Individual plugins can now be disabled or enabled from a new Plugin Manager user\n Each extension is composed of one or more plugins, and plugins form the basis of JupyterLab itself,\n thus the plugin manager enables more extensive customization of the JupyterLab experience.\n \n-<img alt=\"An example search result in the plugin extension listing\" src=\"https://jupyterlab.readthedocs.io/en/latest/_images/plugin-manager-search-notebook.png\" class=\"jp-screenshot\">\n+<img alt=\"An example search result in the plugin extension listing\" src=\"https://jupyterlab.readthedocs.io/en/stable/_images/plugin-manager-search-notebook.png\" class=\"jp-screenshot\">\n \n-This feature is intended for advanced users and is documented in depth in the [documentation](https://jupyterlab.readthedocs.io/en/latest/user/extensions.html#managing-plugins-with-plugin-manager).\n+This feature is intended for advanced users and is documented in depth in the [documentation](https://jupyterlab.readthedocs.io/en/stable/user/extensions.html#managing-plugins-with-plugin-manager).\n \n-Administrators may want to [lock specific plugins](https://jupyterlab.readthedocs.io/en/latest/user/extensions.html#locking-and-unlocking-plugins) if they are required for any reason; this will prevent users from disabling the plugins via Plugin Manager and remote API calls. The Plugin Manager itself can be [disabled using the CLI](https://jupyterlab.readthedocs.io/en/latest/user/extensions.html#enabling-and-disabling-extensions).\n+Administrators may want to [lock specific plugins](https://jupyterlab.readthedocs.io/en/stable/user/extensions.html#locking-and-unlocking-plugins) if they are required for any reason; this will prevent users from disabling the plugins via Plugin Manager and remote API calls. The Plugin Manager itself can be [disabled using the CLI](https://jupyterlab.readthedocs.io/en/stable/user/extensions.html#enabling-and-disabling-extensions).\n \n ### Virtual scrollbar for notebook in windowed mode\n \n The windowed notebook received an optional scrollbar delineating the active cell and selected cells.\n Users can jump to a specific cell.\n \n-<img alt=\"Virtual scrollbar shown on the right side of notebook\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/main/docs/source/getting_started/changelog_assets/4.1-virtual-scrollbar.png\" class=\"jp-screenshot\">\n+<img alt=\"Virtual scrollbar shown on the right side of notebook\" src=\"https://raw.githubusercontent.com/jupyterlab/jupyterlab/4.2.x/docs/source/getting_started/changelog_assets/4.1-virtual-scrollbar.png\" class=\"jp-screenshot\">\n \n To enable the virtual scrollbar, go to Settings â†’ Notebook â†’ Windowing mode, choose \"full\", and click on the hamburger icon (â‰¡) which appears in the notebook's toolbar.\n \n@@ -240,7 +240,7 @@ Developers can now provide editor extensions, like themes and programming langua\n #### New extension manager\n \n Starting with JupyterLab 3, extensions can be installed via Python packages\n-(or other providers of [prebuilt extensions](https://jupyterlab.readthedocs.io/en/latest/extension/extension_dev.html#prebuilt-extensions)).\n+(or other providers of [prebuilt extensions](https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html#prebuilt-extensions)).\n \n In JupyterLab 4, building on this feature, the Extension Manager now includes extensions from [pypi.org](https://pypi.org/search/?c=Framework+%3A%3A+Jupyter+%3A%3A+JupyterLab).\n This removes the build step from installation of extension when using Extension Manager.\n@@ -314,7 +314,7 @@ Here are the main tool updates that will benefit extension authors and developer\n \n We recommend using Node.js v18 or newer, because older versions will reach end of life in 2023 or earlier (see [Node release schedule](https://github.com/nodejs/release#release-schedule)).\n \n-To ease code migration to JupyterLab 4, developers should review the [migration guide](https://jupyterlab.readthedocs.io/en/latest/extension/extension_migration.html). A few existing extensions have already been migrated and can be used as examples:\n+To ease code migration to JupyterLab 4, developers should review the [migration guide](https://jupyterlab.readthedocs.io/en/stable/extension/extension_migration.html). A few existing extensions have already been migrated and can be used as examples:\n - the [JupyterLab Extensions by Examples](https://github.com/jupyterlab/extension-examples/pull/232)\n - the [Jupyter MIME type renderers](https://github.com/jupyterlab/jupyter-renderers/pull/296)\n \n@@ -1780,9 +1780,9 @@ To ease code migration to JupyterLab 4, developers should review the [migration\n \n JupyterLab 4 is released! :tada:\n \n-Check out the new features, improvements and bug fixes: https://jupyterlab.readthedocs.io/en/latest/getting_started/changelog.html#v4-0\n+Check out the new features, improvements and bug fixes: https://jupyterlab.readthedocs.io/en/stable/getting_started/changelog.html#v4-0\n \n-For extension authors, there is a migration guide available to help you migrate your extensions to JupyterLab 4: https://jupyterlab.readthedocs.io/en/latest/extension/extension_migration.html#jupyterlab-3-x-to-4-x\n+For extension authors, there is a migration guide available to help you migrate your extensions to JupyterLab 4: https://jupyterlab.readthedocs.io/en/stable/extension/extension_migration.html#jupyterlab-3-x-to-4-x\n \n ______________________________________________________________________\n \n@@ -3685,7 +3685,7 @@ No merged PRs\n \n ### Enhancements made\n \n-- Add a menu entry to show/hide hidden files in the filebrowser [#11206](https://github.com/jupyterlab/jupyterlab/pull/11206) ([@loichuder](https://github.com/loichuder)) - activation instructions: [see documentation](https://jupyterlab.readthedocs.io/en/latest/user/files.html#displaying-hidden-files)\n+- Add a menu entry to show/hide hidden files in the filebrowser [#11206](https://github.com/jupyterlab/jupyterlab/pull/11206) ([@loichuder](https://github.com/loichuder)) - activation instructions: [see documentation](https://jupyterlab.readthedocs.io/en/stable/user/files.html#displaying-hidden-files)\n - Restore Copy shareable link use of `shareUrl` [#11188](https://github.com/jupyterlab/jupyterlab/pull/11188) ([@fcollonval](https://github.com/fcollonval))\n - Add Galata in JupyterLab [#11179](https://github.com/jupyterlab/jupyterlab/pull/11179) ([@fcollonval](https://github.com/fcollonval))\n - Responsive Toolbar [#11178](https://github.com/jupyterlab/jupyterlab/pull/11178) ([@3coins](https://github.com/3coins))\n@@ -4131,9 +4131,9 @@ No merged PRs\n - From JupyterLab 3.1, file documents and notebooks have collaborative\n   editing using the [Yjs shared editing framework](https://github.com/yjs/yjs).\n   Editors are not collaborative by default; to activate it, start JupyterLab\n-  with the `--collaborative` flag. See full documentation on [collaboration](https://jupyterlab.readthedocs.io/en/latest/user/rtc.html).\n+  with the `--collaborative` flag. See full documentation on [collaboration](https://jupyterlab.readthedocs.io/en/stable/user/rtc.html).\n - The undo/redo history in the notebook is now document-wide (tracking changes across all cells); the future verisions will enable restoring the previous behaviour of per-cell undo/redo.\n-- Table of Contents recieved multiple new features and settings described in the [user documentation](https://jupyterlab.readthedocs.io/en/latest/user/toc.html).\n+- Table of Contents recieved multiple new features and settings described in the [user documentation](https://jupyterlab.readthedocs.io/en/stable/user/toc.html).\n - The debugger recived many improvements, including basic support for evaluating code at a breakpoint, and for variable inspection.\n - The closing bracket is no longer automatically added by default; the old behaviour can be re-enabled from the menu bar (`Settings` -> `Auto Close Brackets`) or from the Advanced Settings Editor.\n - A new visual indicator was introduced to highlight cells in which the code changed in the editor since last execution:\n@@ -4754,21 +4754,21 @@ extensions does not require rebuilding JupyterLab and does not require\n having NodeJS installed. The previous way of distributing extensions as\n npm packages requiring rebuilding JupyterLab is still available as well.\n See the\n-[documentation](https://jupyterlab.readthedocs.io/en/latest/user/extensions.html#extensions)\n+[documentation](https://jupyterlab.readthedocs.io/en/stable/user/extensions.html#extensions)\n for more details.\n \n #### The JupyterLab interface supports multiple languages\n \n JupyterLab now provides the ability to set the display language of the\n user interface. See the\n-[documentation](https://jupyterlab.readthedocs.io/en/latest/user/language.html)\n+[documentation](https://jupyterlab.readthedocs.io/en/stable/user/language.html)\n for more details.\n \n #### A new visual debugger\n \n JupyterLab now ships with a debugger front-end by default, available for\n kernels that support the new debugging protocol. See the\n-[documentation](https://jupyterlab.readthedocs.io/en/latest/user/debugger.html)\n+[documentation](https://jupyterlab.readthedocs.io/en/stable/user/debugger.html)\n for more details.\n \n #### Improvements to Simple Interface mode and Mobile\n\ndiff --git a/CONTRIBUTING.md b/CONTRIBUTING.md\nindex 51ee26aabc0f..a389d39bd1ce 100644\n--- a/CONTRIBUTING.md\n+++ b/CONTRIBUTING.md\n@@ -4,5 +4,5 @@ If you're reading this section, you're probably interested in contributing to\n JupyterLab. Welcome and thanks for your interest in contributing!\n \n Please take a look at Contributing to Jupyterlab on\n-[Read the Docs](https://jupyterlab.readthedocs.io/en/latest/developer/contributing.html) or\n+[Read the Docs](https://jupyterlab.readthedocs.io/en/stable/developer/contributing.html) or\n [Repo docs](docs/source/developer/contributing.rst) (for the latest).\n\ndiff --git a/README.md b/README.md\nindex ffb3ab2b9e58..aed9e149877b 100644\n--- a/README.md\n+++ b/README.md\n@@ -34,7 +34,7 @@ via [PyPI](https://pypi.org/search/?q=jupyterlab&o=-created&c=Framework+%3A%3A+J\n conda, and other package managers. The _source_ extensions can be installed\n directly from npm (search for [jupyterlab-extension](https://www.npmjs.com/search?q=keywords:jupyterlab-extension)) but require an additional build step.\n You can also find JupyterLab extensions exploring GitHub topic [jupyterlab-extension](https://github.com/topics/jupyterlab-extension).\n-To learn more about extensions, see the [user documentation](https://jupyterlab.readthedocs.io/en/latest/user/extensions.html).\n+To learn more about extensions, see the [user documentation](https://jupyterlab.readthedocs.io/en/stable/user/extensions.html).\n \n Read the current JupyterLab documentation on [ReadTheDocs](http://jupyterlab.readthedocs.io/en/stable/).\n \n@@ -63,7 +63,7 @@ If you use [conda](https://docs.conda.io/en/latest/), [mamba](https://mamba.read\n   ```\n   If installing using `pip install --user`, you must add the user-level `bin` directory to your `PATH` environment variable in order to launch `jupyter lab`. If you are using a Unix derivative (e.g., FreeBSD, GNU/Linux, macOS), you can do this by running `export PATH=\"$HOME/.local/bin:$PATH\"`. If you are using a macOS version that comes with Python 2, run `pip3` instead of `pip`.\n \n-For more detailed instructions, consult the [installation guide](http://jupyterlab.readthedocs.io/en/latest/getting_started/installation.html). Project installation instructions from the git sources are available in the [contributor documentation](CONTRIBUTING.md).\n+For more detailed instructions, consult the [installation guide](http://jupyterlab.readthedocs.io/en/stable/getting_started/installation.html). Project installation instructions from the git sources are available in the [contributor documentation](CONTRIBUTING.md).\n \n #### Installing with Previous Versions of Jupyter Notebook\n \n@@ -81,7 +81,7 @@ Start up JupyterLab using:\n jupyter lab\n ```\n \n-JupyterLab will open automatically in the browser. See the [documentation](http://jupyterlab.readthedocs.io/en/latest/getting_started/starting.html) for additional details.\n+JupyterLab will open automatically in the browser. See the [documentation](http://jupyterlab.readthedocs.io/en/stable/getting_started/starting.html) for additional details.\n \n If you encounter an error like \"Command 'jupyter' not found\", please make sure `PATH` environment variable is set correctly. Alternatively, you can start up JupyterLab using `~/.local/bin/jupyter lab` without changing the `PATH` environment variable.\n \n@@ -93,7 +93,7 @@ The latest versions of the following browsers are currently _known to work_:\n - Chrome\n - Safari\n \n-See our [documentation](http://jupyterlab.readthedocs.io/en/latest/getting_started/installation.html) for additional details.\n+See our [documentation](http://jupyterlab.readthedocs.io/en/stable/getting_started/installation.html) for additional details.\n \n ---\n \n@@ -103,7 +103,7 @@ We encourage you to ask questions on the [Discourse forum](https://discourse.jup\n \n ### Bug report\n \n-To report a bug please read the [guidelines](https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html) and then open a [Github issue](https://github.com/jupyterlab/jupyterlab/issues/new?labels=bug%2C+status%3ANeeds+Triage&template=bug_report.md). To keep resolved issues self-contained, the [lock bot](https://github.com/apps/lock) will lock closed issues as resolved after a period of inactivity. If a related discussion is still needed after an issue is locked, please open a new issue and reference the old issue.\n+To report a bug please read the [guidelines](https://jupyterlab.readthedocs.io/en/stable/getting_started/issue.html) and then open a [Github issue](https://github.com/jupyterlab/jupyterlab/issues/new?labels=bug%2C+status%3ANeeds+Triage&template=bug_report.md). To keep resolved issues self-contained, the [lock bot](https://github.com/apps/lock) will lock closed issues as resolved after a period of inactivity. If a related discussion is still needed after an issue is locked, please open a new issue and reference the old issue.\n \n ### Feature request\n \n@@ -115,18 +115,18 @@ We also welcome suggestions for new features as they help make the project more\n \n ### Extending JupyterLab\n \n-To start developing an extension for JupyterLab, see the [developer documentation](https://jupyterlab.readthedocs.io/en/latest/extension/extension_dev.html) and the [API docs](https://jupyterlab.readthedocs.io/en/latest/api/).\n+To start developing an extension for JupyterLab, see the [developer documentation](https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html) and the [API docs](https://jupyterlab.readthedocs.io/en/stable/api/).\n \n ### Contributing\n \n-To contribute code or documentation to JupyterLab itself, please read the [contributor documentation](https://jupyterlab.readthedocs.io/en/latest/developer/contributing.html).\n+To contribute code or documentation to JupyterLab itself, please read the [contributor documentation](https://jupyterlab.readthedocs.io/en/stable/developer/contributing.html).\n \n JupyterLab follows the Jupyter [Community Guides](https://jupyter.readthedocs.io/en/latest/community/content-community.html).\n \n ### License\n \n JupyterLab uses a shared copyright model that enables all contributors to maintain the\n-copyright on their contributions. All code is licensed under the terms of the revised [BSD license](https://github.com/jupyterlab/jupyterlab/blob/main/LICENSE).\n+copyright on their contributions. All code is licensed under the terms of the revised [BSD license](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/LICENSE).\n \n ### Team\n \n\ndiff --git a/RELEASE.md b/RELEASE.md\nindex ac525b9a81ee..77506b0ca253 100644\n--- a/RELEASE.md\n+++ b/RELEASE.md\n@@ -262,9 +262,9 @@ These lines:\n   - [ ] https://github.com/jupyterlab/jupyter-renderers\n - [ ] Publish a release (with a **updated tag**) to the [extension template](https://github.com/jupyterlab/extension-template/releases) with the new JupyterLab version\n - [ ] Update the extension examples:\n-  - [ ] [Notebook toolbar button](https://github.com/jupyterlab/jupyterlab/blob/main/docs/source/extension/notebook.rst#adding-a-button-to-the-toolbar)\n-  - [ ] [Notebook widget](https://github.com/jupyterlab/jupyterlab/blob/main/docs/source/extension/notebook.rst#adding-a-widget-to-the-notebook-header)\n-- [ ] Update the [extension tutorial](https://github.com/jupyterlab/jupyterlab/blob/main/RELEASE.md#updating-the-extension-tutorial)\n+  - [ ] [Notebook toolbar button](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/docs/source/extension/notebook.rst#adding-a-button-to-the-toolbar)\n+  - [ ] [Notebook widget](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/docs/source/extension/notebook.rst#adding-a-widget-to-the-notebook-header)\n+- [ ] Update the [extension tutorial](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/RELEASE.md#updating-the-extension-tutorial)\n - [ ] At this point, there may have been some more commits merged. Run `python scripts/milestone_check.py` to check the issues assigned to this milestone one more time. Update changelog if necessary.\n \n Now do the actual final release:\n@@ -276,7 +276,7 @@ Now do the actual final release:\n - [ ] Update the API [docs](#updating-api-docs)\n - [ ] Merge the PRs on the other repos and set the default branch of the\n       xckd repo\n-- [ ] Publish to [conda-forge](https://github.com/jupyterlab/jupyterlab/blob/main/RELEASE.md#publishing-to-conda-forge).\n+- [ ] Publish to [conda-forge](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/RELEASE.md#publishing-to-conda-forge).\n \n After a few days (to allow for possible patch releases), set up development for\n the next release:\n@@ -285,7 +285,7 @@ the next release:\n - [ ] Put the commit and tags to main\n - [ ] Run `npm run publish:all` to publish the packages\n - [ ] Release the other repos as appropriate\n-- [ ] Update version for [binder](https://github.com/jupyterlab/jupyterlab/blob/main/RELEASE.md#update-version-for-binder)\n+- [ ] Update version for [binder](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/RELEASE.md#update-version-for-binder)\n \n ### Updating the extension tutorial\n \n\ndiff --git a/buildutils/src/ensure-repo.ts b/buildutils/src/ensure-repo.ts\nindex 0c31ea5078ad..cf96b7c003a9 100644\n--- a/buildutils/src/ensure-repo.ts\n+++ b/buildutils/src/ensure-repo.ts\n@@ -36,8 +36,8 @@ type CoreData = Map<string, any>;\n // All other release branches should target a specific named version\n const URL_CONFIG = {\n   source: 'main',\n-  target: 'main',\n-  rtdVersion: 'latest'\n+  target: '4.2.x',\n+  rtdVersion: 'stable'\n };\n \n // Data to ignore.\n\ndiff --git a/docs/source/conf.py b/docs/source/conf.py\nindex 4cf9a2419df6..23cff1246db8 100644\n--- a/docs/source/conf.py\n+++ b/docs/source/conf.py\n@@ -308,7 +308,7 @@ def document_plugins_tokens_list(list_path: Path, output_path: Path) -> None:\n html_context = {\n     \"github_user\": \"jupyterlab\",  # Username\n     \"github_repo\": \"jupyterlab\",  # Repo name\n-    \"github_version\": \"main\",  # Version\n+    \"github_version\": \"4.2.x\",  # Version\n     \"doc_path\": \"docs/source/\",  # Path in the checkout to the docs root\n }\n \n\ndiff --git a/docs/source/developer/accessibility.rst b/docs/source/developer/accessibility.rst\nindex 4cd53dc3cd0b..a25aaa5b9b12 100644\n--- a/docs/source/developer/accessibility.rst\n+++ b/docs/source/developer/accessibility.rst\n@@ -86,7 +86,7 @@ be tempting to pick a color and apply it to the part of the UI that you are\n working on. However, it quickly becomes unmanageable to have color values spread\n throughout the app across different CSS files. Therefore, the JupyterLab\n codebase defines a set of `color variables\n-<https://github.com/jupyterlab/jupyterlab/blob/main/packages/theme-light-extension/style/variables.css>`__\n+<https://github.com/jupyterlab/jupyterlab/blob/4.2.x/packages/theme-light-extension/style/variables.css>`__\n that can be used for borders, icons, and such. If you're adding any CSS that\n needs a color value, please use one of the variables defined.\n \n\ndiff --git a/docs/source/developer/components.rst b/docs/source/developer/components.rst\nindex 6e5bcb3b1143..eac293a3d4e1 100644\n--- a/docs/source/developer/components.rst\n+++ b/docs/source/developer/components.rst\n@@ -11,7 +11,7 @@ IDE-like experience. However, developers are encouraged to use these to bring\n to life their own visions of what a computational environment should look\n like.\n \n-The JupyterLab repository has `many examples <https://github.com/jupyterlab/jupyterlab/tree/main/examples>`_\n+The JupyterLab repository has `many examples <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/examples>`_\n to get you started.\n \n The ``examples`` directory contains:\n\ndiff --git a/docs/source/developer/contributing.rst b/docs/source/developer/contributing.rst\nindex c33ffbebe307..c99b121784d9 100644\n--- a/docs/source/developer/contributing.rst\n+++ b/docs/source/developer/contributing.rst\n@@ -322,7 +322,7 @@ Installing Node.js and jlpm\n Building JupyterLab from its GitHub source code requires Node.js. The\n development version requires Node.js version 20+, as defined in the\n ``engines`` specification in\n-`dev_mode/package.json <https://github.com/jupyterlab/jupyterlab/blob/main/dev_mode/package.json>`__.\n+`dev_mode/package.json <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/dev_mode/package.json>`__.\n \n If you use `conda <https://conda.io>`__, you can get it with:\n \n@@ -677,7 +677,7 @@ Visual Regression and UI Tests\n ------------------------------\n \n As part of JupyterLab CI workflows, UI tests are run with visual regression checks.\n-`Galata <https://github.com/jupyterlab/jupyterlab/tree/main/galata>`__ is used for UI\n+`Galata <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/galata>`__ is used for UI\n testing. Galata provides `Playwright <https://playwright.dev>`__ helpers to control and\n inspect JupyterLab UI programmatically.\n \n@@ -719,7 +719,7 @@ Main reasons for UI test failures are:\n     The bot will react with +1 emoji to indicate that the run started and then comment\n     back once it concluded.\n \n-For more information on UI Testing, please read the `UI Testing developer documentation <https://github.com/jupyterlab/jupyterlab/blob/main/galata/README.md>`__\n+For more information on UI Testing, please read the `UI Testing developer documentation <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/galata/README.md>`__\n and `Playwright documentation <https://playwright.dev/docs/intro>`__.\n \n Good Practices for Integration tests\n\ndiff --git a/docs/source/developer/css.rst b/docs/source/developer/css.rst\nindex 0f654c056f02..67b8412b3711 100644\n--- a/docs/source/developer/css.rst\n+++ b/docs/source/developer/css.rst\n@@ -73,7 +73,7 @@ CSS variable usage\n ^^^^^^^^^^^^^^^^^^\n \n JupyterLab includes a default set of CSS variables in the file\n-`packages/theme-light-extension/style/variables.css <https://github.com/jupyterlab/jupyterlab/blob/main/packages/theme-light-extension/style/variables.css>`_.\n+`packages/theme-light-extension/style/variables.css <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/packages/theme-light-extension/style/variables.css>`_.\n \n To ensure consistent design in JupyterLab, all built-in and third party\n extensions should use these variables in their styles if at all\n\ndiff --git a/docs/source/developer/repo.rst b/docs/source/developer/repo.rst\nindex d788de5c606b..c6f76039fcbb 100644\n--- a/docs/source/developer/repo.rst\n+++ b/docs/source/developer/repo.rst\n@@ -13,7 +13,7 @@ In particular, there are many TypeScript packages and a single Python package.\n The Python package contains server-side code, and also distributes\n the bundled-and-compiled TypeScript code.\n \n-See the `Contributing Guidelines <https://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md>`__\n+See the `Contributing Guidelines <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/CONTRIBUTING.md>`__\n for detailed developer installation instructions.\n \n Directories\n\ndiff --git a/docs/source/extension/extension_dev.rst b/docs/source/extension/extension_dev.rst\nindex f250286cfb4d..082926349890 100644\n--- a/docs/source/extension/extension_dev.rst\n+++ b/docs/source/extension/extension_dev.rst\n@@ -191,7 +191,7 @@ A mime renderer plugin is an object with the fields listed in the\n `rendermime-interfaces IExtension <../api/interfaces/rendermime_interfaces.IRenderMime.IExtension.html>`__\n object.\n \n-JupyterLab has a `pdf mime renderer extension <https://github.com/jupyterlab/jupyterlab/tree/main/packages/pdf-extension>`__, for example. In core JupyterLab, this is used to view pdf files and view pdf data mime data in a notebook.\n+JupyterLab has a `pdf mime renderer extension <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/packages/pdf-extension>`__, for example. In core JupyterLab, this is used to view pdf files and view pdf data mime data in a notebook.\n \n We have a `MIME renderer example <https://github.com/jupyterlab/extension-examples/tree/master/mimerenderer>`__  walking through creating a mime renderer extension which adds mp4 video rendering to JupyterLab. The `extension template <https://github.com/jupyterlab/extension-template>`_ supports MIME renderer extensions.\n \n@@ -210,7 +210,7 @@ A theme is a special application plugin that registers a theme with the ``ThemeM\n \n The extension package containing the theme plugin must include all static assets that are referenced by ``@import`` in its theme CSS files. Local URLs can be used to reference files relative to the location of the referring sibling CSS files. For example ``url('images/foo.png')`` or ``url('../foo/bar.css')`` can be used to refer local files in the theme. Absolute URLs (starting with a ``/``) or external URLs (e.g. ``https:``) can be used to refer to external assets.\n \n-See the `JupyterLab Light Theme <https://github.com/jupyterlab/jupyterlab/tree/main/packages/theme-light-extension>`__ for an example.\n+See the `JupyterLab Light Theme <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/packages/theme-light-extension>`__ for an example.\n \n See the `TypeScript extension template <https://github.com/jupyterlab/extension-template>`__ (choosing ``theme`` as ``kind`` ) for a quick start to developing a theme plugin.\n \n@@ -221,7 +221,7 @@ Source Extensions\n \n A source extension is a JavaScript (npm) package that exports one or more plugins. All JupyterLab extensions are developed as source extensions (for example, prebuilt extensions are built from source extensions).\n \n-A source extension has metadata in the ``jupyterlab`` field of its ``package.json`` file. The `JSON schema <https://github.com/jupyterlab/jupyterlab/blob/main/builder/metadata_schema.json>`__ for the metadata is distributed in the ``@jupyterlab/builder`` package.\n+A source extension has metadata in the ``jupyterlab`` field of its ``package.json`` file. The `JSON schema <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/builder/metadata_schema.json>`__ for the metadata is distributed in the ``@jupyterlab/builder`` package.\n \n We will talk about each ``jupyterlab`` metadata field in ``package.json`` for source extensions below.\n \n@@ -286,10 +286,10 @@ For example, the JupyterLab ``filebrowser-extension`` package exports the ``@jup\n           \"schemaDir\": \"schema\",\n         }\n \n-The file browser setting schema file (which specifies some default keyboard shortcuts and other settings for the filebrowser) is located in ``schema/browser.json`` (see `here <https://github.com/jupyterlab/jupyterlab/blob/main/packages/filebrowser-extension/schema/browser.json>`__).\n+The file browser setting schema file (which specifies some default keyboard shortcuts and other settings for the filebrowser) is located in ``schema/browser.json`` (see `here <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/packages/filebrowser-extension/schema/browser.json>`__).\n \n See the\n-`fileeditor-extension <https://github.com/jupyterlab/jupyterlab/tree/main/packages/fileeditor-extension>`__\n+`fileeditor-extension <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/packages/fileeditor-extension>`__\n for another example of an extension that uses settings.\n \n Please ensure that the schema files are included in the ``files`` metadata in ``package.json``.\n@@ -534,7 +534,7 @@ Custom webpack configuration can be used to enable webpack features, configure a\n       }\n     };\n \n-This custom config will be merged with the `prebuilt extension config <https://github.com/jupyterlab/jupyterlab/blob/main/builder/src/extensionConfig.ts>`_\n+This custom config will be merged with the `prebuilt extension config <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/builder/src/extensionConfig.ts>`_\n when building the prebuilt extension.\n \n .. _prebuilt_dev_workflow:\n\ndiff --git a/docs/source/extension/extension_migration.rst b/docs/source/extension/extension_migration.rst\nindex 695ff5c1ce78..ff47baffddbf 100644\n--- a/docs/source/extension/extension_migration.rst\n+++ b/docs/source/extension/extension_migration.rst\n@@ -405,7 +405,7 @@ bumped their major version (following semver convention). We want to point out p\n      ``token.findByFileName(widget.context.path)?.name ?? ''``.\n - ``@jupyterlab/docprovider`` from 3.x to 4.x\n    This package is no longer present in JupyterLab. For documentation related to Real-Time Collaboration, please check out\n-   `RTC's documentation <https://jupyterlab.readthedocs.io/en/latest/user/rtc.html>`_\n+   `RTC's documentation <https://jupyterlab.readthedocs.io/en/stable/user/rtc.html>`_\n - ``@jupyterlab/docregistry`` from 3.x to 4.x\n    * Removed the property ``docProviderFactory`` from the interface ``Context.IOptions``.\n    * The constructor of the class ``DocumentModel`` receives a parameter ``DocumentModel.IOptions``.\n@@ -886,7 +886,7 @@ Upgrading library versions\n The ``@phosphor/*`` libraries that JupyterLab 1.x uses have been renamed to\n ``@lumino/*``. Updating your ``package.json`` is straightforward. The easiest\n way to do this is to look in the\n-`JupyterLab core packages code base <https://github.com/jupyterlab/jupyterlab/tree/main/packages>`__\n+`JupyterLab core packages code base <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/packages>`__\n and to simply adopt the versions of the relevant libraries that are used\n there.\n \n@@ -1007,7 +1007,7 @@ Using ``Session`` and ``SessionContext`` to manage kernel sessions\n \n   For full API documentation and examples of how to use\n   ``@jupyterlab/services``,\n-  `consult the repository <https://github.com/jupyterlab/jupyterlab/tree/main/packages/services#readme>`__.\n+  `consult the repository <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/packages/services#readme>`__.\n \n ``ConsolePanel`` and ``NotebookPanel`` now expose a\n ``sessionContext: ISessionContext`` attribute that allows for a uniform way to\n@@ -1042,4 +1042,4 @@ Using the new icon system and ``LabIcon``\n \n   For full API documentation and examples of how to use\n   the new icon support based on ``LabIcon`` from ``@jupyterlab/ui-components``,\n-  `consult the repository <https://github.com/jupyterlab/jupyterlab/tree/main/packages/ui-components#readme>`__.\n+  `consult the repository <https://github.com/jupyterlab/jupyterlab/tree/4.2.x/packages/ui-components#readme>`__.\n\ndiff --git a/docs/source/extension/extension_multiple_ui.rst b/docs/source/extension/extension_multiple_ui.rst\nindex b5e91e379891..e638247cf223 100644\n--- a/docs/source/extension/extension_multiple_ui.rst\n+++ b/docs/source/extension/extension_multiple_ui.rst\n@@ -17,23 +17,23 @@ This guide will give you an overview of compatibility features, then a\n tutorial and reference code covering some of the topics mentioned here.\n If you don't know how to make extensions, you can read more about the\n basics at :ref:`the Extension Tutorial <extension_tutorial>` or the\n-`Extensions page <https://jupyterlab.readthedocs.io/en/latest/extension/extension_dev.html>`_.\n+`Extensions page <https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html>`_.\n \n Getting started\n ---------------\n \n At a high level, extensions for JupyterLab and Jupyter Notebook both\n typically start from a template project, which you can download and set up\n-using instructions from `the extension tutorial <https://jupyterlab.readthedocs.io/en/latest/extension/extension_tutorial.html>`_).\n+using instructions from `the extension tutorial <https://jupyterlab.readthedocs.io/en/stable/extension/extension_tutorial.html>`_).\n Once your template is ready, you can start adding components and features to build your extension.\n \n How Compatibility Works\n -----------------------\n \n-An extension for JupyterLab (and for Notebook 7) is made up of a `series <https://jupyterlab.readthedocs.io/en/latest/extension/extension_dev.html>`_\n+An extension for JupyterLab (and for Notebook 7) is made up of a `series <https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html>`_\n of bundled `plugins <https://lumino.readthedocs.io/en/latest/api/interfaces/application.IPlugin.html#requires>`_,\n and those plugins typically use components from the interface toolkit `Lumino <https://lumino.readthedocs.io/en/latest/api/index.html>`_\n-as well as the `JupyterLab API <https://jupyterlab.readthedocs.io/en/latest/api/index.html>`_\n+as well as the `JupyterLab API <https://jupyterlab.readthedocs.io/en/stable/api/index.html>`_\n (among others) to help build your extension's look and behavior. Both\n Lumino and JupyterLab API are written in Typescript.\n \n@@ -122,7 +122,7 @@ use them to make checks in your extensions that will allow them to function in\n both JupyterLab and Jupyter Notebook 7 (and others).\n \n JupyterLab itself is a :ref:`provider <dependency-injection-basic-info>` of many features through its built-in plugins,\n-which you can read more about in the `Common Extension Points document <https://jupyterlab.readthedocs.io/en/latest/extension/extension_points.html>`_.\n+which you can read more about in the `Common Extension Points document <https://jupyterlab.readthedocs.io/en/stable/extension/extension_points.html>`_.\n It's a good idea to use these extension points while you're building your extensions (and\n by doing so you are acting as the *consumer* in JupyterLab's :ref:`Provider-Consumer pattern <dependency-injection-basic-info>`.\n \n\ndiff --git a/docs/source/extension/extension_tutorial.rst b/docs/source/extension/extension_tutorial.rst\nindex 4066299297dc..d094fddd572b 100644\n--- a/docs/source/extension/extension_tutorial.rst\n+++ b/docs/source/extension/extension_tutorial.rst\n@@ -232,7 +232,7 @@ After you reload the page with the console open, you should see a message that s\n ``JupyterLab extension jupyterlab_apod is activated!`` in the console.\n If you do, congratulations, you're ready to start modifying the extension!\n If not, go back make sure you didn't miss a step, and `reach\n-out <https://github.com/jupyterlab/jupyterlab/blob/main/README.md#getting-help>`__ if you're stuck.\n+out <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/README.md#getting-help>`__ if you're stuck.\n \n .. note::\n \n\ndiff --git a/docs/source/extension/internationalization.rst b/docs/source/extension/internationalization.rst\nindex 6a66e226eb2b..cc77756b183e 100644\n--- a/docs/source/extension/internationalization.rst\n+++ b/docs/source/extension/internationalization.rst\n@@ -34,7 +34,7 @@ To internationalize your extension, the following tasks are required:\n \n     Domain are normalized by replacing ``-`` with ``_`` characters.\n \n-3. Wraps all translatable strings with one of the `gettext functions <https://jupyterlab.readthedocs.io/en/latest/api/modules/translation.html#translationbundle>`_.\n+3. Wraps all translatable strings with one of the `gettext functions <https://jupyterlab.readthedocs.io/en/stable/api/modules/translation.html#translationbundle>`_.\n \n Examples:\n \n\ndiff --git a/docs/source/getting_started/faq.rst b/docs/source/getting_started/faq.rst\nindex 3b3416c4c1f8..39c1784f8f59 100644\n--- a/docs/source/getting_started/faq.rst\n+++ b/docs/source/getting_started/faq.rst\n@@ -54,7 +54,7 @@ Development\n \n \n -  `How can you\n-   contribute? <https://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md>`__\n+   contribute? <https://github.com/jupyterlab/jupyterlab/blob/4.2.x/CONTRIBUTING.md>`__\n -  :ref:`How can you extend or customize JupyterLab? <user_extensions>`\n -  In the classic Notebook, I could use custom Javascript outputted by a cell to programmatically\n    control the Notebook. Can I do the same thing in JupyterLab?\n\ndiff --git a/docs/source/getting_started/overview.rst b/docs/source/getting_started/overview.rst\nindex 8090f3bd5581..77efe735d8bd 100644\n--- a/docs/source/getting_started/overview.rst\n+++ b/docs/source/getting_started/overview.rst\n@@ -6,7 +6,7 @@\n Get Started\n ===========\n \n-`JupyterLab <https://jupyterlab.readthedocs.io/en/latest/>`_ is a next-generation web-based user interface for\n+`JupyterLab <https://jupyterlab.readthedocs.io/en/stable/>`_ is a next-generation web-based user interface for\n `Project Jupyter <https://docs.jupyter.org/en/latest/>`_.\n \n .. image:: ../images/interface-jupyterlab.png\n\ndiff --git a/docs/source/user/index.md b/docs/source/user/index.md\nindex f0b5a373fb82..edb0699d661a 100644\n--- a/docs/source/user/index.md\n+++ b/docs/source/user/index.md\n@@ -1,6 +1,6 @@\n # User Guide\n \n-Use this page to navigate to in-depth guides, tutorials, and how-tos for using [JupyterLab](https://jupyterlab.readthedocs.io/en/latest/).\n+Use this page to navigate to in-depth guides, tutorials, and how-tos for using [JupyterLab](https://jupyterlab.readthedocs.io/en/stable/).\n \n ```{toctree}\n :maxdepth: 2\n\ndiff --git a/galata/README.md b/galata/README.md\nindex 337238061822..985a8e37549f 100644\n--- a/galata/README.md\n+++ b/galata/README.md\n@@ -76,7 +76,7 @@ Then start the server with:\n jupyter lab --config jupyter_server_test_config.py\n ```\n \n-> If you need to customize the set up for galata, you can look at the [`configure_jupyter_server`](https://github.com/jupyterlab/jupyterlab/tree/main/jupyterlab/galata/__init__.py) definition.\n+> If you need to customize the set up for galata, you can look at the [`configure_jupyter_server`](https://github.com/jupyterlab/jupyterlab/tree/4.2.x/jupyterlab/galata/__init__.py) definition.\n \n ### Run test project\n \n\ndiff --git a/packages/apputils-extension/src/announcements.ts b/packages/apputils-extension/src/announcements.ts\nindex 64417d72f1ec..2a02a89ba930 100644\n--- a/packages/apputils-extension/src/announcements.ts\n+++ b/packages/apputils-extension/src/announcements.ts\n@@ -17,7 +17,7 @@ const COMMAND_HELP_OPEN = 'help:open';\n const NEWS_API_URL = '/lab/api/news';\n const UPDATE_API_URL = '/lab/api/update';\n const PRIVACY_URL =\n-  'https://jupyterlab.readthedocs.io/en/latest/privacy_policies.html';\n+  'https://jupyterlab.readthedocs.io/en/stable/privacy_policies.html';\n \n /**\n  * Call the announcement API\n\ndiff --git a/packages/extensionmanager/src/widget.tsx b/packages/extensionmanager/src/widget.tsx\nindex 78335c44ef2e..ba2d33678ce9 100644\n--- a/packages/extensionmanager/src/widget.tsx\n+++ b/packages/extensionmanager/src/widget.tsx\n@@ -100,7 +100,7 @@ function ListEntry(props: ListEntry.IProperties): React.ReactElement<any> {\n               )}\n               onClick={() =>\n                 window.open(\n-                  'https://jupyterlab.readthedocs.io/en/latest/user/extensions.html'\n+                  'https://jupyterlab.readthedocs.io/en/stable/user/extensions.html'\n                 )\n               }\n             />\n@@ -415,7 +415,7 @@ to work, this panel needs to fetch data from web services. Do you agree to\n activate this feature?`)}\n           <br />\n           <a\n-            href=\"https://jupyterlab.readthedocs.io/en/latest/privacy_policies.html\"\n+            href=\"https://jupyterlab.readthedocs.io/en/stable/privacy_policies.html\"\n             target=\"_blank\"\n             rel=\"noreferrer\"\n           >\n\ndiff --git a/packages/help-extension/src/index.tsx b/packages/help-extension/src/index.tsx\nindex 37a740139d25..8d001e1b8c9f 100644\n--- a/packages/help-extension/src/index.tsx\n+++ b/packages/help-extension/src/index.tsx\n@@ -298,11 +298,11 @@ const resources: JupyterFrontEndPlugin<void> = {\n     const resources = [\n       {\n         text: trans.__('JupyterLab Reference'),\n-        url: 'https://jupyterlab.readthedocs.io/en/latest/'\n+        url: 'https://jupyterlab.readthedocs.io/en/stable/'\n       },\n       {\n         text: trans.__('JupyterLab FAQ'),\n-        url: 'https://jupyterlab.readthedocs.io/en/latest/getting_started/faq.html'\n+        url: 'https://jupyterlab.readthedocs.io/en/stable/getting_started/faq.html'\n       },\n       {\n         text: trans.__('Jupyter Reference'),\n\ndiff --git a/packages/javascript-extension/README.md b/packages/javascript-extension/README.md\nindex 0fb96b16f472..8c20ab608ae7 100644\n--- a/packages/javascript-extension/README.md\n+++ b/packages/javascript-extension/README.md\n@@ -14,4 +14,4 @@ Javascript('alert(\"hello world\");')\n \n ## Development\n \n-See the [JupyterLab Contributor Documentation](https://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md).\n+See the [JupyterLab Contributor Documentation](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/CONTRIBUTING.md).\n\ndiff --git a/packages/json-extension/README.md b/packages/json-extension/README.md\nindex 79926552fe21..0b2aaafa4341 100644\n--- a/packages/json-extension/README.md\n+++ b/packages/json-extension/README.md\n@@ -38,4 +38,4 @@ To render a `.json` file, simply open it:\n \n ## Development\n \n-See the [JupyterLab Contributor Documentation](https://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md).\n+See the [JupyterLab Contributor Documentation](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/CONTRIBUTING.md).\n\ndiff --git a/packages/services/README.md b/packages/services/README.md\nindex 00aef59db540..d2be8dbd7654 100644\n--- a/packages/services/README.md\n+++ b/packages/services/README.md\n@@ -2,7 +2,7 @@\n \n Javascript client for the Jupyter services REST APIs\n \n-[API Docs](https://jupyterlab.readthedocs.io/en/latest/api/)\n+[API Docs](https://jupyterlab.readthedocs.io/en/stable/api/)\n \n [REST API Docs](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml)\n \n\ndiff --git a/packages/ui-components/docs/source/intro.rst b/packages/ui-components/docs/source/intro.rst\nindex 389d5bc76969..5ec5aee30e10 100644\n--- a/packages/ui-components/docs/source/intro.rst\n+++ b/packages/ui-components/docs/source/intro.rst\n@@ -1,7 +1,7 @@\n .. Copyright (c) Jupyter Development Team.\n .. Distributed under the terms of the Modified BSD License.\n \n-The `@jupyterlab/ui-components <https://jupyterlab.readthedocs.io/en/latest/api/modules/ui_components.html>`__\n+The `@jupyterlab/ui-components <https://jupyterlab.readthedocs.io/en/stable/api/modules/ui_components.html>`__\n package provides UI elements that are widely used in JupyterLab core,\n and that can be reused in your own extensions.\n \n\ndiff --git a/packages/ui-components/docs/source/labicon.rst b/packages/ui-components/docs/source/labicon.rst\nindex 480c83e61b08..7d1a81b3295b 100644\n--- a/packages/ui-components/docs/source/labicon.rst\n+++ b/packages/ui-components/docs/source/labicon.rst\n@@ -150,7 +150,7 @@ Available icon classes\n \n .. raw:: html\n \n-   <em>Icon-related CSS classes are defined in <a href=\"https://github.com/jupyterlab/jupyterlab/blob/main/packages/ui-components/style/icons.css\">ui-components/style/icons.css</a></em>\n+   <em>Icon-related CSS classes are defined in <a href=\"https://github.com/jupyterlab/jupyterlab/blob/4.2.x/packages/ui-components/style/icons.css\">ui-components/style/icons.css</a></em>\n \n |\n | All colors shown are for the standard light/dark theme, mouse over for hex values.\n\ndiff --git a/packages/vega5-extension/README.md b/packages/vega5-extension/README.md\nindex 92e33957d3a6..02ce93769884 100644\n--- a/packages/vega5-extension/README.md\n+++ b/packages/vega5-extension/README.md\n@@ -100,4 +100,4 @@ To render a `.vl`, `.vg`, `vl.json` or `.vg.json` file, simply open it:\n \n ## Development\n \n-See the [JupyterLab Contributor Documentation](https://github.com/jupyterlab/jupyterlab/blob/main/CONTRIBUTING.md).\n+See the [JupyterLab Contributor Documentation](https://github.com/jupyterlab/jupyterlab/blob/4.2.x/CONTRIBUTING.md).\n",
    "test_patch": "diff --git a/.github/workflows/docker-test.yml b/.github/workflows/docker-test.yml\nindex ab7d169f6b3a..92a947e75de4 100644\n--- a/.github/workflows/docker-test.yml\n+++ b/.github/workflows/docker-test.yml\n@@ -4,9 +4,9 @@ on:\n   schedule:\n     - cron: '0 0 * * *'\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n-    branches: [main]\n+    branches: [4.2.x]\n \n jobs:\n   docker:\n\ndiff --git a/.github/workflows/linuxjs-tests.yml b/.github/workflows/linuxjs-tests.yml\nindex 1bbdb367fc6d..6219a2655206 100644\n--- a/.github/workflows/linuxjs-tests.yml\n+++ b/.github/workflows/linuxjs-tests.yml\n@@ -2,9 +2,9 @@ name: Linux JS Tests\n \n on:\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n-    branches: [main]\n+    branches: [4.2.x]\n   release:\n     types: [published]\n \n\ndiff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex 10e68c560c30..0cb85e3eed41 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -2,9 +2,9 @@ name: Linux Tests\n \n on:\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n-    branches: [main]\n+    branches: [4.2.x]\n   release:\n     types: [published]\n \n\ndiff --git a/.github/workflows/macostests.yml b/.github/workflows/macostests.yml\nindex faedefaace9a..136fcf796c29 100644\n--- a/.github/workflows/macostests.yml\n+++ b/.github/workflows/macostests.yml\n@@ -2,9 +2,9 @@ name: macOS Tests\n \n on:\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n-    branches: [main]\n+    branches: [4.2.x]\n   release:\n     types: [published]\n \n\ndiff --git a/.github/workflows/windowstests.yml b/.github/workflows/windowstests.yml\nindex e9142e7fa527..943de2e7c646 100644\n--- a/.github/workflows/windowstests.yml\n+++ b/.github/workflows/windowstests.yml\n@@ -2,9 +2,9 @@ name: Windows Tests\n \n on:\n   push:\n-    branches: [main]\n+    branches: [4.2.x]\n   pull_request:\n-    branches: [main]\n+    branches: [4.2.x]\n   release:\n     types: [published]\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16314",
    "pr_id": 16314,
    "issue_id": 16311,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Error during build steps on macos\n## Description\r\n\r\nCannot build vanilla clone of the Lab repo using the [\"setting up a local development environment\"](https://jupyterlab.readthedocs.io/en/stable/developer/contributing.html#setting-up-a-local-development-environment) and [\"installing jupyterlab\"](https://jupyterlab.readthedocs.io/en/stable/developer/contributing.html#installing-jupyterlab) section steps on macos/Python 3.12.\r\n\r\nThis may be related to the Canvas package build (a dependency), possibly involving node-gyp and/or possibly due to distutils usage during a build substep (which was deprecated and removed in Python 3.12...). @krassowski suggested that upgrading the dependency may be a solution.\r\n\r\n## Reproduce\r\n\r\nFollow these steps from the contributor guide:\r\n\r\n```\r\nconda install -c conda-forge nodejs\r\n```\r\n\r\n```\r\nconda install -c conda-forge pkg-config pango libpng cairo jpeg giflib librsvg glib pixman\r\n```\r\n\r\n```\r\nexport PKG_CONFIG_PATH=$CONDA_PREFIX/lib/pkgconfig\r\n```\r\n\r\n```\r\ngit clone https://github.com/jupyter/jupyterlab.git\r\ncd jupyterlab\r\npip install -e \".[dev,test]\"\r\njlpm install\r\njlpm run build  # Build the dev mode assets (optional)\r\n```\r\n\r\n^Note that an error happens on `pip install -e \".[dev,test]\"`.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: macOS 13.6 (ventura)\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Error encountered on pip install</summary>\r\n<pre>\r\npip install -e \".[dev,test]\"\r\nObtaining file:///Users/egentry/envdemo/jupyterlab\r\n  Installing build dependencies ... done\r\n  Checking if build backend supports build_editable ... done\r\n  Getting requirements to build editable ... done\r\n  Installing backend dependencies ... done\r\n  Preparing editable metadata (pyproject.toml) ... error\r\n  error: subprocess-exited-with-error\r\n\r\n  Ã— Preparing editable metadata (pyproject.toml) did not run successfully.\r\n  â”‚ exit code: 1\r\n  â•°â”€> [83 lines of output]\r\n      INFO:hatch_jupyter_builder.utils:Running jupyter-builder\r\n      INFO:hatch_jupyter_builder.utils:Writing pre-commit hook\r\n      INFO:hatch_jupyter_builder.utils:Building with buildapi.builder\r\n      INFO:hatch_jupyter_builder.utils:With kwargs: {'build_cmd': 'build', 'source_dir': 'packages', 'build_dir': 'dev_mode/static', 'npm': ['node', 'jupyterlab/staging/yarn.js']}\r\n      INFO:hatch_jupyter_builder.utils:Installing build dependencies with npm.  This may take a while...\r\n      INFO:hatch_jupyter_builder.utils:> /Users/egentry/workspace_ana/armconda/envs/envdemo/bin/node jupyterlab/staging/yarn.js install\r\n      âž¤ YN0000: â”Œ Project validation\r\n      âž¤ YN0057: â”‚ @jupyterlab/application-top: Resolutions field will be ignored\r\n      âž¤ YN0057: â”‚ @jupyterlab/example-federated-core: Resolutions field will be ignored\r\n      âž¤ YN0000: â”” Completed\r\n      âž¤ YN0000: â”Œ Resolution step\r\n      âž¤ YN0002: â”‚ @jupyterlab/cell-toolbar-extension@workspace:packages/cell-toolbar-extension doesn't provide react (p9b3fb), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/completer@workspace:packages/completer doesn't provide react (pb6629), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/console-extension@workspace:packages/console-extension doesn't provide react (p43f42), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/csvviewer-extension@workspace:packages/csvviewer-extension doesn't provide react (pc0654), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/debugger-extension@workspace:packages/debugger-extension doesn't provide react (p03594), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/documentsearch-extension@workspace:packages/documentsearch-extension doesn't provide react (p625eb), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/extensionmanager-extension@workspace:packages/extensionmanager-extension doesn't provide react (pf4c35), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0060: â”‚ @jupyterlab/extensionmanager@workspace:packages/extensionmanager provides react (pc6bfe) with version 18.2.0, which doesn't satisfy what react-paginate requests\r\n      âž¤ YN0002: â”‚ @jupyterlab/filebrowser-extension@workspace:packages/filebrowser-extension doesn't provide react (p297ab), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/fileeditor-extension@workspace:packages/fileeditor-extension doesn't provide react (p034cc), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/galata-extension@workspace:galata/extension doesn't provide react (p94674), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/galata@workspace:galata doesn't provide react (pf71ca), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/htmlviewer-extension@workspace:packages/htmlviewer-extension doesn't provide react (p251e4), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/mainmenu-extension@workspace:packages/mainmenu-extension doesn't provide react (pe6ae9), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/markdownviewer-extension@workspace:packages/markdownviewer-extension doesn't provide react (p3482b), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/metadataform-extension@workspace:packages/metadataform-extension doesn't provide react (p7f08d), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/metadataform@workspace:packages/metadataform doesn't provide @rjsf/utils (p26354), requested by @rjsf/core\r\n      âž¤ YN0002: â”‚ @jupyterlab/metadataform@workspace:packages/metadataform doesn't provide @rjsf/utils (p4b312), requested by @rjsf/validator-ajv8\r\n      âž¤ YN0002: â”‚ @jupyterlab/metapackage@workspace:packages/metapackage doesn't provide react (pc1a66), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0060: â”‚ @jupyterlab/repo-top@workspace:. provides stylelint (pb09b9) with version 15.10.1, which doesn't satisfy what stylelint-config-prettier requests\r\n      âž¤ YN0002: â”‚ @jupyterlab/repo-top@workspace:. doesn't provide typescript (p38c70), requested by typedoc\r\n      âž¤ YN0002: â”‚ @jupyterlab/services@workspace:packages/services doesn't provide react (p3d5c2), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/settingeditor-extension@workspace:packages/settingeditor-extension doesn't provide react (p1bbc0), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/statusbar-extension@workspace:packages/statusbar-extension doesn't provide react (pba42f), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/terminal-extension@workspace:packages/terminal-extension doesn't provide react (p7805a), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/toc-extension@workspace:packages/toc-extension doesn't provide react (p336fb), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @jupyterlab/translation-extension@workspace:packages/translation-extension doesn't provide react (p854cf), requested by @jupyterlab/settingregistry\r\n      âž¤ YN0002: â”‚ @nrwl/devkit@npm:16.5.2 doesn't provide nx (p83c1a), requested by @nx/devkit\r\n      âž¤ YN0000: â”‚ Some peer dependencies are incorrectly met; run yarn explain peer-requirements <hash> for details, where <hash> is the six-letter p-prefixed code\r\n      âž¤ YN0000: â”” Completed in 0s 212ms\r\n      âž¤ YN0000: â”Œ Fetch step\r\n      âž¤ YN0000: â”” Completed in 0s 731ms\r\n      âž¤ YN0000: â”Œ Link step\r\n      âž¤ YN0009: â”‚ canvas@npm:2.11.2 couldn't be built successfully (exit code 1, logs can be found here: /private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/xfs-5fd2b08f/build.log)\r\n      âž¤ YN0000: â”” Completed in 24s 496ms\r\n      âž¤ YN0000: Failed with errors in 25s 684ms\r\n      Traceback (most recent call last):\r\n        File \"/Users/egentry/workspace_ana/armconda/envs/envdemo/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 167, in prepare_metadata_for_build_editable\r\n          hook = backend.prepare_metadata_for_build_editable\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n      AttributeError: module 'hatchling.build' has no attribute 'prepare_metadata_for_build_editable'\r\n\r\n      During handling of the above exception, another exception occurred:\r\n\r\n      Traceback (most recent call last):\r\n        File \"/Users/egentry/workspace_ana/armconda/envs/envdemo/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 353, in <module>\r\n          main()\r\n        File \"/Users/egentry/workspace_ana/armconda/envs/envdemo/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 335, in main\r\n          json_out['return_val'] = hook(**hook_input['kwargs'])\r\n                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/Users/egentry/workspace_ana/armconda/envs/envdemo/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 176, in prepare_metadata_for_build_editable\r\n          whl_basename = build_hook(metadata_directory, config_settings)\r\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/pip-build-env-owz9yr7s/overlay/lib/python3.12/site-packages/hatchling/build.py\", line 83, in build_editable\r\n          return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))\r\n                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n# This file contains the result of Yarn building a package (canvas@npm:2.11.2)\r\n# Script name: install\r\n\r\nnode-pre-gyp info it worked if it ends with ok\r\nnode-pre-gyp info using node-pre-gyp@1.0.10\r\nnode-pre-gyp info using node@20.12.2 | darwin | arm64\r\nnode-pre-gyp http GET https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arm64.tar.gz\r\nnode-pre-gyp ERR! install response status 404 Not Found on https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arm64.tar.gz\r\nnode-pre-gyp WARN Pre-built binaries not installable for canvas@2.11.2 and node@20.12.2 (node-v115 ABI, unknown) (falling back to source compile with node-gyp)\r\nnode-pre-gyp WARN Hit error response status 404 Not Found on https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arm64.tar.gz\r\ngyp info it worked if it ends with ok\r\ngyp info using node-gyp@9.3.1\r\ngyp info using node@20.12.2 | darwin | arm64\r\ngyp info ok\r\ngyp info it worked if it ends with ok\r\ngyp info using node-gyp@9.3.1\r\ngyp info using node@20.12.2 | darwin | arm64\r\ngyp info find Python using Python version 3.12.3 found at \"/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/python3\"\r\ngyp info spawn /Users/egentry/workspace_ana/armconda/envs/envdemo/bin/python3\r\ngyp info spawn args [\r\ngyp info spawn args   '/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/gyp_main.py',\r\ngyp info spawn args   'binding.gyp',\r\ngyp info spawn args   '-f',\r\ngyp info spawn args   'make',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/config.gypi',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/addon.gypi',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/Users/egentry/Library/Caches/node-gyp/20.12.2/include/node/common.gypi',\r\ngyp info spawn args   '-Dlibrary=shared_library',\r\ngyp info spawn args   '-Dvisibility=default',\r\ngyp info spawn args   '-Dnode_root_dir=/Users/egentry/Library/Caches/node-gyp/20.12.2',\r\ngyp info spawn args   '-Dnode_gyp_dir=/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp',\r\ngyp info spawn args   '-Dnode_lib_file=/Users/egentry/Library/Caches/node-gyp/20.12.2/<(target_arch)/node.l\r\nib',\r\ngyp info spawn args   '-Dmodule_root_dir=/Users/egentry/envdemo/jupyterlab/node_modules/canvas',\r\ngyp info spawn args   '-Dnode_engine=v8',\r\ngyp info spawn args   '--depth=.',\r\ngyp info spawn args   '--no-parallel',\r\ngyp info spawn args   '--generator-output',\r\ngyp info spawn args   'build',\r\ngyp info spawn args   '-Goutput_dir=.'\r\ngyp info spawn args ]\r\nTraceback (most recent call last):\r\n  File \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/gyp_main.py\", line 42, in <module>\r\n    import gyp  # noqa: E402\r\n    ^^^^^^^^^^\r\n  File \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/pylib/gyp/__init__.py\", line 9, in <mod\r\nule>\r\n    import gyp.input\r\n  File \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/pylib/gyp/input.py\", line 19, in <modul\r\ne>\r\n    from distutils.version import StrictVersion\r\nModuleNotFoundError: No module named 'distutils'\r\ngyp ERR! configure error\r\n        File \"/private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/pip-build-env-owz9yr7s/overlay/lib/python3.12/site-packages/hatchling/builders/plugin/interface.py\", line 147, in build\r\n          build_hook.initialize(version, build_data)\r\n        File \"/private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/pip-build-env-owz9yr7s/normal/lib/python3.12/site-packages/hatch_jupyter_builder/plugin.py\", line 94, in initialize\r\n          raise e\r\n        File \"/private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/pip-build-env-owz9yr7s/normal/lib/python3.12/site-packages/hatch_jupyter_builder/plugin.py\", line 89, in initialize\r\n          build_func(self.target_name, version, **build_kwargs)\r\n        File \"/Users/egentry/envdemo/jupyterlab/buildapi.py\", line 20, in builder\r\n          npm_builder(target_name, version, *args, **kwargs)\r\n        File \"/private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/pip-build-env-owz9yr7s/normal/lib/python3.12/site-packages/hatch_jupyter_builder/utils.py\", line 115, in npm_builder\r\n          run([*npm_cmd, \"install\"], cwd=str(abs_path))\r\n        File \"/private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/pip-build-env-owz9yr7s/normal/lib/python3.12/site-packages/hatch_jupyter_builder/utils.py\", line 231, in run\r\n          return subprocess.check_call(cmd, **kwargs)\r\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n        File \"/Users/egentry/workspace_ana/armconda/envs/envdemo/lib/python3.12/subprocess.py\", line 413, in check_call\r\n          raise CalledProcessError(retcode, cmd)\r\n      subprocess.CalledProcessError: Command '['/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/node', 'jupyterlab/staging/yarn.js', 'install']' returned non-zero exit status 1.\r\n      [end of output]\r\n\r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\nerror: metadata-generation-failed\r\n\r\nÃ— Encountered error while generating package metadata.\r\nâ•°â”€> See above for output.\r\n\r\nnote: This is an issue with the package mentioned above, not pip.\r\nhint: See above for details.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Log file content referenced in the error message:</summary>\r\n<pre>\r\ncat /private/var/folders/gd/_3z74zks7dl2z3h4xn_5svxr0000gn/T/xfs-5fd2b08f/build.log\r\n# This file contains the result of Yarn building a package (canvas@npm:2.11.2)\r\n# Script name: install\r\n\r\nnode-pre-gyp info it worked if it ends with ok\r\nnode-pre-gyp info using node-pre-gyp@1.0.10\r\nnode-pre-gyp info using node@20.12.2 | darwin | arm64\r\nnode-pre-gyp http GET https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arm64.tar.gz\r\nnode-pre-gyp ERR! install response status 404 Not Found on https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arm64.tar.gz\r\nnode-pre-gyp WARN Pre-built binaries not installable for canvas@2.11.2 and node@20.12.2 (node-v115 ABI, unknown) (falling back to source compile with node-gyp)\r\nnode-pre-gyp WARN Hit error response status 404 Not Found on https://github.com/Automattic/node-canvas/releases/download/v2.11.2/canvas-v2.11.2-node-v115-darwin-unknown-arm64.tar.gz\r\ngyp info it worked if it ends with ok\r\ngyp info using node-gyp@9.3.1\r\ngyp info using node@20.12.2 | darwin | arm64\r\ngyp info ok\r\ngyp info it worked if it ends with ok\r\ngyp info using node-gyp@9.3.1\r\ngyp info using node@20.12.2 | darwin | arm64\r\ngyp info find Python using Python version 3.12.3 found at \"/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/python3\"\r\ngyp info spawn /Users/egentry/workspace_ana/armconda/envs/envdemo/bin/python3\r\ngyp info spawn args [\r\ngyp info spawn args   '/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/gyp_main.py',\r\ngyp info spawn args   'binding.gyp',\r\ngyp info spawn args   '-f',\r\ngyp info spawn args   'make',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/config.gypi',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/addon.gypi',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/Users/egentry/Library/Caches/node-gyp/20.12.2/include/node/common.gypi',\r\ngyp info spawn args   '-Dlibrary=shared_library',\r\ngyp info spawn args   '-Dvisibility=default',\r\ngyp info spawn args   '-Dnode_root_dir=/Users/egentry/Library/Caches/node-gyp/20.12.2',\r\ngyp info spawn args   '-Dnode_gyp_dir=/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp',\r\ngyp info spawn args   '-Dnode_lib_file=/Users/egentry/Library/Caches/node-gyp/20.12.2/<(target_arch)/node.lib',\r\ngyp info spawn args   '-Dmodule_root_dir=/Users/egentry/envdemo/jupyterlab/node_modules/canvas',\r\ngyp info spawn args   '-Dnode_engine=v8',\r\ngyp info spawn args   '--depth=.',\r\ngyp info spawn args   '--no-parallel',\r\ngyp info spawn args   '--generator-output',\r\ngyp info spawn args   'build',\r\ngyp info spawn args   '-Goutput_dir=.'\r\ngyp info spawn args ]\r\nTraceback (most recent call last):\r\n  File \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/gyp_main.py\", line 42, in <module>\r\n    import gyp  # noqa: E402\r\n    ^^^^^^^^^^\r\n  File \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/pylib/gyp/__init__.py\", line 9, in <module>\r\n    import gyp.input\r\n  File \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/gyp/pylib/gyp/input.py\", line 19, in <module>\r\n    from distutils.version import StrictVersion\r\nModuleNotFoundError: No module named 'distutils'\r\ngyp ERR! configure error\r\ngyp ERR! stack Error: `gyp` failed with exit code: 1\r\ngyp ERR! stack     at ChildProcess.onCpExit (/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/lib/configure.js:325:16)\r\ngyp ERR! stack     at ChildProcess.emit (node:events:518:28)\r\ngyp ERR! stack     at ChildProcess._handle.onexit (node:internal/child_process:294:12)\r\ngyp ERR! System Darwin 22.6.0\r\ngyp ERR! command \"/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/node\" \"/Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/bin/node-gyp.js\" \"configure\" \"--fallback-to-build\" \"--update-binary\" \"--module=/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/Release/canvas.node\" \"--module_name=canvas\" \"--module_path=/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/Release\" \"--napi_version=9\" \"--node_abi_napi=napi\" \"--napi_build_version=0\" \"--node_napi_label=node-v115\"\r\ngyp ERR! cwd /Users/egentry/envdemo/jupyterlab/node_modules/canvas\r\ngyp ERR! node -v v20.12.2\r\ngyp ERR! node-gyp -v v9.3.1\r\ngyp ERR! not ok\r\nnode-pre-gyp ERR! build error\r\nnode-pre-gyp ERR! stack Error: Failed to execute '/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/node /Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/bin/node-gyp.js configure --fallback-to-build --update-binary --module=/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/Release/canvas.node --module_name=canvas --module_path=/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/Release --napi_version=9 --node_abi_napi=napi --napi_build_version=0 --node_napi_label=node-v115' (1)\r\nnode-pre-gyp ERR! stack     at ChildProcess.<anonymous> (/Users/egentry/envdemo/jupyterlab/node_modules/@mapbox/node-pre-gyp/lib/util/compile.js:89:23)\r\nnode-pre-gyp ERR! stack     at ChildProcess.emit (node:events:518:28)\r\nnode-pre-gyp ERR! stack     at maybeClose (node:internal/child_process:1105:16)\r\nnode-pre-gyp ERR! stack     at ChildProcess._handle.onexit (node:internal/child_process:305:5)\r\nnode-pre-gyp ERR! System Darwin 22.6.0\r\nnode-pre-gyp ERR! command \"/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/node\" \"/Users/egentry/envdemo/jupyterlab/node_modules/@mapbox/node-pre-gyp/bin/node-pre-gyp\" \"install\" \"--fallback-to-build\" \"--update-binary\"\r\nnode-pre-gyp ERR! cwd /Users/egentry/envdemo/jupyterlab/node_modules/canvas\r\nnode-pre-gyp ERR! node -v v20.12.2\r\nnode-pre-gyp ERR! node-pre-gyp -v v1.0.10\r\nnode-pre-gyp ERR! not ok\r\nFailed to execute '/Users/egentry/workspace_ana/armconda/envs/envdemo/bin/node /Users/egentry/envdemo/jupyterlab/node_modules/node-gyp/bin/node-gyp.js configure --fallback-to-build --update-binary --module=/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/Release/canvas.node --module_name=canvas --module_path=/Users/egentry/envdemo/jupyterlab/node_modules/canvas/build/Release --napi_version=9 --node_abi_napi=napi --napi_build_version=0 --node_napi_label=node-v115' (1)\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 2843,
    "test_files_count": 4,
    "non_test_files_count": 10,
    "pr_changed_files": [
      ".github/workflows/macostests.yml",
      "docs/source/developer/contributing.rst",
      "galata/test/galata/benchmarkReporter.spec.ts-snapshots/customized-test-galata-linux.svg",
      "galata/test/galata/benchmarkReporter.spec.ts-snapshots/test-galata-linux.svg",
      "packages/csvviewer/jest.config.js",
      "packages/csvviewer/package.json",
      "packages/debugger/jest.config.js",
      "packages/debugger/package.json",
      "packages/terminal/jest.config.js",
      "packages/terminal/package.json",
      "packages/vega5-extension/jest.config.js",
      "packages/vega5-extension/package.json",
      "packages/vega5-extension/test/renderer.spec.ts",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      ".github/workflows/macostests.yml",
      "galata/test/galata/benchmarkReporter.spec.ts-snapshots/customized-test-galata-linux.svg",
      "galata/test/galata/benchmarkReporter.spec.ts-snapshots/test-galata-linux.svg",
      "packages/vega5-extension/test/renderer.spec.ts"
    ],
    "base_commit": "66bc3b0a9473aa3164105333053016965bbfaded",
    "head_commit": "93205a3c097b3394824173b59692c4788360497f",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16314",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16314",
    "dockerfile": "",
    "pr_merged_at": "2024-05-15T08:02:43.000Z",
    "patch": "diff --git a/docs/source/developer/contributing.rst b/docs/source/developer/contributing.rst\nindex c33ffbebe307..cc8c5dded22e 100644\n--- a/docs/source/developer/contributing.rst\n+++ b/docs/source/developer/contributing.rst\n@@ -345,24 +345,6 @@ To check which version of Node.js is installed:\n \n    node -v\n \n-.. _Installing Node.js and jlpm section:\n-\n-The canvas node package is not properly packaged for macOS with ARM architectures (M1 and M2).\n-To build JupyterLab on such platforms, you need a few additional packages:\n-\n-With conda:\n-\n-.. code:: bash\n-\n-   conda install -c conda-forge pkg-config pango libpng cairo jpeg giflib librsvg glib pixman\n-   export PKG_CONFIG_PATH=$CONDA_PREFIX/lib/pkgconfig\n-\n-With Homebrew:\n-\n-.. code:: bash\n-\n-   brew install pkg-config cairo pango libpng jpeg giflib librsvg\n-\n .. _automatic_local_dev_env:\n \n Using automation to set up a local development environment\n@@ -478,11 +460,6 @@ Notes:\n    called something else (such as \"python3\") then parts of the build\n    will fail. You may wish to build in a conda environment, or make an\n    alias.\n--  If you see an error that says ``Call to 'pkg-config pixman-1 --libs'\n-   returned exit status 127 while in binding.gyp`` while running the\n-   ``pip install`` command above, you may be missing packages required\n-   by ``canvas``. Please see the `Installing Node.js and jlpm section`_\n-   of this guide for instructions on how to install these packages.\n -  The ``jlpm`` command is a JupyterLab-provided, locked version of the\n    `yarn <https://classic.yarnpkg.com/en/>`__ package manager. If you have\n    ``yarn`` installed already, you can use the ``yarn`` command when\n@@ -564,14 +541,6 @@ appropriate package folder:\n     We advice to use it as some tests are spinning a Jupyter Server that does not\n     like to be executed in parallel.\n \n-If you see a test run fail with ``Library not loaded: '@rpath/libpixman-1.0.dylib'``\n-(or a different library, such as ``libcairo.2.dylib`` for Mac computers with Apple\n-Silicon chips) while running the\n-``jlpm test`` command above, you may be missing packages required\n-by ``canvas``. Please see\n-`Installing Node.js and jlpm section`_\n-of this guide for instructions on how to install these packages.\n-\n We use ``jest`` for all tests, so standard ``jest`` workflows apply.\n Tests can be debugged in either VSCode or Chrome. It can help to add an\n ``it.only`` to a specific test when debugging. All of the ``test*``\n\ndiff --git a/packages/csvviewer/jest.config.js b/packages/csvviewer/jest.config.js\nindex cd234acbbdc0..cab1ae13da81 100644\n--- a/packages/csvviewer/jest.config.js\n+++ b/packages/csvviewer/jest.config.js\n@@ -4,4 +4,6 @@\n  */\n \n const func = require('@jupyterlab/testing/lib/jest-config');\n-module.exports = func(__dirname);\n+const config = func(__dirname);\n+config['setupFiles'].push('jest-canvas-mock');\n+module.exports = config;\n\ndiff --git a/packages/csvviewer/package.json b/packages/csvviewer/package.json\nindex b4d6478e0507..6a4652461c2b 100644\n--- a/packages/csvviewer/package.json\n+++ b/packages/csvviewer/package.json\n@@ -55,9 +55,9 @@\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.2.0\",\n     \"@types/jest\": \"^29.2.0\",\n-    \"canvas\": \"^2.11.2\",\n     \"csv-spectrum\": \"^1.0.0\",\n     \"jest\": \"^29.2.0\",\n+    \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n     \"typescript\": \"~5.1.6\"\n   },\n\ndiff --git a/packages/debugger/jest.config.js b/packages/debugger/jest.config.js\nindex cd234acbbdc0..cab1ae13da81 100644\n--- a/packages/debugger/jest.config.js\n+++ b/packages/debugger/jest.config.js\n@@ -4,4 +4,6 @@\n  */\n \n const func = require('@jupyterlab/testing/lib/jest-config');\n-module.exports = func(__dirname);\n+const config = func(__dirname);\n+config['setupFiles'].push('jest-canvas-mock');\n+module.exports = config;\n\ndiff --git a/packages/debugger/package.json b/packages/debugger/package.json\nindex ce3e8e4716d4..5e471c2da964 100644\n--- a/packages/debugger/package.json\n+++ b/packages/debugger/package.json\n@@ -82,8 +82,8 @@\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.2.0\",\n     \"@types/jest\": \"^29.2.0\",\n-    \"canvas\": \"^2.11.2\",\n     \"jest\": \"^29.2.0\",\n+    \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n     \"typescript\": \"~5.1.6\"\n   },\n\ndiff --git a/packages/terminal/jest.config.js b/packages/terminal/jest.config.js\nindex cd234acbbdc0..cab1ae13da81 100644\n--- a/packages/terminal/jest.config.js\n+++ b/packages/terminal/jest.config.js\n@@ -4,4 +4,6 @@\n  */\n \n const func = require('@jupyterlab/testing/lib/jest-config');\n-module.exports = func(__dirname);\n+const config = func(__dirname);\n+config['setupFiles'].push('jest-canvas-mock');\n+module.exports = config;\n\ndiff --git a/packages/terminal/package.json b/packages/terminal/package.json\nindex 6f28dad4c91f..2a10617d01d3 100644\n--- a/packages/terminal/package.json\n+++ b/packages/terminal/package.json\n@@ -57,8 +57,8 @@\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.2.0\",\n     \"@types/jest\": \"^29.2.0\",\n-    \"canvas\": \"^2.11.2\",\n     \"jest\": \"^29.2.0\",\n+    \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n     \"typescript\": \"~5.1.6\"\n   },\n\ndiff --git a/packages/vega5-extension/jest.config.js b/packages/vega5-extension/jest.config.js\nindex 64773dc1aab5..354f45359a46 100644\n--- a/packages/vega5-extension/jest.config.js\n+++ b/packages/vega5-extension/jest.config.js\n@@ -4,4 +4,6 @@\n  */\n \n const func = require('@jupyterlab/testutils/lib/jest-config');\n-module.exports = func(__dirname);\n+const config = func(__dirname);\n+config['setupFiles'].push('jest-canvas-mock');\n+module.exports = config;\n\ndiff --git a/packages/vega5-extension/package.json b/packages/vega5-extension/package.json\nindex db525981a826..7d64eedb2b62 100644\n--- a/packages/vega5-extension/package.json\n+++ b/packages/vega5-extension/package.json\n@@ -49,6 +49,7 @@\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/webpack-env\": \"^1.18.0\",\n     \"jest\": \"^29.2.0\",\n+    \"jest-canvas-mock\": \"^2.5.2\",\n     \"rimraf\": \"~5.0.5\",\n     \"typescript\": \"~5.1.6\"\n   },\n\ndiff --git a/yarn.lock b/yarn.lock\nindex d2827ed7c4b9..8a26d513c1c2 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2758,9 +2758,9 @@ __metadata:\n     \"@lumino/signaling\": ^2.1.2\n     \"@lumino/widgets\": ^2.3.2\n     \"@types/jest\": ^29.2.0\n-    canvas: ^2.11.2\n     csv-spectrum: ^1.0.0\n     jest: ^29.2.0\n+    jest-canvas-mock: ^2.5.2\n     rimraf: ~5.0.5\n     typescript: ~5.1.6\n   languageName: unknown\n@@ -2828,8 +2828,8 @@ __metadata:\n     \"@lumino/widgets\": ^2.3.2\n     \"@types/jest\": ^29.2.0\n     \"@vscode/debugprotocol\": ^1.51.0\n-    canvas: ^2.11.2\n     jest: ^29.2.0\n+    jest-canvas-mock: ^2.5.2\n     react: ^18.2.0\n     rimraf: ~5.0.5\n     typescript: ~5.1.6\n@@ -4741,8 +4741,8 @@ __metadata:\n     \"@xterm/addon-web-links\": ~0.11.0\n     \"@xterm/addon-webgl\": ~0.18.0\n     \"@xterm/xterm\": ~5.5.0\n-    canvas: ^2.11.2\n     jest: ^29.2.0\n+    jest-canvas-mock: ^2.5.2\n     rimraf: ~5.0.5\n     typescript: ~5.1.6\n   languageName: unknown\n@@ -4993,6 +4993,7 @@ __metadata:\n     \"@types/jest\": ^29.2.0\n     \"@types/webpack-env\": ^1.18.0\n     jest: ^29.2.0\n+    jest-canvas-mock: ^2.5.2\n     rimraf: ~5.0.5\n     typescript: ~5.1.6\n     vega: ^5.20.0\n@@ -5383,25 +5384,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@mapbox/node-pre-gyp@npm:^1.0.0\":\n-  version: 1.0.10\n-  resolution: \"@mapbox/node-pre-gyp@npm:1.0.10\"\n-  dependencies:\n-    detect-libc: ^2.0.0\n-    https-proxy-agent: ^5.0.0\n-    make-dir: ^3.1.0\n-    node-fetch: ^2.6.7\n-    nopt: ^5.0.0\n-    npmlog: ^5.0.1\n-    rimraf: ^3.0.2\n-    semver: ^7.3.5\n-    tar: ^6.1.11\n-  bin:\n-    node-pre-gyp: bin/node-pre-gyp\n-  checksum: 1a98db05d955b74dad3814679593df293b9194853698f3f5f1ed00ecd93128cdd4b14fb8767fe44ac6981ef05c23effcfdc88710e7c1de99ccb6f647890597c8\n-  languageName: node\n-  linkType: hard\n-\n \"@microsoft/fast-colors@npm:^5.3.1\":\n   version: 5.3.1\n   resolution: \"@microsoft/fast-colors@npm:5.3.1\"\n@@ -8007,7 +7989,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"abbrev@npm:1, abbrev@npm:^1.0.0\":\n+\"abbrev@npm:^1.0.0\":\n   version: 1.1.1\n   resolution: \"abbrev@npm:1.1.1\"\n   checksum: a4a97ec07d7ea112c517036882b2ac22f3109b7b19077dc656316d07d308438aac28e4d9746dc4d84bf6b1e75b4a7b0a5f3cb30592419f128ca9a8cee3bcfa17\n@@ -8288,16 +8270,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"are-we-there-yet@npm:^2.0.0\":\n-  version: 2.0.0\n-  resolution: \"are-we-there-yet@npm:2.0.0\"\n-  dependencies:\n-    delegates: ^1.0.0\n-    readable-stream: ^3.6.0\n-  checksum: 6c80b4fd04ecee6ba6e737e0b72a4b41bdc64b7d279edfc998678567ff583c8df27e27523bc789f2c99be603ffa9eaa612803da1d886962d2086e7ff6fa90c7c\n-  languageName: node\n-  linkType: hard\n-\n \"are-we-there-yet@npm:^3.0.0\":\n   version: 3.0.1\n   resolution: \"are-we-there-yet@npm:3.0.1\"\n@@ -9063,18 +9035,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"canvas@npm:^2.11.2\":\n-  version: 2.11.2\n-  resolution: \"canvas@npm:2.11.2\"\n-  dependencies:\n-    \"@mapbox/node-pre-gyp\": ^1.0.0\n-    nan: ^2.17.0\n-    node-gyp: latest\n-    simple-get: ^3.0.3\n-  checksum: 61e554aef80022841dc836964534082ec21435928498032562089dfb7736215f039c7d99ee546b0cf10780232d9bf310950f8b4d489dc394e0fb6f6adfc97994\n-  languageName: node\n-  linkType: hard\n-\n \"caseless@npm:~0.12.0\":\n   version: 0.12.0\n   resolution: \"caseless@npm:0.12.0\"\n@@ -9407,7 +9367,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"color-name@npm:^1.0.0, color-name@npm:~1.1.4\":\n+\"color-name@npm:^1.0.0, color-name@npm:^1.1.4, color-name@npm:~1.1.4\":\n   version: 1.1.4\n   resolution: \"color-name@npm:1.1.4\"\n   checksum: b0445859521eb4021cd0fb0cc1a75cecf67fceecae89b63f62b201cca8d345baf8b952c966862a9d9a2632987d4f6581f0ec8d957dfacece86f0a7919316f610\n@@ -9424,7 +9384,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"color-support@npm:^1.1.2, color-support@npm:^1.1.3\":\n+\"color-support@npm:^1.1.3\":\n   version: 1.1.3\n   resolution: \"color-support@npm:1.1.3\"\n   bin:\n@@ -9594,7 +9554,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"console-control-strings@npm:^1.0.0, console-control-strings@npm:^1.1.0\":\n+\"console-control-strings@npm:^1.1.0\":\n   version: 1.1.0\n   resolution: \"console-control-strings@npm:1.1.0\"\n   checksum: 8755d76787f94e6cf79ce4666f0c5519906d7f5b02d4b884cf41e11dcd759ed69c57da0670afd9236d229a46e0f9cf519db0cd829c6dca820bb5a5c3def584ed\n@@ -9939,6 +9899,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cssfontparser@npm:^1.2.1\":\n+  version: 1.2.1\n+  resolution: \"cssfontparser@npm:1.2.1\"\n+  checksum: 952d487cddab591fb944f2a4c326a7736bc963784a6d92b6ad4051f3bf5ee49a732eff62e29a52ff085197cb07f5bd66525a2245ded7fd356113ac81be9238b9\n+  languageName: node\n+  linkType: hard\n+\n \"csso@npm:^5.0.5\":\n   version: 5.0.5\n   resolution: \"csso@npm:5.0.5\"\n@@ -10520,15 +10487,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"decompress-response@npm:^4.2.0\":\n-  version: 4.2.1\n-  resolution: \"decompress-response@npm:4.2.1\"\n-  dependencies:\n-    mimic-response: ^2.0.0\n-  checksum: 4e783ca4dfe9417354d61349750fe05236f565a4415a6ca20983a311be2371debaedd9104c0b0e7b36e5f167aeaae04f84f1a0b3f8be4162f1d7d15598b8fdba\n-  languageName: node\n-  linkType: hard\n-\n \"decompress-response@npm:^6.0.0\":\n   version: 6.0.0\n   resolution: \"decompress-response@npm:6.0.0\"\n@@ -10712,13 +10670,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"detect-libc@npm:^2.0.0\":\n-  version: 2.0.1\n-  resolution: \"detect-libc@npm:2.0.1\"\n-  checksum: ccb05fcabbb555beb544d48080179c18523a343face9ee4e1a86605a8715b4169f94d663c21a03c310ac824592f2ba9a5270218819bb411ad7be578a527593d7\n-  languageName: node\n-  linkType: hard\n-\n \"detect-newline@npm:3.1.0, detect-newline@npm:^3.0.0\":\n   version: 3.1.0\n   resolution: \"detect-newline@npm:3.1.0\"\n@@ -12138,23 +12089,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"gauge@npm:^3.0.0\":\n-  version: 3.0.2\n-  resolution: \"gauge@npm:3.0.2\"\n-  dependencies:\n-    aproba: ^1.0.3 || ^2.0.0\n-    color-support: ^1.1.2\n-    console-control-strings: ^1.0.0\n-    has-unicode: ^2.0.1\n-    object-assign: ^4.1.1\n-    signal-exit: ^3.0.0\n-    string-width: ^4.2.3\n-    strip-ansi: ^6.0.1\n-    wide-align: ^1.1.2\n-  checksum: 81296c00c7410cdd48f997800155fbead4f32e4f82109be0719c63edc8560e6579946cc8abd04205297640691ec26d21b578837fd13a4e96288ab4b40b1dc3e9\n-  languageName: node\n-  linkType: hard\n-\n \"gauge@npm:^4.0.3\":\n   version: 4.0.4\n   resolution: \"gauge@npm:4.0.4\"\n@@ -13816,6 +13750,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"jest-canvas-mock@npm:^2.5.2\":\n+  version: 2.5.2\n+  resolution: \"jest-canvas-mock@npm:2.5.2\"\n+  dependencies:\n+    cssfontparser: ^1.2.1\n+    moo-color: ^1.0.2\n+  checksum: a3004d2e96473049045e49dcf98e5ea6011494048ab42b5422b3089d9ff406aaca8353e79587055d840fa145541668eb8f78613765f252ad5901a8217e91ea5d\n+  languageName: node\n+  linkType: hard\n+\n \"jest-changed-files@npm:^29.5.0\":\n   version: 29.5.0\n   resolution: \"jest-changed-files@npm:29.5.0\"\n@@ -15141,7 +15085,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"make-dir@npm:3.1.0, make-dir@npm:^3.0.0, make-dir@npm:^3.1.0\":\n+\"make-dir@npm:3.1.0, make-dir@npm:^3.0.0\":\n   version: 3.1.0\n   resolution: \"make-dir@npm:3.1.0\"\n   dependencies:\n@@ -15788,13 +15732,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"mimic-response@npm:^2.0.0\":\n-  version: 2.1.0\n-  resolution: \"mimic-response@npm:2.1.0\"\n-  checksum: 014fad6ab936657e5f2f48bd87af62a8e928ebe84472aaf9e14fec4fcb31257a5edff77324d8ac13ddc6685ba5135cf16e381efac324e5f174fb4ddbf902bf07\n-  languageName: node\n-  linkType: hard\n-\n \"mimic-response@npm:^3.1.0\":\n   version: 3.1.0\n   resolution: \"mimic-response@npm:3.1.0\"\n@@ -16035,6 +15972,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"moo-color@npm:^1.0.2\":\n+  version: 1.0.3\n+  resolution: \"moo-color@npm:1.0.3\"\n+  dependencies:\n+    color-name: ^1.1.4\n+  checksum: 02bf59b6bbd5e86641bc062e2dc0843e6e579e18ef67e1c8e93bfc01945df578f20e66ce16aa9632db2aa0e16806e0914a26eb345a804f45fff1ae12a8906a29\n+  languageName: node\n+  linkType: hard\n+\n \"mri@npm:^1.1.0\":\n   version: 1.2.0\n   resolution: \"mri@npm:1.2.0\"\n@@ -16119,15 +16065,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"nan@npm:^2.17.0\":\n-  version: 2.17.0\n-  resolution: \"nan@npm:2.17.0\"\n-  dependencies:\n-    node-gyp: latest\n-  checksum: ec609aeaf7e68b76592a3ba96b372aa7f5df5b056c1e37410b0f1deefbab5a57a922061e2c5b369bae9c7c6b5e6eecf4ad2dac8833a1a7d3a751e0a7c7f849ed\n-  languageName: node\n-  linkType: hard\n-\n \"nanoclone@npm:^0.2.1\":\n   version: 0.2.1\n   resolution: \"nanoclone@npm:0.2.1\"\n@@ -16276,17 +16213,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"nopt@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"nopt@npm:5.0.0\"\n-  dependencies:\n-    abbrev: 1\n-  bin:\n-    nopt: bin/nopt.js\n-  checksum: d35fdec187269503843924e0114c0c6533fb54bbf1620d0f28b4b60ba01712d6687f62565c55cc20a504eff0fbe5c63e22340c3fad549ad40469ffb611b04f2f\n-  languageName: node\n-  linkType: hard\n-\n \"nopt@npm:^6.0.0\":\n   version: 6.0.0\n   resolution: \"nopt@npm:6.0.0\"\n@@ -16480,18 +16406,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"npmlog@npm:^5.0.1\":\n-  version: 5.0.1\n-  resolution: \"npmlog@npm:5.0.1\"\n-  dependencies:\n-    are-we-there-yet: ^2.0.0\n-    console-control-strings: ^1.1.0\n-    gauge: ^3.0.0\n-    set-blocking: ^2.0.0\n-  checksum: 516b2663028761f062d13e8beb3f00069c5664925871a9b57989642ebe09f23ab02145bf3ab88da7866c4e112cafff72401f61a672c7c8a20edc585a7016ef5f\n-  languageName: node\n-  linkType: hard\n-\n \"npmlog@npm:^6.0.0, npmlog@npm:^6.0.2\":\n   version: 6.0.2\n   resolution: \"npmlog@npm:6.0.2\"\n@@ -18813,7 +18727,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"signal-exit@npm:3.0.7, signal-exit@npm:^3.0.0, signal-exit@npm:^3.0.2, signal-exit@npm:^3.0.3, signal-exit@npm:^3.0.7\":\n+\"signal-exit@npm:3.0.7, signal-exit@npm:^3.0.2, signal-exit@npm:^3.0.3, signal-exit@npm:^3.0.7\":\n   version: 3.0.7\n   resolution: \"signal-exit@npm:3.0.7\"\n   checksum: a2f098f247adc367dffc27845853e9959b9e88b01cb301658cfe4194352d8d2bb32e18467c786a7fe15f1d44b233ea35633d076d5e737870b7139949d1ab6318\n@@ -18841,24 +18755,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"simple-concat@npm:^1.0.0\":\n-  version: 1.0.1\n-  resolution: \"simple-concat@npm:1.0.1\"\n-  checksum: 4d211042cc3d73a718c21ac6c4e7d7a0363e184be6a5ad25c8a1502e49df6d0a0253979e3d50dbdd3f60ef6c6c58d756b5d66ac1e05cda9cacd2e9fc59e3876a\n-  languageName: node\n-  linkType: hard\n-\n-\"simple-get@npm:^3.0.3\":\n-  version: 3.1.1\n-  resolution: \"simple-get@npm:3.1.1\"\n-  dependencies:\n-    decompress-response: ^4.2.0\n-    once: ^1.3.1\n-    simple-concat: ^1.0.0\n-  checksum: 80195e70bf171486e75c31e28e5485468195cc42f85940f8b45c4a68472160144d223eb4d07bc82ef80cb974b7c401db021a540deb2d34ac4b3b8883da2d6401\n-  languageName: node\n-  linkType: hard\n-\n \"simple-swizzle@npm:^0.2.2\":\n   version: 0.2.2\n   resolution: \"simple-swizzle@npm:0.2.2\"\n@@ -21618,7 +21514,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"wide-align@npm:^1.1.2, wide-align@npm:^1.1.5\":\n+\"wide-align@npm:^1.1.5\":\n   version: 1.1.5\n   resolution: \"wide-align@npm:1.1.5\"\n   dependencies:\n",
    "test_patch": "diff --git a/.github/workflows/macostests.yml b/.github/workflows/macostests.yml\nindex faedefaace9a..e11dd8fcc02e 100644\n--- a/.github/workflows/macostests.yml\n+++ b/.github/workflows/macostests.yml\n@@ -15,6 +15,9 @@ jobs:\n       matrix:\n         group: [integrity, python, usage, usage2]\n         python-version: [3.11]\n+        include:\n+          - group: python\n+            python-version: 3.12\n       fail-fast: false\n     timeout-minutes: 45\n     runs-on: macos-latest\n\ndiff --git a/galata/test/galata/benchmarkReporter.spec.ts-snapshots/customized-test-galata-linux.svg b/galata/test/galata/benchmarkReporter.spec.ts-snapshots/customized-test-galata-linux.svg\nindex 26c84ae858b0..3395566047a9 100644\n--- a/galata/test/galata/benchmarkReporter.spec.ts-snapshots/customized-test-galata-linux.svg\n+++ b/galata/test/galata/benchmarkReporter.spec.ts-snapshots/customized-test-galata-linux.svg\n@@ -1 +1 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"marks\" width=\"218\" height=\"47\" viewBox=\"0 0 218 47\"><rect width=\"218\" height=\"47\" fill=\"white\"/><g fill=\"none\" stroke-miterlimit=\"10\" transform=\"translate(99,22)\"><g class=\"mark-group role-frame root\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h20v20h-20Z\"/><g><g class=\"mark-rect role-mark marks\" role=\"graphics-symbol\" aria-roledescription=\"rect mark container\"><path d=\"M0,0h20v20h-20Z\" fill=\"#4c78a8\"/></g><g class=\"mark-group role-title\"><g transform=\"translate(10,-17)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'Duration of common actions'\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">Duration of common actions</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g></g></svg>\n\\ No newline at end of file\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"marks\" width=\"280\" height=\"47\" viewBox=\"0 0 280 47\"><rect width=\"280\" height=\"47\" fill=\"white\"/><g fill=\"none\" stroke-miterlimit=\"10\" transform=\"translate(130,22)\"><g class=\"mark-group role-frame root\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h20v20h-20Z\"/><g><g class=\"mark-rect role-mark marks\" role=\"graphics-symbol\" aria-roledescription=\"rect mark container\"><path d=\"M0,0h20v20h-20Z\" fill=\"#4c78a8\"/></g><g class=\"mark-group role-title\"><g transform=\"translate(10,-17)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'Duration of common actions'\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">Duration of common actions</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g></g></svg>\n\\ No newline at end of file\n\ndiff --git a/galata/test/galata/benchmarkReporter.spec.ts-snapshots/test-galata-linux.svg b/galata/test/galata/benchmarkReporter.spec.ts-snapshots/test-galata-linux.svg\nindex 878638393276..fcf3098fad41 100644\n--- a/galata/test/galata/benchmarkReporter.spec.ts-snapshots/test-galata-linux.svg\n+++ b/galata/test/galata/benchmarkReporter.spec.ts-snapshots/test-galata-linux.svg\n@@ -1 +1 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"marks\" width=\"281\" height=\"186\" viewBox=\"0 0 281 186\"><rect width=\"281\" height=\"186\" fill=\"white\"/><g fill=\"none\" stroke-miterlimit=\"10\" transform=\"translate(75,108)\"><g class=\"mark-group role-frame root\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-scope concat_0_group\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-scope concat_0_concat_0_group\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-column-title column-title\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(100,-31)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-title\"><g transform=\"translate(0,-21)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'browser'\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(0,9)\" font-family=\"sans-serif\" font-size=\"11px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">browser</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-row-header concat_0_concat_0_row_header\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(-1,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v40h0Z\"/><g><g class=\"mark-group role-axis\" role=\"graphics-symbol\" aria-roledescription=\"axis\" aria-label=\"Y-axis titled 'reference' for a discrete scale with 2 values: actual, expected\"><g transform=\"translate(0.5,0.5)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-rule role-axis-tick\" pointer-events=\"none\"><line transform=\"translate(0,10)\" x2=\"-5\" y2=\"0\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/><line transform=\"translate(0,30)\" x2=\"-5\" y2=\"0\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-label\" pointer-events=\"none\"><text text-anchor=\"end\" transform=\"translate(-7,12.5)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">actual</text><text text-anchor=\"end\" transform=\"translate(-7,32.5)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">expected</text></g><g class=\"mark-rule role-axis-domain\" pointer-events=\"none\"><line transform=\"translate(0,0)\" x2=\"0\" y2=\"40\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-title\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(-57.3134765625,20) rotate(-90) translate(0,-2)\" font-family=\"sans-serif\" font-size=\"11px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">reference</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-column-header concat_0_concat_0_column_header\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,-1)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h200v0h-200Z\"/><g><g class=\"mark-group role-title\"><g transform=\"translate(100,-20)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'chromium'\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(0,8)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">chromium</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-column-footer concat_0_concat_0_column_footer\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,41)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h200v0h-200Z\"/><g><g class=\"mark-group role-axis\" role=\"graphics-symbol\" aria-roledescription=\"axis\" aria-label=\"X-axis titled 'Time (ms)' for a linear scale with values from 18,204 to 18,204\"><g transform=\"translate(0.5,0.5)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-rule role-axis-tick\" pointer-events=\"none\"><line transform=\"translate(100,0)\" x2=\"0\" y2=\"5\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-label\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(100,15)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">18,204</text></g><g class=\"mark-rule role-axis-domain\" pointer-events=\"none\"><line transform=\"translate(0,0)\" x2=\"200\" y2=\"0\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-title\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(100,30)\" font-family=\"sans-serif\" font-size=\"11px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">Time (ms)</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-scope concat_0_concat_0_cell\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0.5,0.5h200v40h-200Z\" stroke=\"#ddd\"/><g><g class=\"mark-group role-axis\" aria-hidden=\"true\"><g transform=\"translate(0.5,40.5)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-rule role-axis-grid\" pointer-events=\"none\"><line transform=\"translate(100,0)\" x2=\"0\" y2=\"-40\" stroke=\"#ddd\" stroke-width=\"1\" opacity=\"1\"/></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g><g class=\"mark-rule role-mark concat_0_concat_0_child_layer_0_marks\" aria-hidden=\"true\"><line transform=\"translate(100,10)\" x2=\"0\" y2=\"0\" stroke=\"black\"/><line transform=\"translate(100,30)\" x2=\"0\" y2=\"0\" stroke=\"black\"/></g><g class=\"mark-rule role-mark concat_0_concat_0_child_layer_1_marks\" aria-hidden=\"true\"><line transform=\"translate(100,10)\" x2=\"0\" y2=\"0\" stroke=\"black\"/><line transform=\"translate(100,30)\" x2=\"0\" y2=\"0\" stroke=\"black\"/></g><g class=\"mark-rect role-mark concat_0_concat_0_child_layer_2_marks\" role=\"graphics-object\" aria-roledescription=\"rect mark container\"><path aria-label=\"Time (ms): 18204; reference: actual; upper_box_time: 18204; Max of Time (ms): 18204; Q3 of Time (ms): 18204; Median of Time (ms): 18204; Q1 of Time (ms): 18204; Min of Time (ms): 18204\" role=\"graphics-symbol\" aria-roledescription=\"box\" d=\"M100,3h0v14h0Z\" fill=\"#4c78a8\"/><path aria-label=\"Time (ms): 18204; reference: expected; upper_box_time: 18204; Max of Time (ms): 18204; Q3 of Time (ms): 18204; Median of Time (ms): 18204; Q1 of Time (ms): 18204; Min of Time (ms): 18204\" role=\"graphics-symbol\" aria-roledescription=\"box\" d=\"M100,23h0v14h0Z\" fill=\"#4c78a8\"/></g><g class=\"mark-rect role-mark concat_0_concat_0_child_layer_3_marks\" aria-hidden=\"true\"><path d=\"M99.5,3h1v14h-1Z\" fill=\"white\" opacity=\"0.7\"/><path d=\"M99.5,23h1v14h-1Z\" fill=\"white\" opacity=\"0.7\"/></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-title\"><g transform=\"translate(-69.3134765625,-69)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'open'\" pointer-events=\"none\"><text text-anchor=\"start\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">open</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-title\"><g transform=\"translate(-69.3134765625,-86)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'large_code_notebook'\" pointer-events=\"none\"><text text-anchor=\"start\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">large_code_notebook</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-title\"><g transform=\"translate(-69.3134765625,-103)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'Duration of common actions'\" pointer-events=\"none\"><text text-anchor=\"start\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">Duration of common actions</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g></g></svg>\n\\ No newline at end of file\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"marks\" width=\"298\" height=\"186\" viewBox=\"0 0 298 186\"><rect width=\"298\" height=\"186\" fill=\"white\"/><g fill=\"none\" stroke-miterlimit=\"10\" transform=\"translate(92,108)\"><g class=\"mark-group role-frame root\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-scope concat_0_group\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-scope concat_0_concat_0_group\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-column-title column-title\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(100,-31)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\"/><g><g class=\"mark-group role-title\"><g transform=\"translate(0,-21)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'browser'\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(0,9)\" font-family=\"sans-serif\" font-size=\"11px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">browser</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-row-header concat_0_concat_0_row_header\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(-1,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v40h0Z\"/><g><g class=\"mark-group role-axis\" role=\"graphics-symbol\" aria-roledescription=\"axis\" aria-label=\"Y-axis titled 'reference' for a discrete scale with 2 values: actual, expected\"><g transform=\"translate(0.5,0.5)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-rule role-axis-tick\" pointer-events=\"none\"><line transform=\"translate(0,10)\" x2=\"-5\" y2=\"0\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/><line transform=\"translate(0,30)\" x2=\"-5\" y2=\"0\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-label\" pointer-events=\"none\"><text text-anchor=\"end\" transform=\"translate(-7,12.5)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">actual</text><text text-anchor=\"end\" transform=\"translate(-7,32.5)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">expected</text></g><g class=\"mark-rule role-axis-domain\" pointer-events=\"none\"><line transform=\"translate(0,0)\" x2=\"0\" y2=\"40\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-title\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(-75,20) rotate(-90) translate(0,-2)\" font-family=\"sans-serif\" font-size=\"11px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">reference</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-column-header concat_0_concat_0_column_header\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,-1)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h200v0h-200Z\"/><g><g class=\"mark-group role-title\"><g transform=\"translate(100,-20)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'chromium'\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(0,8)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">chromium</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-column-footer concat_0_concat_0_column_footer\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,41)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h200v0h-200Z\"/><g><g class=\"mark-group role-axis\" role=\"graphics-symbol\" aria-roledescription=\"axis\" aria-label=\"X-axis titled 'Time (ms)' for a linear scale with values from 18,204 to 18,204\"><g transform=\"translate(0.5,0.5)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-rule role-axis-tick\" pointer-events=\"none\"><line transform=\"translate(100,0)\" x2=\"0\" y2=\"5\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-label\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(100,15)\" font-family=\"sans-serif\" font-size=\"10px\" fill=\"#000\" opacity=\"1\">18,204</text></g><g class=\"mark-rule role-axis-domain\" pointer-events=\"none\"><line transform=\"translate(0,0)\" x2=\"200\" y2=\"0\" stroke=\"#888\" stroke-width=\"1\" opacity=\"1\"/></g><g class=\"mark-text role-axis-title\" pointer-events=\"none\"><text text-anchor=\"middle\" transform=\"translate(100,30)\" font-family=\"sans-serif\" font-size=\"11px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">Time (ms)</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-scope concat_0_concat_0_cell\" role=\"graphics-object\" aria-roledescription=\"group mark container\"><g transform=\"translate(0,0)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0.5,0.5h200v40h-200Z\" stroke=\"#ddd\"/><g><g class=\"mark-group role-axis\" aria-hidden=\"true\"><g transform=\"translate(0.5,40.5)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-rule role-axis-grid\" pointer-events=\"none\"><line transform=\"translate(100,0)\" x2=\"0\" y2=\"-40\" stroke=\"#ddd\" stroke-width=\"1\" opacity=\"1\"/></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g><g class=\"mark-rule role-mark concat_0_concat_0_child_layer_0_marks\" aria-hidden=\"true\"><line transform=\"translate(100,10)\" x2=\"0\" y2=\"0\" stroke=\"black\"/><line transform=\"translate(100,30)\" x2=\"0\" y2=\"0\" stroke=\"black\"/></g><g class=\"mark-rule role-mark concat_0_concat_0_child_layer_1_marks\" aria-hidden=\"true\"><line transform=\"translate(100,10)\" x2=\"0\" y2=\"0\" stroke=\"black\"/><line transform=\"translate(100,30)\" x2=\"0\" y2=\"0\" stroke=\"black\"/></g><g class=\"mark-rect role-mark concat_0_concat_0_child_layer_2_marks\" role=\"graphics-object\" aria-roledescription=\"rect mark container\"><path aria-label=\"Time (ms): 18204; reference: actual; upper_box_time: 18204; Max of Time (ms): 18204; Q3 of Time (ms): 18204; Median of Time (ms): 18204; Q1 of Time (ms): 18204; Min of Time (ms): 18204\" role=\"graphics-symbol\" aria-roledescription=\"box\" d=\"M100,3h0v14h0Z\" fill=\"#4c78a8\"/><path aria-label=\"Time (ms): 18204; reference: expected; upper_box_time: 18204; Max of Time (ms): 18204; Q3 of Time (ms): 18204; Median of Time (ms): 18204; Q1 of Time (ms): 18204; Min of Time (ms): 18204\" role=\"graphics-symbol\" aria-roledescription=\"box\" d=\"M100,23h0v14h0Z\" fill=\"#4c78a8\"/></g><g class=\"mark-rect role-mark concat_0_concat_0_child_layer_3_marks\" aria-hidden=\"true\"><path d=\"M99.5,3h1v14h-1Z\" fill=\"white\" opacity=\"0.7\"/><path d=\"M99.5,23h1v14h-1Z\" fill=\"white\" opacity=\"0.7\"/></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-title\"><g transform=\"translate(-87,-69)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'open'\" pointer-events=\"none\"><text text-anchor=\"start\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">open</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-title\"><g transform=\"translate(-87,-86)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'large_code_notebook'\" pointer-events=\"none\"><text text-anchor=\"start\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">large_code_notebook</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g><g class=\"mark-group role-title\"><g transform=\"translate(-87,-103)\"><path class=\"background\" aria-hidden=\"true\" d=\"M0,0h0v0h0Z\" pointer-events=\"none\"/><g><g class=\"mark-text role-title-text\" role=\"graphics-symbol\" aria-roledescription=\"title\" aria-label=\"Title text 'Duration of common actions'\" pointer-events=\"none\"><text text-anchor=\"start\" transform=\"translate(0,10)\" font-family=\"sans-serif\" font-size=\"13px\" font-weight=\"bold\" fill=\"#000\" opacity=\"1\">Duration of common actions</text></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" pointer-events=\"none\" display=\"none\"/></g></g></g><path class=\"foreground\" aria-hidden=\"true\" d=\"\" display=\"none\"/></g></g></g></svg>\n\\ No newline at end of file\n\ndiff --git a/packages/vega5-extension/test/renderer.spec.ts b/packages/vega5-extension/test/renderer.spec.ts\nindex 349953ce606f..67544070a4ef 100644\n--- a/packages/vega5-extension/test/renderer.spec.ts\n+++ b/packages/vega5-extension/test/renderer.spec.ts\n@@ -23,6 +23,16 @@ describe('@jupyterlab/vega5-extension', () => {\n \n       expect(model).toHaveProperty('data.image/png');\n       expect(model).not.toHaveProperty(SCALE_FACTOR_PROP);\n+    });\n+\n+    // requires `canvas`\n+    it.skip('should keep size of PNG', async () => {\n+      const model = new MimeModel({\n+        data: {\n+          [VEGALITE5_MIME_TYPE]: VEGALITE5_SPEC\n+        }\n+      });\n+      await VEGALITE5_RENDERER.renderModel(model);\n \n       const size = getPNGSize(model.data['image/png'] as string);\n \n@@ -49,6 +59,25 @@ describe('@jupyterlab/vega5-extension', () => {\n \n       expect(model).toHaveProperty('data.image/png');\n       expect(model).toHaveProperty(SCALE_FACTOR_PROP, scaleFactor);\n+    });\n+\n+    // requires `canvas`\n+    it.skip('should resize scaled PNG', async () => {\n+      const scaleFactor = 2;\n+\n+      const model = new MimeModel({\n+        data: {\n+          [VEGALITE5_MIME_TYPE]: VEGALITE5_SPEC\n+        },\n+        metadata: {\n+          [VEGALITE5_MIME_TYPE]: {\n+            embed_options: {\n+              scaleFactor\n+            }\n+          }\n+        }\n+      });\n+      await VEGALITE5_RENDERER.renderModel(model);\n \n       const size = getPNGSize(model.data['image/png'] as string);\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16312",
    "pr_id": 16312,
    "issue_id": 16294,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "No consistent way to execute a callback function upon acceptance of a Completer item\n### Problem\r\n\r\nWhen accepting a item in the InlineCompleter you can connect a callback function to the `inline-completer:accept` command, but in the case of the Completer, the various equivalent commands `completer:select-notebook`, `completer:select-file`, and `completer:select-console` are not always executed when accepting an item.\r\n\r\nThe `Completer` class has a private Signal `_selected` that is triggered in the code in four places:\r\n1. The `selectActive()` function which is connected to the various commands listed above\r\n2. When the Completer only has one item it is automatically accepted\r\n3. When the Completer is run with a query and only has one item it is automatically accepted\r\n4. When the user selects the item by click on it with their mouse\r\n\r\nThis means that there is no way to connect a callback function to cases 2-4 since the command is not executed and the signal triggered is private.\r\n\r\n### Proposed Solution\r\n\r\nThe most straight forward solution I see is finding a way to surface the private `_selected` Signal, this is already possible to do where the Completer class is accessible via the `selected()` function, but there is no current access of a Completer class to extensions. All calls to Completer instances are done via the private `_panelHandlers` Map in the `CompletionProviderManager` which is not surfaced.\r\n\r\nIf we create a accessor function to `_panelHandlers`, possibly a lookup method that with a widget id arg, to the `CompletionProviderManager` then any extension can get the Completer for a given widget and add a connection to the `selected` signal.\r\n\r\n### Additional context\r\n\r\nThis is important to my use case because our Completer extension wants to track the metrics when users accept completion items.\r\n\r\nThis could be related to #15026, which would also solve this problem, but with a more complicated solution for this use case, trying the callback into the actual implementation of the insertText \r\n",
    "issue_word_count": 326,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "packages/completer/src/manager.ts",
      "packages/completer/src/tokens.ts",
      "packages/metapackage/test/completer/manager.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/metapackage/test/completer/manager.spec.ts"
    ],
    "base_commit": "66bc3b0a9473aa3164105333053016965bbfaded",
    "head_commit": "699df1cac8a31dae79333459b403202334ed67d3",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16312",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16312",
    "dockerfile": "",
    "pr_merged_at": "2024-05-16T10:55:47.000Z",
    "patch": "diff --git a/packages/completer/src/manager.ts b/packages/completer/src/manager.ts\nindex b56c489e57e5..b8b328730ff7 100644\n--- a/packages/completer/src/manager.ts\n+++ b/packages/completer/src/manager.ts\n@@ -10,6 +10,7 @@ import { CompletionHandler } from './handler';\n import { CompleterModel } from './model';\n import { InlineCompleter } from './inline';\n import {\n+  ICompleterSelection,\n   ICompletionContext,\n   ICompletionProvider,\n   ICompletionProviderManager,\n@@ -36,6 +37,10 @@ export class CompletionProviderManager implements ICompletionProviderManager {\n     this._activeProvidersChanged = new Signal<ICompletionProviderManager, void>(\n       this\n     );\n+    this._selected = new Signal<\n+      ICompletionProviderManager,\n+      ICompleterSelection\n+    >(this);\n     this._inlineCompleterFactory = null;\n   }\n \n@@ -46,6 +51,13 @@ export class CompletionProviderManager implements ICompletionProviderManager {\n     return this._activeProvidersChanged;\n   }\n \n+  /**\n+   * Signal emitted when a selection is made from a completer menu.\n+   */\n+  get selected(): ISignal<ICompletionProviderManager, ICompleterSelection> {\n+    return this._selected;\n+  }\n+\n   /**\n    * Set provider timeout.\n    *\n@@ -172,6 +184,9 @@ export class CompletionProviderManager implements ICompletionProviderManager {\n       // Create a new handler.\n       const handler = await this._generateHandler(newCompleterContext, options);\n       this._panelHandlers.set(widget.id, handler);\n+      handler.completer.selected.connect((completer, insertText) =>\n+        this._selected.emit({ insertText })\n+      );\n       widget.disposed.connect(old => {\n         this.disposeHandler(old.id, handler);\n         this._mostRecentContext.delete(id);\n@@ -410,6 +425,7 @@ export class CompletionProviderManager implements ICompletionProviderManager {\n   private _autoCompletion: boolean;\n \n   private _activeProvidersChanged: Signal<ICompletionProviderManager, void>;\n+  private _selected: Signal<ICompletionProviderManager, ICompleterSelection>;\n   private _inlineCompleterFactory: IInlineCompleterFactory | null;\n   private _inlineCompleterSettings = InlineCompleter.defaultSettings;\n }\n\ndiff --git a/packages/completer/src/tokens.ts b/packages/completer/src/tokens.ts\nindex 5254202dd5b0..7a0ffbbfb890 100644\n--- a/packages/completer/src/tokens.ts\n+++ b/packages/completer/src/tokens.ts\n@@ -367,6 +367,11 @@ export interface ICompletionProviderManager {\n    */\n   activeProvidersChanged: ISignal<ICompletionProviderManager, void>;\n \n+  /**\n+   * Signal emitted when a selection is made from a completer menu.\n+   */\n+  selected: ISignal<ICompletionProviderManager, ICompleterSelection>;\n+\n   /**\n    * Inline completer actions.\n    */\n@@ -378,6 +383,13 @@ export interface ICompletionProviderManager {\n   inlineProviders?: IInlineCompletionProviderInfo[];\n }\n \n+export interface ICompleterSelection {\n+  /**\n+   * The text selected by the completer.\n+   */\n+  insertText: string;\n+}\n+\n export interface IInlineCompleterActions {\n   /**\n    * Invoke inline completer.\n",
    "test_patch": "diff --git a/packages/metapackage/test/completer/manager.spec.ts b/packages/metapackage/test/completer/manager.spec.ts\nindex 80d58364a377..915f787a0086 100644\n--- a/packages/metapackage/test/completer/manager.spec.ts\n+++ b/packages/metapackage/test/completer/manager.spec.ts\n@@ -24,6 +24,8 @@ import { createStandaloneCell } from '@jupyter/ydoc';\n \n import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';\n import { NBTestUtils } from '@jupyterlab/notebook/lib/testutils';\n+import { MessageLoop } from '@lumino/messaging';\n+import { Widget } from '@lumino/widgets';\n \n const DEFAULT_PROVIDER_ID = 'CompletionProvider:context';\n const SAMPLE_PROVIDER_ID = 'CompletionProvider:sample';\n@@ -241,5 +243,32 @@ describe('completer/manager', () => {\n         expect(handler.completer.model).toBeInstanceOf(CustomCompleterModel);\n       });\n     });\n+\n+    describe('#selected', () => {\n+      let completerContext: ICompletionContext;\n+      let widget: NotebookPanel;\n+\n+      beforeEach(() => {\n+        const context = contextFactory();\n+        widget = NBTestUtils.createNotebookPanel(context);\n+        completerContext = { widget };\n+      });\n+\n+      it('should emit `selected` signal', async () => {\n+        const callback = jest.fn();\n+        await manager.updateCompleter(completerContext);\n+        const handler = manager['_panelHandlers'].get(\n+          widget.id\n+        ) as CompletionHandler;\n+        handler.completer.model!.setCompletionItems([{ label: 'foo' }]);\n+        MessageLoop.sendMessage(handler.completer, Widget.Msg.UpdateRequest);\n+\n+        manager.selected.connect(callback);\n+        expect(callback).toHaveBeenCalledTimes(0);\n+        manager.select(widget.id);\n+        expect(callback).toHaveBeenCalledTimes(1);\n+        manager.selected.disconnect(callback);\n+      });\n+    });\n   });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16304",
    "pr_id": 16304,
    "issue_id": 16297,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Resetting a shortcut does not restore and enable the default if it was modified\n## Description\r\nI have tried updating the shortcuts, whether I add a new shortcut in addition to an existing one or I modify the single provided shortcut, there are times where the shortcut disappears entirely and if I visit the user-settings `shortcuts.jupyterlab-settings`  config file I can see it is disabled.\r\n\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/assets/12378147/5cd1fd28-c1da-4e1e-b422-1f0cebf8ff1a\r\n\r\n\r\n## Reproduce\r\n\r\n1. Go to 'Settings'\r\n2. Select 'Settings Editor'\r\n3. Select the 'Keyboard Shortcuts' from the left menu.\r\n4. Modify a shortcut and accept changes \r\n5. Reset the shortcut (steps 4-5 may need to be repeated multiple times)\r\n6. At some point, the shortcut will disappear from the list displayed.\r\n7. See the  'user-settings' `shortcuts.jupyterlab-settings` and see the shortcut now has the `\"disabled\": true` property\r\n\r\n## Expected behavior\r\n\r\nI would expect that the shortcut, when reset, goes back to it's initial values.  \r\n\r\n## Context\r\n\r\n\r\n- Operating System and version: M1 macOS 3.6.1 (22G313)\r\n- Browser and version: 123.0.6312.87 (Official Build) (arm64)\r\n- JupyterLab version: 4.2.0\r\n",
    "issue_word_count": 190,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/shortcuts-extension/src/components/ShortcutUI.tsx",
      "packages/shortcuts-extension/test/components/ShortcutUI.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/shortcuts-extension/test/components/ShortcutUI.spec.ts"
    ],
    "base_commit": "a5f9207a28244b5d407281244ff310700be402e1",
    "head_commit": "bedb8752e3031ef065744b9c023092c6f9c45267",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16304",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16304",
    "dockerfile": "",
    "pr_merged_at": "2024-05-09T09:04:35.000Z",
    "patch": "diff --git a/packages/shortcuts-extension/src/components/ShortcutUI.tsx b/packages/shortcuts-extension/src/components/ShortcutUI.tsx\nindex 0fa1b38143d4..de32834c515a 100644\n--- a/packages/shortcuts-extension/src/components/ShortcutUI.tsx\n+++ b/packages/shortcuts-extension/src/components/ShortcutUI.tsx\n@@ -384,6 +384,12 @@ export class ShortcutUI\n           });\n         }\n         found = true;\n+      } else if (\n+        keybinding &&\n+        !JSONExt.deepEqual(keybinding.keys, shortcut.keys) &&\n+        keys.length === 0\n+      ) {\n+        continue;\n       } else {\n         newUserShortcuts.push(shortcut);\n       }\n",
    "test_patch": "diff --git a/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts b/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\nindex a4eab8a99dbb..c1a87674fe92 100644\n--- a/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\n+++ b/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\n@@ -288,6 +288,48 @@ describe('@jupyterlab/shortcut-extension', () => {\n         expect(data.user.shortcuts).toHaveLength(0);\n       });\n \n+      it('should reset default overrides for given shortcut target', async () => {\n+        const defaultKeybinding = {\n+          keys: ['Ctrl A'],\n+          isDefault: true\n+        };\n+\n+        const replacedKeybinding = {\n+          keys: ['Ctrl D'],\n+          isDefault: false\n+        };\n+        const target = {\n+          id: 'test-id',\n+          command: 'test:command',\n+          keybindings: [defaultKeybinding],\n+          args: {},\n+          selector: 'body',\n+          category: 'test'\n+        };\n+        registerKeybinding(target, defaultKeybinding);\n+        await shortcutUI.replaceKeybinding(target, defaultKeybinding, [\n+          'Ctrl D'\n+        ]);\n+\n+        //update the target to the new keybinding.\n+        target.keybindings = [replacedKeybinding];\n+\n+        expect(data.user.shortcuts).toHaveLength(2);\n+        expect(data.user.shortcuts[0]).toEqual({\n+          command: 'test:command',\n+          keys: ['Ctrl A'],\n+          selector: 'body',\n+          disabled: true\n+        });\n+        expect(data.user.shortcuts[1]).toEqual({\n+          command: 'test:command',\n+          keys: ['Ctrl D'],\n+          selector: 'body'\n+        });\n+        await shortcutUI.resetKeybindings(target);\n+        expect(data.user.shortcuts).toHaveLength(0);\n+      });\n+\n       it('should clear defaults overrides for given shortcut target', async () => {\n         const keybinding = {\n           keys: ['Ctrl A'],\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16291",
    "pr_id": 16291,
    "issue_id": 15305,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Should we improve cell toolbar logic or disable cell toolbar in tests?\n## Description\r\n\r\nA bottleneck in the PR review are often the visual test failures. In addition to a few existing test cases which are flaky, a very common problem is the cell toolbar randomly showing up when it should not or randomly hiding when it should be visible for a split second. It is not a problem in normal usage when it is mostly unnoticeable, but it leads to many spurious failed tests, wasting hundreds of hours in CI time and in the time of maintainers, for example:\r\n\r\n| Actual | Expected | Diff |\r\n|--|--|--|\r\n| ![reexpand-headers-03a-actual](https://github.com/jupyterlab/jupyterlab/assets/5832902/5f095d94-ed4d-45f6-8a93-ac1555faf1b7) | ![reexpand-headers-03a-expected](https://github.com/jupyterlab/jupyterlab/assets/5832902/69f27c42-64e3-4fc7-a574-962020e6f2c7) | ![reexpand-headers-03a-diff](https://github.com/jupyterlab/jupyterlab/assets/5832902/490d7f84-d360-4f92-bb83-72a99cae1635) |\r\n\r\n\r\n| Actual | Expected | Diff |\r\n|--|--|--|\r\n| ![notebook-panel-1-actual](https://github.com/jupyterlab/jupyterlab/assets/5832902/da3dc8ef-e9a5-44ea-abe1-6aacc5410b3e) | ![notebook-panel-1-expected](https://github.com/jupyterlab/jupyterlab/assets/5832902/df5b733d-6a93-4222-aeee-46a207ec0324) | ![notebook-panel-1-diff](https://github.com/jupyterlab/jupyterlab/assets/5832902/603dd81b-86e1-4942-9c57-d6f28dea1d1b) |\r\n\r\n## Reproduce\r\n\r\nScreenshots taken from https://github.com/jupyterlab/jupyterlab/actions/runs/6640451043/job/18051878571?pr=15296 but every other PR has this issue. If you seen green status it likely means that one of the maintainers manually restarted the job after checking the failures manually (so they did that instead of improving the codebase or merging a PR).\r\n",
    "issue_word_count": 259,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png",
      "packages/cell-toolbar/src/celltoolbartracker.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png"
    ],
    "base_commit": "8a17ca61cf0943225ddc4506763228dd21c90dab",
    "head_commit": "0dda7047b841073042457703fe7e64b4bc0ab83e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16291",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16291",
    "dockerfile": "",
    "pr_merged_at": "2024-05-09T08:22:49.000Z",
    "patch": "diff --git a/packages/cell-toolbar/src/celltoolbartracker.ts b/packages/cell-toolbar/src/celltoolbartracker.ts\nindex 764acd1f111a..13f1f96b5031 100644\n--- a/packages/cell-toolbar/src/celltoolbartracker.ts\n+++ b/packages/cell-toolbar/src/celltoolbartracker.ts\n@@ -203,6 +203,9 @@ export class CellToolbarTracker implements IDisposable {\n             return;\n           }\n \n+          // Hide the toolbar by default, to avoid temporary overlapping.\n+          cell.node.classList.add(TOOLBAR_OVERLAP_CLASS);\n+\n           (cell.inputArea!.layout as PanelLayout).insertWidget(\n             0,\n             toolbarWidget\n@@ -276,10 +279,12 @@ export class CellToolbarTracker implements IDisposable {\n   }\n \n   private _updateCellForToolbarOverlap(activeCell: Cell<ICellModel>) {\n-    // When we do change in cell, If we don't wait the browser might not have\n-    // completed the layout update, resulting in the previous width being returned\n-    // using `getBoundingClientRect().width` in later functions.\n-    requestAnimationFrame(() => {\n+    // When we do change in cell, the browser might not have completed the layout\n+    // update if we don't wait, resulting in the previous width being returned\n+    // using `getBoundingClientRect().width` in later functions. This also wait for\n+    // the toolbar to be rendered the first time (on page reload), allowing us to\n+    // retrieve the right widgets width.\n+    requestIdleCallback(() => {\n       // Remove the \"toolbar overlap\" class from the cell, rendering the cell's toolbar\n       const activeCellElement = activeCell.node;\n       activeCellElement.classList.remove(TOOLBAR_OVERLAP_CLASS);\n",
    "test_patch": "diff --git a/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png b/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png\nindex e1c3eb682a94..134ff5b036e4 100644\nBinary files a/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png and b/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16261",
    "pr_id": 16261,
    "issue_id": 16182,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Increase/Decrease Text Editor Font Size not working\n## Description\r\n\r\nIncrease/Decrease Text Editor Font Size is not working and is a no-op\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Open a Text Editor in either JupyterLab 4 or Notebook 7\r\n2. Type in some text\r\n3. Click on Settings -> Increase/Decrease Text Editor Font Size\r\n4. See that no font resizing occurs\r\n\r\nBrowser console will show following JavaScript error\r\n```\r\nUncaught (in promise) TypeError: Cannot read properties of undefined (reading 'fontSize')\r\n    at execute (commands.js:141:77)\r\n    at c.execute (index.es6.js:364:33)\r\n    at p.triggerActiveItem (index.es6.js:6365:27)\r\n    at p._evtMouseUp (index.es6.js:6707:14)\r\n    at p.handleEvent (index.es6.js:6510:22)\r\n```\r\n\r\n![chrome_PtBVZmiGKp](https://github.com/jupyterlab/jupyterlab/assets/11775352/ce9fba98-bce1-498c-9973-b544ff6a6355)\r\n\r\n## Expected behavior\r\n\r\nText should resize accordingly\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Windows 10\r\n- Browser and version: Chrome Version 123\r\n- JupyterLab version: 4.1.5\r\n- Notebook version: 7.1.2\r\n\r\n",
    "issue_word_count": 176,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/texteditor.test.ts",
      "packages/codemirror/src/editor.ts",
      "packages/fileeditor-extension/src/commands.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/texteditor.test.ts"
    ],
    "base_commit": "59acb332b53095c36452e10a553eac574592842b",
    "head_commit": "2e8693f5628d129a55789da7721e0ebb4cb8b2b9",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16261",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16261",
    "dockerfile": "",
    "pr_merged_at": "2024-05-06T12:05:39.000Z",
    "patch": "diff --git a/packages/codemirror/src/editor.ts b/packages/codemirror/src/editor.ts\nindex 43d3787d58f7..269c9e203232 100644\n--- a/packages/codemirror/src/editor.ts\n+++ b/packages/codemirror/src/editor.ts\n@@ -572,6 +572,11 @@ export class CodeMirrorEditor implements CodeEditor.IEditor {\n     changes: Record<string, any>\n   ): void {\n     configurator.reconfigureExtensions(this._editor, changes);\n+    // when customStyles change and the editor is not initialized\n+    if (changes['customStyles'] && !changes['fontSize']) {\n+      // update the state to change the gutter height\n+      this.editor.setState(this.editor.state);\n+    }\n   }\n \n   /**\n\ndiff --git a/packages/fileeditor-extension/src/commands.ts b/packages/fileeditor-extension/src/commands.ts\nindex b03a5044e9bf..ca9dac5ae61e 100644\n--- a/packages/fileeditor-extension/src/commands.ts\n+++ b/packages/fileeditor-extension/src/commands.ts\n@@ -258,11 +258,14 @@ export namespace Commands {\n           style.getPropertyValue('--jp-code-font-size'),\n           10\n         );\n+        if (!config.customStyles) {\n+          config.customStyles = {};\n+        }\n         const currentSize =\n           (config['customStyles']['fontSize'] ??\n             extensions.baseConfiguration['customStyles']['fontSize']) ||\n           cssSize;\n-        config.fontSize = currentSize + delta;\n+        config.customStyles.fontSize = currentSize + delta;\n         return settingRegistry\n           .set(id, 'editorConfig', config)\n           .catch((reason: Error) => {\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/texteditor.test.ts b/galata/test/jupyterlab/texteditor.test.ts\nindex 87a5832ac60f..0c498b920eb4 100644\n--- a/galata/test/jupyterlab/texteditor.test.ts\n+++ b/galata/test/jupyterlab/texteditor.test.ts\n@@ -1,7 +1,7 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { expect, test } from '@jupyterlab/galata';\n+import { expect, IJupyterLabPageFixture, test } from '@jupyterlab/galata';\n \n const DEFAULT_NAME = 'untitled.txt';\n \n@@ -103,4 +103,42 @@ ut elit.`\n     const tabHandle = await page.activity.getPanelLocator(DEFAULT_NAME);\n     expect(await tabHandle?.screenshot()).toMatchSnapshot(imageName);\n   });\n+\n+  test.describe('Changing a text editor font-size', () => {\n+    const getFontSize = async (page: IJupyterLabPageFixture) => {\n+      const wrapperElement = page.locator(\n+        '.jp-MainAreaWidget .jp-FileEditor .cm-content.cm-lineWrapping'\n+      );\n+      const computedStyle = await wrapperElement.evaluate(el =>\n+        getComputedStyle(el)\n+      );\n+      return parseInt(computedStyle.fontSize);\n+    };\n+    const createNewTextEditor = async (page: IJupyterLabPageFixture) => {\n+      await page.menu.clickMenuItem('File>New>Text File');\n+\n+      await page.locator(`[role=\"main\"] >> text=${DEFAULT_NAME}`).waitFor();\n+      await page.type('.cm-content', 'text editor');\n+    };\n+    const changeFontSize = async (page: IJupyterLabPageFixture, menuOption) => {\n+      await page.click('text=Settings');\n+      await page.click(`.lm-Menu ul[role=\"menu\"] >> text=\"${menuOption}\"`);\n+    };\n+\n+    test('Should increase a text editor font-size', async ({ page }) => {\n+      await createNewTextEditor(page);\n+      let fontSize = await getFontSize(page);\n+      await changeFontSize(page, 'Increase Text Editor Font Size');\n+\n+      expect(await getFontSize(page)).toEqual(fontSize + 1);\n+    });\n+\n+    test('Should decrease a text editor font-size', async ({ page }) => {\n+      await createNewTextEditor(page);\n+      let fontSize = await getFontSize(page);\n+      await changeFontSize(page, 'Decrease Text Editor Font Size');\n+\n+      expect(await getFontSize(page)).toEqual(fontSize - 1);\n+    });\n+  });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16258",
    "pr_id": 16258,
    "issue_id": 16242,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Search highlight does not move to next cell when replacing `a` with `aa`\n\r\n## Description\r\n\r\nEven after https://github.com/jupyterlab/jupyterlab/pull/15881\r\n\r\n## Reproduce\r\n\r\n![tricky](https://github.com/jupyterlab/jupyterlab/assets/5832902/f719cbc7-f659-46fe-af13-749c23b5ee3f)\r\n\r\n## Expected behavior\r\n\r\nMoves between cells\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.0rc0",
    "issue_word_count": 48,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-replace.test.ts",
      "packages/codemirror/src/searchprovider.ts",
      "packages/notebook/src/searchprovider.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-replace.test.ts"
    ],
    "base_commit": "59acb332b53095c36452e10a553eac574592842b",
    "head_commit": "9c7c00718ca8d596b9bb26684b0f12df4c5deb56",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16258",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16258",
    "dockerfile": "",
    "pr_merged_at": "2024-05-06T10:30:17.000Z",
    "patch": "diff --git a/packages/codemirror/src/searchprovider.ts b/packages/codemirror/src/searchprovider.ts\nindex f894ae2ebaa9..00e65cc617c1 100644\n--- a/packages/codemirror/src/searchprovider.ts\n+++ b/packages/codemirror/src/searchprovider.ts\n@@ -278,7 +278,7 @@ export abstract class EditorSearchProvider<\n         this.currentIndex = this.cmHandler.currentIndex;\n       } else {\n         // Note: the loop logic is only used in single-editor (e.g. file editor)\n-        // provider sub-classes, notebook has it's own loop logic and ignores\n+        // provider sub-classes, notebook has its own loop logic and ignores\n         // `currentIndex` as set here.\n         this.currentIndex = loop ? 0 : null;\n       }\n@@ -375,6 +375,7 @@ export abstract class EditorSearchProvider<\n                   nextMatchFound = true;\n                   break;\n                 }\n+\n                 // Move the highlight forward from the previous match, not looping.\n                 void this.highlightNext(false, { from: 'previous-match' });\n               }\n\ndiff --git a/packages/notebook/src/searchprovider.ts b/packages/notebook/src/searchprovider.ts\nindex 5846cd06457c..eefc360f5c7f 100644\n--- a/packages/notebook/src/searchprovider.ts\n+++ b/packages/notebook/src/searchprovider.ts\n@@ -466,7 +466,7 @@ export class NotebookSearchProvider extends SearchProvider<NotebookPanel> {\n       );\n       if (searchEngine.currentMatchIndex === null) {\n         // switch to next cell\n-        await this.highlightNext(loop);\n+        await this.highlightNext(loop, { from: 'previous-match' });\n       }\n     }\n \n@@ -658,7 +658,30 @@ export class NotebookSearchProvider extends SearchProvider<NotebookPanel> {\n       }\n     }\n \n+    // If we're looking for the next match after the previous match,\n+    // and we've reached the end of the current cell, start at the next one, if possible\n+    const from = options?.from ?? '';\n+    const atEndOfCurrentCell =\n+      from === 'previous-match' &&\n+      this._searchProviders[this._currentProviderIndex].currentMatchIndex ===\n+        null;\n+\n     const startIndex = this._currentProviderIndex;\n+    // If we need to move to the next cell or loop, reset the position of the current search provider.\n+    if (atEndOfCurrentCell) {\n+      void this._searchProviders[this._currentProviderIndex].clearHighlight();\n+    }\n+\n+    // If we're at the end of the last cell in the provider list and we need to loop, do so\n+    if (\n+      loop &&\n+      atEndOfCurrentCell &&\n+      this._currentProviderIndex + 1 >= this._searchProviders.length\n+    ) {\n+      this._currentProviderIndex = 0;\n+    } else {\n+      this._currentProviderIndex += atEndOfCurrentCell ? 1 : 0;\n+    }\n     do {\n       const searchEngine = this._searchProviders[this._currentProviderIndex];\n \n",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-replace.test.ts b/galata/test/jupyterlab/notebook-replace.test.ts\nindex d4108e1c8763..26c682fed844 100644\n--- a/galata/test/jupyterlab/notebook-replace.test.ts\n+++ b/galata/test/jupyterlab/notebook-replace.test.ts\n@@ -182,4 +182,80 @@ test.describe('Notebook Search and Replace', () => {\n     await page.click('button:has-text(\"Replace\")');\n     await page.locator('text=1/4').waitFor();\n   });\n+\n+  test('Replace with a string containing the query string twice', async ({\n+    page\n+  }) => {\n+    // Create a small test notebook\n+    await page.notebook.createNew();\n+    await page.notebook.setCell(0, 'code', 'test\\ntest');\n+    await page.notebook.addCell('code', 'test\\ntest');\n+\n+    await page.keyboard.press('Control+f');\n+    await page.fill('[placeholder=\"Find\"]', 'test');\n+\n+    await page.click('button[title=\"Show Replace\"]');\n+    await page.fill('[placeholder=\"Replace\"]', 'testtest');\n+\n+    // TODO: Next Match press count should be one less\n+    // (the -/4 state should not be necessary).\n+    await page.locator('text=-/4').waitFor();\n+    await page.click('button[title^=\"Next Match\"]', {\n+      clickCount: 3\n+    });\n+\n+    await page.locator('text=1/4').waitFor();\n+    await page.click('button:has-text(\"Replace\")');\n+\n+    // We should move to the first match after the first replacement.\n+    await page.locator('text=3/5').waitFor();\n+    await page.click('button:has-text(\"Replace\")');\n+\n+    // At this point we should be in the second cell\n+    await page.locator('text=5/6').waitFor();\n+    await page.click('button:has-text(\"Replace\")');\n+\n+    await page.locator('text=7/7').waitFor();\n+\n+    await page.click('button:has-text(\"Replace\")');\n+    await page.locator('text=1/8').waitFor();\n+  });\n+\n+  test('Replace with a string containing the query string three times', async ({\n+    page\n+  }) => {\n+    // Create a small test notebook\n+    await page.notebook.createNew();\n+    await page.notebook.setCell(0, 'code', 'test\\ntest');\n+    await page.notebook.addCell('code', 'test\\ntest');\n+\n+    await page.keyboard.press('Control+f');\n+    await page.fill('[placeholder=\"Find\"]', 'test');\n+\n+    await page.click('button[title=\"Show Replace\"]');\n+    await page.fill('[placeholder=\"Replace\"]', 'testtesttest');\n+\n+    // TODO: Next Match press count should be one less\n+    // (the -/4 state should not be necessary).\n+    await page.locator('text=-/4').waitFor();\n+    await page.click('button[title^=\"Next Match\"]', {\n+      clickCount: 3\n+    });\n+\n+    await page.locator('text=1/4').waitFor();\n+    await page.click('button:has-text(\"Replace\")');\n+\n+    // We should move to the first match after the first replacement.\n+    await page.locator('text=4/6').waitFor();\n+    await page.click('button:has-text(\"Replace\")');\n+\n+    // At this point we should be in the second cell\n+    await page.locator('text=7/8').waitFor();\n+    await page.click('button:has-text(\"Replace\")');\n+\n+    await page.locator('text=10/10').waitFor();\n+\n+    await page.click('button:has-text(\"Replace\")');\n+    await page.locator('text=1/12').waitFor();\n+  });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16250",
    "pr_id": 16250,
    "issue_id": 16200,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Add reopen recently closed to context menu on tabbar\n### Problem\r\n\r\nPR https://github.com/jupyterlab/jupyterlab/pull/15483 added a command and main menu entry to reopen recently closed tab. There is no such an entry in the context menu of the tabs themselves, even though this is where users would often go to close tabs.\r\n\r\n> I think \"Reopen Closed Tab\" could be in the context menu of the main area tab, because:\r\n>- this is where \"Close Tab\", \"Close All Other Tabs\" and \"Close Tabs to Right\" are\r\n>- this is where it is in web browsers\r\n\r\n_Originally posted by @krassowski in https://github.com/jupyterlab/jupyterlab/issues/11613#issuecomment-986015737_\r\n            \r\n\r\n### Proposed Solution\r\n\r\nAdd it in the context menu of the tab:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/3eae0d36-d409-4ac2-afb9-c52b9a22d997)\r\n\r\n\r\n### Additional context\r\n\r\nThis is where it in many web browsers, for example:\r\n\r\n| Firefox | Edge |\r\n|---|--|\r\n| ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/885f61d8-45aa-4ef9-9f86-05e8ba904eb1) | ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/fa66f3d9-fa67-4c9a-a986-2060f081643b) |\r\n\r\nIt looks like Chrome does not have it there.",
    "issue_word_count": 183,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-launcher-jupyterlab-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-notebook-jupyterlab-linux.png",
      "packages/mainmenu-extension/schema/plugin.json"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-launcher-jupyterlab-linux.png",
      "galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-notebook-jupyterlab-linux.png"
    ],
    "base_commit": "cc35edbc41e2c3c2087a18f2c1109403a7a6046f",
    "head_commit": "5d0b6f5aab02a0c9e0bf9b53dc9d0eea34c34fdf",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16250",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16250",
    "dockerfile": "",
    "pr_merged_at": "2024-05-06T07:41:08.000Z",
    "patch": "diff --git a/packages/mainmenu-extension/schema/plugin.json b/packages/mainmenu-extension/schema/plugin.json\nindex 7d03526a6368..47456a0bf9cc 100644\n--- a/packages/mainmenu-extension/schema/plugin.json\n+++ b/packages/mainmenu-extension/schema/plugin.json\n@@ -228,6 +228,11 @@\n         \"command\": \"filemenu:create-console\",\n         \"selector\": \"[data-type=\\\"document-title\\\"].jp-mod-current\",\n         \"rank\": 10\n+      },\n+      {\n+        \"command\": \"recentmenu:reopen-last\",\n+        \"selector\": \"#jp-main-dock-panel .lm-DockPanel-tabBar .lm-TabBar-tab\",\n+        \"rank\": 6\n       }\n     ]\n   },\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-launcher-jupyterlab-linux.png b/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-launcher-jupyterlab-linux.png\nindex 2b4bf02d59d9..d416ae70469c 100644\nBinary files a/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-launcher-jupyterlab-linux.png and b/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-launcher-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-notebook-jupyterlab-linux.png b/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-notebook-jupyterlab-linux.png\nindex 084402dea7e1..42342cbb2108 100644\nBinary files a/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-notebook-jupyterlab-linux.png and b/galata/test/jupyterlab/contextmenu.test.ts-snapshots/tab-notebook-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16245",
    "pr_id": 16245,
    "issue_id": 16244,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Tests on CI on MacOS are failing due to GitHub runners switching to arm64\nCI is failing on main and in PRs with:\r\n\r\n```\r\nRun browser-actions/setup-firefox@latest\r\nSetup firefox latest (en-US)\r\nAttempting to download firefox latest...\r\nError: Unsupported platform macos arm64 for version latest\r\n```\r\n\r\nOf note in nbclassic we also saw (https://github.com/jupyter/nbclassic/pull/274):\r\n\r\n```\r\nRun actions/setup-python@v1\r\n  with:\r\n    python-version: 3.10\r\n    architecture: x64\r\nError: Version 3.10 with arch x64 not found\r\nAvailable versions:\r\n```",
    "issue_word_count": 84,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/macostests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/macostests.yml"
    ],
    "base_commit": "f3867b04b57fb1f6f401c6ee36378204099de0ac",
    "head_commit": "448b8745f4fef87e53f506f532723940e6a834fd",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16245",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16245",
    "dockerfile": "",
    "pr_merged_at": "2024-04-26T11:25:36.000Z",
    "patch": "",
    "test_patch": "diff --git a/.github/workflows/macostests.yml b/.github/workflows/macostests.yml\nindex a3c3bff3c8b9..faedefaace9a 100644\n--- a/.github/workflows/macostests.yml\n+++ b/.github/workflows/macostests.yml\n@@ -26,7 +26,10 @@ jobs:\n         uses: jupyterlab/maintainer-tools/.github/actions/base-setup@v1\n \n       - name: Setup firefox\n-        uses: browser-actions/setup-firefox@latest\n+        run: brew install --cask firefox\n+\n+      - name: Setup cairo and pango\n+        run: brew install cairo pango\n \n       - name: Install dependencies\n         env:\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16237",
    "pr_id": 16237,
    "issue_id": 16025,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Use ellipses consistently in menu items and commands\nThis is a spin-off from #15946.\r\n\r\n[Apple's Human Interface Guidelines for menus](https://developer.apple.com/design/human-interface-guidelines/menus) suggest, \"Append an ellipsis to a menu itemâ€™s label when people need to provide additional information before the action can complete.\" A cascading menu, like File > Save and Export Notebook As, should not have an ellipsis, as it does now.\r\n\r\nAudit commands in pull-down menus; for each one that pops up a dialog box to accept additional information, ensure that there is an ellipsis in the menu item. For each menu item that takes immediate action, there should be no ellipsis. Cascading menus should never have an ellipsis, but submenu items that require additional information should have one.\r\n\r\nUpdate the JupyterLab documentation to mention this style improvement.",
    "issue_word_count": 140,
    "test_files_count": 10,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-create-text-file-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-menu-top-documentation-linux.png",
      "galata/test/jupyterlab/kernel.test.ts",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png",
      "packages/apputils-extension/src/index.ts",
      "packages/notebook-extension/schema/export.json",
      "packages/notebook-extension/src/index.ts",
      "packages/workspaces-extension/src/commands.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-create-text-file-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-menu-top-documentation-linux.png",
      "galata/test/jupyterlab/kernel.test.ts",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png"
    ],
    "base_commit": "cc35edbc41e2c3c2087a18f2c1109403a7a6046f",
    "head_commit": "39211ef22b824b7324f82763e0bcc2181949dd5d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16237",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16237",
    "dockerfile": "",
    "pr_merged_at": "2024-04-26T21:25:37.000Z",
    "patch": "diff --git a/packages/apputils-extension/src/index.ts b/packages/apputils-extension/src/index.ts\nindex 4cfa2b207916..2a231faece00 100644\n--- a/packages/apputils-extension/src/index.ts\n+++ b/packages/apputils-extension/src/index.ts\n@@ -650,7 +650,7 @@ const utilityCommands: JupyterFrontEndPlugin<void> = {\n     });\n \n     commands.addCommand(CommandIDs.displayShortcuts, {\n-      label: trans.__('Show Keyboard Shortcuts'),\n+      label: trans.__('Show Keyboard Shortcutsâ€¦'),\n       caption: trans.__(\n         'Show relevant keyboard shortcuts for the current active widget'\n       ),\n\ndiff --git a/packages/notebook-extension/schema/export.json b/packages/notebook-extension/schema/export.json\nindex 156f68dd3e16..d0f35178c5b4 100644\n--- a/packages/notebook-extension/schema/export.json\n+++ b/packages/notebook-extension/schema/export.json\n@@ -13,7 +13,7 @@\n             \"rank\": 10,\n             \"submenu\": {\n               \"id\": \"jp-mainmenu-file-notebookexport\",\n-              \"label\": \"Save and Export Notebook Asâ€¦\"\n+              \"label\": \"Save and Export Notebook As\"\n             }\n           },\n           {\n\ndiff --git a/packages/notebook-extension/src/index.ts b/packages/notebook-extension/src/index.ts\nindex b64f4ab2528c..b971db7ff9c4 100644\n--- a/packages/notebook-extension/src/index.ts\n+++ b/packages/notebook-extension/src/index.ts\n@@ -2417,7 +2417,7 @@ function addCommands(\n     isEnabled\n   });\n   commands.addCommand(CommandIDs.closeAndShutdown, {\n-    label: trans.__('Close and Shut Down Notebook'),\n+    label: trans.__('Close and Shut Down Notebookâ€¦'),\n     execute: args => {\n       const current = getCurrent(tracker, shell, args);\n \n\ndiff --git a/packages/workspaces-extension/src/commands.ts b/packages/workspaces-extension/src/commands.ts\nindex 6d9cad0253f2..2552935fa599 100644\n--- a/packages/workspaces-extension/src/commands.ts\n+++ b/packages/workspaces-extension/src/commands.ts\n@@ -455,7 +455,7 @@ export const commandsPlugin: JupyterFrontEndPlugin<IWorkspaceCommands> = {\n     });\n \n     app.commands.addCommand(CommandIDs.save, {\n-      label: trans.__('Save Current Workspaceâ€¦'),\n+      label: trans.__('Save Current Workspace'),\n       execute: async () => {\n         const { contents } = app.serviceManager;\n         const data = app.serviceManager.workspaces.fetch(resolver.name);\n",
    "test_patch": "diff --git a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\nindex b95e6c453892..fb1522a22a18 100644\n--- a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n+++ b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n@@ -177,7 +177,7 @@\n   },\n   {\n     \"id\": \"apputils:display-shortcuts\",\n-    \"label\": \"Show Keyboard Shortcuts\",\n+    \"label\": \"Show Keyboard Shortcutsâ€¦\",\n     \"caption\": \"Show relevant keyboard shortcuts for the current active widget\",\n     \"shortcuts\": [\n       \"Ctrl Shift H\"\n@@ -1586,7 +1586,7 @@\n   },\n   {\n     \"id\": \"notebook:close-and-shutdown\",\n-    \"label\": \"Close and Shut Down Notebook\",\n+    \"label\": \"Close and Shut Down Notebookâ€¦\",\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n@@ -2515,7 +2515,7 @@\n   },\n   {\n     \"id\": \"workspace-ui:save\",\n-    \"label\": \"Save Current Workspaceâ€¦\",\n+    \"label\": \"Save Current Workspace\",\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n\ndiff --git a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png\nindex 98d46ef184e8..dbda86331c45 100644\nBinary files a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png and b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/files-create-text-file-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/files-create-text-file-documentation-linux.png\nindex d8a639dec2d2..221358ff2ddf 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/files-create-text-file-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/files-create-text-file-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/files-menu-top-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/files-menu-top-documentation-linux.png\nindex a92f1171180c..2ff183590cfa 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/files-menu-top-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/files-menu-top-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/kernel.test.ts b/galata/test/jupyterlab/kernel.test.ts\nindex 3e0c873ed69d..812174c77459 100644\n--- a/galata/test/jupyterlab/kernel.test.ts\n+++ b/galata/test/jupyterlab/kernel.test.ts\n@@ -60,7 +60,7 @@ test.describe('Kernel', () => {\n         .soft(page.getByTitle('Switch kernel'))\n         .toHaveText('Python 3 (ipykernel)');\n \n-      await page.menu.clickMenuItem('File>Close and Shut Down Notebook');\n+      await page.menu.clickMenuItem('File>Close and Shut Down Notebookâ€¦');\n \n       await Promise.all([\n         page\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png\nindex c309aa6a0bf6..99af5d10e41c 100644\nBinary files a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png and b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png\nindex be204852bcb1..7c2ef95d9671 100644\nBinary files a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png and b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png\nindex e8e11aeaf384..5ae17602e068 100644\nBinary files a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png and b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png\nindex 49bd4a8e0778..4127fb34a3de 100644\nBinary files a/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png\nindex cdf443fa8e50..5f846606d40b 100644\nBinary files a/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-help-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16228",
    "pr_id": 16228,
    "issue_id": 15991,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Display kernel ID in the list view of kernels in the sidebar\n> about the table view; should we display the kernel id in a second column (a bit like last modified in the file browser)? Otherwise the kernels section does not bring lots of information compare to the open tabs.\r\n\r\n_Originally posted by @fcollonval in https://github.com/jupyterlab/jupyterlab/pull/15845#pullrequestreview-1933776385_\r\n            \r\n\r\nQuick first mockup (probably should be aligned more to the right and maybe does not need the parentheses, but just to give the idea what this is about):\r\n\r\n![mockup](https://github.com/jupyterlab/jupyterlab/assets/5832902/2115904f-0963-45a4-af9e-ebf191100aba)\r\n",
    "issue_word_count": 105,
    "test_files_count": 3,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/general.test.ts",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "galata/test/documentation/utils.ts",
      "packages/running-extension/src/kernels.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "galata/test/documentation/utils.ts"
    ],
    "base_commit": "fdd45e49e2ad059e4843a4dab915fb1a5cd59902",
    "head_commit": "52b0b4f71ebf3ae79b6ff930d124c2e17c51ed00",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16228",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16228",
    "dockerfile": "",
    "pr_merged_at": "2024-08-11T14:21:32.000Z",
    "patch": "diff --git a/packages/running-extension/src/kernels.tsx b/packages/running-extension/src/kernels.tsx\nindex 1debeef399a3..aeb75a61a819 100644\n--- a/packages/running-extension/src/kernels.tsx\n+++ b/packages/running-extension/src/kernels.tsx\n@@ -137,7 +137,8 @@ export async function addKernelRunningSessionManager(\n             kernel,\n             kernels,\n             sessions,\n-            trans\n+            trans,\n+            mode: options.mode\n           })\n         );\n       }\n@@ -310,7 +311,6 @@ namespace Private {\n       const { _name, spec } = this;\n       return spec?.display_name || _name;\n     }\n-\n     get children(): IRunningSessions.IRunningItem[] {\n       return this._kernels;\n     }\n@@ -328,7 +328,7 @@ namespace Private {\n   type DocumentWidgetWithKernelItem = Omit<\n     IRunningSessions.IRunningItem,\n     'label'\n-  > & { label(): string };\n+  > & { label(): ReactNode; name(): string };\n \n   export class RunningKernel implements IRunningSessions.IRunningItem {\n     constructor(options: RunningKernel.IOptions) {\n@@ -339,6 +339,7 @@ namespace Private {\n       this.kernels = options.kernels;\n       this.sessions = options.sessions;\n       this.trans = options.trans;\n+      this._mode = options.mode;\n     }\n \n     readonly className: string;\n@@ -372,8 +373,20 @@ namespace Private {\n                 : type === 'notebook'\n                 ? notebookIcon\n                 : jupyterIcon,\n-            label: () => name,\n-            labelTitle: () => path\n+            label: () => {\n+              if (this._mode === 'tree') {\n+                return name;\n+              }\n+              const kernelIdPrefix = this.kernel.id.split('-')[0];\n+              return (\n+                <>\n+                  {name}{' '}\n+                  <span className={KERNEL_LABEL_ID}>({kernelIdPrefix})</span>\n+                </>\n+              );\n+            },\n+            labelTitle: () => path,\n+            name: () => name\n           });\n         }\n       }\n@@ -417,15 +430,17 @@ namespace Private {\n       if (children.length === 0) {\n         return this.trans.__('No sessions connected');\n       } else if (children.length == 1) {\n-        return children[0].label();\n+        return children[0].name();\n       } else {\n         return this.trans.__(\n           '%1 and %2 more',\n-          children[0].label(),\n+          children[0].name(),\n           children.length - 1\n         );\n       }\n     }\n+\n+    private _mode: 'list' | 'tree';\n   }\n \n   export namespace RunningKernel {\n@@ -436,6 +451,7 @@ namespace Private {\n       sessions: Session.IManager;\n       spec?: KernelSpec.ISpecModel;\n       trans: IRenderMime.TranslationBundle;\n+      mode: 'list' | 'tree';\n     }\n   }\n \n",
    "test_patch": "diff --git a/galata/test/documentation/general.test.ts b/galata/test/documentation/general.test.ts\nindex e5566bc44ae8..b7e90f053256 100644\n--- a/galata/test/documentation/general.test.ts\n+++ b/galata/test/documentation/general.test.ts\n@@ -5,6 +5,7 @@ import { expect, galata, test } from '@jupyterlab/galata';\n import path from 'path';\n import {\n   filterContent,\n+  freeezeKernelIds,\n   generateArrow,\n   positionMouse,\n   positionMouseOver\n@@ -580,17 +581,13 @@ test.describe('General', () => {\n       .soft(page.locator('.jp-RunningSessions-item.jp-mod-kernel'))\n       .toHaveCount(2, { timeout: 5000 });\n \n-    const freeezeKernelIds = async () => {\n-      return page.evaluate(() => {\n-        const mockedKernelIds = ['abcd1234', 'wxyz5678'];\n-        document\n-          .querySelectorAll('.jp-RunningSessions-item-label-kernel-id')\n-          .forEach((span, i) => {\n-            span.innerText = `(${mockedKernelIds[i]})`;\n-          });\n-      });\n+    const sessionsSidebar = page.locator('.jp-SidePanel.jp-RunningSessions');\n+    const mockedKernelIds = {\n+      'Data.ipynb': 'abcd1234',\n+      'Julia.ipynb': 'wxyz5678'\n     };\n-    await freeezeKernelIds();\n+\n+    await freeezeKernelIds(sessionsSidebar, mockedKernelIds);\n \n     expect\n       .soft(\n@@ -601,18 +598,18 @@ test.describe('General', () => {\n       .toMatchSnapshot('running_layout.png');\n \n     await page.click('jp-button[data-command=\"running:show-modal\"]');\n-    await freeezeKernelIds();\n \n     // Playwright uses shadow-piercing selectors so this works with webcomponents too\n     await expect\n       .soft(page.locator('.jp-SearchableSessions-modal input'))\n       .toBeFocused();\n \n-    expect(\n-      await page\n-        .locator('.jp-SearchableSessions-modal .jp-Dialog-content')\n-        .screenshot()\n-    ).toMatchSnapshot('running_modal.png');\n+    const dialog = page.locator(\n+      '.jp-SearchableSessions-modal .jp-Dialog-content'\n+    );\n+    await freeezeKernelIds(dialog, mockedKernelIds);\n+\n+    expect(await dialog.screenshot()).toMatchSnapshot('running_modal.png');\n   });\n \n   test('Command Palette', async ({ page }) => {\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png\nindex 769b8fdbfa87..a62e30feac3d 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/utils.ts b/galata/test/documentation/utils.ts\nindex 233298ad1ab4..887b9ea744fe 100644\n--- a/galata/test/documentation/utils.ts\n+++ b/galata/test/documentation/utils.ts\n@@ -119,3 +119,26 @@ export async function stubGitHubUserIcons(page: Page): Promise<void> {\n     });\n   });\n }\n+\n+export async function freeezeKernelIds(\n+  node: Locator,\n+  mockMap: Record<string, string>\n+): Promise<void> {\n+  const KERNEL_ID_SELECTOR = '.jp-RunningSessions-item-label-kernel-id';\n+  // wait for the kernel IDs to be rendered.\n+  await node.locator(KERNEL_ID_SELECTOR).first().waitFor();\n+\n+  return node.evaluate(\n+    (node, [KERNEL_ID_SELECTOR, mockMap]) => {\n+      const isTree = node.querySelector('.jp-TreeView');\n+      for (const [notebook, kernelId] of Object.entries(mockMap)) {\n+        const selector = isTree\n+          ? `[title*='${notebook}'] ${KERNEL_ID_SELECTOR}`\n+          : `${KERNEL_ID_SELECTOR}[title='${notebook}']`;\n+        const element = node.querySelector(selector) as HTMLElement;\n+        element.innerText = `(${kernelId})`;\n+      }\n+    },\n+    [KERNEL_ID_SELECTOR, mockMap]\n+  );\n+}\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16225",
    "pr_id": 16225,
    "issue_id": 16060,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Dirty dot goes away after moving a modified cell\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nThe dirty dot, which appears to the left of a cell that has been modified since it was last executed, disappears when a cell is moved.\r\n\r\n## Reproduce\r\n\r\nFirst, create three code cells, and run all of them.\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/93281816/0d9a2cf0-ca29-400c-b138-0fd280c4ec49)\r\n\r\nNow, select the second cell, and modify it. Do not run it.\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/93281816/79ae4f3c-5c22-44cc-b2f7-45a9985b25bf)\r\n\r\nUse drag and drop to move the second cell below the third cell. Note that the dirty dot and orange color disappear.\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/93281816/51b54db9-2ea5-4258-abfb-c43c159b2081)\r\n\r\n## Expected behavior\r\n\r\nThe second cell, modified, still has the orange color and dirty dot to indicate that it has been modified since it was last run.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: macOS 13.6.4 \"Ventura\"\r\n- Browser and version: Firefox ESR 123.0.1\r\n- JupyterLab version: 4.1.5\r\n",
    "issue_word_count": 217,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "packages/cells/src/model.ts",
      "packages/notebook/src/widget.ts",
      "packages/notebook/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/widget.spec.ts"
    ],
    "base_commit": "8819549495cd11470b4db7464d1d59c53cfce787",
    "head_commit": "455b063f9446e28fa32c4181e506d222886cc072",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16225",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16225",
    "dockerfile": "",
    "pr_merged_at": "2024-04-25T11:05:20.000Z",
    "patch": "diff --git a/packages/cells/src/model.ts b/packages/cells/src/model.ts\nindex 91383ad3f957..4e51ec898d9f 100644\n--- a/packages/cells/src/model.ts\n+++ b/packages/cells/src/model.ts\n@@ -649,6 +649,13 @@ export class CodeCellModel extends CellModel implements ICodeCellModel {\n     return this._isDirty;\n   }\n \n+  /**\n+   * Public Set whether the cell is dirty or not.\n+   */\n+  set isDirty(dirty: boolean) {\n+    this._setDirty(dirty);\n+  }\n+\n   /**\n    * The cell outputs.\n    */\n\ndiff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex 24254031beca..e2a88d11140c 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -37,6 +37,7 @@ import { INotebookHistory } from './history';\n import { INotebookModel } from './model';\n import { NotebookViewModel, NotebookWindowedLayout } from './windowing';\n import { NotebookFooter } from './notebookfooter';\n+import { CodeCellModel } from '../../cells/src/model';\n \n /**\n  * The data attribute added to a widget that has an active kernel.\n@@ -398,6 +399,8 @@ export class StaticNotebook extends WindowedList<NotebookViewModel> {\n     }\n \n     const viewModel: { [k: string]: any }[] = new Array(n);\n+    let dirtyState: boolean[] = new Array(n);\n+\n     for (let i = 0; i < n; i++) {\n       viewModel[i] = {};\n       const oldCell = this.widgets[from + i];\n@@ -406,6 +409,9 @@ export class StaticNotebook extends WindowedList<NotebookViewModel> {\n           // @ts-expect-error Cell has no index signature\n           viewModel[i][k] = oldCell[k];\n         }\n+      } else if (oldCell.model.type === 'code') {\n+        const oldCodeCell = oldCell.model as ICodeCellModel;\n+        dirtyState[i] = oldCodeCell.isDirty;\n       }\n     }\n \n@@ -418,6 +424,17 @@ export class StaticNotebook extends WindowedList<NotebookViewModel> {\n         // @ts-expect-error Cell has no index signature\n         newCell[state] = view[state];\n       }\n+\n+      if (from > to) {\n+        if (this.widgets[to + i].model.type === 'code') {\n+          (this.widgets[to + i].model as CodeCellModel).isDirty = dirtyState[i];\n+        }\n+      } else {\n+        if (this.widgets[to + i - n + 1].model.type === 'code') {\n+          (this.widgets[to + i - n + 1].model as CodeCellModel).isDirty =\n+            dirtyState[i];\n+        }\n+      }\n     }\n   }\n \n",
    "test_patch": "diff --git a/packages/notebook/test/widget.spec.ts b/packages/notebook/test/widget.spec.ts\nindex d7a37765d48f..a1a3a465ed71 100644\n--- a/packages/notebook/test/widget.spec.ts\n+++ b/packages/notebook/test/widget.spec.ts\n@@ -452,6 +452,36 @@ describe('@jupyter/notebook', () => {\n       });\n     });\n \n+    describe('#moveCell()', () => {\n+      it('should preserve isDirty state after moving a code cell', () => {\n+        const widget = createWidget();\n+        widget.model!.sharedModel.insertCells(0, [\n+          { cell_type: 'code' },\n+          { cell_type: 'code' }\n+        ]);\n+        (widget.widgets[0].model as CodeCellModel).isDirty = true;\n+        widget.moveCell(0, 1);\n+        expect((widget.widgets[1].model as CodeCellModel).isDirty).toBe(true);\n+      });\n+\n+      it('should preserve isDirty state after moving multiple code cells', () => {\n+        const widget = createWidget();\n+        widget.model!.sharedModel.insertCells(0, [\n+          { cell_type: 'code' },\n+          { cell_type: 'code' },\n+          { cell_type: 'code' },\n+          { cell_type: 'code' },\n+          { cell_type: 'code' }\n+        ]);\n+        (widget.widgets[0].model as CodeCellModel).isDirty = true;\n+        (widget.widgets[2].model as CodeCellModel).isDirty = true;\n+        widget.moveCell(0, 4, 3);\n+        expect((widget.widgets[2].model as CodeCellModel).isDirty).toBe(true);\n+        expect((widget.widgets[3].model as CodeCellModel).isDirty).toBe(false);\n+        expect((widget.widgets[4].model as CodeCellModel).isDirty).toBe(true);\n+      });\n+    });\n+\n     describe('#onModelChanged()', () => {\n       it('should be called when the model changes', () => {\n         const widget = new LogStaticNotebook(options);\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16214",
    "pr_id": 16214,
    "issue_id": 16211,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Changing a second shortcut changes the first one in shortcuts editor\nAfter `pip install -U --pre jupyterlab` on a Mac, adding a second shortcut does not work:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/assets/44469195/06516d55-18ea-481c-aa3b-9a1ed89b579e\r\n\r\nthis was first reported in https://github.com/jupyterlab/jupyterlab/issues/16186#issuecomment-2067649537 and confirmed by @krassowski :\r\n\r\n> I can reproduce this, it is a bug. I think it deserves its own issue as it is not Mac specific.\r\n",
    "issue_word_count": 78,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "packages/shortcuts-extension/src/components/ShortcutItem.tsx",
      "packages/shortcuts-extension/src/components/ShortcutUI.tsx",
      "packages/shortcuts-extension/test/components/ShortcutUI.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/shortcuts-extension/test/components/ShortcutUI.spec.ts"
    ],
    "base_commit": "2dd8f4ebfdf604f61dd3cc1e4f6da14547e89833",
    "head_commit": "22d443579ad37b34a3c5d4329024b31ed54f91df",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16214",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16214",
    "dockerfile": "",
    "pr_merged_at": "2024-04-26T05:08:10.000Z",
    "patch": "diff --git a/packages/shortcuts-extension/src/components/ShortcutItem.tsx b/packages/shortcuts-extension/src/components/ShortcutItem.tsx\nindex 99eac02045fa..a31df8c0d54c 100644\n--- a/packages/shortcuts-extension/src/components/ShortcutItem.tsx\n+++ b/packages/shortcuts-extension/src/components/ShortcutItem.tsx\n@@ -219,12 +219,7 @@ export class ShortcutItem extends React.Component<\n \n   getShortCutForDisplayOnly(binding: IKeybinding): JSX.Element[] {\n     return binding.keys.map((keyboardKey: string, index: number) => (\n-      <div\n-        className=\"jp-Shortcuts-ShortcutKeysContainer\"\n-        key={index}\n-        data-keybinding={index}\n-        data-shortcut={this.props.shortcut.id}\n-      >\n+      <div className=\"jp-Shortcuts-ShortcutKeysContainer\" key={index}>\n         <div className=\"jp-Shortcuts-ShortcutKeys\">\n           {this.toSymbols(keyboardKey)}\n         </div>\n@@ -248,6 +243,8 @@ export class ShortcutItem extends React.Component<\n       <div\n         className=\"jp-Shortcuts-ShortcutContainer\"\n         key={this.props.shortcut.id + '_' + index}\n+        data-keybinding={index}\n+        data-shortcut={this.props.shortcut.id}\n         onClick={() => this.toggleInputReplaceMethod(index)}\n       >\n         {this.isLocationBeingEdited(index)\n\ndiff --git a/packages/shortcuts-extension/src/components/ShortcutUI.tsx b/packages/shortcuts-extension/src/components/ShortcutUI.tsx\nindex 7a43f890e3d6..0fa1b38143d4 100644\n--- a/packages/shortcuts-extension/src/components/ShortcutUI.tsx\n+++ b/packages/shortcuts-extension/src/components/ShortcutUI.tsx\n@@ -358,16 +358,24 @@ export class ShortcutUI\n     const userShortcuts = settings.user.shortcuts ?? [];\n     const newUserShortcuts = [];\n     let found = false;\n+    // Copy over existing user keybindings\n     for (let shortcut of userShortcuts) {\n+      // If this is the query keybinding, update it with new `keys`\n       if (\n         shortcut.command === target.command &&\n         shortcut.selector === target.selector &&\n-        JSONExt.deepEqual(shortcut.args ?? {}, target.args ?? {})\n+        JSONExt.deepEqual(shortcut.args ?? {}, target.args ?? {}) &&\n+        keybinding &&\n+        JSONExt.deepEqual(keybinding.keys, shortcut.keys)\n       ) {\n         const matchesDefault =\n           keybinding &&\n           keybinding.isDefault &&\n           JSONExt.deepEqual(keybinding.keys, keys);\n+\n+        // If the new `keys` are empty, do not copy this one over.\n+        // Also, if the keybinding is a default keybinding and the desired\n+        // new `keys` are the same as default, it does not need to be added.\n         if (keys.length !== 0 && !matchesDefault) {\n           newUserShortcuts.push({\n             command: shortcut.command,\n",
    "test_patch": "diff --git a/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts b/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\nindex 4927c6ba42d6..a4eab8a99dbb 100644\n--- a/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\n+++ b/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\n@@ -182,6 +182,47 @@ describe('@jupyterlab/shortcut-extension', () => {\n           selector: 'body'\n         });\n       });\n+\n+      it('should replace the default keybinding in presence of non-default keybinding', async () => {\n+        const userKeybinding = {\n+          keys: ['Ctrl A'],\n+          isDefault: false\n+        };\n+        const defaultKeybinding = {\n+          keys: ['Ctrl B'],\n+          isDefault: true\n+        };\n+        const target = {\n+          id: 'test-id',\n+          command: 'test:command',\n+          keybindings: [userKeybinding, defaultKeybinding],\n+          args: {},\n+          selector: 'body',\n+          category: 'test'\n+        };\n+        registerKeybinding(target, userKeybinding);\n+        registerKeybinding(target, defaultKeybinding);\n+        await shortcutUI.replaceKeybinding(target, defaultKeybinding, [\n+          'Ctrl X'\n+        ]);\n+        expect(data.user.shortcuts).toHaveLength(3);\n+        expect(data.user.shortcuts[0]).toEqual({\n+          command: 'test:command',\n+          keys: ['Ctrl A'],\n+          selector: 'body'\n+        });\n+        expect(data.user.shortcuts[1]).toEqual({\n+          command: 'test:command',\n+          keys: ['Ctrl B'],\n+          selector: 'body',\n+          disabled: true\n+        });\n+        expect(data.user.shortcuts[2]).toEqual({\n+          command: 'test:command',\n+          keys: ['Ctrl X'],\n+          selector: 'body'\n+        });\n+      });\n     });\n \n     describe('#deleteKeybinding()', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16207",
    "pr_id": 16207,
    "issue_id": 16197,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "\"Modified\" file browser column should be \"Last Modified\" when there is enough space to display\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nThis affects Notebook 7 downstream: https://github.com/jupyter/notebook/pull/7333#issuecomment-2065867044\r\n\r\nIn Notebook 7 there is plenty of space to display the full \"Last Modified\". Also it would be better to keep \"Last Modified\" in Notebook 7 for parity with the classic notebook, at least for now.\r\n\r\n## Reproduce\r\n\r\nAvailable in `4.2.0b2`.\r\n\r\nCurrently defined here in the code base:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/c2c8f34a942ec2c7a4fc49887ddce6beb6dc6571/packages/filebrowser/src/listing.ts#L2371\r\n\r\n## Expected behavior\r\n\r\nThe column should say \"Last Modified\" when the file browser is displayed on the whole page.\r\n\r\nThere could be the same logic as the column content to reduce it to just \"Modified\" when the file browser width is smaller.\r\n\r\n## Context\r\n\r\nReported in:\r\n\r\n- https://github.com/jupyter/notebook/pull/7333#issuecomment-2065867044\r\n- https://github.com/jupyterlab/jupyterlab/pull/15948/files#r1571900809\r\n",
    "issue_word_count": 191,
    "test_files_count": 18,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "examples/filebrowser/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png",
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png"
    ],
    "base_commit": "8819549495cd11470b4db7464d1d59c53cfce787",
    "head_commit": "89ef78a6de80c6f8a9c45d0a71de11e1907b1bb0",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16207",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16207",
    "dockerfile": "",
    "pr_merged_at": "2024-04-25T11:53:09.000Z",
    "patch": "diff --git a/examples/app/example.spec.ts-snapshots/example-linux.png b/examples/app/example.spec.ts-snapshots/example-linux.png\nindex 930c8ad39a29..c9747039c1ef 100644\nBinary files a/examples/app/example.spec.ts-snapshots/example-linux.png and b/examples/app/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/federated/example.spec.ts-snapshots/example-linux.png b/examples/federated/example.spec.ts-snapshots/example-linux.png\nindex 635bfc715ada..f479d3c63901 100644\nBinary files a/examples/federated/example.spec.ts-snapshots/example-linux.png and b/examples/federated/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/filebrowser/example.spec.ts-snapshots/example-linux.png b/examples/filebrowser/example.spec.ts-snapshots/example-linux.png\nindex 29a6424327c6..3b7b592e2da3 100644\nBinary files a/examples/filebrowser/example.spec.ts-snapshots/example-linux.png and b/examples/filebrowser/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/packages/filebrowser/src/listing.ts b/packages/filebrowser/src/listing.ts\nindex b693bdb9b43f..4989caa54aff 100644\n--- a/packages/filebrowser/src/listing.ts\n+++ b/packages/filebrowser/src/listing.ts\n@@ -811,12 +811,13 @@ export class DirListing extends Widget {\n \n   // Update the modified column's size\n   private _updateModifiedSize(node: HTMLElement) {\n-    const modified = DOMUtils.findElement(node, ITEM_MODIFIED_CLASS);\n+    // Look for the modified column's header\n+    const modified = DOMUtils.findElement(node, MODIFIED_ID_CLASS);\n     this._modifiedWidth = modified?.getBoundingClientRect().width ?? 83;\n     this._modifiedStyle =\n-      this._modifiedWidth < 90\n+      this._modifiedWidth < 100\n         ? 'narrow'\n-        : this._modifiedWidth > 110\n+        : this._modifiedWidth > 120\n         ? 'long'\n         : 'short';\n   }\n@@ -825,7 +826,7 @@ export class DirListing extends Widget {\n   protected updateModified(items: Contents.IModel[], nodes: HTMLElement[]) {\n     items.forEach((item, i) => {\n       const node = nodes[i];\n-      if (item.last_modified) {\n+      if (node && item.last_modified) {\n         const modified = DOMUtils.findElement(node, ITEM_MODIFIED_CLASS);\n         if (this.renderer.updateItemModified !== undefined) {\n           this.renderer.updateItemModified(\n@@ -987,6 +988,7 @@ export class DirListing extends Widget {\n \n     // Rerender item nodes' modified dates, if the modified style has changed.\n     const oldModifiedStyle = this._modifiedStyle;\n+    // Update both size and style\n     this._updateModifiedSize(this.node);\n     if (oldModifiedStyle !== this._modifiedStyle) {\n       this.updateModified(this._sortedItems, this._items);\n@@ -2368,7 +2370,10 @@ export namespace DirListing {\n       const trans = translator.load('jupyterlab');\n       const name = this.createHeaderItemNode(trans.__('Name'));\n       const narrow = document.createElement('div');\n-      const modified = this.createHeaderItemNode(trans.__('Modified'));\n+      const modified = this._createHeaderItemNodeWithSizes({\n+        small: trans.__('Modified'),\n+        large: trans.__('Last Modified')\n+      });\n       const fileSize = this.createHeaderItemNode(trans.__('File Size'));\n       name.classList.add(NAME_ID_CLASS);\n       name.classList.add(SELECTED_CLASS);\n@@ -2845,6 +2850,29 @@ export namespace DirListing {\n       node.appendChild(icon);\n       return node;\n     }\n+\n+    /**\n+     * Create a node for a header item with multiple sizes.\n+     */\n+    private _createHeaderItemNodeWithSizes(labels: {\n+      [k: string]: string;\n+    }): HTMLElement {\n+      const node = document.createElement('div');\n+      node.className = HEADER_ITEM_CLASS;\n+      const icon = document.createElement('span');\n+      icon.className = HEADER_ITEM_ICON_CLASS;\n+      for (let k of Object.keys(labels)) {\n+        const text = document.createElement('span');\n+        text.classList.add(\n+          HEADER_ITEM_TEXT_CLASS,\n+          HEADER_ITEM_TEXT_CLASS + '-' + k\n+        );\n+        text.textContent = labels[k];\n+        node.appendChild(text);\n+      }\n+      node.appendChild(icon);\n+      return node;\n+    }\n   }\n \n   /**\n\ndiff --git a/packages/filebrowser/style/base.css b/packages/filebrowser/style/base.css\nindex 81831eae822e..2da8824abbd2 100644\n--- a/packages/filebrowser/style/base.css\n+++ b/packages/filebrowser/style/base.css\n@@ -151,6 +151,41 @@\n   flex: 1 0 70px;\n   border-left: var(--jp-border-width) solid var(--jp-border-color2);\n   text-align: right;\n+  /* stylelint-disable */\n+  container-type: inline-size;\n+  /* stylelint-enable */\n+}\n+\n+/**\n+ * Use container queries (not yet supported by our version of stylelint)\n+ * to display either a small or large header for the last-modified column.\n+ */\n+/* stylelint-disable */\n+@container (max-width: 300px) {\n+  /* stylelint-enable */\n+  .jp-DirListing-headerItem.jp-id-modified\n+    > .jp-DirListing-headerItemText.jp-DirListing-headerItemText-small {\n+    display: inline;\n+  }\n+\n+  .jp-DirListing-headerItem.jp-id-modified\n+    > .jp-DirListing-headerItemText.jp-DirListing-headerItemText-large {\n+    display: none;\n+  }\n+}\n+\n+/* stylelint-disable */\n+@container (min-width: 300px) {\n+  /* stylelint-enable */\n+  .jp-DirListing-headerItem.jp-id-modified\n+    > .jp-DirListing-headerItemText.jp-DirListing-headerItemText-small {\n+    display: none;\n+  }\n+\n+  .jp-DirListing-headerItem.jp-id-modified\n+    > .jp-DirListing-headerItemText.jp-DirListing-headerItemText-large {\n+    display: inline;\n+  }\n }\n \n .jp-DirListing-headerItem.jp-id-filesize {\n",
    "test_patch": "diff --git a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png\nindex c1924e8171df..350bb1832da3 100644\nBinary files a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png and b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png\nindex e6b76abbf3e4..9dafcfb0e774 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png\nindex b3d175e0a084..1a11b772fea0 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png\nindex b2953e174193..da8e6b8a8e1e 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png\nindex aa69be36c8e7..d3bd8de17932 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png\nindex 6ec8019dc81d..0e72aaf94293 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png\nindex 30feac6ff635..460ce150895e 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png\nindex bbe110710c73..d2855e3cedf0 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png\nindex 5abe2b7302ba..bcb50c40eae4 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png\nindex 2a25ead98376..f91bf0da82bc 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png\nindex d99f0614eec1..54a62bf76c51 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex 942e63c99619..1b6f6272d634 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png\nindex 6e8ef64442ff..ea9f03589c4a 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png\nindex 7172a6b20bf7..c3d40a1dba7b 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png\nindex 6d7300009163..752093fe1e8d 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png\nindex b11203342337..da6a1b96c35b 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png\nindex d591bc22bd9c..951c71f8bb6f 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png\nindex ba09379857ae..c215da7081ba 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16199",
    "pr_id": 16199,
    "issue_id": 16194,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Search/filter boxes no longer autofocus in modal\n## Description\r\n\r\nThe modal for quickly switching between tabs, one of the signature features of 4.2.0 release, is no longer usable after https://github.com/jupyterlab/jupyterlab/pull/16046 was merged. In addition to the issue described in https://github.com/jupyterlab/jupyterlab/issues/16193, the focus is not properly set on the filter box in the modal any longer and even worse it is preserved on the items which are in the becakground.\r\n\r\n## Reproduce\r\n\r\n![focus-issue](https://github.com/jupyterlab/jupyterlab/assets/5832902/e03ad446-b562-40ea-a10d-01e6e8f7944d)\r\n\r\n\r\n## Expected behavior\r\n\r\nWe can press ctrl + alt + a and type to filter imemdiately.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.2.0b2",
    "issue_word_count": 117,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/documentation/general.test.ts",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "packages/running/src/index.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png"
    ],
    "base_commit": "54fe0d125f796b5d0f8c84edaf66941895c7a180",
    "head_commit": "55b32a11970433828ea0c4c586cce17695a81548",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16199",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16199",
    "dockerfile": "",
    "pr_merged_at": "2024-04-19T15:09:47.000Z",
    "patch": "diff --git a/packages/running/src/index.tsx b/packages/running/src/index.tsx\nindex ba647eeeda88..d02b9ae0be10 100644\n--- a/packages/running/src/index.tsx\n+++ b/packages/running/src/index.tsx\n@@ -975,7 +975,13 @@ export class SearchableSessions extends Panel {\n   private _forceFocusInput(): void {\n     this._filterWidget.renderPromise\n       ?.then(() => {\n-        this._filterWidget.node.querySelector('input')?.focus();\n+        const jpSearch = this._filterWidget.node.querySelector('jp-search');\n+        const input = jpSearch?.shadowRoot?.querySelector('input');\n+        if (!input) {\n+          console.warn('Input element not found, cannot focus');\n+          return;\n+        }\n+        input.focus();\n       })\n       .catch(console.warn);\n   }\n",
    "test_patch": "diff --git a/galata/test/documentation/general.test.ts b/galata/test/documentation/general.test.ts\nindex 0c203665aa71..e5566bc44ae8 100644\n--- a/galata/test/documentation/general.test.ts\n+++ b/galata/test/documentation/general.test.ts\n@@ -603,6 +603,11 @@ test.describe('General', () => {\n     await page.click('jp-button[data-command=\"running:show-modal\"]');\n     await freeezeKernelIds();\n \n+    // Playwright uses shadow-piercing selectors so this works with webcomponents too\n+    await expect\n+      .soft(page.locator('.jp-SearchableSessions-modal input'))\n+      .toBeFocused();\n+\n     expect(\n       await page\n         .locator('.jp-SearchableSessions-modal .jp-Dialog-content')\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png\nindex 0adb7da74be2..ecc496f09a0f 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16188",
    "pr_id": 16188,
    "issue_id": 15103,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Kernel sidebar state is inconsistent, slow to update, makes tests flaky\n## Description\r\n\r\nI saw this a couple of times, for example [here](https://github.com/jupyterlab/jupyterlab/actions/runs/6130672040/job/16648118565?pr=15101). It appears that one of the tests which runs in the group before it is not shutting its kernel down properly, leading to a dangling kernel.\r\n\r\n```\r\nError:   1) [jupyterlab] â€º test/jupyterlab/sidebars.test.ts:31:9 â€º Sidebars â€º Open Sidebar tab jp-running-sessions \r\n    Error: Screenshot comparison failed:\r\n\r\n      395 pixels (ratio 0.01 of all image pixels) are different.\r\n\r\n    Expected: /home/runner/work/jupyterlab/jupyterlab/galata/test-results/test-jupyterlab-sidebars-Sidebars-Open-Sidebar-tab-jp-running-sessions-jupyterlab/opened-sidebar-jp-running-sessions-expected.png\r\n    Received: /home/runner/work/jupyterlab/jupyterlab/galata/test-results/test-jupyterlab-sidebars-Sidebars-Open-Sidebar-tab-jp-running-sessions-jupyterlab/opened-sidebar-jp-running-sessions-actual.png\r\n        Diff: /home/runner/work/jupyterlab/jupyterlab/galata/test-results/test-jupyterlab-sidebars-Sidebars-Open-Sidebar-tab-jp-running-sessions-jupyterlab/opened-sidebar-jp-running-sessions-diff.png\r\n\r\n      36 |       const position = await page.sidebar.getTabPosition(sidebarId);\r\n      37 |       const sidebar = await page.sidebar.getContentPanel(position);\r\n    > 38 |       expect(await sidebar.screenshot()).toMatchSnapshot(\r\n         |                                          ^\r\n      39 |         imageName.toLowerCase()\r\n      40 |       );\r\n      41 |     });\r\n\r\n        at /home/runner/work/jupyterlab/jupyterlab/galata/test/jupyterlab/sidebars.test.ts:38:42\r\n```\r\n\r\n\r\n| Actual | Expected |\r\n|--------|--------|\r\n| ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/82417132-b2ee-4056-acac-ee5de16e83d4) | ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/ce7e1f40-9cea-47ef-9c75-519b964edb2e) |\r\n",
    "issue_word_count": 242,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png",
      "packages/running-extension/src/kernels.tsx",
      "packages/running/src/index.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png"
    ],
    "base_commit": "2ceabd8c7b98e7b2c305be406ade799f387a90eb",
    "head_commit": "93b7705be3a9436deb57d08c7e9254fc60bff26a",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16188",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16188",
    "dockerfile": "",
    "pr_merged_at": "2024-04-19T18:07:07.000Z",
    "patch": "diff --git a/packages/running-extension/src/kernels.tsx b/packages/running-extension/src/kernels.tsx\nindex 5da60faeba93..ea85fd22efd3 100644\n--- a/packages/running-extension/src/kernels.tsx\n+++ b/packages/running-extension/src/kernels.tsx\n@@ -325,13 +325,17 @@ namespace Private {\n \n     private get _summary(): string {\n       const children = this.children;\n-      return children.length == 1\n-        ? children[0].label()\n-        : this.trans.__(\n-            '%1 and %2 more',\n-            children[0].label(),\n-            children.length - 1\n-          );\n+      if (children.length === 0) {\n+        return this.trans.__('No sessions connected');\n+      } else if (children.length == 1) {\n+        return children[0].label();\n+      } else {\n+        return this.trans.__(\n+          '%1 and %2 more',\n+          children[0].label(),\n+          children.length - 1\n+        );\n+      }\n     }\n   }\n \n\ndiff --git a/packages/running/src/index.tsx b/packages/running/src/index.tsx\nindex ba647eeeda88..ebc82d9ce19b 100644\n--- a/packages/running/src/index.tsx\n+++ b/packages/running/src/index.tsx\n@@ -305,7 +305,6 @@ function List(props: {\n   child?: boolean;\n   runningItems: IRunningSessions.IRunningItem[];\n   shutdownLabel?: string | ((item: IRunningSessions.IRunningItem) => string);\n-  shutdownAllLabel?: string;\n   shutdownItemIcon?: LabIcon;\n   filter?: (item: IRunningSessions.IRunningItem) => Partial<IScore> | null;\n   translator?: ITranslator;\n@@ -420,7 +419,6 @@ class ListWidget extends ReactWidget {\n     private _options: {\n       manager: IRunningSessions.IManager;\n       runningItems: IRunningSessions.IRunningItem[];\n-      shutdownAllLabel: string;\n       filterProvider?: IFilterProvider;\n       translator?: ITranslator;\n       collapseToggled: ISignal<Section, boolean>;\n@@ -461,7 +459,6 @@ class ListWidget extends ReactWidget {\n               <List\n                 runningItems={options.runningItems}\n                 shutdownLabel={options.manager.shutdownLabel}\n-                shutdownAllLabel={options.shutdownAllLabel}\n                 shutdownItemIcon={options.manager.shutdownItemIcon}\n                 filter={options.filterProvider?.filter}\n                 translator={options.translator}\n@@ -539,7 +536,6 @@ class Section extends PanelWithToolbar {\n     this.addWidget(\n       new ListWidget({\n         runningItems,\n-        shutdownAllLabel: this._shutdownAllLabel,\n         collapseToggled: this._collapseToggled,\n         ...options\n       })\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png\nindex 403d94a169dd..96151e8fcaba 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16156",
    "pr_id": 16156,
    "issue_id": 16150,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`Enter` key does not accept a completion in 4.2.0b1\n## Description\r\n\r\n> I invoke the completion with tab as usual which works fine, also tabbing through works as expected. But the only way to select something is by clicking with the mouse. With the keyboard I can just type or press escape to close the completer.\r\n>\r\n> Originally reported by @spookster on https://discourse.jupyter.org/t/jupyterlab-4-2-beta-is-available-for-testing/25097/2\r\n\r\n## Reproduce\r\n\r\n![enter-does-not-work](https://github.com/jupyterlab/jupyterlab/assets/5832902/1829610e-bd8d-475e-98c6-accd452741a3)\r\n\r\n## Expected behavior\r\n\r\n- Enter accepts the completion\r\n- We have an integration test case for this\r\n\r\n## Context\r\n\r\nIt works well in 4.2.0b0 so it looks like this was introduced as a side-effect of lumino upgrade in https://github.com/jupyterlab/jupyterlab/pull/16078 and was not picked up by the tests.",
    "issue_word_count": 145,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/completer.test.ts",
      "packages/codemirror/src/commands.ts",
      "packages/codemirror/src/extension.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/completer.test.ts"
    ],
    "base_commit": "f7e5022946d0b8437f076484ef717e9e66cadc8c",
    "head_commit": "3fd5cdc8262725e9d94252f52414be26668b4422",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16156",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16156",
    "dockerfile": "",
    "pr_merged_at": "2024-04-15T09:07:44.000Z",
    "patch": "diff --git a/packages/codemirror/src/commands.ts b/packages/codemirror/src/commands.ts\nindex 486bb88ac4ad..20e09080ab2b 100644\n--- a/packages/codemirror/src/commands.ts\n+++ b/packages/codemirror/src/commands.ts\n@@ -74,8 +74,8 @@ export namespace StateCommands {\n     dispatch: (transaction: Transaction) => void;\n   }): boolean {\n     if (target.dom.parentElement?.classList.contains(COMPLETER_ACTIVE_CLASS)) {\n-      // return true to avoid handling the default Enter from codemirror defaultKeymap.\n-      return true;\n+      // do not prevent default to allow completer `enter` action\n+      return false;\n     }\n \n     const arg = { state: target.state, dispatch: target.dispatch };\n\ndiff --git a/packages/codemirror/src/extension.ts b/packages/codemirror/src/extension.ts\nindex 81e085abada0..34fddc1d7ce3 100644\n--- a/packages/codemirror/src/extension.ts\n+++ b/packages/codemirror/src/extension.ts\n@@ -726,12 +726,15 @@ export namespace EditorExtensionRegistry {\n             //   as these as handled by lumino command\n             // - Disable Escape handler because it prevents default and we\n             //   want to run a cell action (switch to command mode) on Esc\n+            // - Disable default Enter handler because it prevents us from\n+            //   accepting a completer suggestion with Enter.\n             return ![\n               'Mod-Enter',\n               'Shift-Mod-k',\n               'Mod-/',\n               'Alt-A',\n-              'Escape'\n+              'Escape',\n+              'Enter'\n             ].includes(binding.key as string);\n           }),\n           {\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/completer.test.ts b/galata/test/jupyterlab/completer.test.ts\nindex fa391b63e308..adc2e8c41581 100644\n--- a/galata/test/jupyterlab/completer.test.ts\n+++ b/galata/test/jupyterlab/completer.test.ts\n@@ -13,7 +13,9 @@ test.describe('Completer', () => {\n       await page.notebook.createNew(fileName);\n     });\n \n-    test('Open completer on notebook', async ({ page }) => {\n+    test('Open completer on notebook and accept suggestion', async ({\n+      page\n+    }) => {\n       await page.notebook.setCell(\n         0,\n         'code',\n@@ -35,7 +37,11 @@ test.describe('Completer', () => {\n       completer = page.locator(COMPLETER_SELECTOR);\n       await completer.waitFor();\n       const imageName = 'completer.png';\n-      expect(await completer.screenshot()).toMatchSnapshot(imageName);\n+      expect.soft(await completer.screenshot()).toMatchSnapshot(imageName);\n+      // Accept the completion\n+      await page.keyboard.press('Enter');\n+      const textAfter = await page.notebook.getCellTextInput(1);\n+      expect(textAfter).toBe('option_1');\n     });\n \n     test('Show documentation panel', async ({ page, tmpPath }) => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16149",
    "pr_id": 16149,
    "issue_id": 16147,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "\"Open recent\" menu not displaying on startup without open document\n## Description\r\n\r\nIf i load into the lab with just having the launcher or just a terminal window open the newly introduced \"Open recent\" menu is not properly working.\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/112409139/c4a87266-5091-4c8c-aa1f-e64196013c79)\r\n\r\n## Reproduce\r\n\r\n1. Just have a terminal or launcher open.\r\n2. Reload/Close and open again\r\n3. Try to open the \"Open recent\" menu.\r\n4. (If you open a notebook/document/image... the menu starts working)\r\n\r\n## Expected behavior\r\n\r\nShould work from the get-go without open document?\r\n\r\n## Context\r\n\r\n- Operating System and version: Archlinux\r\n- Browser and version: current Chrome\r\n- JupyterLab version: 4.2.0b1",
    "issue_word_count": 113,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "packages/docmanager-extension/src/recents.ts",
      "packages/docmanager/src/recents.ts",
      "packages/docmanager/test/recents.spec.ts",
      "packages/mainmenu-extension/src/recents.ts"
    ],
    "pr_changed_test_files": [
      "packages/docmanager/test/recents.spec.ts"
    ],
    "base_commit": "62dcce81e6cb3466b9e75a2b93f266ad6982e99d",
    "head_commit": "02625d019688854e8ef6211f98795392f2bf17db",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16149",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16149",
    "dockerfile": "",
    "pr_merged_at": "2024-04-16T08:44:28.000Z",
    "patch": "diff --git a/packages/docmanager-extension/src/recents.ts b/packages/docmanager-extension/src/recents.ts\nindex 24a3341f52f7..7561becbef83 100644\n--- a/packages/docmanager-extension/src/recents.ts\n+++ b/packages/docmanager-extension/src/recents.ts\n@@ -67,6 +67,9 @@ export const recentsManagerPlugin: JupyterFrontEndPlugin<IRecentsManager> = {\n       execute: () => {\n         recentsManager.clearRecents();\n       },\n+      isEnabled: () =>\n+        recentsManager.recentlyOpened.length != 0 ||\n+        recentsManager.recentlyClosed.length != 0,\n       label: trans.__('Clear Recent Documents'),\n       caption: trans.__('Clear the list of recently opened items.')\n     });\n\ndiff --git a/packages/docmanager/src/recents.ts b/packages/docmanager/src/recents.ts\nindex eaef2f5dcd29..e6fad90bcb7e 100644\n--- a/packages/docmanager/src/recents.ts\n+++ b/packages/docmanager/src/recents.ts\n@@ -218,6 +218,7 @@ export class RecentsManager implements IRecentsManager {\n         type as 'opened' | 'closed'\n       );\n     }\n+    this._recentsChanged.emit(undefined);\n   }\n \n   /**\n\ndiff --git a/packages/mainmenu-extension/src/recents.ts b/packages/mainmenu-extension/src/recents.ts\nindex b83670051e9a..ce266771044a 100644\n--- a/packages/mainmenu-extension/src/recents.ts\n+++ b/packages/mainmenu-extension/src/recents.ts\n@@ -52,6 +52,7 @@ class RecentsMenu extends Menu {\n     super(options);\n     this._manager = options.manager;\n     this._showDirectories = options.showDirectories;\n+    this.updateItems();\n     this._manager.changed.connect(this.updateItems, this);\n   }\n \n@@ -230,7 +231,7 @@ export const recentsMenuPlugin: JupyterFrontEndPlugin<void> = {\n     });\n     submenu.title.label = trans.__('Open Recent');\n     mainMenu.fileMenu.addItem({\n-      type: 'submenu' as Menu.ItemType,\n+      type: 'submenu',\n       submenu,\n       rank: 1\n     });\n",
    "test_patch": "diff --git a/packages/docmanager/test/recents.spec.ts b/packages/docmanager/test/recents.spec.ts\nindex f19564842f6a..2db411e8b326 100644\n--- a/packages/docmanager/test/recents.spec.ts\n+++ b/packages/docmanager/test/recents.spec.ts\n@@ -46,6 +46,19 @@ describe('@jupyterlab/docmanager', () => {\n       it('should create a new recents manager', () => {\n         expect(manager).toBeInstanceOf(RecentsManager);\n       });\n+\n+      it('should emit `changed` signal after loading', async () => {\n+        const stateDB = new StateDB();\n+        const done = new PromiseDelegate<boolean>();\n+        manager = new TestRecentsManager({\n+          stateDB,\n+          contents: services.contents\n+        });\n+        manager.changed.connect(() => {\n+          done.resolve(true);\n+        });\n+        expect(await done.promise).toBe(true);\n+      });\n     });\n \n     describe('#isDisposed', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16142",
    "pr_id": 16142,
    "issue_id": 16108,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Items in main menu bar slightly too low\nIn Notebook 7.1 and Lab 4.2 beta, items in main menu bar are 1â€“2 pixels below the center.\r\n\r\nIn JupyterLab (top) and Jupyter Notebook (bottom) you can see that the pulldown menus have a very similar appearance.\r\n\r\n![image](https://github.com/jupyter/notebook/assets/93281816/bf9c62f7-c37f-427a-b4c3-824a57c63979)\r\n\r\nThe code seems to be imported from the `@jupyterlab/application` package:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/41be86d5142a793ab9cb8b9eb99f92a33c8dc441/packages/application/style/menus.css#L33-L39\r\n\r\nThis was originally found by @ellisonbg during a bug bash for Notebook 7.0.0a17, and reported in https://github.com/jupyter/notebook/issues/6786 .\r\n",
    "issue_word_count": 111,
    "test_files_count": 19,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "packages/application/style/menus.css"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png"
    ],
    "base_commit": "5cfcae170275c4d7f5a60ba8df66d58b7b6df9a1",
    "head_commit": "8d3de17a45ab0290bf43c847396feef70c589f0f",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16142",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16142",
    "dockerfile": "",
    "pr_merged_at": "2024-04-11T21:21:14.000Z",
    "patch": "diff --git a/examples/app/example.spec.ts-snapshots/example-linux.png b/examples/app/example.spec.ts-snapshots/example-linux.png\nindex d00c941fd39d..743ac7ca6963 100644\nBinary files a/examples/app/example.spec.ts-snapshots/example-linux.png and b/examples/app/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/federated/example.spec.ts-snapshots/example-linux.png b/examples/federated/example.spec.ts-snapshots/example-linux.png\nindex 12e5e721c5db..de92b82f4ac5 100644\nBinary files a/examples/federated/example.spec.ts-snapshots/example-linux.png and b/examples/federated/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/packages/application/style/menus.css b/packages/application/style/menus.css\nindex 132e65c9ceb6..f1676c3ca20f 100644\n--- a/packages/application/style/menus.css\n+++ b/packages/application/style/menus.css\n@@ -35,7 +35,9 @@\n   border-left: var(--jp-border-width) solid transparent;\n   border-right: var(--jp-border-width) solid transparent;\n   border-top: var(--jp-border-width) solid transparent;\n-  line-height: calc(var(--jp-private-menubar-height) - var(--jp-border-width));\n+  line-height: calc(\n+    var(--jp-private-menubar-height) - var(--jp-border-width) * 2\n+  );\n }\n \n .lm-MenuBar-content:focus-visible {\n",
    "test_patch": "diff --git a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\nindex 75a69b5f878e..a772b2425c19 100644\n--- a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n+++ b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n@@ -257,6 +257,38 @@\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n+  {\n+    \"id\": \"codemirror:delete-line\",\n+    \"label\": \"Delete the current line\",\n+    \"caption\": \"\",\n+    \"shortcuts\": [\n+      \"Ctrl D\"\n+    ]\n+  },\n+  {\n+    \"id\": \"codemirror:select-next-occurrence\",\n+    \"label\": \"Select Next Occurrence\",\n+    \"caption\": \"\",\n+    \"shortcuts\": [\n+      \"Ctrl Shift D\"\n+    ]\n+  },\n+  {\n+    \"id\": \"codemirror:toggle-block-comment\",\n+    \"label\": \"Toggle Block Comment\",\n+    \"caption\": \"Toggles block commends in languages which support it (e.g. C, JavaScript)\",\n+    \"shortcuts\": [\n+      \"Alt A\"\n+    ]\n+  },\n+  {\n+    \"id\": \"codemirror:toggle-comment\",\n+    \"label\": \"Toggle Comment\",\n+    \"caption\": \"\",\n+    \"shortcuts\": [\n+      \"Ctrl /\"\n+    ]\n+  },\n   {\n     \"id\": \"completer:invoke-console\",\n     \"label\": \"Display the completion helper.\",\n@@ -2215,6 +2247,36 @@\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n+  {\n+    \"id\": \"shortcuts:add-keybinding\",\n+    \"label\": \"Add Keybinding\",\n+    \"caption\": \"Add new keybinding for existing shortcut target\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"shortcuts:delete-keybinding\",\n+    \"label\": \"Delete Keybinding\",\n+    \"caption\": \"Delete chosen keybinding\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"shortcuts:edit-keybinding\",\n+    \"label\": \"Edit Keybinding\",\n+    \"caption\": \"Edit existing keybinding\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"shortcuts:reset-all\",\n+    \"label\": \"Reset All\",\n+    \"caption\": \"Reset all shortcuts\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"shortcuts:toggle-selectors\",\n+    \"label\": \"Toggle Selectors\",\n+    \"caption\": \"Toggle command selectors\",\n+    \"shortcuts\": []\n+  },\n   {\n     \"id\": \"sidebar:switch\",\n     \"label\": \"Switch Sidebar Side\",\n\ndiff --git a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png\nindex 7462910c79a0..9f7eb9be3295 100644\nBinary files a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png and b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png\nindex 6f79868a3e40..01cfc829ae44 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-context-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png\nindex 9802e71cc01d..9816dcc5f650 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png\nindex a8c0d6966ec0..dd525a076b53 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-context-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png\nindex b2fa65aa0553..657d4cbd1591 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png\nindex 7d9df06ef503..eb7d4a950070 100644\nBinary files a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png and b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-slide-type-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png\nindex 71e4f5529bed..091fd8fe2ecb 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-editor-overview-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png\nindex 63e2c59482d6..559e915990e2 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-formats-open-with-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png\nindex 5e2ad9f98cec..6dcd61cd1d21 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/files-shareable-link-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png\nindex 1d18e1f505cc..888cf05025c9 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png\nindex 03542ba99af0..4b3639f569f6 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex 90fdecd90f92..772e420ec9b8 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\nindex ef0af6e711ad..c43f88cef0d7 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n@@ -44,6 +44,7 @@\n   \"@jupyterlab/apputils-extension:workspaces\": \"Add workspace file type.\",\n   \"@jupyterlab/cell-toolbar-extension:plugin\": \"Add the cells toolbar.\",\n   \"@jupyterlab/celltags-extension:plugin\": \"Adds the cell tags editor.\",\n+  \"@jupyterlab/codemirror-extension:commands\": \"Registers commands acting on selected/active CodeMirror editor.\",\n   \"@jupyterlab/codemirror-extension:languages\": \"Provides the CodeMirror languages registry.\",\n   \"@jupyterlab/codemirror-extension:themes\": \"Provides the CodeMirror theme registry\",\n   \"@jupyterlab/codemirror-extension:binding\": \"Register the CodeMirror extension factory binding the editor and the shared model.\",\n@@ -166,6 +167,7 @@\n   \"@jupyterlab/statusbar-extension:plugin\": \"Provides the application status bar.\",\n   \"@jupyterlab/terminal-extension:plugin\": \"Adds terminal and provides its tracker.\",\n   \"@jupyterlab/theme-dark-extension:plugin\": \"Adds a dark theme.\",\n+  \"@jupyterlab/theme-dark-high-contrast-extension:plugin\": \"Adds a dark high contrast theme.\",\n   \"@jupyterlab/theme-light-extension:plugin\": \"Adds a light theme.\",\n   \"@jupyterlab/toc-extension:registry\": \"Provides the table of contents registry.\",\n   \"@jupyterlab/toc-extension:tracker\": \"Adds the table of content widget and provides its tracker.\",\n\ndiff --git a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png\nindex 146b15d15893..85ad0da98f2e 100644\nBinary files a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png and b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png\nindex 04d8416c230f..aa40a55546c4 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png\nindex 4085a129b53d..ce5a680d9c10 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png\nindex d3dc1c84fddf..6222ab3aed00 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png\nindex 1a6749018238..19e2ac76426e 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16105",
    "pr_id": 16105,
    "issue_id": 227,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Improve notebook toolbar design\n## Summary\n- Style cell type and kernel dropdowns\n- Clean up vertical height and line-height\n- Possibly add separators\n## Original comment\n\nWe (@spoorthyv @charnpreetsingh185 @katiewhite360) have created a mockup of the updated notebook toolbar and would like some feedback. \n\nWe replaced the icons with google's material icons because not only are they more visually appealing, but they are also more intuitive than some of the current icons. \n\nWe also added sections to the toolbar to add visual separation between the icons. We placed run kernel, interrupt kernel, and restart kernel in one section. Cut cells, copy cells, and paste cells are placed in another section. \n\nWe moved the kernel functions (run kernel, intterupt kernel, etc.) to after the add new cell icon because they will be used more often than the cut, copy, paste icons. We placed them closer to the left because of their higher importance.\n\nDuring our user tests of we noticed that when multiple users would try to change kernels, they would click the top right kernel label in the toolbar multiple times because they thought it was a dropdown. We decided to change it to actually be a dropdown where you can change kernels.\n\nWe also want to add an indicator of when the file has been saved so there is some kind of reaction when the save button is clicked. We placed that indicator after the \"Markdown\" dropdown.\n\nLet us know what you think!\n\nOriginal notebook toolbar:\n![screen shot 2016-07-05 at 9 55 42 am](https://cloud.githubusercontent.com/assets/19479586/16593978/dd355a94-429c-11e6-85d3-119ee48a6022.png)\n\nOur mockup:\n![artboard 6 2x](https://cloud.githubusercontent.com/assets/19479586/16594059/58a49294-429d-11e6-849a-5b1eacb9f2cd.png)\n",
    "issue_word_count": 286,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml",
      "pyproject.toml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "6c83ad3b80b634793e7c3eaa18300759309cc5a8",
    "head_commit": "adffb3b0ad72752d901ab1ab6a4f2144e65e8a70",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16105",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16105",
    "dockerfile": "",
    "pr_merged_at": "2024-04-03T19:42:08.000Z",
    "patch": "diff --git a/pyproject.toml b/pyproject.toml\nindex d1b7a3671b40..6c90dc69f976 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -39,7 +39,7 @@ dependencies = [\n     \"httpx>=0.25.0\",\n     \"importlib-metadata>=4.8.3;python_version<\\\"3.10\\\"\",\n     \"importlib-resources>=1.4;python_version<\\\"3.9\\\"\",\n-    \"ipykernel\",\n+    \"ipykernel>=6.5.0\",\n     \"jinja2>=3.0.3\",\n     \"jupyter_core\",\n     \"jupyter_server>=2.4.0,<3\",\n@@ -47,9 +47,9 @@ dependencies = [\n     \"jupyterlab_server>=2.19.0,<3\",\n     \"notebook_shim>=0.2\",\n     \"packaging\",\n-    \"tomli;python_version<\\\"3.11\\\"\",\n+    \"tomli>=1.2.2;python_version<\\\"3.11\\\"\",\n     \"tornado>=6.2.0\",\n-    \"traitlets\",\n+    \"traitlets>=3.0\",\n ]\n dynamic = [\n     \"version\",\n",
    "test_patch": "diff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex 3fe452ce5b49..10e68c560c30 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -89,8 +89,7 @@ jobs:\n         uses: jupyterlab/maintainer-tools/.github/actions/base-setup@v1\n         with:\n           python_version: \"3.8\"\n-      - name: Install minimum versions\n-        uses: jupyterlab/maintainer-tools/.github/actions/install-minimums@v1\n+          dependency_type: minimum\n       - name: Install dependencies\n         run: |\n           bash ./scripts/ci_install.sh\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16098",
    "pr_id": 16098,
    "issue_id": 16079,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Shortcuts sorting needs a test\nA test for sorting of shortcuts in the shortcuts table UI:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/18a0b51c-c073-4cb6-a750-f210fbaa129c)\r\n\r\ncould be added in:\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/5af2cc9346a49bc1354448a547413937ab754b56/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts#L47\r\n\r\nit would be good to test sorting by each of the sortable columns (category, column, source, selectors).",
    "issue_word_count": 66,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "packages/shortcuts-extension/test/components/ShortcutUI.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/shortcuts-extension/test/components/ShortcutUI.spec.ts"
    ],
    "base_commit": "41be86d5142a793ab9cb8b9eb99f92a33c8dc441",
    "head_commit": "26dc23cbef2e771ddaa31ffe2d9da0654af3af59",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16098",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16098",
    "dockerfile": "",
    "pr_merged_at": "2024-04-03T12:47:48.000Z",
    "patch": "",
    "test_patch": "diff --git a/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts b/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\nindex f1ae75a58915..4927c6ba42d6 100644\n--- a/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\n+++ b/packages/shortcuts-extension/test/components/ShortcutUI.spec.ts\n@@ -297,5 +297,153 @@ describe('@jupyterlab/shortcut-extension', () => {\n         expect(data.user.shortcuts).toHaveLength(1);\n       });\n     });\n+\n+    describe('#sortShortcuts()', () => {\n+      let mockedFilteredShortcutList: IShortcutTarget[];\n+      beforeEach(() => {\n+        mockedFilteredShortcutList = [\n+          {\n+            id: '1',\n+            label: 'Zebra',\n+            command: 'Zebra',\n+            selector: 'Zebra',\n+            category: 'Zebra',\n+            keybindings: [{ keys: ['Ctrl+Z', 'Z'], isDefault: false }],\n+            args: undefined\n+          },\n+          {\n+            id: '2',\n+            label: 'Apple',\n+            command: 'Apple',\n+            selector: 'Apple',\n+            category: 'Apple',\n+            keybindings: [{ keys: ['Shift+A', 'A'], isDefault: true }],\n+            args: undefined\n+          },\n+          {\n+            id: '3',\n+            label: 'Banana',\n+            command: 'Banana',\n+            selector: 'Banana',\n+            category: 'Banana',\n+            keybindings: [{ keys: ['Ctrl+B', 'B'], isDefault: false }],\n+            args: undefined\n+          },\n+          {\n+            id: '4',\n+            label: 'Tomato',\n+            command: 'Tomato',\n+            selector: 'Tomato',\n+            category: 'Tomato',\n+            keybindings: [{ keys: ['Tab+T', 'T'], isDefault: true }],\n+            args: undefined\n+          }\n+        ];\n+      });\n+\n+      it('should test sort by the `category` column', () => {\n+        shortcutUI.state = {\n+          ...shortcutUI.state,\n+          currentSort: 'category',\n+          filteredShortcutList: mockedFilteredShortcutList\n+        };\n+\n+        expect(shortcutUI.state.filteredShortcutList[0].category).not.toBe(\n+          'Apple'\n+        );\n+        shortcutUI.sortShortcuts();\n+        expect(shortcutUI.state.filteredShortcutList[0].category).toBe('Apple');\n+        expect(shortcutUI.state.filteredShortcutList[1].category).toBe(\n+          'Banana'\n+        );\n+        expect(shortcutUI.state.filteredShortcutList[2].category).toBe(\n+          'Tomato'\n+        );\n+        expect(shortcutUI.state.filteredShortcutList[3].category).toBe('Zebra');\n+      });\n+\n+      it('should test sort by the `command` column', () => {\n+        shortcutUI.state = {\n+          ...shortcutUI.state,\n+          currentSort: 'command',\n+          filteredShortcutList: mockedFilteredShortcutList\n+        };\n+\n+        expect(shortcutUI.state.filteredShortcutList[0].label).not.toBe(\n+          'Apple'\n+        );\n+        shortcutUI.sortShortcuts();\n+        expect(shortcutUI.state.filteredShortcutList[0].label).toBe('Apple');\n+        expect(shortcutUI.state.filteredShortcutList[1].label).toBe('Banana');\n+        expect(shortcutUI.state.filteredShortcutList[2].label).toBe('Tomato');\n+        expect(shortcutUI.state.filteredShortcutList[3].label).toBe('Zebra');\n+      });\n+\n+      it('should test sort by the `selector` column', () => {\n+        shortcutUI.state = {\n+          ...shortcutUI.state,\n+          currentSort: 'selector',\n+          filteredShortcutList: mockedFilteredShortcutList\n+        };\n+\n+        expect(shortcutUI.state.filteredShortcutList[0].selector).not.toBe(\n+          'Apple'\n+        );\n+        shortcutUI.sortShortcuts();\n+        expect(shortcutUI.state.filteredShortcutList[0].selector).toBe('Apple');\n+        expect(shortcutUI.state.filteredShortcutList[1].selector).toBe(\n+          'Banana'\n+        );\n+        expect(shortcutUI.state.filteredShortcutList[2].selector).toBe(\n+          'Tomato'\n+        );\n+        expect(shortcutUI.state.filteredShortcutList[3].selector).toBe('Zebra');\n+      });\n+\n+      it('should test sort by the `source` column', () => {\n+        shortcutUI.state = {\n+          ...shortcutUI.state,\n+          currentSort: 'source',\n+          filteredShortcutList: mockedFilteredShortcutList\n+        };\n+\n+        expect(\n+          shortcutUI.state.filteredShortcutList[0].keybindings.every(\n+            k => k.isDefault\n+          )\n+            ? 'default'\n+            : 'other'\n+        ).toBe('other');\n+        shortcutUI.sortShortcuts();\n+        expect(\n+          shortcutUI.state.filteredShortcutList[0].keybindings.every(\n+            k => k.isDefault\n+          )\n+            ? 'default'\n+            : 'other'\n+        ).toBe('default');\n+        expect(\n+          shortcutUI.state.filteredShortcutList[1].keybindings.every(\n+            k => k.isDefault\n+          )\n+            ? 'default'\n+            : 'other'\n+        ).toBe('default');\n+        expect(\n+          shortcutUI.state.filteredShortcutList[2].keybindings.every(\n+            k => k.isDefault\n+          )\n+            ? 'default'\n+            : 'other'\n+        ).toBe('other');\n+        expect(\n+          shortcutUI.state.filteredShortcutList[3].keybindings.every(\n+            k => k.isDefault\n+          )\n+            ? 'default'\n+            : 'other'\n+        ).toBe('other');\n+      });\n+    });\n   });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16072",
    "pr_id": 16072,
    "issue_id": 14947,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Flaky UI tests\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nThe `Visual Regression Tests` and `Visual Regression Documentation` CI checks are often flaky, which makes the CI checks appear as failing.\r\n\r\n## Reproduce\r\n\r\nExample run for https://github.com/jupyterlab/jupyterlab/pull/14944: https://github.com/jupyterlab/jupyterlab/actions/runs/5817952284/job/15773457526?pr=14944\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/591645/e59cfdf5-0345-4786-a953-2dd5f14c79e4)\r\n\r\n## Expected behavior\r\n\r\nThe check should not fail that often, so maintainers can review and merge PRs with more confidence.\r\n\r\n## Context\r\n\r\nFlaky tests lead to maintenance burden and CI fatigue on maintainers. One has to download the Playwright repo and carefully check the errors to assess whether the failure is related to the change.\r\n\r\nAlso other maintainers might not feel confident merging PRs if one of the checks is failing (which is understandable).",
    "issue_word_count": 170,
    "test_files_count": 2,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "galata/test/documentation/workspaces.test.ts",
      "galata/test/jupyterlab/readonly.test.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/workspaces.test.ts",
      "galata/test/jupyterlab/readonly.test.ts"
    ],
    "base_commit": "424806be842244ef50d86cdcd8d9d70456d74c50",
    "head_commit": "84d0f372d10c300c2c105cd6229b122df9094084",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16072",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16072",
    "dockerfile": "",
    "pr_merged_at": "2024-04-02T08:06:32.000Z",
    "patch": "",
    "test_patch": "diff --git a/galata/test/documentation/workspaces.test.ts b/galata/test/documentation/workspaces.test.ts\nindex a6fe049a35eb..ee6e02398249 100644\n--- a/galata/test/documentation/workspaces.test.ts\n+++ b/galata/test/documentation/workspaces.test.ts\n@@ -43,6 +43,8 @@ test.describe('Workspaces sidebar', () => {\n       )\n       .waitFor();\n \n+    await galata.Mock.mockRunners(page, new Map(), 'sessions');\n+\n     // Create additional workspaces for the shot\n     await page.evaluate(async () => {\n       for (const workspaceName of ['my-coding-space', 'default']) {\n\ndiff --git a/galata/test/jupyterlab/readonly.test.ts b/galata/test/jupyterlab/readonly.test.ts\nindex 7f427123d88d..b6fbf1411422 100644\n--- a/galata/test/jupyterlab/readonly.test.ts\n+++ b/galata/test/jupyterlab/readonly.test.ts\n@@ -7,8 +7,18 @@ import { expect, galata, test } from '@jupyterlab/galata';\n \n test.describe('test readonly status', () => {\n   test('test readonly status', async ({ page }) => {\n-    await galata.Mock.makeNotebookReadonly(page);\n     await page.notebook.createNew('notebook.ipynb');\n+    // We need to save the notebook to preserve the default kernel choice\n+    // otherwise when we reopen it, it would show \"Select Kernel\" dialog,\n+    // which adds a semi-transparent layer above the notification.\n+    const notSavedIndicator = page\n+      .getByRole('main')\n+      .getByRole('tablist')\n+      .locator('.jp-mod-dirty');\n+    await notSavedIndicator.waitFor();\n+    await page.notebook.save();\n+\n+    await galata.Mock.makeNotebookReadonly(page);\n \n     // have to open and close notebook for notification to show up\n     await page.notebook.close();\n@@ -18,10 +28,11 @@ test.describe('test readonly status', () => {\n \n     const imageName = 'readonly.png';\n     const toast = page.locator('.Toastify__toast');\n+    const toastAnimation = page.locator('.Toastify--animate');\n     await toast.waitFor({ state: 'attached' });\n-    // For some reason even `{animations: \"disabled\"}` is flaky.\n-    // Instead we just wait a short while.\n-    await page.waitForTimeout(2000);\n+    await toastAnimation.waitFor({ state: 'attached' });\n+    await toastAnimation.waitFor({ state: 'detached' });\n+\n     expect(await toast.screenshot()).toMatchSnapshot(imageName);\n   });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16070",
    "pr_id": 16070,
    "issue_id": 15965,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "One-pixel dotted line in active code cell\nIn the active cell, when zoomed to at least 100% and less than 300% on Firefox ESR 123 on macOS 13, a one-pixel dotted line appears in the inner border of the active cell.\r\n\r\nThe screen shot below was taken at 200% zoom and has been resized to 2x in each dimension:\r\n\r\n![dotted-line](https://github.com/jupyterlab/jupyterlab/assets/93281816/941d20f2-613f-4ae2-8d6d-4d3e97535b9a)\r\n\r\nAt higher zoom levels, the dotted line does not appear.",
    "issue_word_count": 85,
    "test_files_count": 6,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "examples/cell/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png",
      "galata/test/jupyterlab/completer.test.ts-snapshots/completer-filter-jupyterlab-linux.png",
      "galata/test/jupyterlab/completer.test.ts-snapshots/completer-jupyterlab-linux.png",
      "galata/test/jupyterlab/history.test.ts-snapshots/history-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-edit.test.ts-snapshots/split-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/run-cell-jupyterlab-linux.png",
      "packages/codemirror/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png",
      "galata/test/jupyterlab/completer.test.ts-snapshots/completer-filter-jupyterlab-linux.png",
      "galata/test/jupyterlab/completer.test.ts-snapshots/completer-jupyterlab-linux.png",
      "galata/test/jupyterlab/history.test.ts-snapshots/history-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-edit.test.ts-snapshots/split-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/run-cell-jupyterlab-linux.png"
    ],
    "base_commit": "424806be842244ef50d86cdcd8d9d70456d74c50",
    "head_commit": "0c541ab359044098ffb5032f057b7fdcee26679c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16070",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16070",
    "dockerfile": "",
    "pr_merged_at": "2024-03-29T12:52:15.000Z",
    "patch": "diff --git a/examples/cell/example.spec.ts-snapshots/example-linux.png b/examples/cell/example.spec.ts-snapshots/example-linux.png\nindex b4f97d61a7d2..f12bfb3ad1e7 100644\nBinary files a/examples/cell/example.spec.ts-snapshots/example-linux.png and b/examples/cell/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/packages/codemirror/style/base.css b/packages/codemirror/style/base.css\nindex f60476ca852c..cc3453146e54 100644\n--- a/packages/codemirror/style/base.css\n+++ b/packages/codemirror/style/base.css\n@@ -14,6 +14,11 @@\n   /* Changed to auto to autogrow */\n }\n \n+/* Suppress automatic focus indicator outline */\n+.cm-editor.cm-focused {\n+  outline: unset;\n+}\n+\n .cm-editor pre {\n   padding: 0 var(--jp-code-padding);\n }\n",
    "test_patch": "diff --git a/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png\nindex f22ff7a73e90..89b7f255f2a1 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-formats-html-display-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/completer.test.ts-snapshots/completer-filter-jupyterlab-linux.png b/galata/test/jupyterlab/completer.test.ts-snapshots/completer-filter-jupyterlab-linux.png\nindex 17ca32f2bb2c..04fca6342aa9 100644\nBinary files a/galata/test/jupyterlab/completer.test.ts-snapshots/completer-filter-jupyterlab-linux.png and b/galata/test/jupyterlab/completer.test.ts-snapshots/completer-filter-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/completer.test.ts-snapshots/completer-jupyterlab-linux.png b/galata/test/jupyterlab/completer.test.ts-snapshots/completer-jupyterlab-linux.png\nindex b7c303c429de..de740594f0e1 100644\nBinary files a/galata/test/jupyterlab/completer.test.ts-snapshots/completer-jupyterlab-linux.png and b/galata/test/jupyterlab/completer.test.ts-snapshots/completer-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/history.test.ts-snapshots/history-jupyterlab-linux.png b/galata/test/jupyterlab/history.test.ts-snapshots/history-jupyterlab-linux.png\nindex 85d6ca614369..05ca1e6e2fb6 100644\nBinary files a/galata/test/jupyterlab/history.test.ts-snapshots/history-jupyterlab-linux.png and b/galata/test/jupyterlab/history.test.ts-snapshots/history-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-edit.test.ts-snapshots/split-cell-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-edit.test.ts-snapshots/split-cell-jupyterlab-linux.png\nindex fee56510df93..dec8ad2da077 100644\nBinary files a/galata/test/jupyterlab/notebook-edit.test.ts-snapshots/split-cell-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-edit.test.ts-snapshots/split-cell-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/run-cell-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/run-cell-jupyterlab-linux.png\nindex 7fd1ee3ffa6f..c380395bc92f 100644\nBinary files a/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/run-cell-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/run-cell-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16069",
    "pr_id": 16069,
    "issue_id": 16067,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Typing in cells takes a lot of time on visual regression tests\nReducing the delay for typing can speed up the tests, see:\r\n\r\nwe could cut 15s out of 23s here:\r\n\r\n[c84eecd8bbcdbc0a1855eb89dae3fc12e93823d7.webm](https://github.com/jupyterlab/jupyterlab/assets/5832902/14f9757d-9b35-46fc-9ca4-f8e1f00c85a9)\r\n\r\nand 27s out of 36s here:\r\n\r\n[ab416e61e63473e7f0dc001735452e47d425fd07.webm](https://github.com/jupyterlab/jupyterlab/assets/5832902/b5e1cc81-723c-44f0-b253-d3efa592d26c)\r\n\r\nand so on.",
    "issue_word_count": 68,
    "test_files_count": 10,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "galata/README.md",
      "galata/src/helpers/notebook.ts",
      "galata/src/utils.ts",
      "galata/test/jupyterlab/collapsible-headings.test.ts",
      "galata/test/jupyterlab/html-viewer.test.ts",
      "galata/test/jupyterlab/notebook-markdown.test.ts",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts",
      "galata/test/jupyterlab/notebooks/collapsible_headings_keyboard_navigation.ipynb",
      "galata/test/jupyterlab/notebooks/test.html",
      "galata/test/jupyterlab/output-scrolling.test.ts",
      "galata/test/jupyterlab/toc-running.test.ts",
      "galata/test/jupyterlab/toc-scrolling.test.ts",
      "galata/test/jupyterlab/toc.test.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/collapsible-headings.test.ts",
      "galata/test/jupyterlab/html-viewer.test.ts",
      "galata/test/jupyterlab/notebook-markdown.test.ts",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts",
      "galata/test/jupyterlab/notebooks/collapsible_headings_keyboard_navigation.ipynb",
      "galata/test/jupyterlab/notebooks/test.html",
      "galata/test/jupyterlab/output-scrolling.test.ts",
      "galata/test/jupyterlab/toc-running.test.ts",
      "galata/test/jupyterlab/toc-scrolling.test.ts",
      "galata/test/jupyterlab/toc.test.ts"
    ],
    "base_commit": "424806be842244ef50d86cdcd8d9d70456d74c50",
    "head_commit": "6407e04571fde1736d0a7eb05d1e7c2a819ae0d8",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16069",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16069",
    "dockerfile": "",
    "pr_merged_at": "2024-04-02T13:49:42.000Z",
    "patch": "diff --git a/galata/README.md b/galata/README.md\nindex 85e62fd78d05..337238061822 100644\n--- a/galata/README.md\n+++ b/galata/README.md\n@@ -525,7 +525,7 @@ test('should return the active terminals', async ({ page, terminals }) => {\n \n - type: \\< string >\n \n-Unique test temporary path created on the server.\n+Unique test temporary path created on the server. Required if uploading files in `beforeAll()` as otherwise the files would not be accessible from consecutive tests because by default `tmpPath` has a random component added for each test.\n \n Note: if you override this string, you will need to take care of creating the\n folder and cleaning it.\n\ndiff --git a/galata/src/helpers/notebook.ts b/galata/src/helpers/notebook.ts\nindex 6bf4f4ecb495..e63919b80049 100644\n--- a/galata/src/helpers/notebook.ts\n+++ b/galata/src/helpers/notebook.ts\n@@ -1255,14 +1255,37 @@ export class NotebookHelper {\n \n     await this._setCellMode(cell, 'Edit');\n     await cell.getByRole('textbox').press('Control+A');\n-    await cell\n-      .getByRole('textbox')\n-      .type(source, { delay: cellType === 'code' ? 100 : 0 });\n+    await cell.getByRole('textbox').type(source, { delay: 0 });\n     await this._setCellMode(cell, 'Command');\n \n-    // give CodeMirror time to style properly\n     if (cellType === 'code') {\n-      await this.page.waitForTimeout(500);\n+      // Wait until the CodeMirror highlighting is stable\n+      // over 10 consecutive animation frames.\n+      await cell.evaluate((cell: HTMLElement) => {\n+        let _resolve: () => void;\n+        const promise = new Promise<void>(resolve => {\n+          _resolve = resolve;\n+        });\n+        let framesWithoutChange = 0;\n+        let content = cell.querySelector('.cm-content')!.innerHTML;\n+        const waitUntilNextFrame = () => {\n+          window.requestAnimationFrame(() => {\n+            const newContent = cell.querySelector('.cm-content')!.innerHTML;\n+            if (content === newContent) {\n+              framesWithoutChange += 1;\n+            } else {\n+              framesWithoutChange = 0;\n+            }\n+            if (framesWithoutChange < 10) {\n+              waitUntilNextFrame();\n+            } else {\n+              _resolve();\n+            }\n+          });\n+        };\n+        waitUntilNextFrame();\n+        return promise;\n+      });\n     }\n \n     return true;\n\ndiff --git a/galata/src/utils.ts b/galata/src/utils.ts\nindex 249c1e46e7af..d350c92818e1 100644\n--- a/galata/src/utils.ts\n+++ b/galata/src/utils.ts\n@@ -186,7 +186,7 @@ export async function waitForCondition(\n         }\n         resolve();\n       } else {\n-        checkTimer = setTimeout(check, 200);\n+        checkTimer = setTimeout(check, 50);\n       }\n     };\n \n",
    "test_patch": "diff --git a/galata/test/jupyterlab/collapsible-headings.test.ts b/galata/test/jupyterlab/collapsible-headings.test.ts\nindex 6a431f2e16db..d2eaabaaf7b9 100644\n--- a/galata/test/jupyterlab/collapsible-headings.test.ts\n+++ b/galata/test/jupyterlab/collapsible-headings.test.ts\n@@ -7,11 +7,10 @@ import {\n   IJupyterLabPageFixture,\n   test\n } from '@jupyterlab/galata';\n+import * as path from 'path';\n \n const fileName = 'notebook.ipynb';\n \n-// const menuPaths = ['File', 'Edit', 'View', 'Run', 'Kernel', 'Help'];\n-\n async function populateNotebook(page: IJupyterLabPageFixture) {\n   await page.notebook.setCell(0, 'markdown', '# Heading 1');\n   await page.notebook.addCell('code', '1+1');\n@@ -106,22 +105,24 @@ test.describe('Collapsible Headings; no_showHCB', () => {\n   });\n });\n \n-async function populateNotebook2(page: IJupyterLabPageFixture) {\n-  await page.notebook.setCell(0, 'markdown', '# Heading 1');\n-  await page.notebook.addCell('code', '1+1');\n-  await page.notebook.addCell('markdown', '## Heading 1.1');\n-  await page.notebook.addCell('code', '2+2');\n-  await page.notebook.addCell('markdown', '# Heading 2');\n-  await page.notebook.addCell('code', '3+3');\n-  await page.notebook.addCell('code', '4+4');\n-}\n+const keyboardNavigationNotebook =\n+  'collapsible_headings_keyboard_navigation.ipynb';\n \n test.describe('Collapsible Headings; keyboard navigation', () => {\n+  test.use({ tmpPath: 'test-collapsible-headings-keyboard' });\n+\n   // create an empty notebook for each test\n-  test.beforeEach(async ({ page }) => {\n-    await page.notebook.createNew(fileName);\n-    await populateNotebook2(page);\n-    await page.notebook.run();\n+  test.beforeAll(async ({ request, tmpPath }) => {\n+    const contents = galata.newContentsHelper(request);\n+    await contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${keyboardNavigationNotebook}`),\n+      `${tmpPath}/${keyboardNavigationNotebook}`\n+    );\n+  });\n+\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.notebook.openByPath(`${tmpPath}/${keyboardNavigationNotebook}`);\n+    await page.notebook.activate(keyboardNavigationNotebook);\n   });\n \n   test('Jump to Previous Header', async ({ page }) => {\n\ndiff --git a/galata/test/jupyterlab/html-viewer.test.ts b/galata/test/jupyterlab/html-viewer.test.ts\nindex 52991eb1220a..41e36dc5115c 100644\n--- a/galata/test/jupyterlab/html-viewer.test.ts\n+++ b/galata/test/jupyterlab/html-viewer.test.ts\n@@ -3,25 +3,24 @@\n  * Distributed under the terms of the Modified BSD License.\n  */\n \n-import { expect, test } from '@jupyterlab/galata';\n+import { expect, galata, test } from '@jupyterlab/galata';\n+import * as path from 'path';\n \n-test.describe('HTML Viewer', () => {\n-  test.beforeEach(async ({ page }) => {\n-    await page.menu.clickMenuItem('File>New>Text File');\n-\n-    await page.getByRole('main').getByRole('textbox').fill(`<html>\n-<body>\n-    <div style=\"height: 300px;\"></div>\n-    <a href=\"https://github.com\" target=\"_blank\">GitHub</a>\n-</body>\n-</html>`);\n+const fileName = 'test.html';\n \n-    await page.menu.clickMenuItem('File>Save Text');\n+test.describe('HTML Viewer', () => {\n+  test.use({ tmpPath: 'test-html-viewer' });\n \n-    await page.getByPlaceholder('File name').fill('test.html');\n-    await page.getByRole('button', { name: 'Rename' }).click();\n+  test.beforeAll(async ({ request, tmpPath }) => {\n+    const contents = galata.newContentsHelper(request);\n+    await contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${fileName}`),\n+      `${tmpPath}/${fileName}`\n+    );\n+  });\n \n-    await page.getByRole('listitem', { name: 'test.html' }).dblclick();\n+  test.beforeEach(async ({ page }) => {\n+    await page.getByRole('listitem', { name: fileName }).dblclick();\n   });\n \n   test('should notify links are blocked for untrusted file', async ({\n\ndiff --git a/galata/test/jupyterlab/notebook-markdown.test.ts b/galata/test/jupyterlab/notebook-markdown.test.ts\nindex 690b5d11dce6..6bde7682d344 100644\n--- a/galata/test/jupyterlab/notebook-markdown.test.ts\n+++ b/galata/test/jupyterlab/notebook-markdown.test.ts\n@@ -1,7 +1,12 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { expect, IJupyterLabPageFixture, test } from '@jupyterlab/galata';\n+import {\n+  expect,\n+  galata,\n+  IJupyterLabPageFixture,\n+  test\n+} from '@jupyterlab/galata';\n import * as path from 'path';\n \n const fileName = 'markdown_notebook.ipynb';\n@@ -31,15 +36,21 @@ async function enterEditingModeForScreenshot(\n }\n \n test.describe('Notebook Markdown', () => {\n-  test.beforeEach(async ({ page, tmpPath }) => {\n-    await page.contents.uploadFile(\n+  test.use({ tmpPath: 'test-notebook-markdown' });\n+\n+  test.beforeAll(async ({ tmpPath, request }) => {\n+    const contents = galata.newContentsHelper(request);\n+    await contents.uploadFile(\n       path.resolve(__dirname, `./notebooks/${fileName}`),\n       `${tmpPath}/${fileName}`\n     );\n   });\n \n-  test('Highlight LaTeX syntax', async ({ page, tmpPath }) => {\n+  test.beforeEach(async ({ page, tmpPath }) => {\n     await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n+  });\n+\n+  test('Highlight LaTeX syntax', async ({ page }) => {\n     const imageName = 'highlight-latex.png';\n     await page.notebook.enterCellEditingMode(0);\n     const cell = await page.notebook.getCellLocator(0);\n@@ -49,9 +60,7 @@ test.describe('Notebook Markdown', () => {\n     );\n   });\n \n-  test('Do not highlight TeX in code blocks', async ({ page, tmpPath }) => {\n-    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n-\n+  test('Do not highlight TeX in code blocks', async ({ page }) => {\n     const imageName = 'do-not-highlight-not-latex.png';\n     await enterEditingModeForScreenshot(page, 1);\n     const cell = await page.notebook.getCellLocator(1);\n@@ -65,8 +74,6 @@ test.describe('Notebook Markdown', () => {\n     page,\n     tmpPath\n   }) => {\n-    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n-\n     const imageName = 'do-not-highlight-standalone-dollar.png';\n     await enterEditingModeForScreenshot(page, 2);\n     const cell = await page.notebook.getCellLocator(2);\n@@ -77,14 +84,12 @@ test.describe('Notebook Markdown', () => {\n   });\n \n   test('Render a MermaidJS flowchart', async ({ page, tmpPath }) => {\n-    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n     const imageName = 'render-mermaid-flowchart.png';\n     const cell = await page.notebook.getCellLocator(3);\n     expect(await cell!.screenshot()).toMatchSnapshot(imageName);\n   });\n \n   test('Render a MermaidJS error', async ({ page, tmpPath }) => {\n-    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n     const imageName = 'render-mermaid-error.png';\n     const cell = await page.notebook.getCellLocator(4);\n     expect(await cell!.screenshot()).toMatchSnapshot(imageName);\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts\nindex 00e2f262a0ea..65502a470e1d 100644\n--- a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts\n+++ b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts\n@@ -52,12 +52,17 @@ async function resizePageAndScreenshot(locator: Locator) {\n for (const theme of ['default', 'dark']) {\n   const dark = theme === 'dark';\n   test.describe(`Notebook Mermaid Diagrams ${theme}`, () => {\n-    test.beforeEach(async ({ page, request, tmpPath }) => {\n+    test.use({ tmpPath: 'test-mermaid' });\n+\n+    test.beforeAll(async ({ request, tmpPath }) => {\n       const contents = galata.newContentsHelper(request);\n       await contents.uploadFile(\n         path.resolve(__dirname, `./notebooks/${fileName}`),\n         `${tmpPath}/${fileName}`\n       );\n+    });\n+\n+    test.beforeEach(async ({ page, tmpPath }) => {\n       await page.filebrowser.openDirectory(tmpPath);\n       const nbPath = `${tmpPath}/${fileName}`;\n \n\ndiff --git a/galata/test/jupyterlab/notebooks/collapsible_headings_keyboard_navigation.ipynb b/galata/test/jupyterlab/notebooks/collapsible_headings_keyboard_navigation.ipynb\nnew file mode 100644\nindex 000000000000..b19b0994f0a5\n--- /dev/null\n+++ b/galata/test/jupyterlab/notebooks/collapsible_headings_keyboard_navigation.ipynb\n@@ -0,0 +1,133 @@\n+{\n+ \"cells\": [\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"id\": \"91e00076-26a7-4b0d-8ed3-a6403b0a0c44\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"# Heading 1\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"code\",\n+   \"execution_count\": 1,\n+   \"id\": \"cf04549b-9c23-4aca-9ad7-50a03c49bdd5\",\n+   \"metadata\": {},\n+   \"outputs\": [\n+    {\n+     \"data\": {\n+      \"text/plain\": [\n+       \"2\"\n+      ]\n+     },\n+     \"execution_count\": 1,\n+     \"metadata\": {},\n+     \"output_type\": \"execute_result\"\n+    }\n+   ],\n+   \"source\": [\n+    \"1+1\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"id\": \"3b8e8342-0c48-4b81-a193-3c47ea3f81e8\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## Heading 1.1\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"code\",\n+   \"execution_count\": 2,\n+   \"id\": \"3fbbe8f5-b7d9-443a-a363-2d329c217cbd\",\n+   \"metadata\": {},\n+   \"outputs\": [\n+    {\n+     \"data\": {\n+      \"text/plain\": [\n+       \"4\"\n+      ]\n+     },\n+     \"execution_count\": 2,\n+     \"metadata\": {},\n+     \"output_type\": \"execute_result\"\n+    }\n+   ],\n+   \"source\": [\n+    \"2+2\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"id\": \"a2eb5c21-963a-450d-bcec-8a8031585d90\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"# Heading 2\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"code\",\n+   \"execution_count\": 3,\n+   \"id\": \"367e6ab5-07af-4731-803d-6528c56ba2ee\",\n+   \"metadata\": {},\n+   \"outputs\": [\n+    {\n+     \"data\": {\n+      \"text/plain\": [\n+       \"6\"\n+      ]\n+     },\n+     \"execution_count\": 3,\n+     \"metadata\": {},\n+     \"output_type\": \"execute_result\"\n+    }\n+   ],\n+   \"source\": [\n+    \"3+3\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"code\",\n+   \"execution_count\": 4,\n+   \"id\": \"17f78bcc-aa2b-4c74-b2c7-41302779cc49\",\n+   \"metadata\": {},\n+   \"outputs\": [\n+    {\n+     \"data\": {\n+      \"text/plain\": [\n+       \"8\"\n+      ]\n+     },\n+     \"execution_count\": 4,\n+     \"metadata\": {},\n+     \"output_type\": \"execute_result\"\n+    }\n+   ],\n+   \"source\": [\n+    \"4+4\"\n+   ]\n+  }\n+ ],\n+ \"metadata\": {\n+  \"kernelspec\": {\n+   \"display_name\": \"Python 3 (ipykernel)\",\n+   \"language\": \"python\",\n+   \"name\": \"python3\"\n+  },\n+  \"language_info\": {\n+   \"codemirror_mode\": {\n+    \"name\": \"ipython\",\n+    \"version\": 3\n+   },\n+   \"file_extension\": \".py\",\n+   \"mimetype\": \"text/x-python\",\n+   \"name\": \"python\",\n+   \"nbconvert_exporter\": \"python\",\n+   \"pygments_lexer\": \"ipython3\",\n+   \"version\": \"3.11.4\"\n+  }\n+ },\n+ \"nbformat\": 4,\n+ \"nbformat_minor\": 5\n+}\n\ndiff --git a/galata/test/jupyterlab/notebooks/test.html b/galata/test/jupyterlab/notebooks/test.html\nnew file mode 100644\nindex 000000000000..284cb66eb5a7\n--- /dev/null\n+++ b/galata/test/jupyterlab/notebooks/test.html\n@@ -0,0 +1,6 @@\n+<html>\n+<body>\n+    <div style=\"height: 300px;\"></div>\n+    <a href=\"https://github.com\" target=\"_blank\">GitHub</a>\n+</body>\n+</html>\n\ndiff --git a/galata/test/jupyterlab/output-scrolling.test.ts b/galata/test/jupyterlab/output-scrolling.test.ts\nindex 0ba0ef573136..a7b49dab2b7d 100644\n--- a/galata/test/jupyterlab/output-scrolling.test.ts\n+++ b/galata/test/jupyterlab/output-scrolling.test.ts\n@@ -1,7 +1,7 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { test } from '@jupyterlab/galata';\n+import { galata, test } from '@jupyterlab/galata';\n import { expect } from '@playwright/test';\n import * as path from 'path';\n \n@@ -10,18 +10,24 @@ const fileName = 'output_scrolling.ipynb';\n const cellSelector = '[role=\"main\"] >> .jp-NotebookPanel >> .jp-Cell';\n \n test.describe('Output Scrolling', () => {\n-  test.beforeEach(async ({ page, tmpPath }) => {\n-    await page.contents.uploadFile(\n+  test.use({ tmpPath: 'test-output-scrolling' });\n+\n+  test.beforeAll(async ({ request, tmpPath }) => {\n+    const contents = galata.newContentsHelper(request);\n+    await contents.uploadFile(\n       path.resolve(__dirname, `./notebooks/${fileName}`),\n       `${tmpPath}/${fileName}`\n     );\n+  });\n \n+  test.beforeEach(async ({ page, tmpPath }) => {\n     await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n     await page.notebook.activate(fileName);\n   });\n \n-  test.afterEach(async ({ page, tmpPath }) => {\n-    await page.contents.deleteDirectory(tmpPath);\n+  test.afterAll(async ({ request, tmpPath }) => {\n+    const contents = galata.newContentsHelper(request);\n+    await contents.deleteDirectory(tmpPath);\n   });\n \n   test('Scrolling mode', async ({ page }) => {\n\ndiff --git a/galata/test/jupyterlab/toc-running.test.ts b/galata/test/jupyterlab/toc-running.test.ts\nindex e4a3fe395862..dc765140cd9d 100644\n--- a/galata/test/jupyterlab/toc-running.test.ts\n+++ b/galata/test/jupyterlab/toc-running.test.ts\n@@ -7,6 +7,8 @@ const fileName = 'toc_running.ipynb';\n import * as path from 'path';\n \n test.describe('ToC Running indicator', () => {\n+  test.use({ tmpPath: 'test-toc-running-indicator' });\n+\n   test.beforeEach(async ({ page, tmpPath }) => {\n     await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n     await page.notebook.activate(fileName);\n\ndiff --git a/galata/test/jupyterlab/toc-scrolling.test.ts b/galata/test/jupyterlab/toc-scrolling.test.ts\nindex afeec8d49295..d9849e388798 100644\n--- a/galata/test/jupyterlab/toc-scrolling.test.ts\n+++ b/galata/test/jupyterlab/toc-scrolling.test.ts\n@@ -6,7 +6,7 @@ import * as path from 'path';\n \n const fileName = 'toc_scrolling_notebook.ipynb';\n \n-test.use({ tmpPath: 'test-toc' });\n+test.use({ tmpPath: 'test-toc-scrolling' });\n \n test.describe('Table of Contents scrolling to heading', () => {\n   test.beforeAll(async ({ request, tmpPath }) => {\n\ndiff --git a/galata/test/jupyterlab/toc.test.ts b/galata/test/jupyterlab/toc.test.ts\nindex 4e2de186237a..1d17094ab8b2 100644\n--- a/galata/test/jupyterlab/toc.test.ts\n+++ b/galata/test/jupyterlab/toc.test.ts\n@@ -6,7 +6,7 @@ import * as path from 'path';\n \n const fileName = 'toc_notebook.ipynb';\n \n-test.use({ tmpPath: 'test-toc' });\n+test.use({ tmpPath: 'test-toc-general' });\n \n test.describe('Table of Contents', () => {\n   test.beforeAll(async ({ request, tmpPath }) => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16032",
    "pr_id": 16032,
    "issue_id": 15981,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Accidentally converting a %debug cell to a raw cell blocks the kernel permanently\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nIf a cell is in %debug mode, accidently pressing \"R\" can convert it into a raw cell which leaves the kernel in an unrecoverable state. \r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\n1. In cell 1, run the following: \r\n```python\r\ndef fn():\r\n    raise ValueError()\r\n\r\nfn()\r\n```\r\n2. In cell 2, run - \r\n```\r\n%debug\r\n```\r\n3. Now convert the cell into a raw cell.\r\n\r\n## Expected behavior\r\nConverting such a cell to a raw cell shouldn't be allowed or should throw a warning. \r\n\r\n## Context\r\n- JupyterLab version: 4.1.2\r\n",
    "issue_word_count": 140,
    "test_files_count": 2,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "packages/apputils/src/sessioncontext.tsx",
      "packages/notebook-extension/src/index.ts",
      "packages/notebook/src/actions.tsx",
      "packages/notebook/test/actions.spec.ts",
      "packages/outputarea/src/widget.ts",
      "packages/outputarea/test/widget.spec.ts",
      "packages/services/src/kernel/future.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/actions.spec.ts",
      "packages/outputarea/test/widget.spec.ts"
    ],
    "base_commit": "5598b3ac105cd879c23e04ef6a8a677cf208cacc",
    "head_commit": "843330346dad2b9c23716e943ab75d0c3c7ece3c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16032",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16032",
    "dockerfile": "",
    "pr_merged_at": "2024-03-21T10:44:46.000Z",
    "patch": "diff --git a/packages/apputils/src/sessioncontext.tsx b/packages/apputils/src/sessioncontext.tsx\nindex 030525584536..1121f67c4dff 100644\n--- a/packages/apputils/src/sessioncontext.tsx\n+++ b/packages/apputils/src/sessioncontext.tsx\n@@ -420,7 +420,7 @@ export class SessionContext implements ISessionContext {\n   }\n \n   /**\n-   * A flag indicating if the session has ending input, proxied from the kernel.\n+   * A flag indicating if the session has pending input, proxied from the kernel.\n    */\n   get pendingInput(): boolean {\n     return this._pendingInput;\n\ndiff --git a/packages/notebook-extension/src/index.ts b/packages/notebook-extension/src/index.ts\nindex 8de9debe0c17..5f9c8b77b694 100644\n--- a/packages/notebook-extension/src/index.ts\n+++ b/packages/notebook-extension/src/index.ts\n@@ -2556,7 +2556,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.changeCellType(current.content, 'code');\n+        return NotebookActions.changeCellType(\n+          current.content,\n+          'code',\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -2567,7 +2571,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.changeCellType(current.content, 'markdown');\n+        return NotebookActions.changeCellType(\n+          current.content,\n+          'markdown',\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -2578,7 +2586,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.changeCellType(current.content, 'raw');\n+        return NotebookActions.changeCellType(\n+          current.content,\n+          'raw',\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -3184,7 +3196,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.setMarkdownHeader(current.content, 1);\n+        return NotebookActions.setMarkdownHeader(\n+          current.content,\n+          1,\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -3195,7 +3211,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.setMarkdownHeader(current.content, 2);\n+        return NotebookActions.setMarkdownHeader(\n+          current.content,\n+          2,\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -3206,7 +3226,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.setMarkdownHeader(current.content, 3);\n+        return NotebookActions.setMarkdownHeader(\n+          current.content,\n+          3,\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -3217,7 +3241,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.setMarkdownHeader(current.content, 4);\n+        return NotebookActions.setMarkdownHeader(\n+          current.content,\n+          4,\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -3228,7 +3256,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.setMarkdownHeader(current.content, 5);\n+        return NotebookActions.setMarkdownHeader(\n+          current.content,\n+          5,\n+          translator\n+        );\n       }\n     },\n     isEnabled\n@@ -3239,7 +3271,11 @@ function addCommands(\n       const current = getCurrent(tracker, shell, args);\n \n       if (current) {\n-        return NotebookActions.setMarkdownHeader(current.content, 6);\n+        return NotebookActions.setMarkdownHeader(\n+          current.content,\n+          6,\n+          translator\n+        );\n       }\n     },\n     isEnabled\n\ndiff --git a/packages/notebook/src/actions.tsx b/packages/notebook/src/actions.tsx\nindex c80ba41b8c39..c54643fc88ac 100644\n--- a/packages/notebook/src/actions.tsx\n+++ b/packages/notebook/src/actions.tsx\n@@ -499,8 +499,8 @@ export namespace NotebookActions {\n    * Change the selected cell type(s).\n    *\n    * @param notebook - The target notebook widget.\n-   *\n    * @param value - The target cell type.\n+   * @param translator - The application translator.\n    *\n    * #### Notes\n    * It should preserve the widget mode.\n@@ -510,7 +510,8 @@ export namespace NotebookActions {\n    */\n   export function changeCellType(\n     notebook: Notebook,\n-    value: nbformat.CellType\n+    value: nbformat.CellType,\n+    translator?: ITranslator\n   ): void {\n     if (!notebook.model || !notebook.activeCell) {\n       return;\n@@ -518,7 +519,7 @@ export namespace NotebookActions {\n \n     const state = Private.getState(notebook);\n \n-    Private.changeCellType(notebook, value);\n+    Private.changeCellType(notebook, value, translator);\n     void Private.handleState(notebook, state);\n   }\n \n@@ -1776,8 +1777,8 @@ export namespace NotebookActions {\n    * Set the markdown header level.\n    *\n    * @param notebook - The target notebook widget.\n-   *\n    * @param level - The header level.\n+   * @param translator - The application translator.\n    *\n    * #### Notes\n    * All selected cells will be switched to markdown.\n@@ -1786,7 +1787,11 @@ export namespace NotebookActions {\n    * There will always be one blank space after the header.\n    * The cells will be unrendered.\n    */\n-  export function setMarkdownHeader(notebook: Notebook, level: number): void {\n+  export function setMarkdownHeader(\n+    notebook: Notebook,\n+    level: number,\n+    translator?: ITranslator\n+  ): void {\n     if (!notebook.model || !notebook.activeCell) {\n       return;\n     }\n@@ -1800,7 +1805,7 @@ export namespace NotebookActions {\n         Private.setMarkdownHeader(cells.get(index), level);\n       }\n     });\n-    Private.changeCellType(notebook, 'markdown');\n+    Private.changeCellType(notebook, 'markdown', translator);\n     void Private.handleState(notebook, state);\n   }\n \n@@ -2074,6 +2079,7 @@ export namespace NotebookActions {\n    * Trust the notebook after prompting the user.\n    *\n    * @param notebook - The target notebook widget.\n+   * @param translator - The application translator.\n    *\n    * @returns a promise that resolves when the transaction is finished.\n    *\n@@ -2714,13 +2720,30 @@ namespace Private {\n    */\n   export function changeCellType(\n     notebook: Notebook,\n-    value: nbformat.CellType\n+    value: nbformat.CellType,\n+    translator?: ITranslator\n   ): void {\n     const notebookSharedModel = notebook.model!.sharedModel;\n     notebook.widgets.forEach((child, index) => {\n       if (!notebook.isSelectedOrActive(child)) {\n         return;\n       }\n+      if (\n+        child.model.type === 'code' &&\n+        (child as CodeCell).outputArea.pendingInput\n+      ) {\n+        translator = translator || nullTranslator;\n+        const trans = translator.load('jupyterlab');\n+        // Do not permit changing cell type when input is pending\n+        void showDialog({\n+          title: trans.__('Cell type not changed due to pending input'),\n+          body: trans.__(\n+            'The cell type has not been changed to avoid kernel deadlock as this cell has pending input! Submit your pending input and try again.'\n+          ),\n+          buttons: [Dialog.okButton()]\n+        });\n+        return;\n+      }\n       if (child.model.type !== value) {\n         const raw = child.model.toJSON();\n         notebookSharedModel.transact(() => {\n\ndiff --git a/packages/outputarea/src/widget.ts b/packages/outputarea/src/widget.ts\nindex 29192f0d4bba..2d4ea38924b4 100644\n--- a/packages/outputarea/src/widget.ts\n+++ b/packages/outputarea/src/widget.ts\n@@ -191,6 +191,15 @@ export class OutputArea extends Widget {\n     }\n     this._future = value;\n \n+    value.done\n+      .finally(() => {\n+        this._pendingInput = false;\n+      })\n+      .catch(() => {\n+        // No-op, required because `finally` re-raises any rejections,\n+        // even if caught on the `done` promise level before.\n+      });\n+\n     this.model.clear();\n \n     // Make sure there were no input widgets.\n@@ -224,6 +233,13 @@ export class OutputArea extends Widget {\n     return this._inputRequested;\n   }\n \n+  /**\n+   * A flag indicating if the output area has pending input.\n+   */\n+  get pendingInput(): boolean {\n+    return this._pendingInput;\n+  }\n+\n   /**\n    * The maximum number of output items to display on top and bottom of cell output.\n    *\n@@ -444,6 +460,9 @@ export class OutputArea extends Widget {\n     prompt.addClass(OUTPUT_AREA_PROMPT_CLASS);\n     panel.addWidget(prompt);\n \n+    // Indicate that input is pending\n+    this._pendingInput = true;\n+\n     const input = factory.createStdin({\n       parent_header: msg.header,\n       prompt: stdinPrompt,\n@@ -484,6 +503,9 @@ export class OutputArea extends Widget {\n       // Refocus the input node after it lost focus due to update of the model.\n       inputNode.focus();\n \n+      // Indicate that input is no longer pending\n+      this._pendingInput = false;\n+\n       // Keep the input in view for a little while; this (along refocusing)\n       // ensures that we can avoid the cell editor stealing the focus, and\n       // leading to user inadvertently modifying editor content when executing\n@@ -660,7 +682,6 @@ export class OutputArea extends Widget {\n     const transient = ((msg.content as any).transient || {}) as JSONObject;\n     const displayId = transient['display_id'] as string;\n     let targets: number[] | undefined;\n-\n     switch (msgType) {\n       case 'execute_result':\n       case 'display_data':\n@@ -683,6 +704,15 @@ export class OutputArea extends Widget {\n           }\n         }\n         break;\n+      case 'status': {\n+        const executionState = (msg as KernelMessage.IStatusMsg).content\n+          .execution_state;\n+        if (executionState === 'idle') {\n+          // If status is idle, the kernel is no longer blocked by the input\n+          this._pendingInput = false;\n+        }\n+        break;\n+      }\n       default:\n         break;\n     }\n@@ -765,6 +795,7 @@ export class OutputArea extends Widget {\n   });\n   private _translator: ITranslator;\n   private _inputHistoryScope: 'global' | 'session' = 'global';\n+  private _pendingInput: boolean = false;\n }\n \n export class SimplifiedOutputArea extends OutputArea {\n\ndiff --git a/packages/services/src/kernel/future.ts b/packages/services/src/kernel/future.ts\nindex 02fb0e29907b..429ad20ada88 100644\n--- a/packages/services/src/kernel/future.ts\n+++ b/packages/services/src/kernel/future.ts\n@@ -189,6 +189,8 @@ export abstract class KernelFutureHandler<\n       // is waiting for the promise to resolve. This prevents the error from\n       // being displayed in the console, but does not prevent it from being\n       // caught by a client who is waiting for it.\n+      // Note: any `.then` and `.finally` attached to the `done` promise\n+      // will cause the error to be thrown as uncaught anyways.\n       this._done.promise.catch(() => {\n         /* no-op */\n       });\n",
    "test_patch": "diff --git a/packages/notebook/test/actions.spec.ts b/packages/notebook/test/actions.spec.ts\nindex 8f2b66529bad..37dfb945b97c 100644\n--- a/packages/notebook/test/actions.spec.ts\n+++ b/packages/notebook/test/actions.spec.ts\n@@ -18,13 +18,16 @@ import {\n   NotebookModel,\n   StaticNotebook\n } from '@jupyterlab/notebook';\n+import { Stdin } from '@jupyterlab/outputarea';\n import { IRenderMimeRegistry } from '@jupyterlab/rendermime';\n import { ISharedCodeCell } from '@jupyter/ydoc';\n import {\n   acceptDialog,\n   dismissDialog,\n   JupyterServer,\n-  sleep\n+  signalToPromise,\n+  sleep,\n+  waitForDialog\n } from '@jupyterlab/testing';\n import { JSONArray, JSONObject, UUID } from '@lumino/coreutils';\n import * as utils from './utils';\n@@ -662,6 +665,39 @@ describe('@jupyterlab/notebook', () => {\n         const cell = widget.activeCell as MarkdownCell;\n         expect(cell.model.metadata.trusted).toBe(undefined);\n       });\n+\n+      it('should not change cell type away from code cell when input is pending', async () => {\n+        let cell = widget.activeCell as CodeCell;\n+        expect(widget.activeCell).toBeInstanceOf(CodeCell);\n+\n+        const inputRequested = signalToPromise(cell.outputArea.inputRequested);\n+\n+        // Execute input request\n+        cell.model.sharedModel.setSource('input()');\n+        // Do not wait for completion yet: it will not complete until input is submitted\n+        const donePromise = NotebookActions.run(widget, sessionContext);\n+        // Wait for the input being requested from kernel\n+        const stdin = (await inputRequested)[1];\n+\n+        // Try to change cell type\n+        NotebookActions.changeCellType(widget, 'raw');\n+        // Cell type should stay unchanged.\n+        expect(widget.activeCell).toBeInstanceOf(CodeCell);\n+\n+        // Should show a dialog informing user why cell type could not be changed\n+        await waitForDialog();\n+        await acceptDialog();\n+\n+        // Submit the input\n+        (stdin as Stdin).handleEvent(\n+          new KeyboardEvent('keydown', { key: 'Enter' })\n+        );\n+        await donePromise;\n+\n+        // Try to change cell type again, it should work now\n+        NotebookActions.changeCellType(widget, 'raw');\n+        expect(widget.activeCell).toBeInstanceOf(RawCell);\n+      });\n     });\n \n     describe('#run()', () => {\n\ndiff --git a/packages/outputarea/test/widget.spec.ts b/packages/outputarea/test/widget.spec.ts\nindex dba92071d7d6..e4aec01ff024 100644\n--- a/packages/outputarea/test/widget.spec.ts\n+++ b/packages/outputarea/test/widget.spec.ts\n@@ -7,10 +7,11 @@ import {\n   IOutputAreaModel,\n   OutputArea,\n   OutputAreaModel,\n-  SimplifiedOutputArea\n+  SimplifiedOutputArea,\n+  Stdin\n } from '@jupyterlab/outputarea';\n-import { KernelManager } from '@jupyterlab/services';\n-import { JupyterServer } from '@jupyterlab/testing';\n+import { Kernel, KernelManager } from '@jupyterlab/services';\n+import { JupyterServer, signalToPromise } from '@jupyterlab/testing';\n import {\n   DEFAULT_OUTPUTS,\n   defaultRenderMime\n@@ -194,6 +195,76 @@ describe('outputarea/widget', () => {\n       });\n     });\n \n+    describe('#pendingInput', () => {\n+      let kernel: Kernel.IKernelConnection;\n+\n+      beforeEach(async () => {\n+        const manager = new KernelManager();\n+        kernel = await manager.startNew({ name: 'ipython' });\n+      });\n+\n+      afterEach(async () => {\n+        await kernel.shutdown();\n+      });\n+\n+      it('should default to `false`', () => {\n+        expect(widget.pendingInput).toBe(false);\n+      });\n+\n+      it('should be `true` when pending user input', async () => {\n+        // Prompt kernel to request input and wait until it is requested\n+        const future = kernel.requestExecute({ code: 'input()' });\n+        const inputRequested = signalToPromise(widget.inputRequested);\n+        widget.future = future;\n+        const input = (await inputRequested)[1];\n+\n+        // Input is now pending\n+        expect(widget.pendingInput).toBe(true);\n+\n+        // Submit input\n+        (input as Stdin).handleEvent(\n+          new KeyboardEvent('keydown', { key: 'Enter' })\n+        );\n+        await future.done;\n+\n+        // Input should no longer be flagged as pending.\n+        expect(widget.pendingInput).toBe(false);\n+      });\n+\n+      it('should reset to `false` when kernel gets shut down', async () => {\n+        const future = kernel.requestExecute({ code: 'input()' });\n+        const inputRequested = signalToPromise(widget.inputRequested);\n+        widget.future = future;\n+        await inputRequested;\n+        await kernel.shutdown();\n+        expect(widget.pendingInput).toBe(false);\n+      });\n+\n+      it('should reset to `false` when kernel restarts', async () => {\n+        const future = kernel.requestExecute({ code: 'input()' });\n+        const inputRequested = signalToPromise(widget.inputRequested);\n+        widget.future = future;\n+        await inputRequested;\n+        await kernel.restart();\n+        expect(widget.pendingInput).toBe(false);\n+      });\n+\n+      it('should reset to `false` when kernel cancels input after getting interrupted', async () => {\n+        // This test requires an ipython kernel because the default echo kernel\n+        // does not actually do anything on getting interrupted.\n+        const future = kernel.requestExecute({ code: 'input()' });\n+        const inputRequested = signalToPromise(widget.inputRequested);\n+        widget.future = future;\n+        await inputRequested;\n+        // Need to wait for status change because futures are not disposed on\n+        // interrupt (differently to shutdown and restart).\n+        const statusChanged = signalToPromise(kernel.statusChanged);\n+        await kernel.interrupt();\n+        await statusChanged;\n+        expect(widget.pendingInput).toBe(false);\n+      });\n+    });\n+\n     describe('#future', () => {\n       let sessionContext: SessionContext;\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16026",
    "pr_id": 16026,
    "issue_id": 16021,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Inconsistent listing header node checbox state\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nFile Browser Dir listing header checbox is not working correctly due to click event listener added `listing.ts:2506`. So it is prevent header checkbox persist its state\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/20378722/799d1ad6-6709-4c15-9171-7a6b6a92f463)\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/20378722/158ee648-716f-40b0-9fca-12362ea54620)\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Go to 'File Browser'\r\n2. Click on 'Listing Header Checkbox'\r\n3. See error 'All checked but header'\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\nIt should check all\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Linux Ubuntu 22.04\r\n- Browser and version: Chrome 122\r\n- JupyterLab version: 4.1.0\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\nPaste the output from running `jupyter troubleshoot` from the command line here.\r\nYou may want to sanitize the paths in the output.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\nPaste the output from your command line running `jupyter lab` here, use `--debug` if possible.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nPaste the output from your browser Javascript console here, if applicable.\r\n\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 278,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/test/listing.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/listing.spec.ts"
    ],
    "base_commit": "0f3675a3875823d574b7d32dd73c8961256aa5ee",
    "head_commit": "dd02f55e5a5380c21e372a906f23ce11d919af39",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16026",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16026",
    "dockerfile": "",
    "pr_merged_at": "2024-03-22T11:24:42.000Z",
    "patch": "diff --git a/packages/filebrowser/src/listing.ts b/packages/filebrowser/src/listing.ts\nindex 050a4094e02a..5051f6552789 100644\n--- a/packages/filebrowser/src/listing.ts\n+++ b/packages/filebrowser/src/listing.ts\n@@ -2307,7 +2307,8 @@ export namespace DirListing {\n       narrow.textContent = '...';\n       if (!hiddenColumns?.has('is_selected')) {\n         const checkboxWrapper = this.createCheckboxWrapperNode({\n-          alwaysVisible: true\n+          alwaysVisible: true,\n+          headerNode: true\n         });\n         node.appendChild(checkboxWrapper);\n       }\n@@ -2493,6 +2494,7 @@ export namespace DirListing {\n      */\n     createCheckboxWrapperNode(options?: {\n       alwaysVisible: boolean;\n+      headerNode?: boolean;\n     }): HTMLElement {\n       // Wrap the checkbox in a label element in order to increase its hit area.\n       const labelWrapper = document.createElement('label');\n@@ -2503,9 +2505,11 @@ export namespace DirListing {\n       // Prevent the user from clicking (via mouse, keyboard, or touch) the\n       // checkbox since other code handles the mouse and keyboard events and\n       // controls the checked state of the checkbox.\n-      checkbox.addEventListener('click', event => {\n-        event.preventDefault();\n-      });\n+      if (!options?.headerNode) {\n+        checkbox.addEventListener('click', event => {\n+          event.preventDefault();\n+        });\n+      }\n \n       // The individual file checkboxes are visible on hover, but the header\n       // check-all checkbox is always visible.\n",
    "test_patch": "diff --git a/packages/filebrowser/test/listing.spec.ts b/packages/filebrowser/test/listing.spec.ts\nindex 9a2f88650d91..8c510efa0a8b 100644\n--- a/packages/filebrowser/test/listing.spec.ts\n+++ b/packages/filebrowser/test/listing.spec.ts\n@@ -725,6 +725,8 @@ describe('filebrowser/listing', () => {\n             ) as HTMLInputElement;\n             simulate(headerCheckbox, 'click');\n             await signalToPromise(dirListing.updated);\n+            expect(headerCheckbox.checked).toBe(true);\n+            expect(headerCheckbox.indeterminate).toBe(false);\n             expect(Array.from(dirListing.selectedItems())).toHaveLength(4);\n             expect(headerCheckbox.getAttribute('aria-label')).toBe(\n               ariaDeselectAll\n@@ -743,6 +745,7 @@ describe('filebrowser/listing', () => {\n               dirListing.headerNode\n             ) as HTMLInputElement;\n             expect(headerCheckbox.indeterminate).toBe(true);\n+            expect(headerCheckbox.checked).toBe(false);\n             expect(Array.from(dirListing.selectedItems())).toHaveLength(1);\n             expect(headerCheckbox.getAttribute('aria-label')).toBe(\n               ariaDeselectAll\n@@ -755,6 +758,8 @@ describe('filebrowser/listing', () => {\n             ) as HTMLInputElement;\n             simulate(headerCheckbox, 'click');\n             await signalToPromise(dirListing.updated);\n+            expect(headerCheckbox.checked).toBe(false);\n+            expect(headerCheckbox.indeterminate).toBe(false);\n             expect(Array.from(dirListing.selectedItems())).toHaveLength(0);\n             expect(headerCheckbox.getAttribute('aria-label')).toBe(\n               ariaSelectAll\n@@ -786,6 +791,8 @@ describe('filebrowser/listing', () => {\n             ) as HTMLInputElement;\n             simulate(headerCheckbox, 'click');\n             await signalToPromise(dirListing.updated);\n+            expect(headerCheckbox.checked).toBe(false);\n+            expect(headerCheckbox.indeterminate).toBe(false);\n             expect(Array.from(dirListing.selectedItems())).toHaveLength(0);\n           });\n         });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16024",
    "pr_id": 16024,
    "issue_id": 16023,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`js-documentsearch` started failing on CI\n## Description\r\n\r\n`js-documentsearch` started failing a few hours ago, as seen in a few recent PRs:\r\n- https://github.com/jupyterlab/jupyterlab/pull/16022\r\n- https://github.com/jupyterlab/jupyterlab/pull/16017\r\n- https://github.com/jupyterlab/jupyterlab/pull/16018\r\n\r\nwith related actions:\r\n- https://github.com/jupyterlab/jupyterlab/actions/runs/8344172540/job/22836019508?pr=16022\r\n- https://github.com/jupyterlab/jupyterlab/actions/runs/8339946870/job/22822897980?pr=16017\r\n- https://github.com/jupyterlab/jupyterlab/actions/runs/8341070539/job/22826382472?pr=16018\r\n\r\nIt was passing 8 hours ago on `main`: https://github.com/jupyterlab/jupyterlab/actions/runs/8339928987/job/22822850268\r\n\r\n```js\r\n  â— documentsearch/searchmodel â€º SearchDocumentModel â€º #parsingError â€º should set informative string message on invalid regex\r\n\r\n    expect(received).toEqual(expected) // deep equality\r\n\r\n    Expected: \"SyntaxError: Invalid regular expression: /query\\\\/: \\\\ at end of pattern\"\r\n    Received: \"SyntaxError: Invalid regular expression: /query\\\\/gim: \\\\ at end of pattern\"\r\n\r\n      88 |         model.searchExpression = 'query\\\\';\r\n      89 |         await signalToPromise(model.stateChanged);\r\n    > 90 |         expect(model.parsingError).toEqual(\r\n         |                                    ^\r\n      91 |           'SyntaxError: Invalid regular expression: /query\\\\/: \\\\ at end of pattern'\r\n      92 |         );\r\n      93 |       });\r\n\r\n      at Object.<anonymous> (test/searchmodel.spec.ts:90:36)\r\n\r\n\r\nError: expect(received).toEqual(expected) // deep equality\r\n\r\nExpected: \"SyntaxError: Invalid regular expression: /query\\\\/: \\\\ at end of pattern\"\r\nReceived: \"SyntaxError: Invalid regular expression: /query\\\\/gim: \\\\ at end of pattern\"\r\n```",
    "issue_word_count": 203,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "packages/documentsearch/test/searchmodel.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/documentsearch/test/searchmodel.spec.ts"
    ],
    "base_commit": "a1166c15297bbae0948609879055af00940947dc",
    "head_commit": "0f5e545b625cf34e972db482ffd88850373e1835",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16024",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16024",
    "dockerfile": "",
    "pr_merged_at": "2024-03-20T07:37:56.000Z",
    "patch": "",
    "test_patch": "diff --git a/packages/documentsearch/test/searchmodel.spec.ts b/packages/documentsearch/test/searchmodel.spec.ts\nindex 4a0adf8ea7a6..499cbab1020c 100644\n--- a/packages/documentsearch/test/searchmodel.spec.ts\n+++ b/packages/documentsearch/test/searchmodel.spec.ts\n@@ -87,9 +87,12 @@ describe('documentsearch/searchmodel', () => {\n         expect(model.parsingError).toEqual('');\n         model.searchExpression = 'query\\\\';\n         await signalToPromise(model.stateChanged);\n-        expect(model.parsingError).toEqual(\n-          'SyntaxError: Invalid regular expression: /query\\\\/: \\\\ at end of pattern'\n-        );\n+        expect([\n+          // Node 18.x and older\n+          'SyntaxError: Invalid regular expression: /query\\\\/: \\\\ at end of pattern',\n+          // Node 20.x and newer\n+          'SyntaxError: Invalid regular expression: /query\\\\/gim: \\\\ at end of pattern'\n+        ]).toContain(model.parsingError);\n       });\n     });\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16013",
    "pr_id": 16013,
    "issue_id": 15415,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Windowed notebook/ToC breaks after File Changed/\"Revert\" dialog\n\r\n\r\n## Description\r\n\r\nAfter changing the notebook in another instance/in another window/via text editor/version control system reloading it to revert to previous version with \"Revert\" breaks the windowed notebook. Some of the error trackabcks include:\r\n\r\n```ts\r\nDOMException: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.\r\n    at NotebookWindowedLayout.detachWidget (http://127.0.0.1:8889/static/lab/packages_notebook_lib_index_js.a0899e5b2c84c0887c94.js:9919:38)\r\n    at NotebookWindowedLayout.removeWidget (http://127.0.0.1:8889/static/lab/packages_notebook_lib_index_js.a0899e5b2c84c0887c94.js:9806:18)\r\n    at NotebookWindowedLayout.onChildRemoved (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:13723:14)\r\n    at NotebookWindowedLayout.onChildRemoved (http://127.0.0.1:8889/static/lab/packages_notebook_lib_index_js.a0899e5b2c84c0887c94.js:9997:15)\r\n    at NotebookWindowedLayout.processParentMessage (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:13522:22)\r\n    at Notebook.notifyLayout (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:12938:26)\r\n    at Notebook.processMessage (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:12918:22)\r\n    at invokeHandler (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:9381:21)\r\n    at Object.sendMessage (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:9135:13)\r\n    at set parent [as parent] (http://127.0.0.1:8889/static/lab/jlab_core.ac50a29a806e5e41bc1f.js:12581:72)\r\nexceptionHandler @ index.es6.js:377\r\n```\r\n\r\nfollowed by:\r\n\r\n```ts\r\nwindowedlist.ts:1126 Uncaught Error: Inconsistent dataset index\r\n    at Notebook._update (windowedlist.ts:1126:15)\r\n    at windowedlist.ts:1005:16\r\n```\r\n\r\n\r\n## Reproduce\r\n\r\n1. Set \"Windowing mode\" in Notebook settings to \"ful\"\r\n2. Follow the screencast:\r\n![windowed-notebook-breaks](https://github.com/jupyterlab/jupyterlab/assets/5832902/7a77aa6a-abcc-4b54-a945-d535ad4e1454)\r\n\r\n## Expected behavior\r\n\r\nReverting does not break the windowed list.\r\n\r\n## Context\r\n\r\n- Browser and version: Chrome and Firefox\r\n- JupyterLab version: 4.0.x and 4.1.0a3",
    "issue_word_count": 308,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "packages/notebook/src/toc.ts",
      "packages/notebook/src/windowing.ts",
      "packages/notebook/test/toc.spec.ts",
      "packages/toc/src/model.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/toc.spec.ts"
    ],
    "base_commit": "9eea31bc38c7118cfe725e2f60a808f0a3e4c05e",
    "head_commit": "586d8806755ce04209f5ba27a3ee04040d536c96",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16013",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16013",
    "dockerfile": "",
    "pr_merged_at": "2024-03-22T07:30:52.000Z",
    "patch": "diff --git a/packages/notebook/src/toc.ts b/packages/notebook/src/toc.ts\nindex 9bf0c1489320..585e18b53535 100644\n--- a/packages/notebook/src/toc.ts\n+++ b/packages/notebook/src/toc.ts\n@@ -295,6 +295,23 @@ export class NotebookToCModel extends TableOfContentsModel<\n     return Promise.resolve(headings);\n   }\n \n+  /**\n+   * Test if two headings are equal or not.\n+   *\n+   * @param heading1 First heading\n+   * @param heading2 Second heading\n+   * @returns Whether the headings are equal.\n+   */\n+  protected override isHeadingEqual(\n+    heading1: INotebookHeading,\n+    heading2: INotebookHeading\n+  ): boolean {\n+    return (\n+      super.isHeadingEqual(heading1, heading2) &&\n+      heading1.cellRef === heading2.cellRef\n+    );\n+  }\n+\n   /**\n    * Read table of content configuration from notebook metadata.\n    *\n\ndiff --git a/packages/notebook/src/windowing.ts b/packages/notebook/src/windowing.ts\nindex 0459029b93da..7297b4070cfb 100644\n--- a/packages/notebook/src/windowing.ts\n+++ b/packages/notebook/src/windowing.ts\n@@ -261,7 +261,7 @@ export class NotebookWindowedLayout extends WindowedLayout {\n \n     // Note: `index` is relative to the displayed cells, not all cells,\n     // hence we compare with the widget itself.\n-    if (widget === this.activeCell) {\n+    if (widget === this.activeCell && widget !== this._willBeRemoved) {\n       // Do not change display of the active cell to allow user to continue providing input\n       // into the code mirror editor when out of view. We still hide the cell so to prevent\n       // minor visual glitches when scrolling.\n\ndiff --git a/packages/toc/src/model.ts b/packages/toc/src/model.ts\nindex 23f5f029f556..6b82f4d37d47 100644\n--- a/packages/toc/src/model.ts\n+++ b/packages/toc/src/model.ts\n@@ -177,10 +177,7 @@ export abstract class TableOfContentsModel<\n         return this.refresh();\n       }\n \n-      if (\n-        newHeadings &&\n-        !Private.areHeadingsEqual(newHeadings, this._headings)\n-      ) {\n+      if (newHeadings && !this._areHeadingsEqual(newHeadings, this._headings)) {\n         this._headings = newHeadings;\n         this.stateChanged.emit();\n         this._headingsChanged.emit();\n@@ -245,40 +242,32 @@ export abstract class TableOfContentsModel<\n     }\n   }\n \n-  private _activeHeading: H | null;\n-  private _activeHeadingChanged: Signal<TableOfContentsModel<H, T>, H | null>;\n-  private _collapseChanged: Signal<TableOfContentsModel<H, T>, H | null>;\n-  private _configuration: TableOfContents.IConfig;\n-  private _headings: H[];\n-  private _headingsChanged: Signal<TableOfContentsModel<H, T>, void>;\n-  private _isActive: boolean;\n-  private _isRefreshing: boolean;\n-  private _needsRefreshing: boolean;\n-  private _title?: string;\n-}\n+  /**\n+   * Test if two headings are equal or not.\n+   *\n+   * @param heading1 First heading\n+   * @param heading2 Second heading\n+   * @returns Whether the headings are equal.\n+   */\n+  protected isHeadingEqual(heading1: H, heading2: H): boolean {\n+    return (\n+      heading1.level === heading2.level &&\n+      heading1.text === heading2.text &&\n+      heading1.prefix === heading2.prefix\n+    );\n+  }\n \n-/**\n- * Private functions namespace\n- */\n-namespace Private {\n   /**\n    * Test if two list of headings are equal or not.\n    *\n    * @param headings1 First list of headings\n    * @param headings2 Second list of headings\n-   * @returns Whether the array are identical or not.\n+   * @returns Whether the array are equal.\n    */\n-  export function areHeadingsEqual(\n-    headings1: TableOfContents.IHeading[],\n-    headings2: TableOfContents.IHeading[]\n-  ): boolean {\n+  private _areHeadingsEqual(headings1: H[], headings2: H[]): boolean {\n     if (headings1.length === headings2.length) {\n       for (let i = 0; i < headings1.length; i++) {\n-        if (\n-          headings1[i].level !== headings2[i].level ||\n-          headings1[i].text !== headings2[i].text ||\n-          headings1[i].prefix !== headings2[i].prefix\n-        ) {\n+        if (!this.isHeadingEqual(headings1[i], headings2[i])) {\n           return false;\n         }\n       }\n@@ -287,4 +276,15 @@ namespace Private {\n \n     return false;\n   }\n+\n+  private _activeHeading: H | null;\n+  private _activeHeadingChanged: Signal<TableOfContentsModel<H, T>, H | null>;\n+  private _collapseChanged: Signal<TableOfContentsModel<H, T>, H | null>;\n+  private _configuration: TableOfContents.IConfig;\n+  private _headings: H[];\n+  private _headingsChanged: Signal<TableOfContentsModel<H, T>, void>;\n+  private _isActive: boolean;\n+  private _isRefreshing: boolean;\n+  private _needsRefreshing: boolean;\n+  private _title?: string;\n }\n",
    "test_patch": "diff --git a/packages/notebook/test/toc.spec.ts b/packages/notebook/test/toc.spec.ts\nnew file mode 100644\nindex 000000000000..a2733e231d18\n--- /dev/null\n+++ b/packages/notebook/test/toc.spec.ts\n@@ -0,0 +1,79 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import {\n+  INotebookModel,\n+  NotebookPanel,\n+  NotebookToCModel\n+} from '@jupyterlab/notebook';\n+import { Context } from '@jupyterlab/docregistry';\n+import { NBTestUtils } from '@jupyterlab/notebook/lib/testutils';\n+import { Sanitizer } from '@jupyterlab/apputils';\n+import { signalToPromise } from '@jupyterlab/testing';\n+import * as utils from './utils';\n+\n+describe('@jupyterlab/notebook', () => {\n+  describe('NotebookToCModel', () => {\n+    let context: Context<INotebookModel>;\n+    let panel: NotebookPanel;\n+    let model: NotebookToCModel;\n+    const sanitizer = new Sanitizer();\n+    const initialCells = [{ cell_type: 'markdown', source: '# heading' }];\n+\n+    beforeEach(async () => {\n+      context = await NBTestUtils.createMockContext(false);\n+      panel = utils.createNotebookPanel(context);\n+      model = new NotebookToCModel(panel, null, sanitizer);\n+      panel.model!.sharedModel.insertCells(0, initialCells);\n+    });\n+\n+    afterEach(() => {\n+      context.dispose();\n+    });\n+\n+    describe('#headingsChanged', () => {\n+      it('should be emitted on cell insertion/deletion', async () => {\n+        // Should be called on insertion\n+        panel.model!.sharedModel.insertCells(0, [\n+          { cell_type: 'markdown', source: '# heading 2' }\n+        ]);\n+        let promise = signalToPromise(model.headingsChanged);\n+        await model.refresh();\n+        await promise;\n+        expect(model.headings).toHaveLength(2);\n+\n+        // Should be called on deletion\n+        panel.model!.sharedModel.deleteCell(0);\n+        promise = signalToPromise(model.headingsChanged);\n+        await model.refresh();\n+        await promise;\n+        expect(model.headings).toHaveLength(1);\n+      });\n+\n+      it('should be emitted when reloading notebook model', async () => {\n+        // Note: if in future the `NotebookPanel` gets reworked to retain\n+        // widgets for cells which did not change (rather than re-created\n+        // them each time), this test may be no longer needed.\n+\n+        // Setup the notebook model\n+        const content = {\n+          ...utils.DEFAULT_CONTENT,\n+          cells: initialCells\n+        };\n+        let promise = signalToPromise(model.headingsChanged);\n+        panel.model!.fromJSON(content);\n+        await model.refresh();\n+        await promise;\n+\n+        // Simulate update via \"Revert\" button, which will rebuilding the notebook\n+        // widget from scratch (delete old cells and add new cells).\n+        panel.model!.fromJSON(content);\n+\n+        // Should emit because cell references would have changed.\n+        promise = signalToPromise(model.headingsChanged);\n+        await model.refresh();\n+        await promise;\n+      });\n+    });\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-16006",
    "pr_id": 16006,
    "issue_id": 15594,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Page up/page down partially scrolls notebook back\n## Description\r\n\r\nPressing Pg up/pg down in a cell scrolls notebook in unexpected way.\r\n\r\n## Reproduce\r\n\r\n1. Switch windowing mode to full\r\n2. Open a notebook with more cells than fit in the viewport\r\n3. Press pg down in the cell once\r\n4. See that it navigates to top/bottom of the cell (ok)\r\n5. Press pg down in the cell again\r\n6. See that it scrolls notebook (ok)\r\n7. Press pg down in the cell again and again\r\n8. See that notebook scrolls in chaotic way jumping back to the active cell (not ok)\r\n\r\n![unexpected-scroll](https://github.com/jupyterlab/jupyterlab/assets/5832902/bd5e9145-cd83-4131-a8ff-237a927e10fa)\r\n\r\n\r\n## Expected behavior\r\n\r\nScrolling in full windowing mode behaves predictably.\r\n\r\n## Context\r\n\r\n- Browser: Chrome\r\n- JupyterLab version: 4.1.0b0",
    "issue_word_count": 133,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts",
      "packages/cells/src/widget.ts",
      "packages/notebook/src/widget.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts"
    ],
    "base_commit": "9eea31bc38c7118cfe725e2f60a808f0a3e4c05e",
    "head_commit": "438e829ebbc67054ae8ac5c44adf8938ac349861",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/16006",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/16006",
    "dockerfile": "",
    "pr_merged_at": "2024-03-21T19:36:24.000Z",
    "patch": "diff --git a/packages/cells/src/widget.ts b/packages/cells/src/widget.ts\nindex d8a3479d2a93..443083ee7973 100644\n--- a/packages/cells/src/widget.ts\n+++ b/packages/cells/src/widget.ts\n@@ -205,8 +205,9 @@ export class Cell<T extends ICellModel = ICellModel> extends Widget {\n     // For cells disable searching with CodeMirror search panel.\n     this._editorConfig = { searchWithCM: false, ...options.editorConfig };\n     this._editorExtensions = options.editorExtensions ?? [];\n+    this._editorExtensions.push(this._scrollHandlerExtension);\n     this._placeholder = true;\n-    this._inViewport = false;\n+    this._inViewport = null;\n     this.placeholder = options.placeholder ?? true;\n \n     model.metadataChanged.connect(this.onMetadataChanged, this);\n@@ -239,9 +240,14 @@ export class Cell<T extends ICellModel = ICellModel> extends Widget {\n \n   /**\n    * Whether the cell is in viewport or not.\n+   *\n+   * #### Notes\n+   * This property is managed by the windowed container which holds the cell.\n+   * When a cell is not in a windowed container, it always returns `false`,\n+   * but this may change in the future major version.\n    */\n   get inViewport(): boolean {\n-    return this._inViewport;\n+    return this._inViewport ?? false;\n   }\n   set inViewport(v: boolean) {\n     if (this._inViewport !== v) {\n@@ -552,6 +558,13 @@ export class Cell<T extends ICellModel = ICellModel> extends Widget {\n     }\n   }\n \n+  /**\n+   * Signal emitted when cell requests scrolling to its element.\n+   */\n+  get scrollRequested(): ISignal<Cell, Cell.IScrollRequest> {\n+    return this._scrollRequested;\n+  }\n+\n   /**\n    * Create children widgets.\n    */\n@@ -694,13 +707,42 @@ export class Cell<T extends ICellModel = ICellModel> extends Widget {\n   protected translator: ITranslator;\n   protected _displayChanged = new Signal<this, void>(this);\n \n+  /**\n+   * Editor extension emitting `scrollRequested` signal on scroll.\n+   *\n+   * Scrolling within editor will be prevented when a cell is out out viewport.\n+   * Windowed containers including cells should listen to the scroll request\n+   * signal and invoke the `scrollWithinCell()` callback after scrolling the cell\n+   * back into the view (and after updating the `inViewport` property).\n+   */\n+  private _scrollHandlerExtension = EditorView.scrollHandler.of(\n+    (view, range, options) => {\n+      // When cell is in the viewport we can scroll within the editor immediately.\n+      // When cell is out of viewport, the windowed container needs to first\n+      // scroll the cell into the viewport (otherwise CodeMirror is unable to\n+      // calculate the correct scroll delta) before invoking scrolling in editor.\n+      const inWindowedContainer = this._inViewport !== null;\n+      const preventDefault = inWindowedContainer && !this._inViewport;\n+      this._scrollRequested.emit({\n+        defaultPrevented: preventDefault,\n+        scrollWithinCell: () => {\n+          view.dispatch({\n+            effects: EditorView.scrollIntoView(range, options)\n+          });\n+        }\n+      });\n+      return preventDefault;\n+    }\n+  );\n+\n   private _editorConfig: Record<string, any> = {};\n+  private _scrollRequested = new Signal<Cell, Cell.IScrollRequest>(this);\n   private _editorExtensions: Extension[] = [];\n   private _input: InputArea | null;\n   private _inputHidden = false;\n   private _inputWrapper: Widget | null;\n   private _inputPlaceholder: InputPlaceholder | null;\n-  private _inViewport: boolean;\n+  private _inViewport: boolean | null;\n   private _inViewportChanged: Signal<Cell, boolean> = new Signal<Cell, boolean>(\n     this\n   );\n@@ -903,6 +945,25 @@ export namespace Cell {\n       editorFactory: CodeEditor.Factory;\n     }\n   }\n+\n+  /**\n+   * Value of the signal emitted by cell on editor scroll request.\n+   */\n+  export interface IScrollRequest {\n+    /**\n+     * Scrolls to the target cell part, fulfilling the scroll request.\n+     *\n+     * ### Notes\n+     * This method is intended for use by windowed containers that\n+     * require the cell to be first scrolled into the viewport to\n+     * then enable proper scrolling within cell.\n+     */\n+    scrollWithinCell: () => void;\n+    /**\n+     * Whether the default scrolling was prevented due to the cell being out of viewport.\n+     */\n+    defaultPrevented: boolean;\n+  }\n }\n \n /** ****************************************************************************\n\ndiff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex e125fa64176b..59d98756cd1b 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -2132,6 +2132,34 @@ export class Notebook extends StaticNotebook {\n         cell.editor!.edgeRequested.connect(this._onEdgeRequest, this);\n       }\n     });\n+    cell.scrollRequested.connect((_emitter, scrollRequest) => {\n+      if (cell !== this.activeCell) {\n+        // Do nothing for cells other than the active cell\n+        // to avoid scroll requests from editor extensions\n+        // stealing user focus (this may be revisited).\n+        return;\n+      }\n+      if (!scrollRequest.defaultPrevented) {\n+        // Nothing to do if scroll request was already handled.\n+        return;\n+      }\n+      if (cell.inViewport) {\n+        // If cell got scrolled to the viewport in the meantime,\n+        // proceed with scrolling within the cell.\n+        return scrollRequest.scrollWithinCell();\n+      }\n+      // If cell is not in the viewport and needs scrolling,\n+      // first scroll to the cell and then scroll within the cell.\n+      this.scrollToItem(this.activeCellIndex)\n+        .then(() => {\n+          void cell.ready.then(() => {\n+            scrollRequest.scrollWithinCell();\n+          });\n+        })\n+        .catch(reason => {\n+          // no-op\n+        });\n+    });\n     // If the insertion happened above, increment the active cell\n     // index, otherwise it stays the same.\n     this.activeCellIndex =\n@@ -2212,7 +2240,7 @@ export class Notebook extends StaticNotebook {\n     const activeCell = this.activeCell;\n     if (this.mode === 'edit' && activeCell) {\n       // Test for !== true to cover hasFocus is false and editor is not yet rendered.\n-      if (activeCell.editor?.hasFocus() !== true || !activeCell.inViewport) {\n+      if (activeCell.editor?.hasFocus() !== true) {\n         if (activeCell.inViewport) {\n           activeCell.editor?.focus();\n         } else {\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/windowed-notebook.test.ts b/galata/test/jupyterlab/windowed-notebook.test.ts\nindex de25a7f0efc6..095823163e42 100644\n--- a/galata/test/jupyterlab/windowed-notebook.test.ts\n+++ b/galata/test/jupyterlab/windowed-notebook.test.ts\n@@ -208,33 +208,101 @@ for (const cellType of ['code', 'markdown']) {\n   });\n }\n \n-test('should scroll back to the cell below the active cell on arrow down key', async ({\n-  page,\n-  tmpPath\n-}) => {\n-  await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n-\n-  // Activate the first cell.\n-  await page.notebook.selectCells(0);\n-  const h = await page.notebook.getNotebookInPanelLocator();\n-  const firstCell = h!.locator('.jp-Cell[data-windowed-list-index=\"0\"]');\n-  const secondCell = h!.locator('.jp-Cell[data-windowed-list-index=\"1\"]');\n-  await firstCell.waitFor();\n-  await secondCell.waitFor();\n-\n-  const bbox = await h!.boundingBox();\n-  await page.mouse.move(bbox!.x, bbox!.y);\n-  await Promise.all([\n-    firstCell.waitFor({ state: 'hidden' }),\n-    secondCell.waitFor({ state: 'hidden' }),\n-    page.mouse.wheel(0, 1200)\n-  ]);\n-\n-  // Select cell below the active cell\n-  await page.keyboard.press('ArrowDown');\n-\n-  // Expect the second cell to become visible again.\n-  await secondCell.waitFor({ state: 'visible' });\n+const scrollOnKeyPressCases: {\n+  key: string;\n+  showCell: 'first' | 'second' | 'neither';\n+  times: number;\n+  enterEditor: boolean;\n+}[] = [\n+  {\n+    // When pressing arrow down the second cell should become selected.\n+    key: 'ArrowDown',\n+    showCell: 'second',\n+    times: 1,\n+    enterEditor: false\n+  },\n+  {\n+    // Pressing Alt does not cause any input nor cursor movement so it should\n+    // not cause any scrolling. This test in particular tests against an easy\n+    // mistake of force-focusing the active editor which is out of view which\n+    // can cause partial scrolling in the direction of the editor. Because the\n+    // scrolling is only partial multiple presses are needed.\n+    key: 'Alt',\n+    showCell: 'neither',\n+    times: 10,\n+    enterEditor: true\n+  },\n+  {\n+    // Because the cursor starts at the beginning of the first cell, a single\n+    // press of PageDown should just move the cursor to the end, which should\n+    // reveal the editor by scrolling to the first cell.\n+    key: 'PageDown',\n+    showCell: 'first',\n+    times: 1,\n+    enterEditor: true\n+  },\n+  {\n+    // Pressing `PageDown` multiple times should scroll the notebook in a way\n+    // which hides both cells (even though the first press would reveal them).\n+    key: 'PageDown',\n+    showCell: 'neither',\n+    times: 10,\n+    enterEditor: true\n+  }\n+];\n+test.describe('Scrolling on keyboard interaction when active editor is above the viewport', () => {\n+  for (const testCase of scrollOnKeyPressCases) {\n+    test(`Show ${testCase.showCell} cell on pressing ${testCase.key} ${testCase.times} times`, async ({\n+      page,\n+      tmpPath\n+    }) => {\n+      await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n+\n+      // Activate the first cell.\n+      await page.notebook.selectCells(0);\n+      const h = await page.notebook.getNotebookInPanelLocator();\n+      const firstCell = h!.locator('.jp-Cell[data-windowed-list-index=\"0\"]');\n+      const secondCell = h!.locator('.jp-Cell[data-windowed-list-index=\"1\"]');\n+      await firstCell.waitFor();\n+      await secondCell.waitFor();\n+\n+      if (testCase.enterEditor) {\n+        await page.notebook.enterCellEditingMode(0);\n+        // Move cursor in the first cell to the beginning of the source code\n+        await page.keyboard.press('Home');\n+      }\n+\n+      // Position the mouse in the bounding box to allow for scrolling with mouse wheel\n+      const bbox = await h!.boundingBox();\n+      await page.mouse.move(bbox!.x, bbox!.y);\n+\n+      // Scroll down to hide the first and second cell\n+      await Promise.all([\n+        firstCell.waitFor({ state: 'hidden' }),\n+        secondCell.waitFor({ state: 'hidden' }),\n+        page.mouse.wheel(0, 1200)\n+      ]);\n+\n+      // Press the key as many times as requested\n+      for (let i = 0; i < testCase.times; i++) {\n+        await page.keyboard.press(testCase.key);\n+        // Allow for small delay between pressing keys\n+        await page.waitForTimeout(100);\n+      }\n+\n+      if (testCase.showCell === 'neither') {\n+        // For negative test case we need to add an explicit timeout to test\n+        // against the possibility of the scroll happening with a small delay.\n+        await page.waitForTimeout(400);\n+        await expect(firstCell).toBeHidden();\n+        await expect(secondCell).toBeHidden();\n+      } else {\n+        const cell = testCase.showCell === 'first' ? firstCell : secondCell;\n+        // Expect the cell to become visible again.\n+        await cell.waitFor({ state: 'visible' });\n+      }\n+    });\n+  }\n });\n \n test('should detach a markdown code cell when scrolling out of the viewport', async ({\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15970",
    "pr_id": 15970,
    "issue_id": 15465,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Navigating many cells in notebook is slow/crashes browser\n## Description\r\n\r\nThe experience of switching cells in command mode in notebook has regressed in pre-releases.\r\n\r\n## Reproduce\r\n\r\n2. Open a notebook with 100 cells\r\n3. Select a cell in **command** mode\r\n4. Press down arrow and keep it down\r\n5. See that active cell jumps by 10 or 20 cells at a time - not the greatest experience \"nothing happens\"\r\n6. Press up arrow and keep it down\r\n7. See that nothing happens and browser crashes; it does take about 45 seconds of pressing the arrow up key to crash it.\r\n\r\n![crash-on-arrow-up](https://github.com/jupyterlab/jupyterlab/assets/5832902/059c8dc5-dcb8-43cc-934e-3225f1ec3374)\r\n\r\nI was able to crash browser in both `full` windowed and `none` modes. Crashing may be due to some unstable feature I use so it is not \"that bad\" until confirmed but there is something wrong.\r\n\r\n```\r\nwindowedlist.ts:1002 [Violation] 'requestAnimationFrame' handler took 77ms\r\nwindowedlist.ts:1002 [Violation] 'requestAnimationFrame' handler took 158ms\r\nbridge.js:61 [Violation] 'setTimeout' handler took 58ms\r\nwindowedlist.ts:1002 [Violation] 'requestAnimationFrame' handler took 99ms\r\n42[Violation] 'keydown' handler took <N>ms\r\nbridge.js:61 [Violation] 'setTimeout' handler took 50ms\r\n````\r\n\r\n## Expected behavior\r\n\r\nI expect to see the cells switching as I keep the arrow keys pressed so that I know when I arrived at my destination cell.\r\n\r\n## Context\r\n\r\n- Operating System and version: Ubuntu\r\n- Browser and version: Edge 120.0.2210.22\r\n- JupyterLab version: 4.0.0a4 and earlier (to be checked)",
    "issue_word_count": 249,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/test/listing.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/listing.spec.ts"
    ],
    "base_commit": "4df55ca002fdd83773aaacc7f390b2051a3d7e0f",
    "head_commit": "1e4e064f0bba784886e351ced01043c669aaea2e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15970",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15970",
    "dockerfile": "",
    "pr_merged_at": "2024-03-13T09:24:03.000Z",
    "patch": "diff --git a/packages/filebrowser/src/listing.ts b/packages/filebrowser/src/listing.ts\nindex c5a60b830970..050a4094e02a 100644\n--- a/packages/filebrowser/src/listing.ts\n+++ b/packages/filebrowser/src/listing.ts\n@@ -647,6 +647,28 @@ export class DirListing extends Widget {\n    * @returns A promise that resolves when the name is selected.\n    */\n   async selectItemByName(name: string, focus: boolean = false): Promise<void> {\n+    return this._selectItemByName(name, focus);\n+  }\n+\n+  /**\n+   * Select an item by name.\n+   *\n+   * @param name - The name of the item to select.\n+   * @param focus - Whether to move focus to the selected item.\n+   * @param force - Whether to proceed with selection even if the file was already selected.\n+   *\n+   * @returns A promise that resolves when the name is selected.\n+   */\n+  private async _selectItemByName(\n+    name: string,\n+    focus: boolean = false,\n+    force: boolean = false\n+  ): Promise<void> {\n+    if (!force && this.isSelected(name)) {\n+      // Avoid API polling and DOM updates if already selected\n+      return;\n+    }\n+\n     // Make sure the file is available.\n     await this.model.refresh();\n \n@@ -662,7 +684,6 @@ export class DirListing extends Widget {\n     MessageLoop.sendMessage(this, Widget.Msg.UpdateRequest);\n     ElementExt.scrollIntoViewIfNeeded(this.contentNode, this._items[index]);\n   }\n-\n   /**\n    * Handle the DOM events for the directory listing.\n    *\n@@ -1935,7 +1956,7 @@ export class DirListing extends Widget {\n       this.selection[item.path]\n     ) {\n       try {\n-        await this.selectItemByName(finalFilename, true);\n+        await this._selectItemByName(finalFilename, true, true);\n       } catch {\n         // do nothing\n         console.warn('After rename, failed to select file', finalFilename);\n",
    "test_patch": "diff --git a/packages/filebrowser/test/listing.spec.ts b/packages/filebrowser/test/listing.spec.ts\nindex 71f89ac70a40..9a2f88650d91 100644\n--- a/packages/filebrowser/test/listing.spec.ts\n+++ b/packages/filebrowser/test/listing.spec.ts\n@@ -7,7 +7,7 @@ import { DocumentManager } from '@jupyterlab/docmanager';\n import { DocumentRegistry } from '@jupyterlab/docregistry';\n import { DocumentWidgetOpenerMock } from '@jupyterlab/docregistry/lib/testutils';\n import { ServiceManagerMock } from '@jupyterlab/services/lib/testutils';\n-import { signalToPromise } from '@jupyterlab/testing';\n+import { framePromise, signalToPromise } from '@jupyterlab/testing';\n import { Signal } from '@lumino/signaling';\n import { Widget } from '@lumino/widgets';\n import expect from 'expect';\n@@ -101,6 +101,42 @@ describe('filebrowser/listing', () => {\n       });\n     });\n \n+    describe('#selectItemByName()', () => {\n+      it('should select item in the current directory by name', async () => {\n+        const name = [...dirListing.sortedItems()][2].name;\n+        expect(dirListing.isSelected(name)).toBe(false);\n+        await dirListing.selectItemByName(name);\n+        expect(dirListing.isSelected(name)).toBe(true);\n+      });\n+\n+      it('should trigger update when selecting an item', async () => {\n+        const name = [...dirListing.sortedItems()][2].name;\n+        let updateEmitted = false;\n+        const listener = () => {\n+          updateEmitted = true;\n+        };\n+        dirListing.updated.connect(listener);\n+        await dirListing.selectItemByName(name);\n+        await framePromise();\n+        dirListing.updated.disconnect(listener);\n+        expect(updateEmitted).toBe(true);\n+      });\n+\n+      it('should be a no-op if the item is already selected', async () => {\n+        const name = [...dirListing.sortedItems()][2].name;\n+        await dirListing.selectItemByName(name);\n+        let updateEmitted = false;\n+        const listener = () => {\n+          updateEmitted = true;\n+        };\n+        dirListing.updated.connect(listener);\n+        await dirListing.selectItemByName(name);\n+        await framePromise();\n+        dirListing.updated.disconnect(listener);\n+        expect(updateEmitted).toBe(false);\n+      });\n+    });\n+\n     describe('#rename', () => {\n       it('backspace during rename does not trigger goUp method', async () => {\n         dirListing.selectNext();\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15969",
    "pr_id": 15969,
    "issue_id": 13838,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Remove `node-fetch` from the `testing` package\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n<!--\r\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\r\n\r\n\r\nBefore creating a new feature request please search the issues for relevant feature requests.\r\n-->\r\n\r\n### Problem\r\n\r\n`node-fetch` is currently still used in the `testing` package: https://github.com/jupyterlab/jupyterlab/blob/aa3e1e07ffbe3db40c7ee71662114513b5492360/packages/testing/package.json#L47\r\n\r\nAs a follow-up to https://github.com/jupyterlab/jupyterlab/pull/13722, we should look into removing it now that Node 18 supports `fetch` by default.\r\n\r\n### Proposed Solution\r\n\r\nSimplify the testing setup by removing `node-fetch` if possible.\r\n\r\n### Additional context\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/pull/13722",
    "issue_word_count": 153,
    "test_files_count": 13,
    "non_test_files_count": 5,
    "pr_changed_files": [
      ".gitpod.yml",
      "buildutils/src/ensure-repo.ts",
      "docs/source/developer/contributing.rst",
      "docs/source/extension/extension_tutorial.rst",
      "packages/docregistry/test/context.spec.ts",
      "packages/services/test/config/config.spec.ts",
      "packages/services/test/contents/index.spec.ts",
      "packages/services/test/kernel/ikernel.spec.ts",
      "packages/services/test/kernel/kernel.spec.ts",
      "packages/services/test/kernelspec/kernelspec.spec.ts",
      "packages/services/test/serverconnection.spec.ts",
      "packages/services/test/utils.ts",
      "packages/testing/package.json",
      "packages/testing/src/jest-config.ts",
      "packages/testing/src/jest-env.ts",
      "packages/testing/src/jest-shim.ts",
      "packages/testing/test/start_jupyter_server.spec.ts",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "packages/docregistry/test/context.spec.ts",
      "packages/services/test/config/config.spec.ts",
      "packages/services/test/contents/index.spec.ts",
      "packages/services/test/kernel/ikernel.spec.ts",
      "packages/services/test/kernel/kernel.spec.ts",
      "packages/services/test/kernelspec/kernelspec.spec.ts",
      "packages/services/test/serverconnection.spec.ts",
      "packages/services/test/utils.ts",
      "packages/testing/package.json",
      "packages/testing/src/jest-config.ts",
      "packages/testing/src/jest-env.ts",
      "packages/testing/src/jest-shim.ts",
      "packages/testing/test/start_jupyter_server.spec.ts"
    ],
    "base_commit": "cdca0a20ba84af21922c390c46e086e50120d4cc",
    "head_commit": "f550588b9232ca10e8d6017a0830274ec46b5faa",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15969",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15969",
    "dockerfile": "",
    "pr_merged_at": "2024-03-14T10:36:42.000Z",
    "patch": "diff --git a/.gitpod.yml b/.gitpod.yml\nindex 29b966087967..3e1c3426126e 100644\n--- a/.gitpod.yml\n+++ b/.gitpod.yml\n@@ -25,7 +25,7 @@ tasks:\n       EOT\n       source /workspace/bin/activate-env.sh\n       micromamba config append channels conda-forge\n-      micromamba install -n base -y python=3.10 nodejs=18 yarn\n+      micromamba install -n base -y python=3.10 nodejs=20 yarn\n       source /workspace/bin/activate-env.sh\n       python -m pip install -e \".[dev,docs,test]\" && jlpm install && jlpm run build\n       gp sync-done setup\n\ndiff --git a/buildutils/src/ensure-repo.ts b/buildutils/src/ensure-repo.ts\nindex bf87e0c59f5d..eb426797f363 100644\n--- a/buildutils/src/ensure-repo.ts\n+++ b/buildutils/src/ensure-repo.ts\n@@ -120,7 +120,6 @@ const UNUSED: Dict<string[]> = {\n     '@babel/core',\n     '@babel/preset-env',\n     'fs-extra',\n-    'node-fetch',\n     'identity-obj-proxy',\n     'jest-environment-jsdom',\n     'jest-junit'\n\ndiff --git a/docs/source/developer/contributing.rst b/docs/source/developer/contributing.rst\nindex 46284e1d948e..881ca3470602 100644\n--- a/docs/source/developer/contributing.rst\n+++ b/docs/source/developer/contributing.rst\n@@ -309,7 +309,7 @@ Installing Node.js and jlpm\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n Building JupyterLab from its GitHub source code requires Node.js. The\n-development version requires Node.js version 18+, as defined in the\n+development version requires Node.js version 20+, as defined in the\n ``engines`` specification in\n `dev_mode/package.json <https://github.com/jupyterlab/jupyterlab/blob/main/dev_mode/package.json>`__.\n \n\ndiff --git a/docs/source/extension/extension_tutorial.rst b/docs/source/extension/extension_tutorial.rst\nindex 38722861f8a5..41bbb926f480 100644\n--- a/docs/source/extension/extension_tutorial.rst\n+++ b/docs/source/extension/extension_tutorial.rst\n@@ -66,7 +66,7 @@ new environment named ``jupyterlab-ext``.\n \n .. code:: bash\n \n-    conda create -n jupyterlab-ext --override-channels --strict-channel-priority -c conda-forge -c nodefaults jupyterlab=4 nodejs=18 git copier=7 jinja2-time\n+    conda create -n jupyterlab-ext --override-channels --strict-channel-priority -c conda-forge -c nodefaults jupyterlab=4 nodejs=20 git copier=7 jinja2-time\n \n Now activate the new environment so that all further commands you run\n work out of that environment.\n\ndiff --git a/yarn.lock b/yarn.lock\nindex 88ef232648b3..bfb6226d98cf 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -4825,14 +4825,12 @@ __metadata:\n     \"@lumino/signaling\": ^2.1.2\n     \"@types/jest\": ^29.2.0\n     \"@types/node\": ^18.11.18\n-    \"@types/node-fetch\": ^2.6.2\n     deepmerge: ^4.2.2\n     fs-extra: ^10.1.0\n     identity-obj-proxy: ^3.0.0\n     jest: ^29.2.0\n     jest-environment-jsdom: ^29.3.0\n     jest-junit: ^15.0.0\n-    node-fetch: ^2.6.0\n     rimraf: ~5.0.5\n     simulate-event: ~1.4.0\n     ts-jest: ^29.1.0\n@@ -7050,16 +7048,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@types/node-fetch@npm:^2.6.2\":\n-  version: 2.6.2\n-  resolution: \"@types/node-fetch@npm:2.6.2\"\n-  dependencies:\n-    \"@types/node\": \"*\"\n-    form-data: ^3.0.0\n-  checksum: 6f73b1470000d303d25a6fb92875ea837a216656cb7474f66cdd67bb014aa81a5a11e7ac9c21fe19bee9ecb2ef87c1962bceeaec31386119d1ac86e4c30ad7a6\n-  languageName: node\n-  linkType: hard\n-\n \"@types/node@npm:*, @types/node@npm:^18.11.18\":\n   version: 18.15.0\n   resolution: \"@types/node@npm:18.15.0\"\n@@ -12039,17 +12027,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"form-data@npm:^3.0.0\":\n-  version: 3.0.1\n-  resolution: \"form-data@npm:3.0.1\"\n-  dependencies:\n-    asynckit: ^0.4.0\n-    combined-stream: ^1.0.8\n-    mime-types: ^2.1.12\n-  checksum: b019e8d35c8afc14a2bd8a7a92fa4f525a4726b6d5a9740e8d2623c30e308fbb58dc8469f90415a856698933c8479b01646a9dff33c87cc4e76d72aedbbf860d\n-  languageName: node\n-  linkType: hard\n-\n \"form-data@npm:^4.0.0\":\n   version: 4.0.0\n   resolution: \"form-data@npm:4.0.0\"\n@@ -16291,7 +16268,7 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"node-fetch@npm:2.6.7, node-fetch@npm:^2.6.0, node-fetch@npm:^2.6.7, node-fetch@npm:cjs\":\n+\"node-fetch@npm:2.6.7, node-fetch@npm:^2.6.7, node-fetch@npm:cjs\":\n   version: 2.6.7\n   resolution: \"node-fetch@npm:2.6.7\"\n   dependencies:\n",
    "test_patch": "diff --git a/packages/docregistry/test/context.spec.ts b/packages/docregistry/test/context.spec.ts\nindex d0bb2f298e11..fc92f62306fe 100644\n--- a/packages/docregistry/test/context.spec.ts\n+++ b/packages/docregistry/test/context.spec.ts\n@@ -259,7 +259,7 @@ describe('docregistry/context', () => {\n         });\n \n         await expect(context.initialize(true)).rejects.toThrow(\n-          'Invalid response: 403 Forbidden'\n+          /Invalid response: 403/\n         );\n         expect(called).toBe(2);\n         expect(checked).toBe('failed');\n\ndiff --git a/packages/services/test/config/config.spec.ts b/packages/services/test/config/config.spec.ts\nindex fb052861f599..8b3517d948d6 100644\n--- a/packages/services/test/config/config.spec.ts\n+++ b/packages/services/test/config/config.spec.ts\n@@ -50,9 +50,7 @@ describe('config', () => {\n         name: randomName(),\n         serverSettings\n       });\n-      await expect(configPromise).rejects.toThrow(\n-        /Invalid response: 201 Created/\n-      );\n+      await expect(configPromise).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n \n@@ -83,7 +81,7 @@ describe('config', () => {\n       const config = await ConfigSection.create({ name: randomName() });\n       handleRequest(config, 201, {});\n       const update = config.update({ foo: 'baz' });\n-      await expect(update).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(update).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n });\n@@ -198,7 +196,7 @@ describe('jupyter.services - ConfigWithDefaults', () => {\n       const config = new ConfigWithDefaults({ section });\n       const set = config.set('foo', 'bar');\n       expect(section.data['foo']).toBe('bar');\n-      await expectFailure(set, 'Invalid response: 201 Created');\n+      await expectFailure(set, 'Invalid response: 201');\n     });\n   });\n });\n\ndiff --git a/packages/services/test/contents/index.spec.ts b/packages/services/test/contents/index.spec.ts\nindex e909bdee26fd..7bb19632bc77 100644\n--- a/packages/services/test/contents/index.spec.ts\n+++ b/packages/services/test/contents/index.spec.ts\n@@ -260,7 +260,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 201, DEFAULT_DIR);\n       const get = contents.get('/foo');\n-      await expect(get).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(get).rejects.toThrow(/Invalid response: 201/);\n     });\n \n     it('should store original server path for directory', async () => {\n@@ -393,7 +393,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 200, DEFAULT_DIR);\n       const newDir = contents.newUntitled();\n-      await expect(newDir).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(newDir).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -428,7 +428,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 200, {});\n       const del = contents.delete('/foo/bar.txt');\n-      await expect(del).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(del).rejects.toThrow(/Invalid response: 200/);\n     });\n \n     it('should throw a specific error', async () => {\n@@ -488,7 +488,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 201, DEFAULT_FILE);\n       const rename = contents.rename('/foo/bar.txt', '/foo/baz.txt');\n-      await expect(rename).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(rename).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n \n@@ -540,7 +540,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 204, DEFAULT_FILE);\n       const save = contents.save('/foo', { type: 'file', name: 'test' });\n-      await expect(save).rejects.toThrow(/Invalid response: 204 No Content/);\n+      await expect(save).rejects.toThrow(/Invalid response: 204/);\n     });\n   });\n \n@@ -583,7 +583,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 200, DEFAULT_FILE);\n       const copy = contents.copy('/foo/bar.txt', '/baz');\n-      await expect(copy).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(copy).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -615,7 +615,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 200, DEFAULT_CP);\n       const checkpoint = contents.createCheckpoint('/foo/bar.txt');\n-      await expect(checkpoint).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(checkpoint).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -650,9 +650,7 @@ describe('contents', () => {\n     it('should fail for an incorrect response', async () => {\n       handleRequest(contents, 201, {});\n       const checkpoints = contents.listCheckpoints('/foo/bar.txt');\n-      await expect(checkpoints).rejects.toThrow(\n-        /Invalid response: 201 Created/\n-      );\n+      await expect(checkpoints).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n \n@@ -683,7 +681,7 @@ describe('contents', () => {\n         '/foo/bar.txt',\n         DEFAULT_CP.id\n       );\n-      await expect(checkpoint).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(checkpoint).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -710,7 +708,7 @@ describe('contents', () => {\n         '/foo/bar.txt',\n         DEFAULT_CP.id\n       );\n-      await expect(checkpoint).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(checkpoint).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n });\n@@ -821,7 +819,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 201, DEFAULT_DIR);\n       const get = drive.get('/foo');\n-      await expect(get).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(get).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n \n@@ -918,7 +916,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 200, DEFAULT_DIR);\n       const newDir = drive.newUntitled();\n-      await expect(newDir).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(newDir).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -953,7 +951,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 200, {});\n       const del = drive.delete('/foo/bar.txt');\n-      await expect(del).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(del).rejects.toThrow(/Invalid response: 200/);\n     });\n \n     it('should throw a specific error', async () => {\n@@ -1015,7 +1013,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 201, DEFAULT_FILE);\n       const rename = drive.rename('/foo/bar.txt', '/foo/baz.txt');\n-      await expect(rename).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(rename).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n \n@@ -1071,7 +1069,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 204, DEFAULT_FILE);\n       const save = drive.save('/foo', { type: 'file', name: 'test' });\n-      await expect(save).rejects.toThrow(/Invalid response: 204 No Content/);\n+      await expect(save).rejects.toThrow(/Invalid response: 204/);\n     });\n   });\n \n@@ -1117,7 +1115,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 200, DEFAULT_FILE);\n       const copy = drive.copy('/foo/bar.txt', '/baz');\n-      await expect(copy).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(copy).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -1151,7 +1149,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 200, DEFAULT_CP);\n       const checkpoint = drive.createCheckpoint('/foo/bar.txt');\n-      await expect(checkpoint).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(checkpoint).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -1188,9 +1186,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 201, {});\n       const checkpoints = drive.listCheckpoints('/foo/bar.txt');\n-      await expect(checkpoints).rejects.toThrow(\n-        /Invalid response: 201 Created/\n-      );\n+      await expect(checkpoints).rejects.toThrow(/Invalid response: 201/);\n     });\n   });\n \n@@ -1213,7 +1209,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 200, {});\n       const checkpoint = drive.restoreCheckpoint('/foo/bar.txt', DEFAULT_CP.id);\n-      await expect(checkpoint).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(checkpoint).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n@@ -1238,7 +1234,7 @@ describe('drive', () => {\n       const drive = new Drive();\n       handleRequest(drive, 200, {});\n       const checkpoint = drive.deleteCheckpoint('/foo/bar.txt', DEFAULT_CP.id);\n-      await expect(checkpoint).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(checkpoint).rejects.toThrow(/Invalid response: 200/);\n     });\n   });\n \n\ndiff --git a/packages/services/test/kernel/ikernel.spec.ts b/packages/services/test/kernel/ikernel.spec.ts\nindex 26de78d7e063..e2b7995b6885 100644\n--- a/packages/services/test/kernel/ikernel.spec.ts\n+++ b/packages/services/test/kernel/ikernel.spec.ts\n@@ -620,7 +620,7 @@ describe('Kernel.IKernel', () => {\n         name: defaultKernel.name\n       });\n       const interrupt = defaultKernel.interrupt();\n-      await expect(interrupt).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(interrupt).rejects.toThrow(/Invalid response: 200/);\n     });\n \n     it('should throw an error for an error response', async () => {\n@@ -668,7 +668,7 @@ describe('Kernel.IKernel', () => {\n       const { id, name } = defaultKernel;\n       handleRequest(defaultKernel, 205, { id, name });\n       await expect(defaultKernel.restart()).rejects.toThrow(\n-        /Invalid response: 205 Reset Content/\n+        /Invalid response: 205/\n       );\n     });\n \n@@ -737,7 +737,7 @@ describe('Kernel.IKernel', () => {\n         name: 'foo'\n       });\n       const shutdown = defaultKernel.shutdown();\n-      await expect(shutdown).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(shutdown).rejects.toThrow(/Invalid response: 200/);\n     });\n \n     it('should handle a 404 error', async () => {\n\ndiff --git a/packages/services/test/kernel/kernel.spec.ts b/packages/services/test/kernel/kernel.spec.ts\nindex 512d537be211..32d5facf2e1a 100644\n--- a/packages/services/test/kernel/kernel.spec.ts\n+++ b/packages/services/test/kernel/kernel.spec.ts\n@@ -65,7 +65,7 @@ describe('kernel', () => {\n     it('should throw an error for an invalid response', async () => {\n       const settings = getRequestHandler(201, {});\n       const promise = KernelAPI.listRunning(settings);\n-      await expect(promise).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(promise).rejects.toThrow(/Invalid response: 201/);\n     });\n \n     it('should throw an error for an error response', async () => {\n@@ -116,7 +116,7 @@ describe('kernel', () => {\n       const data = { id: UUID.uuid4(), name: 'foo' };\n       const serverSettings = getRequestHandler(200, data);\n       const kernelPromise = KernelAPI.startNew({}, serverSettings);\n-      await expect(kernelPromise).rejects.toThrow(/Invalid response: 200 OK/);\n+      await expect(kernelPromise).rejects.toThrow(/Invalid response: 200/);\n     });\n \n     it('should throw an error for an error response', async () => {\n\ndiff --git a/packages/services/test/kernelspec/kernelspec.spec.ts b/packages/services/test/kernelspec/kernelspec.spec.ts\nindex e52a2b8795ea..4c46b84427a5 100644\n--- a/packages/services/test/kernelspec/kernelspec.spec.ts\n+++ b/packages/services/test/kernelspec/kernelspec.spec.ts\n@@ -121,7 +121,7 @@ describe('kernel', () => {\n     it('should throw an error for an invalid response', async () => {\n       const serverSettings = getRequestHandler(201, {});\n       const promise = KernelSpecAPI.getSpecs(serverSettings);\n-      await expect(promise).rejects.toThrow(/Invalid response: 201 Created/);\n+      await expect(promise).rejects.toThrow(/Invalid response: 201/);\n     });\n \n     it('should handle metadata', async () => {\n\ndiff --git a/packages/services/test/serverconnection.spec.ts b/packages/services/test/serverconnection.spec.ts\nindex bc428b8f45f5..9b79999f9b12 100644\n--- a/packages/services/test/serverconnection.spec.ts\n+++ b/packages/services/test/serverconnection.spec.ts\n@@ -26,7 +26,7 @@ describe('ServerConnection', () => {\n         {},\n         settings\n       );\n-      expect(response.statusText).toBe('OK');\n+      expect(response.status).toBe(200);\n       const data = await response.json();\n       expect(data).toBe('hello');\n     });\n@@ -87,7 +87,7 @@ describe('ServerConnection', () => {\n         settings\n       );\n       const err = new ServerConnection.ResponseError(response);\n-      expect(err.message).toBe('Invalid response: 200 OK');\n+      expect(err.message).toBe('Invalid response: 200 ');\n     });\n   });\n \n\ndiff --git a/packages/services/test/utils.ts b/packages/services/test/utils.ts\nindex 58d9bda7f90d..786140b4459c 100644\n--- a/packages/services/test/utils.ts\n+++ b/packages/services/test/utils.ts\n@@ -100,7 +100,7 @@ export function getRequestHandler(\n   // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n   body: any\n ): ServerConnection.ISettings {\n-  const fetch = (info: RequestInfo, init: RequestInit) => {\n+  const customFetch = (info: RequestInfo, init?: RequestInit) => {\n     // Normalize the body.\n     body = JSON.stringify(body);\n \n@@ -108,7 +108,7 @@ export function getRequestHandler(\n     const response = new Response(body, { status });\n     return Promise.resolve(response as any);\n   };\n-  return ServerConnection.makeSettings({ fetch });\n+  return ServerConnection.makeSettings({ fetch: customFetch });\n }\n \n /**\n@@ -135,6 +135,10 @@ export function handleRequest(item: IService, status: number, body: any): void {\n     if (typeof body !== 'string') {\n       body = JSON.stringify(body);\n     }\n+    // Body should be null for these status codes\n+    if (status === 204 || status === 205) {\n+      body = null;\n+    }\n \n     // Create the response and return it as a promise.\n     const response = new Response(body, { status });\n\ndiff --git a/packages/testing/package.json b/packages/testing/package.json\nindex 07ef169a6467..1ff670fd42d9 100644\n--- a/packages/testing/package.json\n+++ b/packages/testing/package.json\n@@ -44,14 +44,12 @@\n     \"jest\": \"^29.2.0\",\n     \"jest-environment-jsdom\": \"^29.3.0\",\n     \"jest-junit\": \"^15.0.0\",\n-    \"node-fetch\": \"^2.6.0\",\n     \"simulate-event\": \"~1.4.0\",\n     \"ts-jest\": \"^29.1.0\"\n   },\n   \"devDependencies\": {\n     \"@types/jest\": \"^29.2.0\",\n     \"@types/node\": \"^18.11.18\",\n-    \"@types/node-fetch\": \"^2.6.2\",\n     \"rimraf\": \"~5.0.5\",\n     \"typescript\": \"~5.1.6\"\n   },\n\ndiff --git a/packages/testing/src/jest-config.ts b/packages/testing/src/jest-config.ts\nindex 9c1c5ccaac85..6e0f356e5fd7 100644\n--- a/packages/testing/src/jest-config.ts\n+++ b/packages/testing/src/jest-config.ts\n@@ -22,7 +22,7 @@ const esModules = [\n \n module.exports = function (baseDir: string) {\n   return {\n-    testEnvironment: 'jsdom',\n+    testEnvironment: '@jupyterlab/testing/lib/jest-env.js',\n     moduleNameMapper: {\n       '\\\\.(css|less|sass|scss)$': 'identity-obj-proxy',\n       '\\\\.(gif|ttf|eot)$': '@jupyterlab/testing/lib/jest-file-mock.js'\n\ndiff --git a/packages/testing/src/jest-env.ts b/packages/testing/src/jest-env.ts\nnew file mode 100644\nindex 000000000000..35a9d1bf7f4d\n--- /dev/null\n+++ b/packages/testing/src/jest-env.ts\n@@ -0,0 +1,21 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+// From: https://github.com/jsdom/jsdom/issues/1724#issuecomment-1446858041\n+\n+import JSDOMEnvironment from 'jest-environment-jsdom';\n+\n+// https://github.com/facebook/jest/blob/v29.4.3/website/versioned_docs/version-29.4/Configuration.md#testenvironment-string\n+export default class FixJSDOMEnvironment extends JSDOMEnvironment {\n+  constructor(...args: ConstructorParameters<typeof JSDOMEnvironment>) {\n+    super(...args);\n+\n+    // FIXME https://github.com/jsdom/jsdom/issues/1724\n+    this.global.fetch = fetch;\n+    this.global.Headers = Headers;\n+    this.global.Request = Request;\n+    this.global.Response = Response;\n+  }\n+}\n\ndiff --git a/packages/testing/src/jest-shim.ts b/packages/testing/src/jest-shim.ts\nindex e11cb703d626..ab8e976fd101 100644\n--- a/packages/testing/src/jest-shim.ts\n+++ b/packages/testing/src/jest-shim.ts\n@@ -18,11 +18,6 @@ if (\n   globalThis.TextEncoder = util.TextEncoder;\n }\n \n-const fetchMod = ((window as any).fetch = require('node-fetch'));\n-(window as any).Request = fetchMod.Request;\n-(window as any).Headers = fetchMod.Headers;\n-(window as any).Response = fetchMod.Response;\n-\n globalThis.Image = (window as any).Image;\n globalThis.Range = function Range() {\n   /* no-op */\n\ndiff --git a/packages/testing/test/start_jupyter_server.spec.ts b/packages/testing/test/start_jupyter_server.spec.ts\nindex 49ac88dc56a8..83ac2ddce134 100644\n--- a/packages/testing/test/start_jupyter_server.spec.ts\n+++ b/packages/testing/test/start_jupyter_server.spec.ts\n@@ -1,8 +1,6 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-const fetch = require('node-fetch');\n-\n import { PageConfig, URLExt } from '@jupyterlab/coreutils';\n import { JupyterServer } from '@jupyterlab/testing';\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15962",
    "pr_id": 15962,
    "issue_id": 15808,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Flaky js-terminal test `getRasterizedGlyph`\n## Description\r\n\r\nThe js-terminal test fails from time to time with:\r\n\r\n```\r\n  â— terminal/index â€º Terminal â€º #session â€º should set the title when ready\r\n\r\n    TypeError: Cannot read properties of undefined (reading 'getRasterizedGlyph')\r\n\r\n      at l.cell [as _drawChars] (../../node_modules/xterm-addon-canvas/lib/webpack:/CanvasAddon/src/BaseRenderLayer.ts:374:50)\r\n      at handleGridChanged (../../node_modules/xterm-addon-canvas/lib/webpack:/CanvasAddon/src/TextRenderLayer.ts:246:10)\r\n      at l._drawBackground [as _forEachCell] (../../node_modules/xterm-addon-canvas/lib/webpack:/CanvasAddon/src/TextRenderLayer.ts:162:11)\r\n      at l.cell [as _drawForeground] (../../node_modules/xterm-addon-canvas/lib/webpack:/CanvasAddon/src/TextRenderLayer.ts:243:43)\r\n      at lastRow [as handleGridChanged] (../../node_modules/xterm-addon-canvas/lib/webpack:/CanvasAddon/src/TextRenderLayer.ts:258:36)\r\n      at _.end [as renderRows] (../../node_modules/xterm-addon-canvas/lib/webpack:/CanvasAddon/src/CanvasRenderer.ts:139:34)\r\n      at u.this [as _renderRows] (../../node_modules/xterm/lib/webpack:/xterm/src/browser/services/RenderService.ts:158:9)\r\n      at t.RenderDebouncer.this [as _renderCallback] (../../node_modules/xterm/lib/webpack:/xterm/src/browser/services/RenderService.ts:70:5)\r\n      at t.RenderDebouncer.end [as _innerRefresh] (../../node_modules/xterm/lib/webpack:/xterm/src/browser/RenderDebouncer.ts:73:33)\r\n      at _innerRefresh (../../node_modules/xterm/lib/webpack:/xterm/src/browser/RenderDebouncer.ts:55:11)\r\n      at invokeTheCallbackFunction (../../node_modules/jsdom/lib/jsdom/living/generated/Function.js:19:26)\r\n      at runAnimationFrameCallbacks (../../node_modules/jsdom/lib/jsdom/browser/Window.js:603:13)\r\n      at Timeout._onTimeout (../../node_modules/jsdom/lib/jsdom/browser/Window.js:581:11)\r\n```\r\n\r\n\r\nThis is due to an upstream bug in xterm.js (https://github.com/xtermjs/xterm.js/issues/4560) which was fixed in https://github.com/xtermjs/xterm.js/releases/tag/5.3.0.\r\n\r\n## Reproduce\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/actions/runs/7929124004/job/21648754032?pr=15803\r\n\r\n## Expected behavior\r\n\r\nWe should upgrade to latest xterm.js as 5.3.0 is now very stable.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.1\r\n",
    "issue_word_count": 300,
    "test_files_count": 1,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "galata/test/jupyterlab/terminal.test.ts",
      "packages/terminal/package.json",
      "packages/terminal/src/widget.ts",
      "packages/terminal/style/index.css",
      "packages/terminal/style/index.js",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/terminal.test.ts"
    ],
    "base_commit": "63e9e7e6a5528164029514b37cb2c12f7ad68ec4",
    "head_commit": "dd6da2ce4b302239d6b0ddcc3446431b304f986e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15962",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15962",
    "dockerfile": "",
    "pr_merged_at": "2024-04-08T10:35:08.000Z",
    "patch": "diff --git a/packages/terminal/package.json b/packages/terminal/package.json\nindex fdf439144e04..256fc0ea6e6d 100644\n--- a/packages/terminal/package.json\n+++ b/packages/terminal/package.json\n@@ -49,11 +49,11 @@\n     \"@lumino/domutils\": \"^2.0.1\",\n     \"@lumino/messaging\": \"^2.0.1\",\n     \"@lumino/widgets\": \"^2.3.1\",\n-    \"xterm\": \"~5.1.0\",\n-    \"xterm-addon-canvas\": \"~0.3.0\",\n-    \"xterm-addon-fit\": \"~0.7.0\",\n-    \"xterm-addon-web-links\": \"~0.8.0\",\n-    \"xterm-addon-webgl\": \"~0.14.0\"\n+    \"@xterm/addon-canvas\": \"~0.7.0\",\n+    \"@xterm/addon-fit\": \"~0.10.0\",\n+    \"@xterm/addon-web-links\": \"~0.11.0\",\n+    \"@xterm/addon-webgl\": \"~0.18.0\",\n+    \"@xterm/xterm\": \"~5.5.0\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.2.0-beta.0\",\n@@ -69,7 +69,7 @@\n   },\n   \"jupyterlab\": {\n     \"extraStyles\": {\n-      \"xterm\": [\n+      \"@xterm/xterm\": [\n         \"css/xterm.css\"\n       ]\n     }\n\ndiff --git a/packages/terminal/src/widget.ts b/packages/terminal/src/widget.ts\nindex 52e83b6b120a..659a3e8c9ce4 100644\n--- a/packages/terminal/src/widget.ts\n+++ b/packages/terminal/src/widget.ts\n@@ -15,11 +15,11 @@ import type {\n   ITerminalInitOnlyOptions,\n   ITerminalOptions,\n   Terminal as Xterm\n-} from 'xterm';\n-import type { CanvasAddon } from 'xterm-addon-canvas';\n-import type { FitAddon } from 'xterm-addon-fit';\n-import type { WebLinksAddon } from 'xterm-addon-web-links';\n-import type { WebglAddon } from 'xterm-addon-webgl';\n+} from '@xterm/xterm';\n+import type { CanvasAddon } from '@xterm/addon-canvas';\n+import type { FitAddon } from '@xterm/addon-fit';\n+import type { WebLinksAddon } from '@xterm/addon-web-links';\n+import type { WebglAddon } from '@xterm/addon-webgl';\n import { ITerminal } from '.';\n \n /**\n@@ -602,12 +602,12 @@ namespace Private {\n     if (!Xterm_) {\n       supportWebGL = hasWebGLContext();\n       const [xterm_, fitAddon_, renderer_, weblinksAddon_] = await Promise.all([\n-        import('xterm'),\n-        import('xterm-addon-fit'),\n+        import('@xterm/xterm'),\n+        import('@xterm/addon-fit'),\n         supportWebGL\n-          ? import('xterm-addon-webgl')\n-          : import('xterm-addon-canvas'),\n-        import('xterm-addon-web-links')\n+          ? import('@xterm/addon-webgl')\n+          : import('@xterm/addon-canvas'),\n+        import('@xterm/addon-web-links')\n       ]);\n       Xterm_ = xterm_.Terminal;\n       FitAddon_ = fitAddon_.FitAddon;\n\ndiff --git a/packages/terminal/style/index.css b/packages/terminal/style/index.css\nindex 46146501799b..b7797812b9c9 100644\n--- a/packages/terminal/style/index.css\n+++ b/packages/terminal/style/index.css\n@@ -6,5 +6,5 @@\n /* This file was auto-generated by ensurePackage() in @jupyterlab/buildutils */\n @import url('~@lumino/widgets/style/index.css');\n @import url('~@jupyterlab/apputils/style/index.css');\n-@import url('~xterm/css/xterm.css');\n+@import url('~@xterm/xterm/css/xterm.css');\n @import url('./base.css');\n\ndiff --git a/packages/terminal/style/index.js b/packages/terminal/style/index.js\nindex a9636edbe87c..d9d12366c873 100644\n--- a/packages/terminal/style/index.js\n+++ b/packages/terminal/style/index.js\n@@ -6,6 +6,6 @@\n /* This file was auto-generated by ensurePackage() in @jupyterlab/buildutils */\n import '@lumino/widgets/style/index.js';\n import '@jupyterlab/apputils/style/index.js';\n-import 'xterm/css/xterm.css';\n+import '@xterm/xterm/css/xterm.css';\n \n import './base.css';\n\ndiff --git a/yarn.lock b/yarn.lock\nindex f9dc87c992b0..2df3c1461195 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -4804,16 +4804,16 @@ __metadata:\n     \"@lumino/messaging\": ^2.0.1\n     \"@lumino/widgets\": ^2.3.1\n     \"@types/jest\": ^29.2.0\n+    \"@xterm/addon-canvas\": ~0.7.0\n+    \"@xterm/addon-fit\": ~0.10.0\n+    \"@xterm/addon-web-links\": ~0.11.0\n+    \"@xterm/addon-webgl\": ~0.18.0\n+    \"@xterm/xterm\": ~5.5.0\n     canvas: ^2.11.2\n     jest: ^29.2.0\n     rimraf: ~5.0.5\n     typedoc: ~0.24.7\n     typescript: ~5.1.6\n-    xterm: ~5.1.0\n-    xterm-addon-canvas: ~0.3.0\n-    xterm-addon-fit: ~0.7.0\n-    xterm-addon-web-links: ~0.8.0\n-    xterm-addon-webgl: ~0.14.0\n   languageName: unknown\n   linkType: soft\n \n@@ -7904,6 +7904,49 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@xterm/addon-canvas@npm:~0.7.0\":\n+  version: 0.7.0\n+  resolution: \"@xterm/addon-canvas@npm:0.7.0\"\n+  peerDependencies:\n+    \"@xterm/xterm\": ^5.0.0\n+  checksum: 28b9965f34e01a9bbcc31651dee2d4a9380aad528039484cce372b856be820705b293c4b5091cee65208c3dfbf6f944f27ecc6c3b794df5a96036cbf6dba0d74\n+  languageName: node\n+  linkType: hard\n+\n+\"@xterm/addon-fit@npm:~0.10.0\":\n+  version: 0.10.0\n+  resolution: \"@xterm/addon-fit@npm:0.10.0\"\n+  peerDependencies:\n+    \"@xterm/xterm\": ^5.0.0\n+  checksum: 8edfad561c0d0316c5883cbe2ce56109f105a2b2bf53b71d5f8c788e656a3205c1093a659dddcf4025a459e4b7ff8e07b6c6a19815c8711deeded560de5f1893\n+  languageName: node\n+  linkType: hard\n+\n+\"@xterm/addon-web-links@npm:~0.11.0\":\n+  version: 0.11.0\n+  resolution: \"@xterm/addon-web-links@npm:0.11.0\"\n+  peerDependencies:\n+    \"@xterm/xterm\": ^5.0.0\n+  checksum: c1b36b649b8cddc613213eb9e835daf3106a8be359a19ccacca1f1d9ff883b59d478f166109ee017fa3994d224dcdd82976ad5d5a1221271ab8d3d5684eb141d\n+  languageName: node\n+  linkType: hard\n+\n+\"@xterm/addon-webgl@npm:~0.18.0\":\n+  version: 0.18.0\n+  resolution: \"@xterm/addon-webgl@npm:0.18.0\"\n+  peerDependencies:\n+    \"@xterm/xterm\": ^5.0.0\n+  checksum: 942ecaa4e08423563a795a1a63fa79637e60d4e3aba1b5fa2f426e1d7b19c553e8c8f1cfad1258461f22e05362e791f642dc6aab7e8766e26d4d3876617d8320\n+  languageName: node\n+  linkType: hard\n+\n+\"@xterm/xterm@npm:~5.5.0\":\n+  version: 5.5.0\n+  resolution: \"@xterm/xterm@npm:5.5.0\"\n+  checksum: 393c1891b95fdd50d05e7a063abdc95a6643d2c45a4231637c23db90511426a95b1b56a5c4c91831121d2710aee9de97cf5e426016c589ca87dea8fff9a41b33\n+  languageName: node\n+  linkType: hard\n+\n \"@xtuc/ieee754@npm:^1.2.0\":\n   version: 1.2.0\n   resolution: \"@xtuc/ieee754@npm:1.2.0\"\n@@ -21837,49 +21880,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"xterm-addon-canvas@npm:~0.3.0\":\n-  version: 0.3.0\n-  resolution: \"xterm-addon-canvas@npm:0.3.0\"\n-  peerDependencies:\n-    xterm: ^5.0.0\n-  checksum: 21eabd28a2718e775399f27e21922ec4e22528576ae88278ef39c68239119e4576eecd59cf0f1c76dfcbea0f82b779f8dbaf4ce38e04e648844c33ac7632d333\n-  languageName: node\n-  linkType: hard\n-\n-\"xterm-addon-fit@npm:~0.7.0\":\n-  version: 0.7.0\n-  resolution: \"xterm-addon-fit@npm:0.7.0\"\n-  peerDependencies:\n-    xterm: ^5.0.0\n-  checksum: 512d41f80d6f9427ba02dab4e6fd642e94775a9cf7ef72ae4b55eab2a36856b5c67069bfc66b4af412fdce29a0842f9c6382af3672f0b514c4352dfd47defe8f\n-  languageName: node\n-  linkType: hard\n-\n-\"xterm-addon-web-links@npm:~0.8.0\":\n-  version: 0.8.0\n-  resolution: \"xterm-addon-web-links@npm:0.8.0\"\n-  peerDependencies:\n-    xterm: ^5.0.0\n-  checksum: fe07572adfaa84ceeb961db3ae577aeb2342ea5dcd4948170d1b733ae8045693fab8808f9c63cc43a532b033ae95e63e62ac14bc2e34def764e68f6362ccae2b\n-  languageName: node\n-  linkType: hard\n-\n-\"xterm-addon-webgl@npm:~0.14.0\":\n-  version: 0.14.0\n-  resolution: \"xterm-addon-webgl@npm:0.14.0\"\n-  peerDependencies:\n-    xterm: ^5.0.0\n-  checksum: 05f144c920660ad8122aa13564612b1ce71b92ba8f74b3387db3e39b616437659da36b7edf3aefe5900c59956cd6ca1272a0892248df751c8899a202befe019c\n-  languageName: node\n-  linkType: hard\n-\n-\"xterm@npm:~5.1.0\":\n-  version: 5.1.0\n-  resolution: \"xterm@npm:5.1.0\"\n-  checksum: cbacbc9dc1bbcf21dabecff46856b43f2d5854b42c1bec4ea03a5720000f2a88d79b0da45b6c38213d6607474a1fbe66d5ff25fa120b7e9e60eeed964dd840a1\n-  languageName: node\n-  linkType: hard\n-\n \"y-protocols@npm:^1.0.5\":\n   version: 1.0.5\n   resolution: \"y-protocols@npm:1.0.5\"\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/terminal.test.ts b/galata/test/jupyterlab/terminal.test.ts\nindex 674a2f76a050..5dda1b755f45 100644\n--- a/galata/test/jupyterlab/terminal.test.ts\n+++ b/galata/test/jupyterlab/terminal.test.ts\n@@ -118,7 +118,7 @@ test('Terminal web link', async ({ page, tmpPath }) => {\n   await page.waitForTimeout(1000);\n   await Promise.all([\n     terminal.locator('.jp-Terminal-body .xterm-cursor-pointer').waitFor(),\n-    terminal.locator('canvas.xterm-cursor-layer').hover({\n+    terminal.locator('canvas.xterm-link-layer').hover({\n       position: {\n         x: 60,\n         y: 23\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15959",
    "pr_id": 15959,
    "issue_id": 15776,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Check links fails too often CI due to rate limitting\n## Description\r\n\r\n\r\nOn CI check links fails too often, here are some common rate-limited endpoints:\r\n\r\n```\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/developer/accessibility.rst: https://learn.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/accessibility/emulate-vision-deficiencies#open-the-rendering-tool _\r\nhttps://learn.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/accessibility/emulate-vision-deficiencies#open-the-rendering-tool: 429: Too Many Requests\r\n```\r\n\r\n```\r\n_ /home/runner/work/jupyterlab/jupyterlab/docs/source/extension/extension_tutorial.rst: https://docs.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development _\r\nhttps://docs.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development: 429: Too Many Requests\r\n```\r\n",
    "issue_word_count": 125,
    "test_files_count": 1,
    "non_test_files_count": 0,
    "pr_changed_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "ff90432f3d80395909ad9b1fbf101f8a1b250561",
    "head_commit": "7b5074ffd7212a97f97dca1020bf96eb93d23365",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15959",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15959",
    "dockerfile": "",
    "pr_merged_at": "2024-03-11T16:24:25.000Z",
    "patch": "",
    "test_patch": "diff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex 4b4b57946d38..f5bb0ddbc2f0 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -154,4 +154,4 @@ jobs:\n       - uses: jupyterlab/maintainer-tools/.github/actions/check-links@v1\n         with:\n           ignore_glob: \"docs/api packages/ui-components/docs/source/ui_components.rst images\"\n-          ignore_links: \".*/images/[\\\\w-]+.png https://docs.github.com/en/.* https://jupyterlab.github.io https://mybinder.org/v2/gh/jupyterlab/.*\"\n+          ignore_links: \".*/images/[\\\\w-]+.png https://docs.github.com/en/.* https://jupyterlab.github.io https://mybinder.org/v2/gh/jupyterlab/.* https://github.com/[^/]+/?$\"\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15957",
    "pr_id": 15957,
    "issue_id": 15786,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Theme color is not applied to jp-button in 4.1.0\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\nAfter upgrading from v4.0.x to v4.1.0 (maybe related to #15021), the button style was changed. The color of the button is hard-coded as `var(--neutral-foreground-rest)`, and it takes precedence over the rule `.jp-Toolbar { var(--jp-ui-font-color1) }`.\r\n\r\nAs a result, for example in solarized dark theme, the button is in bright white instead of gray (like the debugger icon):\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/36528777/f3c448b0-c6ef-4ce8-bfcf-39e77d76bc51)\r\n\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Install JupyterLab v4.1.0\r\n2. Install a JupyterLab theme, for example\r\n    ```shell\r\n\tpip install jupyterlab_theme_solarized_dark\r\n\t```\r\n3. Open a notebook, `Python 3 (ipykernel)` is bright white\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\n<!--Describe what you expected to happen-->\r\n\r\nThe color of `Python 3 (ipykernel)` is gray\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Linux EndeavourOS (Arch-based distro) <!-- e.g. Linux Ubuntu 21.04 -->\r\n- Browser and version: Firefox 122 <!-- e.g. Chrome 92 -->\r\n- JupyterLab version: 4.1.0 <!-- e.g. 3.1.7 -->\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\n$PATH:\r\n\t/home/ac/temp/.venv/bin\r\n\t/home/ac/.asdf/shims\r\n\t/home/ac/.asdf/bin\r\n\t/opt/android-sdk/tools/bin\r\n\t/home/ac/.local/share/pnpm\r\n\t/usr/local/sbin\r\n\t/usr/local/bin\r\n\t/usr/bin\r\n\t/home/ac/.local/bin\r\n\t/opt/android-sdk/platform-tools\r\n\t/opt/android-sdk/tools\r\n\t/usr/lib/jvm/default/bin\r\n\t/usr/bin/site_perl\r\n\t/usr/bin/vendor_perl\r\n\t/usr/bin/core_perl\r\n\r\nsys.path:\r\n\t/home/ac/temp/.venv/bin\r\n\t/usr/lib/python311.zip\r\n\t/usr/lib/python3.11\r\n\t/usr/lib/python3.11/lib-dynload\r\n\t/home/ac/temp/.venv/lib/python3.11/site-packages\r\n\r\nsys.executable:\r\n\t/home/ac/temp/.venv/bin/python\r\n\r\nsys.version:\r\n\t3.11.7 (main, Jan 29 2024, 16:03:57) [GCC 13.2.1 20230801]\r\n\r\nplatform.platform():\r\n\tLinux-6.7.4-arch1-1-x86_64-with-glibc2.39\r\n\r\nwhich -a jupyter:\r\n\t/home/ac/temp/.venv/bin/jupyter\r\n\t/usr/bin/jupyter\r\n\t/home/ac/Projects/GitHub/jupyterlab-wakatime/.venv/bin/jupyter\r\n\r\npip list:\r\n\tPackage                         Version\r\n\t------------------------------- ---------------\r\n\tanyio                           4.2.0\r\n\targon2-cffi                     23.1.0\r\n\targon2-cffi-bindings            21.2.0\r\n\tarrow                           1.3.0\r\n\tasttokens                       2.4.1\r\n\tasync-lru                       2.0.4\r\n\tattrs                           23.2.0\r\n\tBabel                           2.14.0\r\n\tbeautifulsoup4                  4.12.3\r\n\tbleach                          6.1.0\r\n\tcertifi                         2024.2.2\r\n\tcffi                            1.16.0\r\n\tcharset-normalizer              3.3.2\r\n\tcomm                            0.2.1\r\n\tdebugpy                         1.8.1\r\n\tdecorator                       5.1.1\r\n\tdefusedxml                      0.7.1\r\n\texecuting                       2.0.1\r\n\tfastjsonschema                  2.19.1\r\n\tfqdn                            1.5.1\r\n\th11                             0.14.0\r\n\thttpcore                        1.0.2\r\n\thttpx                           0.26.0\r\n\tidna                            3.6\r\n\tipykernel                       6.29.2\r\n\tipython                         8.21.0\r\n\tisoduration                     20.11.0\r\n\tjedi                            0.19.1\r\n\tJinja2                          3.1.3\r\n\tjson5                           0.9.14\r\n\tjsonpointer                     2.4\r\n\tjsonschema                      4.21.1\r\n\tjsonschema-specifications       2023.12.1\r\n\tjupyter_client                  8.6.0\r\n\tjupyter_core                    5.7.1\r\n\tjupyter-events                  0.9.0\r\n\tjupyter-lsp                     2.2.2\r\n\tjupyter_server                  2.12.5\r\n\tjupyter_server_terminals        0.5.2\r\n\tjupyterlab                      4.1.0\r\n\tjupyterlab_pygments             0.3.0\r\n\tjupyterlab_server               2.25.2\r\n\tjupyterlab_theme_solarized_dark 3.0.1\r\n\tMarkupSafe                      2.1.5\r\n\tmatplotlib-inline               0.1.6\r\n\tmistune                         3.0.2\r\n\tnbclient                        0.9.0\r\n\tnbconvert                       7.16.0\r\n\tnbformat                        5.9.2\r\n\tnest-asyncio                    1.6.0\r\n\tnotebook_shim                   0.2.3\r\n\toverrides                       7.7.0\r\n\tpackaging                       23.2\r\n\tpandocfilters                   1.5.1\r\n\tparso                           0.8.3\r\n\tpexpect                         4.9.0\r\n\tpip                             23.2.1\r\n\tplatformdirs                    4.2.0\r\n\tprometheus-client               0.19.0\r\n\tprompt-toolkit                  3.0.43\r\n\tpsutil                          5.9.8\r\n\tptyprocess                      0.7.0\r\n\tpure-eval                       0.2.2\r\n\tpycparser                       2.21\r\n\tPygments                        2.17.2\r\n\tpython-dateutil                 2.8.2\r\n\tpython-json-logger              2.0.7\r\n\tPyYAML                          6.0.1\r\n\tpyzmq                           25.1.2\r\n\treferencing                     0.33.0\r\n\trequests                        2.31.0\r\n\trfc3339-validator               0.1.4\r\n\trfc3986-validator               0.1.1\r\n\trpds-py                         0.17.1\r\n\tSend2Trash                      1.8.2\r\n\tsetuptools                      65.5.0\r\n\tsix                             1.16.0\r\n\tsniffio                         1.3.0\r\n\tsoupsieve                       2.5\r\n\tstack-data                      0.6.3\r\n\tterminado                       0.18.0\r\n\ttheme-darcula                   4.0.0\r\n\ttinycss2                        1.2.1\r\n\ttornado                         6.4\r\n\ttraitlets                       5.14.1\r\n\ttypes-python-dateutil           2.8.19.20240106\r\n\turi-template                    1.3.0\r\n\turllib3                         2.2.0\r\n\twcwidth                         0.2.13\r\n\twebcolors                       1.13\r\n\twebencodings                    0.5.1\r\n\twebsocket-client                1.7.0\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\n[I 2024-02-11 15:31:09.092 ServerApp] jupyter_lsp | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.094 ServerApp] jupyter_server_terminals | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.096 ServerApp] jupyterlab | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.199 ServerApp] notebook_shim | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.232 ServerApp] notebook_shim | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.234 ServerApp] jupyter_lsp | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.234 ServerApp] jupyter_server_terminals | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.235 LabApp] JupyterLab extension loaded from /home/ac/temp/.venv/lib/python3.11/site-packages/jupyterlab\r\n[I 2024-02-11 15:31:09.235 LabApp] JupyterLab application directory is /home/ac/temp/.venv/share/jupyter/lab\r\n[I 2024-02-11 15:31:09.236 LabApp] Extension Manager is 'pypi'.\r\n[I 2024-02-11 15:31:09.242 ServerApp] jupyterlab | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.243 ServerApp] Serving notebooks from local directory: /home/ac/temp\r\n[I 2024-02-11 15:31:09.243 ServerApp] Jupyter Server 2.12.5 is running at:\r\n[I 2024-02-11 15:31:09.243 ServerApp] http://localhost:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n[I 2024-02-11 15:31:09.243 ServerApp]     http://127.0.0.1:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n[I 2024-02-11 15:31:09.243 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[C 2024-02-11 15:31:09.278 ServerApp]\r\n\r\n    To access the server, open this file in a browser:\r\n        file:///home/ac/.local/share/jupyter/runtime/jpserver-16456-open.html\r\n    Or copy and paste one of these URLs:\r\n        http://localhost:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n        http://127.0.0.1:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n[I 2024-02-11 15:31:09.671 ServerApp] Skipped non-installed server(s): bash-language-server, dockerfile-language-server-nodejs, javascript-typescript-langserver, jedi-language-server, julia-language-server, pyright, python-language-server, python-lsp-server, r-languageserver, sql-language-server, texlab, typescript-language-server, unified-language-server, vscode-css-languageserver-bin, vscode-html-languageserver-bin, vscode-json-languageserver-bin, yaml-language-server\r\n0.00s - Debugger warning: It seems that frozen modules are being used, which may\r\n0.00s - make the debugger miss breakpoints. Please pass -Xfrozen_modules=off\r\n0.00s - to python to disable frozen modules.\r\n0.00s - Note: Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION=1 to disable this validation.\r\n[I 2024-02-11 15:31:11.849 LabApp] Build is up to date\r\n[I 2024-02-11 15:31:12.000 ServerApp] Kernel started: b8987f0e-9734-49f0-a10d-073a151e033e\r\n0.00s - Debugger warning: It seems that frozen modules are being used, which may\r\n0.00s - make the debugger miss breakpoints. Please pass -Xfrozen_modules=off\r\n0.00s - to python to disable frozen modules.\r\n0.00s - Note: Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION=1 to disable this validation.\r\n[I 2024-02-11 15:31:12.360 ServerApp] Connecting to kernel b8987f0e-9734-49f0-a10d-073a151e033e.\r\n[I 2024-02-11 15:31:12.376 ServerApp] Connecting to kernel b8987f0e-9734-49f0-a10d-073a151e033e.\r\n[I 2024-02-11 15:31:12.386 ServerApp] Connecting to kernel b8987f0e-9734-49f0-a10d-073a151e033e.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nNot relevant\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 1398,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/toolbars.test.ts",
      "packages/ui-components/style/toolbar.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/toolbars.test.ts"
    ],
    "base_commit": "ff90432f3d80395909ad9b1fbf101f8a1b250561",
    "head_commit": "bb36afb68de72cb62056adc37412e65c098c7006",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15957",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15957",
    "dockerfile": "",
    "pr_merged_at": "2024-03-14T12:48:58.000Z",
    "patch": "diff --git a/packages/ui-components/style/toolbar.css b/packages/ui-components/style/toolbar.css\nindex b9fc7f51402b..230974e1cc7f 100644\n--- a/packages/ui-components/style/toolbar.css\n+++ b/packages/ui-components/style/toolbar.css\n@@ -74,7 +74,7 @@ button.jp-ToolbarButtonComponent .jp-ToolbarButtonComponent-label {\n   font-family: var(--jp-ui-font-family);\n }\n \n-jp-button.jp-Toolbar-kernelName {\n+.jp-Toolbar .jp-ToolbarButtonComponent {\n   color: var(--jp-ui-font-color1);\n }\n \n",
    "test_patch": "diff --git a/galata/test/jupyterlab/toolbars.test.ts b/galata/test/jupyterlab/toolbars.test.ts\nindex 03c3e0d55f40..e18fb507017f 100644\n--- a/galata/test/jupyterlab/toolbars.test.ts\n+++ b/galata/test/jupyterlab/toolbars.test.ts\n@@ -37,23 +37,47 @@ toolbars.forEach(([plugin, parameter]) => {\n     expect(missingCommands).toEqual([]);\n   });\n });\n+test.describe('Toolbar Button', () => {\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.notebook.createNew();\n+  });\n \n-test('Render Switch Kernel ToolbarButton', async ({ page }) => {\n-  await page.notebook.createNew();\n+  test('Render Switch Kernel ToolbarButton in default theme', async ({\n+    page\n+  }) => {\n+    const label = await page.$(\n+      'jp-button.jp-Toolbar-kernelName .jp-ToolbarButtonComponent-label'\n+    );\n+    const labelColor = await page.evaluate(\n+      el => getComputedStyle(el).color,\n+      label\n+    );\n \n-  const label = await page.$(\n-    'jp-button.jp-Toolbar-kernelName .jp-ToolbarButtonComponent-label'\n-  );\n-  const labelColor = await page.evaluate(\n-    el => getComputedStyle(el).color,\n-    label\n-  );\n+    const color = await page.evaluate(() =>\n+      getComputedStyle(document.body)\n+        .getPropertyValue('--jp-ui-font-color1')\n+        .trim()\n+    );\n \n-  const color = await page.evaluate(() =>\n-    getComputedStyle(document.body)\n-      .getPropertyValue('--jp-ui-font-color1')\n-      .trim()\n-  );\n+    expect(labelColor).toEqual(color);\n+  });\n \n-  expect(labelColor).toEqual(color);\n+  test('Render Switch Kernel ToolbarButton in dark theme', async ({ page }) => {\n+    await page.theme.setDarkTheme();\n+    const label = await page.$(\n+      'jp-button.jp-Toolbar-kernelName .jp-ToolbarButtonComponent-label'\n+    );\n+    const labelColor = await page.evaluate(\n+      el => getComputedStyle(el).color,\n+      label\n+    );\n+\n+    const color = await page.evaluate(() =>\n+      getComputedStyle(document.body)\n+        .getPropertyValue('--jp-ui-font-color1')\n+        .trim()\n+    );\n+\n+    expect(labelColor).toEqual(color);\n+  });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15948",
    "pr_id": 15948,
    "issue_id": 15947,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Shorter \"Last Modified\" display in narrow columns\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n<!--\r\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\r\n\r\n\r\nBefore creating a new feature request please search the issues for relevant feature requests.\r\n-->\r\n\r\n### Problem\r\n\r\nThe \"Last Modified\" column takes up a lot of horizontal space in a narrow container. In English, a relative date like \"11 months ago\" is likely longer than the filename it describes:\r\n\r\n<img width=\"416\" alt=\"long-date\" src=\"https://github.com/jupyterlab/jupyterlab/assets/93281816/11be204d-d2a4-483f-a9af-bbc323d88b03\">\r\n\r\nThe absolute date appears on hover, in a tooltip.\r\n\r\n### Proposed Solution\r\n\r\nWe use an [Intl.RelativeTimeFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat) object to make human-readable dates in an internationalizable format. When changing that to use the \"short\" format, units like \"months\" shorten, but \"days\" does not, and \"ago\" remains, even though we can be reasonably certain that almost all files will have been created in the past.\r\n\r\n<img width=\"315\" alt=\"short-date\" src=\"https://github.com/jupyterlab/jupyterlab/assets/93281816/18fc33d1-af86-4856-8426-cc5a89ed46d2\">\r\n\r\nAs a more extreme alternative, we could reduce this to \"#u\", with a number and a very short unit. This pattern is already used by mobile apps and mobile web sites, and may require additional manual internationalization. We can also shorten \"Last Modified\" to \"Mod\", to allow for the column to be shortened.\r\n\r\n<img width=\"307\" alt=\"image\" src=\"https://github.com/jupyterlab/jupyterlab/assets/93281816/de22fda1-fba3-43af-ae23-09679124f373\">\r\n\r\nNote that Asian languages already have single characters for most time units, \r\n\r\nIn the rare case that a file's time stamp in the future, we can put a `+` before the number; the normal expectation is that a date is in the past.\r\n\r\n### Additional context\r\n\r\nSee also #14237, #3875, and #8497 for other issues about columns in the filebrowser.\r\n",
    "issue_word_count": 360,
    "test_files_count": 37,
    "non_test_files_count": 6,
    "pr_changed_files": [
      "examples/app/example.spec.ts-snapshots/example-linux.png",
      "examples/federated/example.spec.ts-snapshots/example-linux.png",
      "examples/filebrowser/example.spec.ts-snapshots/example-linux.png",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-notebook-markdown-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png",
      "galata/test/jupyterlab/cells.test.ts-snapshots/collapsed-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-mermaid-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-vega-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-0-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-1-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-2-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-3-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-4-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-5-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-6-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-7-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png",
      "galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png",
      "packages/coreutils/src/time.ts",
      "packages/filebrowser/src/listing.ts",
      "packages/filebrowser/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png",
      "galata/test/documentation/custom_css.test.ts-snapshots/custom-css-notebook-markdown-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png",
      "galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png",
      "galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png",
      "galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png",
      "galata/test/jupyterlab/cells.test.ts-snapshots/collapsed-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png",
      "galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-mermaid-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-vega-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-0-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-1-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-2-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-3-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-4-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-5-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-6-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-7-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png",
      "galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png"
    ],
    "base_commit": "2ceabd8c7b98e7b2c305be406ade799f387a90eb",
    "head_commit": "32d4ccade57c98a0b5de6fdf268e726187af08e5",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15948",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15948",
    "dockerfile": "",
    "pr_merged_at": "2024-04-18T20:39:13.000Z",
    "patch": "diff --git a/examples/app/example.spec.ts-snapshots/example-linux.png b/examples/app/example.spec.ts-snapshots/example-linux.png\nindex e20a54772b81..930c8ad39a29 100644\nBinary files a/examples/app/example.spec.ts-snapshots/example-linux.png and b/examples/app/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/federated/example.spec.ts-snapshots/example-linux.png b/examples/federated/example.spec.ts-snapshots/example-linux.png\nindex ef41a82d195c..635bfc715ada 100644\nBinary files a/examples/federated/example.spec.ts-snapshots/example-linux.png and b/examples/federated/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/examples/filebrowser/example.spec.ts-snapshots/example-linux.png b/examples/filebrowser/example.spec.ts-snapshots/example-linux.png\nindex 8c90d5d3fe2d..29a6424327c6 100644\nBinary files a/examples/filebrowser/example.spec.ts-snapshots/example-linux.png and b/examples/filebrowser/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/packages/coreutils/src/time.ts b/packages/coreutils/src/time.ts\nindex acb1ae49a33a..e6102982c6e6 100644\n--- a/packages/coreutils/src/time.ts\n+++ b/packages/coreutils/src/time.ts\n@@ -17,6 +17,10 @@ const UNITS: { name: Intl.RelativeTimeFormatUnit; milliseconds: number }[] = [\n  * The namespace for date functions.\n  */\n export namespace Time {\n+  // Intl.RelativeTimeFormatStyle contains these, but it requires `ES2020.Intl`.\n+  // We currently compile to an `ES2018` target.\n+  export type HumanStyle = 'long' | 'short' | 'narrow';\n+\n   /**\n    * Convert a timestring to a human readable string (e.g. 'two minutes ago').\n    *\n@@ -24,9 +28,15 @@ export namespace Time {\n    *\n    * @returns A formatted date.\n    */\n-  export function formatHuman(value: string | Date): string {\n+  export function formatHuman(\n+    value: string | Date,\n+    format: HumanStyle = 'long'\n+  ): string {\n     const lang = document.documentElement.lang || 'en';\n-    const formatter = new Intl.RelativeTimeFormat(lang, { numeric: 'auto' });\n+    const formatter = new Intl.RelativeTimeFormat(lang, {\n+      numeric: 'auto',\n+      style: format\n+    });\n     const delta = new Date(value).getTime() - Date.now();\n     for (let unit of UNITS) {\n       const amount = Math.ceil(delta / unit.milliseconds);\n\ndiff --git a/packages/filebrowser/src/listing.ts b/packages/filebrowser/src/listing.ts\nindex 7e989b129287..b693bdb9b43f 100644\n--- a/packages/filebrowser/src/listing.ts\n+++ b/packages/filebrowser/src/listing.ts\n@@ -227,6 +227,9 @@ export class DirListing extends Widget {\n     this._manager = this._model.manager;\n     this._renderer = options.renderer || DirListing.defaultRenderer;\n \n+    // Get the width of the \"modified\" column\n+    this._updateModifiedSize(this.node);\n+\n     const headerNode = DOMUtils.findElement(this.node, HEADER_CLASS);\n     // hide the file size column by default\n     this._hiddenColumns.add('file_size');\n@@ -806,6 +809,99 @@ export class DirListing extends Widget {\n     }\n   }\n \n+  // Update the modified column's size\n+  private _updateModifiedSize(node: HTMLElement) {\n+    const modified = DOMUtils.findElement(node, ITEM_MODIFIED_CLASS);\n+    this._modifiedWidth = modified?.getBoundingClientRect().width ?? 83;\n+    this._modifiedStyle =\n+      this._modifiedWidth < 90\n+        ? 'narrow'\n+        : this._modifiedWidth > 110\n+        ? 'long'\n+        : 'short';\n+  }\n+\n+  // Update only the modified dates.\n+  protected updateModified(items: Contents.IModel[], nodes: HTMLElement[]) {\n+    items.forEach((item, i) => {\n+      const node = nodes[i];\n+      if (item.last_modified) {\n+        const modified = DOMUtils.findElement(node, ITEM_MODIFIED_CLASS);\n+        if (this.renderer.updateItemModified !== undefined) {\n+          this.renderer.updateItemModified(\n+            modified,\n+            item.last_modified,\n+            this._modifiedStyle\n+          );\n+        } else {\n+          DirListing.defaultRenderer.updateItemModified(\n+            modified,\n+            item.last_modified,\n+            this._modifiedStyle\n+          );\n+        }\n+      }\n+    });\n+  }\n+\n+  // Update item nodes based on widget state.\n+  protected updateNodes(items: Contents.IModel[], nodes: HTMLElement[]) {\n+    items.forEach((item, i) => {\n+      const node = nodes[i];\n+      const ft = this._manager.registry.getFileTypeForModel(item);\n+      this.renderer.updateItemNode(\n+        node,\n+        item,\n+        ft,\n+        this.translator,\n+        this._hiddenColumns,\n+        this.selection[item.path],\n+        this._modifiedStyle\n+      );\n+      if (\n+        this.selection[item.path] &&\n+        this._isCut &&\n+        this._model.path === this._prevPath\n+      ) {\n+        node.classList.add(CUT_CLASS);\n+      }\n+\n+      // add metadata to the node\n+      node.setAttribute(\n+        'data-isdir',\n+        item.type === 'directory' ? 'true' : 'false'\n+      );\n+    });\n+\n+    // Handle the selectors on the widget node.\n+    const selected = Object.keys(this.selection).length;\n+    if (selected) {\n+      this.addClass(SELECTED_CLASS);\n+      if (selected > 1) {\n+        this.addClass(MULTI_SELECTED_CLASS);\n+      }\n+    }\n+\n+    // Handle file session statuses.\n+    const paths = items.map(item => item.path);\n+    for (const session of this._model.sessions()) {\n+      const index = ArrayExt.firstIndexOf(paths, session.path);\n+      const node = nodes[index];\n+      // Node may have been filtered out.\n+      if (node) {\n+        let name = session.kernel?.name;\n+        const specs = this._model.specs;\n+\n+        node.classList.add(RUNNING_CLASS);\n+        if (specs && name) {\n+          const spec = specs.kernelspecs[name];\n+          name = spec ? spec.display_name : this._trans.__('unknown');\n+        }\n+        node.title = this._trans.__('%1\\nKernel: %2', node.title, name);\n+      }\n+    }\n+  }\n+\n   /**\n    * A handler invoked on an `'update-request'` message.\n    */\n@@ -879,60 +975,7 @@ export class DirListing extends Widget {\n       );\n     }\n \n-    // Update item nodes based on widget state.\n-    items.forEach((item, i) => {\n-      const node = nodes[i];\n-      const ft = this._manager.registry.getFileTypeForModel(item);\n-      renderer.updateItemNode(\n-        node,\n-        item,\n-        ft,\n-        this.translator,\n-        this._hiddenColumns,\n-        this.selection[item.path]\n-      );\n-      if (\n-        this.selection[item.path] &&\n-        this._isCut &&\n-        this._model.path === this._prevPath\n-      ) {\n-        node.classList.add(CUT_CLASS);\n-      }\n-\n-      // add metadata to the node\n-      node.setAttribute(\n-        'data-isdir',\n-        item.type === 'directory' ? 'true' : 'false'\n-      );\n-    });\n-\n-    // Handle the selectors on the widget node.\n-    const selected = Object.keys(this.selection).length;\n-    if (selected) {\n-      this.addClass(SELECTED_CLASS);\n-      if (selected > 1) {\n-        this.addClass(MULTI_SELECTED_CLASS);\n-      }\n-    }\n-\n-    // Handle file session statuses.\n-    const paths = items.map(item => item.path);\n-    for (const session of this._model.sessions()) {\n-      const index = ArrayExt.firstIndexOf(paths, session.path);\n-      const node = nodes[index];\n-      // Node may have been filtered out.\n-      if (node) {\n-        let name = session.kernel?.name;\n-        const specs = this._model.specs;\n-\n-        node.classList.add(RUNNING_CLASS);\n-        if (specs && name) {\n-          const spec = specs.kernelspecs[name];\n-          name = spec ? spec.display_name : this._trans.__('unknown');\n-        }\n-        node.title = this._trans.__('%1\\nKernel: %2', node.title, name);\n-      }\n-    }\n+    this.updateNodes(items, nodes);\n \n     this._prevPath = this._model.path;\n   }\n@@ -941,6 +984,13 @@ export class DirListing extends Widget {\n     const { width } =\n       msg.width === -1 ? this.node.getBoundingClientRect() : msg;\n     this.toggleClass('jp-DirListing-narrow', width < 250);\n+\n+    // Rerender item nodes' modified dates, if the modified style has changed.\n+    const oldModifiedStyle = this._modifiedStyle;\n+    this._updateModifiedSize(this.node);\n+    if (oldModifiedStyle !== this._modifiedStyle) {\n+      this.updateModified(this._sortedItems, this._items);\n+    }\n   }\n \n   setColumnVisibility(\n@@ -2094,6 +2144,9 @@ export class DirListing extends Widget {\n   private _sortNotebooksFirst = false;\n   // _focusIndex should never be set outside the range [0, this._items.length - 1]\n   private _focusIndex = 0;\n+  // Width of the \"last modified\" column for an individual file\n+  private _modifiedWidth: number;\n+  private _modifiedStyle: Time.HumanStyle;\n }\n \n /**\n@@ -2201,6 +2254,21 @@ export namespace DirListing {\n       hiddenColumns?: Set<DirListing.ToggleableColumn>\n     ): HTMLElement;\n \n+    /**\n+     * Update an item's last modified date.\n+     *\n+     * @param modified - Element containing the file's last modified date.\n+     *\n+     * @param modifiedDate - String representation of the last modified date.\n+     *\n+     * @param modifiedStyle - The date style for the modified column: narrow, short, or long\n+     */\n+    updateItemModified?(\n+      modified: HTMLElement,\n+      modifiedDate: string,\n+      modifiedStyle: Time.HumanStyle\n+    ): void;\n+\n     /**\n      * Update an item node to reflect the current state of a model.\n      *\n@@ -2208,6 +2276,8 @@ export namespace DirListing {\n      *\n      * @param model - The model object to use for the item state.\n      *\n+     * @param modifiedStyle - The date style for the modified column: narrow, short, or long\n+     *\n      * @param fileType - The file type of the item, if applicable.\n      */\n     updateItemNode(\n@@ -2216,7 +2286,8 @@ export namespace DirListing {\n       fileType?: DocumentRegistry.IFileType,\n       translator?: ITranslator,\n       hiddenColumns?: Set<DirListing.ToggleableColumn>,\n-      selected?: boolean\n+      selected?: boolean,\n+      modifiedStyle?: Time.HumanStyle\n     ): void;\n \n     /**\n@@ -2297,7 +2368,7 @@ export namespace DirListing {\n       const trans = translator.load('jupyterlab');\n       const name = this.createHeaderItemNode(trans.__('Name'));\n       const narrow = document.createElement('div');\n-      const modified = this.createHeaderItemNode(trans.__('Last Modified'));\n+      const modified = this.createHeaderItemNode(trans.__('Modified'));\n       const fileSize = this.createHeaderItemNode(trans.__('File Size'));\n       name.classList.add(NAME_ID_CLASS);\n       name.classList.add(SELECTED_CLASS);\n@@ -2524,6 +2595,32 @@ export namespace DirListing {\n       return labelWrapper;\n     }\n \n+    /**\n+     * Update an item's last modified date.\n+     *\n+     * @param modified - Element containing the file's last modified date.\n+     *\n+     * @param modifiedDate - String representation of the last modified date.\n+     *\n+     * @param modifiedStyle - The date style for the modified column: narrow, short, or long\n+     */\n+    updateItemModified(\n+      modified: HTMLElement,\n+      modifiedDate: string,\n+      modifiedStyle: Time.HumanStyle\n+    ): void {\n+      let modText = '';\n+      let modTitle = '';\n+\n+      const parsedDate = new Date(modifiedDate);\n+      // Render the date in one of multiple formats, depending on the container's size\n+      modText = Time.formatHuman(parsedDate, modifiedStyle);\n+      modTitle = Time.format(parsedDate);\n+\n+      modified.textContent = modText;\n+      modified.title = modTitle;\n+    }\n+\n     /**\n      * Update an item node to reflect the current state of a model.\n      *\n@@ -2540,7 +2637,8 @@ export namespace DirListing {\n       fileType?: DocumentRegistry.IFileType,\n       translator?: ITranslator,\n       hiddenColumns?: Set<DirListing.ToggleableColumn>,\n-      selected?: boolean\n+      selected?: boolean,\n+      modifiedStyle?: Time.HumanStyle\n     ): void {\n       if (selected) {\n         node.classList.add(SELECTED_CLASS);\n@@ -2660,14 +2758,13 @@ export namespace DirListing {\n         checkbox.checked = selected ?? false;\n       }\n \n-      let modText = '';\n-      let modTitle = '';\n       if (model.last_modified) {\n-        modText = Time.formatHuman(new Date(model.last_modified));\n-        modTitle = Time.format(new Date(model.last_modified));\n+        this.updateItemModified(\n+          modified,\n+          model.last_modified,\n+          modifiedStyle ?? 'short'\n+        );\n       }\n-      modified.textContent = modText;\n-      modified.title = modTitle;\n     }\n \n     /**\n\ndiff --git a/packages/filebrowser/style/base.css b/packages/filebrowser/style/base.css\nindex d80db5ec009f..81831eae822e 100644\n--- a/packages/filebrowser/style/base.css\n+++ b/packages/filebrowser/style/base.css\n@@ -144,11 +144,11 @@\n }\n \n .jp-DirListing-headerItem.jp-id-name {\n-  flex: 1 0 84px;\n+  flex: 1 1 126px;\n }\n \n .jp-DirListing-headerItem.jp-id-modified {\n-  flex: 0 0 112px;\n+  flex: 1 0 70px;\n   border-left: var(--jp-border-width) solid var(--jp-border-color2);\n   text-align: right;\n }\n@@ -276,7 +276,7 @@\n }\n \n .jp-DirListing-itemText {\n-  flex: 1 0 64px;\n+  flex: 1 1 106px;\n   white-space: nowrap;\n   overflow: hidden;\n   text-overflow: ellipsis;\n@@ -301,7 +301,7 @@\n }\n \n .jp-DirListing-itemModified {\n-  flex: 0 0 125px;\n+  flex: 1 0 83px;\n   text-align: right;\n }\n \n",
    "test_patch": "diff --git a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png\nindex f96474d18b3e..c1924e8171df 100644\nBinary files a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png and b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-main-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-notebook-markdown-documentation-linux.png b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-notebook-markdown-documentation-linux.png\nindex 8b137729df8c..8c1f1c71a29f 100644\nBinary files a/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-notebook-markdown-documentation-linux.png and b/galata/test/documentation/custom_css.test.ts-snapshots/custom-css-notebook-markdown-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png\nindex aa1f17384508..e6b76abbf3e4 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-menu-bar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png\nindex 331582082e7f..b3d175e0a084 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/customized-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png\nindex b76d89204913..b2953e174193 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-menu-bar-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png\nindex 0316389741ba..aa69be36c8e7 100644\nBinary files a/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png and b/galata/test/documentation/customization.test.ts-snapshots/default-terminal-position-single-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png\nindex 75776d102b8c..6ec8019dc81d 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/file-editor-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png\nindex 161c82dbfc54..30feac6ff635 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/interface-left-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png\nindex 57646a5b226f..bbe110710c73 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png\nindex 7d2484220cf4..5abe2b7302ba 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/terminal-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png\nindex c63ab1f117d1..2a25ead98376 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-chinese-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png\nindex 5a5a9927a6a0..d99f0614eec1 100644\nBinary files a/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png and b/galata/test/documentation/internationalization.test.ts-snapshots/language-settings-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png\nindex e5b655ded205..942e63c99619 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-jupyterlab-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png\nindex 92dad955123d..6e8ef64442ff 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png b/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png\nindex ad15543b0515..33e2142ef1a0 100644\nBinary files a/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png and b/galata/test/galata/notebook.spec.ts-snapshots/example-run-galata-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/cells.test.ts-snapshots/collapsed-cell-jupyterlab-linux.png b/galata/test/jupyterlab/cells.test.ts-snapshots/collapsed-cell-jupyterlab-linux.png\nindex 5108feb78814..cdb836323319 100644\nBinary files a/galata/test/jupyterlab/cells.test.ts-snapshots/collapsed-cell-jupyterlab-linux.png and b/galata/test/jupyterlab/cells.test.ts-snapshots/collapsed-cell-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png\nindex 55b83c98b50e..7172a6b20bf7 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/dark-theme-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png\nindex 5e3265f52682..6d7300009163 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/launch-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png\nindex ab16c1518d2f..b11203342337 100644\nBinary files a/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png and b/galata/test/jupyterlab/general.test.ts-snapshots/simple-mode-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png\nindex 5a0d23dc6d0b..b3c568f53c7c 100644\nBinary files a/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-dark-mermaid-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-mermaid-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-mermaid-jupyterlab-linux.png\nindex e6e6ad7c2e82..a027bd8c8b0d 100644\nBinary files a/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-mermaid-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run-mermaid.test.ts-snapshots/run-cells-mermaid-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png\nindex 69e28616fca3..2704d7fcb8ec 100644\nBinary files a/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-dark-vega-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-vega-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-vega-jupyterlab-linux.png\nindex 121ec33469a4..09dccb4a5a21 100644\nBinary files a/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-vega-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run-vega.test.ts-snapshots/run-cells-vega-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-0-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-0-jupyterlab-linux.png\nindex 2331085f6ea3..20ebec1ad6af 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-0-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-0-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-1-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-1-jupyterlab-linux.png\nindex a40d43a136ed..7f590a5e8b99 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-1-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-1-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-2-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-2-jupyterlab-linux.png\nindex a0e44192f226..1f8e2f9a6a4d 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-2-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-2-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-3-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-3-jupyterlab-linux.png\nindex 309961387f59..cbb0cc004e24 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-3-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-3-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-4-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-4-jupyterlab-linux.png\nindex e0d3e4c69954..b6331a2d817e 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-4-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-4-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-5-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-5-jupyterlab-linux.png\nindex 3e924bb75473..f94a54e03a12 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-5-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-5-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-6-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-6-jupyterlab-linux.png\nindex 953efd1b6a96..7e0a5d7c7cd7 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-6-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-6-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-7-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-7-jupyterlab-linux.png\nindex 953efd1b6a96..7e0a5d7c7cd7 100644\nBinary files a/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-7-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-run.test.ts-snapshots/notebook-panel-7-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png\nindex 52627c4f9cbb..a3161144c169 100644\nBinary files a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png and b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png\nindex a547aa1928c0..525189036c7b 100644\nBinary files a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png and b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png b/galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png\nindex 28f7f6a08a89..fd1fa86e1f2b 100644\nBinary files a/galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png and b/galata/test/jupyterlab/outputarea-stdin.test.ts-snapshots/stdin-history-search-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts b/galata/test/jupyterlab/sidebars.test.ts\nindex 50e82d335d58..7de4e98dfd53 100644\n--- a/galata/test/jupyterlab/sidebars.test.ts\n+++ b/galata/test/jupyterlab/sidebars.test.ts\n@@ -2,6 +2,7 @@\n // Distributed under the terms of the Modified BSD License.\n \n import { expect, galata, test } from '@jupyterlab/galata';\n+\n import { Locator } from '@playwright/test';\n \n const sidebarElementIds = {\n@@ -71,7 +72,6 @@ test.describe('Sidebars', () => {\n     await page.notebook.createNew('notebook.ipynb');\n \n     const unusedRules = await page.style.findUnusedStyleRules({\n-      page,\n       fragments: ['jp-DirListing', 'jp-FileBrowser'],\n       exclude: [\n         // active during renaming\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png\nindex ce1cd5130125..d591bc22bd9c 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/filebrowser-right-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png\nindex 780a358dfc05..ba09379857ae 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-filebrowser-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15946",
    "pr_id": 15946,
    "issue_id": 6944,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Create a workspaces GUI\nJupyterlab's [documentation](https://jupyterlab.readthedocs.io/en/stable/user/urls.html#managing-workspaces-ui) only explain how to manage workspaces via URLs and CLI.\r\n\r\nAre there any plans to provide some GUI for those? At least create new one and list / choose / delete existing ones? ",
    "issue_word_count": 50,
    "test_files_count": 20,
    "non_test_files_count": 49,
    "pr_changed_files": [
      ".github/labeler.yml",
      ".github/workflows/linuxjs-tests.yml",
      ".licenserc.yaml",
      "buildutils/src/ensure-repo.ts",
      "dev_mode/package.json",
      "dev_mode/style.js",
      "docs/source/getting_started/starting.rst",
      "docs/source/user/directories.rst",
      "docs/source/user/index.md",
      "docs/source/user/interface.rst",
      "docs/source/user/urls.rst",
      "docs/source/user/workspaces.rst",
      "galata/src/galata.ts",
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/data/analysis-space.jupyterlab-workspace",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "galata/test/documentation/workspaces.test.ts",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/jupyterlab/menus.test.ts",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png",
      "jupyterlab/galata/__init__.py",
      "packages/apputils-extension/package.json",
      "packages/apputils-extension/schema/workspaces.json",
      "packages/apputils-extension/src/workspacesplugin.ts",
      "packages/apputils-extension/style/index.css",
      "packages/apputils-extension/style/index.js",
      "packages/apputils-extension/tsconfig.json",
      "packages/apputils/src/dialog.tsx",
      "packages/apputils/src/inputdialog.ts",
      "packages/apputils/style/dialog.css",
      "packages/apputils/style/inputdialog.css",
      "packages/apputils/test/inputdialog.spec.ts",
      "packages/filebrowser/src/opendialog.ts",
      "packages/filebrowser/style/base.css",
      "packages/metapackage/package.json",
      "packages/metapackage/tsconfig.json",
      "packages/metapackage/tsconfig.test.json",
      "packages/running/src/index.tsx",
      "packages/services/src/workspace/index.ts",
      "packages/workspaces-extension/.vscode/launch.json",
      "packages/workspaces-extension/package.json",
      "packages/workspaces-extension/schema/menu.json",
      "packages/workspaces-extension/schema/sidebar.json",
      "packages/workspaces-extension/src/commands.ts",
      "packages/workspaces-extension/src/index.ts",
      "packages/workspaces-extension/src/sidebar.ts",
      "packages/workspaces-extension/style/index.css",
      "packages/workspaces-extension/style/index.js",
      "packages/workspaces-extension/tsconfig.json",
      "packages/workspaces/.vscode/launch.json",
      "packages/workspaces/babel.config.js",
      "packages/workspaces/jest.config.js",
      "packages/workspaces/package.json",
      "packages/workspaces/src/index.ts",
      "packages/workspaces/src/model.ts",
      "packages/workspaces/src/tokens.ts",
      "packages/workspaces/test/model.spec.ts",
      "packages/workspaces/tsconfig.json",
      "packages/workspaces/tsconfig.test.json",
      "tsconfigdoc.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxjs-tests.yml",
      "galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json",
      "galata/test/documentation/data/analysis-space.jupyterlab-workspace",
      "galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "galata/test/documentation/workspaces.test.ts",
      "galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png",
      "galata/test/jupyterlab/menus.test.ts",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png",
      "galata/test/jupyterlab/sidebars.test.ts",
      "galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png",
      "packages/apputils/test/inputdialog.spec.ts",
      "packages/metapackage/tsconfig.test.json",
      "packages/workspaces/test/model.spec.ts",
      "packages/workspaces/tsconfig.test.json"
    ],
    "base_commit": "b318b57d3e5e15ade52c493d264c7818ffcd9381",
    "head_commit": "fde83eeebeb4410006cb3374439b81ac63fbf098",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15946",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15946",
    "dockerfile": "",
    "pr_merged_at": "2024-03-25T11:16:15.000Z",
    "patch": "diff --git a/.github/labeler.yml b/.github/labeler.yml\nindex 460ef50cda2e..31f1ae2c2cd8 100644\n--- a/.github/labeler.yml\n+++ b/.github/labeler.yml\n@@ -443,3 +443,11 @@ pkg:vega:\n   - any-glob-to-any-file:\n     - packages/vega5-extension/**/*\n     - packages/vega5-extension/*\n+\n+pkg:workspaces:\n+- changed-files:\n+  - any-glob-to-any-file:\n+    - packages/workspaces/**/*\n+    - packages/workspaces/*\n+    - packages/workspaces-extension/**/*\n+    - packages/workspaces-extension/*\n\ndiff --git a/.licenserc.yaml b/.licenserc.yaml\nindex f686c878f827..7f1e81908828 100644\n--- a/.licenserc.yaml\n+++ b/.licenserc.yaml\n@@ -14,6 +14,7 @@ header:\n     - '**/*.svg'\n     - '**/*.yml'\n     - '**/*.yaml'\n+    - '**/*.jupyterlab-workspace'\n     - '**/build'\n     - '**/lib'\n     - '**/node_modules'\n\ndiff --git a/buildutils/src/ensure-repo.ts b/buildutils/src/ensure-repo.ts\nindex eb426797f363..63167cb09637 100644\n--- a/buildutils/src/ensure-repo.ts\n+++ b/buildutils/src/ensure-repo.ts\n@@ -282,7 +282,8 @@ const SKIP_CSS: Dict<string[]> = {\n     '@jupyterlab/tooltip-extension',\n     '@jupyterlab/translation-extension',\n     '@jupyterlab/ui-components-extension',\n-    '@jupyterlab/vega5-extension'\n+    '@jupyterlab/vega5-extension',\n+    '@jupyterlab/workspaces-extension'\n   ],\n   '@jupyterlab/notebook': ['@jupyterlab/application'],\n   '@jupyterlab/rendermime-interfaces': ['@lumino/widgets'],\n\ndiff --git a/dev_mode/package.json b/dev_mode/package.json\nindex a7f8c8d0743f..b4bf30be705a 100644\n--- a/dev_mode/package.json\n+++ b/dev_mode/package.json\n@@ -118,6 +118,8 @@\n     \"@jupyterlab/ui-components\": \"~4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components-extension\": \"~4.2.0-alpha.1\",\n     \"@jupyterlab/vega5-extension\": \"~4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces\": \"~4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces-extension\": \"~4.2.0-alpha.1\",\n     \"@lezer/common\": \"^1.0.0\",\n     \"@lezer/highlight\": \"^1.0.0\",\n     \"@lumino/algorithm\": \"^2.0.0\",\n@@ -189,7 +191,8 @@\n     \"@jupyterlab/tooltip-extension\": \"~4.2.0-alpha.1\",\n     \"@jupyterlab/translation-extension\": \"~4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components-extension\": \"~4.2.0-alpha.1\",\n-    \"@jupyterlab/vega5-extension\": \"~4.2.0-alpha.1\"\n+    \"@jupyterlab/vega5-extension\": \"~4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces-extension\": \"~4.2.0-alpha.1\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/builder\": \"^4.2.0-alpha.1\",\n@@ -264,7 +267,8 @@\n       \"@jupyterlab/toc-extension\": \"\",\n       \"@jupyterlab/tooltip-extension\": \"\",\n       \"@jupyterlab/translation-extension\": \"\",\n-      \"@jupyterlab/ui-components-extension\": \"\"\n+      \"@jupyterlab/ui-components-extension\": \"\",\n+      \"@jupyterlab/workspaces-extension\": \"\"\n     },\n     \"mimeExtensions\": {\n       \"@jupyterlab/javascript-extension\": \"\",\n@@ -320,6 +324,7 @@\n       \"@jupyterlab/tooltip\",\n       \"@jupyterlab/translation\",\n       \"@jupyterlab/ui-components\",\n+      \"@jupyterlab/workspaces\",\n       \"@lezer/common\",\n       \"@lezer/highlight\",\n       \"@lumino/algorithm\",\n@@ -440,6 +445,8 @@\n       \"@jupyterlab/ui-components\": \"../packages/ui-components\",\n       \"@jupyterlab/ui-components-extension\": \"../packages/ui-components-extension\",\n       \"@jupyterlab/vega5-extension\": \"../packages/vega5-extension\",\n+      \"@jupyterlab/workspaces\": \"../packages/workspaces\",\n+      \"@jupyterlab/workspaces-extension\": \"../packages/workspaces-extension\",\n       \"@jupyterlab/builder\": \"../builder\",\n       \"@jupyterlab/buildutils\": \"../buildutils\",\n       \"@jupyterlab/template\": \"../buildutils/template\",\n\ndiff --git a/dev_mode/style.js b/dev_mode/style.js\nindex 0c4d58fe442a..cc37c2bd1e34 100644\n--- a/dev_mode/style.js\n+++ b/dev_mode/style.js\n@@ -45,3 +45,4 @@ import '@jupyterlab/tooltip-extension/style/index.js';\n import '@jupyterlab/translation-extension/style/index.js';\n import '@jupyterlab/ui-components-extension/style/index.js';\n import '@jupyterlab/vega5-extension/style/index.js';\n+import '@jupyterlab/workspaces-extension/style/index.js';\n\ndiff --git a/docs/source/getting_started/starting.rst b/docs/source/getting_started/starting.rst\nindex e0916953ccc7..8d630a31c0b7 100644\n--- a/docs/source/getting_started/starting.rst\n+++ b/docs/source/getting_started/starting.rst\n@@ -27,7 +27,7 @@ Example:\n \n You may access JupyterLab by entering the notebook server's :ref:`URL <urls>`\n into the browser. JupyterLab sessions always reside in a\n-:ref:`workspace <url-workspaces-ui>`. The default workspace is the main ``/lab`` URL:\n+:ref:`workspace <workspaces>`. The default workspace is the main ``/lab`` URL:\n \n .. code-block:: none\n \n@@ -37,7 +37,7 @@ Like the classic notebook,\n JupyterLab provides a way for users to copy URLs that\n :ref:`open a specific notebook or file <url-tree>`. Additionally,\n JupyterLab URLs are an advanced part of the user interface that allows for\n-managing :ref:`workspaces <url-workspaces-ui>`. To learn more about URLs in\n+managing :ref:`workspaces <url-workspaces>`. To learn more about URLs in\n Jupyterlab, visit :ref:`urls`.\n \n JupyterLab runs on top of Jupyter Server, so see the `security\n\ndiff --git a/docs/source/user/directories.rst b/docs/source/user/directories.rst\nindex f03cf78b67fb..cd50391762c2 100644\n--- a/docs/source/user/directories.rst\n+++ b/docs/source/user/directories.rst\n@@ -300,6 +300,8 @@ the default values given by extensions, as well as the default overrides from\n the :ref:`overrides.json <overridesjson>` file in the application's settings\n directory.\n \n+.. _workspaces-directory:\n+\n JupyterLab Workspaces Directory\n -------------------------------\n \n@@ -315,4 +317,4 @@ environments. The location can be modified using the\n ``JUPYTERLAB_WORKSPACES_DIR`` environment variable.\n \n These files can be imported and exported to create default \"profiles\", using\n-the :ref:`workspace command line tool <url-workspaces-cli>`.\n+the :ref:`workspace command line tool <workspaces-cli>`.\n\ndiff --git a/docs/source/user/index.md b/docs/source/user/index.md\nindex 509ffcb84d79..f0b5a373fb82 100644\n--- a/docs/source/user/index.md\n+++ b/docs/source/user/index.md\n@@ -20,6 +20,7 @@ file_formats\n debugger\n toc\n extensions\n+workspaces\n jupyterhub\n export\n language\n\ndiff --git a/docs/source/user/interface.rst b/docs/source/user/interface.rst\nindex 2b3496cf55f8..a7e10ea9de9c 100644\n--- a/docs/source/user/interface.rst\n+++ b/docs/source/user/interface.rst\n@@ -23,11 +23,12 @@ cell tools inspector <notebook>`, and the :ref:`tabs list <tabs>`.\n    :class: jp-screenshot\n    :alt: A screenshot of the default JupyterLab interface. The main work area is in the middle. There is also a left sidebar and a top menu bar.\n \n-JupyterLab sessions always reside in a :ref:`workspace <url-workspaces-ui>`.\n+JupyterLab sessions always reside in a :ref:`workspace <workspaces>`.\n Workspaces contain the state of JupyterLab: the files that are currently open,\n the layout of the application areas and tabs, etc.\n Workspaces can be saved on the server with\n-:ref:`named workspace URLs <url-workspaces-ui>`.\n+:ref:`named workspace URLs <url-workspaces>` or\n+:ref:`using workspace commands <workspaces-gui>` available in the menu and sidebar.\n To learn more about URLs in Jupyterlab, visit :ref:`urls`.\n \n \n\ndiff --git a/docs/source/user/urls.rst b/docs/source/user/urls.rst\nindex 87a8a5ffaf74..97e8b3049b5e 100644\n--- a/docs/source/user/urls.rst\n+++ b/docs/source/user/urls.rst\n@@ -70,10 +70,10 @@ using ``#cell-id=<cell-id>`` Fragment Identification Syntax.\n     The ``cell-id`` fragment locator is not part of a formal Jupyter standard and subject to change.\n     To leave feedback, please comment in the discussion: `nbformat#317 <https://github.com/jupyter/nbformat/issues/317>`_.\n \n-.. _url-workspaces-ui:\n+.. _url-workspaces:\n \n-Managing Workspaces (UI)\n-------------------------\n+Managing Workspaces (URL)\n+-------------------------\n \n JupyterLab sessions always reside in a workspace. Workspaces contain the state\n of JupyterLab: the files that are currently open, the layout of the application\n@@ -168,86 +168,3 @@ To reset the contents of the default workspace and load a notebook:\n .. code-block:: none\n \n   http(s)://<server:port>/<lab-location>/lab/tree/path/to/notebook.ipynb?reset\n-\n-.. _url-workspaces-cli:\n-\n-Managing Workspaces (CLI)\n--------------------------\n-\n-JupyterLab provides a command-line interface for workspace ``import`` and\n-``export``:\n-\n-.. code-block:: bash\n-\n-  $ # Exports the default JupyterLab workspace\n-  $ jupyter lab workspaces export\n-  {\"data\": {}, \"metadata\": {\"id\": \"/lab\"}}\n-  $\n-  $ # Exports the workspaces named `foo`\n-  $ jupyter lab workspaces export foo\n-  {\"data\": {}, \"metadata\": {\"id\": \"/lab/workspaces/foo\"}}\n-  $\n-  $ # Exports the workspace named `foo` into a file called `file_name.json`\n-  $ jupyter lab workspaces export foo > file_name.json\n-  $\n-  $ # Imports the workspace file `file_name.json`.\n-  $ jupyter lab workspaces import file_name.json\n-  Saved workspace: <workspaces-directory>/labworkspacesfoo-54d5.jupyterlab-workspace\n-\n-The ``export`` functionality is as friendly as possible: if a workspace does not\n-exist, it will still generate an empty workspace for export.\n-\n-The ``import`` functionality validates the structure of the workspace file and\n-validates the ``id`` field in the workspace ``metadata`` to make sure its URL is\n-compatible with either the ``workspaces_url`` configuration or the ``page_url``\n-configuration to verify that it is a correctly named workspace or it is the\n-default workspace.\n-\n-\n-Workspace File Format\n----------------------\n-\n-A workspace file in a JSON file with a specific spec.\n-\n-\n-There are two top level keys requires, `data`, and `metadata`.\n-\n-The `metadata` must be a mapping with an `id`\n-key that has the same value as the ID of the workspace. This should also be the relative URL path to access the workspace,\n-like `/lab/workspaces/foo`.\n-\n-The `data` key maps to the initial state of the `IStateDB`. Many plugins look in the State DB for the configuration.\n-Also any plugins that register with the `ILayoutRestorer` will look up all keys in the State DB\n-that start with the `namespace` of their tracker before the first `:`. The values of these keys should have a `data`\n-attribute that maps.\n-\n-For example, if your workspace looks like this:\n-\n-.. code-block:: json\n-\n-  {\n-    \"data\": {\n-      \"application-mimedocuments:package.json:JSON\": {\n-        \"data\": { \"path\": \"package.json\", \"factory\": \"JSON\" }\n-      }\n-    }\n-  }\n-\n-It will run the `docmanager:open` with the `{ \"path\": \"package.json\", \"factory\": \"JSON\" }` args, because the `application-mimedocuments` tracker is registered with the `docmanager:open` command, like this:\n-\n-\n-.. code-block:: typescript\n-\n-  const namespace = 'application-mimedocuments';\n-  const tracker = new WidgetTracker<MimeDocument>({ namespace });\n-  void restorer.restore(tracker, {\n-    command: 'docmanager:open',\n-    args: widget => ({\n-      path: widget.context.path,\n-      factory: Private.factoryNameProperty.get(widget)\n-    }),\n-    name: widget =>\n-      `${widget.context.path}:${Private.factoryNameProperty.get(widget)}`\n-  });\n-\n-Note the part of the data key after the first `:` (`package.json:JSON`) is dropped and is irrelevant.\n\ndiff --git a/docs/source/user/workspaces.rst b/docs/source/user/workspaces.rst\nnew file mode 100644\nindex 000000000000..e2e1df4008f4\n--- /dev/null\n+++ b/docs/source/user/workspaces.rst\n@@ -0,0 +1,117 @@\n+.. Copyright (c) Jupyter Development Team.\n+.. Distributed under the terms of the Modified BSD License.\n+\n+.. _workspaces:\n+\n+Workspaces\n+==========\n+\n+A JupyterLab Workspace defines the layout and state of the user interface such as the position of files, notebooks, sidebars, and open/closed state of the panels.\n+\n+Workspaces can be managed in three ways:\n+\n+- :ref:`via Graphical User Interface <workspaces-gui>`\n+- :ref:`via Command Line Interface <workspaces-cli>`\n+- :ref:`via URL schema and parameters <url-workspaces>`\n+\n+\n+A workspace name may only contain ASCII letters (a-z and A-Z), digits (0-9), hyphen-minuses (``-``) and underscores (``_``).\n+\n+.. _workspaces-gui:\n+\n+Managing Workspaces (GUI)\n+-------------------------\n+\n+There are several commands for managing workspaces from the main menu, sidebar, and command palette:\n+\n+- `create-new`, `clone`, `rename`, `reset`, and `delete` act on the workspaces stored by on the server in :ref:`the dedicated location <workspaces-directory>`.\n+- `save`, `save as`, `import`, and `export` can load and store the workspace to/from the file system (contained within the Jupyter root directory); `save` will save the workspace to the most recently saved file.\n+\n+In the sidebar, in the \"Running Terminals and Kernels\" panel, under \"Workspaces\", the current workspace has a check mark (âœ“). Clicking on another workspace will open. Opening the context menu (right click) over the workspace item in the sidebar will present actions available for management of that workspace:\n+\n+.. image:: ../images/workspaces-sidebar.png\n+   :align: center\n+   :class: jp-screenshot\n+   :alt: The context menu opened over workspaces sidebar\n+\n+.. _workspaces-cli:\n+\n+Managing Workspaces (CLI)\n+-------------------------\n+\n+JupyterLab provides a command line interface for workspace ``import`` and\n+``export``:\n+\n+.. code-block:: bash\n+\n+  $ # Exports the default JupyterLab workspace\n+  $ jupyter lab workspaces export\n+  {\"data\": {}, \"metadata\": {\"id\": \"/lab\"}}\n+  $\n+  $ # Exports the workspaces named `foo`\n+  $ jupyter lab workspaces export foo\n+  {\"data\": {}, \"metadata\": {\"id\": \"/lab/workspaces/foo\"}}\n+  $\n+  $ # Exports the workspace named `foo` into a file called `file_name.json`\n+  $ jupyter lab workspaces export foo > file_name.json\n+  $\n+  $ # Imports the workspace file `file_name.json`.\n+  $ jupyter lab workspaces import file_name.json\n+  Saved workspace: <workspaces-directory>/labworkspacesfoo-54d5.jupyterlab-workspace\n+\n+The ``export`` command will generate a URL for any workspace you provide as an argument,\n+even if the workspace does not yet exist. Visiting a URL for a nonexistent workspace will create\n+a new workspace with that name.\n+\n+The ``import`` functionality validates the structure of the workspace file and\n+validates the ``id`` field in the workspace ``metadata`` to make sure its URL is\n+compatible with either the ``workspaces_url`` configuration or the ``page_url``\n+configuration to verify that it is a correctly named workspace or it is the\n+default workspace.\n+\n+\n+Workspace File Format\n+---------------------\n+\n+A workspace file is a JSON file that contains one object with two required top-level keys, `data`, and `metadata`.\n+\n+The `metadata` must be a mapping with an `id`\n+key that has the same value as the ID of the workspace. This should also be the relative URL path to access the workspace,\n+like `/lab/workspaces/foo`. Additionally, `metadata` may contain `created` and `last_modified` fields with date and time creation and most recent modification, respectively.\n+The date and time are encoded using ISO 8601 format, for example ``2022-06-15T23:41:15.818986+00:00``.\n+\n+The `data` key maps to the initial state of the ``IStateDB``. Many plugins look in the State DB for the configuration.\n+Also any plugins that register with the ``ILayoutRestorer`` will look up all keys in the State DB\n+that start with the `namespace` of their tracker before the first ``:``. The values of these keys should have a `data`\n+attribute that maps.\n+\n+For example, if your workspace looks like this:\n+\n+.. code-block:: json\n+\n+  {\n+    \"data\": {\n+      \"application-mimedocuments:package.json:JSON\": {\n+        \"data\": { \"path\": \"package.json\", \"factory\": \"JSON\" }\n+      }\n+    }\n+  }\n+\n+It will run the `docmanager:open` with the ``{ \"path\": \"package.json\", \"factory\": \"JSON\" }`` args, because the `application-mimedocuments` tracker is registered with the `docmanager:open` command, like this:\n+\n+\n+.. code-block:: typescript\n+\n+  const namespace = 'application-mimedocuments';\n+  const tracker = new WidgetTracker<MimeDocument>({ namespace });\n+  void restorer.restore(tracker, {\n+    command: 'docmanager:open',\n+    args: widget => ({\n+      path: widget.context.path,\n+      factory: Private.factoryNameProperty.get(widget)\n+    }),\n+    name: widget =>\n+      `${widget.context.path}:${Private.factoryNameProperty.get(widget)}`\n+  });\n+\n+Note the part of the data key after the first ``:`` (``package.json:JSON``) is dropped and is irrelevant.\n\ndiff --git a/galata/src/galata.ts b/galata/src/galata.ts\nindex de3e25854d50..fbd640c5e9a4 100644\n--- a/galata/src/galata.ts\n+++ b/galata/src/galata.ts\n@@ -449,8 +449,9 @@ export namespace galata {\n      * The space name can be found in the named group `id`.\n      *\n      * The id will be prefixed by '/'.\n+     * The id will be undefined for workspaces listing route.\n      */\n-    export const workspaces = /.*\\/api\\/workspaces(?<id>(\\/[-\\w]+)+)/;\n+    export const workspaces = /.*\\/api\\/workspaces(?<id>(\\/[-\\w]+)+)?/;\n \n     /**\n      * User API\n@@ -962,11 +963,25 @@ export namespace galata {\n     ): Promise<void> {\n       return page.route(Routes.workspaces, (route, request) => {\n         switch (request.method()) {\n-          case 'GET':\n-            return route.fulfill({\n-              status: 200,\n-              body: JSON.stringify(workspace)\n-            });\n+          case 'GET': {\n+            const id = Routes.workspaces.exec(request.url())?.groups?.id;\n+            if (id) {\n+              return route.fulfill({\n+                status: 200,\n+                body: JSON.stringify(workspace)\n+              });\n+            } else {\n+              return route.fulfill({\n+                status: 200,\n+                body: JSON.stringify({\n+                  workspaces: {\n+                    ids: [workspace.metadata.id],\n+                    values: [workspace]\n+                  }\n+                })\n+              });\n+            }\n+          }\n           case 'PUT': {\n             const data = request.postDataJSON();\n             workspace.data = { ...workspace.data, ...data.data };\n\ndiff --git a/jupyterlab/galata/__init__.py b/jupyterlab/galata/__init__.py\nindex 7bb42dc8844e..3b3923101d6a 100644\n--- a/jupyterlab/galata/__init__.py\n+++ b/jupyterlab/galata/__init__.py\n@@ -31,6 +31,8 @@ def configure_jupyter_server(c):\n     #   c.LabServerApp.extra_labextensions_path = str(Path(jupyterlab.__file__).parent / \"galata\")\n     c.LabServerApp.extra_labextensions_path = str(Path(__file__).parent)\n \n+    c.LabApp.workspaces_dir = mkdtemp(prefix=\"galata-workspaces-\")\n+\n     c.ServerApp.root_dir = os.environ.get(\n         \"JUPYTERLAB_GALATA_ROOT_DIR\", mkdtemp(prefix=\"galata-test-\")\n     )\n\ndiff --git a/packages/apputils-extension/package.json b/packages/apputils-extension/package.json\nindex 70757ccb8b9b..c1e0c7e9e7a4 100644\n--- a/packages/apputils-extension/package.json\n+++ b/packages/apputils-extension/package.json\n@@ -42,7 +42,6 @@\n     \"@jupyterlab/apputils\": \"^4.3.0-alpha.1\",\n     \"@jupyterlab/coreutils\": \"^6.2.0-alpha.1\",\n     \"@jupyterlab/docregistry\": \"^4.2.0-alpha.1\",\n-    \"@jupyterlab/filebrowser\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/mainmenu\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/rendermime-interfaces\": \"^3.10.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.2.0-alpha.1\",\n@@ -51,6 +50,7 @@\n     \"@jupyterlab/statusbar\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces\": \"^4.2.0-alpha.1\",\n     \"@lumino/algorithm\": \"^2.0.1\",\n     \"@lumino/commands\": \"^2.2.0\",\n     \"@lumino/coreutils\": \"^2.1.2\",\n\ndiff --git a/packages/apputils-extension/schema/workspaces.json b/packages/apputils-extension/schema/workspaces.json\ndeleted file mode 100644\nindex 8cf37a58a988..000000000000\n--- a/packages/apputils-extension/schema/workspaces.json\n+++ /dev/null\n@@ -1,24 +0,0 @@\n-{\n-  \"title\": \"Workspaces\",\n-  \"description\": \"Workspaces settings.\",\n-  \"jupyter.lab.menus\": {\n-    \"main\": [\n-      {\n-        \"id\": \"jp-mainmenu-file\",\n-        \"items\": [\n-          {\n-            \"command\": \"workspace-ui:save-as\",\n-            \"rank\": 40\n-          },\n-          {\n-            \"command\": \"workspace-ui:save\",\n-            \"rank\": 40\n-          }\n-        ]\n-      }\n-    ]\n-  },\n-  \"additionalProperties\": false,\n-  \"properties\": {},\n-  \"type\": \"object\"\n-}\n\ndiff --git a/packages/apputils-extension/src/workspacesplugin.ts b/packages/apputils-extension/src/workspacesplugin.ts\nindex 06f42402515f..6c3a2cb29719 100644\n--- a/packages/apputils-extension/src/workspacesplugin.ts\n+++ b/packages/apputils-extension/src/workspacesplugin.ts\n@@ -2,66 +2,48 @@\n // Distributed under the terms of the Modified BSD License.\n \n import {\n-  IRouter,\n   JupyterFrontEnd,\n   JupyterFrontEndPlugin\n } from '@jupyterlab/application';\n-import { Dialog, IWindowResolver, showDialog } from '@jupyterlab/apputils';\n-import { URLExt } from '@jupyterlab/coreutils';\n import {\n   ABCWidgetFactory,\n   DocumentRegistry,\n   DocumentWidget,\n   IDocumentWidget\n } from '@jupyterlab/docregistry';\n-import { IDefaultFileBrowser } from '@jupyterlab/filebrowser';\n-import { Contents, Workspace, WorkspaceManager } from '@jupyterlab/services';\n+import { Workspace, WorkspaceManager } from '@jupyterlab/services';\n import { IStateDB } from '@jupyterlab/statedb';\n+import { IWorkspaceCommands } from '@jupyterlab/workspaces';\n import { ITranslator, nullTranslator } from '@jupyterlab/translation';\n import { Widget } from '@lumino/widgets';\n \n-namespace CommandIDs {\n-  export const saveWorkspace = 'workspace-ui:save';\n-\n-  export const saveWorkspaceAs = 'workspace-ui:save-as';\n-}\n-\n const WORKSPACE_NAME = 'jupyterlab-workspace';\n const WORKSPACE_EXT = '.' + WORKSPACE_NAME;\n const LAST_SAVE_ID = 'workspace-ui:lastSave';\n const ICON_NAME = 'jp-JupyterIcon';\n \n /**\n- * The workspace MIME renderer and save plugin.\n+ * The workspace MIME renderer.\n  */\n export const workspacesPlugin: JupyterFrontEndPlugin<void> = {\n   id: '@jupyterlab/apputils-extension:workspaces',\n-  description: 'Add workspace file type and commands.',\n+  description: 'Add workspace file type.',\n   autoStart: true,\n-  requires: [\n-    IDefaultFileBrowser,\n-    IWindowResolver,\n-    IStateDB,\n-    ITranslator,\n-    JupyterFrontEnd.IPaths\n-  ],\n-  optional: [IRouter],\n+  requires: [IStateDB, IWorkspaceCommands, ITranslator],\n   activate: (\n     app: JupyterFrontEnd,\n-    fileBrowser: IDefaultFileBrowser,\n-    resolver: IWindowResolver,\n     state: IStateDB,\n-    translator: ITranslator,\n-    paths: JupyterFrontEnd.IPaths,\n-    router: IRouter | null\n+    commands: IWorkspaceCommands,\n+    translator: ITranslator\n   ): void => {\n     // The workspace factory creates dummy widgets to load a new workspace.\n     const factory = new Private.WorkspaceFactory({\n       workspaces: app.serviceManager.workspaces,\n-      router,\n       state,\n       translator,\n-      paths\n+      open: async (id: string) => {\n+        await app.commands.execute(commands.open, { workspace: id });\n+      }\n     });\n     const trans = translator.load('jupyterlab');\n \n@@ -69,102 +51,16 @@ export const workspacesPlugin: JupyterFrontEndPlugin<void> = {\n       name: WORKSPACE_NAME,\n       contentType: 'file',\n       fileFormat: 'text',\n-      displayName: trans.__('JupyterLab workspace File'),\n+      displayName: trans.__('JupyterLab Workspace File'),\n       extensions: [WORKSPACE_EXT],\n       mimeTypes: ['text/json'],\n       iconClass: ICON_NAME\n     });\n     app.docRegistry.addWidgetFactory(factory);\n-    app.commands.addCommand(CommandIDs.saveWorkspaceAs, {\n-      label: trans.__('Save Current Workspace Asâ€¦'),\n-      execute: async () => {\n-        const data = app.serviceManager.workspaces.fetch(resolver.name);\n-        await Private.saveAs(\n-          fileBrowser,\n-          app.serviceManager.contents,\n-          data,\n-          state,\n-          translator\n-        );\n-      }\n-    });\n-\n-    app.commands.addCommand(CommandIDs.saveWorkspace, {\n-      label: trans.__('Save Current Workspace'),\n-      execute: async () => {\n-        const { contents } = app.serviceManager;\n-        const data = app.serviceManager.workspaces.fetch(resolver.name);\n-        const lastSave = (await state.fetch(LAST_SAVE_ID)) as string;\n-        if (lastSave === undefined) {\n-          await Private.saveAs(fileBrowser, contents, data, state, translator);\n-        } else {\n-          await Private.save(lastSave, contents, data, state);\n-        }\n-      }\n-    });\n   }\n };\n \n namespace Private {\n-  /**\n-   * Save workspace to a user provided location\n-   */\n-  export async function save(\n-    userPath: string,\n-    contents: Contents.IManager,\n-    data: Promise<Workspace.IWorkspace>,\n-    state: IStateDB\n-  ): Promise<void> {\n-    let name = userPath.split('/').pop();\n-\n-    // Add extension if not provided or remove extension from name if it was.\n-    if (name !== undefined && name.includes('.')) {\n-      name = name.split('.')[0];\n-    } else {\n-      userPath = userPath + WORKSPACE_EXT;\n-    }\n-\n-    // Save last save location, for save button to work\n-    await state.save(LAST_SAVE_ID, userPath);\n-\n-    const resolvedData = await data;\n-    resolvedData.metadata.id = `${name}`;\n-    await contents.save(userPath, {\n-      type: 'file',\n-      format: 'text',\n-      content: JSON.stringify(resolvedData)\n-    });\n-  }\n-\n-  /**\n-   * Ask user for location, and save workspace.\n-   * Default location is the current directory in the file browser\n-   */\n-  export async function saveAs(\n-    browser: IDefaultFileBrowser,\n-    contents: Contents.IManager,\n-    data: Promise<Workspace.IWorkspace>,\n-    state: IStateDB,\n-    translator?: ITranslator\n-  ): Promise<void> {\n-    translator = translator || nullTranslator;\n-    const lastSave = await state.fetch(LAST_SAVE_ID);\n-\n-    let defaultName;\n-    if (lastSave === undefined) {\n-      defaultName = 'new-workspace';\n-    } else {\n-      defaultName = (lastSave as string).split('/').pop()?.split('.')[0];\n-    }\n-\n-    const defaultPath = browser.model.path + '/' + defaultName + WORKSPACE_EXT;\n-    const userPath = await getSavePath(defaultPath, translator);\n-\n-    if (userPath) {\n-      await save(userPath, contents, data, state);\n-    }\n-  }\n-\n   /**\n    * This widget factory is used to handle double click on workspace\n    */\n@@ -183,15 +79,14 @@ namespace Private {\n         defaultFor: [WORKSPACE_NAME],\n         readOnly: true\n       });\n-      this._application = options.paths.urls.app;\n-      this._router = options.router;\n       this._state = options.state;\n       this._workspaces = options.workspaces;\n+      this._open = options.open;\n     }\n \n     /**\n      * Loads the workspace into load, and jump to it\n-     * @param context This is used queried to query the workspace content\n+     * @param context This is used to query the workspace content\n      */\n     protected createNewWidget(\n       context: DocumentRegistry.Context\n@@ -201,6 +96,7 @@ namespace Private {\n         const file = context.model;\n         const workspace = file.toJSON() as unknown as Workspace.IWorkspace;\n         const path = context.path;\n+\n         const id = workspace.metadata.id;\n \n         // Save the file contents as a workspace.\n@@ -210,22 +106,12 @@ namespace Private {\n         await this._state.save(LAST_SAVE_ID, path);\n \n         // Navigate to new workspace.\n-        const workspacesBase = URLExt.join(this._application, 'workspaces');\n-        const url = URLExt.join(workspacesBase, id);\n-        if (!url.startsWith(workspacesBase)) {\n-          throw new Error('Can only be used for workspaces');\n-        }\n-        if (this._router) {\n-          this._router.navigate(url, { hard: true });\n-        } else {\n-          document.location.href = url;\n-        }\n+        await this._open(id);\n       });\n       return dummyWidget(context);\n     }\n \n-    private _application: string;\n-    private _router: IRouter | null;\n+    private _open: (id: string) => Promise<void>;\n     private _state: IStateDB;\n     private _workspaces: WorkspaceManager;\n   }\n@@ -238,11 +124,10 @@ namespace Private {\n      * Instantiation options for a `WorkspaceFactory`\n      */\n     export interface IOptions {\n-      paths: JupyterFrontEnd.IPaths;\n-      router: IRouter | null;\n       state: IStateDB;\n       translator: ITranslator;\n       workspaces: WorkspaceManager;\n+      open: (id: string) => Promise<void>;\n     }\n   }\n \n@@ -256,59 +141,4 @@ namespace Private {\n     widget.content.dispose();\n     return widget;\n   }\n-\n-  /**\n-   * Ask user for a path to save to.\n-   * @param defaultPath Path already present when the dialog is shown\n-   */\n-  async function getSavePath(\n-    defaultPath: string,\n-    translator?: ITranslator\n-  ): Promise<string | null> {\n-    translator = translator || nullTranslator;\n-    const trans = translator.load('jupyterlab');\n-    const saveBtn = Dialog.okButton({\n-      label: trans.__('Save'),\n-      ariaLabel: trans.__('Save Current Workspace')\n-    });\n-    const result = await showDialog({\n-      title: trans.__('Save Current Workspace Asâ€¦'),\n-      body: new SaveWidget(defaultPath),\n-      buttons: [Dialog.cancelButton(), saveBtn]\n-    });\n-    if (result.button.label === trans.__('Save')) {\n-      return result.value;\n-    } else {\n-      return null;\n-    }\n-  }\n-\n-  /**\n-   * A widget that gets a file path from a user.\n-   */\n-  class SaveWidget extends Widget {\n-    /**\n-     * Gets a modal node for getting save location. Will have a default to the current opened directory\n-     * @param path Default location\n-     */\n-    constructor(path: string) {\n-      super({ node: createSaveNode(path) });\n-    }\n-\n-    /**\n-     * Gets the save path entered by the user\n-     */\n-    getValue(): string {\n-      return (this.node as HTMLInputElement).value;\n-    }\n-  }\n-\n-  /**\n-   * Create the node for a save widget.\n-   */\n-  function createSaveNode(path: string): HTMLElement {\n-    const input = document.createElement('input');\n-    input.value = path;\n-    return input;\n-  }\n }\n\ndiff --git a/packages/apputils-extension/style/index.css b/packages/apputils-extension/style/index.css\nindex 71c2121a1343..ffde70ab19cb 100644\n--- a/packages/apputils-extension/style/index.css\n+++ b/packages/apputils-extension/style/index.css\n@@ -10,6 +10,5 @@\n @import url('~@jupyterlab/apputils/style/index.css');\n @import url('~@jupyterlab/docregistry/style/index.css');\n @import url('~@jupyterlab/application/style/index.css');\n-@import url('~@jupyterlab/filebrowser/style/index.css');\n @import url('~@jupyterlab/mainmenu/style/index.css');\n @import url('./base.css');\n\ndiff --git a/packages/apputils-extension/style/index.js b/packages/apputils-extension/style/index.js\nindex 8c82ce3eab07..4f2ca9702217 100644\n--- a/packages/apputils-extension/style/index.js\n+++ b/packages/apputils-extension/style/index.js\n@@ -10,7 +10,6 @@ import '@jupyterlab/statusbar/style/index.js';\n import '@jupyterlab/apputils/style/index.js';\n import '@jupyterlab/docregistry/style/index.js';\n import '@jupyterlab/application/style/index.js';\n-import '@jupyterlab/filebrowser/style/index.js';\n import '@jupyterlab/mainmenu/style/index.js';\n \n import './base.css';\n\ndiff --git a/packages/apputils-extension/tsconfig.json b/packages/apputils-extension/tsconfig.json\nindex 29f665978685..93e450bc2d0c 100644\n--- a/packages/apputils-extension/tsconfig.json\n+++ b/packages/apputils-extension/tsconfig.json\n@@ -18,9 +18,6 @@\n     {\n       \"path\": \"../docregistry\"\n     },\n-    {\n-      \"path\": \"../filebrowser\"\n-    },\n     {\n       \"path\": \"../mainmenu\"\n     },\n@@ -44,6 +41,9 @@\n     },\n     {\n       \"path\": \"../ui-components\"\n+    },\n+    {\n+      \"path\": \"../workspaces\"\n     }\n   ]\n }\n\ndiff --git a/packages/apputils/src/dialog.tsx b/packages/apputils/src/dialog.tsx\nindex 91c87afd34cd..d880dc312dde 100644\n--- a/packages/apputils/src/dialog.tsx\n+++ b/packages/apputils/src/dialog.tsx\n@@ -245,6 +245,9 @@ export class Dialog<T> extends Widget {\n       case 'click':\n         this._evtClick(event as MouseEvent);\n         break;\n+      case 'input':\n+        this._evtInput(event as InputEvent);\n+        break;\n       case 'focus':\n         this._evtFocus(event as FocusEvent);\n         break;\n@@ -267,6 +270,7 @@ export class Dialog<T> extends Widget {\n     node.addEventListener('click', this, true);\n     document.addEventListener('mousedown', this, true);\n     document.addEventListener('focus', this, true);\n+    document.addEventListener('input', this, true);\n     this._first = Private.findFirstFocusable(this.node);\n     this._original = document.activeElement as HTMLElement;\n \n@@ -309,6 +313,7 @@ export class Dialog<T> extends Widget {\n     node.removeEventListener('click', this, true);\n     document.removeEventListener('focus', this, true);\n     document.removeEventListener('mousedown', this, true);\n+    document.removeEventListener('input', this, true);\n     this._original.focus();\n   }\n \n@@ -321,6 +326,19 @@ export class Dialog<T> extends Widget {\n     }\n     super.onCloseRequest(msg);\n   }\n+  /**\n+   * Handle the `'input'` event for dialog's children.\n+   *\n+   * @param event - The DOM event sent to the widget\n+   */\n+  protected _evtInput(_event: InputEvent): void {\n+    this._hasValidationErrors = !!this.node.querySelector(':invalid');\n+    for (let i = 0; i < this._buttons.length; i++) {\n+      if (this._buttons[i].accept) {\n+        this._buttonNodes[i].disabled = this._hasValidationErrors;\n+      }\n+    }\n+  }\n \n   /**\n    * Handle the `'click'` event for a dialog button.\n@@ -367,7 +385,7 @@ export class Dialog<T> extends Widget {\n         const activeEl = document.activeElement;\n \n         if (activeEl instanceof HTMLButtonElement) {\n-          let idx = this._buttonNodes.indexOf(activeEl as HTMLElement) - 1;\n+          let idx = this._buttonNodes.indexOf(activeEl) - 1;\n \n           // Handle a left arrows on the first button\n           if (idx < 0) {\n@@ -386,7 +404,7 @@ export class Dialog<T> extends Widget {\n         const activeEl = document.activeElement;\n \n         if (activeEl instanceof HTMLButtonElement) {\n-          let idx = this._buttonNodes.indexOf(activeEl as HTMLElement) + 1;\n+          let idx = this._buttonNodes.indexOf(activeEl) + 1;\n \n           // Handle a right arrows on the last button\n           if (idx == this._buttons.length) {\n@@ -420,7 +438,7 @@ export class Dialog<T> extends Widget {\n         let index: number | undefined;\n \n         if (activeEl instanceof HTMLButtonElement) {\n-          index = this._buttonNodes.indexOf(activeEl as HTMLElement);\n+          index = this._buttonNodes.indexOf(activeEl);\n         }\n         this.resolve(index);\n         break;\n@@ -460,6 +478,10 @@ export class Dialog<T> extends Widget {\n    * Resolve a button item.\n    */\n   private _resolve(button: Dialog.IButton): void {\n+    if (this._hasValidationErrors && button.accept) {\n+      // Do not allow accepting with validation errors\n+      return;\n+    }\n     // Prevent loopback.\n     const promise = this._promise;\n     if (!promise) {\n@@ -487,8 +509,9 @@ export class Dialog<T> extends Widget {\n     });\n   }\n \n+  private _hasValidationErrors: boolean = false;\n   private _ready: PromiseDelegate<void> = new PromiseDelegate<void>();\n-  private _buttonNodes: ReadonlyArray<HTMLElement>;\n+  private _buttonNodes: ReadonlyArray<HTMLButtonElement>;\n   private _buttons: ReadonlyArray<Dialog.IButton>;\n   private _checkboxNode: HTMLElement | null;\n   private _original: HTMLElement;\n@@ -656,7 +679,7 @@ export namespace Dialog {\n     checkbox: Partial<ICheckbox> | null;\n \n     /**\n-     * The index of the default button.  Defaults to the last button.\n+     * The index of the default button. Defaults to the last button.\n      */\n     defaultButton: number;\n \n@@ -726,7 +749,7 @@ export namespace Dialog {\n      *\n      * @returns A node for the button.\n      */\n-    createButtonNode(button: IButton): HTMLElement;\n+    createButtonNode(button: IButton): HTMLButtonElement;\n \n     /**\n      * Create a checkbox node for the dialog.\n@@ -964,7 +987,7 @@ export namespace Dialog {\n      *\n      * @returns A node for the button.\n      */\n-    createButtonNode(button: IButton): HTMLElement {\n+    createButtonNode(button: IButton): HTMLButtonElement {\n       const e = document.createElement('button');\n       e.className = this.createItemClass(button);\n       e.appendChild(this.renderIcon(button));\n\ndiff --git a/packages/apputils/src/inputdialog.ts b/packages/apputils/src/inputdialog.ts\nindex fa87352c2790..937f05326007 100644\n--- a/packages/apputils/src/inputdialog.ts\n+++ b/packages/apputils/src/inputdialog.ts\n@@ -16,7 +16,7 @@ export namespace InputDialog {\n   /**\n    * Common constructor options for input dialogs\n    */\n-  export interface IOptions {\n+  export interface IOptions extends IBaseOptions {\n     /**\n      * The top level text for the dialog. Defaults to an empty string.\n      */\n@@ -27,11 +27,6 @@ export namespace InputDialog {\n      */\n     host?: HTMLElement;\n \n-    /**\n-     * Label of the requested input\n-     */\n-    label?: string;\n-\n     /**\n      * An optional renderer for dialog items. Defaults to a shared\n      * default renderer.\n@@ -52,6 +47,11 @@ export namespace InputDialog {\n      * The checkbox to display in the footer. Defaults no checkbox.\n      */\n     checkbox?: Partial<Dialog.ICheckbox> | null;\n+\n+    /**\n+     * The index of the default button. Defaults to the last button.\n+     */\n+    defaultButton?: number;\n   }\n \n   /**\n@@ -215,6 +215,14 @@ export namespace InputDialog {\n      * Default is to select the whole input text if present.\n      */\n     selectionRange?: number;\n+    /**\n+     * Pattern used by the browser to validate the input value.\n+     */\n+    pattern?: string;\n+    /**\n+     * Whether the input is required (has to be non-empty).\n+     */\n+    required?: boolean;\n   }\n \n   /**\n@@ -260,6 +268,26 @@ export namespace InputDialog {\n   }\n }\n \n+/**\n+ * Constructor options for base input dialog body.\n+ */\n+interface IBaseOptions {\n+  /**\n+   * Label of the requested input\n+   */\n+  label?: string;\n+\n+  /**\n+   * Additional prefix string preceding the input (e.g. Â£).\n+   */\n+  prefix?: string;\n+\n+  /**\n+   * Additional suffix string following the input (e.g. $).\n+   */\n+  suffix?: string;\n+}\n+\n /**\n  * Base widget for input dialog body\n  */\n@@ -269,7 +297,7 @@ class InputDialogBase<T> extends Widget implements Dialog.IBodyWidget<T> {\n    *\n    * @param label Input field label\n    */\n-  constructor(label?: string) {\n+  constructor(options: IBaseOptions) {\n     super();\n     this.addClass(INPUT_DIALOG_CLASS);\n \n@@ -277,16 +305,38 @@ class InputDialogBase<T> extends Widget implements Dialog.IBodyWidget<T> {\n     this._input.classList.add('jp-mod-styled');\n     this._input.id = 'jp-dialog-input-id';\n \n-    if (label !== undefined) {\n+    if (options.label !== undefined) {\n       const labelElement = document.createElement('label');\n-      labelElement.textContent = label;\n+      labelElement.textContent = options.label;\n       labelElement.htmlFor = this._input.id;\n \n       // Initialize the node\n       this.node.appendChild(labelElement);\n     }\n \n-    this.node.appendChild(this._input);\n+    const wrapper = document.createElement('div');\n+    wrapper.className = 'jp-InputDialog-inputWrapper';\n+\n+    if (options.prefix) {\n+      const prefix = document.createElement('span');\n+      prefix.className = 'jp-InputDialog-inputPrefix';\n+      prefix.textContent = options.prefix;\n+      // Both US WDS (https://designsystem.digital.gov/components/input-prefix-suffix/)\n+      // and UK DS (https://design-system.service.gov.uk/components/text-input/) recommend\n+      // hiding prefixes and suffixes from screen readers.\n+      prefix.ariaHidden = 'true';\n+      wrapper.appendChild(prefix);\n+    }\n+    wrapper.appendChild(this._input);\n+    if (options.suffix) {\n+      const suffix = document.createElement('span');\n+      suffix.className = 'jp-InputDialog-inputSuffix';\n+      suffix.textContent = options.suffix;\n+      suffix.ariaHidden = 'true';\n+      wrapper.appendChild(suffix);\n+    }\n+\n+    this.node.appendChild(wrapper);\n   }\n \n   /** Input HTML node */\n@@ -303,7 +353,7 @@ class InputBooleanDialog extends InputDialogBase<boolean> {\n    * @param options Constructor options\n    */\n   constructor(options: InputDialog.IBooleanOptions) {\n-    super(options.label);\n+    super(options);\n     this.addClass(INPUT_BOOLEAN_DIALOG_CLASS);\n \n     this._input.type = 'checkbox';\n@@ -328,7 +378,7 @@ class InputNumberDialog extends InputDialogBase<number> {\n    * @param options Constructor options\n    */\n   constructor(options: InputDialog.INumberOptions) {\n-    super(options.label);\n+    super(options);\n \n     this._input.type = 'number';\n     this._input.value = options.value ? options.value.toString() : '0';\n@@ -347,22 +397,49 @@ class InputNumberDialog extends InputDialogBase<number> {\n }\n \n /**\n- * Widget body for input text dialog\n+ * Base widget body for input text/password/email dialog\n  */\n-class InputTextDialog extends InputDialogBase<string> {\n+class InputDialogTextBase extends InputDialogBase<string> {\n   /**\n-   * InputTextDialog constructor\n+   * InputDialogTextBase constructor\n    *\n    * @param options Constructor options\n    */\n-  constructor(options: InputDialog.ITextOptions) {\n-    super(options.label);\n-\n-    this._input.type = 'text';\n+  constructor(options: Omit<InputDialog.ITextOptions, 'selectionRange'>) {\n+    super(options);\n     this._input.value = options.text ? options.text : '';\n     if (options.placeholder) {\n       this._input.placeholder = options.placeholder;\n     }\n+    if (options.pattern) {\n+      this._input.pattern = options.pattern;\n+    }\n+    if (options.required) {\n+      this._input.required = options.required;\n+    }\n+  }\n+\n+  /**\n+   * Get the text specified by the user\n+   */\n+  getValue(): string {\n+    return this._input.value;\n+  }\n+}\n+\n+/**\n+ * Widget body for input text dialog\n+ */\n+class InputTextDialog extends InputDialogTextBase {\n+  /**\n+   * InputTextDialog constructor\n+   *\n+   * @param options Constructor options\n+   */\n+  constructor(options: InputDialog.ITextOptions) {\n+    super(options);\n+    this._input.type = 'text';\n+\n     this._initialSelectionRange = Math.min(\n       this._input.value.length,\n       Math.max(0, options.selectionRange ?? this._input.value.length)\n@@ -379,33 +456,21 @@ class InputTextDialog extends InputDialogBase<string> {\n     }\n   }\n \n-  /**\n-   * Get the text specified by the user\n-   */\n-  getValue(): string {\n-    return this._input.value;\n-  }\n-\n   private _initialSelectionRange: number;\n }\n \n /**\n  * Widget body for input password dialog\n  */\n-class InputPasswordDialog extends InputDialogBase<string> {\n+class InputPasswordDialog extends InputDialogTextBase {\n   /**\n    * InputPasswordDialog constructor\n    *\n    * @param options Constructor options\n    */\n   constructor(options: InputDialog.ITextOptions) {\n-    super(options.label);\n-\n+    super(options);\n     this._input.type = 'password';\n-    this._input.value = options.text ? options.text : '';\n-    if (options.placeholder) {\n-      this._input.placeholder = options.placeholder;\n-    }\n   }\n \n   /**\n@@ -417,13 +482,6 @@ class InputPasswordDialog extends InputDialogBase<string> {\n       this._input.select();\n     }\n   }\n-\n-  /**\n-   * Get the text specified by the user\n-   */\n-  getValue(): string {\n-    return this._input.value;\n-  }\n }\n \n /**\n@@ -436,7 +494,7 @@ class InputItemsDialog extends InputDialogBase<string> {\n    * @param options Constructor options\n    */\n   constructor(options: InputDialog.IItemOptions) {\n-    super(options.label);\n+    super(options);\n \n     this._editable = options.editable || false;\n \n@@ -474,8 +532,7 @@ class InputItemsDialog extends InputDialogBase<string> {\n       this.node.appendChild(data);\n     } else {\n       /* Use select directly */\n-      this._input.remove();\n-      this.node.appendChild(this._list);\n+      this._input.parentElement!.replaceChild(this._list, this._input);\n     }\n   }\n \n@@ -504,7 +561,7 @@ class InputMultipleItemsDialog extends InputDialogBase<string> {\n    * @param options Constructor options\n    */\n   constructor(options: InputDialog.IMultipleItemsOptions) {\n-    super(options.label);\n+    super(options);\n \n     let defaults = options.defaults || [];\n \n\ndiff --git a/packages/apputils/style/dialog.css b/packages/apputils/style/dialog.css\nindex 7806de440c43..57b1141fb596 100644\n--- a/packages/apputils/style/dialog.css\n+++ b/packages/apputils/style/dialog.css\n@@ -50,6 +50,10 @@\n   overflow: visible;\n }\n \n+button.jp-Dialog-button:disabled {\n+  opacity: 0.6;\n+}\n+\n button.jp-Dialog-button:focus {\n   outline: 1px solid var(--jp-brand-color1);\n   outline-offset: 4px;\n\ndiff --git a/packages/apputils/style/inputdialog.css b/packages/apputils/style/inputdialog.css\nindex 4603a4d5612c..39bfa36054c8 100644\n--- a/packages/apputils/style/inputdialog.css\n+++ b/packages/apputils/style/inputdialog.css\n@@ -12,3 +12,20 @@\n .jp-Input-Boolean-Dialog > label {\n   flex: 1 1 auto;\n }\n+\n+.jp-InputDialog-inputWrapper {\n+  display: flex;\n+  align-items: baseline;\n+}\n+\n+.jp-InputDialog-inputWrapper > input.jp-mod-styled:invalid {\n+  border-color: var(--jp-error-color0);\n+  background: var(--jp-error-color3);\n+}\n+\n+.jp-InputDialog-inputWrapper\n+  > input[required].jp-mod-styled:invalid:placeholder-shown {\n+  /* Do not show invalid style when placeholder is shown */\n+  border-color: unset;\n+  background: unset;\n+}\n\ndiff --git a/packages/filebrowser/src/opendialog.ts b/packages/filebrowser/src/opendialog.ts\nindex 0e916c63d224..bb6a36c0546f 100644\n--- a/packages/filebrowser/src/opendialog.ts\n+++ b/packages/filebrowser/src/opendialog.ts\n@@ -18,6 +18,11 @@ import { PromiseDelegate } from '@lumino/coreutils';\n  */\n const OPEN_DIALOG_CLASS = 'jp-Open-Dialog';\n \n+/**\n+ * The class name added to (optional) label in the file dialog\n+ */\n+const OPEN_DIALOG_LABEL_CLASS = 'jp-Open-Dialog-label';\n+\n /**\n  * Namespace for file dialog\n  */\n@@ -49,6 +54,11 @@ export namespace FileDialog {\n      * Default path to open\n      */\n     defaultPath?: string;\n+\n+    /**\n+     * Text to display above the file browser.\n+     */\n+    label?: string;\n   }\n \n   /**\n@@ -85,7 +95,8 @@ export namespace FileDialog {\n       options.manager,\n       options.filter,\n       translator,\n-      options.defaultPath\n+      options.defaultPath,\n+      options.label\n     );\n     const dialogOptions: Partial<Dialog.IOptions<Contents.IModel[]>> = {\n       title: options.title,\n@@ -141,6 +152,7 @@ class OpenDialog\n     filter?: (value: Contents.IModel) => Partial<IScore> | null,\n     translator?: ITranslator,\n     defaultPath?: string,\n+    label?: string,\n     filterDirectories?: boolean\n   ) {\n     super();\n@@ -191,6 +203,12 @@ class OpenDialog\n \n         // Build the sub widgets\n         const layout = new PanelLayout();\n+        if (label) {\n+          const labelWidget = new Widget();\n+          labelWidget.addClass(OPEN_DIALOG_LABEL_CLASS);\n+          labelWidget.node.textContent = label;\n+          layout.addWidget(labelWidget);\n+        }\n         layout.addWidget(this._browser);\n \n         /**\n\ndiff --git a/packages/filebrowser/style/base.css b/packages/filebrowser/style/base.css\nindex 9247008308ae..4e1289009a32 100644\n--- a/packages/filebrowser/style/base.css\n+++ b/packages/filebrowser/style/base.css\n@@ -12,11 +12,6 @@\n   --jp-private-filebrowser-button-width: 48px;\n }\n \n-/*-----------------------------------------------------------------------------\n-| Copyright (c) Jupyter Development Team.\n-| Distributed under the terms of the Modified BSD License.\n-|----------------------------------------------------------------------------*/\n-\n .jp-FileBrowser .jp-SidePanel-content {\n   display: flex;\n   flex-direction: column;\n@@ -104,6 +99,14 @@\n   display: none;\n }\n \n+.jp-Open-Dialog > .jp-FileBrowser {\n+  min-height: 200px;\n+}\n+\n+.jp-Open-Dialog-label {\n+  overflow: visible;\n+}\n+\n /*-----------------------------------------------------------------------------\n | DirListing\n |----------------------------------------------------------------------------*/\n\ndiff --git a/packages/metapackage/package.json b/packages/metapackage/package.json\nindex 3a0ac229ea66..536277d95e63 100644\n--- a/packages/metapackage/package.json\n+++ b/packages/metapackage/package.json\n@@ -130,7 +130,9 @@\n     \"@jupyterlab/translation-extension\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components-extension\": \"^4.2.0-alpha.1\",\n-    \"@jupyterlab/vega5-extension\": \"^4.2.0-alpha.1\"\n+    \"@jupyterlab/vega5-extension\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces-extension\": \"^4.2.0-alpha.1\"\n   },\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.2.0-alpha.1\",\n\ndiff --git a/packages/metapackage/tsconfig.json b/packages/metapackage/tsconfig.json\nindex 3e8aabcef069..59f20ae24b23 100644\n--- a/packages/metapackage/tsconfig.json\n+++ b/packages/metapackage/tsconfig.json\n@@ -284,6 +284,12 @@\n     },\n     {\n       \"path\": \"../vega5-extension\"\n+    },\n+    {\n+      \"path\": \"../workspaces\"\n+    },\n+    {\n+      \"path\": \"../workspaces-extension\"\n     }\n   ]\n }\n\ndiff --git a/packages/running/src/index.tsx b/packages/running/src/index.tsx\nindex 7e3934402ec6..372822594197 100644\n--- a/packages/running/src/index.tsx\n+++ b/packages/running/src/index.tsx\n@@ -199,7 +199,7 @@ export class RunningSessionManagers implements IRunningSessionManagers {\n function Item(props: {\n   child?: boolean;\n   runningItem: IRunningSessions.IRunningItem;\n-  shutdownLabel?: string;\n+  shutdownLabel?: string | ((item: IRunningSessions.IRunningItem) => string);\n   shutdownItemIcon?: LabIcon;\n   translator?: ITranslator;\n   collapseToggled: ISignal<Section, boolean>;\n@@ -215,7 +215,10 @@ function Item(props: {\n   // Handle shutdown requests.\n   let stopPropagation = false;\n   const shutdownItemIcon = props.shutdownItemIcon || closeIcon;\n-  const shutdownLabel = props.shutdownLabel || trans.__('Shut Down');\n+  const shutdownLabel =\n+    (typeof props.shutdownLabel === 'function'\n+      ? props.shutdownLabel(runningItem)\n+      : props.shutdownLabel) ?? trans.__('Shut Down');\n   const shutdown = () => {\n     stopPropagation = true;\n     runningItem.shutdown?.();\n@@ -301,7 +304,7 @@ function Item(props: {\n function List(props: {\n   child?: boolean;\n   runningItems: IRunningSessions.IRunningItem[];\n-  shutdownLabel?: string;\n+  shutdownLabel?: string | ((item: IRunningSessions.IRunningItem) => string);\n   shutdownAllLabel?: string;\n   shutdownItemIcon?: LabIcon;\n   filter?: (item: IRunningSessions.IRunningItem) => Partial<IScore> | null;\n@@ -1125,7 +1128,7 @@ export namespace IRunningSessions {\n     /**\n      * A string used to describe the shutdown action.\n      */\n-    shutdownLabel?: string;\n+    shutdownLabel?: string | ((item: IRunningSessions.IRunningItem) => string);\n \n     /**\n      * A string used to describe the shutdown all action.\n\ndiff --git a/packages/services/src/workspace/index.ts b/packages/services/src/workspace/index.ts\nindex f77c7cbe775a..9a7d8e43736c 100644\n--- a/packages/services/src/workspace/index.ts\n+++ b/packages/services/src/workspace/index.ts\n@@ -166,6 +166,16 @@ export namespace Workspace {\n        * The workspace ID.\n        */\n       id: string;\n+\n+      /**\n+       * The last modification date and time for this workspace (ISO 8601 format).\n+       */\n+      last_modified?: string;\n+\n+      /**\n+       * The creation date and time for this workspace (ISO 8601 format).\n+       */\n+      created?: string;\n     };\n   }\n }\n\ndiff --git a/packages/workspaces-extension/.vscode/launch.json b/packages/workspaces-extension/.vscode/launch.json\nnew file mode 100644\nindex 000000000000..64126e422f32\n--- /dev/null\n+++ b/packages/workspaces-extension/.vscode/launch.json\n@@ -0,0 +1,15 @@\n+{\n+  \"version\": \"0.2.0\",\n+  \"configurations\": [\n+    {\n+      \"type\": \"node\",\n+      \"request\": \"attach\",\n+      \"name\": \"Attach to jest\",\n+      // Usage:\n+      // Open the parent directory in VSCode\n+      // Run \\`jlpm test:debug:watch\\` in a terminal\n+      // Run this debugging task\n+      \"port\": 9229\n+    }\n+  ]\n+}\n\ndiff --git a/packages/workspaces-extension/package.json b/packages/workspaces-extension/package.json\nnew file mode 100644\nindex 000000000000..e27e219685d1\n--- /dev/null\n+++ b/packages/workspaces-extension/package.json\n@@ -0,0 +1,62 @@\n+{\n+  \"name\": \"@jupyterlab/workspaces-extension\",\n+  \"version\": \"4.2.0-alpha.1\",\n+  \"description\": \"JupyterLab Extension providing UI for workspace management\",\n+  \"homepage\": \"https://github.com/jupyterlab/jupyterlab\",\n+  \"bugs\": {\n+    \"url\": \"https://github.com/jupyterlab/jupyterlab/issues\"\n+  },\n+  \"repository\": {\n+    \"type\": \"git\",\n+    \"url\": \"https://github.com/jupyterlab/jupyterlab.git\"\n+  },\n+  \"license\": \"BSD-3-Clause\",\n+  \"author\": \"Project Jupyter\",\n+  \"sideEffects\": [\n+    \"style/**/*\"\n+  ],\n+  \"main\": \"lib/index.js\",\n+  \"types\": \"lib/index.d.ts\",\n+  \"style\": \"style/index.css\",\n+  \"directories\": {\n+    \"lib\": \"lib/\"\n+  },\n+  \"files\": [\n+    \"lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}\",\n+    \"schema/*.json\",\n+    \"style/**/*.{css,eot,gif,html,jpg,json,png,svg,woff2,ttf}\",\n+    \"src/**/*.{ts,tsx}\",\n+    \"style/index.js\"\n+  ],\n+  \"scripts\": {\n+    \"build\": \"tsc -b\",\n+    \"build:test\": \"tsc --build tsconfig.test.json\",\n+    \"clean\": \"rimraf lib tsconfig.tsbuildinfo\",\n+    \"watch\": \"tsc -b --watch\"\n+  },\n+  \"dependencies\": {\n+    \"@jupyterlab/application\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/apputils\": \"^4.3.0-alpha.1\",\n+    \"@jupyterlab/coreutils\": \"^6.2.0-alpha.1\",\n+    \"@jupyterlab/filebrowser\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/running\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/services\": \"^7.2.0-alpha.1\",\n+    \"@jupyterlab/statedb\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/translation\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/ui-components\": \"^4.2.0-alpha.1\",\n+    \"@jupyterlab/workspaces\": \"^4.2.0-alpha.1\"\n+  },\n+  \"devDependencies\": {\n+    \"@types/jest\": \"^29.2.0\",\n+    \"rimraf\": \"~5.0.5\",\n+    \"typescript\": \"~5.1.6\"\n+  },\n+  \"publishConfig\": {\n+    \"access\": \"public\"\n+  },\n+  \"jupyterlab\": {\n+    \"extension\": true,\n+    \"schemaDir\": \"schema\"\n+  },\n+  \"styleModule\": \"style/index.js\"\n+}\n\ndiff --git a/packages/workspaces-extension/schema/menu.json b/packages/workspaces-extension/schema/menu.json\nnew file mode 100644\nindex 000000000000..133787723e41\n--- /dev/null\n+++ b/packages/workspaces-extension/schema/menu.json\n@@ -0,0 +1,70 @@\n+{\n+  \"title\": \"Workspaces Menu\",\n+  \"description\": \"Workspaces Menu\",\n+  \"jupyter.lab.menus\": {\n+    \"main\": [\n+      {\n+        \"id\": \"jp-mainmenu-file\",\n+        \"items\": [\n+          {\n+            \"type\": \"submenu\",\n+            \"rank\": 10,\n+            \"submenu\": {\n+              \"id\": \"jp-mainmenu-file-workspaces\",\n+              \"label\": \"Workspaces\",\n+              \"items\": [\n+                {\n+                  \"command\": \"workspace-ui:open\",\n+                  \"rank\": 0\n+                },\n+                {\n+                  \"command\": \"workspace-ui:create-new\",\n+                  \"rank\": 1\n+                },\n+                {\n+                  \"command\": \"workspace-ui:clone\",\n+                  \"rank\": 2\n+                },\n+                {\n+                  \"command\": \"workspace-ui:rename\",\n+                  \"rank\": 3\n+                },\n+                {\n+                  \"command\": \"workspace-ui:save\",\n+                  \"rank\": 4\n+                },\n+                {\n+                  \"command\": \"workspace-ui:save-as\",\n+                  \"rank\": 5\n+                },\n+                {\n+                  \"command\": \"workspace-ui:import\",\n+                  \"rank\": 6\n+                },\n+                {\n+                  \"command\": \"workspace-ui:export\",\n+                  \"rank\": 7\n+                },\n+                {\n+                  \"type\": \"separator\",\n+                  \"rank\": 8\n+                },\n+                {\n+                  \"command\": \"workspace-ui:reset\",\n+                  \"rank\": 9\n+                },\n+                {\n+                  \"command\": \"workspace-ui:delete\",\n+                  \"rank\": 10\n+                }\n+              ]\n+            }\n+          }\n+        ]\n+      }\n+    ]\n+  },\n+  \"properties\": {},\n+  \"additionalProperties\": false,\n+  \"type\": \"object\"\n+}\n\ndiff --git a/packages/workspaces-extension/schema/sidebar.json b/packages/workspaces-extension/schema/sidebar.json\nnew file mode 100644\nindex 000000000000..1656b644199a\n--- /dev/null\n+++ b/packages/workspaces-extension/schema/sidebar.json\n@@ -0,0 +1,51 @@\n+{\n+  \"title\": \"Workspaces Sidebar\",\n+  \"description\": \"Workspaces Sidebar\",\n+  \"jupyter.lab.menus\": {\n+    \"context\": [\n+      {\n+        \"command\": \"workspace-ui:clone\",\n+        \"selector\": \".jp-RunningSessions-item.jp-mod-workspace\",\n+        \"rank\": 0\n+      },\n+      {\n+        \"command\": \"workspace-ui:rename\",\n+        \"selector\": \".jp-RunningSessions-item.jp-mod-workspace\",\n+        \"rank\": 1\n+      },\n+      {\n+        \"command\": \"workspace-ui:reset\",\n+        \"selector\": \".jp-RunningSessions-item.jp-mod-workspace\",\n+        \"rank\": 2\n+      },\n+      {\n+        \"command\": \"workspace-ui:delete\",\n+        \"selector\": \".jp-RunningSessions-item.jp-mod-workspace\",\n+        \"rank\": 3\n+      },\n+      {\n+        \"command\": \"workspace-ui:export\",\n+        \"selector\": \".jp-RunningSessions-item.jp-mod-workspace\",\n+        \"rank\": 4\n+      },\n+      {\n+        \"type\": \"separator\",\n+        \"selector\": \".jp-RunningSessions-item.jp-mod-workspace\",\n+        \"rank\": 5\n+      },\n+      {\n+        \"command\": \"workspace-ui:import\",\n+        \"selector\": \".jp-RunningSessions:has(.jp-mod-workspace)\",\n+        \"rank\": 6\n+      },\n+      {\n+        \"command\": \"workspace-ui:create-new\",\n+        \"selector\": \".jp-RunningSessions:has(.jp-mod-workspace)\",\n+        \"rank\": 7\n+      }\n+    ]\n+  },\n+  \"properties\": {},\n+  \"additionalProperties\": false,\n+  \"type\": \"object\"\n+}\n\ndiff --git a/packages/workspaces-extension/src/commands.ts b/packages/workspaces-extension/src/commands.ts\nnew file mode 100644\nindex 000000000000..6d9cad0253f2\n--- /dev/null\n+++ b/packages/workspaces-extension/src/commands.ts\n@@ -0,0 +1,597 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import {\n+  IRouter,\n+  JupyterFrontEnd,\n+  JupyterFrontEndPlugin\n+} from '@jupyterlab/application';\n+import {\n+  Dialog,\n+  InputDialog,\n+  IWindowResolver,\n+  showDialog\n+} from '@jupyterlab/apputils';\n+\n+import { URLExt } from '@jupyterlab/coreutils';\n+\n+import { FileDialog, IDefaultFileBrowser } from '@jupyterlab/filebrowser';\n+import { Contents, Workspace } from '@jupyterlab/services';\n+import { IStateDB } from '@jupyterlab/statedb';\n+import { ITranslator, nullTranslator } from '@jupyterlab/translation';\n+import { ICommandPalette } from '@jupyterlab/apputils';\n+import { IWorkspaceCommands, IWorkspacesModel } from '@jupyterlab/workspaces';\n+\n+namespace CommandIDs {\n+  /**\n+   * Open a workspace by identifier. When no identifier is supplied, falls back to a simple choice dialog.\n+   */\n+  export const open = 'workspace-ui:open';\n+  /**\n+   * Save the current workspace.\n+   */\n+  export const save = 'workspace-ui:save';\n+  /**\n+   * Save the current workspace under a different path.\n+   */\n+  export const saveAs = 'workspace-ui:save-as';\n+  /**\n+   * Create a new workspace.\n+   */\n+  export const createNew = 'workspace-ui:create-new';\n+  /**\n+   * Delete a workspace.\n+   */\n+  export const deleteWorkspace = 'workspace-ui:delete';\n+  /**\n+   * Clone a given workspace.\n+   */\n+  export const clone = 'workspace-ui:clone';\n+  /**\n+   * Rename a workspace.\n+   */\n+  export const rename = 'workspace-ui:rename';\n+  /**\n+   * Reset a workspace.\n+   */\n+  export const reset = 'workspace-ui:reset';\n+  /**\n+   * Import a workspace.\n+   */\n+  export const importWorkspace = 'workspace-ui:import';\n+  /**\n+   * Export a workspace.\n+   */\n+  export const exportWorkspace = 'workspace-ui:export';\n+}\n+\n+const WORKSPACE_NAME = 'jupyterlab-workspace';\n+const WORKSPACE_EXT = '.' + WORKSPACE_NAME;\n+const LAST_SAVE_ID = 'workspace-ui:lastSave';\n+\n+export const WORKSPACE_ITEM_CLASS = 'jp-mod-workspace';\n+\n+/**\n+ * The workspace commands\n+ */\n+export const commandsPlugin: JupyterFrontEndPlugin<IWorkspaceCommands> = {\n+  id: '@jupyterlab/workspaces:commands',\n+  description: 'Add workspace commands.',\n+  autoStart: true,\n+  requires: [\n+    IWorkspacesModel,\n+    IDefaultFileBrowser,\n+    IWindowResolver,\n+    IStateDB,\n+    ITranslator,\n+    JupyterFrontEnd.IPaths\n+  ],\n+  provides: IWorkspaceCommands,\n+  optional: [IRouter, ICommandPalette],\n+  activate: (\n+    app: JupyterFrontEnd,\n+    model: IWorkspacesModel,\n+    fileBrowser: IDefaultFileBrowser,\n+    resolver: IWindowResolver,\n+    state: IStateDB,\n+    translator: ITranslator,\n+    paths: JupyterFrontEnd.IPaths,\n+    router: IRouter | null,\n+    palette: ICommandPalette | null\n+  ): IWorkspaceCommands => {\n+    const trans = translator.load('jupyterlab');\n+\n+    const namingHintLabel = trans.__(\n+      'Naming the workspace will create a unique URL. The name may contain letters, numbers, hyphens (-), and underscores (_).'\n+    );\n+    const workspacesBase = URLExt.join(paths.urls.app, 'workspaces');\n+    const resourcePrefix = workspacesBase + '/';\n+    // `-` needs double backslashes to be escaped in `v` mode used for patterns\n+    const namePattern = '[a-zA-Z0-9\\\\-_]+';\n+\n+    const getNameForWorkspace = async (\n+      options: Omit<InputDialog.ITextOptions, 'prefix' | 'pattern' | 'label'>\n+    ) => {\n+      return InputDialog.getText({\n+        label: namingHintLabel,\n+        prefix: resourcePrefix,\n+        pattern: namePattern,\n+        required: true,\n+        placeholder: trans.__('workspace-name'),\n+        ...options\n+      });\n+    };\n+\n+    const test = (node: HTMLElement) =>\n+      node.classList.contains(WORKSPACE_ITEM_CLASS);\n+\n+    app.commands.addCommand(CommandIDs.open, {\n+      label: args => {\n+        const workspaceId = args.workspace as string | undefined;\n+        return workspaceId\n+          ? trans.__('Open Workspace')\n+          : trans.__('Open Workspaceâ€¦');\n+      },\n+      execute: async args => {\n+        let workspaceId = args.workspace as string | undefined;\n+\n+        if (!workspaceId) {\n+          const result = await InputDialog.getItem({\n+            title: trans.__('Choose Workspace To Open'),\n+            label: trans.__('Choose an existing workspace to open.'),\n+            items: model.identifiers,\n+            okLabel: trans.__('Choose'),\n+            prefix: resourcePrefix\n+          });\n+          if (!result.value || !result.button.accept) {\n+            return;\n+          }\n+          workspaceId = result.value;\n+        }\n+\n+        if (!workspaceId) {\n+          return;\n+        }\n+\n+        const url = URLExt.join(workspacesBase, workspaceId);\n+        if (!url.startsWith(workspacesBase)) {\n+          throw new Error('Can only be used for workspaces');\n+        }\n+        if (router) {\n+          router.navigate(url, { hard: true });\n+        } else {\n+          document.location.href = url;\n+        }\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.deleteWorkspace, {\n+      label: trans.__('Delete Workspaceâ€¦'),\n+      execute: async args => {\n+        const node = app.contextMenuHitTest(test);\n+        let workspaceId =\n+          (args.workspace as string | undefined) ?? node?.dataset['context'];\n+\n+        if (!workspaceId) {\n+          const result = await InputDialog.getItem({\n+            title: trans.__('Choose Workspace To Delete'),\n+            label: trans.__('Choose an existing workspace to delete.'),\n+            items: model.identifiers,\n+            okLabel: trans.__('Choose')\n+          });\n+          if (!result.value || !result.button.accept) {\n+            return;\n+          }\n+          workspaceId = result.value;\n+        }\n+\n+        if (!workspaceId) {\n+          return;\n+        }\n+        const result = await showDialog({\n+          title: trans.__('Delete workspace'),\n+          body: trans.__(\n+            'Deleting workspace \"%1\" will also delete its URL. A deleted workspace cannot be recovered.',\n+            workspaceId\n+          ),\n+          buttons: [\n+            Dialog.cancelButton(),\n+            Dialog.warnButton({ label: trans.__('Delete') })\n+          ],\n+          defaultButton: 0\n+        });\n+\n+        if (result.button.accept) {\n+          await model.remove(workspaceId);\n+        }\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.createNew, {\n+      label: trans.__('Create New Workspaceâ€¦'),\n+      execute: async args => {\n+        let workspaceId = args.workspace as string | undefined;\n+\n+        if (!workspaceId) {\n+          const result = await getNameForWorkspace({\n+            title: trans.__('Create New Workspace'),\n+            okLabel: trans.__('Create')\n+          });\n+          if (!result.value || !result.button.accept) {\n+            return;\n+          }\n+          workspaceId = result.value;\n+        }\n+        if (!workspaceId) {\n+          return;\n+        }\n+        await model.create(workspaceId);\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.clone, {\n+      label: trans.__('Clone Workspaceâ€¦'),\n+      execute: async args => {\n+        const node = app.contextMenuHitTest(test);\n+        let workspaceId =\n+          (args.workspace as string | undefined) ?? node?.dataset['context'];\n+        if (!workspaceId) {\n+          const result = await InputDialog.getItem({\n+            title: trans.__('Choose Workspace To Clone'),\n+            label: trans.__('Choose an existing workspace to clone.'),\n+            items: model.identifiers,\n+            okLabel: trans.__('Choose')\n+          });\n+          if (!result.value || !result.button.accept) {\n+            return;\n+          }\n+          workspaceId = result.value;\n+        }\n+\n+        const result = await getNameForWorkspace({\n+          title: trans.__('Clone Workspace'),\n+          text: trans.__('%1-clone', workspaceId),\n+          okLabel: trans.__('Clone')\n+        });\n+\n+        if (!result.button.accept || !result.value) {\n+          return;\n+        }\n+\n+        let newName = result.value;\n+\n+        await model.saveAs(workspaceId, newName);\n+\n+        if (workspaceId === resolver.name) {\n+          // If the current workspace was cloned, open the cloned copy\n+          return app.commands.execute(CommandIDs.open, { workspace: newName });\n+        }\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.rename, {\n+      label: trans.__('Rename Workspaceâ€¦'),\n+      execute: async args => {\n+        const node = app.contextMenuHitTest(test);\n+        const workspaceId =\n+          (args.workspace as string | undefined) ??\n+          node?.dataset['context'] ??\n+          resolver.name;\n+\n+        const oldName = workspaceId;\n+        const result = await getNameForWorkspace({\n+          title: trans.__('Rename Workspace'),\n+          text: oldName,\n+          okLabel: trans.__('Rename')\n+        });\n+\n+        if (!result.button.accept || !result.value) {\n+          return;\n+        }\n+\n+        let newName = result.value;\n+\n+        await model.rename(workspaceId, newName);\n+\n+        if (workspaceId === resolver.name) {\n+          // If the current workspace was renamed, reopen it to ensure consistent state\n+          return app.commands.execute(CommandIDs.open, { workspace: newName });\n+        }\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.reset, {\n+      label: trans.__('Reset Workspaceâ€¦'),\n+      execute: async args => {\n+        const node = app.contextMenuHitTest(test);\n+        const workspaceId =\n+          (args.workspace as string | undefined) ??\n+          node?.dataset['context'] ??\n+          resolver.name;\n+\n+        const workspace =\n+          await app.serviceManager.workspaces.fetch(workspaceId);\n+        const tabs = (workspace.data['layout-restorer:data'] as any)?.main?.dock\n+          ?.widgets?.length;\n+\n+        const result = await showDialog({\n+          title: trans.__('Reset Workspace'),\n+          body: trans._n(\n+            'Resetting workspace %2 will close its %1 tab and return to default layout.',\n+            'Resetting workspace %2 will close its %1 tabs and return to default layout.',\n+            tabs,\n+            workspaceId\n+          ),\n+          buttons: [\n+            Dialog.cancelButton(),\n+            Dialog.warnButton({ label: trans.__('Reset') })\n+          ],\n+          defaultButton: 0\n+        });\n+\n+        if (!result.button.accept) {\n+          return;\n+        }\n+\n+        await model.reset(workspaceId);\n+\n+        if (workspaceId === resolver.name) {\n+          // If the current workspace was reset, refresh it to take effect\n+          return app.commands.execute(CommandIDs.open, {\n+            workspace: workspaceId\n+          });\n+        } else {\n+          await model.refresh();\n+        }\n+      }\n+    });\n+\n+    /**\n+     * Commands persisting (or reading from) Jupyter file system\n+     */\n+\n+    app.commands.addCommand(CommandIDs.importWorkspace, {\n+      label: trans.__('Import Workspaceâ€¦'),\n+      execute: async () => {\n+        const { contents } = app.serviceManager;\n+        const result = await FileDialog.getOpenFiles({\n+          manager: fileBrowser.model.manager,\n+          title: trans.__('Select Workspace Files to Import'),\n+          filter: (model: Contents.IModel) =>\n+            model.type === 'directory' || model.path.endsWith(WORKSPACE_EXT)\n+              ? {}\n+              : null,\n+          label: trans.__(\n+            'You choose one or more workspace files to import. A Jupyter Workspace File has %1 extension.',\n+            WORKSPACE_EXT\n+          ),\n+          translator\n+        });\n+        if (result.button.accept && result.value && result.value.length >= 1) {\n+          for (const fileModel of result.value) {\n+            // Get the file contents too\n+            const fullFile = await contents.get(fileModel.path, {\n+              content: true\n+            });\n+            const workspace = JSON.parse(\n+              fullFile.content\n+            ) as unknown as Workspace.IWorkspace;\n+            await app.serviceManager.workspaces.save(\n+              workspace.metadata.id,\n+              workspace\n+            );\n+          }\n+          await model.refresh();\n+        }\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.exportWorkspace, {\n+      label: trans.__('Export Workspaceâ€¦'),\n+      execute: async args => {\n+        const { contents } = app.serviceManager;\n+\n+        const node = app.contextMenuHitTest(test);\n+        let workspaceId =\n+          (args.workspace as string | undefined) ??\n+          node?.dataset['context'] ??\n+          resolver.name;\n+\n+        if (!workspaceId) {\n+          // When invoked from main menu or command palette we need to ask which workspace to export\n+          const result = await InputDialog.getItem({\n+            title: trans.__('Choose Workspace To Export'),\n+            label: trans.__('Choose an existing workspace to export.'),\n+            items: model.identifiers,\n+            okLabel: trans.__('Choose')\n+          });\n+          if (!result.value || !result.button.accept) {\n+            return;\n+          }\n+          workspaceId = result.value;\n+        }\n+\n+        const data = app.serviceManager.workspaces.fetch(workspaceId);\n+\n+        const result = await FileDialog.getExistingDirectory({\n+          title: trans.__('Choose Workspace Export Directory'),\n+          defaultPath: fileBrowser.model.path,\n+          manager: fileBrowser.model.manager,\n+          label: trans.__(\n+            'The \"%1\" workspace will be saved in the chosen directory as \"%1%2\".',\n+            workspaceId,\n+            WORKSPACE_EXT\n+          ),\n+          translator\n+        });\n+        if (\n+          !result.button.accept ||\n+          !result.value ||\n+          result.value.length === 0\n+        ) {\n+          return;\n+        }\n+        if (result.value.length > 1) {\n+          console.warn(\n+            'More than one directory was selected; the workspace will be exported to the first directory only'\n+          );\n+        }\n+        const exportPath =\n+          result.value[0].path + '/' + workspaceId + WORKSPACE_EXT;\n+\n+        if (exportPath) {\n+          await Private.save(exportPath, contents, data, state, false);\n+        }\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.saveAs, {\n+      label: trans.__('Save Current Workspace Asâ€¦'),\n+      execute: async () => {\n+        const { contents } = app.serviceManager;\n+        const data = app.serviceManager.workspaces.fetch(resolver.name);\n+        await Private.saveAs(fileBrowser, contents, data, state, translator);\n+      }\n+    });\n+\n+    app.commands.addCommand(CommandIDs.save, {\n+      label: trans.__('Save Current Workspaceâ€¦'),\n+      execute: async () => {\n+        const { contents } = app.serviceManager;\n+        const data = app.serviceManager.workspaces.fetch(resolver.name);\n+        const lastSave = (await state.fetch(LAST_SAVE_ID)) as string;\n+        if (lastSave === undefined) {\n+          await Private.saveAs(fileBrowser, contents, data, state, translator);\n+        } else {\n+          await Private.save(lastSave, contents, data, state);\n+        }\n+      }\n+    });\n+\n+    if (palette) {\n+      const category = trans.__('Workspaces');\n+      const commands = [\n+        CommandIDs.open,\n+        CommandIDs.save,\n+        CommandIDs.saveAs,\n+        CommandIDs.createNew,\n+        CommandIDs.rename,\n+        CommandIDs.clone,\n+        CommandIDs.exportWorkspace,\n+        CommandIDs.importWorkspace,\n+        CommandIDs.reset,\n+        CommandIDs.deleteWorkspace\n+      ];\n+      for (const command of commands) {\n+        palette.addItem({\n+          command,\n+          category\n+        });\n+      }\n+    }\n+\n+    return {\n+      open: CommandIDs.open,\n+      deleteWorkspace: CommandIDs.deleteWorkspace\n+    };\n+  }\n+};\n+\n+namespace Private {\n+  export function createNameFromPath(path: string): string {\n+    let name = path.split('/').pop();\n+    if (name === undefined) {\n+      return 'unnamed-workspace';\n+    }\n+    // Remove the workspace suffix if present\n+    if (name.endsWith(WORKSPACE_EXT)) {\n+      name = name.slice(0, -WORKSPACE_EXT.length);\n+    }\n+    return name;\n+  }\n+\n+  /**\n+   * Save workspace to a user provided location\n+   */\n+  export async function save(\n+    userPath: string,\n+    contents: Contents.IManager,\n+    data: Promise<Workspace.IWorkspace>,\n+    state: IStateDB,\n+    rememberAsLastSave = true\n+  ): Promise<void> {\n+    const name = createNameFromPath(userPath);\n+\n+    // Add extension if not provided\n+    if (!userPath.endsWith(WORKSPACE_EXT)) {\n+      userPath = userPath + WORKSPACE_EXT;\n+    }\n+\n+    if (rememberAsLastSave) {\n+      // Save last save location, for save button to work\n+      await state.save(LAST_SAVE_ID, userPath);\n+    }\n+\n+    const resolvedData = await data;\n+    resolvedData.metadata.id = `${name}`;\n+    await contents.save(userPath, {\n+      type: 'file',\n+      format: 'text',\n+      content: JSON.stringify(resolvedData)\n+    });\n+  }\n+\n+  /**\n+   * Ask user for location, and save workspace.\n+   * Default location is the current directory in the file browser\n+   */\n+  export async function saveAs(\n+    browser: IDefaultFileBrowser,\n+    contents: Contents.IManager,\n+    data: Promise<Workspace.IWorkspace>,\n+    state: IStateDB,\n+    translator?: ITranslator\n+  ): Promise<void> {\n+    translator = translator || nullTranslator;\n+    const lastSave = await state.fetch(LAST_SAVE_ID);\n+\n+    let defaultName;\n+    if (lastSave === undefined) {\n+      defaultName = 'new-workspace';\n+    } else {\n+      defaultName = (lastSave as string).split('/').pop()?.split('.')[0];\n+    }\n+\n+    const defaultPath = browser.model.path + '/' + defaultName + WORKSPACE_EXT;\n+    const userPath = await getSavePath(defaultPath, translator);\n+\n+    if (userPath) {\n+      await save(userPath, contents, data, state);\n+    }\n+  }\n+\n+  /**\n+   * Ask user for a path to save to.\n+   * @param defaultPath Path already present when the dialog is shown\n+   */\n+  async function getSavePath(\n+    defaultPath: string,\n+    translator?: ITranslator\n+  ): Promise<string | null> {\n+    translator = translator || nullTranslator;\n+    const trans = translator.load('jupyterlab');\n+    const result = await InputDialog.getText({\n+      title: trans.__('Save Current Workspace Asâ€¦'),\n+      text: defaultPath,\n+      placeholder: trans.__('Path to save the workspace in'),\n+      okLabel: trans.__('Save'),\n+      // select the path without extension\n+      selectionRange: defaultPath.length - WORKSPACE_EXT.length\n+    });\n+    if (result.button.accept) {\n+      return result.value;\n+    } else {\n+      return null;\n+    }\n+  }\n+}\n\ndiff --git a/packages/workspaces-extension/src/index.ts b/packages/workspaces-extension/src/index.ts\nnew file mode 100644\nindex 000000000000..f03557b29ad9\n--- /dev/null\n+++ b/packages/workspaces-extension/src/index.ts\n@@ -0,0 +1,58 @@\n+/* -----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+/**\n+ * @packageDocumentation\n+ * @module workspaces-extension\n+ */\n+import {\n+  JupyterFrontEnd,\n+  JupyterFrontEndPlugin\n+} from '@jupyterlab/application';\n+import {\n+  IWorkspaceCommands,\n+  IWorkspacesModel,\n+  WorkspacesModel\n+} from '@jupyterlab/workspaces';\n+import { commandsPlugin } from './commands';\n+import { workspacesSidebar } from './sidebar';\n+\n+/**\n+ * The extension populating sidebar with workspaces list.\n+ */\n+const workspacesModel: JupyterFrontEndPlugin<IWorkspacesModel> = {\n+  id: '@jupyterlab/workspaces-extension:model',\n+  description: 'Provides a model for available workspaces.',\n+  provides: IWorkspacesModel,\n+  autoStart: true,\n+  activate: (app: JupyterFrontEnd) => {\n+    return new WorkspacesModel({\n+      manager: app.serviceManager.workspaces\n+    });\n+  }\n+};\n+\n+/**\n+ * The extension providing workspace sub-menu in the \"File\" main menu.\n+ */\n+const workspacesMenu: JupyterFrontEndPlugin<void> = {\n+  id: '@jupyterlab/workspaces-extension:menu',\n+  description: 'Populates \"File\" main menu with Workspaces submenu.',\n+  requires: [IWorkspaceCommands],\n+  autoStart: true,\n+  activate: () => {\n+    // no-op - the menu items come from schema matching the name of the plugin\n+  }\n+};\n+\n+/**\n+ * Export the plugins as default.\n+ */\n+const plugins: JupyterFrontEndPlugin<any>[] = [\n+  workspacesModel,\n+  commandsPlugin,\n+  workspacesSidebar,\n+  workspacesMenu\n+];\n+export default plugins;\n\ndiff --git a/packages/workspaces-extension/src/sidebar.ts b/packages/workspaces-extension/src/sidebar.ts\nnew file mode 100644\nindex 000000000000..7d6ce26ae139\n--- /dev/null\n+++ b/packages/workspaces-extension/src/sidebar.ts\n@@ -0,0 +1,106 @@\n+/* -----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+import {\n+  JupyterFrontEnd,\n+  JupyterFrontEndPlugin\n+} from '@jupyterlab/application';\n+import { IWindowResolver } from '@jupyterlab/apputils';\n+import { IWorkspaceCommands, IWorkspacesModel } from '@jupyterlab/workspaces';\n+import { IRunningSessionManagers, IRunningSessions } from '@jupyterlab/running';\n+import { ITranslator, nullTranslator } from '@jupyterlab/translation';\n+import { Workspace } from '@jupyterlab/services';\n+import { WORKSPACE_ITEM_CLASS } from './commands';\n+import { blankIcon, checkIcon, deleteIcon } from '@jupyterlab/ui-components';\n+\n+/**\n+ * The extension populating sidebar with workspaces list.\n+ */\n+export const workspacesSidebar: JupyterFrontEndPlugin<void> = {\n+  id: '@jupyterlab/workspaces-extension:sidebar',\n+  description: 'Populates running sidebar with workspaces.',\n+  requires: [\n+    IWorkspaceCommands,\n+    IWorkspacesModel,\n+    IRunningSessionManagers,\n+    IWindowResolver\n+  ],\n+  optional: [ITranslator],\n+  autoStart: true,\n+  activate: async (\n+    app: JupyterFrontEnd,\n+    commands: IWorkspaceCommands,\n+    model: IWorkspacesModel,\n+    managers: IRunningSessionManagers,\n+    resolver: IWindowResolver,\n+    translator: ITranslator | null\n+  ) => {\n+    const trans = (translator ?? nullTranslator).load('jupyterlab');\n+\n+    class WorkspaceItem implements IRunningSessions.IRunningItem {\n+      constructor(workspace: Workspace.IWorkspace) {\n+        this._workspace = workspace;\n+        this.context = workspace.metadata.id;\n+        this.className = WORKSPACE_ITEM_CLASS;\n+      }\n+      readonly className: string;\n+      readonly context: string;\n+      open() {\n+        return app.commands.execute(commands.open, {\n+          workspace: this._workspace.metadata.id\n+        });\n+      }\n+      async shutdown() {\n+        await app.commands.execute(commands.deleteWorkspace, {\n+          workspace: this._workspace.metadata.id\n+        });\n+        await model.refresh();\n+      }\n+      icon() {\n+        return resolver.name === this._workspace.metadata.id\n+          ? checkIcon\n+          : blankIcon;\n+      }\n+      label() {\n+        return this._workspace.metadata.id;\n+      }\n+      labelTitle() {\n+        return trans.__(\n+          '%1 workspace with %2 tabs, last modified on %3',\n+          this._workspace.metadata.id,\n+          (this._workspace.data['layout-restorer:data'] as any)?.main?.dock\n+            ?.widgets?.length,\n+          this._workspace.metadata['last_modified']\n+        );\n+      }\n+\n+      private _workspace: Workspace.IWorkspace;\n+    }\n+    managers.add({\n+      name: trans.__('Workspaces'),\n+      running: () => {\n+        return model.workspaces.map((workspace: Workspace.IWorkspace) => {\n+          return new WorkspaceItem(workspace);\n+        });\n+      },\n+      shutdownAll: async () => {\n+        await Promise.all(\n+          model.workspaces.map(workspace => model.remove(workspace.metadata.id))\n+        );\n+        await model.refresh();\n+      },\n+      shutdownItemIcon: deleteIcon,\n+      refreshRunning: async () => {\n+        await model.refresh();\n+      },\n+      runningChanged: model.refreshed,\n+      shutdownLabel: (item: IRunningSessions.IRunningItem) =>\n+        trans.__('Delete %1', item.label() as string),\n+      shutdownAllLabel: trans.__('Delete All'),\n+      shutdownAllConfirmationText: trans.__(\n+        'Are you sure you want to delete all workspaces? Deleted workspaces cannot be recovered.'\n+      )\n+    });\n+  }\n+};\n\ndiff --git a/packages/workspaces-extension/style/index.css b/packages/workspaces-extension/style/index.css\nnew file mode 100644\nindex 000000000000..ba29095a4d79\n--- /dev/null\n+++ b/packages/workspaces-extension/style/index.css\n@@ -0,0 +1,11 @@\n+/*-----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+\n+/* This file was auto-generated by ensurePackage() in @jupyterlab/buildutils */\n+@import url('~@jupyterlab/ui-components/style/index.css');\n+@import url('~@jupyterlab/apputils/style/index.css');\n+@import url('~@jupyterlab/application/style/index.css');\n+@import url('~@jupyterlab/filebrowser/style/index.css');\n+@import url('~@jupyterlab/running/style/index.css');\n\ndiff --git a/packages/workspaces-extension/style/index.js b/packages/workspaces-extension/style/index.js\nnew file mode 100644\nindex 000000000000..be7aaa35e896\n--- /dev/null\n+++ b/packages/workspaces-extension/style/index.js\n@@ -0,0 +1,11 @@\n+/*-----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+\n+/* This file was auto-generated by ensurePackage() in @jupyterlab/buildutils */\n+import '@jupyterlab/ui-components/style/index.js';\n+import '@jupyterlab/apputils/style/index.js';\n+import '@jupyterlab/application/style/index.js';\n+import '@jupyterlab/filebrowser/style/index.js';\n+import '@jupyterlab/running/style/index.js';\n\ndiff --git a/packages/workspaces-extension/tsconfig.json b/packages/workspaces-extension/tsconfig.json\nnew file mode 100644\nindex 000000000000..41afbba29bcc\n--- /dev/null\n+++ b/packages/workspaces-extension/tsconfig.json\n@@ -0,0 +1,40 @@\n+{\n+  \"extends\": \"../../tsconfigbase\",\n+  \"compilerOptions\": {\n+    \"outDir\": \"lib\",\n+    \"rootDir\": \"src\"\n+  },\n+  \"include\": [\"src/*\"],\n+  \"references\": [\n+    {\n+      \"path\": \"../application\"\n+    },\n+    {\n+      \"path\": \"../apputils\"\n+    },\n+    {\n+      \"path\": \"../coreutils\"\n+    },\n+    {\n+      \"path\": \"../filebrowser\"\n+    },\n+    {\n+      \"path\": \"../running\"\n+    },\n+    {\n+      \"path\": \"../services\"\n+    },\n+    {\n+      \"path\": \"../statedb\"\n+    },\n+    {\n+      \"path\": \"../translation\"\n+    },\n+    {\n+      \"path\": \"../ui-components\"\n+    },\n+    {\n+      \"path\": \"../workspaces\"\n+    }\n+  ]\n+}\n\ndiff --git a/packages/workspaces/.vscode/launch.json b/packages/workspaces/.vscode/launch.json\nnew file mode 100644\nindex 000000000000..64126e422f32\n--- /dev/null\n+++ b/packages/workspaces/.vscode/launch.json\n@@ -0,0 +1,15 @@\n+{\n+  \"version\": \"0.2.0\",\n+  \"configurations\": [\n+    {\n+      \"type\": \"node\",\n+      \"request\": \"attach\",\n+      \"name\": \"Attach to jest\",\n+      // Usage:\n+      // Open the parent directory in VSCode\n+      // Run \\`jlpm test:debug:watch\\` in a terminal\n+      // Run this debugging task\n+      \"port\": 9229\n+    }\n+  ]\n+}\n\ndiff --git a/packages/workspaces/babel.config.js b/packages/workspaces/babel.config.js\nnew file mode 100644\nindex 000000000000..eb2198a956e7\n--- /dev/null\n+++ b/packages/workspaces/babel.config.js\n@@ -0,0 +1,6 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+module.exports = require('@jupyterlab/testing/lib/babel-config');\n\ndiff --git a/packages/workspaces/jest.config.js b/packages/workspaces/jest.config.js\nnew file mode 100644\nindex 000000000000..cd234acbbdc0\n--- /dev/null\n+++ b/packages/workspaces/jest.config.js\n@@ -0,0 +1,7 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+const func = require('@jupyterlab/testing/lib/jest-config');\n+module.exports = func(__dirname);\n\ndiff --git a/packages/workspaces/package.json b/packages/workspaces/package.json\nnew file mode 100644\nindex 000000000000..1ff455a5a6e3\n--- /dev/null\n+++ b/packages/workspaces/package.json\n@@ -0,0 +1,59 @@\n+{\n+  \"name\": \"@jupyterlab/workspaces\",\n+  \"version\": \"4.2.0-alpha.1\",\n+  \"description\": \"JupyterLab workspaces management\",\n+  \"homepage\": \"https://github.com/jupyterlab/jupyterlab\",\n+  \"bugs\": {\n+    \"url\": \"https://github.com/jupyterlab/jupyterlab/issues\"\n+  },\n+  \"repository\": {\n+    \"type\": \"git\",\n+    \"url\": \"https://github.com/jupyterlab/jupyterlab.git\"\n+  },\n+  \"license\": \"BSD-3-Clause\",\n+  \"author\": \"Project Jupyter\",\n+  \"sideEffects\": [\n+    \"style/**/*\"\n+  ],\n+  \"main\": \"lib/index.js\",\n+  \"types\": \"lib/index.d.ts\",\n+  \"directories\": {\n+    \"lib\": \"lib/\"\n+  },\n+  \"files\": [\n+    \"lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}\",\n+    \"schema/*.json\",\n+    \"style/**/*.{css,eot,gif,html,jpg,json,png,svg,woff2,ttf}\",\n+    \"src/**/*.{ts,tsx}\",\n+    \"style/index.js\"\n+  ],\n+  \"scripts\": {\n+    \"build\": \"tsc -b\",\n+    \"build:test\": \"tsc --build tsconfig.test.json\",\n+    \"clean\": \"rimraf lib tsconfig.tsbuildinfo\",\n+    \"docs\": \"typedoc src\",\n+    \"test\": \"jest\",\n+    \"test:cov\": \"jest --collect-coverage\",\n+    \"test:debug\": \"node --inspect-brk ../../node_modules/.bin/jest --runInBand\",\n+    \"test:debug:watch\": \"node --inspect-brk ../../node_modules/.bin/jest --runInBand --watch\",\n+    \"watch\": \"tsc -b --watch\"\n+  },\n+  \"dependencies\": {\n+    \"@jupyterlab/services\": \"^7.2.0-alpha.1\",\n+    \"@lumino/coreutils\": \"^2.1.2\",\n+    \"@lumino/disposable\": \"^2.1.2\",\n+    \"@lumino/polling\": \"^2.1.2\",\n+    \"@lumino/signaling\": \"^2.1.2\"\n+  },\n+  \"devDependencies\": {\n+    \"@jupyterlab/testing\": \"^4.2.0-alpha.1\",\n+    \"@types/jest\": \"^29.2.0\",\n+    \"jest\": \"^29.2.0\",\n+    \"rimraf\": \"~5.0.5\",\n+    \"typedoc\": \"~0.24.7\",\n+    \"typescript\": \"~5.1.6\"\n+  },\n+  \"publishConfig\": {\n+    \"access\": \"public\"\n+  }\n+}\n\ndiff --git a/packages/workspaces/src/index.ts b/packages/workspaces/src/index.ts\nnew file mode 100644\nindex 000000000000..f1591abaa600\n--- /dev/null\n+++ b/packages/workspaces/src/index.ts\n@@ -0,0 +1,9 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+/**\n+ * @packageDocumentation\n+ * @module workspaces\n+ */\n+\n+export * from './model';\n+export * from './tokens';\n\ndiff --git a/packages/workspaces/src/model.ts b/packages/workspaces/src/model.ts\nnew file mode 100644\nindex 000000000000..51dc804b3afb\n--- /dev/null\n+++ b/packages/workspaces/src/model.ts\n@@ -0,0 +1,179 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+import { Poll } from '@lumino/polling';\n+import { ISignal, Signal } from '@lumino/signaling';\n+import { Workspace } from '@jupyterlab/services';\n+import { IWorkspacesModel } from './tokens';\n+\n+/**\n+ * The default duration of the auto-refresh in ms\n+ */\n+const DEFAULT_REFRESH_INTERVAL = 10000;\n+\n+/**\n+ * An implementation of a workspaces model.\n+ */\n+export class WorkspacesModel implements IWorkspacesModel {\n+  constructor(options: WorkspacesModel.IOptions) {\n+    this._manager = options.manager;\n+    const refreshInterval = options.refreshInterval || DEFAULT_REFRESH_INTERVAL;\n+    this._poll = new Poll({\n+      auto: options.auto ?? true,\n+      name: '@jupyterlab/workspaces:Model',\n+      factory: () => this._fetchList(),\n+      frequency: {\n+        interval: refreshInterval,\n+        backoff: true,\n+        max: 300 * 1000\n+      },\n+      standby: options.refreshStandby || 'when-hidden'\n+    });\n+  }\n+\n+  /**\n+   * The list of available workspaces.\n+   */\n+  get workspaces(): Workspace.IWorkspace[] {\n+    return this._workspaceData.values;\n+  }\n+\n+  /**\n+   * The list of workspace identifiers.\n+   */\n+  get identifiers(): string[] {\n+    return this._workspaceData.ids;\n+  }\n+\n+  /**\n+   * Create an empty workspace.\n+   */\n+  async create(workspaceId: string): Promise<void> {\n+    await this._manager.save(workspaceId, {\n+      metadata: { id: workspaceId },\n+      data: {}\n+    });\n+    await this.refresh();\n+  }\n+\n+  /**\n+   * A signal emitted when the workspaces list is refreshed.\n+   */\n+  get refreshed(): ISignal<WorkspacesModel, void> {\n+    return this._refreshed;\n+  }\n+\n+  /**\n+   * Force a refresh of the workspaces list.\n+   */\n+  async refresh(): Promise<void> {\n+    await this._poll.refresh();\n+    await this._poll.tick;\n+  }\n+\n+  /**\n+   * Rename a workspace.\n+   */\n+  async rename(workspaceId: string, newName: string): Promise<void> {\n+    const workspace = await this._manager.fetch(workspaceId);\n+    workspace.metadata.id = newName;\n+\n+    await this._manager.save(newName, workspace);\n+    await this._manager.remove(workspaceId);\n+    await this.refresh();\n+  }\n+\n+  /**\n+   * Reset a workspace.\n+   */\n+  async reset(workspaceId: string): Promise<void> {\n+    const workspace = await this._manager.fetch(workspaceId);\n+    workspace.data = {};\n+    await this._manager.save(workspaceId, workspace);\n+    await this.refresh();\n+  }\n+\n+  /**\n+   * Remove a workspace.\n+   */\n+  async remove(workspaceId: string): Promise<void> {\n+    await this._manager.remove(workspaceId);\n+    await this.refresh();\n+  }\n+\n+  /**\n+   * Save workspace under a different name.\n+   */\n+  async saveAs(workspaceId: string, newName: string): Promise<void> {\n+    const data = await this._manager.fetch(workspaceId);\n+    data.metadata.id = newName;\n+    await this._manager.save(newName, data);\n+    await this.refresh();\n+  }\n+\n+  /**\n+   * Get whether the model is disposed.\n+   */\n+  get isDisposed(): boolean {\n+    return this._isDisposed;\n+  }\n+\n+  /**\n+   * Dispose of the resources held by the model.\n+   */\n+  dispose(): void {\n+    if (this.isDisposed) {\n+      return;\n+    }\n+    this._isDisposed = true;\n+    this._poll.dispose();\n+    Signal.clearData(this);\n+  }\n+\n+  private async _fetchList() {\n+    this._workspaceData = await this._manager.list();\n+    this._refreshed.emit(void 0);\n+  }\n+\n+  private _refreshed = new Signal<WorkspacesModel, void>(this);\n+  private _isDisposed = false;\n+  private _poll: Poll;\n+  private _manager: Workspace.IManager;\n+  private _workspaceData: { ids: string[]; values: Workspace.IWorkspace[] } = {\n+    ids: [],\n+    values: []\n+  };\n+}\n+\n+/**\n+ * The namespace for the `WorkspacesModel` class statics.\n+ */\n+export namespace WorkspacesModel {\n+  /**\n+   * An options object for initializing a the workspaces model.\n+   */\n+  export interface IOptions {\n+    /**\n+     * The workspaces manager.\n+     */\n+    manager: Workspace.IManager;\n+\n+    /**\n+     * Whether a to automatically loads initial list of workspaces.\n+     * The default is `true`.\n+     */\n+    auto?: boolean;\n+\n+    /**\n+     * The time interval for browser refreshing, in ms.\n+     */\n+    refreshInterval?: number;\n+\n+    /**\n+     * When the model stops polling the API. Defaults to `when-hidden`.\n+     */\n+    refreshStandby?: Poll.Standby | (() => boolean | Poll.Standby);\n+  }\n+}\n\ndiff --git a/packages/workspaces/src/tokens.ts b/packages/workspaces/src/tokens.ts\nnew file mode 100644\nindex 000000000000..c5fc6f328dc7\n--- /dev/null\n+++ b/packages/workspaces/src/tokens.ts\n@@ -0,0 +1,86 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+import { Token } from '@lumino/coreutils';\n+import { IDisposable } from '@lumino/disposable';\n+import { ISignal } from '@lumino/signaling';\n+import type { Workspace } from '@jupyterlab/services';\n+\n+/**\n+ * The token that provides the identifiers of workspace commands for reuse.\n+ */\n+export const IWorkspaceCommands = new Token<IWorkspaceCommands>(\n+  '@jupyterlab/workspaces:IWorkspaceCommands',\n+  'Provides identifiers of workspace commands.'\n+);\n+\n+/**\n+ * The identifiers of loaded commands exposed for reuse.\n+ */\n+export interface IWorkspaceCommands {\n+  /**\n+   * Command for opening a workspace by identifier.\n+   */\n+  open: string;\n+  /**\n+   * Command for deleting a workspace.\n+   */\n+  deleteWorkspace: string;\n+}\n+\n+/**\n+ * The token that provides the identifiers of workspace commands for reuse.\n+ */\n+export const IWorkspacesModel = new Token<IWorkspacesModel>(\n+  '@jupyterlab/workspaces:IWorkspacesModel',\n+  'Provides a model for available workspaces.'\n+);\n+\n+/**\n+ * The model for listing available workspaces.\n+ */\n+export interface IWorkspacesModel extends IDisposable {\n+  /**\n+   * The list of available workspaces.\n+   */\n+  readonly workspaces: Workspace.IWorkspace[];\n+\n+  /**\n+   * The list of workspace identifiers.\n+   */\n+  readonly identifiers: string[];\n+\n+  /**\n+   * Create an empty workspace.\n+   */\n+  create(workspaceId: string): Promise<void>;\n+\n+  /**\n+   * Rename a workspace.\n+   */\n+  rename(workspaceId: string, newName: string): Promise<void>;\n+\n+  /**\n+   * Refresh the listing of workspaces.\n+   */\n+  refresh(): Promise<void>;\n+\n+  /**\n+   * Signal emitted when the listing is refreshed.\n+   */\n+  refreshed: ISignal<IWorkspacesModel, void>;\n+\n+  /**\n+   * Reset a workspace.\n+   */\n+  reset(workspaceId: string): Promise<void>;\n+\n+  /**\n+   * Remove a workspace.\n+   */\n+  remove(workspaceId: string): Promise<void>;\n+\n+  /**\n+   * Save workspace under a different name.\n+   */\n+  saveAs(workspaceId: string, newName: string): Promise<void>;\n+}\n\ndiff --git a/packages/workspaces/tsconfig.json b/packages/workspaces/tsconfig.json\nnew file mode 100644\nindex 000000000000..ef92f80511f5\n--- /dev/null\n+++ b/packages/workspaces/tsconfig.json\n@@ -0,0 +1,13 @@\n+{\n+  \"extends\": \"../../tsconfigbase\",\n+  \"compilerOptions\": {\n+    \"outDir\": \"lib\",\n+    \"rootDir\": \"src\"\n+  },\n+  \"include\": [\"src/*\"],\n+  \"references\": [\n+    {\n+      \"path\": \"../services\"\n+    }\n+  ]\n+}\n\ndiff --git a/tsconfigdoc.json b/tsconfigdoc.json\nindex 23f2e3353b55..5d0e5af65d6e 100644\n--- a/tsconfigdoc.json\n+++ b/tsconfigdoc.json\n@@ -300,6 +300,12 @@\n     },\n     {\n       \"path\": \"./packages/vega5-extension\"\n+    },\n+    {\n+      \"path\": \"./packages/workspaces\"\n+    },\n+    {\n+      \"path\": \"./packages/workspaces-extension\"\n     }\n   ]\n }\n\ndiff --git a/yarn.lock b/yarn.lock\nindex 4be69616b914..5f3f14a8c836 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2168,6 +2168,7 @@ __metadata:\n     \"@jupyterlab/translation-extension\": ~4.2.0-alpha.1\n     \"@jupyterlab/ui-components-extension\": ~4.2.0-alpha.1\n     \"@jupyterlab/vega5-extension\": ~4.2.0-alpha.1\n+    \"@jupyterlab/workspaces-extension\": ~4.2.0-alpha.1\n     chokidar: ^3.4.0\n     css-loader: ^6.7.1\n     duplicate-package-checker-webpack-plugin: ^3.0.0\n@@ -2233,7 +2234,6 @@ __metadata:\n     \"@jupyterlab/apputils\": ^4.3.0-alpha.1\n     \"@jupyterlab/coreutils\": ^6.2.0-alpha.1\n     \"@jupyterlab/docregistry\": ^4.2.0-alpha.1\n-    \"@jupyterlab/filebrowser\": ^4.2.0-alpha.1\n     \"@jupyterlab/mainmenu\": ^4.2.0-alpha.1\n     \"@jupyterlab/rendermime-interfaces\": ^3.10.0-alpha.1\n     \"@jupyterlab/services\": ^7.2.0-alpha.1\n@@ -2242,6 +2242,7 @@ __metadata:\n     \"@jupyterlab/statusbar\": ^4.2.0-alpha.1\n     \"@jupyterlab/translation\": ^4.2.0-alpha.1\n     \"@jupyterlab/ui-components\": ^4.2.0-alpha.1\n+    \"@jupyterlab/workspaces\": ^4.2.0-alpha.1\n     \"@lumino/algorithm\": ^2.0.1\n     \"@lumino/commands\": ^2.2.0\n     \"@lumino/coreutils\": ^2.1.2\n@@ -4145,6 +4146,8 @@ __metadata:\n     \"@jupyterlab/ui-components\": ^4.2.0-alpha.1\n     \"@jupyterlab/ui-components-extension\": ^4.2.0-alpha.1\n     \"@jupyterlab/vega5-extension\": ^4.2.0-alpha.1\n+    \"@jupyterlab/workspaces\": ^4.2.0-alpha.1\n+    \"@jupyterlab/workspaces-extension\": ^4.2.0-alpha.1\n     \"@types/jest\": ^29.2.0\n     fs-extra: ^10.1.0\n     jest: ^29.2.0\n@@ -5061,6 +5064,44 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n+\"@jupyterlab/workspaces-extension@^4.2.0-alpha.1, @jupyterlab/workspaces-extension@workspace:packages/workspaces-extension, @jupyterlab/workspaces-extension@~4.2.0-alpha.1\":\n+  version: 0.0.0-use.local\n+  resolution: \"@jupyterlab/workspaces-extension@workspace:packages/workspaces-extension\"\n+  dependencies:\n+    \"@jupyterlab/application\": ^4.2.0-alpha.1\n+    \"@jupyterlab/apputils\": ^4.3.0-alpha.1\n+    \"@jupyterlab/coreutils\": ^6.2.0-alpha.1\n+    \"@jupyterlab/filebrowser\": ^4.2.0-alpha.1\n+    \"@jupyterlab/running\": ^4.2.0-alpha.1\n+    \"@jupyterlab/services\": ^7.2.0-alpha.1\n+    \"@jupyterlab/statedb\": ^4.2.0-alpha.1\n+    \"@jupyterlab/translation\": ^4.2.0-alpha.1\n+    \"@jupyterlab/ui-components\": ^4.2.0-alpha.1\n+    \"@jupyterlab/workspaces\": ^4.2.0-alpha.1\n+    \"@types/jest\": ^29.2.0\n+    rimraf: ~5.0.5\n+    typescript: ~5.1.6\n+  languageName: unknown\n+  linkType: soft\n+\n+\"@jupyterlab/workspaces@^4.2.0-alpha.1, @jupyterlab/workspaces@workspace:packages/workspaces\":\n+  version: 0.0.0-use.local\n+  resolution: \"@jupyterlab/workspaces@workspace:packages/workspaces\"\n+  dependencies:\n+    \"@jupyterlab/services\": ^7.2.0-alpha.1\n+    \"@jupyterlab/testing\": ^4.2.0-alpha.1\n+    \"@lumino/coreutils\": ^2.1.2\n+    \"@lumino/disposable\": ^2.1.2\n+    \"@lumino/polling\": ^2.1.2\n+    \"@lumino/signaling\": ^2.1.2\n+    \"@types/jest\": ^29.2.0\n+    jest: ^29.2.0\n+    rimraf: ~5.0.5\n+    typedoc: ~0.24.7\n+    typescript: ~5.1.6\n+  languageName: unknown\n+  linkType: soft\n+\n \"@lerna/child-process@npm:7.1.4\":\n   version: 7.1.4\n   resolution: \"@lerna/child-process@npm:7.1.4\"\n",
    "test_patch": "diff --git a/.github/workflows/linuxjs-tests.yml b/.github/workflows/linuxjs-tests.yml\nindex 351309a64d68..1bbdb367fc6d 100644\n--- a/.github/workflows/linuxjs-tests.yml\n+++ b/.github/workflows/linuxjs-tests.yml\n@@ -61,6 +61,7 @@ jobs:\n             js-translation,\n             js-ui-components,\n             js-vega5-extension,\n+            js-workspaces,\n           ]\n       fail-fast: false\n     runs-on: ubuntu-22.04\n\ndiff --git a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\nindex 6bd7152ca90c..75a69b5f878e 100644\n--- a/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n+++ b/galata/test/documentation/commands.test.ts-snapshots/commandsList-documentation-linux.json\n@@ -2403,9 +2403,57 @@\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n+  {\n+    \"id\": \"workspace-ui:clone\",\n+    \"label\": \"Clone Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:create-new\",\n+    \"label\": \"Create New Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:delete\",\n+    \"label\": \"Delete Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:export\",\n+    \"label\": \"Export Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:import\",\n+    \"label\": \"Import Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:open\",\n+    \"label\": \"Open Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:rename\",\n+    \"label\": \"Rename Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n+  {\n+    \"id\": \"workspace-ui:reset\",\n+    \"label\": \"Reset Workspaceâ€¦\",\n+    \"caption\": \"\",\n+    \"shortcuts\": []\n+  },\n   {\n     \"id\": \"workspace-ui:save\",\n-    \"label\": \"Save Current Workspace\",\n+    \"label\": \"Save Current Workspaceâ€¦\",\n     \"caption\": \"\",\n     \"shortcuts\": []\n   },\n\ndiff --git a/galata/test/documentation/data/analysis-space.jupyterlab-workspace b/galata/test/documentation/data/analysis-space.jupyterlab-workspace\nnew file mode 100644\nindex 000000000000..d09cd8e148a4\n--- /dev/null\n+++ b/galata/test/documentation/data/analysis-space.jupyterlab-workspace\n@@ -0,0 +1,59 @@\n+{\n+   \"data\":{\n+      \"layout-restorer:data\":{\n+         \"main\":{\n+            \"dock\":{\n+               \"type\":\"tab-area\",\n+               \"currentIndex\":0,\n+               \"widgets\":[]\n+            }\n+         },\n+         \"down\":{\n+            \"size\":0,\n+            \"widgets\":[]\n+         },\n+         \"left\":{\n+            \"collapsed\":false,\n+            \"visible\":true,\n+            \"current\":\"running-sessions\",\n+            \"widgets\":[\n+               \"filebrowser\",\n+               \"running-sessions\",\n+               \"extensionmanager.main-view\"\n+            ],\n+            \"widgetStates\":{\n+               \"jp-running-sessions\":{\n+                  \"sizes\":[\n+                     0,\n+                     0,\n+                     0,\n+                     0,\n+                     1,\n+                     0\n+                  ],\n+                  \"expansionStates\":[\n+                     false,\n+                     false,\n+                     false,\n+                     false,\n+                     true,\n+                     false\n+                  ]\n+               }\n+            }\n+         },\n+         \"right\":{\n+            \"collapsed\":true,\n+            \"visible\":true\n+         },\n+         \"relativeSizes\":[\n+            0.2,\n+            0.8,\n+            0\n+         ]\n+      }\n+   },\n+   \"metadata\":{\n+      \"id\":\"analysis-space\"\n+   }\n+}\n\ndiff --git a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png\nindex cb88390f6a4e..98d46ef184e8 100644\nBinary files a/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png and b/galata/test/documentation/export_notebook.test.ts-snapshots/exporting-menu-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png\nindex ec160e0ea810..666b66051d3e 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png\nindex 8ce19b7d85cc..a45973616fcb 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-modal-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\nindex aa290473abba..cca66ea8bd66 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n@@ -41,7 +41,7 @@\n   \"@jupyterlab/apputils-extension:toggle-header\": \"Adds a command to display the main area widget content header.\",\n   \"@jupyterlab/apputils-extension:toolbar-registry\": \"Provides toolbar items registry.\",\n   \"@jupyterlab/apputils-extension:utilityCommands\": \"Adds meta commands to run set of other commands.\",\n-  \"@jupyterlab/apputils-extension:workspaces\": \"Add workspace file type and commands.\",\n+  \"@jupyterlab/apputils-extension:workspaces\": \"Add workspace file type.\",\n   \"@jupyterlab/cell-toolbar-extension:plugin\": \"Add the cells toolbar.\",\n   \"@jupyterlab/celltags-extension:plugin\": \"Adds the cell tags editor.\",\n   \"@jupyterlab/codemirror-extension:languages\": \"Provides the CodeMirror languages registry.\",\n@@ -174,5 +174,9 @@\n   \"@jupyterlab/translation:translator\": \"Provides the application translation object.\",\n   \"@jupyterlab/translation-extension:plugin\": \"Adds translation commands and settings.\",\n   \"@jupyterlab/ui-components-extension:labicon-manager\": \"Provides the icon manager.\",\n-  \"@jupyterlab/ui-components-extension:form-renderer-registry\": \"Provides the settings form renderer registry.\"\n+  \"@jupyterlab/ui-components-extension:form-renderer-registry\": \"Provides the settings form renderer registry.\",\n+  \"@jupyterlab/workspaces-extension:model\": \"Provides a model for available workspaces.\",\n+  \"@jupyterlab/workspaces:commands\": \"Add workspace commands.\",\n+  \"@jupyterlab/workspaces-extension:sidebar\": \"Populates running sidebar with workspaces.\",\n+  \"@jupyterlab/workspaces-extension:menu\": \"Populates \\\"File\\\" main menu with Workspaces submenu.\"\n }\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json\nindex 7a8468de5edd..473e710e2e6d 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json\n@@ -76,5 +76,7 @@\n   \"@jupyterlab/tooltip:ITooltipManager\": \"A service for the tooltip manager for the application. Use this to allow your extension to invoke a tooltip.\",\n   \"@jupyterlab/translation:ITranslator\": \"A service to translate strings.\",\n   \"@jupyterlab/ui-components:ILabIconManager\": \"A service to register and request icons.\",\n-  \"@jupyterlab/ui-components:IFormRendererRegistry\": \"A service for settings form renderer registration.\"\n+  \"@jupyterlab/ui-components:IFormRendererRegistry\": \"A service for settings form renderer registration.\",\n+  \"@jupyterlab/workspaces:IWorkspacesModel\": \"Provides a model for available workspaces.\",\n+  \"@jupyterlab/workspaces:IWorkspaceCommands\": \"Provides identifiers of workspace commands.\"\n }\n\ndiff --git a/galata/test/documentation/workspaces.test.ts b/galata/test/documentation/workspaces.test.ts\nnew file mode 100644\nindex 000000000000..a6fe049a35eb\n--- /dev/null\n+++ b/galata/test/documentation/workspaces.test.ts\n@@ -0,0 +1,90 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+import { expect, galata, test } from '@jupyterlab/galata';\n+import * as path from 'path';\n+\n+import { positionMouseOver } from './utils';\n+\n+test.use({\n+  viewport: { height: 720, width: 1280 },\n+  mockState: false\n+});\n+\n+test.describe('Workspaces sidebar', () => {\n+  const workspaceName = 'analysis-space';\n+  const testWorkspace = `${workspaceName}.jupyterlab-workspace`;\n+\n+  test.beforeAll(async ({ request, tmpPath }) => {\n+    const contents = galata.newContentsHelper(request);\n+\n+    await contents.uploadFile(\n+      path.resolve(__dirname, `./data/${testWorkspace}`),\n+      `${tmpPath}/${testWorkspace}`\n+    );\n+  });\n+\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.filebrowser.openDirectory(tmpPath);\n+  });\n+\n+  test.afterAll(async ({ request, tmpPath }) => {\n+    const contents = galata.newContentsHelper(request);\n+    await contents.deleteDirectory(tmpPath);\n+  });\n+\n+  test('Workspaces context menu', async ({ page }) => {\n+    // Load the test workspace\n+    await page.dblclick(\n+      `.jp-DirListing-item span:has-text(\"${testWorkspace}\")`\n+    );\n+    await page\n+      .locator(\n+        `.jp-RunningSessions-item.jp-mod-workspace >> text=${workspaceName}`\n+      )\n+      .waitFor();\n+\n+    // Create additional workspaces for the shot\n+    await page.evaluate(async () => {\n+      for (const workspaceName of ['my-coding-space', 'default']) {\n+        await window.jupyterapp.commands.execute('workspace-ui:create-new', {\n+          workspace: workspaceName\n+        });\n+      }\n+    });\n+\n+    await page.addStyleTag({\n+      content: `.jp-LabShell.jp-mod-devMode {\n+        border-top: none;\n+      }`\n+    });\n+\n+    const workspaceItem = page.locator(\n+      '.jp-RunningSessions-item.jp-mod-workspace >> text=default'\n+    );\n+    // Open menu for the shot\n+    await workspaceItem.click({ button: 'right' });\n+    const renameWorkspace = page.locator(\n+      '.lm-Menu-itemLabel:text(\"Rename Workspace\")'\n+    );\n+    await renameWorkspace.hover();\n+    // Inject mouse\n+    await page.evaluate(\n+      ([mouse]) => {\n+        document.body.insertAdjacentHTML('beforeend', mouse);\n+      },\n+      [\n+        await positionMouseOver(renameWorkspace, {\n+          left: 1,\n+          offsetLeft: 5,\n+          top: 0.25\n+        })\n+      ]\n+    );\n+\n+    await page.launcher.waitFor();\n+\n+    expect(\n+      await page.screenshot({ clip: { y: 0, x: 0, width: 400, height: 420 } })\n+    ).toMatchSnapshot('workspaces_sidebar.png');\n+  });\n+});\n\ndiff --git a/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png\nnew file mode 100644\nindex 000000000000..146b15d15893\nBinary files /dev/null and b/galata/test/documentation/workspaces.test.ts-snapshots/workspaces-sidebar-documentation-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts b/galata/test/jupyterlab/menus.test.ts\nindex cc8e29239fbf..f8648decdcb4 100644\n--- a/galata/test/jupyterlab/menus.test.ts\n+++ b/galata/test/jupyterlab/menus.test.ts\n@@ -7,6 +7,7 @@ import type { ISettingRegistry } from '@jupyterlab/settingregistry';\n const menuPaths = [\n   'File',\n   'File>New',\n+  'File>Workspaces',\n   'Edit',\n   'View',\n   'View>Appearance',\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png\nindex 0c980c86de3a..c309aa6a0bf6 100644\nBinary files a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png and b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..be204852bcb1\nBinary files /dev/null and b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-file-workspaces-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png\nindex 3384d2925c51..49bd4a8e0778 100644\nBinary files a/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-create.test.ts-snapshots/opened-menu-file-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts b/galata/test/jupyterlab/sidebars.test.ts\nindex 5220d82fdcac..2a7d574e9a36 100644\n--- a/galata/test/jupyterlab/sidebars.test.ts\n+++ b/galata/test/jupyterlab/sidebars.test.ts\n@@ -1,7 +1,7 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { expect, galata, Handle, test } from '@jupyterlab/galata';\n+import { expect, galata, test } from '@jupyterlab/galata';\n import { Locator } from '@playwright/test';\n \n const sidebarIds: galata.SidebarTabId[] = [\n@@ -12,6 +12,10 @@ const sidebarIds: galata.SidebarTabId[] = [\n   'extensionmanager.main-view'\n ];\n \n+test.use({\n+  mockState: true\n+});\n+\n /**\n  * Add provided text as label on first tab in given tabbar.\n  * By default we only have icons, but we should test for the\n@@ -71,7 +75,9 @@ test.describe('Sidebars', () => {\n         // filtering results\n         '.jp-DirListing-content mark',\n         // only added after resizing\n-        'jp-DirListing-narrow'\n+        'jp-DirListing-narrow',\n+        // used in \"open file\" dialog containing a file browser\n+        '.jp-Open-Dialog'\n       ]\n     });\n     expect(unusedRules.length).toEqual(0);\n\ndiff --git a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png\nindex b20cd5a40264..96151e8fcaba 100644\nBinary files a/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png and b/galata/test/jupyterlab/sidebars.test.ts-snapshots/opened-sidebar-jp-running-sessions-jupyterlab-linux.png differ\n\ndiff --git a/packages/apputils/test/inputdialog.spec.ts b/packages/apputils/test/inputdialog.spec.ts\nindex 961e9c59b7c1..85701a2d618d 100644\n--- a/packages/apputils/test/inputdialog.spec.ts\n+++ b/packages/apputils/test/inputdialog.spec.ts\n@@ -248,6 +248,71 @@ describe('@jupyterlab/apputils', () => {\n         expect(result.value).toBe('my answer');\n         document.body.removeChild(node);\n       });\n+\n+      it('should prevent accepting when pattern does not match', async () => {\n+        const node = document.createElement('div');\n+        document.body.appendChild(node);\n+\n+        const dialog = InputDialog.getText({\n+          title: 'Give me letters',\n+          pattern: '[a-z]+',\n+          host: node\n+        });\n+\n+        await waitForDialog(node);\n+        const input = node.querySelector(\n+          'input[type=\"text\"]'\n+        ) as HTMLInputElement;\n+\n+        input.value = '123';\n+        input.dispatchEvent(new Event('input'));\n+\n+        const acceptButton = node.querySelector(\n+          'button.jp-mod-accept'\n+        ) as HTMLButtonElement;\n+        const dismissButton = node.querySelector(\n+          'button.jp-mod-reject'\n+        ) as HTMLButtonElement;\n+        expect(acceptButton.disabled).toBe(true);\n+        expect(dismissButton.disabled).toBe(false);\n+\n+        await dismissDialog();\n+        const result = await dialog;\n+        expect(result.button.accept).toBe(false);\n+      });\n+\n+      it('should allow accepting when pattern matches', async () => {\n+        const node = document.createElement('div');\n+        document.body.appendChild(node);\n+\n+        const dialog = InputDialog.getText({\n+          title: 'Give me letters',\n+          pattern: '[a-z]+',\n+          host: node\n+        });\n+\n+        await waitForDialog(node);\n+        const input = node.querySelector(\n+          'input[type=\"text\"]'\n+        ) as HTMLInputElement;\n+\n+        input.value = 'abc';\n+        input.dispatchEvent(new Event('input'));\n+\n+        const acceptButton = node.querySelector(\n+          'button.jp-mod-accept'\n+        ) as HTMLButtonElement;\n+        const dismissButton = node.querySelector(\n+          'button.jp-mod-reject'\n+        ) as HTMLButtonElement;\n+        expect(acceptButton.disabled).toBe(false);\n+        expect(dismissButton.disabled).toBe(false);\n+\n+        await acceptDialog();\n+        const result = await dialog;\n+        expect(result.button.accept).toBe(true);\n+        expect(result.value).toBe('abc');\n+      });\n     });\n \n     describe('getNumber()', () => {\n\ndiff --git a/packages/metapackage/tsconfig.test.json b/packages/metapackage/tsconfig.test.json\nindex a96e5316a0d7..deb5daace1c0 100644\n--- a/packages/metapackage/tsconfig.test.json\n+++ b/packages/metapackage/tsconfig.test.json\n@@ -281,6 +281,12 @@\n     {\n       \"path\": \"../vega5-extension\"\n     },\n+    {\n+      \"path\": \"../workspaces\"\n+    },\n+    {\n+      \"path\": \"../workspaces-extension\"\n+    },\n     {\n       \"path\": \".\"\n     },\n\ndiff --git a/packages/workspaces/test/model.spec.ts b/packages/workspaces/test/model.spec.ts\nnew file mode 100644\nindex 000000000000..a1547f0b71d2\n--- /dev/null\n+++ b/packages/workspaces/test/model.spec.ts\n@@ -0,0 +1,178 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+import { signalToPromise } from '@jupyterlab/coreutils';\n+import { ServerConnection, WorkspaceManager } from '@jupyterlab/services';\n+import { JupyterServer } from '@jupyterlab/testing';\n+import { WorkspacesModel } from '@jupyterlab/workspaces';\n+\n+const server = new JupyterServer();\n+\n+beforeAll(async () => {\n+  await server.start();\n+}, 30000);\n+\n+afterAll(async () => {\n+  await server.shutdown();\n+});\n+\n+const WORKSPACE_DATA = {\n+  'layout-restorer:data': {\n+    main: {\n+      dock: {\n+        type: 'tab-area',\n+        currentIndex: 0,\n+        widgets: ['editor:README.md']\n+      },\n+      current: 'editor:README.md'\n+    },\n+    down: { size: 0, widgets: [] },\n+    left: {\n+      collapsed: false,\n+      visible: true,\n+      current: 'running-sessions',\n+      widgets: ['filebrowser', 'running-sessions', 'extensionmanager.main-view']\n+    },\n+    right: {\n+      collapsed: true,\n+      visible: true,\n+      widgets: [\n+        'jp-property-inspector',\n+        '@jupyterlab/toc:plugin',\n+        'debugger-sidebar'\n+      ]\n+    },\n+    relativeSizes: [0.3, 0.7, 0],\n+    top: { simpleVisibility: true }\n+  },\n+  'editor:README.md': { data: { path: 'README.md', factory: 'Editor' } }\n+};\n+\n+describe('@jupyterlab/workspaces', () => {\n+  describe('WorkspacesModel', () => {\n+    let model: WorkspacesModel;\n+    let manager: WorkspaceManager;\n+\n+    beforeEach(async () => {\n+      manager = new WorkspaceManager({\n+        serverSettings: ServerConnection.makeSettings({ appUrl: 'lab' })\n+      });\n+      model = new WorkspacesModel({ manager });\n+\n+      await manager.save('foo', {\n+        metadata: { id: 'foo' },\n+        data: WORKSPACE_DATA\n+      });\n+      await manager.save('bar', {\n+        metadata: { id: 'bar' },\n+        data: WORKSPACE_DATA\n+      });\n+      await model.refresh();\n+    });\n+\n+    afterEach(async () => {\n+      const workspaces = await manager.list();\n+      await Promise.all(workspaces.ids.map(id => manager.remove(id)));\n+    });\n+\n+    describe('#constructor()', () => {\n+      it('should allow changing refresh options', async () => {\n+        model = new WorkspacesModel({\n+          manager,\n+          refreshInterval: 50,\n+          refreshStandby: () => false\n+        });\n+        await expect(\n+          signalToPromise(model.refreshed)\n+        ).resolves.not.toBeUndefined();\n+      }, 1000);\n+    });\n+\n+    describe('#workspaces', () => {\n+      it('should list saved workspaces', async () => {\n+        expect(model.workspaces).toHaveLength(2);\n+        const ids = model.workspaces.map(w => w.metadata.id);\n+        expect(ids).toContain('foo');\n+        expect(ids).toContain('bar');\n+      });\n+    });\n+\n+    describe('#identifiers', () => {\n+      it('should list identifiers of existing workspaces', async () => {\n+        expect(model.identifiers).toHaveLength(2);\n+        expect(model.identifiers).toContain('foo');\n+        expect(model.identifiers).toContain('bar');\n+      });\n+    });\n+\n+    describe('#create', () => {\n+      it('should create an empty workspace', async () => {\n+        expect(model.workspaces).toHaveLength(2);\n+        await model.create('foobar');\n+        expect(model.workspaces).toHaveLength(3);\n+        expect(model.identifiers).toContain('foobar');\n+      });\n+    });\n+\n+    describe('#refresh()', () => {\n+      it('should update the list of workspaces and identifiers', async () => {\n+        await manager.save('foobar', {\n+          metadata: { id: 'foobar' },\n+          data: WORKSPACE_DATA\n+        });\n+        expect(model.identifiers).toHaveLength(2);\n+        await model.refresh();\n+        expect(model.identifiers).toHaveLength(3);\n+      });\n+\n+      it('should emit `refreshed` signal', async () => {\n+        let emitted = false;\n+        model.refreshed.connect(() => (emitted = true));\n+        await model.refresh();\n+        expect(emitted).toBe(true);\n+      });\n+    });\n+\n+    describe('#rename()', () => {\n+      it('should rename the given workspace', async () => {\n+        await model.rename('foo', 'FOO');\n+        expect(model.identifiers).toContain('FOO');\n+        expect(model.identifiers).not.toContain('foo');\n+      });\n+    });\n+\n+    describe('#remove()', () => {\n+      it('should remove the given workspace', async () => {\n+        expect(model.workspaces).toHaveLength(2);\n+        await model.remove('foo');\n+        expect(model.workspaces).toHaveLength(1);\n+        expect(model.identifiers).not.toContain('foo');\n+      });\n+    });\n+\n+    describe('#reset()', () => {\n+      it('should clear the data of the workspace', async () => {\n+        let foo = model.workspaces.filter(\n+          workspace => workspace.metadata.id == 'foo'\n+        )[0];\n+        expect(foo.data).toHaveProperty('layout-restorer:data');\n+        await model.reset('foo');\n+        foo = model.workspaces.filter(\n+          workspace => workspace.metadata.id == 'foo'\n+        )[0];\n+        expect(foo.data).not.toHaveProperty('layout-restorer:data');\n+      });\n+    });\n+\n+    describe('#saveAs()', () => {\n+      it('should save the workspace under a different name', async () => {\n+        expect(model.workspaces).toHaveLength(2);\n+        await model.saveAs('foo', 'fooBar');\n+        expect(model.workspaces).toHaveLength(3);\n+        expect(model.identifiers).toContain('fooBar');\n+      });\n+    });\n+  });\n+});\n\ndiff --git a/packages/workspaces/tsconfig.test.json b/packages/workspaces/tsconfig.test.json\nnew file mode 100644\nindex 000000000000..8c726a504064\n--- /dev/null\n+++ b/packages/workspaces/tsconfig.test.json\n@@ -0,0 +1,15 @@\n+{\n+  \"extends\": \"../../tsconfigbase.test\",\n+  \"include\": [\"src/*\", \"test/*\"],\n+  \"references\": [\n+    {\n+      \"path\": \"../services\"\n+    },\n+    {\n+      \"path\": \".\"\n+    },\n+    {\n+      \"path\": \"../testing\"\n+    }\n+  ]\n+}\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15935",
    "pr_id": 15935,
    "issue_id": 14340,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Filtering files by name doesn't work for Chinese file names.\nhi,\r\nWhen there are Chinese file names in my file browser list, I am unable to use the file name filtering function. And I noticed that it cannot be filtered if it starts with Chinese characters only, but it can be filtered and searched if it starts with letters, numbers, underscores, and then adds Chinese characters.\r\n\r\nMy context is as follows:\r\n\r\nstep1:\r\ndocker images jupyter/base-notebook\r\nREPOSITORY              TAG       IMAGE ID       CREATED      SIZE\r\njupyter/base-notebook   latest    91d725edce1e   4 days ago   976MB\r\n\r\nstep2:\r\nStart JupyterLab in a clean environment.\r\ndocker run -d -p 10000:8888 --name=jupyter-search-test -e RESTARTABLE=yes -v /etc/localtime:/etc/localtime -v /etc/timezone:/etc/timezone -e RESTARTABLE=yes -e JUPYTER_ENABLE_LAB=yes jupyter/base-notebook\r\n\r\nI recorded the problem. Please take a look at the video, it's about 1 minute and 30 seconds long.\r\n\r\nä¸­æ–‡æ–‡ä»¶åï¼š\r\næµ‹è¯•1.ipynb\r\næµ‹è¯•2ç¬¬äºŒä¸ª.ipynb\r\n2æµ‹è¯•.ipynb\r\n\r\nWhen I typed \"æµ‹è¯•\", \"2æµ‹è¯•.ipynb\" can be filtered out, but \"æµ‹è¯•1.ipynb\" and \"æµ‹è¯•2ç¬¬äºŒä¸ª.ipynb\" cannot be filtered out.\r\n\r\nthkuï¼\r\n\r\nhttps://user-images.githubusercontent.com/1202440/230634460-4f5037be-02ad-4fb0-9d32-a7b5396231b5.mp4\r\n\r\n",
    "issue_word_count": 193,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/ui-components/src/components/search.tsx",
      "packages/ui-components/test/search.spec.tsx"
    ],
    "pr_changed_test_files": [
      "packages/ui-components/test/search.spec.tsx"
    ],
    "base_commit": "f4c011e4844c4cfe1c8ded5f517aa736c0d7d190",
    "head_commit": "d6dc2763ebf599e0432ac67551807ac71c4cb722",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15935",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15935",
    "dockerfile": "",
    "pr_merged_at": "2024-03-07T22:36:11.000Z",
    "patch": "diff --git a/packages/ui-components/src/components/search.tsx b/packages/ui-components/src/components/search.tsx\nindex f41c3bfb2922..1262e2761917 100644\n--- a/packages/ui-components/src/components/search.tsx\n+++ b/packages/ui-components/src/components/search.tsx\n@@ -77,9 +77,8 @@ export function fuzzySearch(source: string, query: string): IScore | null {\n   let score = Infinity;\n   let indices: number[] | null = null;\n \n-  // The regex for search word boundaries\n-  const rgx = /\\b\\w/g;\n-\n+  // Look for letters (including in Asian scripts), numbers, and diacritical marks.\n+  const rgx = /[\\p{L}\\p{N}\\p{M}]+/gu;\n   let continueSearch = true;\n \n   // Search the source by word boundary.\n",
    "test_patch": "diff --git a/packages/ui-components/test/search.spec.tsx b/packages/ui-components/test/search.spec.tsx\nnew file mode 100644\nindex 000000000000..572465bacf1a\n--- /dev/null\n+++ b/packages/ui-components/test/search.spec.tsx\n@@ -0,0 +1,46 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { fuzzySearch } from '@jupyterlab/ui-components';\n+\n+describe('@jupyterlab/ui-components', () => {\n+  describe('fuzzySearch()', () => {\n+    // The search logic is in StringExt.matchSumOfDeltas, which is already\n+    // tested in the lumino package.\n+    it('should find an ASCII match in text', () => {\n+      const result = fuzzySearch('food', 'foo');\n+      expect(result).not.toBeNull();\n+    });\n+\n+    it('should find an ASCII match in text with a space', () => {\n+      const result = fuzzySearch('fast food', 'foo');\n+      expect(result).not.toBeNull();\n+    });\n+\n+    it('should fail to find an ASCII match in text', () => {\n+      const result = fuzzySearch('fast food', 'bar');\n+      expect(result).toBeNull();\n+    });\n+\n+    it('should find a French match in text', () => {\n+      const result = fuzzySearch('LibertÃ©, Ã©galitÃ©, fraternitÃ©', 'ertÃ©');\n+      expect(result).not.toBeNull();\n+    });\n+\n+    it('should fail to find a French match in text', () => {\n+      const result = fuzzySearch('LibertÃ©, Ã©galitÃ©, fraternitÃ©', 'Ã¨gal');\n+      expect(result).toBeNull();\n+    });\n+\n+    // CJK = Chinese, Japanese, and Korean characters\n+    it('should find a CJK match in ASCII+CJK text', () => {\n+      const result = fuzzySearch('2æµ‹è¯•', 'æµ‹');\n+      expect(result).not.toBeNull();\n+    });\n+\n+    it('should find a ASCII match in ASCII+CJK text', () => {\n+      const result = fuzzySearch('æµ‹è¯•1.ipynb', '1');\n+      expect(result).not.toBeNull();\n+    });\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15924",
    "pr_id": 15924,
    "issue_id": 15786,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Theme color is not applied to jp-button in 4.1.0\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\nAfter upgrading from v4.0.x to v4.1.0 (maybe related to #15021), the button style was changed. The color of the button is hard-coded as `var(--neutral-foreground-rest)`, and it takes precedence over the rule `.jp-Toolbar { var(--jp-ui-font-color1) }`.\r\n\r\nAs a result, for example in solarized dark theme, the button is in bright white instead of gray (like the debugger icon):\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/36528777/f3c448b0-c6ef-4ce8-bfcf-39e77d76bc51)\r\n\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Install JupyterLab v4.1.0\r\n2. Install a JupyterLab theme, for example\r\n    ```shell\r\n\tpip install jupyterlab_theme_solarized_dark\r\n\t```\r\n3. Open a notebook, `Python 3 (ipykernel)` is bright white\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\n<!--Describe what you expected to happen-->\r\n\r\nThe color of `Python 3 (ipykernel)` is gray\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Linux EndeavourOS (Arch-based distro) <!-- e.g. Linux Ubuntu 21.04 -->\r\n- Browser and version: Firefox 122 <!-- e.g. Chrome 92 -->\r\n- JupyterLab version: 4.1.0 <!-- e.g. 3.1.7 -->\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\n$PATH:\r\n\t/home/ac/temp/.venv/bin\r\n\t/home/ac/.asdf/shims\r\n\t/home/ac/.asdf/bin\r\n\t/opt/android-sdk/tools/bin\r\n\t/home/ac/.local/share/pnpm\r\n\t/usr/local/sbin\r\n\t/usr/local/bin\r\n\t/usr/bin\r\n\t/home/ac/.local/bin\r\n\t/opt/android-sdk/platform-tools\r\n\t/opt/android-sdk/tools\r\n\t/usr/lib/jvm/default/bin\r\n\t/usr/bin/site_perl\r\n\t/usr/bin/vendor_perl\r\n\t/usr/bin/core_perl\r\n\r\nsys.path:\r\n\t/home/ac/temp/.venv/bin\r\n\t/usr/lib/python311.zip\r\n\t/usr/lib/python3.11\r\n\t/usr/lib/python3.11/lib-dynload\r\n\t/home/ac/temp/.venv/lib/python3.11/site-packages\r\n\r\nsys.executable:\r\n\t/home/ac/temp/.venv/bin/python\r\n\r\nsys.version:\r\n\t3.11.7 (main, Jan 29 2024, 16:03:57) [GCC 13.2.1 20230801]\r\n\r\nplatform.platform():\r\n\tLinux-6.7.4-arch1-1-x86_64-with-glibc2.39\r\n\r\nwhich -a jupyter:\r\n\t/home/ac/temp/.venv/bin/jupyter\r\n\t/usr/bin/jupyter\r\n\t/home/ac/Projects/GitHub/jupyterlab-wakatime/.venv/bin/jupyter\r\n\r\npip list:\r\n\tPackage                         Version\r\n\t------------------------------- ---------------\r\n\tanyio                           4.2.0\r\n\targon2-cffi                     23.1.0\r\n\targon2-cffi-bindings            21.2.0\r\n\tarrow                           1.3.0\r\n\tasttokens                       2.4.1\r\n\tasync-lru                       2.0.4\r\n\tattrs                           23.2.0\r\n\tBabel                           2.14.0\r\n\tbeautifulsoup4                  4.12.3\r\n\tbleach                          6.1.0\r\n\tcertifi                         2024.2.2\r\n\tcffi                            1.16.0\r\n\tcharset-normalizer              3.3.2\r\n\tcomm                            0.2.1\r\n\tdebugpy                         1.8.1\r\n\tdecorator                       5.1.1\r\n\tdefusedxml                      0.7.1\r\n\texecuting                       2.0.1\r\n\tfastjsonschema                  2.19.1\r\n\tfqdn                            1.5.1\r\n\th11                             0.14.0\r\n\thttpcore                        1.0.2\r\n\thttpx                           0.26.0\r\n\tidna                            3.6\r\n\tipykernel                       6.29.2\r\n\tipython                         8.21.0\r\n\tisoduration                     20.11.0\r\n\tjedi                            0.19.1\r\n\tJinja2                          3.1.3\r\n\tjson5                           0.9.14\r\n\tjsonpointer                     2.4\r\n\tjsonschema                      4.21.1\r\n\tjsonschema-specifications       2023.12.1\r\n\tjupyter_client                  8.6.0\r\n\tjupyter_core                    5.7.1\r\n\tjupyter-events                  0.9.0\r\n\tjupyter-lsp                     2.2.2\r\n\tjupyter_server                  2.12.5\r\n\tjupyter_server_terminals        0.5.2\r\n\tjupyterlab                      4.1.0\r\n\tjupyterlab_pygments             0.3.0\r\n\tjupyterlab_server               2.25.2\r\n\tjupyterlab_theme_solarized_dark 3.0.1\r\n\tMarkupSafe                      2.1.5\r\n\tmatplotlib-inline               0.1.6\r\n\tmistune                         3.0.2\r\n\tnbclient                        0.9.0\r\n\tnbconvert                       7.16.0\r\n\tnbformat                        5.9.2\r\n\tnest-asyncio                    1.6.0\r\n\tnotebook_shim                   0.2.3\r\n\toverrides                       7.7.0\r\n\tpackaging                       23.2\r\n\tpandocfilters                   1.5.1\r\n\tparso                           0.8.3\r\n\tpexpect                         4.9.0\r\n\tpip                             23.2.1\r\n\tplatformdirs                    4.2.0\r\n\tprometheus-client               0.19.0\r\n\tprompt-toolkit                  3.0.43\r\n\tpsutil                          5.9.8\r\n\tptyprocess                      0.7.0\r\n\tpure-eval                       0.2.2\r\n\tpycparser                       2.21\r\n\tPygments                        2.17.2\r\n\tpython-dateutil                 2.8.2\r\n\tpython-json-logger              2.0.7\r\n\tPyYAML                          6.0.1\r\n\tpyzmq                           25.1.2\r\n\treferencing                     0.33.0\r\n\trequests                        2.31.0\r\n\trfc3339-validator               0.1.4\r\n\trfc3986-validator               0.1.1\r\n\trpds-py                         0.17.1\r\n\tSend2Trash                      1.8.2\r\n\tsetuptools                      65.5.0\r\n\tsix                             1.16.0\r\n\tsniffio                         1.3.0\r\n\tsoupsieve                       2.5\r\n\tstack-data                      0.6.3\r\n\tterminado                       0.18.0\r\n\ttheme-darcula                   4.0.0\r\n\ttinycss2                        1.2.1\r\n\ttornado                         6.4\r\n\ttraitlets                       5.14.1\r\n\ttypes-python-dateutil           2.8.19.20240106\r\n\turi-template                    1.3.0\r\n\turllib3                         2.2.0\r\n\twcwidth                         0.2.13\r\n\twebcolors                       1.13\r\n\twebencodings                    0.5.1\r\n\twebsocket-client                1.7.0\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\n[I 2024-02-11 15:31:09.092 ServerApp] jupyter_lsp | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.094 ServerApp] jupyter_server_terminals | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.096 ServerApp] jupyterlab | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.199 ServerApp] notebook_shim | extension was successfully linked.\r\n[I 2024-02-11 15:31:09.232 ServerApp] notebook_shim | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.234 ServerApp] jupyter_lsp | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.234 ServerApp] jupyter_server_terminals | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.235 LabApp] JupyterLab extension loaded from /home/ac/temp/.venv/lib/python3.11/site-packages/jupyterlab\r\n[I 2024-02-11 15:31:09.235 LabApp] JupyterLab application directory is /home/ac/temp/.venv/share/jupyter/lab\r\n[I 2024-02-11 15:31:09.236 LabApp] Extension Manager is 'pypi'.\r\n[I 2024-02-11 15:31:09.242 ServerApp] jupyterlab | extension was successfully loaded.\r\n[I 2024-02-11 15:31:09.243 ServerApp] Serving notebooks from local directory: /home/ac/temp\r\n[I 2024-02-11 15:31:09.243 ServerApp] Jupyter Server 2.12.5 is running at:\r\n[I 2024-02-11 15:31:09.243 ServerApp] http://localhost:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n[I 2024-02-11 15:31:09.243 ServerApp]     http://127.0.0.1:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n[I 2024-02-11 15:31:09.243 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[C 2024-02-11 15:31:09.278 ServerApp]\r\n\r\n    To access the server, open this file in a browser:\r\n        file:///home/ac/.local/share/jupyter/runtime/jpserver-16456-open.html\r\n    Or copy and paste one of these URLs:\r\n        http://localhost:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n        http://127.0.0.1:8888/lab?token=10921098ea6d04ed83967cdb22d8372228a97eaec5ee9e59\r\n[I 2024-02-11 15:31:09.671 ServerApp] Skipped non-installed server(s): bash-language-server, dockerfile-language-server-nodejs, javascript-typescript-langserver, jedi-language-server, julia-language-server, pyright, python-language-server, python-lsp-server, r-languageserver, sql-language-server, texlab, typescript-language-server, unified-language-server, vscode-css-languageserver-bin, vscode-html-languageserver-bin, vscode-json-languageserver-bin, yaml-language-server\r\n0.00s - Debugger warning: It seems that frozen modules are being used, which may\r\n0.00s - make the debugger miss breakpoints. Please pass -Xfrozen_modules=off\r\n0.00s - to python to disable frozen modules.\r\n0.00s - Note: Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION=1 to disable this validation.\r\n[I 2024-02-11 15:31:11.849 LabApp] Build is up to date\r\n[I 2024-02-11 15:31:12.000 ServerApp] Kernel started: b8987f0e-9734-49f0-a10d-073a151e033e\r\n0.00s - Debugger warning: It seems that frozen modules are being used, which may\r\n0.00s - make the debugger miss breakpoints. Please pass -Xfrozen_modules=off\r\n0.00s - to python to disable frozen modules.\r\n0.00s - Note: Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION=1 to disable this validation.\r\n[I 2024-02-11 15:31:12.360 ServerApp] Connecting to kernel b8987f0e-9734-49f0-a10d-073a151e033e.\r\n[I 2024-02-11 15:31:12.376 ServerApp] Connecting to kernel b8987f0e-9734-49f0-a10d-073a151e033e.\r\n[I 2024-02-11 15:31:12.386 ServerApp] Connecting to kernel b8987f0e-9734-49f0-a10d-073a151e033e.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nNot relevant\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 1398,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/toolbars.test.ts",
      "packages/ui-components/style/toolbar.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/toolbars.test.ts"
    ],
    "base_commit": "f4c011e4844c4cfe1c8ded5f517aa736c0d7d190",
    "head_commit": "3d874099f69b04a6fc8e8ee14c6837d80a1f3c16",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15924",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15924",
    "dockerfile": "",
    "pr_merged_at": "2024-03-07T10:56:26.000Z",
    "patch": "diff --git a/packages/ui-components/style/toolbar.css b/packages/ui-components/style/toolbar.css\nindex 27b512f90d66..b9fc7f51402b 100644\n--- a/packages/ui-components/style/toolbar.css\n+++ b/packages/ui-components/style/toolbar.css\n@@ -74,6 +74,10 @@ button.jp-ToolbarButtonComponent .jp-ToolbarButtonComponent-label {\n   font-family: var(--jp-ui-font-family);\n }\n \n+jp-button.jp-Toolbar-kernelName {\n+  color: var(--jp-ui-font-color1);\n+}\n+\n .jp-ToolbarButtonComponent::part(content) {\n   display: flex;\n   align-items: center;\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/toolbars.test.ts b/galata/test/jupyterlab/toolbars.test.ts\nindex 3fe9be02cdd7..03c3e0d55f40 100644\n--- a/galata/test/jupyterlab/toolbars.test.ts\n+++ b/galata/test/jupyterlab/toolbars.test.ts\n@@ -37,3 +37,23 @@ toolbars.forEach(([plugin, parameter]) => {\n     expect(missingCommands).toEqual([]);\n   });\n });\n+\n+test('Render Switch Kernel ToolbarButton', async ({ page }) => {\n+  await page.notebook.createNew();\n+\n+  const label = await page.$(\n+    'jp-button.jp-Toolbar-kernelName .jp-ToolbarButtonComponent-label'\n+  );\n+  const labelColor = await page.evaluate(\n+    el => getComputedStyle(el).color,\n+    label\n+  );\n+\n+  const color = await page.evaluate(() =>\n+    getComputedStyle(document.body)\n+      .getPropertyValue('--jp-ui-font-color1')\n+      .trim()\n+  );\n+\n+  expect(labelColor).toEqual(color);\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15845",
    "pr_id": 15845,
    "issue_id": 15294,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "The use of space in kernel/tab hierarchy should be improved\n### Problem\r\n\r\nI often use the \"Kernels\" panel of the \"Running Terminals and Kernels\" sidebar to re-open notebooks/consoles for kernels which are running in the background after closing the tab. This used to be rather straightforward in JupyterLab 3.x but got quite less convenient in JupyterLab 4.0:\r\n\r\n| JupyterLab <4 | JupyterLab 4.0 |\r\n|---|---|\r\n|![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/8cb91289-078d-4c80-a5c0-79787eb6d63f) | ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/e2feb88f-0982-48a8-82d9-bd4d5c1ec545) |\r\n\r\nIn both cases I closed the tab with `Unititled6.ipynb`; previously I could just click on it again in the \"Kernels\" section but now I need to:\r\n- close the remaining two panels (and then)\r\n- scroll back and forth to find it amid the repetitive \"Python 3 (ipykernel)\" grouping.\r\n\r\n### Proposed Solution\r\n\r\nSteps:\r\n1. It could help if the kernels hierarchy auto-collapsed when a kernel has only one child. However, currently, when the hierarchy gets manually collapsed it is of little use\r\n2. It could be handy to show both the kernel name and the notebook name in such cases\r\n3. The repetitive part \"Python 3 (ipykernel)\" could be moved up to a new hierarchy level, so that each kernel group nests 1 or more kernels, and each kernel nests one or more tabs (main area widgets) attached to that kernel\r\n\r\n\r\n| Step 1 | Step 2 | Step 3* |\r\n|--|--|--|\r\n| ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/72ae253b-394e-48bf-b0af-493a4b64a594) | ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/9b9b1ba5-069f-4402-8ec8-e05a8b3cfe03) | ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/47aa9f88-8076-41d4-8cd4-bda01e6924b8) |\r\n\r\n\\* Step 3 shows a slightly different but more representative situation where there are kernels of two different types, and where there are two notebooks attached to the same kernel.\r\n\r\n<!---  ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/a6eb36be-3904-4017-ad12-29fc3a55e9b1) | -->\r\n\r\n### Additional context\r\n\r\n- https://github.com/jupyterlab/jupyterlab/pull/13851\r\n- https://github.com/jupyterlab/jupyterlab/issues/13779\r\n",
    "issue_word_count": 335,
    "test_files_count": 4,
    "non_test_files_count": 9,
    "pr_changed_files": [
      "galata/test/documentation/general.test.ts",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/overview.test.ts",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png",
      "packages/running-extension/package.json",
      "packages/running-extension/src/index.ts",
      "packages/running-extension/src/kernels.tsx",
      "packages/running-extension/tsconfig.json",
      "packages/running/package.json",
      "packages/running/src/index.tsx",
      "packages/running/style/base.css",
      "packages/running/tsconfig.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/general.test.ts",
      "galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png",
      "galata/test/documentation/overview.test.ts",
      "galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png"
    ],
    "base_commit": "a2fb9dfe670c5021a8a958fc956ef4877767f542",
    "head_commit": "dff9e2fef9869afad40819dc051a3181224cf7fb",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15845",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15845",
    "dockerfile": "",
    "pr_merged_at": "2024-03-20T18:45:49.000Z",
    "patch": "diff --git a/packages/running-extension/package.json b/packages/running-extension/package.json\nindex 12468b683f8a..d584aea6c111 100644\n--- a/packages/running-extension/package.json\n+++ b/packages/running-extension/package.json\n@@ -44,12 +44,14 @@\n     \"@jupyterlab/rendermime-interfaces\": \"^3.10.0-alpha.1\",\n     \"@jupyterlab/running\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/services\": \"^7.2.0-alpha.1\",\n+    \"@jupyterlab/statedb\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.2.0-alpha.1\",\n     \"@lumino/commands\": \"^2.2.0\",\n     \"@lumino/polling\": \"^2.1.2\",\n     \"@lumino/signaling\": \"^2.1.2\",\n-    \"@lumino/widgets\": \"^2.3.1\"\n+    \"@lumino/widgets\": \"^2.3.1\",\n+    \"react\": \"^18.2.0\"\n   },\n   \"devDependencies\": {\n     \"rimraf\": \"~5.0.5\",\n\ndiff --git a/packages/running-extension/src/index.ts b/packages/running-extension/src/index.ts\nindex 83f09303aec4..5732e39243ae 100644\n--- a/packages/running-extension/src/index.ts\n+++ b/packages/running-extension/src/index.ts\n@@ -16,6 +16,7 @@ import {\n   RunningSessionManagers,\n   RunningSessions\n } from '@jupyterlab/running';\n+import { IStateDB } from '@jupyterlab/statedb';\n import { ITranslator } from '@jupyterlab/translation';\n import { runningIcon } from '@jupyterlab/ui-components';\n import { addKernelRunningSessionManager } from './kernels';\n@@ -41,7 +42,7 @@ const plugin: JupyterFrontEndPlugin<IRunningSessionManagers> = {\n   description: 'Provides the running session managers.',\n   provides: IRunningSessionManagers,\n   requires: [ITranslator],\n-  optional: [ILayoutRestorer, ILabShell],\n+  optional: [ILayoutRestorer, ILabShell, IStateDB],\n   autoStart: true\n };\n \n@@ -57,11 +58,16 @@ function activate(\n   app: JupyterFrontEnd,\n   translator: ITranslator,\n   restorer: ILayoutRestorer | null,\n-  labShell: ILabShell | null\n+  labShell: ILabShell | null,\n+  state: IStateDB | null\n ): IRunningSessionManagers {\n   const trans = translator.load('jupyterlab');\n   const runningSessionManagers = new RunningSessionManagers();\n-  const running = new RunningSessions(runningSessionManagers, translator);\n+  const running = new RunningSessions(\n+    runningSessionManagers,\n+    translator,\n+    state\n+  );\n   running.id = 'jp-running-sessions';\n   running.title.caption = trans.__('Running Terminals and Kernels');\n   running.title.icon = runningIcon;\n\ndiff --git a/packages/running-extension/src/kernels.ts b/packages/running-extension/src/kernels.tsx\nsimilarity index 74%\nrename from packages/running-extension/src/kernels.ts\nrename to packages/running-extension/src/kernels.tsx\nindex 02e1cf1e3ddc..5da60faeba93 100644\n--- a/packages/running-extension/src/kernels.ts\n+++ b/packages/running-extension/src/kernels.tsx\n@@ -12,6 +12,7 @@ import {\n   consoleIcon,\n   IDisposableMenuItem,\n   jupyterIcon,\n+  kernelIcon,\n   LabIcon,\n   notebookIcon,\n   RankedMenu\n@@ -20,8 +21,12 @@ import { CommandRegistry } from '@lumino/commands';\n import { Throttler } from '@lumino/polling';\n import { Signal } from '@lumino/signaling';\n import { CommandIDs } from '.';\n+import React, { ReactNode } from 'react';\n \n-const ITEM_CLASS = 'jp-mod-kernel';\n+const KERNEL_ITEM_CLASS = 'jp-mod-kernel';\n+const KERNELSPEC_ITEM_CLASS = 'jp-mod-kernelspec';\n+const WIDGET_ITEM_CLASS = 'jp-mod-kernel-widget';\n+const KERNEL_LABEL_ID = 'jp-RunningSessions-item-label-kernel-id';\n \n /**\n  * Add the running kernel manager (notebooks & consoles) to the running panel.\n@@ -47,18 +52,33 @@ export async function addKernelRunningSessionManager(\n   // Add the kernels pane to the running sidebar.\n   managers.add({\n     name: trans.__('Kernels'),\n-    running: () =>\n-      Array.from(kernels.running()).map(\n-        kernel =>\n+    running: () => {\n+      const kernelsBySpec = new Map<string, Private.RunningKernel[]>();\n+\n+      for (const kernel of kernels.running()) {\n+        const list = kernelsBySpec.get(kernel.name) ?? [];\n+        kernelsBySpec.set(kernel.name, list);\n+        list.push(\n           new RunningKernel({\n             commands,\n             kernel,\n             kernels,\n             sessions,\n-            spec: kernelspecs.specs?.kernelspecs[kernel.name],\n             trans\n           })\n-      ),\n+        );\n+      }\n+\n+      return Array.from(kernelsBySpec.entries()).map(\n+        ([spec, kernels]) =>\n+          new Private.KernelSpecItem({\n+            name: spec,\n+            kernels,\n+            spec: kernelspecs.specs?.kernelspecs[spec],\n+            trans\n+          })\n+      );\n+    },\n     shutdownAll: () => kernels.shutdownAll(),\n     refreshRunning: () =>\n       Promise.all([kernels.refreshRunning(), sessions.refreshRunning()]),\n@@ -71,7 +91,8 @@ export async function addKernelRunningSessionManager(\n   });\n \n   // Add running kernels commands to the registry.\n-  const test = (node: HTMLElement) => node.classList.contains(ITEM_CLASS);\n+  const test = (node: HTMLElement) =>\n+    node.classList.contains(KERNEL_ITEM_CLASS);\n   commands.addCommand(CommandIDs.kernelNewConsole, {\n     icon: consoleIcon,\n     label: trans.__('New Console for Kernel'),\n@@ -166,15 +187,68 @@ export async function addKernelRunningSessionManager(\n }\n \n namespace Private {\n+  export class KernelSpecItem implements IRunningSessions.IRunningItem {\n+    constructor(options: KernelSpecItem.IOptions) {\n+      this._name = options.name;\n+      this.className = KERNELSPEC_ITEM_CLASS;\n+      this._kernels = options.kernels;\n+      this.spec = options.spec || null;\n+      this.trans = options.trans;\n+    }\n+\n+    readonly className: string;\n+\n+    readonly spec: KernelSpec.ISpecModel | null;\n+\n+    readonly trans: IRenderMime.TranslationBundle;\n+\n+    private _name: string;\n+    private _kernels: RunningKernel[];\n+\n+    icon(): LabIcon | string {\n+      const { spec } = this;\n+      if (!spec || !spec.resources) {\n+        return jupyterIcon;\n+      }\n+      return (\n+        spec.resources['logo-svg'] ||\n+        spec.resources['logo-64x64'] ||\n+        spec.resources['logo-32x32']\n+      );\n+    }\n+\n+    label(): string {\n+      const { _name, spec } = this;\n+      return spec?.display_name || _name;\n+    }\n+\n+    get children(): IRunningSessions.IRunningItem[] {\n+      return this._kernels;\n+    }\n+  }\n+\n+  export namespace KernelSpecItem {\n+    export interface IOptions {\n+      kernels: RunningKernel[];\n+      name: string;\n+      spec?: KernelSpec.ISpecModel;\n+      trans: IRenderMime.TranslationBundle;\n+    }\n+  }\n+\n+  type DocumentWidgetWithKernelItem = Omit<\n+    IRunningSessions.IRunningItem,\n+    'label'\n+  > & { label(): string };\n+\n   export class RunningKernel implements IRunningSessions.IRunningItem {\n     constructor(options: RunningKernel.IOptions) {\n-      this.className = ITEM_CLASS;\n+      this.className = KERNEL_ITEM_CLASS;\n       this.commands = options.commands;\n       this.kernel = options.kernel;\n       this.context = this.kernel.id;\n       this.kernels = options.kernels;\n       this.sessions = options.sessions;\n-      this.spec = options.spec || null;\n       this.trans = options.trans;\n     }\n \n@@ -190,19 +264,17 @@ namespace Private {\n \n     readonly sessions: Session.IManager;\n \n-    readonly spec: KernelSpec.ISpecModel | null;\n-\n     readonly trans: IRenderMime.TranslationBundle;\n \n-    get children(): IRunningSessions.IRunningItem[] {\n-      const children: IRunningSessions.IRunningItem[] = [];\n+    get children(): DocumentWidgetWithKernelItem[] {\n+      const children: DocumentWidgetWithKernelItem[] = [];\n       const open = CommandIDs.kernelOpenSession;\n       const { commands } = this;\n       for (const session of this.sessions.running()) {\n         if (this.kernel.id === session.kernel?.id) {\n           const { name, path, type } = session;\n           children.push({\n-            className: ITEM_CLASS,\n+            className: WIDGET_ITEM_CLASS,\n             context: this.kernel.id,\n             open: () => void commands.execute(open, { name, path, type }),\n             icon: () =>\n@@ -224,26 +296,24 @@ namespace Private {\n     }\n \n     icon(): LabIcon | string {\n-      const { spec } = this;\n-      if (!spec || !spec.resources) {\n-        return jupyterIcon;\n-      }\n-      return (\n-        spec.resources['logo-svg'] ||\n-        spec.resources['logo-64x64'] ||\n-        spec.resources['logo-32x32']\n-      );\n+      return kernelIcon;\n     }\n \n-    label(): string {\n-      const { kernel, spec } = this;\n-      return spec?.display_name || kernel.name;\n+    label(): ReactNode {\n+      const { kernel } = this;\n+      const kernelIdPrefix = kernel.id.split('-')[0];\n+      return (\n+        <>\n+          {this._summary}{' '}\n+          <span className={KERNEL_LABEL_ID}>({kernelIdPrefix})</span>\n+        </>\n+      );\n     }\n \n     labelTitle(): string {\n       const { trans } = this;\n       const { id } = this.kernel;\n-      const title = [`${this.label()}: ${id}`];\n+      const title = [`${this._summary}: ${id}`];\n       for (const session of this.sessions.running()) {\n         if (this.kernel.id === session.kernel?.id) {\n           const { path, type } = session;\n@@ -252,6 +322,17 @@ namespace Private {\n       }\n       return title.join('\\n\\n');\n     }\n+\n+    private get _summary(): string {\n+      const children = this.children;\n+      return children.length == 1\n+        ? children[0].label()\n+        : this.trans.__(\n+            '%1 and %2 more',\n+            children[0].label(),\n+            children.length - 1\n+          );\n+    }\n   }\n \n   export namespace RunningKernel {\n\ndiff --git a/packages/running-extension/tsconfig.json b/packages/running-extension/tsconfig.json\nindex 7614656e8975..c17b833c68c2 100644\n--- a/packages/running-extension/tsconfig.json\n+++ b/packages/running-extension/tsconfig.json\n@@ -24,6 +24,9 @@\n     {\n       \"path\": \"../services\"\n     },\n+    {\n+      \"path\": \"../statedb\"\n+    },\n     {\n       \"path\": \"../translation\"\n     },\n\ndiff --git a/packages/running/package.json b/packages/running/package.json\nindex 68f932908532..dc496ac72691 100644\n--- a/packages/running/package.json\n+++ b/packages/running/package.json\n@@ -38,6 +38,7 @@\n   },\n   \"dependencies\": {\n     \"@jupyterlab/apputils\": \"^4.3.0-alpha.1\",\n+    \"@jupyterlab/statedb\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/translation\": \"^4.2.0-alpha.1\",\n     \"@jupyterlab/ui-components\": \"^4.2.0-alpha.1\",\n     \"@lumino/coreutils\": \"^2.1.2\",\n\ndiff --git a/packages/running/src/index.tsx b/packages/running/src/index.tsx\nindex 4f3b07efe619..92567de5987d 100644\n--- a/packages/running/src/index.tsx\n+++ b/packages/running/src/index.tsx\n@@ -11,21 +11,26 @@ import {\n   caretDownIcon,\n   caretRightIcon,\n   closeIcon,\n+  collapseAllIcon,\n+  expandAllIcon,\n   LabIcon,\n   PanelWithToolbar,\n   ReactWidget,\n   refreshIcon,\n   SidePanel,\n+  tableRowsIcon,\n   ToolbarButton,\n   ToolbarButtonComponent,\n+  treeViewIcon,\n   UseSignal\n } from '@jupyterlab/ui-components';\n+import { IStateDB } from '@jupyterlab/statedb';\n import { Token } from '@lumino/coreutils';\n import { DisposableDelegate, IDisposable } from '@lumino/disposable';\n import { Message } from '@lumino/messaging';\n import { ISignal, Signal } from '@lumino/signaling';\n import { Widget } from '@lumino/widgets';\n-import * as React from 'react';\n+import React, { ReactNode } from 'react';\n \n /**\n  * The class name added to a running widget.\n@@ -72,6 +77,36 @@ const SHUTDOWN_BUTTON_CLASS = 'jp-RunningSessions-itemShutdown';\n  */\n const SHUTDOWN_ALL_BUTTON_CLASS = 'jp-RunningSessions-shutdownAll';\n \n+/**\n+ * The class name added to a collapse/expand carets.\n+ */\n+const CARET_CLASS = 'jp-RunningSessions-caret';\n+\n+/**\n+ * The class name added to icons.\n+ */\n+const ITEM_ICON_CLASS = 'jp-RunningSessions-icon';\n+\n+/**\n+ * Modifier added to a section when flattened list view is requested.\n+ */\n+const LIST_VIEW_CLASS = 'jp-mod-running-list-view';\n+\n+/**\n+ * The class name added to button switching between nested and flat view.\n+ */\n+const VIEW_BUTTON_CLASS = 'jp-RunningSessions-viewButton';\n+\n+/**\n+ * The class name added to button switching between nested and flat view.\n+ */\n+const COLLAPSE_EXPAND_BUTTON_CLASS = 'jp-RunningSessions-collapseButton';\n+\n+/**\n+ * Identifier used in the state database.\n+ */\n+const STATE_DB_ID = 'jp-running-sessions';\n+\n /**\n  * The running sessions token.\n  */\n@@ -146,6 +181,7 @@ function Item(props: {\n   shutdownLabel?: string;\n   shutdownItemIcon?: LabIcon;\n   translator?: ITranslator;\n+  collapseToggled: ISignal<Section, boolean>;\n }) {\n   const { runningItem } = props;\n   const classList = [ITEM_CLASS];\n@@ -164,19 +200,30 @@ function Item(props: {\n     runningItem.shutdown?.();\n   };\n \n+  // Materialise getter to avoid triggering it repeatedly\n+  const children = runningItem.children;\n+\n   // Manage collapsed state. Use the shutdown flag in lieu of `stopPropagation`.\n   const [collapsed, collapse] = React.useState(false);\n-  const collapsible = !!runningItem.children?.length;\n+  const collapsible = !!children?.length;\n   const onClick = collapsible\n     ? () => !stopPropagation && collapse(!collapsed)\n     : undefined;\n \n+  // Listen to signal to collapse from outside\n+  props.collapseToggled.connect((_emitter, newCollapseState) =>\n+    collapse(newCollapseState)\n+  );\n+\n   if (runningItem.className) {\n     classList.push(runningItem.className);\n   }\n   if (props.child) {\n     classList.push('jp-mod-running-child');\n   }\n+  if (props.child && !children) {\n+    classList.push('jp-mod-running-leaf');\n+  }\n \n   return (\n     <>\n@@ -188,15 +235,15 @@ function Item(props: {\n         >\n           {collapsible &&\n             (collapsed ? (\n-              <caretRightIcon.react tag=\"span\" stylesheet=\"runningItem\" />\n+              <caretRightIcon.react tag=\"span\" className={CARET_CLASS} />\n             ) : (\n-              <caretDownIcon.react tag=\"span\" stylesheet=\"runningItem\" />\n+              <caretDownIcon.react tag=\"span\" className={CARET_CLASS} />\n             ))}\n           {icon ? (\n             typeof icon === 'string' ? (\n-              <img src={icon} />\n+              <img src={icon} className={ITEM_ICON_CLASS} />\n             ) : (\n-              <icon.react tag=\"span\" stylesheet=\"runningItem\" />\n+              <icon.react tag=\"span\" className={ITEM_ICON_CLASS} />\n             )\n           ) : undefined}\n           <span\n@@ -219,9 +266,10 @@ function Item(props: {\n         {collapsible && !collapsed && (\n           <List\n             child={true}\n-            runningItems={runningItem.children!}\n+            runningItems={children!}\n             shutdownItemIcon={shutdownItemIcon}\n             translator={translator}\n+            collapseToggled={props.collapseToggled}\n           />\n         )}\n       </li>\n@@ -236,6 +284,7 @@ function List(props: {\n   shutdownAllLabel?: string;\n   shutdownItemIcon?: LabIcon;\n   translator?: ITranslator;\n+  collapseToggled: ISignal<Section, boolean>;\n }) {\n   return (\n     <ul className={LIST_CLASS}>\n@@ -247,6 +296,7 @@ function List(props: {\n           shutdownLabel={props.shutdownLabel}\n           shutdownItemIcon={props.shutdownItemIcon}\n           translator={props.translator}\n+          collapseToggled={props.collapseToggled}\n         />\n       ))}\n     </ul>\n@@ -260,6 +310,7 @@ class ListWidget extends ReactWidget {\n       runningItems: IRunningSessions.IRunningItem[];\n       shutdownAllLabel: string;\n       translator?: ITranslator;\n+      collapseToggled: ISignal<Section, boolean>;\n     }\n   ) {\n     super();\n@@ -297,6 +348,7 @@ class ListWidget extends ReactWidget {\n                 shutdownAllLabel={options.shutdownAllLabel}\n                 shutdownItemIcon={options.manager.shutdownItemIcon}\n                 translator={options.translator}\n+                collapseToggled={options.collapseToggled}\n               />\n             </div>\n           );\n@@ -380,7 +432,8 @@ class Section extends PanelWithToolbar {\n \n     let runningItems = options.manager.running();\n     const enabled = runningItems.length > 0;\n-    this._button = new ToolbarButton({\n+\n+    const shutdownAllButton = new ToolbarButton({\n       label: shutdownAllLabel,\n       className: `${SHUTDOWN_ALL_BUTTON_CLASS}${\n         !enabled ? ' jp-mod-disabled' : ''\n@@ -388,15 +441,71 @@ class Section extends PanelWithToolbar {\n       enabled,\n       onClick: onShutdown\n     });\n-    this._manager.runningChanged.connect(this._updateButton, this);\n \n-    this.toolbar.addItem('shutdown-all', this._button);\n+    const switchViewButton = new ToolbarButton({\n+      className: VIEW_BUTTON_CLASS,\n+      enabled,\n+      icon: tableRowsIcon,\n+      pressedIcon: treeViewIcon,\n+      onClick: () => this.toggleListView(),\n+      tooltip: trans.__('Switch to List View'),\n+      pressedTooltip: trans.__('Switch to Tree View')\n+    });\n+    const collapseExpandAllButton = new ToolbarButton({\n+      className: COLLAPSE_EXPAND_BUTTON_CLASS,\n+      enabled,\n+      icon: collapseAllIcon,\n+      pressedIcon: expandAllIcon,\n+      onClick: () => {\n+        const newState = !collapseExpandAllButton.pressed;\n+        this._collapseToggled.emit(newState);\n+        collapseExpandAllButton.pressed = newState;\n+      },\n+      tooltip: trans.__('Collapse All'),\n+      pressedTooltip: trans.__('Expand All')\n+    });\n+\n+    this._buttons = {\n+      'switch-view': switchViewButton,\n+      'collapse-expand': collapseExpandAllButton,\n+      'shutdown-all': shutdownAllButton\n+    };\n+    // Update buttons once defined and before adding to DOM\n+    this._updateButtons();\n+    this._manager.runningChanged.connect(this._updateButtons, this);\n+\n+    for (const name of ['collapse-expand', 'switch-view', 'shutdown-all']) {\n+      this.toolbar.addItem(\n+        name,\n+        this._buttons[name as keyof typeof this._buttons]\n+      );\n+    }\n+    this.toolbar.addClass('jp-RunningSessions-toolbar');\n \n     this.addWidget(\n-      new ListWidget({ runningItems, shutdownAllLabel, ...options })\n+      new ListWidget({\n+        runningItems,\n+        shutdownAllLabel,\n+        collapseToggled: this._collapseToggled,\n+        ...options\n+      })\n     );\n   }\n \n+  /**\n+   * Toggle between list and tree view.\n+   */\n+  toggleListView(forceOn?: boolean): void {\n+    const switchViewButton = this._buttons['switch-view'];\n+    const newState =\n+      typeof forceOn !== 'undefined' ? forceOn : !switchViewButton.pressed;\n+    switchViewButton.pressed = newState;\n+    this._collapseToggled.emit(false);\n+    this.toggleClass(LIST_VIEW_CLASS, newState);\n+    this._updateButtons();\n+    this._viewChanged.emit({ mode: newState ? 'list' : 'tree' });\n+  }\n+\n   /**\n    * Dispose the resources held by the widget\n    */\n@@ -404,24 +513,56 @@ class Section extends PanelWithToolbar {\n     if (this.isDisposed) {\n       return;\n     }\n-    this._manager.runningChanged.disconnect(this._updateButton, this);\n+    this._manager.runningChanged.disconnect(this._updateButtons, this);\n     super.dispose();\n   }\n \n-  private _updateButton(): void {\n-    const button = this._button;\n-    button.enabled = this._manager.running().length > 0;\n-    if (button.enabled) {\n-      button.node\n-        .querySelector('jp-button')\n-        ?.classList.remove('jp-mod-disabled');\n-    } else {\n-      button.node.querySelector('jp-button')?.classList.add('jp-mod-disabled');\n-    }\n+  get viewChanged(): ISignal<Section, Section.IViewState> {\n+    return this._viewChanged;\n+  }\n+\n+  private _updateButtons(): void {\n+    let runningItems = this._manager.running();\n+    const enabled = runningItems.length > 0;\n+\n+    const hasNesting = runningItems.filter(item => item.children).length !== 0;\n+    const inTreeView = hasNesting && !this._buttons['switch-view'].pressed;\n+\n+    this._buttons['switch-view'].node.style.display = hasNesting\n+      ? 'block'\n+      : 'none';\n+    this._buttons['collapse-expand'].node.style.display = inTreeView\n+      ? 'block'\n+      : 'none';\n+\n+    this._buttons['collapse-expand'].enabled = enabled;\n+    this._buttons['switch-view'].enabled = enabled;\n+    this._buttons['shutdown-all'].enabled = enabled;\n   }\n \n-  private _button: ToolbarButton;\n+  private _buttons: {\n+    'collapse-expand': ToolbarButton;\n+    'switch-view': ToolbarButton;\n+    'shutdown-all': ToolbarButton;\n+  };\n   private _manager: IRunningSessions.IManager;\n+  private _collapseToggled = new Signal<Section, boolean>(this);\n+  private _viewChanged = new Signal<Section, Section.IViewState>(this);\n+}\n+\n+/**\n+ * Interfaces for Section implementation.\n+ */\n+namespace Section {\n+  /**\n+   * Information about section view state.\n+   */\n+  export interface IViewState {\n+    /**\n+     * View mode\n+     */\n+    mode: 'tree' | 'list';\n+  }\n }\n \n /**\n@@ -431,9 +572,14 @@ export class RunningSessions extends SidePanel {\n   /**\n    * Construct a new running widget.\n    */\n-  constructor(managers: IRunningSessionManagers, translator?: ITranslator) {\n+  constructor(\n+    managers: IRunningSessionManagers,\n+    translator?: ITranslator,\n+    stateDB?: IStateDB | null\n+  ) {\n     super();\n     this.managers = managers;\n+    this._stateDB = stateDB ?? null;\n     this.translator = translator ?? nullTranslator;\n     const trans = this.translator.load('jupyterlab');\n \n@@ -471,12 +617,71 @@ export class RunningSessions extends SidePanel {\n    * @param managers Managers\n    * @param manager New manager\n    */\n-  protected addSection(_: unknown, manager: IRunningSessions.IManager) {\n-    this.addWidget(new Section({ manager, translator: this.translator }));\n+  protected async addSection(_: unknown, manager: IRunningSessions.IManager) {\n+    const section = new Section({ manager, translator: this.translator });\n+    this.addWidget(section);\n+\n+    const state = await this._getState();\n+    const sectionsInListView = state.listViewSections;\n+    const sectionId = manager.name;\n+\n+    if (sectionsInListView && sectionsInListView.includes(sectionId)) {\n+      section.toggleListView(true);\n+    }\n+    section.viewChanged.connect(\n+      async (_emitter, viewState: Section.IViewState) => {\n+        await this._updateState(sectionId, viewState.mode);\n+      }\n+    );\n+  }\n+\n+  /**\n+   * Update state database with the new state of a given section.\n+   */\n+  private async _updateState(sectionId: string, mode: 'list' | 'tree') {\n+    const state = await this._getState();\n+    let listViewSections = state.listViewSections ?? [];\n+    if (mode === 'list' && !listViewSections.includes(sectionId)) {\n+      listViewSections.push(sectionId);\n+    } else {\n+      listViewSections = listViewSections.filter(e => e !== sectionId);\n+    }\n+    const newState = { listViewSections };\n+    if (this._stateDB) {\n+      await this._stateDB.save(STATE_DB_ID, newState);\n+    }\n+  }\n+\n+  /**\n+   * Get current state from the state database.\n+   */\n+  private async _getState(): Promise<RunningSessions.IStateDBLayout> {\n+    if (!this._stateDB) {\n+      return {};\n+    }\n+    return (\n+      (this._stateDB.fetch(STATE_DB_ID) as RunningSessions.IStateDBLayout) ?? {}\n+    );\n   }\n \n   protected managers: IRunningSessionManagers;\n   protected translator: ITranslator;\n+  private _stateDB: IStateDB | null;\n+}\n+\n+/**\n+ * Interfaces for RunningSessions implementation.\n+ */\n+namespace RunningSessions {\n+  /**\n+   * Layout of the state database.\n+   */\n+  export interface IStateDBLayout {\n+    /**\n+     * Names of sections to be presented in the list view.\n+     */\n+    listViewSections?: string[];\n+  }\n }\n \n /**\n@@ -571,7 +776,7 @@ export namespace IRunningSessions {\n     /**\n      * Called to determine the label for each item.\n      */\n-    label: () => string;\n+    label: () => ReactNode;\n \n     /**\n      * Called to determine the `title` attribute for each item, which is\n\ndiff --git a/packages/running/style/base.css b/packages/running/style/base.css\nindex 91c9d91b0e32..adf296c8b64d 100644\n--- a/packages/running/style/base.css\n+++ b/packages/running/style/base.css\n@@ -47,6 +47,7 @@\n   margin: 0;\n   padding: 0;\n   list-style-type: none;\n+  padding-left: 14px;\n }\n \n .jp-RunningSessions-item {\n@@ -63,17 +64,76 @@\n   cursor: pointer;\n }\n \n-.jp-RunningSessions-item.jp-mod-running-child {\n-  padding-left: 40px;\n+.jp-mod-running-leaf {\n+  /** Account for lack of collapser */\n+  margin-left: 16px;\n }\n \n-.jp-RunningSessions-item.jp-mod-kernel:not(.jp-mod-running-child) {\n+.jp-RunningSessions-sectionContainer > .jp-RunningSessions-sectionList {\n+  padding-left: 0;\n+}\n+\n+.jp-RunningSessions-viewButton[aria-pressed='true'] {\n+  box-shadow: none;\n+}\n+\n+.jp-mod-running-list-view .jp-RunningSessions-sectionList {\n+  padding-left: 0;\n+}\n+\n+.jp-mod-running-list-view .jp-mod-running-leaf {\n+  margin-left: 0;\n+}\n+\n+.jp-mod-running-list-view .jp-RunningSessions-item.jp-mod-kernel,\n+.jp-mod-running-list-view .jp-RunningSessions-item.jp-mod-kernelspec {\n+  display: none;\n+}\n+\n+.jp-RunningSessions-item.jp-mod-kernelspec,\n+.jp-RunningSessions-item.jp-mod-kernel {\n   user-select: none;\n }\n \n-.jp-RunningSessions-item img {\n+.jp-RunningSessions-item-label-kernel-id {\n+  color: var(--jp-ui-font-color3);\n+}\n+\n+.jp-RunningSessions-collapseButton {\n+  margin: 4px 2px;\n+}\n+\n+.jp-RunningSessions-collapseButton[aria-pressed='true'] {\n+  box-shadow: none;\n+}\n+\n+.jp-RunningSessions-icon {\n+  margin: 0 4px;\n+}\n+\n+.jp-RunningSessions-toolbar {\n+  min-width: max-content;\n+}\n+\n+img.jp-RunningSessions-icon,\n+span.jp-RunningSessions-icon > svg {\n+  width: 16px;\n   height: 16px;\n+}\n+\n+img.jp-RunningSessions-icon {\n   margin-top: 4px;\n+  object-fit: contain;\n+}\n+\n+span.jp-RunningSessions-icon {\n+  align-items: center;\n+  display: flex;\n+}\n+\n+span.jp-RunningSessions-icon > svg {\n+  display: block;\n+  margin: 0 auto;\n }\n \n .jp-RunningSessions-itemLabel {\n@@ -98,8 +158,20 @@\n   white-space: nowrap;\n }\n \n+.jp-RunningSessions-caret {\n+  align-items: center;\n+  display: flex;\n+  padding-right: 4px;\n+}\n+\n+.jp-RunningSessions-caret > svg {\n+  height: 16px;\n+  width: 16px;\n+}\n+\n .jp-RunningSessions-item .jp-RunningSessions-itemShutdown {\n   border-radius: 0;\n+  margin: 0;\n }\n \n .jp-RunningSessions-item:not(:hover) .jp-RunningSessions-itemShutdown {\n@@ -131,10 +203,10 @@\n   background-color: var(--jp-layout-color2);\n }\n \n-.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent.jp-mod-disabled {\n+.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent[disabled] {\n   color: var(--jp-ui-font-color2);\n }\n \n-.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent.jp-mod-disabled:hover {\n+.jp-RunningSessions-shutdownAll.jp-ToolbarButtonComponent[disabled]:hover {\n   background: none;\n }\n\ndiff --git a/packages/running/tsconfig.json b/packages/running/tsconfig.json\nindex d8fe0d18d3ff..5adb430dd6c0 100644\n--- a/packages/running/tsconfig.json\n+++ b/packages/running/tsconfig.json\n@@ -9,6 +9,9 @@\n     {\n       \"path\": \"../apputils\"\n     },\n+    {\n+      \"path\": \"../statedb\"\n+    },\n     {\n       \"path\": \"../translation\"\n     },\n\ndiff --git a/yarn.lock b/yarn.lock\nindex da6c791617eb..723072c50191 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -4534,12 +4534,14 @@ __metadata:\n     \"@jupyterlab/rendermime-interfaces\": ^3.10.0-alpha.1\n     \"@jupyterlab/running\": ^4.2.0-alpha.1\n     \"@jupyterlab/services\": ^7.2.0-alpha.1\n+    \"@jupyterlab/statedb\": ^4.2.0-alpha.1\n     \"@jupyterlab/translation\": ^4.2.0-alpha.1\n     \"@jupyterlab/ui-components\": ^4.2.0-alpha.1\n     \"@lumino/commands\": ^2.2.0\n     \"@lumino/polling\": ^2.1.2\n     \"@lumino/signaling\": ^2.1.2\n     \"@lumino/widgets\": ^2.3.1\n+    react: ^18.2.0\n     rimraf: ~5.0.5\n     typedoc: ~0.24.7\n     typescript: ~5.1.6\n@@ -4551,6 +4553,7 @@ __metadata:\n   resolution: \"@jupyterlab/running@workspace:packages/running\"\n   dependencies:\n     \"@jupyterlab/apputils\": ^4.3.0-alpha.1\n+    \"@jupyterlab/statedb\": ^4.2.0-alpha.1\n     \"@jupyterlab/translation\": ^4.2.0-alpha.1\n     \"@jupyterlab/ui-components\": ^4.2.0-alpha.1\n     \"@lumino/coreutils\": ^2.1.2\n",
    "test_patch": "diff --git a/galata/test/documentation/general.test.ts b/galata/test/documentation/general.test.ts\nindex bf1710cabc4c..006c5dd9d11d 100644\n--- a/galata/test/documentation/general.test.ts\n+++ b/galata/test/documentation/general.test.ts\n@@ -569,11 +569,20 @@ test.describe('General', () => {\n \n     await page.click('[title=\"Running Terminals and Kernels\"]');\n \n+    // Wait up to 5s for both kernels to startup\n     await expect(\n-      page.locator(\n-        '.jp-RunningSessions-item.jp-mod-kernel >> text=\"Python 3 (ipykernel)\"'\n-      )\n-    ).toHaveCount(2);\n+      page.locator('.jp-RunningSessions-item.jp-mod-kernel')\n+    ).toHaveCount(2, { timeout: 5000 });\n+\n+    // Freeze kernel IDs\n+    await page.evaluate(() => {\n+      const mockedKernelIds = ['abcd1234', 'wxyz5678'];\n+      document\n+        .querySelectorAll('.jp-RunningSessions-item-label-kernel-id')\n+        .forEach((span, i) => {\n+          span.innerText = `(${mockedKernelIds[i]})`;\n+        });\n+    });\n \n     expect(\n       await page.screenshot({ clip: { y: 27, x: 0, width: 283, height: 400 } })\n\ndiff --git a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png\nindex 46864cf4821b..7d685130cfd4 100644\nBinary files a/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png and b/galata/test/documentation/general.test.ts-snapshots/running-layout-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/overview.test.ts b/galata/test/documentation/overview.test.ts\nindex 2dbb9e0c22dd..c5232306655e 100644\n--- a/galata/test/documentation/overview.test.ts\n+++ b/galata/test/documentation/overview.test.ts\n@@ -33,9 +33,17 @@ test.describe('Overview', () => {\n \n     await page\n       .locator(\n-        '.jp-RunningSessions-item.jp-mod-kernel >> text=\"Python 3 (ipykernel)\"'\n+        '.jp-RunningSessions-item.jp-mod-kernelspec >> text=\"Python 3 (ipykernel)\"'\n       )\n       .waitFor();\n+\n+    // Freeze kernel ID\n+    await page.evaluate(() => {\n+      document.querySelector(\n+        '.jp-RunningSessions-item-label-kernel-id'\n+      ).innerText = '(abcd1234)';\n+    });\n+\n     expect(\n       await page.screenshot({ clip: { y: 27, x: 0, width: 283, height: 400 } })\n     ).toMatchSnapshot('interface_tabs.png');\n\ndiff --git a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png\nindex e19d9937e077..4cf94a5f453f 100644\nBinary files a/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png and b/galata/test/documentation/overview.test.ts-snapshots/interface-tabs-documentation-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15830",
    "pr_id": 15830,
    "issue_id": 229,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "One console sending keyboard events to another one instead of itself\nThis is really bizarre, no idea how to replicate it.  It happened after reporting #228: we went back to that console, and now in its input area, we can't execute code anymore. Typing works, but `Shift-Enter` doesn't do anything.\n\nMore strangely, we then opened a _new_ console, and we noticed that the new console _is_ getting the kbd events of the old one. Here's an illustration: we typed a `print` stmt into `Console-1`, then hit `Shift-Enter`, and then magically it was `Console-6` that executed it (where I had left a pre-typed `print` statement as well, but without cursor focus):\n\n![image](https://cloud.githubusercontent.com/assets/57394/16597223/a684cf10-42ac-11e6-90b9-ce2896b5dcbf.png)\n",
    "issue_word_count": 132,
    "test_files_count": 3,
    "non_test_files_count": 13,
    "pr_changed_files": [
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json",
      "packages/console-extension/src/cellexecutor.ts",
      "packages/console-extension/src/index.ts",
      "packages/console/src/cellexecutor.ts",
      "packages/console/src/index.ts",
      "packages/console/src/panel.ts",
      "packages/console/src/tokens.ts",
      "packages/console/src/widget.ts",
      "packages/notebook-extension/src/cellexecutor.ts",
      "packages/notebook-extension/src/index.ts",
      "packages/notebook/src/actions.tsx",
      "packages/notebook/src/cellexecutor.ts",
      "packages/notebook/src/index.ts",
      "packages/notebook/src/tokens.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png",
      "galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json",
      "galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json"
    ],
    "base_commit": "02a6c0a59e743005249f91afb299e3e2b1cecd78",
    "head_commit": "89fb1fcdb83eb8504cc139363db4b0ff8529d74e",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15830",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15830",
    "dockerfile": "",
    "pr_merged_at": "2024-03-26T16:39:21.000Z",
    "patch": "diff --git a/packages/console-extension/src/cellexecutor.ts b/packages/console-extension/src/cellexecutor.ts\nnew file mode 100644\nindex 000000000000..6c5b705d84a3\n--- /dev/null\n+++ b/packages/console-extension/src/cellexecutor.ts\n@@ -0,0 +1,18 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import type { JupyterFrontEndPlugin } from '@jupyterlab/application';\n+import { IConsoleCellExecutor, runCell } from '@jupyterlab/console';\n+\n+/**\n+ * Console cell executor plugin.\n+ */\n+export const cellExecutor: JupyterFrontEndPlugin<IConsoleCellExecutor> = {\n+  id: '@jupyterlab/console-extension:cell-executor',\n+  description: 'Provides the console cell executor.',\n+  autoStart: true,\n+  provides: IConsoleCellExecutor,\n+  activate: (): IConsoleCellExecutor => {\n+    return Object.freeze({ runCell });\n+  }\n+};\n\ndiff --git a/packages/console-extension/src/index.ts b/packages/console-extension/src/index.ts\nindex e82b13ce0de7..994aa6b02b1e 100644\n--- a/packages/console-extension/src/index.ts\n+++ b/packages/console-extension/src/index.ts\n@@ -29,7 +29,11 @@ import {\n   IPositionModel\n } from '@jupyterlab/codeeditor';\n import { ICompletionProviderManager } from '@jupyterlab/completer';\n-import { ConsolePanel, IConsoleTracker } from '@jupyterlab/console';\n+import {\n+  ConsolePanel,\n+  IConsoleCellExecutor,\n+  IConsoleTracker\n+} from '@jupyterlab/console';\n import { IDefaultFileBrowser } from '@jupyterlab/filebrowser';\n import { ILauncher } from '@jupyterlab/launcher';\n import { IMainMenu } from '@jupyterlab/mainmenu';\n@@ -53,6 +57,7 @@ import {\n import { DisposableSet } from '@lumino/disposable';\n import { DockLayout, Widget } from '@lumino/widgets';\n import foreign from './foreign';\n+import { cellExecutor } from './cellexecutor';\n \n /**\n  * The command IDs used by the console plugin.\n@@ -113,6 +118,7 @@ const tracker: JupyterFrontEndPlugin<IConsoleTracker> = {\n   requires: [\n     ConsolePanel.IContentFactory,\n     IEditorServices,\n+    IConsoleCellExecutor,\n     IRenderMimeRegistry,\n     ISettingRegistry\n   ],\n@@ -241,7 +247,8 @@ const plugins: JupyterFrontEndPlugin<any>[] = [\n   foreign,\n   kernelStatus,\n   lineColStatus,\n-  completerPlugin\n+  completerPlugin,\n+  cellExecutor\n ];\n export default plugins;\n \n@@ -252,6 +259,7 @@ async function activateConsole(\n   app: JupyterFrontEnd,\n   contentFactory: ConsolePanel.IContentFactory,\n   editorServices: IEditorServices,\n+  executor: IConsoleCellExecutor,\n   rendermime: IRenderMimeRegistry,\n   settingRegistry: ISettingRegistry,\n   restorer: ILayoutRestorer | null,\n@@ -380,6 +388,7 @@ async function activateConsole(\n       mimeTypeService: editorServices.mimeTypeService,\n       rendermime,\n       sessionDialogs,\n+      executor,\n       translator,\n       setBusy: (status && (() => status.setBusy())) ?? undefined,\n       ...(options as Partial<ConsolePanel.IOptions>)\n\ndiff --git a/packages/console/src/cellexecutor.ts b/packages/console/src/cellexecutor.ts\nnew file mode 100644\nindex 000000000000..98fe4be2b3de\n--- /dev/null\n+++ b/packages/console/src/cellexecutor.ts\n@@ -0,0 +1,74 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+import { CodeCell } from '@jupyterlab/cells';\n+import type { KernelMessage } from '@jupyterlab/services';\n+import type { IConsoleCellExecutor } from './tokens';\n+\n+/**\n+ * Run a console cell.\n+ *\n+ * @param options Cell execution options\n+ * @returns Execution status\n+ */\n+export async function runCell({\n+  cell,\n+  onCellExecuted,\n+  sessionContext\n+}: IConsoleCellExecutor.IRunCellOptions): Promise<boolean> {\n+  const onSuccess = (value: KernelMessage.IExecuteReplyMsg) => {\n+    if (value && value.content.status === 'ok') {\n+      const content = value.content;\n+      // Use deprecated payloads for backwards compatibility.\n+      if (content.payload && content.payload.length) {\n+        const setNextInput = content.payload.filter(i => {\n+          return (i as any).source === 'set_next_input';\n+        })[0];\n+        if (setNextInput) {\n+          const text = (setNextInput as any).text;\n+          // Ignore the `replace` value and always set the next cell.\n+          cell.model.sharedModel.setSource(text);\n+        }\n+      }\n+\n+      onCellExecuted({\n+        cell,\n+        executionDate: new Date(),\n+        success: true\n+      });\n+      return true;\n+    } else if (value && value.content.status === 'error') {\n+      const errorName = value.content.ename;\n+      const errorValue = value.content.evalue;\n+\n+      onCellExecuted({\n+        cell,\n+        executionDate: new Date(),\n+        success: false,\n+        error: new Error(`KernelReplyNotOK: ${errorName} ${errorValue}`)\n+      });\n+      return false;\n+    }\n+\n+    onCellExecuted({\n+      cell,\n+      executionDate: new Date(),\n+      success: false\n+    });\n+    return false;\n+  };\n+\n+  const onFailure = (reason: any) => {\n+    onCellExecuted({\n+      cell,\n+      executionDate: new Date(),\n+      success: false,\n+      error: new Error(reason)\n+    });\n+    return false;\n+  };\n+\n+  return CodeCell.execute(cell, sessionContext).then(onSuccess, onFailure);\n+}\n\ndiff --git a/packages/console/src/index.ts b/packages/console/src/index.ts\nindex dff7b8757839..12dfbf2aeef8 100644\n--- a/packages/console/src/index.ts\n+++ b/packages/console/src/index.ts\n@@ -5,6 +5,7 @@\n  * @module console\n  */\n \n+export * from './cellexecutor';\n export * from './foreign';\n export * from './history';\n export * from './panel';\n\ndiff --git a/packages/console/src/panel.ts b/packages/console/src/panel.ts\nindex 4c4bd0731330..795d3dea09f5 100644\n--- a/packages/console/src/panel.ts\n+++ b/packages/console/src/panel.ts\n@@ -21,6 +21,7 @@ import { IDisposable } from '@lumino/disposable';\n import { Message } from '@lumino/messaging';\n import { Panel } from '@lumino/widgets';\n import { CodeConsole } from './widget';\n+import type { IConsoleCellExecutor } from './tokens';\n \n /**\n  * The class name added to console panels.\n@@ -38,6 +39,7 @@ export class ConsolePanel extends MainAreaWidget<Panel> {\n     super({ content: new Panel() });\n     this.addClass(PANEL_CLASS);\n     let {\n+      executor,\n       rendermime,\n       mimeTypeService,\n       path,\n@@ -76,6 +78,7 @@ export class ConsolePanel extends MainAreaWidget<Panel> {\n     rendermime = rendermime.clone({ resolver });\n \n     this.console = contentFactory.createConsole({\n+      executor,\n       rendermime,\n       sessionContext: sessionContext,\n       mimeTypeService,\n@@ -188,6 +191,11 @@ export namespace ConsolePanel {\n      */\n     contentFactory: IContentFactory;\n \n+    /**\n+     * Console cell executor\n+     */\n+    executor?: IConsoleCellExecutor;\n+\n     /**\n      * The service manager used by the panel.\n      */\n\ndiff --git a/packages/console/src/tokens.ts b/packages/console/src/tokens.ts\nindex 7bb1771897b7..8a097e3723c1 100644\n--- a/packages/console/src/tokens.ts\n+++ b/packages/console/src/tokens.ts\n@@ -1,7 +1,8 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { IWidgetTracker } from '@jupyterlab/apputils';\n+import { type ISessionContext, IWidgetTracker } from '@jupyterlab/apputils';\n+import type { CodeCell } from '@jupyterlab/cells';\n import { Token } from '@lumino/coreutils';\n import { ConsolePanel } from './panel';\n \n@@ -19,3 +20,52 @@ export const IConsoleTracker = new Token<IConsoleTracker>(\n  * A class that tracks console widgets.\n  */\n export interface IConsoleTracker extends IWidgetTracker<ConsolePanel> {}\n+\n+/**\n+ * Console cell executor namespace\n+ */\n+export namespace IConsoleCellExecutor {\n+  /**\n+   * Execution options for console cell executor.\n+   */\n+  export interface IRunCellOptions {\n+    /**\n+     * Cell to execute\n+     */\n+    cell: CodeCell;\n+    /**\n+     * A callback to notify a cell completed execution.\n+     */\n+    onCellExecuted: (args: {\n+      cell: CodeCell;\n+      executionDate: Date;\n+      success: boolean;\n+      error?: Error | null;\n+    }) => void;\n+\n+    /**\n+     * Document session context\n+     */\n+    sessionContext: ISessionContext;\n+  }\n+}\n+\n+/**\n+ * Console cell executor interface\n+ */\n+export interface IConsoleCellExecutor {\n+  /**\n+   * Execute a cell.\n+   *\n+   * @param options Cell execution options\n+   */\n+  runCell(options: IConsoleCellExecutor.IRunCellOptions): Promise<boolean>;\n+}\n+\n+/**\n+ * The Console cell executor token.\n+ */\n+export const IConsoleCellExecutor = new Token<IConsoleCellExecutor>(\n+  '@jupyterlab/console:IConsoleCellExecutor',\n+  `The console cell executor`\n+);\n\ndiff --git a/packages/console/src/widget.ts b/packages/console/src/widget.ts\nindex 79a8661f71d6..e79adfbdf1a7 100644\n--- a/packages/console/src/widget.ts\n+++ b/packages/console/src/widget.ts\n@@ -28,7 +28,9 @@ import { Drag } from '@lumino/dragdrop';\n import { Message } from '@lumino/messaging';\n import { ISignal, Signal } from '@lumino/signaling';\n import { Panel, PanelLayout, Widget } from '@lumino/widgets';\n+import { runCell } from './cellexecutor';\n import { ConsoleHistory, IConsoleHistory } from './history';\n+import type { IConsoleCellExecutor } from './tokens';\n \n /**\n  * The data attribute added to a widget that has an active kernel.\n@@ -112,6 +114,7 @@ export class CodeConsole extends Widget {\n   constructor(options: CodeConsole.IOptions) {\n     super();\n     this._translator = options.translator ?? nullTranslator;\n+    this._executor = options.executor ?? Object.freeze({ runCell });\n     this.addClass(CONSOLE_CLASS);\n     this.node.dataset[KERNEL_USER] = 'true';\n     this.node.dataset[CODE_RUNNER] = 'true';\n@@ -721,7 +724,7 @@ export class CodeConsole extends Widget {\n   /**\n    * Execute the code in the current prompt cell.\n    */\n-  private _execute(cell: CodeCell): Promise<void> {\n+  private async _execute(cell: CodeCell): Promise<void> {\n     const source = cell.model.sharedModel.getSource();\n     this._history.push(source);\n     // If the source of the console is just \"clear\", clear the console as we\n@@ -731,45 +734,36 @@ export class CodeConsole extends Widget {\n       return Promise.resolve(void 0);\n     }\n     cell.model.contentChanged.connect(this.update, this);\n-    const onSuccess = (value: KernelMessage.IExecuteReplyMsg) => {\n-      if (this.isDisposed) {\n-        return;\n-      }\n-      if (value && value.content.status === 'ok') {\n-        const content = value.content;\n-        // Use deprecated payloads for backwards compatibility.\n-        if (content.payload && content.payload.length) {\n-          const setNextInput = content.payload.filter(i => {\n-            return (i as any).source === 'set_next_input';\n-          })[0];\n-          if (setNextInput) {\n-            const text = (setNextInput as any).text;\n-            // Ignore the `replace` value and always set the next cell.\n-            cell.model.sharedModel.setSource(text);\n-          }\n-        }\n-      } else if (value && value.content.status === 'error') {\n-        for (const cell of this._cells) {\n-          if ((cell.model as ICodeCellModel).executionCount === null) {\n-            cell.setPrompt('');\n+\n+    const options = {\n+      cell,\n+      sessionContext: this.sessionContext,\n+      onCellExecuted: (args: {\n+        cell: CodeCell;\n+        executionDate: Date;\n+        success: boolean;\n+        error?: Error | null;\n+      }) => {\n+        this._executed.emit(args.executionDate);\n+\n+        if (args.error) {\n+          for (const cell of this._cells) {\n+            if ((cell.model as ICodeCellModel).executionCount === null) {\n+              cell.setPrompt('');\n+            }\n           }\n         }\n       }\n-      cell.model.contentChanged.disconnect(this.update, this);\n-      this.update();\n-      this._executed.emit(new Date());\n-    };\n-    const onFailure = () => {\n-      if (this.isDisposed) {\n-        return;\n+    } satisfies IConsoleCellExecutor.IRunCellOptions;\n+\n+    try {\n+      await this._executor.runCell(options);\n+    } finally {\n+      if (!this.isDisposed) {\n+        cell.model.contentChanged.disconnect(this.update, this);\n+        this.update();\n       }\n-      cell.model.contentChanged.disconnect(this.update, this);\n-      this.update();\n-    };\n-    return CodeCell.execute(cell, this.sessionContext).then(\n-      onSuccess,\n-      onFailure\n-    );\n+    }\n   }\n \n   /**\n@@ -916,6 +910,7 @@ export class CodeConsole extends Widget {\n   private _banner: RawCell | null = null;\n   private _cells: IObservableList<Cell>;\n   private _content: Panel;\n+  private _executor: IConsoleCellExecutor;\n   private _executed = new Signal<this, Date>(this);\n   private _history: IConsoleHistory;\n   private _input: Panel;\n@@ -947,6 +942,11 @@ export namespace CodeConsole {\n      */\n     contentFactory: IContentFactory;\n \n+    /**\n+     * Console cell executor\n+     */\n+    executor?: IConsoleCellExecutor;\n+\n     /**\n      * The model factory for the console widget.\n      */\n\ndiff --git a/packages/notebook-extension/src/cellexecutor.ts b/packages/notebook-extension/src/cellexecutor.ts\nnew file mode 100644\nindex 000000000000..ba652f944e59\n--- /dev/null\n+++ b/packages/notebook-extension/src/cellexecutor.ts\n@@ -0,0 +1,18 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import type { JupyterFrontEndPlugin } from '@jupyterlab/application';\n+import { INotebookCellExecutor, runCell } from '@jupyterlab/notebook';\n+\n+/**\n+ * Notebook cell executor plugin.\n+ */\n+export const cellExecutor: JupyterFrontEndPlugin<INotebookCellExecutor> = {\n+  id: '@jupyterlab/notebook-extension:cell-executor',\n+  description: 'Provides the notebook cell executor.',\n+  autoStart: true,\n+  provides: INotebookCellExecutor,\n+  activate: (): INotebookCellExecutor => {\n+    return Object.freeze({ runCell });\n+  }\n+};\n\ndiff --git a/packages/notebook-extension/src/index.ts b/packages/notebook-extension/src/index.ts\nindex 5f9c8b77b694..95f00c2d60fa 100644\n--- a/packages/notebook-extension/src/index.ts\n+++ b/packages/notebook-extension/src/index.ts\n@@ -66,6 +66,7 @@ import * as nbformat from '@jupyterlab/nbformat';\n import {\n   CommandEditStatus,\n   ExecutionIndicator,\n+  INotebookCellExecutor,\n   INotebookTools,\n   INotebookTracker,\n   INotebookWidgetFactory,\n@@ -80,6 +81,7 @@ import {\n   NotebookTracker,\n   NotebookTrustStatus,\n   NotebookWidgetFactory,\n+  setCellExecutor,\n   StaticNotebook,\n   ToolbarItems\n } from '@jupyterlab/notebook';\n@@ -126,6 +128,7 @@ import {\n import { DisposableSet, IDisposable } from '@lumino/disposable';\n import { Message, MessageLoop } from '@lumino/messaging';\n import { Menu, Panel, Widget } from '@lumino/widgets';\n+import { cellExecutor } from './cellexecutor';\n import { logNotebookOutput } from './nboutput';\n import { ActiveCellTool } from './tool-widgets/activeCellToolWidget';\n import {\n@@ -355,7 +358,11 @@ const trackerPlugin: JupyterFrontEndPlugin<INotebookTracker> = {\n   id: '@jupyterlab/notebook-extension:tracker',\n   description: 'Provides the notebook widget tracker.',\n   provides: INotebookTracker,\n-  requires: [INotebookWidgetFactory, IEditorExtensionRegistry],\n+  requires: [\n+    INotebookWidgetFactory,\n+    IEditorExtensionRegistry,\n+    INotebookCellExecutor\n+  ],\n   optional: [\n     ICommandPalette,\n     IDefaultFileBrowser,\n@@ -1091,6 +1098,7 @@ const activeCellTool: JupyterFrontEndPlugin<void> = {\n  * Export the plugins as default.\n  */\n const plugins: JupyterFrontEndPlugin<any>[] = [\n+  cellExecutor,\n   factory,\n   trackerPlugin,\n   executionIndicator,\n@@ -1589,6 +1597,7 @@ function activateNotebookHandler(\n   app: JupyterFrontEnd,\n   factory: NotebookWidgetFactory.IFactory,\n   extensions: IEditorExtensionRegistry,\n+  executor: INotebookCellExecutor,\n   palette: ICommandPalette | null,\n   defaultBrowser: IDefaultFileBrowser | null,\n   launcher: ILauncher | null,\n@@ -1601,6 +1610,8 @@ function activateNotebookHandler(\n   formRegistry: IFormRendererRegistry | null,\n   filebrowserFactory: IFileBrowserFactory | null\n ): INotebookTracker {\n+  setCellExecutor(executor);\n+\n   const translator = translator_ ?? nullTranslator;\n   const sessionDialogs =\n     sessionDialogs_ ?? new SessionContextDialogs({ translator });\n\ndiff --git a/packages/notebook/src/actions.tsx b/packages/notebook/src/actions.tsx\nindex c54643fc88ac..5e170379a2f4 100644\n--- a/packages/notebook/src/actions.tsx\n+++ b/packages/notebook/src/actions.tsx\n@@ -27,8 +27,10 @@ import { every, findIndex } from '@lumino/algorithm';\n import { JSONExt, JSONObject } from '@lumino/coreutils';\n import { ISignal, Signal } from '@lumino/signaling';\n import * as React from 'react';\n+import { runCell as defaultRunCell } from './cellexecutor';\n import { Notebook, StaticNotebook } from './widget';\n import { NotebookWindowedLayout } from './windowing';\n+import { INotebookCellExecutor } from './tokens';\n \n /**\n  * The mimetype used for Jupyter cell data.\n@@ -2227,10 +2229,25 @@ export namespace NotebookActions {\n   }\n }\n \n+/**\n+ * Set the notebook cell executor and the related signals.\n+ */\n+export function setCellExecutor(executor: INotebookCellExecutor): void {\n+  if (Private.executor) {\n+    throw new Error('Cell executor can only be set once.');\n+  }\n+  Private.executor = executor;\n+}\n+\n /**\n  * A namespace for private data.\n  */\n namespace Private {\n+  /**\n+   * Notebook cell executor\n+   */\n+  export let executor: INotebookCellExecutor;\n+\n   /**\n    * A signal that emits whenever a cell completes execution.\n    */\n@@ -2484,172 +2501,26 @@ namespace Private {\n     sessionDialogs?: ISessionContextDialogs,\n     translator?: ITranslator\n   ): Promise<boolean> {\n-    translator = translator || nullTranslator;\n-    const trans = translator.load('jupyterlab');\n-    switch (cell.model.type) {\n-      case 'markdown':\n-        (cell as MarkdownCell).rendered = true;\n-        cell.inputHidden = false;\n-        executed.emit({ notebook, cell, success: true });\n-        break;\n-      case 'code':\n-        if (sessionContext) {\n-          if (sessionContext.isTerminating) {\n-            await showDialog({\n-              title: trans.__('Kernel Terminating'),\n-              body: trans.__(\n-                'The kernel for %1 appears to be terminating. You can not run any cell for now.',\n-                sessionContext.session?.path\n-              ),\n-              buttons: [Dialog.okButton()]\n-            });\n-            break;\n-          }\n-          if (sessionContext.pendingInput) {\n-            await showDialog({\n-              title: trans.__('Cell not executed due to pending input'),\n-              body: trans.__(\n-                'The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again.'\n-              ),\n-              buttons: [Dialog.okButton()]\n-            });\n-            return false;\n-          }\n-          if (sessionContext.hasNoKernel) {\n-            const shouldSelect = await sessionContext.startKernel();\n-            if (shouldSelect && sessionDialogs) {\n-              await sessionDialogs.selectKernel(sessionContext);\n-            }\n-          }\n-\n-          if (sessionContext.hasNoKernel) {\n-            cell.model.sharedModel.transact(() => {\n-              (cell.model as ICodeCellModel).clearExecution();\n-            });\n-            return true;\n-          }\n-\n-          const deletedCells = notebook.model?.deletedCells ?? [];\n-          executionScheduled.emit({ notebook, cell });\n-\n-          let ran = false;\n-          try {\n-            const reply = await CodeCell.execute(\n-              cell as CodeCell,\n-              sessionContext,\n-              {\n-                deletedCells,\n-                recordTiming: notebook.notebookConfig.recordTiming\n-              }\n-            );\n-            deletedCells.splice(0, deletedCells.length);\n-\n-            ran = (() => {\n-              if (cell.isDisposed) {\n-                return false;\n-              }\n-\n-              if (!reply) {\n-                return true;\n-              }\n-              if (reply.content.status === 'ok') {\n-                const content = reply.content;\n-\n-                if (content.payload && content.payload.length) {\n-                  handlePayload(content, notebook, cell);\n-                }\n-\n-                return true;\n-              } else {\n-                throw new KernelError(reply.content);\n-              }\n-            })();\n-          } catch (reason) {\n-            if (cell.isDisposed || reason.message.startsWith('Canceled')) {\n-              ran = false;\n-            } else {\n-              executed.emit({\n-                notebook,\n-                cell,\n-                success: false,\n-                error: reason\n-              });\n-              throw reason;\n-            }\n-          }\n-\n-          if (ran) {\n-            executed.emit({ notebook, cell, success: true });\n-          }\n-\n-          return ran;\n-        }\n-        cell.model.sharedModel.transact(() => {\n-          (cell.model as ICodeCellModel).clearExecution();\n-        }, false);\n-        break;\n-      default:\n-        break;\n-    }\n-\n-    return Promise.resolve(true);\n-  }\n-\n-  /**\n-   * Handle payloads from an execute reply.\n-   *\n-   * #### Notes\n-   * Payloads are deprecated and there are no official interfaces for them in\n-   * the kernel type definitions.\n-   * See [Payloads (DEPRECATED)](https://jupyter-client.readthedocs.io/en/latest/messaging.html#payloads-deprecated).\n-   */\n-  function handlePayload(\n-    content: KernelMessage.IExecuteReply,\n-    notebook: Notebook,\n-    cell: Cell\n-  ) {\n-    const setNextInput = content.payload?.filter(i => {\n-      return (i as any).source === 'set_next_input';\n-    })[0];\n-\n-    if (!setNextInput) {\n-      return;\n-    }\n-\n-    const text = setNextInput.text as string;\n-    const replace = setNextInput.replace;\n-\n-    if (replace) {\n-      cell.model.sharedModel.setSource(text);\n-      return;\n-    }\n-\n-    // Create a new code cell and add as the next cell.\n-    const notebookModel = notebook.model!.sharedModel;\n-    const cells = notebook.model!.cells;\n-    const index = findIndex(cells, model => model === cell.model);\n-\n-    // While this cell has no outputs and could be trusted following the letter\n-    // of Jupyter trust model, its content comes from kernel and hence is not\n-    // necessarily controlled by the user; if we set it as trusted, a user\n-    // executing cells in succession could end up with unwanted trusted output.\n-    if (index === -1) {\n-      notebookModel.insertCell(notebookModel.cells.length, {\n-        cell_type: 'code',\n-        source: text,\n-        metadata: {\n-          trusted: false\n-        }\n-      });\n-    } else {\n-      notebookModel.insertCell(index + 1, {\n-        cell_type: 'code',\n-        source: text,\n-        metadata: {\n-          trusted: false\n-        }\n-      });\n+    if (!executor) {\n+      console.warn(\n+        'Requesting cell execution without any cell executor defined. Falling back to default execution.'\n+      );\n     }\n+    const options = {\n+      cell,\n+      notebook: notebook.model!,\n+      notebookConfig: notebook.notebookConfig,\n+      onCellExecuted: args => {\n+        executed.emit({ notebook, ...args });\n+      },\n+      onCellExecutionScheduled: args => {\n+        executionScheduled.emit({ notebook, ...args });\n+      },\n+      sessionContext,\n+      sessionDialogs,\n+      translator\n+    } satisfies INotebookCellExecutor.IRunCellOptions;\n+    return executor ? executor.runCell(options) : defaultRunCell(options);\n   }\n \n   /**\n\ndiff --git a/packages/notebook/src/cellexecutor.ts b/packages/notebook/src/cellexecutor.ts\nnew file mode 100644\nindex 000000000000..3556d165b015\n--- /dev/null\n+++ b/packages/notebook/src/cellexecutor.ts\n@@ -0,0 +1,199 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { Dialog, showDialog } from '@jupyterlab/apputils';\n+import {\n+  type Cell,\n+  CodeCell,\n+  type ICodeCellModel,\n+  type MarkdownCell\n+} from '@jupyterlab/cells';\n+import type { KernelMessage } from '@jupyterlab/services';\n+import { nullTranslator } from '@jupyterlab/translation';\n+import { findIndex } from '@lumino/algorithm';\n+import { KernelError } from './actions';\n+import type { INotebookModel } from './model';\n+import type { INotebookCellExecutor } from './tokens';\n+\n+/**\n+ * Run a single notebook cell.\n+ *\n+ * @param options Cell execution options\n+ * @returns Execution status\n+ */\n+export async function runCell({\n+  cell,\n+  notebook,\n+  notebookConfig,\n+  onCellExecuted,\n+  onCellExecutionScheduled,\n+  sessionContext,\n+  sessionDialogs,\n+  translator\n+}: INotebookCellExecutor.IRunCellOptions): Promise<boolean> {\n+  translator = translator ?? nullTranslator;\n+  const trans = translator.load('jupyterlab');\n+  switch (cell.model.type) {\n+    case 'markdown':\n+      (cell as MarkdownCell).rendered = true;\n+      cell.inputHidden = false;\n+      onCellExecuted({ cell, success: true });\n+      break;\n+    case 'code':\n+      if (sessionContext) {\n+        if (sessionContext.isTerminating) {\n+          await showDialog({\n+            title: trans.__('Kernel Terminating'),\n+            body: trans.__(\n+              'The kernel for %1 appears to be terminating. You can not run any cell for now.',\n+              sessionContext.session?.path\n+            ),\n+            buttons: [Dialog.okButton()]\n+          });\n+          break;\n+        }\n+        if (sessionContext.pendingInput) {\n+          await showDialog({\n+            title: trans.__('Cell not executed due to pending input'),\n+            body: trans.__(\n+              'The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again.'\n+            ),\n+            buttons: [Dialog.okButton()]\n+          });\n+          return false;\n+        }\n+        if (sessionContext.hasNoKernel) {\n+          const shouldSelect = await sessionContext.startKernel();\n+          if (shouldSelect && sessionDialogs) {\n+            await sessionDialogs.selectKernel(sessionContext);\n+          }\n+        }\n+\n+        if (sessionContext.hasNoKernel) {\n+          cell.model.sharedModel.transact(() => {\n+            (cell.model as ICodeCellModel).clearExecution();\n+          });\n+          return true;\n+        }\n+\n+        const deletedCells = notebook.deletedCells;\n+        onCellExecutionScheduled({ cell });\n+\n+        let ran = false;\n+        try {\n+          const reply = await CodeCell.execute(\n+            cell as CodeCell,\n+            sessionContext,\n+            {\n+              deletedCells,\n+              recordTiming: notebookConfig.recordTiming\n+            }\n+          );\n+          deletedCells.splice(0, deletedCells.length);\n+\n+          ran = (() => {\n+            if (cell.isDisposed) {\n+              return false;\n+            }\n+\n+            if (!reply) {\n+              return true;\n+            }\n+            if (reply.content.status === 'ok') {\n+              const content = reply.content;\n+\n+              if (content.payload && content.payload.length) {\n+                handlePayload(content, notebook, cell);\n+              }\n+\n+              return true;\n+            } else {\n+              throw new KernelError(reply.content);\n+            }\n+          })();\n+        } catch (reason) {\n+          if (cell.isDisposed || reason.message.startsWith('Canceled')) {\n+            ran = false;\n+          } else {\n+            onCellExecuted({\n+              cell,\n+              success: false,\n+              error: reason\n+            });\n+            throw reason;\n+          }\n+        }\n+\n+        if (ran) {\n+          onCellExecuted({ cell, success: true });\n+        }\n+\n+        return ran;\n+      }\n+      cell.model.sharedModel.transact(() => {\n+        (cell.model as ICodeCellModel).clearExecution();\n+      }, false);\n+      break;\n+    default:\n+      break;\n+  }\n+\n+  return Promise.resolve(true);\n+}\n+\n+/**\n+ * Handle payloads from an execute reply.\n+ *\n+ * #### Notes\n+ * Payloads are deprecated and there are no official interfaces for them in\n+ * the kernel type definitions.\n+ * See [Payloads (DEPRECATED)](https://jupyter-client.readthedocs.io/en/latest/messaging.html#payloads-deprecated).\n+ */\n+function handlePayload(\n+  content: KernelMessage.IExecuteReply,\n+  notebook: INotebookModel,\n+  cell: Cell\n+) {\n+  const setNextInput = content.payload?.filter(i => {\n+    return (i as any).source === 'set_next_input';\n+  })[0];\n+\n+  if (!setNextInput) {\n+    return;\n+  }\n+\n+  const text = setNextInput.text as string;\n+  const replace = setNextInput.replace;\n+\n+  if (replace) {\n+    cell.model.sharedModel.setSource(text);\n+    return;\n+  }\n+\n+  // Create a new code cell and add as the next cell.\n+  const notebookModel = notebook.sharedModel;\n+  const cells = notebook.cells;\n+  const index = findIndex(cells, model => model === cell.model);\n+\n+  // While this cell has no outputs and could be trusted following the letter\n+  // of Jupyter trust model, its content comes from kernel and hence is not\n+  // necessarily controlled by the user; if we set it as trusted, a user\n+  // executing cells in succession could end up with unwanted trusted output.\n+  if (index === -1) {\n+    notebookModel.insertCell(notebookModel.cells.length, {\n+      cell_type: 'code',\n+      source: text,\n+      metadata: {\n+        trusted: false\n+      }\n+    });\n+  } else {\n+    notebookModel.insertCell(index + 1, {\n+      cell_type: 'code',\n+      source: text,\n+      metadata: {\n+        trusted: false\n+      }\n+    });\n+  }\n+}\n\ndiff --git a/packages/notebook/src/index.ts b/packages/notebook/src/index.ts\nindex 10dc0de12a18..bd4e6f807b0d 100644\n--- a/packages/notebook/src/index.ts\n+++ b/packages/notebook/src/index.ts\n@@ -6,6 +6,7 @@\n  */\n \n export * from './actions';\n+export * from './cellexecutor';\n export * from './celllist';\n export * from './default-toolbar';\n export * from './executionindicator';\n\ndiff --git a/packages/notebook/src/tokens.ts b/packages/notebook/src/tokens.ts\nindex eff982ba420a..11c66593ff0c 100644\n--- a/packages/notebook/src/tokens.ts\n+++ b/packages/notebook/src/tokens.ts\n@@ -1,14 +1,22 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { IWidgetTracker } from '@jupyterlab/apputils';\n-import { Cell } from '@jupyterlab/cells';\n+import type {\n+  ISessionContext,\n+  ISessionContextDialogs,\n+  IWidgetTracker\n+} from '@jupyterlab/apputils';\n+import type { Cell } from '@jupyterlab/cells';\n+import type { ITranslator } from '@jupyterlab/translation';\n import { Token } from '@lumino/coreutils';\n-import { ISignal } from '@lumino/signaling';\n-import { Widget } from '@lumino/widgets';\n-import { NotebookTools } from './notebooktools';\n-import { NotebookPanel } from './panel';\n-import { NotebookWidgetFactory } from './widgetfactory';\n+import type { ISignal } from '@lumino/signaling';\n+import type { Widget } from '@lumino/widgets';\n+import type { KernelError } from './actions';\n+import type { INotebookModel } from './model';\n+import type { NotebookTools } from './notebooktools';\n+import type { NotebookPanel } from './panel';\n+import type { StaticNotebook } from './widget';\n+import type { NotebookWidgetFactory } from './widgetfactory';\n \n /**\n  * The notebook widget factory token.\n@@ -130,3 +138,70 @@ export interface INotebookTracker extends IWidgetTracker<NotebookPanel> {\n    */\n   readonly selectionChanged: ISignal<this, void>;\n }\n+\n+/**\n+ * Notebook cell executor namespace\n+ */\n+export namespace INotebookCellExecutor {\n+  /**\n+   * Execution options for notebook cell executor.\n+   */\n+  export interface IRunCellOptions {\n+    /**\n+     * Cell to execute\n+     */\n+    cell: Cell;\n+    /**\n+     * Notebook to which the cell belongs\n+     */\n+    notebook: INotebookModel;\n+    /**\n+     * Notebook widget configuration\n+     */\n+    notebookConfig: StaticNotebook.INotebookConfig;\n+    /**\n+     * A callback to notify a cell completed execution.\n+     */\n+    onCellExecuted: (args: {\n+      cell: Cell;\n+      success: boolean;\n+      error?: KernelError | null;\n+    }) => void;\n+    /**\n+     * A callback to notify that a cell execution is scheduled.\n+     */\n+    onCellExecutionScheduled: (args: { cell: Cell }) => void;\n+    /**\n+     * Document session context\n+     */\n+    sessionContext?: ISessionContext;\n+    /**\n+     * Session dialogs\n+     */\n+    sessionDialogs?: ISessionContextDialogs;\n+    /**\n+     * Application translator\n+     */\n+    translator?: ITranslator;\n+  }\n+}\n+\n+/**\n+ * Notebook cell executor interface\n+ */\n+export interface INotebookCellExecutor {\n+  /**\n+   * Execute a cell.\n+   *\n+   * @param options Cell execution options\n+   */\n+  runCell(options: INotebookCellExecutor.IRunCellOptions): Promise<boolean>;\n+}\n+\n+/**\n+ * The notebook cell executor token.\n+ */\n+export const INotebookCellExecutor = new Token<INotebookCellExecutor>(\n+  '@jupyterlab/notebook:INotebookCellExecutor',\n+  `The notebook cell executor`\n+);\n",
    "test_patch": "diff --git a/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png b/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png\nindex 695785c1fe57..f1df76816165 100644\nBinary files a/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png and b/galata/test/documentation/plugin_manager.test.ts-snapshots/plugin-manager-search-notebook-documentation-linux.png differ\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\nindex cca66ea8bd66..ef0af6e711ad 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/plugins-documentation-linux.json\n@@ -61,6 +61,7 @@\n   \"@jupyterlab/console-extension:kernel-status\": \"Adds the console to the kernel status indicator model.\",\n   \"@jupyterlab/console-extension:cursor-position\": \"Adds the console to the code editor cursor position model.\",\n   \"@jupyterlab/console-extension:completer\": \"Adds completion to the console.\",\n+  \"@jupyterlab/console-extension:cell-executor\": \"Provides the console cell executor.\",\n   \"@jupyterlab/csvviewer-extension:csv\": \"Adds viewer for CSV file types\",\n   \"@jupyterlab/csvviewer-extension:tsv\": \"Adds viewer for TSV file types.\",\n   \"@jupyterlab/debugger-extension:service\": \"Provides the debugger service.\",\n@@ -131,6 +132,7 @@\n   \"@jupyterlab/mermaid-extension:markdown\": \"Provides the Mermaid markdown renderer.\",\n   \"@jupyterlab/mermaid-extension:context-commands\": \"Provides context menu commands for mermaid diagrams.\",\n   \"@jupyterlab/metadataform-extension:metadataforms\": \"Provides the metadata form registry.\",\n+  \"@jupyterlab/notebook-extension:cell-executor\": \"Provides the notebook cell executor.\",\n   \"@jupyterlab/notebook-extension:factory\": \"Provides the notebook cell factory.\",\n   \"@jupyterlab/notebook-extension:tracker\": \"Provides the notebook widget tracker.\",\n   \"@jupyterlab/notebook-extension:execution-indicator\": \"Adds a notebook execution status widget.\",\n\ndiff --git a/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json b/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json\nindex 473e710e2e6d..098f3e2bb170 100644\n--- a/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json\n+++ b/galata/test/documentation/plugins.test.ts-snapshots/tokens-documentation-linux.json\n@@ -28,6 +28,7 @@\n   \"@jupyterlab/completer:IInlineCompleterFactory\": \"A factory of inline completer widgets.\",\n   \"@jupyterlab/console:IContentFactory\": \"A factory object that creates new code consoles. Use this if you want to create and host code consoles in your own UI elements.\",\n   \"@jupyterlab/console:IConsoleTracker\": \"A widget tracker for code consoles.\\n  Use this if you want to be able to iterate over and interact with code consoles\\n  created by the application.\",\n+  \"@jupyterlab/console:IConsoleCellExecutor\": \"The console cell executor\",\n   \"@jupyterlab/debugger:IDebugger\": \"A debugger user interface.\",\n   \"@jupyterlab/debugger:IDebuggerHandler\": \"A service for handling notebook debugger.\",\n   \"@jupyterlab/debugger:IDebuggerSidebar\": \"A service for the debugger sidebar.\",\n@@ -59,6 +60,7 @@\n   \"@jupyterlab/mermaid:IMermaidManager\": \"a manager for rendering mermaid text-based diagrams\",\n   \"@jupyterlab/mermaid:IMermaidMarkdown\": \"a manager for rendering mermaid text-based diagrams in markdown fenced code blocks\",\n   \"@jupyterlab/metadataform:IMetadataFormProvider\": \"A service to register new metadata editor widgets.\",\n+  \"@jupyterlab/notebook:INotebookCellExecutor\": \"The notebook cell executor\",\n   \"@jupyterlab/notebook:IContentFactory\": \"A factory object that creates new notebooks.\\n    Use this if you want to create and host notebooks in your own UI elements.\",\n   \"@jupyterlab/notebook:INotebookTracker\": \"A widget tracker for notebooks.\\n  Use this if you want to be able to iterate over and interact with notebooks\\n  created by the application.\",\n   \"@jupyterlab/notebook:INotebookTools\": \"A service for the \\\"Notebook Tools\\\" panel in the\\n  right sidebar. Use this to add your own functionality to the panel.\",\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15828",
    "pr_id": 15828,
    "issue_id": 15741,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "any approach to override icon/renderer for specific folder?\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\n\n<!--\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\n\n\nBefore creating a new feature request please search the issues for relevant feature requests.\n-->\n\n### Problem\n\nWe are working on an internal jupyter lab solution. In this solution, there is some folder managed by ourselves (for example, a folder controlled by git records common util notebooks)\n\nIs there any approach to specify another piece of svg string to notebooks with special name pattern? \n\nThis could also be a common requirement I guess? Suppose the case that give node_modules a dedicated icon \n\n<!-- Provide a clear and concise description of what problem this feature will solve. For example:\n\n* I'm always frustrated when [...] because [...]\n* I would like it if [...] happened when I [...] because [...]\n-->\n\n### Proposed Solution\n\n<!-- Provide a clear and concise description of a way to accomplish what you want. For example:\n\n* Add an option so that when [...]  [...] will happen\n -->\n\nOne possible solution is leave an abstraction like fileType, which enables application maintainer to customise it in lab extension\n\nWith such kind of abstraction, it shall also be better if we can make it configurable in setting registry \n\n### Additional context\n\n<!-- Add any other context or screenshots about the feature request here. You can also include links to examples of other programs that have something similar to your request. For example:\n\n* Another project [...] solved this by [...]\n-->\n",
    "issue_word_count": 282,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/docregistry/src/registry.ts",
      "packages/docregistry/test/registry.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/docregistry/test/registry.spec.ts"
    ],
    "base_commit": "cdca0a20ba84af21922c390c46e086e50120d4cc",
    "head_commit": "00d35d1f296b17c671a6110364afebc224ca0f08",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15828",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15828",
    "dockerfile": "",
    "pr_merged_at": "2024-03-12T12:33:58.000Z",
    "patch": "diff --git a/packages/docregistry/src/registry.ts b/packages/docregistry/src/registry.ts\nindex 302079f34f4a..046e38fb7b43 100644\n--- a/packages/docregistry/src/registry.ts\n+++ b/packages/docregistry/src/registry.ts\n@@ -664,25 +664,35 @@ export class DocumentRegistry implements IDisposable {\n   getFileTypeForModel(\n     model: Partial<Contents.IModel>\n   ): DocumentRegistry.IFileType {\n+    let ft: DocumentRegistry.IFileType | null = null;\n+    if (model.name || model.path) {\n+      const name = model.name || PathExt.basename(model.path!);\n+      const fts = this.getFileTypesForPath(name);\n+      if (fts.length > 0) {\n+        ft = fts[0];\n+      }\n+    }\n     switch (model.type) {\n       case 'directory':\n+        if (ft !== null && ft.contentType === 'directory') {\n+          return ft;\n+        }\n         return (\n           find(this._fileTypes, ft => ft.contentType === 'directory') ||\n           DocumentRegistry.getDefaultDirectoryFileType(this.translator)\n         );\n       case 'notebook':\n+        if (ft !== null && ft.contentType === 'notebook') {\n+          return ft;\n+        }\n         return (\n           find(this._fileTypes, ft => ft.contentType === 'notebook') ||\n           DocumentRegistry.getDefaultNotebookFileType(this.translator)\n         );\n       default:\n         // Find the best matching extension.\n-        if (model.name || model.path) {\n-          const name = model.name || PathExt.basename(model.path!);\n-          const fts = this.getFileTypesForPath(name);\n-          if (fts.length > 0) {\n-            return fts[0];\n-          }\n+        if (ft !== null) {\n+          return ft;\n         }\n         return (\n           this.getFileType('text') ||\n",
    "test_patch": "diff --git a/packages/docregistry/test/registry.spec.ts b/packages/docregistry/test/registry.spec.ts\nindex eb5002cc3f66..1674c3096d31 100644\n--- a/packages/docregistry/test/registry.spec.ts\n+++ b/packages/docregistry/test/registry.spec.ts\n@@ -700,6 +700,42 @@ describe('docregistry/registry', () => {\n         expect(ft.name).toBe('notebook');\n       });\n \n+      it('should allow to customise filetype for directory', () => {\n+        registry.addFileType({\n+          name: 'node_module',\n+          contentType: 'directory',\n+          pattern: '^node_modules$'\n+        });\n+        const regularDirectoryFt = registry.getFileTypeForModel({\n+          path: '/foo',\n+          type: 'directory'\n+        });\n+        expect(regularDirectoryFt.name).toBe('directory');\n+        const nodeModuleFt = registry.getFileTypeForModel({\n+          path: '/foo/node_modules',\n+          type: 'directory'\n+        });\n+        expect(nodeModuleFt.name).toBe('node_module');\n+      });\n+\n+      it('should allow to customise filetype for notebook', () => {\n+        registry.addFileType({\n+          name: 'test_ipynb',\n+          contentType: 'notebook',\n+          pattern: '^test.ipynb$'\n+        });\n+        const regularNotebookFt = registry.getFileTypeForModel({\n+          name: 'foo.ipynb',\n+          type: 'notebook'\n+        });\n+        expect(regularNotebookFt.name).toBe('notebook');\n+        const customNotebookType = registry.getFileTypeForModel({\n+          path: 'test.ipynb',\n+          type: 'notebook'\n+        });\n+        expect(customNotebookType.name).toBe('test_ipynb');\n+      });\n+\n       it('should handle a python file', () => {\n         const ft = registry.getFileTypeForModel({\n           name: 'foo.py'\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15826",
    "pr_id": 15826,
    "issue_id": 15814,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Specific \"Show/hide replace\" tooltip for find/replace expander button\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue, but you can delete them once you've read them if you prefer! -->\r\n\r\n<!--\r\nThanks for thinking of a way to improve JupyterLab. If this solves a problem for you, then it probably solves that problem for lots of people! So the whole community will benefit from this request.\r\n\r\n\r\nBefore creating a new feature request please search the issues for relevant feature requests.\r\n-->\r\n\r\n### Problem\r\n\r\nCurrently, the search and replace's expander button always has the tooltip, \"Toggle Replace\", whether or not Replace is visible:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/93281816/3013ef15-1a6b-435c-99f7-e28828f4fc25)\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/93281816/0ccf1c3d-a17d-49a4-815d-5b1d0375a0ad)\r\n\r\nPeople using screen readers would not know, without tabbing around to other UI controls, whether Replace is visible.\r\n\r\nThis is an issue as of Lab 4.1.0.\r\n\r\n### Proposed Solution\r\n\r\nHave the tooltip be \"Show Replace\" when Replace is hidden, and \"Hide Replace\" when Replace is visible.\r\n\r\n### Additional context\r\n\r\nThis is adapted from #6650, sub-issue 2, bullet 4, filed by @tgeorgeux.",
    "issue_word_count": 195,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-replace.test.ts",
      "galata/test/jupyterlab/notebook-search.test.ts",
      "packages/documentsearch/src/searchview.tsx"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-replace.test.ts",
      "galata/test/jupyterlab/notebook-search.test.ts"
    ],
    "base_commit": "cfa3f5b94ecdddef8a085b397963e87a0066b559",
    "head_commit": "7671a70de2d91dfa181e882af9d13ed8baede8a9",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15826",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15826",
    "dockerfile": "",
    "pr_merged_at": "2024-02-22T22:50:08.000Z",
    "patch": "diff --git a/packages/documentsearch/src/searchview.tsx b/packages/documentsearch/src/searchview.tsx\nindex 5aa090fb2050..d99d290f2ad6 100644\n--- a/packages/documentsearch/src/searchview.tsx\n+++ b/packages/documentsearch/src/searchview.tsx\n@@ -682,7 +682,11 @@ class SearchOverlay extends React.Component<ISearchOverlayProps> {\n               className={TOGGLE_WRAPPER}\n               onClick={() => this._onReplaceToggled()}\n               tabIndex={0}\n-              title={trans.__('Toggle Replace')}\n+              title={\n+                showReplace\n+                  ? trans.__('Hide Replace')\n+                  : trans.__('Show Replace')\n+              }\n             >\n               <icon.react\n                 className={`${REPLACE_TOGGLE_CLASS} ${BUTTON_CONTENT_CLASS}`}\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-replace.test.ts b/galata/test/jupyterlab/notebook-replace.test.ts\nindex fea906d2353e..02bd238470f2 100644\n--- a/galata/test/jupyterlab/notebook-replace.test.ts\n+++ b/galata/test/jupyterlab/notebook-replace.test.ts\n@@ -30,7 +30,7 @@ test.describe('Notebook Search and Replace', () => {\n \n     await page.waitForSelector('text=1/21');\n \n-    await page.click('button[title=\"Toggle Replace\"]');\n+    await page.click('button[title=\"Show Replace\"]');\n \n     await page.fill('[placeholder=\"Replace\"]', 'egg');\n \n@@ -50,7 +50,7 @@ test.describe('Notebook Search and Replace', () => {\n     await page.fill('[placeholder=\"Find\"]', 'text/(\\\\w+)');\n     await page.waitForSelector('text=1/3');\n \n-    await page.click('button[title=\"Toggle Replace\"]');\n+    await page.click('button[title=\"Show Replace\"]');\n     await page.fill('[placeholder=\"Replace\"]', 'script/$1');\n     const cell = await page.notebook.getCell(2);\n     await expect(page.locator('body')).not.toContainText('script/plain');\n@@ -75,7 +75,7 @@ test.describe('Notebook Search and Replace', () => {\n       clickCount: 4\n     });\n \n-    await page.click('button[title=\"Toggle Replace\"]');\n+    await page.click('button[title=\"Show Replace\"]');\n \n     await page.fill('[placeholder=\"Replace\"]', 'egg');\n \n@@ -98,7 +98,7 @@ test.describe('Notebook Search and Replace', () => {\n \n     await page.waitForSelector('text=1/21');\n \n-    await page.click('button[title=\"Toggle Replace\"]');\n+    await page.click('button[title=\"Show Replace\"]');\n \n     await page.fill('[placeholder=\"Replace\"]', 'egg');\n \n@@ -120,7 +120,7 @@ test.describe('Notebook Search and Replace', () => {\n     await page.keyboard.press('Control+f');\n     await page.fill('[placeholder=\"Find\"]', 'test');\n \n-    await page.click('button[title=\"Toggle Replace\"]');\n+    await page.click('button[title=\"Show Replace\"]');\n     await page.fill('[placeholder=\"Replace\"]', 'egg');\n \n     // TODO: Next Match press count should be one less\n\ndiff --git a/galata/test/jupyterlab/notebook-search.test.ts b/galata/test/jupyterlab/notebook-search.test.ts\nindex b9f6679f0d88..a67b7d02d7c6 100644\n--- a/galata/test/jupyterlab/notebook-search.test.ts\n+++ b/galata/test/jupyterlab/notebook-search.test.ts\n@@ -94,7 +94,7 @@ test.describe('Notebook Search', () => {\n     await page.waitForSelector('text=1/1');\n \n     // Show replace buttons to check for visual regressions\n-    await page.click('button[title=\"Toggle Replace\"]');\n+    await page.click('button[title=\"Show Replace\"]');\n     await page.fill('[placeholder=\"Replace\"]', 'line1\\nline2');\n \n     const overlay = page.locator('.jp-DocumentSearch-overlay');\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15805",
    "pr_id": 15805,
    "issue_id": 14589,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Syntax highlighting for Python built-in functions does not work with JupyterLab 4.0.0\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nSyntax highlighting for Python built-in functions does not work with JupyterLab 4.0.0. It worked in previous versions as seen here:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/9025982/dce0b985-a461-4fcf-8c77-5d1a628ad0b0)\r\n\r\n@krassowski noted in https://github.com/jupyterlab/jupyterlab/issues/14584#issuecomment-1561783918 that this was likely caused by the migration from CodeMirror5 to CodeMirror6 and that a custom solution is necessary since upstream is not interested in supporting built-in functions as per https://github.com/lezer-parser/python/issues/9 and https://github.com/lezer-parser/python/pull/13.\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\nOpen any notebook with JupyterLab 4.0.0 and type any [Python built-in functions](https://docs.python.org/3/library/functions.html), such as print(), len(), list(), or int(), into a code block.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\nPython built-in functions are highlighted in some way similar to previous JupyterLab versions.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- Operating System and version: Windows 11 22H2\r\n- Browser and version: Microsoft Edge 113.0.1774.35\r\n- JupyterLab version: 4.0.0\r\n\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n\r\n",
    "issue_word_count": 281,
    "test_files_count": 9,
    "non_test_files_count": 6,
    "pr_changed_files": [
      "examples/notebook/example.spec.ts-snapshots/example-linux.png",
      "galata/test/benchmark/notebook.spec.ts-snapshots/large-code-notebook-ipynb-benchmark-linux.png",
      "galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-script-sources-jupyterlab-linux.png",
      "galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-sources-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mobile.test.ts-snapshots/mobile-layout-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-new-outputs-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-new-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png",
      "packages/codemirror-extension/src/services.tsx",
      "packages/codemirror/src/index.ts",
      "packages/codemirror/src/language.ts",
      "packages/codemirror/src/pythonBuiltin.ts",
      "packages/codemirror/src/theme.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/benchmark/notebook.spec.ts-snapshots/large-code-notebook-ipynb-benchmark-linux.png",
      "galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-script-sources-jupyterlab-linux.png",
      "galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-sources-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mobile.test.ts-snapshots/mobile-layout-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-new-outputs-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-new-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png",
      "galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png"
    ],
    "base_commit": "e40ed2ecd299e70c95dea1cd4ef233dfd42cee92",
    "head_commit": "0269702b380e296866777580a51162dcfcd66b0d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15805",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15805",
    "dockerfile": "",
    "pr_merged_at": "2024-02-28T07:59:40.000Z",
    "patch": "diff --git a/examples/notebook/example.spec.ts-snapshots/example-linux.png b/examples/notebook/example.spec.ts-snapshots/example-linux.png\nindex 3bc852278410..8a09ec72d3b8 100644\nBinary files a/examples/notebook/example.spec.ts-snapshots/example-linux.png and b/examples/notebook/example.spec.ts-snapshots/example-linux.png differ\n\ndiff --git a/packages/codemirror-extension/src/services.tsx b/packages/codemirror-extension/src/services.tsx\nindex c9d5627b661d..5190f62e929d 100644\n--- a/packages/codemirror-extension/src/services.tsx\n+++ b/packages/codemirror-extension/src/services.tsx\n@@ -3,7 +3,7 @@\n  * Distributed under the terms of the Modified BSD License.\n  */\n \n-import { StreamLanguage } from '@codemirror/language';\n+import { LanguageSupport, StreamLanguage } from '@codemirror/language';\n import { IYText } from '@jupyter/ydoc';\n import {\n   JupyterFrontEnd,\n@@ -20,6 +20,7 @@ import {\n   IEditorLanguageRegistry,\n   IEditorThemeRegistry,\n   parseMathIPython,\n+  pythonBuiltin,\n   ybinding\n } from '@jupyterlab/codemirror';\n import { ISettingRegistry } from '@jupyterlab/settingregistry';\n@@ -62,17 +63,22 @@ export const languagePlugin: JupyterFrontEndPlugin<IEditorLanguageRegistry> = {\n       name: 'ipythongfm',\n       mime: 'text/x-ipythongfm',\n       load: async () => {\n-        const [m, tex] = await Promise.all([\n+        const [m, py, tex] = await Promise.all([\n           import('@codemirror/lang-markdown'),\n+          import('@codemirror/lang-python'),\n           import('@codemirror/legacy-modes/mode/stex')\n         ]);\n-        return m.markdown({\n+        const mdlang = m.markdown({\n           base: m.markdownLanguage,\n           codeLanguages: (info: string) => languages.findBest(info) as any,\n           extensions: [\n             parseMathIPython(StreamLanguage.define(tex.stexMath).parser)\n           ]\n         });\n+        return new LanguageSupport(mdlang.language, [\n+          mdlang.support,\n+          pythonBuiltin(py.pythonLanguage)\n+        ]);\n       }\n     });\n     return languages;\n\ndiff --git a/packages/codemirror/src/index.ts b/packages/codemirror/src/index.ts\nindex 33b1c4d60ed0..2d34ee896a7b 100644\n--- a/packages/codemirror/src/index.ts\n+++ b/packages/codemirror/src/index.ts\n@@ -15,3 +15,4 @@ export * from './mimetype';\n export * from './searchprovider';\n export * from './theme';\n export * from './token';\n+export * from './pythonBuiltin';\n\ndiff --git a/packages/codemirror/src/language.ts b/packages/codemirror/src/language.ts\nindex 3bafd287a416..55017e7a50ab 100644\n--- a/packages/codemirror/src/language.ts\n+++ b/packages/codemirror/src/language.ts\n@@ -16,6 +16,7 @@ import { highlightTree } from '@lezer/highlight';\n \n import { jupyterHighlightStyle } from './theme';\n import { IEditorLanguage, IEditorLanguageRegistry } from './token';\n+import { pythonBuiltin } from './pythonBuiltin';\n \n /**\n  * CodeMirror language registry\n@@ -473,7 +474,10 @@ export namespace EditorLanguageRegistry {\n         filename: /^(BUCK|BUILD)$/,\n         async load() {\n           const m = await import('@codemirror/lang-python');\n-          return m.python();\n+          return new LanguageSupport(\n+            m.pythonLanguage,\n+            pythonBuiltin(m.pythonLanguage)\n+          );\n         }\n       },\n       {\n@@ -485,7 +489,10 @@ export namespace EditorLanguageRegistry {\n           // to activate feature such as code folding.\n           // return Promise.resolve(legacy(mkPython({ singleOperators: /\\?/ })));\n           const m = await import('@codemirror/lang-python');\n-          return m.python();\n+          return new LanguageSupport(\n+            m.pythonLanguage,\n+            pythonBuiltin(m.pythonLanguage)\n+          );\n         }\n       },\n       {\n\ndiff --git a/packages/codemirror/src/pythonBuiltin.ts b/packages/codemirror/src/pythonBuiltin.ts\nnew file mode 100644\nindex 000000000000..332a35160dec\n--- /dev/null\n+++ b/packages/codemirror/src/pythonBuiltin.ts\n@@ -0,0 +1,159 @@\n+/*\n+ * Copyright (c) Jupyter Development Team.\n+ * Distributed under the terms of the Modified BSD License.\n+ */\n+\n+import { Language, syntaxTree } from '@codemirror/language';\n+import { RangeSetBuilder } from '@codemirror/state';\n+import {\n+  Decoration,\n+  DecorationSet,\n+  EditorView,\n+  ViewPlugin,\n+  ViewUpdate\n+} from '@codemirror/view';\n+import { NodeProp, SyntaxNodeRef, Tree } from '@lezer/common';\n+\n+export class PythonBuiltin {\n+  decorations: DecorationSet;\n+  decoratedTo: number;\n+  langPython: Language;\n+  tree: Tree;\n+  mark: Decoration;\n+\n+  constructor(view: EditorView, langPython: Language) {\n+    this.langPython = langPython;\n+    this.tree = syntaxTree(view.state);\n+    this.mark = Decoration.mark({ class: 'cm-builtin' });\n+    this.decorations = this.buildDeco(view);\n+    this.decoratedTo = view.viewport.to;\n+  }\n+\n+  update(update: ViewUpdate) {\n+    let tree = syntaxTree(update.state);\n+    let { viewport } = update.view,\n+      decoratedToMapped = update.changes.mapPos(this.decoratedTo, 1);\n+    if (\n+      tree.length < viewport.to &&\n+      tree.type == this.tree.type &&\n+      decoratedToMapped >= viewport.to\n+    ) {\n+      this.decorations = this.decorations.map(update.changes);\n+      this.decoratedTo = decoratedToMapped;\n+    } else if (tree != this.tree || update.viewportChanged) {\n+      this.tree = tree;\n+      this.decorations = this.buildDeco(update.view);\n+      this.decoratedTo = viewport.to;\n+    }\n+  }\n+\n+  buildDeco(view: EditorView) {\n+    if (!this.tree.length) return Decoration.none;\n+\n+    let builder = new RangeSetBuilder<Decoration>();\n+    const enter = (node: SyntaxNodeRef) => {\n+      const cursor = node.node.cursor();\n+      // Handle nested language, e.g. Markdown\n+      const mounted = cursor.tree && cursor.tree.prop(NodeProp.mounted);\n+      if (mounted && mounted.overlay) {\n+        node.node\n+          .enter(mounted.overlay[0].from + node.from, 1)\n+          ?.cursor()\n+          .iterate(enter);\n+      }\n+      if (\n+        this.langPython.isActiveAt(view.state, node.from + 1) &&\n+        node.name === 'VariableName'\n+      ) {\n+        const variableName = view.state.sliceDoc(node.from, node.to);\n+        if (builtins.includes(variableName)) {\n+          builder.add(node.from, node.to, this.mark);\n+        }\n+      }\n+    };\n+    for (let { from, to } of view.visibleRanges) {\n+      this.tree.iterate({ enter, from, to });\n+    }\n+    return builder.finish();\n+  }\n+}\n+\n+export function pythonBuiltin(langPython: Language) {\n+  return ViewPlugin.define(view => new PythonBuiltin(view, langPython), {\n+    decorations: v => v.decorations\n+  });\n+}\n+\n+const builtins = [\n+  'abs',\n+  'aiter',\n+  'all',\n+  'any',\n+  'anext',\n+  'ascii',\n+  'bin',\n+  'bool',\n+  'breakpoint',\n+  'bytearray',\n+  'bytes',\n+  'callable',\n+  'chr',\n+  'classmethod',\n+  'compile',\n+  'complex',\n+  'delattr',\n+  'dict',\n+  'dir',\n+  'divmod',\n+  'enumerate',\n+  'eval',\n+  'exec',\n+  'filter',\n+  'float',\n+  'format',\n+  'frozenset',\n+  'getattr',\n+  'globals',\n+  'hasattr',\n+  'hash',\n+  'help',\n+  'hex',\n+  'id',\n+  'input',\n+  'int',\n+  'isinstance',\n+  'issubclass',\n+  'iter',\n+  'len',\n+  'list',\n+  'locals',\n+  'map',\n+  'max',\n+  'memoryview',\n+  'min',\n+  'next',\n+  'object',\n+  'oct',\n+  'open',\n+  'ord',\n+  'pow',\n+  'print',\n+  'property',\n+  'range',\n+  'repr',\n+  'reversed',\n+  'round',\n+  'set',\n+  'setattr',\n+  'slice',\n+  'sorted',\n+  'staticmethod',\n+  'str',\n+  'sum',\n+  'super',\n+  'tuple',\n+  'type',\n+  'vars',\n+  'zip',\n+  '__import__'\n+];\n\ndiff --git a/packages/codemirror/src/theme.ts b/packages/codemirror/src/theme.ts\nindex eec13b0a5c60..54cd7649fe35 100644\n--- a/packages/codemirror/src/theme.ts\n+++ b/packages/codemirror/src/theme.ts\n@@ -81,6 +81,10 @@ export const jupyterEditorTheme = EditorView.theme({\n \n   '.cm-tooltip': {\n     backgroundColor: 'var(--jp-layout-color1)'\n+  },\n+\n+  '.cm-builtin': {\n+    color: 'var(--jp-mirror-editor-builtin-color)'\n   }\n });\n \n",
    "test_patch": "diff --git a/galata/test/benchmark/notebook.spec.ts-snapshots/large-code-notebook-ipynb-benchmark-linux.png b/galata/test/benchmark/notebook.spec.ts-snapshots/large-code-notebook-ipynb-benchmark-linux.png\nindex d92cf065c4d2..195ac18b7bed 100644\nBinary files a/galata/test/benchmark/notebook.spec.ts-snapshots/large-code-notebook-ipynb-benchmark-linux.png and b/galata/test/benchmark/notebook.spec.ts-snapshots/large-code-notebook-ipynb-benchmark-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-script-sources-jupyterlab-linux.png b/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-script-sources-jupyterlab-linux.png\nindex 71f4e3df4dad..8c0615310aa5 100644\nBinary files a/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-script-sources-jupyterlab-linux.png and b/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-script-sources-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-sources-jupyterlab-linux.png b/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-sources-jupyterlab-linux.png\nindex 19d8db7e1078..a35d44d2c9c0 100644\nBinary files a/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-sources-jupyterlab-linux.png and b/galata/test/jupyterlab/debugger.test.ts-snapshots/start-debug-session-sources-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mobile.test.ts-snapshots/mobile-layout-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mobile.test.ts-snapshots/mobile-layout-jupyterlab-linux.png\nindex e7fc0c88e0ec..9b99de6442b3 100644\nBinary files a/galata/test/jupyterlab/notebook-mobile.test.ts-snapshots/mobile-layout-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-mobile.test.ts-snapshots/mobile-layout-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-new-outputs-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-new-outputs-jupyterlab-linux.png\nindex 57819f74e41c..baba7c87fca7 100644\nBinary files a/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-new-outputs-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-new-outputs-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-new-cell-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-new-cell-jupyterlab-linux.png\nindex 33f07d6f7301..4c02210b2abd 100644\nBinary files a/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-new-cell-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-on-new-cell-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png\nindex 686d8e42575a..41bc934410e0 100644\nBinary files a/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-search.test.ts-snapshots/search-within-outputs-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png\nindex ad0f85ac2956..52627c4f9cbb 100644\nBinary files a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png and b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-normal-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png\nindex fb215064a427..a547aa1928c0 100644\nBinary files a/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png and b/galata/test/jupyterlab/output-scrolling.test.ts-snapshots/prompt-overlay-hover-scroll-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15803",
    "pr_id": 15803,
    "issue_id": 15657,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "When using find and replace, the next string is selected, but the previous is replaced\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nWhen I use find and replace, as one string is replaced, the next occurrence is highlighted.\r\nHowever, if I press replace again, the previous occurrence is replaced, not the one highlighted.\r\n\r\nI've confirmed this issue with a clean install and in incognito mode on chrome.\r\n\r\n## Reproduce\r\n\r\nOpen \"Find and replace\".\r\nType the string to be found.\r\nType the replacement string.\r\nUse the up and down buttons to select the first occurrence you want to replace.\r\nPress replace. The string is replaced as expected and the highlight moves to the next occurence.\r\nPress replace again. The highlight moves again, but the replaced occurrence is the one **before** the first replacement.\r\nThis will happen every time I press replace.\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/43036625/ea18e722-75ab-4534-8cc2-03fae35264e0)\r\n\r\n## Expected behavior\r\n\r\nThe highlighted string is replaced.\r\n\r\n\r\n## Context\r\n- Operating System and version: Linux Ubuntu 20.04\r\n- Browser and version: Chrome 120\r\n- JupyterLab version: 4.0.7\r\n\r\n",
    "issue_word_count": 210,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/codemirror/src/searchprovider.ts",
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/searchprovider.spec.ts"
    ],
    "base_commit": "1a98deafa7dc41607106b55936fbdefe9741faaa",
    "head_commit": "8983b795a256713a75151e667976821adee2ee4f",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15803",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15803",
    "dockerfile": "",
    "pr_merged_at": "2024-02-16T13:35:27.000Z",
    "patch": "diff --git a/packages/codemirror/src/searchprovider.ts b/packages/codemirror/src/searchprovider.ts\nindex 557b64cf8183..6b9c67a5730d 100644\n--- a/packages/codemirror/src/searchprovider.ts\n+++ b/packages/codemirror/src/searchprovider.ts\n@@ -319,9 +319,9 @@ export abstract class EditorSearchProvider<\n    *\n    * The caller of this method is expected to call `highlightNext` if after\n    * calling `replaceCurrentMatch()` attribute `this.currentIndex` is null.\n-   * It is necesary to let the caller handle highlighting because this\n+   * It is necessary to let the caller handle highlighting because this\n    * method is used in composition pattern (search engine of notebook cells)\n-   * and highligthing on the composer (notebook) level needs to switch to next\n+   * and highlighting on the composer (notebook) level needs to switch to next\n    * engine (cell) with matches.\n    *\n    * @param newText The replacement text.\n@@ -343,15 +343,17 @@ export abstract class EditorSearchProvider<\n       this.currentIndex < this.cmHandler.matches.length\n     ) {\n       const match = this.getCurrentMatch();\n-      // If cursor there is no match selected, highlight the next match\n       if (!match) {\n         this.currentIndex = null;\n       } else {\n         this.cmHandler.matches.splice(this.currentIndex, 1);\n+        const cmMatchesRemaining = this.cmHandler.matches.length;\n+\n+        // End at the end of the CodeMirror matches list; do not loop\n+        // Let the caller call highlightNext if we've reached the end of the current code cell\n         this.currentIndex =\n-          this.currentIndex < this.cmHandler.matches.length\n-            ? Math.max(this.currentIndex - 1, 0)\n-            : null;\n+          this.currentIndex < cmMatchesRemaining ? this.currentIndex : null;\n+\n         const substitutedText = options?.regularExpression\n           ? match!.text.replace(this.query!, newText)\n           : newText;\n",
    "test_patch": "diff --git a/packages/notebook/test/searchprovider.spec.ts b/packages/notebook/test/searchprovider.spec.ts\nindex 80893b2366d5..f6ff54451603 100644\n--- a/packages/notebook/test/searchprovider.spec.ts\n+++ b/packages/notebook/test/searchprovider.spec.ts\n@@ -214,6 +214,31 @@ describe('@jupyterlab/notebook', () => {\n         expect(provider.currentMatchIndex).toBe(0);\n       });\n \n+      it('should start in the middle of a code cell, replace, and highlight next', async () => {\n+        panel.model!.sharedModel.deleteCellRange(0, 2);\n+        panel.model!.sharedModel.insertCells(0, [\n+          { cell_type: 'code', source: 'test1 test2 test3' }\n+        ]);\n+        panel.content.activeCellIndex = 0;\n+        await provider.cellChangeHandled;\n+        panel.content.mode = 'edit';\n+\n+        // Pick the spot before the second element.\n+        await panel.content.activeCell!.editor!.setCursorPosition({\n+          line: 0,\n+          column: 'test1 '.length\n+        });\n+\n+        await provider.startQuery(/test\\d/, { selection: true });\n+\n+        expect(provider.currentMatchIndex).toBe(1);\n+        let replaced = await provider.replaceCurrentMatch('bar');\n+        expect(replaced).toBe(true);\n+        const source = panel.model!.cells.get(0).sharedModel.getSource();\n+        expect(source).toBe('test1 bar test3');\n+        expect(provider.currentMatchIndex).toBe(1);\n+      });\n+\n       it('should substitute groups in regular expressions', async () => {\n         await provider.startQuery(/test(\\d)/, undefined);\n         expect(provider.currentMatchIndex).toBe(0);\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15794",
    "pr_id": 15794,
    "issue_id": 14752,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Windows / Chrome: markdown code blocks get corrupted after pasting Windows line endings\n## Description\r\n\r\nWhen you paste text with Windows line endings (`\\r\\n`) in a code block within a Markdown cell the result is unexpected. Linux line endings (`\\n`) work fine, but for Windows line endings the cell content becomes corrupt (although it may seem correct in edit mode). See attached screen capture for a demonstration.\r\n\r\nThe example is for Python code but this actually does not matter: when another (e.g. xml) or no syntax is specified the issue occurs as well.\r\n\r\nNote (edit 2023-12-18): the first part of the reproduction `.mp4` does not play correctly in Chrome (anymore). If you download it (or use Firefox) you still watch it entirely...\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/assets/9745514/df6fdbb4-7482-4802-85a1-701e8b49b176\r\n\r\n## Reproduce\r\n\r\n1. Open a new Python Notebook.\r\n2. Create a Markdown type cell with a Python codeblock:\r\n    \\`\\`\\`python\r\n    \r\n    \\`\\`\\`\r\n4. Paste some Python code with Windows line endings (`\\r\\n`) in the codeblock.\r\n5. Run the cell (or save the notebook and reload).\r\n\r\n## Expected behavior\r\n\r\nWhen pasting Windows line endings the result should be rendered / saved the same as when pasting Linux line endings.\r\n\r\n## Context\r\n  - Issue occurs on Windows 10 and Windows Server 2016; seems not directly operating system related, \r\n  - Python sys.version: '3.11.4 (tags/v3.11.4:d2340ef, Jun  7 2023, 05:45:37) [MSC v.1934 64 bit (AMD64)]' but I had the same issue on Python 3.11.3 (also Windows).\r\n  - Issue occurs in JupyterLab >= 4.0.0 not in JupyterLab 3.6.4 or Notebook 6.5.4.\r\n  - Issue occurs in Chrome (114.0.5735.134 normal and incognito mode) not in Firefox (114.0.2)\r\n  - No server and/or JavaScript error message is shown.\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\nPS E:\\projects\\markdown> .\\venv\\Scripts\\jupyter.exe troubleshoot\r\nINFO: Could not find files for the given pattern(s).\r\n$PATH:\r\n        C:\\Program Files\\Python311\\Scripts\\\r\n        C:\\Program Files\\Python311\\\r\n        C:\\Windows\\system32\r\n        C:\\Windows\r\n        C:\\Windows\\System32\\Wbem\r\n        C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\\r\n        C:\\Windows\\System32\\OpenSSH\\\r\n        C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common\r\n        C:\\Program Files\\NVIDIA Corporation\\NVIDIA NvDLISR\r\n        C:\\WINDOWS\\system32\r\n        C:\\WINDOWS\r\n        C:\\WINDOWS\\System32\\Wbem\r\n        C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\\r\n        C:\\WINDOWS\\System32\\OpenSSH\\\r\n        C:\\Program Files\\Microsoft VS Code\\bin\r\n        C:\\Program Files\\TortoiseGit\\bin\r\n        C:\\Program Files\\Git\\cmd\r\n        C:\\Users\\user\\.cargo\\bin\r\n        C:\\Users\\user\\AppData\\Local\\Microsoft\\WindowsApps\r\n\r\n\r\nsys.path:\r\n        E:\\projects\\markdown\\venv\\Scripts\\jupyter-troubleshoot.EXE\r\n        C:\\Program Files\\Python311\\python311.zip\r\n        C:\\Program Files\\Python311\\DLLs\r\n        C:\\Program Files\\Python311\\Lib\r\n        C:\\Program Files\\Python311\r\n        E:\\projects\\markdown\\venv\r\n        E:\\projects\\markdown\\venv\\Lib\\site-packages\r\n        E:\\projects\\markdown\\venv\\Lib\\site-packages\\win32\r\n        E:\\projects\\markdown\\venv\\Lib\\site-packages\\win32\\lib\r\n        E:\\projects\\markdown\\venv\\Lib\\site-packages\\Pythonwin\r\n\r\nsys.executable:\r\n        E:\\projects\\markdown\\venv\\Scripts\\python.exe\r\n\r\nsys.version:\r\n        3.11.4 (tags/v3.11.4:d2340ef, Jun  7 2023, 05:45:37) [MSC v.1934 64 bit (AMD64)]\r\n\r\nplatform.platform():\r\n        Windows-10-10.0.22621-SP0\r\n\r\npip list:\r\n        Package                  Version\r\n        ------------------------ --------\r\n        anyio                    3.7.0\r\n        argon2-cffi              21.3.0\r\n        argon2-cffi-bindings     21.2.0\r\n        arrow                    1.2.3\r\n        asttokens                2.2.1\r\n        async-lru                2.0.2\r\n        attrs                    23.1.0\r\n        Babel                    2.12.1\r\n        backcall                 0.2.0\r\n        beautifulsoup4           4.12.2\r\n        bleach                   6.0.0\r\n        certifi                  2023.5.7\r\n        cffi                     1.15.1\r\n        charset-normalizer       3.1.0\r\n        colorama                 0.4.6\r\n        comm                     0.1.3\r\n        debugpy                  1.6.7\r\n        decorator                5.1.1\r\n        defusedxml               0.7.1\r\n        executing                1.2.0\r\n        fastjsonschema           2.17.1\r\n        fqdn                     1.5.1\r\n        idna                     3.4\r\n        ipykernel                6.23.3\r\n        ipython                  8.14.0\r\n        ipython-genutils         0.2.0\r\n        isoduration              20.11.0\r\n        jedi                     0.18.2\r\n        Jinja2                   3.1.2\r\n        json5                    0.9.14\r\n        jsonpointer              2.4\r\n        jsonschema               4.17.3\r\n        jupyter_client           8.3.0\r\n        jupyter_core             5.3.1\r\n        jupyter-events           0.6.3\r\n        jupyter-lsp              2.2.0\r\n        jupyter_server           2.6.0\r\n        jupyter_server_terminals 0.4.4\r\n        jupyterlab               4.0.2\r\n        jupyterlab-pygments      0.2.2\r\n        jupyterlab_server        2.23.0\r\n        MarkupSafe               2.1.3\r\n        matplotlib-inline        0.1.6\r\n        mistune                  3.0.1\r\n        nbclassic                1.0.0\r\n        nbclient                 0.8.0\r\n        nbconvert                7.6.0\r\n        nbformat                 5.9.0\r\n        nest-asyncio             1.5.6\r\n        notebook                 6.5.4\r\n        notebook_shim            0.2.3\r\n        overrides                7.3.1\r\n        packaging                23.1\r\n        pandocfilters            1.5.0\r\n        parso                    0.8.3\r\n        pickleshare              0.7.5\r\n        pip                      23.1.2\r\n        platformdirs             3.8.0\r\n        prometheus-client        0.17.0\r\n        prompt-toolkit           3.0.38\r\n        psutil                   5.9.5\r\n        pure-eval                0.2.2\r\n        pycparser                2.21\r\n        Pygments                 2.15.1\r\n        pyrsistent               0.19.3\r\n        python-dateutil          2.8.2\r\n        python-json-logger       2.0.7\r\n        pywin32                  306\r\n        pywinpty                 2.0.10\r\n        PyYAML                   6.0\r\n        pyzmq                    25.1.0\r\n        requests                 2.31.0\r\n        rfc3339-validator        0.1.4\r\n        rfc3986-validator        0.1.1\r\n        Send2Trash               1.8.2\r\n        setuptools               65.5.0\r\n        six                      1.16.0\r\n        sniffio                  1.3.0\r\n        soupsieve                2.4.1\r\n        stack-data               0.6.2\r\n        terminado                0.17.1\r\n        tinycss2                 1.2.1\r\n        tornado                  6.3.2\r\n        traitlets                5.9.0\r\n        typing_extensions        4.6.3\r\n        uri-template             1.3.0\r\n        urllib3                  2.0.3\r\n        wcwidth                  0.2.6\r\n        webcolors                1.13\r\n        webencodings             0.5.1\r\n        websocket-client         1.6.1\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\nPS E:\\projects\\markdown> .\\venv\\Scripts\\jupyter.exe lab\r\n[I 2023-06-24 13:23:23.484 ServerApp] Package jupyterlab took 0.0000s to import\r\n[I 2023-06-24 13:23:23.497 ServerApp] Package jupyter_lsp took 0.0136s to import\r\n[W 2023-06-24 13:23:23.498 ServerApp] A `_jupyter_server_extension_points` function was not found in jupyter_lsp. Instead, a `_jupyter_server_extension_paths` function was found and will be used for now. This function name will be deprecated in future releases of Jupyter Server.\r\n[I 2023-06-24 13:23:23.505 ServerApp] Package jupyter_server_terminals took 0.0066s to import\r\n[I 2023-06-24 13:23:23.506 ServerApp] Package nbclassic took 0.0008s to import\r\n[W 2023-06-24 13:23:23.507 ServerApp] A `_jupyter_server_extension_points` function was not found in nbclassic. Instead, a `_jupyter_server_extension_paths` function was found and will be used for now. This function name will be deprecated in future releases of Jupyter Server.\r\n[I 2023-06-24 13:23:23.508 ServerApp] Package notebook_shim took 0.0000s to import\r\n[W 2023-06-24 13:23:23.508 ServerApp] A `_jupyter_server_extension_points` function was not found in notebook_shim. Instead, a `_jupyter_server_extension_paths` function was found and will be used for now. This function name will be deprecated in future releases of Jupyter Server.\r\n[I 2023-06-24 13:23:23.508 ServerApp] jupyter_lsp | extension was successfully linked.\r\n[I 2023-06-24 13:23:23.513 ServerApp] jupyter_server_terminals | extension was successfully linked.\r\n[I 2023-06-24 13:23:23.517 ServerApp] jupyterlab | extension was successfully linked.\r\n[I 2023-06-24 13:23:23.521 ServerApp] nbclassic | extension was successfully linked.\r\n[I 2023-06-24 13:23:23.726 ServerApp] notebook_shim | extension was successfully linked.\r\n[I 2023-06-24 13:23:23.892 ServerApp] notebook_shim | extension was successfully loaded.\r\n[I 2023-06-24 13:23:23.893 ServerApp] jupyter_lsp | extension was successfully loaded.\r\n[I 2023-06-24 13:23:23.894 ServerApp] jupyter_server_terminals | extension was successfully loaded.\r\n[I 2023-06-24 13:23:23.895 LabApp] JupyterLab extension loaded from E:\\projects\\markdown\\venv\\Lib\\site-packages\\jupyterlab\r\n[I 2023-06-24 13:23:23.895 LabApp] JupyterLab application directory is E:\\projects\\markdown\\venv\\share\\jupyter\\lab\r\n[I 2023-06-24 13:23:23.896 LabApp] Extension Manager is 'pypi'.\r\n[I 2023-06-24 13:23:23.897 ServerApp] jupyterlab | extension was successfully loaded.\r\n\r\n  _   _          _      _\r\n | | | |_ __  __| |__ _| |_ ___\r\n | |_| | '_ \\/ _` / _` |  _/ -_)\r\n  \\___/| .__/\\__,_\\__,_|\\__\\___|\r\n       |_|\r\n\r\nRead the migration plan to Notebook 7 to learn about the new features and the actions to take if you are using extensions.\r\n\r\nhttps://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html\r\n\r\nPlease note that updating to Notebook 7 might break some of your extensions.\r\n\r\n[I 2023-06-24 13:23:23.900 ServerApp] nbclassic | extension was successfully loaded.\r\n[I 2023-06-24 13:23:23.901 ServerApp] Serving notebooks from local directory: E:\\projects\\markdown\r\n[I 2023-06-24 13:23:23.901 ServerApp] Jupyter Server 2.6.0 is running at:\r\n[I 2023-06-24 13:23:23.901 ServerApp] http://localhost:8888/lab?token=88b4fc62dcd2c4f76651b80fe61f557a45ba162f081eda51\r\n[I 2023-06-24 13:23:23.901 ServerApp]     http://127.0.0.1:8888/lab?token=88b4fc62dcd2c4f76651b80fe61f557a45ba162f081eda51\r\n[I 2023-06-24 13:23:23.902 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\r\n[C 2023-06-24 13:23:23.923 ServerApp]\r\n\r\n    To access the server, open this file in a browser:\r\n        file:///C:/Users/user/AppData/Roaming/jupyter/runtime/jpserver-384-open.html\r\n    Or copy and paste one of these URLs:\r\n        http://localhost:8888/lab?token=88b4fc62dcd2c4f76651b80fe61f557a45ba162f081eda51\r\n        http://127.0.0.1:8888/lab?token=88b4fc62dcd2c4f76651b80fe61f557a45ba162f081eda51\r\n[I 2023-06-24 13:23:23.954 ServerApp] Skipped non-installed server(s): bash-language-server, dockerfile-language-server-nodejs, javascript-typescript-langserver, jedi-language-server, julia-language-server, pyright, python-language-server, python-lsp-server, r-languageserver, sql-language-server, texlab, typescript-language-server, unified-language-server, vscode-css-languageserver-bin, vscode-html-languageserver-bin, vscode-json-languageserver-bin, yaml-language-server\r\n0.00s - Debugger warning: It seems that frozen modules are being used, which may\r\n0.00s - make the debugger miss breakpoints. Please pass -Xfrozen_modules=off\r\n0.00s - to python to disable frozen modules.\r\n0.00s - Note: Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION=1 to disable this validation.\r\n[W 2023-06-24 13:23:26.558 LabApp] Could not determine jupyterlab build status without nodejs\r\n[I 2023-06-24 13:23:27.173 ServerApp] Kernel started: 5bee51ee-b34b-440e-bbdd-d0f8eb4b774f\r\n0.00s - Debugger warning: It seems that frozen modules are being used, which may\r\n0.00s - make the debugger miss breakpoints. Please pass -Xfrozen_modules=off\r\n0.00s - to python to disable frozen modules.\r\n0.00s - Note: Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION=1 to disable this validation.\r\n[I 2023-06-24 13:23:28.203 ServerApp] Connecting to kernel 5bee51ee-b34b-440e-bbdd-d0f8eb4b774f.\r\n[I 2023-06-24 13:23:28.210 ServerApp] Connecting to kernel 5bee51ee-b34b-440e-bbdd-d0f8eb4b774f.\r\n[I 2023-06-24 13:23:28.219 ServerApp] Connecting to kernel 5bee51ee-b34b-440e-bbdd-d0f8eb4b774f.\r\n[I 2023-06-24 13:25:27.173 ServerApp] Saving file at /markdown_test.ipynb\r\n[I 2023-06-24 13:31:08.924 ServerApp] Interrupted...\r\n[IPKernelApp] WARNING | Parent appears to have exited, shutting down.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 1829,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/cells/src/widget.ts",
      "packages/cells/test/widget.spec.ts",
      "packages/testing/src/jest-shim.ts"
    ],
    "pr_changed_test_files": [
      "packages/cells/test/widget.spec.ts",
      "packages/testing/src/jest-shim.ts"
    ],
    "base_commit": "53cdf835ea595149afd2468f2f6b9c33fcde0347",
    "head_commit": "fa85c9e3b270b641663d22a98a797733825bdfa9",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15794",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15794",
    "dockerfile": "",
    "pr_merged_at": "2024-02-16T18:24:17.000Z",
    "patch": "diff --git a/packages/cells/src/widget.ts b/packages/cells/src/widget.ts\nindex 0ed6753f7047..1f638bbd635d 100644\n--- a/packages/cells/src/widget.ts\n+++ b/packages/cells/src/widget.ts\n@@ -1776,7 +1776,9 @@ export abstract class AttachmentsCell<\n             continue;\n           }\n           items[i].getAsString(text => {\n-            this.editor!.replaceSelection?.(text);\n+            this.editor!.replaceSelection?.(\n+              text.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n')\n+            );\n           });\n         }\n         this._attachFiles(event.clipboardData.items);\n",
    "test_patch": "diff --git a/packages/cells/test/widget.spec.ts b/packages/cells/test/widget.spec.ts\nindex 3aab72411e9e..d00cbbe79fa4 100644\n--- a/packages/cells/test/widget.spec.ts\n+++ b/packages/cells/test/widget.spec.ts\n@@ -1,7 +1,7 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n-import { createStandaloneCell, YCodeCell } from '@jupyter/ydoc';\n+import { createStandaloneCell, YCodeCell, YMarkdownCell } from '@jupyter/ydoc';\n import { ISessionContext, SessionContext } from '@jupyterlab/apputils';\n import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';\n import {\n@@ -998,6 +998,33 @@ describe('cells/widget', () => {\n       });\n     });\n \n+    describe('#getEditorOptions()', () => {\n+      it('should normalise line endings on paste', () => {\n+        const model = new MarkdownCellModel({\n+          sharedModel: createStandaloneCell({\n+            cell_type: 'markdown'\n+          }) as YMarkdownCell\n+        });\n+        const widget = new MarkdownCell({\n+          model,\n+          rendermime,\n+          contentFactory,\n+          placeholder: false\n+        });\n+        widget.initializeState();\n+        document.body.appendChild(widget.node);\n+        // todo: replace with user-event\n+        const dt = new DataTransfer();\n+        dt.setData('text/plain', '\\r\\nTest\\r\\nString\\r\\n.\\r\\n');\n+        const event = new ClipboardEvent('paste', { clipboardData: dt });\n+        widget.editor!.host.querySelector('.cm-content')!.dispatchEvent(event);\n+\n+        expect(widget.model.sharedModel.getSource()).toEqual(\n+          '\\nTest\\nString\\n.\\n'\n+        );\n+      });\n+    });\n+\n     describe('#rendered', () => {\n       it('should default to true', async () => {\n         const widget = new MarkdownCell({\n\ndiff --git a/packages/testing/src/jest-shim.ts b/packages/testing/src/jest-shim.ts\nindex fbcacc5c6bcd..e11cb703d626 100644\n--- a/packages/testing/src/jest-shim.ts\n+++ b/packages/testing/src/jest-shim.ts\n@@ -85,6 +85,75 @@ class ResizeObserverMock {\n \n window.ResizeObserver = ResizeObserverMock;\n \n+// https://github.com/jsdom/jsdom/issues/2913\n+class DataTransferItemMock implements DataTransferItem {\n+  constructor(\n+    protected format: string,\n+    protected value: string\n+  ) {\n+    // no-op\n+  }\n+  get kind() {\n+    return 'string';\n+  }\n+  get type() {\n+    return this.format;\n+  }\n+  getAsString(callback: (v: string) => undefined): undefined {\n+    callback(this.value);\n+  }\n+  getAsFile() {\n+    return null as any;\n+  }\n+  webkitGetAsEntry() {\n+    return null as any;\n+  }\n+}\n+\n+// https://github.com/jsdom/jsdom/issues/2913\n+class DataTransferMock implements DataTransfer {\n+  dropEffect: DataTransfer['dropEffect'] = 'none';\n+  effectAllowed: DataTransfer['dropEffect'] = 'none';\n+  files: DataTransfer['files'];\n+  get items(): DataTransfer['items'] {\n+    return [\n+      ...Object.entries(this._data).map(\n+        ([k, v]) => new DataTransferItemMock(k, v)\n+      )\n+    ] as unknown as DataTransferItemList;\n+  }\n+  readonly types: DataTransfer['types'] = [];\n+  getData(format: string) {\n+    return this._data[format];\n+  }\n+  setData(format: string, data: string) {\n+    this._data[format] = data;\n+  }\n+  clearData() {\n+    this._data = {};\n+  }\n+  setDragImage(imgElement: Element, xOffset: number, yOffset: number) {\n+    // no-op\n+  }\n+  private _data: Record<string, string> = {};\n+}\n+\n+window.DataTransfer = DataTransferMock;\n+\n+// https://github.com/jsdom/jsdom/issues/1568\n+class ClipboardEventMock extends Event implements ClipboardEvent {\n+  constructor(\n+    type: 'copy' | 'cut' | 'paste',\n+    options: { clipboardData: DataTransfer }\n+  ) {\n+    super(type);\n+    this.clipboardData = options.clipboardData;\n+  }\n+  clipboardData: DataTransfer;\n+}\n+\n+window.ClipboardEvent = ClipboardEventMock;\n+\n (window as any).document.elementFromPoint = (left: number, top: number) =>\n   document.body;\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15782",
    "pr_id": 15782,
    "issue_id": 15777,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Can't drag and drop cells out of viewport\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nIn lab3, it was possible to drag and drop a cell out of the initial viewport because the viewport would scroll. This doesn't happen in lab4. Here's a gif showing the differences in behavior - \r\n![Drap-n-drop](https://github.com/jupyterlab/jupyterlab/assets/30082866/dedd282b-7401-492f-8e27-265d8cb13219)\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\nshown in gif\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\nI expect the behavior in lab4 to be the same as lab3\r\n<!--Describe what you expected to happen-->\r\n\r\n## Context\r\n\r\n- JupyterLab v4.1.0rc1",
    "issue_word_count": 156,
    "test_files_count": 3,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts",
      "galata/test/jupyterlab/notebook-scroll.test.ts",
      "galata/test/jupyterlab/utils.ts",
      "packages/notebook/src/widget.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts",
      "galata/test/jupyterlab/notebook-scroll.test.ts",
      "galata/test/jupyterlab/utils.ts"
    ],
    "base_commit": "49f6ec28b738243a53a947d544bebafafcbd4a73",
    "head_commit": "1dd374531b108508a9ab69104eee5cfebeb1c43c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15782",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15782",
    "dockerfile": "",
    "pr_merged_at": "2024-02-15T12:41:34.000Z",
    "patch": "diff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex 01280e7ae282..ccb0a83bc29c 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -1334,7 +1334,7 @@ export class Notebook extends StaticNotebook {\n       ...options\n     });\n     // Allow the node to scroll while dragging items.\n-    this.node.setAttribute('data-lm-dragscroll', 'true');\n+    this.outerNode.setAttribute('data-lm-dragscroll', 'true');\n     this.activeCellChanged.connect(this._updateSelectedCells, this);\n     this.jumped.connect((_, index: number) => (this.activeCellIndex = index));\n     this.selectionChanged.connect(this._updateSelectedCells, this);\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts b/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts\nindex d1c504f3c1e9..cb3a18fce136 100644\n--- a/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts\n+++ b/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts\n@@ -5,6 +5,7 @@ import { expect, galata, test } from '@jupyterlab/galata';\n import * as path from 'path';\n \n import {\n+  dragCellTo,\n   notebookViewportRatio,\n   positionCellPartiallyBelowViewport\n } from './utils';\n@@ -62,6 +63,106 @@ test.describe('Notebook scroll on navigation (no windowing)', () => {\n   }\n });\n \n+test.describe('Notebook scroll on dragging cells (no windowing)', () => {\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${fileName}`),\n+      `${tmpPath}/${fileName}`\n+    );\n+\n+    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n+    await page.notebook.activate(fileName);\n+  });\n+  const NOTEBOOK_SCROLLER = '.jp-WindowedPanel-outer';\n+  const NOTEBOOK_CONTENT = '.jp-WindowedPanel-inner';\n+  const EDGE_MARGIN = 10;\n+\n+  test.afterEach(async ({ page, tmpPath }) => {\n+    await page.contents.deleteDirectory(tmpPath);\n+  });\n+\n+  test('Scroll down on dragging cell to the bottom edge', async ({ page }) => {\n+    const firstCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"0\"]'\n+    );\n+    const lastCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"19\"]'\n+    );\n+    const scroller = page.locator(NOTEBOOK_SCROLLER);\n+    await firstCellLocator.scrollIntoViewIfNeeded();\n+\n+    const scrollerBBox = await scroller.boundingBox();\n+    const notebookContentHeight = (\n+      await page.locator(NOTEBOOK_CONTENT).boundingBox()\n+    ).height;\n+\n+    // Ensure the notebook is scrolled correctly and last cell is not visible\n+    const before = await scroller.evaluate(node => node.scrollTop);\n+    expect(before).toBe(0);\n+    await expect(lastCellLocator).not.toBeInViewport();\n+\n+    // Emulate drag and drop\n+    await dragCellTo(page, {\n+      cell: firstCellLocator,\n+      x: scrollerBBox.x + 0.5 * scrollerBBox.width,\n+      y: scrollerBBox.y + scrollerBBox.height - EDGE_MARGIN,\n+      stopCondition: async () => {\n+        const scrollTop = await scroller.evaluate(node => node.scrollTop);\n+        return scrollTop >= notebookContentHeight - 100;\n+      }\n+    });\n+\n+    // The notebook should have scrolled down and the last cell should be visible\n+    const after = await scroller.evaluate(node => node.scrollTop);\n+    expect(after).toBeGreaterThan(before);\n+    await expect(lastCellLocator).toBeInViewport();\n+  });\n+\n+  test('Scroll up on dragging cell to the top edge', async ({ page }) => {\n+    const firstCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"0\"]'\n+    );\n+    const lastCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"19\"]'\n+    );\n+\n+    const scroller = page.locator(NOTEBOOK_SCROLLER);\n+    const scrollerBBox = await scroller.boundingBox();\n+    const notebookContentHeight = (\n+      await page.locator(NOTEBOOK_CONTENT).boundingBox()\n+    ).height;\n+\n+    // Scroll notebook to the bottom, leaving top 200px visible\n+    await page.mouse.move(\n+      scrollerBBox.x + 0.5 * scrollerBBox.width,\n+      scrollerBBox.y + 0.5 * scrollerBBox.height\n+    );\n+    await page.mouse.wheel(0, notebookContentHeight - 200);\n+    await lastCellLocator.scrollIntoViewIfNeeded();\n+\n+    // Ensure the notebook is scrolled correctly and first cell is not visible\n+    const before = await scroller.evaluate(node => node.scrollTop);\n+    expect(before).toBeGreaterThan(notebookContentHeight * 0.75);\n+    await expect(firstCellLocator).not.toBeInViewport();\n+\n+    // Emulate drag and drop\n+    await dragCellTo(page, {\n+      cell: lastCellLocator,\n+      x: scrollerBBox.x + 0.5 * scrollerBBox.width,\n+      y: scrollerBBox.y + EDGE_MARGIN,\n+      stopCondition: async () => {\n+        const scrollTop = await scroller.evaluate(node => node.scrollTop);\n+        return scrollTop <= 50;\n+      }\n+    });\n+\n+    // The notebook should have scrolled up and the first cell should be visible\n+    const after = await scroller.evaluate(node => node.scrollTop);\n+    expect(after).toBeLessThan(before);\n+    await expect(firstCellLocator).toBeInViewport();\n+  });\n+});\n+\n test.describe('Notebook scroll on execution (no windowing)', () => {\n   test.beforeEach(async ({ page, tmpPath }) => {\n     await page.contents.uploadFile(\n\ndiff --git a/galata/test/jupyterlab/notebook-scroll.test.ts b/galata/test/jupyterlab/notebook-scroll.test.ts\nindex 61fb55b815d2..d50d835e6970 100644\n--- a/galata/test/jupyterlab/notebook-scroll.test.ts\n+++ b/galata/test/jupyterlab/notebook-scroll.test.ts\n@@ -5,6 +5,7 @@ import { expect, galata, test } from '@jupyterlab/galata';\n import * as path from 'path';\n \n import {\n+  dragCellTo,\n   notebookViewportRatio,\n   positionCellPartiallyBelowViewport\n } from './utils';\n@@ -62,6 +63,106 @@ test.describe('Notebook scroll on navigation (with windowing)', () => {\n   }\n });\n \n+test.describe('Notebook scroll on dragging cells (with windowing)', () => {\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${fileName}`),\n+      `${tmpPath}/${fileName}`\n+    );\n+\n+    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n+    await page.notebook.activate(fileName);\n+  });\n+  const NOTEBOOK_SCROLLER = '.jp-WindowedPanel-outer';\n+  const NOTEBOOK_CONTENT = '.jp-WindowedPanel-inner';\n+  const EDGE_MARGIN = 10;\n+\n+  test.afterEach(async ({ page, tmpPath }) => {\n+    await page.contents.deleteDirectory(tmpPath);\n+  });\n+\n+  test('Scroll down on dragging cell to the bottom edge', async ({ page }) => {\n+    const firstCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"0\"]'\n+    );\n+    const lastCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"19\"]'\n+    );\n+    const scroller = page.locator(NOTEBOOK_SCROLLER);\n+    await firstCellLocator.scrollIntoViewIfNeeded();\n+\n+    const scrollerBBox = await scroller.boundingBox();\n+    const notebookContentHeight = (\n+      await page.locator(NOTEBOOK_CONTENT).boundingBox()\n+    ).height;\n+\n+    // Ensure the notebook is scrolled correctly and last cell is not visible\n+    const before = await scroller.evaluate(node => node.scrollTop);\n+    expect(before).toBe(0);\n+    await expect(lastCellLocator).not.toBeInViewport();\n+\n+    // Emulate drag and drop\n+    await dragCellTo(page, {\n+      cell: firstCellLocator,\n+      x: scrollerBBox.x + 0.5 * scrollerBBox.width,\n+      y: scrollerBBox.y + scrollerBBox.height - EDGE_MARGIN,\n+      stopCondition: async () => {\n+        const scrollTop = await scroller.evaluate(node => node.scrollTop);\n+        return scrollTop >= notebookContentHeight - 100;\n+      }\n+    });\n+\n+    // The notebook should have scrolled down and the last cell should be visible\n+    const after = await scroller.evaluate(node => node.scrollTop);\n+    expect(after).toBeGreaterThan(before);\n+    await expect(lastCellLocator).toBeInViewport();\n+  });\n+\n+  test('Scroll up on dragging cell to the top edge', async ({ page }) => {\n+    const firstCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"0\"]'\n+    );\n+    const lastCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"19\"]'\n+    );\n+\n+    const scroller = page.locator(NOTEBOOK_SCROLLER);\n+    const scrollerBBox = await scroller.boundingBox();\n+    const notebookContentHeight = (\n+      await page.locator(NOTEBOOK_CONTENT).boundingBox()\n+    ).height;\n+\n+    // Scroll notebook to the bottom, leaving top 200px visible\n+    await page.mouse.move(\n+      scrollerBBox.x + 0.5 * scrollerBBox.width,\n+      scrollerBBox.y + 0.5 * scrollerBBox.height\n+    );\n+    await page.mouse.wheel(0, notebookContentHeight - 200);\n+    await lastCellLocator.scrollIntoViewIfNeeded();\n+\n+    // Ensure the notebook is scrolled correctly and first cell is not visible\n+    const before = await scroller.evaluate(node => node.scrollTop);\n+    expect(before).toBeGreaterThan(notebookContentHeight * 0.75);\n+    await expect(firstCellLocator).not.toBeInViewport();\n+\n+    // Emulate drag and drop\n+    await dragCellTo(page, {\n+      cell: lastCellLocator,\n+      x: scrollerBBox.x + 0.5 * scrollerBBox.width,\n+      y: scrollerBBox.y + EDGE_MARGIN,\n+      stopCondition: async () => {\n+        const scrollTop = await scroller.evaluate(node => node.scrollTop);\n+        return scrollTop <= 50;\n+      }\n+    });\n+\n+    // The notebook should have scrolled up and the first cell should be visible\n+    const after = await scroller.evaluate(node => node.scrollTop);\n+    expect(after).toBeLessThan(before);\n+    await expect(firstCellLocator).toBeInViewport();\n+  });\n+});\n+\n test.describe('Notebook scroll on execution (with windowing)', () => {\n   test.beforeEach(async ({ page, tmpPath }) => {\n     await page.contents.uploadFile(\n\ndiff --git a/galata/test/jupyterlab/utils.ts b/galata/test/jupyterlab/utils.ts\nindex 1fb2568a5816..964261a2abad 100644\n--- a/galata/test/jupyterlab/utils.ts\n+++ b/galata/test/jupyterlab/utils.ts\n@@ -1,9 +1,10 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n import { IJupyterLabPageFixture } from '@jupyterlab/galata';\n-import { ElementHandle } from '@playwright/test';\n+import { ElementHandle, Locator } from '@playwright/test';\n \n const OUTER_SELECTOR = '.jp-WindowedPanel-outer';\n+const DRAGGABLE_AREA = '.jp-InputArea-prompt';\n \n /**\n  * Measure how much of the **notebook** viewport does a cell take up.\n@@ -49,3 +50,30 @@ export async function positionCellPartiallyBelowViewport(\n     cellBbox.y - notebookBbox.y - notebookBbox.height + cellBbox.height * ratio;\n   await page.mouse.wheel(0, scrollOffset);\n }\n+\n+/**\n+ * Drag a cell to a given position, and wait until specified condition is met.\n+ */\n+export async function dragCellTo(\n+  page: IJupyterLabPageFixture,\n+  options: {\n+    cell: Locator;\n+    x: number;\n+    y: number;\n+    stopCondition: () => Promise<boolean>;\n+  }\n+) {\n+  const dragHandle = options.cell.locator(DRAGGABLE_AREA);\n+  const handleBBox = await dragHandle.boundingBox();\n+\n+  // Emulate drag and drop\n+  await dragHandle.click();\n+  await page.mouse.move(\n+    handleBBox.x + 0.5 * handleBBox.width,\n+    handleBBox.y + 0.5 * handleBBox.height\n+  );\n+  await page.mouse.down();\n+  await page.mouse.move(options.x, options.y);\n+  await page.waitForCondition(options.stopCondition);\n+  await page.mouse.up();\n+}\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15779",
    "pr_id": 15779,
    "issue_id": 15772,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Editing the console history does nothing\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nWe noticed that lab4 allows editing the console command history but it does nothing afterwards. Here's a gif - \r\n\r\n![editing-console-history](https://github.com/jupyterlab/jupyterlab/assets/30082866/2b37cf26-84e3-4aa5-be4c-0fa7a5774103)\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- JupyterLab v4.1.0rc1\r\n\r\n",
    "issue_word_count": 94,
    "test_files_count": 2,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/console.test.ts",
      "packages/codemirror/style/base.css",
      "packages/console/src/widget.ts",
      "packages/console/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/console.test.ts",
      "packages/console/test/widget.spec.ts"
    ],
    "base_commit": "3cc707cff2571b47afa0d242c6c68f0c11452958",
    "head_commit": "6424924c732379a220f28ddad40725e81392c9c3",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15779",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15779",
    "dockerfile": "",
    "pr_merged_at": "2024-02-12T13:02:10.000Z",
    "patch": "diff --git a/packages/codemirror/style/base.css b/packages/codemirror/style/base.css\nindex d3cf35f6fb93..f81fae3f9499 100644\n--- a/packages/codemirror/style/base.css\n+++ b/packages/codemirror/style/base.css\n@@ -43,10 +43,15 @@\n   }\n }\n \n-.cm-editor.jp-mod-readOnly .cm-cursor {\n+/* stylelint-disable selector-max-class */\n+\n+/* We need all this classes for higher specificity to override CodeMirror's rule */\n+.cm-editor.jp-mod-readOnly > .cm-scroller > .cm-cursorLayer .cm-cursor {\n   display: none;\n }\n \n+/* stylelint-enable selector-max-class */\n+\n .jp-CollaboratorCursor {\n   border-left: 5px solid transparent;\n   border-right: 5px solid transparent;\n\ndiff --git a/packages/console/src/widget.ts b/packages/console/src/widget.ts\nindex b3fdb0c8677d..bb4a858282b5 100644\n--- a/packages/console/src/widget.ts\n+++ b/packages/console/src/widget.ts\n@@ -604,7 +604,16 @@ export class CodeConsole extends Widget {\n     if (promptCell) {\n       promptCell.readOnly = true;\n       promptCell.removeClass(PROMPT_CLASS);\n-      Signal.clearData(promptCell.editor);\n+\n+      // Schedule execution of signal clearance to happen later so that\n+      // the `readOnly` configuration gets updated before editor signals\n+      // get disconnected (see `Cell.onUpdateRequest`).\n+      const oldCell = promptCell;\n+      requestIdleCallback(() => {\n+        // Clear the signals to avoid memory leaks\n+        Signal.clearData(oldCell.editor);\n+      });\n+\n       // Ensure to clear the cursor\n       promptCell.editor?.blur();\n       const child = input.widgets[0];\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/console.test.ts b/galata/test/jupyterlab/console.test.ts\nnew file mode 100644\nindex 000000000000..6a12e9663637\n--- /dev/null\n+++ b/galata/test/jupyterlab/console.test.ts\n@@ -0,0 +1,44 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { expect, test } from '@jupyterlab/galata';\n+\n+const CELL_EDITOR_SELECTOR = '.jp-InputArea-editor';\n+const CODE_MIRROR_CURSOR = '.cm-cursor';\n+\n+test.describe('Console', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.menu.clickMenuItem('File>New>Console');\n+\n+    await page.click('button:has-text(\"Select\")');\n+\n+    await page.locator('[aria-label=\"Code Cell Content\"]').waitFor();\n+    await page.locator('text=| Idle').waitFor();\n+  });\n+\n+  test('Executed cells should become read-only', async ({ page }) => {\n+    await page.keyboard.type('2 + 2');\n+    await page.keyboard.press('Shift+Enter');\n+\n+    const executedCell = page.locator(\n+      '[aria-label=\"Code Cell Content with Output\"]'\n+    );\n+    await executedCell.waitFor();\n+\n+    const cellEditor = executedCell.locator(CELL_EDITOR_SELECTOR);\n+    expect(await cellEditor.innerText()).toBe('2 + 2');\n+\n+    // Focus the editor\n+    await cellEditor.click();\n+\n+    // Should not display the cursor\n+    const cursor = cellEditor.locator(CODE_MIRROR_CURSOR);\n+    await expect.soft(cursor).toBeHidden();\n+\n+    // Try to type something into the editor\n+    await cellEditor.type('more text');\n+\n+    // Expect the editor content to not change\n+    expect(await cellEditor.innerText()).toBe('2 + 2');\n+  });\n+});\n\ndiff --git a/packages/console/test/widget.spec.ts b/packages/console/test/widget.spec.ts\nindex 9d84b82d4e41..000d634ba615 100644\n--- a/packages/console/test/widget.spec.ts\n+++ b/packages/console/test/widget.spec.ts\n@@ -280,6 +280,19 @@ describe('console/widget', () => {\n           expect.arrayContaining(['newPromptCell'])\n         );\n       });\n+\n+      it('should make previous cell read-only after execution', async () => {\n+        Widget.attach(widget, document.body);\n+\n+        const old = widget.promptCell;\n+        const force = true;\n+        expect(old).toBeInstanceOf(CodeCell);\n+\n+        await (widget.sessionContext as SessionContext).initialize();\n+        await widget.execute(force);\n+\n+        expect(old!.editor!.getOption('readOnly')).toBe(true);\n+      });\n     });\n \n     describe('#onActivateRequest()', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15774",
    "pr_id": 15774,
    "issue_id": 15757,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Typing into into fields that are wrapped with shadow DOM is intercepted by commands\n## Description\r\n\r\nTyping most characters into fields wrapped in shadow DOM, such as widgets generated by panel, is impossible because command shortcuts intercept the keystrokes.\r\n\r\n## Reproduce\r\n\r\nSee https://github.com/holoviz/panel/issues/6314, but briefly:\r\n\r\n```python\r\nimport panel as pn\r\npn.extension()\r\ntext_input = pn.widgets.TextInput(name='Text Input', placeholder='Enter a string starting with \"A\" or \"B\" here...')\r\ntext_input\r\n```\r\n\r\nand try to type <kbd>A</kbd>, <kbd>C</kbd>, <kbd>X</kbd>, etc.\r\n\r\n\r\nDependency-free reproducer:\r\n\r\n```python\r\nfrom IPython.display import HTML\r\nHTML(\"\"\"\r\n<div id='shadow-test'></div>\r\n<script>\r\n{\r\nconst shadowHost = document.querySelector('#shadow-test');\r\nconst shadowRoot = shadowHost.attachShadow({mode: 'open'});\r\nshadowRoot.innerHTML = '<input/>';\r\n}\r\n</script>\r\n\"\"\")\r\n```\r\n\r\nNote: iframes work as they also isolate keystrokes.\r\n\r\n<details>\r\n\r\n```python\r\nfrom IPython.display import HTML\r\nHTML(\"<iframe srcdoc='<input>'></iframe>\")\r\n```\r\n\r\n```python\r\nfrom IPython.display import HTML\r\nHTML(\"<iframe srcdoc='<div><template shadowrootmode=\\\"open\\\"><input></template></div>' />\")\r\n```\r\n\r\n</details>\r\n\r\n## Expected behavior\r\n\r\nTyping works as in 4.0 and earlier.\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.1.0\r\n",
    "issue_word_count": 173,
    "test_files_count": 2,
    "non_test_files_count": 9,
    "pr_changed_files": [
      "docs/source/extension/extension_migration.rst",
      "docs/source/extension/notebook.rst",
      "examples/notebook/src/commands.ts",
      "galata/test/jupyterlab/outputarea-stdin.test.ts",
      "packages/apputils/src/domutils.ts",
      "packages/apputils/test/domutils.spec.ts",
      "packages/console/src/widget.ts",
      "packages/mainmenu-extension/schema/plugin.json",
      "packages/notebook-extension/schema/tracker.json",
      "packages/notebook/src/widget.ts",
      "packages/settingregistry/src/settingregistry.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/outputarea-stdin.test.ts",
      "packages/apputils/test/domutils.spec.ts"
    ],
    "base_commit": "3cc707cff2571b47afa0d242c6c68f0c11452958",
    "head_commit": "c048e6f53600f305833c780c38258050e3436717",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15774",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15774",
    "dockerfile": "",
    "pr_merged_at": "2024-02-16T08:56:30.000Z",
    "patch": "diff --git a/docs/source/extension/extension_migration.rst b/docs/source/extension/extension_migration.rst\nindex 2fe116240807..4fd847a0d49f 100644\n--- a/docs/source/extension/extension_migration.rst\n+++ b/docs/source/extension/extension_migration.rst\n@@ -89,10 +89,12 @@ between cells, especially impacting users with accessibility needs.\n In JupyterLab 4.1+ the focus stays on the active cell when switching to command\n mode; this requires all shortcut selectors to be adjusted as follows:\n \n-- ``.jp-Notebook:focus.jp-mod-commandMode`` should be replaced with ``.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)``\n-- ``.jp-Notebook:focus`` should be replaced with ``.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)``\n-- ``[data-jp-traversable]:focus`` should be replaced with ``.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)``\n-- ``[data-jp-kernel-user]:focus`` should be replaced with ``[data-jp-kernel-user] :focus:not(:read-write)``\n+- ``.jp-Notebook:focus.jp-mod-commandMode``, ``.jp-Notebook:focus``, and ``[data-jp-traversable]:focus`` should be replaced with:\n+  - ``.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)`` for JupyterLab 4.1.0+\n+  - ``.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus`` for JupyterLab 4.1.1+\n+- ``[data-jp-kernel-user]:focus`` should be replaced with:\n+  - ``[data-jp-kernel-user] :focus:not(:read-write)`` for JupyterLab 4.1.0+\n+  - ``[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)`` for JupyterLab 4.1.1+\n \n Please note that ``:not(:read-write)`` fragment disables shortcuts\n when text fields  (such as cell editor) are focused to avoid intercepting\n@@ -101,6 +103,17 @@ does not correspond to any key/typographic character (e.g. most shortcuts\n with :kbd:`Ctrl` modifier) you may prefer to drop this fragment\n if you want the shortcut to be active in text fields.\n \n+Further, JupyterLab 4.1.1 introduced indicator class ``.jp-mod-readWrite``\n+that is applied to the notebook node when the active element accepts\n+keyboard input as defined by ``:read-write`` selector. This indicator\n+class is required to detect ``:read-write`` elements which are nested\n+within an *open* shadow DOM (such as Panel framework widgets).\n+\n+If your framework uses a *closed* shadow DOM, or expects keyboard\n+interactions on elements that are not recognised as editable by browser\n+heuristics of ``:read-write`` selector, you need to set a data attribute\n+`lm-suppress-shortcuts` on the outer host element to suppress shortcuts.\n+\n To prevent breaking the user experience these changes are made transparently\n in the background, but will emit a warning and extension developers should\n make the change at the source before the next major JupyterLab release.\n\ndiff --git a/docs/source/extension/notebook.rst b/docs/source/extension/notebook.rst\nindex 67a3ad9d7738..7ae49ccccbc9 100644\n--- a/docs/source/extension/notebook.rst\n+++ b/docs/source/extension/notebook.rst\n@@ -175,6 +175,43 @@ The ipywidgets widget manager is an example of an extension that adds a\n notebook-specific renderer, since rendering a widget depends on\n notebook-specific widget state.\n \n+Keyboard interaction model\n+\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\n+\n+Multiple elements can receive focus in the Notebook:\n+- the main toolbar,\n+- cells,\n+- cell components (editor, toolbar, outputs).\n+\n+When the focus is outside of the cell input editor,\n+the Notebook switches to so-called \"command\" mode.\n+In the command mode additional keyboard shortcuts are accessible to the user,\n+enabling quick access to cell- and notebook-specific actions.\n+These shortcuts are only active when the notebook is in command mode\n+and the active element is non-editable,\n+as signalled by absence of ``.jp-mod-readWrite`` class on the notebook node.\n+This class is set if the active element is editable as ascertained by matching\n+to the ``:read-write`` pseudo-selector, and accounts for any elements nested\n+in the open shadow DOM, but not for the closed shadow DOM nor non-editable\n+elements with custom key event handlers (such as\n+``<div contenteditable=\"false\" onkeydown=\"alert()\" tabindex=\"0\"></div>``).\n+If your output widget (for example created with ``IPython.display.HTML``,\n+or created by your MIME renderer on cell output in a notebook or console)\n+uses closed shadow DOM or non-editable elements with custom\n+key event handlers, you may wish to set ``lm-suppress-shortcuts`` data attribute\n+on the host element to prevent side-effects from the command-mode actions, e.g:\n+\n+.. code:: html\n+\n+   <div\n+     contenteditable=\"false\"\n+     onkeydown=\"alert()\"\n+     tabindex=\"1\"\n+     data-lm-suppress-shortcuts=\"true\"\n+   >\n+     Click on me and press \"A\" with and without \"lm-suppress-shortcuts\"\n+   </div>\n+\n .. _extend-notebook-plugin:\n \n How to extend the Notebook plugin\n\ndiff --git a/examples/notebook/src/commands.ts b/examples/notebook/src/commands.ts\nindex f55a4ad6daf1..63c2223a86b6 100644\n--- a/examples/notebook/src/commands.ts\n+++ b/examples/notebook/src/commands.ts\n@@ -396,17 +396,17 @@ export const setupCommands = (\n       command: COMMAND_IDS.findPrevious\n     },\n     {\n-      selector: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['I', 'I'],\n       command: COMMAND_IDS.interrupt\n     },\n     {\n-      selector: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['0', '0'],\n       command: COMMAND_IDS.restart\n     },\n     {\n-      selector: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['Enter'],\n       command: COMMAND_IDS.editMode\n     },\n@@ -416,7 +416,7 @@ export const setupCommands = (\n       command: COMMAND_IDS.commandMode\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['Shift M'],\n       command: COMMAND_IDS.merge\n     },\n@@ -426,42 +426,42 @@ export const setupCommands = (\n       command: COMMAND_IDS.split\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['J'],\n       command: COMMAND_IDS.selectBelow\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['ArrowDown'],\n       command: COMMAND_IDS.selectBelow\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['K'],\n       command: COMMAND_IDS.selectAbove\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['ArrowUp'],\n       command: COMMAND_IDS.selectAbove\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['Shift K'],\n       command: COMMAND_IDS.extendAbove\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['Shift J'],\n       command: COMMAND_IDS.extendBelow\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['Z'],\n       command: COMMAND_IDS.undo\n     },\n     {\n-      selector: 'jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n       keys: ['Y'],\n       command: COMMAND_IDS.redo\n     }\n\ndiff --git a/packages/apputils/src/domutils.ts b/packages/apputils/src/domutils.ts\nindex 39d03b810559..3501789c7b61 100644\n--- a/packages/apputils/src/domutils.ts\n+++ b/packages/apputils/src/domutils.ts\n@@ -50,4 +50,22 @@ export namespace DOMUtils {\n   export function createDomID(): string {\n     return `id-${UUID.uuid4()}`;\n   }\n+\n+  /**\n+   * Check whether the active element descendant from given parent is editable.\n+   * When checking active elements it includes elements in the open shadow DOM.\n+   */\n+  export function hasActiveEditableElement(\n+    parent: Node | DocumentFragment,\n+    root: ShadowRoot | Document = document\n+  ): boolean {\n+    const element = root.activeElement;\n+    return !!(\n+      element &&\n+      parent.contains(element) &&\n+      (element.matches(':read-write') ||\n+        (element.shadowRoot &&\n+          hasActiveEditableElement(element.shadowRoot, element.shadowRoot)))\n+    );\n+  }\n }\n\ndiff --git a/packages/console/src/widget.ts b/packages/console/src/widget.ts\nindex b3fdb0c8677d..2b81e1892582 100644\n--- a/packages/console/src/widget.ts\n+++ b/packages/console/src/widget.ts\n@@ -4,7 +4,7 @@\n import { Prec } from '@codemirror/state';\n import { EditorView } from '@codemirror/view';\n import { createStandaloneCell, ISharedRawCell } from '@jupyter/ydoc';\n-import { ISessionContext } from '@jupyterlab/apputils';\n+import { DOMUtils, ISessionContext } from '@jupyterlab/apputils';\n import {\n   AttachmentsCellModel,\n   Cell,\n@@ -70,6 +70,14 @@ const CONTENT_CLASS = 'jp-CodeConsole-content';\n  */\n const INPUT_CLASS = 'jp-CodeConsole-input';\n \n+/**\n+ * The class name added to the console when an element within it is focused\n+ * and takes keyboard input, such as <input> and <div contenteditable>\n+ *\n+ * This class is also effective when the focused element is in shadow DOM.\n+ */\n+const READ_WRITE_CLASS = 'jp-mod-readWrite';\n+\n /**\n  * The timeout in ms for execution requests to the kernel.\n  */\n@@ -551,6 +559,12 @@ export class CodeConsole extends Widget {\n       case 'mouseup':\n         this._evtMouseUp(event as MouseEvent);\n         break;\n+      case 'focusin':\n+        this._evtFocusIn(event as MouseEvent);\n+        break;\n+      case 'focusout':\n+        this._evtFocusOut(event as MouseEvent);\n+        break;\n       default:\n         break;\n     }\n@@ -564,6 +578,8 @@ export class CodeConsole extends Widget {\n     node.addEventListener('keydown', this, true);\n     node.addEventListener('click', this);\n     node.addEventListener('mousedown', this);\n+    node.addEventListener('focusin', this);\n+    node.addEventListener('focusout', this);\n     // Create a prompt if necessary.\n     if (!this.promptCell) {\n       this.newPromptCell();\n@@ -580,6 +596,8 @@ export class CodeConsole extends Widget {\n     const node = this.node;\n     node.removeEventListener('keydown', this, true);\n     node.removeEventListener('click', this);\n+    node.removeEventListener('focusin', this);\n+    node.removeEventListener('focusout', this);\n   }\n \n   /**\n@@ -664,6 +682,22 @@ export class CodeConsole extends Widget {\n     }\n   }\n \n+  /**\n+   * Handle `focus` events for the widget.\n+   */\n+  private _evtFocusIn(event: FocusEvent): void {\n+    // Update read-write class state.\n+    this._updateReadWrite();\n+  }\n+\n+  /**\n+   * Handle `focusout` events for the widget.\n+   */\n+  private _evtFocusOut(event: FocusEvent): void {\n+    // Update read-write class state.\n+    this._updateReadWrite();\n+  }\n+\n   /**\n    * Execute the code in the current prompt cell.\n    */\n@@ -846,6 +880,15 @@ export class CodeConsole extends Widget {\n     }\n   }\n \n+  /**\n+   * Update the console node with class indicating read-write state.\n+   */\n+  private _updateReadWrite(): void {\n+    // TODO: de-duplicate with code in notebook/src/widget.ts\n+    const inReadWrite = DOMUtils.hasActiveEditableElement(this.node);\n+    this.node.classList.toggle(READ_WRITE_CLASS, inReadWrite);\n+  }\n+\n   private _banner: RawCell | null = null;\n   private _cells: IObservableList<Cell>;\n   private _content: Panel;\n\ndiff --git a/packages/mainmenu-extension/schema/plugin.json b/packages/mainmenu-extension/schema/plugin.json\nindex 54fee0640a26..c09fa2b5285c 100644\n--- a/packages/mainmenu-extension/schema/plugin.json\n+++ b/packages/mainmenu-extension/schema/plugin.json\n@@ -270,22 +270,22 @@\n     {\n       \"command\": \"kernelmenu:interrupt\",\n       \"keys\": [\"I\", \"I\"],\n-      \"selector\": \"[data-jp-kernel-user] :focus:not(:read-write)\"\n+      \"selector\": \"[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)\"\n     },\n     {\n       \"command\": \"kernelmenu:restart\",\n       \"keys\": [\"0\", \"0\"],\n-      \"selector\": \"[data-jp-kernel-user] :focus:not(:read-write)\"\n+      \"selector\": \"[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)\"\n     },\n     {\n       \"command\": \"kernelmenu:restart-and-clear\",\n       \"keys\": [\"\"],\n-      \"selector\": \"[data-jp-kernel-user] :focus:not(:read-write)\"\n+      \"selector\": \"[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)\"\n     },\n     {\n       \"command\": \"kernelmenu:shutdown\",\n       \"keys\": [\"\"],\n-      \"selector\": \"[data-jp-kernel-user] :focus:not(:read-write)\"\n+      \"selector\": \"[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)\"\n     },\n     {\n       \"command\": \"runmenu:restart-and-run-all\",\n\ndiff --git a/packages/notebook-extension/schema/tracker.json b/packages/notebook-extension/schema/tracker.json\nindex 728c606f6ee9..151c08e029c0 100644\n--- a/packages/notebook-extension/schema/tracker.json\n+++ b/packages/notebook-extension/schema/tracker.json\n@@ -369,62 +369,62 @@\n     {\n       \"command\": \"notebook:change-cell-to-code\",\n       \"keys\": [\"Y\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-heading-1\",\n       \"keys\": [\"1\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-heading-2\",\n       \"keys\": [\"2\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-heading-3\",\n       \"keys\": [\"3\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-heading-4\",\n       \"keys\": [\"4\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-heading-5\",\n       \"keys\": [\"5\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-heading-6\",\n       \"keys\": [\"6\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-markdown\",\n       \"keys\": [\"M\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:change-cell-to-raw\",\n       \"keys\": [\"R\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:copy-cell\",\n       \"keys\": [\"C\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:cut-cell\",\n       \"keys\": [\"X\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:delete-cell\",\n       \"keys\": [\"D\", \"D\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:enter-command-mode\",\n@@ -454,123 +454,123 @@\n     {\n       \"command\": \"notebook:extend-marked-cells-above\",\n       \"keys\": [\"Shift ArrowUp\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:extend-marked-cells-above\",\n       \"keys\": [\"Shift K\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:extend-marked-cells-top\",\n       \"keys\": [\"Shift Home\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:extend-marked-cells-below\",\n       \"keys\": [\"Shift ArrowDown\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:extend-marked-cells-bottom\",\n       \"keys\": [\"Shift End\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:extend-marked-cells-below\",\n       \"keys\": [\"Shift J\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:insert-cell-above\",\n       \"keys\": [\"A\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:insert-cell-below\",\n       \"keys\": [\"B\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:merge-cells\",\n       \"keys\": [\"Shift M\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:merge-cell-above\",\n       \"keys\": [\"Ctrl Backspace\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:merge-cell-below\",\n       \"keys\": [\"Ctrl Shift M\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cursor-down\",\n       \"keys\": [\"ArrowDown\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cursor-down\",\n       \"keys\": [\"J\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cursor-up\",\n       \"keys\": [\"ArrowUp\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cursor-up\",\n       \"keys\": [\"K\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cursor-heading-above-or-collapse\",\n       \"keys\": [\"ArrowLeft\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cursor-heading-below-or-expand\",\n       \"keys\": [\"ArrowRight\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:insert-heading-above\",\n       \"keys\": [\"Shift A\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:insert-heading-below\",\n       \"keys\": [\"Shift B\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:collapse-all-headings\",\n       \"keys\": [\"Ctrl Shift ArrowLeft\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:expand-all-headings\",\n       \"keys\": [\"Ctrl Shift ArrowRight\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:paste-cell-below\",\n       \"keys\": [\"V\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:redo-cell-action\",\n       \"keys\": [\"Shift Z\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:run-cell\",\n       \"macKeys\": [\"Ctrl Enter\"],\n       \"keys\": [],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:run-cell\",\n@@ -581,7 +581,7 @@\n     {\n       \"command\": \"notebook:run-cell\",\n       \"keys\": [\"Accel Enter\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:run-cell\",\n@@ -591,7 +591,7 @@\n     {\n       \"command\": \"notebook:run-cell-and-insert-below\",\n       \"keys\": [\"Alt Enter\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:run-cell-and-insert-below\",\n@@ -611,7 +611,7 @@\n     {\n       \"command\": \"viewmenu:line-numbering\",\n       \"keys\": [\"Shift L\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"viewmenu:match-brackets\",\n@@ -621,7 +621,7 @@\n     {\n       \"command\": \"notebook:select-all\",\n       \"keys\": [\"Accel A\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:split-cell-at-cursor\",\n@@ -631,22 +631,22 @@\n     {\n       \"command\": \"notebook:undo-cell-action\",\n       \"keys\": [\"Z\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:toggle-render-side-by-side-current\",\n       \"keys\": [\"Shift R\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cell-up\",\n       \"keys\": [\"Ctrl Shift ArrowUp\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     },\n     {\n       \"command\": \"notebook:move-cell-down\",\n       \"keys\": [\"Ctrl Shift ArrowDown\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus\"\n     }\n   ],\n   \"title\": \"Notebook\",\n\ndiff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex 01280e7ae282..146e973c43b8 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -1,6 +1,7 @@\n // Copyright (c) Jupyter Development Team.\n // Distributed under the terms of the Modified BSD License.\n \n+import { DOMUtils } from '@jupyterlab/apputils';\n import {\n   Cell,\n   CodeCell,\n@@ -92,6 +93,14 @@ const OTHER_SELECTED_CLASS = 'jp-mod-multiSelected';\n  */\n const UNCONFINED_CLASS = 'jp-mod-unconfined';\n \n+/**\n+ * The class name added to the notebook when an element within it is focused\n+ * and takes keyboard input, such as focused <input> or <div contenteditable>.\n+ *\n+ * This class is also effective when the focused element is in shadow DOM.\n+ */\n+const READ_WRITE_CLASS = 'jp-mod-readWrite';\n+\n /**\n  * The class name added to drag images.\n  */\n@@ -2771,10 +2780,21 @@ export class Notebook extends StaticNotebook {\n     });\n   }\n \n+  /**\n+   * Update the notebook node with class indicating read-write state.\n+   */\n+  private _updateReadWrite(): void {\n+    const inReadWrite = DOMUtils.hasActiveEditableElement(this.node);\n+    this.node.classList.toggle(READ_WRITE_CLASS, inReadWrite);\n+  }\n+\n   /**\n    * Handle `focus` events for the widget.\n    */\n   private _evtFocusIn(event: FocusEvent): void {\n+    // Update read-write class state.\n+    this._updateReadWrite();\n+\n     const target = event.target as HTMLElement;\n     const index = this._findCell(target);\n     if (index !== -1) {\n@@ -2829,7 +2849,10 @@ export class Notebook extends StaticNotebook {\n   /**\n    * Handle `focusout` events for the notebook.\n    */\n-  private _evtFocusOut(event: MouseEvent): void {\n+  private _evtFocusOut(event: FocusEvent): void {\n+    // Update read-write class state.\n+    this._updateReadWrite();\n+\n     const relatedTarget = event.relatedTarget as HTMLElement;\n \n     // Bail if the window is losing focus, to preserve edit mode. This test\n\ndiff --git a/packages/settingregistry/src/settingregistry.ts b/packages/settingregistry/src/settingregistry.ts\nindex 0e8257e35c84..803ce7567931 100644\n--- a/packages/settingregistry/src/settingregistry.ts\n+++ b/packages/settingregistry/src/settingregistry.ts\n@@ -1538,23 +1538,33 @@ namespace Private {\n     const changes = [\n       {\n         old: '.jp-Notebook:focus.jp-mod-commandMode',\n-        new: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+        new: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n         versionDeprecated: 'JupyterLab 4.1'\n       },\n+      {\n+        old: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+        new: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n+        versionDeprecated: 'JupyterLab 4.1.1'\n+      },\n       {\n         old: '.jp-Notebook:focus',\n-        new: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+        new: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n         versionDeprecated: 'JupyterLab 4.1'\n       },\n       {\n         old: '[data-jp-traversable]:focus',\n-        new: '.jp-Notebook.jp-mod-commandMode :focus:not(:read-write)',\n+        new: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus',\n         versionDeprecated: 'JupyterLab 4.1'\n       },\n       {\n         old: '[data-jp-kernel-user]:focus',\n-        new: '[data-jp-kernel-user] :focus:not(:read-write)',\n+        new: '[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)',\n         versionDeprecated: 'JupyterLab 4.1'\n+      },\n+      {\n+        old: '[data-jp-kernel-user] :focus:not(:read-write)',\n+        new: '[data-jp-kernel-user]:not(.jp-mod-readWrite) :focus:not(:read-write)',\n+        versionDeprecated: 'JupyterLab 4.1.1'\n       }\n     ];\n     const upgraded = shortcuts.map(shortcut => {\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/outputarea-stdin.test.ts b/galata/test/jupyterlab/outputarea-stdin.test.ts\nindex 9eb578c440b2..2fefbf3a8dcd 100644\n--- a/galata/test/jupyterlab/outputarea-stdin.test.ts\n+++ b/galata/test/jupyterlab/outputarea-stdin.test.ts\n@@ -14,6 +14,12 @@ print('before sleep')\n sleep(0.1)\n print('after sleep')`;\n \n+const openShadowDOM = `\\\n+from IPython.display import HTML\n+HTML(\"\"\"<div id='root'></div><script>\n+document.querySelector('#root').attachShadow({mode: 'open'}).innerHTML = '<input id=\"shadow-input\"/>';\n+</script>\"\"\")`;\n+\n const ACTIVE_INPUT =\n   '.jp-OutputArea-stdin-item:not(.jp-OutputArea-stdin-hiding) .jp-Stdin-input';\n \n@@ -67,31 +73,39 @@ test.describe('Stdin for ipdb', () => {\n     await expect(page.locator(ACTIVE_INPUT)).toHaveValue('foofoox');\n   });\n \n-  test('Typing in stdin box', async ({ page }) => {\n-    // Test to ensure that notebook shortcuts do not capture text typed into inputs.\n-    // This may not be sufficient to ensure no conflicts with other languages but\n-    // should catch the most severe issues.\n-    const alphabet = 'abcdefghijklmnopqrstuvwxyz';\n-    const digits = '0123456789';\n-    await page.notebook.setCell(0, 'code', 'input()');\n-    // Run the selected (only) cell without proceeding and without waiting\n-    // for it to complete (as it should stay waiting for input).\n-    await page.keyboard.press('Control+Enter');\n-\n-    await page.waitForSelector('.jp-Stdin-input');\n-    for (const letter of alphabet) {\n-      await page.keyboard.press(`Key${letter.toUpperCase()}`);\n-    }\n-    for (const letter of alphabet) {\n-      await page.keyboard.press(`Shift+Key${letter.toUpperCase()}`);\n-    }\n-    for (const digit of digits) {\n-      await page.keyboard.press(`Digit${digit}`);\n-    }\n-    await expect(page.locator('.jp-Stdin-input')).toHaveValue(\n-      alphabet + alphabet.toUpperCase() + digits\n-    );\n-  });\n+  const typingScenarios = [\n+    { name: 'stdin box', code: 'input()', selector: '.jp-Stdin-input' },\n+    { name: 'shadow DOM input', code: openShadowDOM, selector: '#shadow-input' }\n+  ];\n+  for (const testCase of typingScenarios) {\n+    test(`Typing in ${testCase.name}`, async ({ page }) => {\n+      // Test to ensure that notebook shortcuts do not capture text typed into inputs.\n+      // This may not be sufficient to ensure no conflicts with other languages but\n+      // should catch the most severe issues.\n+      const alphabet = 'abcdefghijklmnopqrstuvwxyz';\n+      const digits = '0123456789';\n+      await page.notebook.setCell(0, 'code', testCase.code);\n+      // Run the selected (only) cell without proceeding and without waiting\n+      // for it to complete (as it should stay waiting for input).\n+      await page.keyboard.press('Control+Enter');\n+\n+      await page.waitForSelector(testCase.selector);\n+      await page.focus(testCase.selector);\n+\n+      for (const letter of alphabet) {\n+        await page.keyboard.press(`Key${letter.toUpperCase()}`);\n+      }\n+      for (const letter of alphabet) {\n+        await page.keyboard.press(`Shift+Key${letter.toUpperCase()}`);\n+      }\n+      for (const digit of digits) {\n+        await page.keyboard.press(`Digit${digit}`);\n+      }\n+      await expect(page.locator(testCase.selector)).toHaveValue(\n+        alphabet + alphabet.toUpperCase() + digits\n+      );\n+    });\n+  }\n \n   test('Subsequent execution in short succession', async ({ page }) => {\n     await page.notebook.setCell(0, 'code', loopedInput);\n\ndiff --git a/packages/apputils/test/domutils.spec.ts b/packages/apputils/test/domutils.spec.ts\nnew file mode 100644\nindex 000000000000..6e5b4d65d421\n--- /dev/null\n+++ b/packages/apputils/test/domutils.spec.ts\n@@ -0,0 +1,68 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { DOMUtils } from '@jupyterlab/apputils';\n+\n+describe('@jupyterlab/apputils', () => {\n+  describe('DOMUtils', () => {\n+    describe('hasActiveEditableElement', () => {\n+      const testCases = [\n+        // editable elements\n+        ['.input', true],\n+        ['.textarea', true],\n+        ['.div-editable', true],\n+        // non-editable elements\n+        ['.input-readonly', false],\n+        ['.textarea-readonly', false],\n+        ['.div', false]\n+      ];\n+\n+      const div = document.createElement('div');\n+      div.innerHTML = `\n+        <div class=\"light-host\">\n+          <input class=\"input\" />\n+          <input class=\"input-readonly\" readonly />\n+          <textarea class=\"textarea\"></textarea>\n+          <textarea class=\"textarea-readonly\" readonly></textarea>\n+          <div class=\"div\" tabindex=\"1\"></div>\n+          <div class=\"div-editable\" contenteditable=\"true\" tabindex=\"1\"></div>\n+        </div>\n+        <div class=\"shadow-host\">\n+        </div>\n+      `;\n+      document.body.appendChild(div);\n+\n+      const lightHost = div.querySelector('.light-host')!;\n+      const shadowHost = div.querySelector('.shadow-host')!;\n+      const shadowRoot = shadowHost.attachShadow({ mode: 'open' });\n+      // mirror test cases from light DOM in the shadow DOM\n+      shadowRoot.innerHTML = lightHost.innerHTML;\n+\n+      it.each(testCases)(\n+        'should work in light DOM: `%s` element should result in `%s`',\n+        (selector, expected) => {\n+          const element = lightHost.querySelector(\n+            selector as string\n+          ) as HTMLElement;\n+          element.focus();\n+\n+          const result = DOMUtils.hasActiveEditableElement(div);\n+          expect(result).toBe(expected);\n+        }\n+      );\n+\n+      it.each(testCases)(\n+        'should work in shadow DOM: `%s` element should result in `%s`',\n+        (selector, expected) => {\n+          const element = shadowRoot.querySelector(\n+            selector as string\n+          ) as HTMLElement;\n+          element.focus();\n+\n+          const result = DOMUtils.hasActiveEditableElement(div);\n+          expect(result).toBe(expected);\n+        }\n+      );\n+    });\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15753",
    "pr_id": 15753,
    "issue_id": 15746,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Inline completer is invoked automatically when enabling output scrolling\n![Untitled](https://github.com/jupyterlab/jupyterlab/assets/97007177/bb9f760d-aa45-4d7e-947b-7ac22cd8389d)\r\n\r\nInline completer is invoked automatically when enabling output scrolling. I think it should be in the way where inline completer is invoked only when editing code.",
    "issue_word_count": 48,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/completer/src/handler.ts",
      "packages/metapackage/test/completer/handler.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/metapackage/test/completer/handler.spec.ts"
    ],
    "base_commit": "82051a9d0c6dc93677b0b66560aea48d71aaa043",
    "head_commit": "f3409bbe47b40d4a6caba289e22c9297fa694770",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15753",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15753",
    "dockerfile": "",
    "pr_merged_at": "2024-02-09T09:17:17.000Z",
    "patch": "diff --git a/packages/completer/src/handler.ts b/packages/completer/src/handler.ts\nindex 59abf1a383af..fb4bb14d103c 100644\n--- a/packages/completer/src/handler.ts\n+++ b/packages/completer/src/handler.ts\n@@ -7,7 +7,14 @@ import {\n   COMPLETER_ENABLED_CLASS\n } from '@jupyterlab/codeeditor';\n import { Text } from '@jupyterlab/coreutils';\n-import { ISharedText, SourceChange } from '@jupyter/ydoc';\n+import {\n+  CellChange,\n+  FileChange,\n+  ISharedBaseCell,\n+  ISharedFile,\n+  ISharedText,\n+  SourceChange\n+} from '@jupyter/ydoc';\n import { IDataConnector } from '@jupyterlab/statedb';\n import { LabIcon } from '@jupyterlab/ui-components';\n import { IDisposable } from '@lumino/disposable';\n@@ -70,7 +77,7 @@ export class CompletionHandler implements IDisposable {\n       editor.host.classList.remove(COMPLETER_ENABLED_CLASS);\n       editor.host.classList.remove(COMPLETER_ACTIVE_CLASS);\n       model.selections.changed.disconnect(this.onSelectionsChanged, this);\n-      model.sharedModel.changed.disconnect(this.onTextChanged, this);\n+      model.sharedModel.changed.disconnect(this._onSharedModelChanged, this);\n     }\n \n     // Reset completer state.\n@@ -84,7 +91,15 @@ export class CompletionHandler implements IDisposable {\n       const model = editor.model;\n       this._enabled = false;\n       model.selections.changed.connect(this.onSelectionsChanged, this);\n-      model.sharedModel.changed.connect(this.onTextChanged, this);\n+      // We expect the model to be an editor, a file editor, or a cell.\n+      const sharedModel = model.sharedModel as\n+        | ISharedText\n+        | ISharedFile\n+        | ISharedBaseCell;\n+      // For cells and files the `changed` signal is not limited to text,\n+      // but also fires on changes to metadata, outputs, execution count,\n+      // and state changes, hence we need to filter the change type.\n+      sharedModel.changed.connect(this._onSharedModelChanged, this);\n       // On initial load, manually check the cursor position.\n       this.onSelectionsChanged();\n       if (this.inlineCompleter) {\n@@ -382,6 +397,18 @@ export class CompletionHandler implements IDisposable {\n     }\n   }\n \n+  /**\n+   * Handle a text shared model change signal from an editor.\n+   */\n+  private async _onSharedModelChanged(\n+    str: ISharedText,\n+    changed: SourceChange | CellChange | FileChange\n+  ): Promise<void> {\n+    if (changed.sourceChange) {\n+      await this.onTextChanged(str, changed);\n+    }\n+  }\n+\n   /**\n    * Make a completion request.\n    */\n",
    "test_patch": "diff --git a/packages/metapackage/test/completer/handler.spec.ts b/packages/metapackage/test/completer/handler.spec.ts\nindex 191f94a3bede..5a297e422716 100644\n--- a/packages/metapackage/test/completer/handler.spec.ts\n+++ b/packages/metapackage/test/completer/handler.spec.ts\n@@ -3,6 +3,7 @@\n \n import { ISessionContext, SessionContext } from '@jupyterlab/apputils';\n import { CodeEditorWrapper } from '@jupyterlab/codeeditor';\n+import { Signal } from '@lumino/signaling';\n import {\n   Completer,\n   CompleterModel,\n@@ -14,7 +15,7 @@ import {\n } from '@jupyterlab/completer';\n import { createEditorWidget } from '@jupyterlab/completer/lib/testutils';\n import { Widget } from '@lumino/widgets';\n-import { ISharedText, SourceChange } from '@jupyter/ydoc';\n+import { ISharedFile, ISharedText, SourceChange } from '@jupyter/ydoc';\n import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';\n \n class TestCompleterModel extends CompleterModel {\n@@ -217,10 +218,9 @@ describe('@jupyterlab/completer', () => {\n         );\n         editor.model.sharedModel.setSource('bar');\n         editor.setCursorPosition({ line: 0, column: 2 });\n-        // This signal is emitted (again) because the cursor position that\n-        // a natural user would create need to be recreated here.\n-        // (editor.model.value.changed as any).emit({ type: 'set', value: 'bar' }); @todo remove?\n-        (editor.model.sharedModel.changed as any).emit([]);\n+        (\n+          editor.model.sharedModel.changed as Signal<ISharedText, SourceChange>\n+        ).emit({ sourceChange: {} as any });\n         expect(model.methods).toEqual(\n           expect.arrayContaining(['handleTextChange'])\n         );\n@@ -398,6 +398,18 @@ describe('@jupyterlab/completer', () => {\n         );\n       });\n \n+      it('should not trigger on non-source changes to the model', async () => {\n+        provider.triggers.length = 0;\n+\n+        (handler.editor!.model.sharedModel as ISharedFile).setState(\n+          'state-variable',\n+          'new-value'\n+        );\n+        await new Promise(process.nextTick);\n+\n+        expect(provider.triggers.length).toEqual(0);\n+      });\n+\n       it('should pass context to `shouldShowContinuousHint()`', async () => {\n         handler.editor!.model.sharedModel.setSource('foo.');\n         await new Promise(process.nextTick);\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15751",
    "pr_id": 15751,
    "issue_id": 15748,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Cell outputs lost after splitting a cell\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nCell outputs are lost after a cell is split\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\nWrite a multiline cell and split the cell using the context menu option\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\nI would expect the cell outputs to be retained similar to lab3\r\n<!--Describe what you expected to happen-->\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- JupyterLab v4.1.0rc1\r\n",
    "issue_word_count": 142,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/actions.tsx",
      "packages/notebook/test/actions.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/actions.spec.ts"
    ],
    "base_commit": "82051a9d0c6dc93677b0b66560aea48d71aaa043",
    "head_commit": "ce49d5660d27be5a884a42dc381a8587b6a05896",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15751",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15751",
    "dockerfile": "",
    "pr_merged_at": "2024-02-07T20:15:48.000Z",
    "patch": "diff --git a/packages/notebook/src/actions.tsx b/packages/notebook/src/actions.tsx\nindex d76f74bdc679..c80ba41b8c39 100644\n--- a/packages/notebook/src/actions.tsx\n+++ b/packages/notebook/src/actions.tsx\n@@ -200,8 +200,9 @@ export namespace NotebookActions {\n \n     offsets.push(orig.length);\n \n+    const cellCountAfterSplit = offsets.length - 1;\n     const clones = offsets.slice(0, -1).map((offset, offsetIdx) => {\n-      const { cell_type, metadata } = child.model.sharedModel.toJSON();\n+      const { cell_type, metadata, outputs } = child.model.sharedModel.toJSON();\n \n       return {\n         cell_type,\n@@ -209,7 +210,11 @@ export namespace NotebookActions {\n         source: orig\n           .slice(offset, offsets[offsetIdx + 1])\n           .replace(/^\\n+/, '')\n-          .replace(/\\n+$/, '')\n+          .replace(/\\n+$/, ''),\n+        outputs:\n+          offsetIdx === cellCountAfterSplit - 1 && cell_type === 'code'\n+            ? outputs\n+            : undefined\n       };\n     });\n \n",
    "test_patch": "diff --git a/packages/notebook/test/actions.spec.ts b/packages/notebook/test/actions.spec.ts\nindex d4f230c89e6d..8f2b66529bad 100644\n--- a/packages/notebook/test/actions.spec.ts\n+++ b/packages/notebook/test/actions.spec.ts\n@@ -3,7 +3,12 @@\n \n import { ISessionContext, SessionContext } from '@jupyterlab/apputils';\n import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';\n-import { CodeCell, MarkdownCell, RawCell } from '@jupyterlab/cells';\n+import {\n+  CodeCell,\n+  ICodeCellModel,\n+  MarkdownCell,\n+  RawCell\n+} from '@jupyterlab/cells';\n import { CodeEditor } from '@jupyterlab/codeeditor';\n import { CellType, IMimeBundle } from '@jupyterlab/nbformat';\n import {\n@@ -190,6 +195,32 @@ describe('@jupyterlab/notebook', () => {\n         );\n       });\n \n+      it('should preserve all outputs in the second cell', async () => {\n+        const cell = widget.activeCell as CodeCell;\n+        // Produce two outputs (note, first will be `text/plain`,\n+        // while second will be `application/vnd.jupyter.stdout`,\n+        // which guarantees these will not be merged).\n+        const index = widget.activeCellIndex;\n+        const source = 'print(1)\\ndisplay(2)';\n+        cell.model.sharedModel.setSource(source);\n+\n+        // Should populate outputs\n+        await NotebookActions.run(widget, ipySessionContext);\n+        expect(cell.model.outputs).toHaveLength(2);\n+\n+        // Split cell\n+        const editor = cell.editor as CodeEditor.IEditor;\n+        editor.setCursorPosition(editor.getPositionAt(9)!);\n+        NotebookActions.splitCell(widget);\n+\n+        // The output should now be only in the second cell\n+        const cells = widget.model!.cells;\n+        const first = cells.get(index) as ICodeCellModel;\n+        const second = cells.get(index + 1) as ICodeCellModel;\n+        expect(first.outputs).toHaveLength(0);\n+        expect(second.outputs).toHaveLength(2);\n+      });\n+\n       it('should clear the existing selection', () => {\n         for (const child of widget.widgets) {\n           widget.select(child);\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15721",
    "pr_id": 15721,
    "issue_id": 15698,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Visual Regression Documentation tests action uses Node.js 16, which is deprecated\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nIn the run details for visual regression tests, I see an error:\r\n\r\n> Node.js 16 actions are deprecated. Please update the following actions to use Node.js 20: actions/setup-python@v4, actions/cache@v3, actions/setup-node@v3, ifaxity/wait-on-action@v1, actions/upload-artifact@v3. For more information see: https://github.blog/changelog/2023-09-22-github-actions-transitioning-from-node-16-to-node-20/.\r\n\r\n## Expected behavior\r\n\r\nWe need to upgrade these actions to Node 20, which is still supported until late 2024, with maintenance continuing until Q2 2026. NodeJS [ended support on September 11, 2023](https://nodejs.org/en/blog/announcements/nodejs16-eol/).\r\n\r\n",
    "issue_word_count": 157,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      ".github/workflows/benchmark.yml",
      ".github/workflows/docker-test.yml",
      ".github/workflows/galata.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/docker-test.yml"
    ],
    "base_commit": "6554eea7356ccff3c612925436e31fa9f3a5ef11",
    "head_commit": "3b670316d4d4898fdaf959248610e356b6b58f29",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15721",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15721",
    "dockerfile": "",
    "pr_merged_at": "2024-01-31T14:07:16.000Z",
    "patch": "diff --git a/.github/workflows/benchmark.yml b/.github/workflows/benchmark.yml\nindex 655186a02835..916819bbeac7 100644\n--- a/.github/workflows/benchmark.yml\n+++ b/.github/workflows/benchmark.yml\n@@ -84,10 +84,7 @@ jobs:\n         working-directory: galata\n \n       - name: Wait for JupyterLab\n-        uses: ifaxity/wait-on-action@v1\n-        with:\n-          resource: http-get://localhost:8888/lab\n-          timeout: 360000\n+        run: npx wait-on@7.2.0 http-get://localhost:8888/lab -t 360000\n \n       - name: Execute benchmark tests\n         continue-on-error: true\n@@ -128,10 +125,7 @@ jobs:\n           jlpm run build\n \n       - name: Wait for JupyterLab\n-        uses: ifaxity/wait-on-action@v1\n-        with:\n-          resource: http-get://localhost:8888/lab\n-          timeout: 360000\n+        run: npx wait-on@7.2.0 http-get://localhost:8888/lab -t 360000\n \n       - name: Execute benchmark tests\n         continue-on-error: true\n\ndiff --git a/.github/workflows/galata.yml b/.github/workflows/galata.yml\nindex a599c3531c6d..925d5341b895 100644\n--- a/.github/workflows/galata.yml\n+++ b/.github/workflows/galata.yml\n@@ -50,10 +50,7 @@ jobs:\n           jlpm run build\n \n       - name: Wait for JupyterLab\n-        uses: ifaxity/wait-on-action@v1\n-        with:\n-          resource: http-get://localhost:8888/lab\n-          timeout: 360000\n+        run: npx wait-on@7.2.0 http-get://localhost:8888/lab -t 360000\n \n       - name: Test\n         run: |\n@@ -163,10 +160,7 @@ jobs:\n         working-directory: core\n \n       - name: Wait for JupyterLab\n-        uses: ifaxity/wait-on-action@v1\n-        with:\n-          resource: http-get://localhost:8888/lab\n-          timeout: 360000\n+        run: npx wait-on@7.2.0 http-get://localhost:8888/lab -t 360000\n \n       - name: Test\n         run: |\n",
    "test_patch": "diff --git a/.github/workflows/docker-test.yml b/.github/workflows/docker-test.yml\nindex 4686280468cf..7a05dc79bec0 100644\n--- a/.github/workflows/docker-test.yml\n+++ b/.github/workflows/docker-test.yml\n@@ -22,7 +22,4 @@ jobs:\n           bash ./docker/start.sh dev-detach\n \n       - name: Wait for JupyterLab\n-        uses: ifaxity/wait-on-action@v1\n-        with:\n-          resource: http-get://localhost:8888/\n-          timeout: 360000\n+        run: npx wait-on@7.2.0 http-get://localhost:8888/lab -t 360000\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15720",
    "pr_id": 15720,
    "issue_id": 15719,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "`Notebook Toolbar â€º Paste cell` test is failing frequently on CI\n\r\n## Description\r\n\r\n\r\nFor example https://github.com/jupyterlab/jupyterlab/actions/runs/7716070540/job/21034405882?pr=15717\r\n\r\n```\r\nError:   1) [jupyterlab] â€º test/jupyterlab/notebook-toolbar.test.ts:54:7 â€º Notebook Toolbar â€º Paste cell â”€â”€\r\n\r\n    Retry #1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    Error: expect(received).toBeVisible()\r\n    Call log:\r\n      - expect.toBeVisible with timeout 5000ms\r\n      - waiting for locator('.jp-Notebook-cell.jp-mod-active .jp-cell-toolbar')\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      - waiting for locator('.jp-Notebook-cell.jp-mod-active .jp-cell-toolbar')\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n      -   locator resolved to <jp-toolbar role=\"toolbar\" orientation=\"horizontal\" aria-oriâ€¦>â€¦</jp-toolbar>\r\n      -   unexpected value \"hidden\"\r\n\r\n\r\n      64 |     await expect(\r\n      65 |       page.locator('.jp-Notebook-cell.jp-mod-active .jp-cell-toolbar')\r\n    > 66 |     ).toBeVisible();\r\n         |       ^\r\n      67 |     expect(await nbPanel.screenshot()).toMatchSnapshot(imageName);\r\n      68 |   });\r\n      69 |\r\n\r\n        at /home/runner/work/jupyterlab/jupyterlab/galata/test/jupyterlab/notebook-toolbar.test.ts:66:7\r\n```\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/blob/af8d90206458d370f0a3d34ae84e5e572ba8ba2e/galata/test/jupyterlab/notebook-toolbar.test.ts#L54-L68\r\n\r\n\r\n#### Recording\r\n\r\n[video.webm](https://github.com/jupyterlab/jupyterlab/assets/5832902/87241097-1ebd-462b-92d9-0507cd318908)\r\n\r\nI believe the problem is that the markdown cell gets rendered on paste but it should not (the mode should be preserved).\r\n\r\n#### Our reference\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/de502a6c-54c1-4fbc-b92e-f8cf94a8067a)\r\n\r\n",
    "issue_word_count": 330,
    "test_files_count": 2,
    "non_test_files_count": 0,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-toolbar.test.ts",
      "galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-toolbar.test.ts",
      "galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png"
    ],
    "base_commit": "6554eea7356ccff3c612925436e31fa9f3a5ef11",
    "head_commit": "7e442d22b4a406790507d2349dc01af306fbc1e4",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15720",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15720",
    "dockerfile": "",
    "pr_merged_at": "2024-02-07T14:44:23.000Z",
    "patch": "",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-toolbar.test.ts b/galata/test/jupyterlab/notebook-toolbar.test.ts\nindex 977fc6c11ffc..e86150f72d2e 100644\n--- a/galata/test/jupyterlab/notebook-toolbar.test.ts\n+++ b/galata/test/jupyterlab/notebook-toolbar.test.ts\n@@ -53,7 +53,7 @@ test.describe('Notebook Toolbar', () => {\n \n   test('Paste cell', async ({ page }) => {\n     // Cut cell to populate clipboard\n-    await page.notebook.selectCells(1);\n+    await page.notebook.selectCells(0);\n     await page.notebook.clickToolbarItem('cut');\n \n     const imageName = 'paste-cell.png';\n@@ -61,9 +61,9 @@ test.describe('Notebook Toolbar', () => {\n     await page.notebook.clickToolbarItem('paste');\n     const nbPanel = await page.notebook.getNotebookInPanel();\n \n-    await expect(\n-      page.locator('.jp-Notebook-cell.jp-mod-active .jp-cell-toolbar')\n-    ).toBeVisible();\n+    await expect\n+      .soft(page.locator('.jp-Notebook-cell.jp-mod-active .jp-cell-toolbar'))\n+      .toBeVisible();\n     expect(await nbPanel.screenshot()).toMatchSnapshot(imageName);\n   });\n \n\ndiff --git a/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png\nindex bd86b5bafb42..05843142d38c 100644\nBinary files a/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15716",
    "pr_id": 15716,
    "issue_id": 15713,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Overrides.json is not respected by the keyboard shortcuts extensions\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nI have the following snippet in my overrides.json but it seems to get ignored by the shortcuts-extension.\r\n\r\n```\r\n{\r\n  \"@jupyterlab/shortcuts-extension:shortcuts\": {\r\n    shortcuts: [\r\n      {\r\n        \"args\": {},\r\n        \"command\": \"documentsearch:start\",\r\n        \"keys\": [\r\n            \"Accel F\"\r\n        ],\r\n        \"disabled\": true,\r\n        \"selector\": \".jp-mod-searchable\"\r\n      },\r\n    ],\r\n  },\r\n}\r\n```\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\n1. Copy the above snippet into `<sys-prefix>/jupyter/lab/settings/overrides.json5`.\r\n2. Launch jupyterlab.\r\n3. Open a notebook.\r\n4. Use the Ctrl F shortcut.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\nI would expect the keyboard shortcut to launch the browser's find instead of the one provided by jupyterlab\r\n<!--Describe what you expected to happen-->\r\n\r\n## Context\r\n- Jupyterlab version: 4.1.0rc0\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n",
    "issue_word_count": 194,
    "test_files_count": 2,
    "non_test_files_count": 3,
    "pr_changed_files": [
      ".github/workflows/linuxjs-tests.yml",
      "packages/shortcuts-extension/package.json",
      "packages/shortcuts-extension/src/index.ts",
      "packages/shortcuts-extension/test/shortcuts.spec.ts",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxjs-tests.yml",
      "packages/shortcuts-extension/test/shortcuts.spec.ts"
    ],
    "base_commit": "af8d90206458d370f0a3d34ae84e5e572ba8ba2e",
    "head_commit": "d79349352636f424efb737cc884fc7e09b069fca",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15716",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15716",
    "dockerfile": "",
    "pr_merged_at": "2024-01-31T14:45:20.000Z",
    "patch": "diff --git a/packages/shortcuts-extension/package.json b/packages/shortcuts-extension/package.json\nindex 6ac71f23826f..525a02ff1097 100644\n--- a/packages/shortcuts-extension/package.json\n+++ b/packages/shortcuts-extension/package.json\n@@ -57,6 +57,7 @@\n   \"devDependencies\": {\n     \"@jupyterlab/testing\": \"^4.1.0-rc.0\",\n     \"@types/jest\": \"^29.2.0\",\n+    \"jest\": \"^29.2.0\",\n     \"rimraf\": \"~5.0.5\",\n     \"typedoc\": \"~0.24.7\",\n     \"typescript\": \"~5.1.6\"\n\ndiff --git a/packages/shortcuts-extension/src/index.ts b/packages/shortcuts-extension/src/index.ts\nindex 12a5acda95c0..9560d31d0c04 100644\n--- a/packages/shortcuts-extension/src/index.ts\n+++ b/packages/shortcuts-extension/src/index.ts\n@@ -18,6 +18,7 @@ import {\n import { CommandRegistry } from '@lumino/commands';\n import {\n   JSONExt,\n+  PartialJSONValue,\n   ReadonlyPartialJSONObject,\n   ReadonlyPartialJSONValue\n } from '@lumino/coreutils';\n@@ -27,19 +28,20 @@ import { Menu } from '@lumino/widgets';\n import { IShortcutUIexternal } from './components';\n import { renderShortCut } from './renderer';\n \n+const SHORTCUT_PLUGIN_ID = '@jupyterlab/shortcuts-extension:shortcuts';\n+\n function getExternalForJupyterLab(\n   settingRegistry: ISettingRegistry,\n   app: JupyterFrontEnd,\n   translator: ITranslator\n ): IShortcutUIexternal {\n   const { commands } = app;\n-  const shortcutPluginLocation = '@jupyterlab/shortcuts-extension:shortcuts';\n   return {\n     translator,\n     getAllShortCutSettings: () =>\n-      settingRegistry.load(shortcutPluginLocation, true),\n+      settingRegistry.load(SHORTCUT_PLUGIN_ID, true),\n     removeShortCut: (key: string) =>\n-      settingRegistry.remove(shortcutPluginLocation, key),\n+      settingRegistry.remove(SHORTCUT_PLUGIN_ID, key),\n     createMenu: () => new Menu({ commands }),\n     hasCommand: (id: string) => commands.hasCommand(id),\n     addCommand: (id: string, options: CommandRegistry.ICommandOptions) =>\n@@ -78,7 +80,7 @@ function getExternalForJupyterLab(\n  * required, using the `'body'` selector is more appropriate.\n  */\n const shortcuts: JupyterFrontEndPlugin<void> = {\n-  id: '@jupyterlab/shortcuts-extension:shortcuts',\n+  id: SHORTCUT_PLUGIN_ID,\n   description: 'Adds the keyboard shortcuts editor.',\n   requires: [ISettingRegistry],\n   optional: [ITranslator, IFormRendererRegistry],\n@@ -92,6 +94,9 @@ const shortcuts: JupyterFrontEndPlugin<void> = {\n     const trans = translator_.load('jupyterlab');\n     const { commands } = app;\n     let canonical: ISettingRegistry.ISchema | null;\n+    // Stores initial value of the shortcuts `default` value,\n+    // which reflects the `overrides.json` contents.\n+    let cannonicalOverrides: PartialJSONValue | undefined;\n     let loaded: { [name: string]: ISettingRegistry.IShortcut[] } = {};\n \n     if (editorRegistry) {\n@@ -111,7 +116,11 @@ const shortcuts: JupyterFrontEndPlugin<void> = {\n      */\n     function populate(schema: ISettingRegistry.ISchema) {\n       const commands = app.commands.listCommands().join('\\n');\n-\n+      if (!cannonicalOverrides) {\n+        cannonicalOverrides = JSONExt.deepCopy(\n+          schema.properties!.shortcuts.default!\n+        );\n+      }\n       loaded = {};\n       schema.properties!.shortcuts.default = Object.keys(registry.plugins)\n         .map(plugin => {\n@@ -120,7 +129,7 @@ const shortcuts: JupyterFrontEndPlugin<void> = {\n           loaded[plugin] = shortcuts;\n           return shortcuts;\n         })\n-        .concat([schema.properties!.shortcuts.default as any[]])\n+        .concat([cannonicalOverrides as any[]])\n         .reduce((acc, val) => {\n           if (Platform.IS_MAC) {\n             return acc.concat(val);\n@@ -174,7 +183,7 @@ List of keyboard shortcuts:`,\n           // Empty the default values to avoid shortcut collisions.\n           canonical = null;\n           const schema = registry.plugins[shortcuts.id]!.schema;\n-          schema.properties!.shortcuts.default = [];\n+          schema.properties!.shortcuts.default = cannonicalOverrides;\n \n           // Reload the settings.\n           await registry.load(shortcuts.id, true);\n\ndiff --git a/yarn.lock b/yarn.lock\nindex 572e11edd022..dc59c5aea306 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -4693,6 +4693,7 @@ __metadata:\n     \"@lumino/keyboard\": ^2.0.1\n     \"@lumino/widgets\": ^2.3.1\n     \"@types/jest\": ^29.2.0\n+    jest: ^29.2.0\n     react: ^18.2.0\n     rimraf: ~5.0.5\n     typedoc: ~0.24.7\n",
    "test_patch": "diff --git a/.github/workflows/linuxjs-tests.yml b/.github/workflows/linuxjs-tests.yml\nindex 683a98185d33..c3136a2e2af8 100644\n--- a/.github/workflows/linuxjs-tests.yml\n+++ b/.github/workflows/linuxjs-tests.yml\n@@ -51,6 +51,7 @@ jobs:\n             js-services,\n             js-settingeditor,\n             js-settingregistry,\n+            js-shortcuts-extension,\n             js-statedb,\n             js-statusbar,\n             js-testing,\n\ndiff --git a/packages/shortcuts-extension/test/shortcuts.spec.ts b/packages/shortcuts-extension/test/shortcuts.spec.ts\nindex cf0a4afc5caf..1b8363d002ad 100644\n--- a/packages/shortcuts-extension/test/shortcuts.spec.ts\n+++ b/packages/shortcuts-extension/test/shortcuts.spec.ts\n@@ -6,6 +6,8 @@ import * as plugin from '@jupyterlab/shortcuts-extension';\n import { IDataConnector } from '@jupyterlab/statedb';\n import { CommandRegistry } from '@lumino/commands';\n import { Platform } from '@lumino/domutils';\n+import { signalToPromise } from '@jupyterlab/testing';\n+\n import pluginSchema from '../schema/shortcuts.json';\n \n describe('@jupyterlab/shortcut-extension', () => {\n@@ -95,6 +97,153 @@ describe('@jupyterlab/shortcut-extension', () => {\n       expect(shortcuts).toHaveLength(Platform.IS_MAC ? 2 : 1);\n     });\n \n+    it('should respect default shortcuts (e.g. from `overrides.json`)', async () => {\n+      const shared: Omit<ISettingRegistry.IPlugin, 'id'> = {\n+        data: {\n+          composite: {},\n+          user: {}\n+        },\n+        raw: '{}',\n+        version: 'test'\n+      };\n+      const foo = {\n+        ...shared,\n+        id: 'foo:settings',\n+        schema: {\n+          type: 'object',\n+          'jupyter.lab.shortcuts': [\n+            {\n+              command: 'application:close',\n+              keys: ['Ctrl W'],\n+              selector: 'body'\n+            },\n+            {\n+              command: 'application:close-all',\n+              keys: ['Alt W'],\n+              selector: 'body'\n+            }\n+          ]\n+        }\n+      };\n+      const bar = {\n+        ...shared,\n+        id: 'bar:settings',\n+        schema: {\n+          type: 'object',\n+          'jupyter.lab.shortcuts': [\n+            {\n+              command: 'console:create',\n+              keys: ['Ctrl T'],\n+              selector: 'body'\n+            },\n+            {\n+              command: 'console:inject',\n+              keys: ['Ctrl I'],\n+              selector: 'body'\n+            }\n+          ]\n+        }\n+      };\n+      const defaults = {\n+        ...shared,\n+        id: plugin.default.id,\n+        schema: {\n+          ...(pluginSchema as any),\n+          properties: {\n+            shortcuts: {\n+              default: [\n+                {\n+                  command: 'application:close',\n+                  keys: ['Ctrl W'],\n+                  selector: 'body',\n+                  disabled: true\n+                },\n+                {\n+                  command: 'console:inject',\n+                  keys: ['Ctrl J'],\n+                  selector: 'body'\n+                },\n+                {\n+                  command: 'help:open',\n+                  keys: ['Ctrl H'],\n+                  selector: 'body'\n+                }\n+              ]\n+            }\n+          }\n+        }\n+      };\n+\n+      const connector: IDataConnector<\n+        ISettingRegistry.IPlugin,\n+        string,\n+        string,\n+        string\n+      > = {\n+        fetch: jest.fn().mockImplementation((id: string) => {\n+          switch (id) {\n+            case foo.id:\n+              return foo;\n+            case bar.id:\n+              return bar;\n+            case defaults.id:\n+              return defaults;\n+            default:\n+              return {};\n+          }\n+        }),\n+        list: jest.fn(),\n+        save: jest.fn(),\n+        remove: jest.fn()\n+      };\n+\n+      const settingRegistry = new SettingRegistry({\n+        connector\n+      });\n+\n+      void plugin.default.activate(\n+        {\n+          commands: new CommandRegistry()\n+        } as any,\n+        settingRegistry\n+      );\n+\n+      // Note: we are also testing that the shortcuts overrides are not lost\n+      // when settings are fetched before or after the shortcuts settings.\n+      await settingRegistry.load(foo.id);\n+      const settings = await settingRegistry.load(plugin.default.id);\n+      await settingRegistry.load(bar.id);\n+\n+      // Ensure the signal about loading has already propagated to listeners\n+      await signalToPromise(settingRegistry.pluginChanged);\n+\n+      const shortcuts = (await settings.get('shortcuts')\n+        .composite) as ISettingRegistry.IShortcut[];\n+\n+      const commandsWithShortcuts = shortcuts.map(shortcut => shortcut.command);\n+\n+      // `application:close` was disabled by override but `application:close-all` was not\n+      expect(commandsWithShortcuts).not.toContain('application:close');\n+      expect(commandsWithShortcuts).toContain('application:close-all');\n+\n+      // `help:open` was added by override\n+      expect(commandsWithShortcuts).toContain('help:open');\n+\n+      // `console:inject` should now be accessible with both Ctrl + I and Ctrl + J\n+      const injectBindings = shortcuts.filter(\n+        s => s.command === 'console:inject'\n+      );\n+      expect(injectBindings.map(s => s.keys[0])).toContain('Ctrl J');\n+      expect(injectBindings.map(s => s.keys[0])).toContain('Ctrl I');\n+\n+      // `console:create` should not be touched by the override\n+      const createBindings = shortcuts.filter(\n+        s => s.command === 'console:create'\n+      );\n+      expect(createBindings.length).toEqual(1);\n+      expect(createBindings[0].keys[0]).toEqual('Ctrl T');\n+    });\n+\n     it('should ignore colliding shortcuts', async () => {\n       const pluginId = 'test-plugin:settings';\n       const bar: ISettingRegistry.IPlugin = {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15703",
    "pr_id": 15703,
    "issue_id": 15670,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "\"Notebook scrolls to heading\" test fails subtly\nSince recent fixes in ToC this test: \"Table of Contents scrolling to heading â€º Notebook scrolls to heading\" fails by positioning the heading slightly off:\r\n\r\n| Actual | Expected |\r\n|--|--|\r\n| ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/0f60c0ce-4d3e-47f1-8717-d996215a022b) |  ![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/e5e7d827-01a8-4e24-be72-a6864e92e5d6) |",
    "issue_word_count": 59,
    "test_files_count": 3,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png",
      "galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/toc-scrolling.test.ts-snapshots/scrolled-to-bottom-heading-jupyterlab-linux.png",
      "packages/rendermime/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png",
      "galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png",
      "galata/test/jupyterlab/toc-scrolling.test.ts-snapshots/scrolled-to-bottom-heading-jupyterlab-linux.png"
    ],
    "base_commit": "558c60f069a33201ab7b2ba9fcafdf4145102456",
    "head_commit": "91037a749017f23a9b39d6739eb4c4390cf44692",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15703",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15703",
    "dockerfile": "",
    "pr_merged_at": "2024-01-29T20:23:24.000Z",
    "patch": "diff --git a/packages/rendermime/style/base.css b/packages/rendermime/style/base.css\nindex af777208fc21..88801d266d83 100644\n--- a/packages/rendermime/style/base.css\n+++ b/packages/rendermime/style/base.css\n@@ -283,6 +283,7 @@\n   font-style: normal;\n   margin: var(--jp-content-heading-margin-top) 0\n     var(--jp-content-heading-margin-bottom) 0;\n+  scroll-margin-top: var(--jp-content-heading-margin-top);\n }\n \n .jp-RenderedHTMLCommon h1:first-child,\n@@ -292,6 +293,7 @@\n .jp-RenderedHTMLCommon h5:first-child,\n .jp-RenderedHTMLCommon h6:first-child {\n   margin-top: calc(0.5 * var(--jp-content-heading-margin-top));\n+  scroll-margin-top: calc(0.5 * var(--jp-content-heading-margin-top));\n }\n \n .jp-RenderedHTMLCommon h1:last-child,\n",
    "test_patch": "diff --git a/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png b/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png\nindex fbb37efd2ca1..e1c3eb682a94 100644\nBinary files a/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png and b/galata/test/benchmark/notebook.spec.ts-snapshots/large-md-notebook-ipynb-benchmark-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png\nindex b6af6a76c29c..bd86b5bafb42 100644\nBinary files a/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png and b/galata/test/jupyterlab/notebook-toolbar.test.ts-snapshots/paste-cell-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/toc-scrolling.test.ts-snapshots/scrolled-to-bottom-heading-jupyterlab-linux.png b/galata/test/jupyterlab/toc-scrolling.test.ts-snapshots/scrolled-to-bottom-heading-jupyterlab-linux.png\nindex f0fef1ed4f97..d47e03128f6f 100644\nBinary files a/galata/test/jupyterlab/toc-scrolling.test.ts-snapshots/scrolled-to-bottom-heading-jupyterlab-linux.png and b/galata/test/jupyterlab/toc-scrolling.test.ts-snapshots/scrolled-to-bottom-heading-jupyterlab-linux.png differ\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15702",
    "pr_id": 15702,
    "issue_id": 15693,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Erratic scroll jumps when performing actions in notebook\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nHi, I've experienced some erratic jumps when doing some actions on a notebook (eg. re-running cells). Here's a GIF - \r\n\r\n![scroll_jump](https://github.com/jupyterlab/jupyterlab/assets/30082866/9995ad6c-bd98-4cd5-a154-dd2a6f671fb8)\r\n\r\nFTR, the windowing mode is set to the default which is `defer`.\r\n\r\nThe jumps probably feel more erratic when the height of the cell output changes too drastically between re-runs or when there are too many cells.\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\n\r\n\r\nThe snippet in the gif is - \r\n\r\n```\r\nimport matplotlib.pyplot as plt\r\nfrom IPython.display import display\r\n\r\nfor _ in range(4):\r\n    axes = plt.axes()\r\n    axes.plot([1, 2, 3], [4, 5, 6])\r\n    plt.close()\r\n    display(axes.get_figure())\r\n```\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- JupyterLab version: v4.1.0b2\r\n\r\n",
    "issue_word_count": 184,
    "test_files_count": 6,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "galata/playwright.config.js",
      "galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts",
      "galata/test/jupyterlab/notebook-scroll.test.ts",
      "galata/test/jupyterlab/utils.ts",
      "galata/test/jupyterlab/windowed-notebook.test.ts",
      "packages/notebook/src/actions.tsx",
      "packages/notebook/src/toc.ts",
      "packages/notebook/src/widget.ts",
      "packages/notebook/test/actions.spec.ts",
      "packages/testing/src/jest-shim.ts",
      "packages/ui-components/src/components/windowedlist.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts",
      "galata/test/jupyterlab/notebook-scroll.test.ts",
      "galata/test/jupyterlab/utils.ts",
      "galata/test/jupyterlab/windowed-notebook.test.ts",
      "packages/notebook/test/actions.spec.ts",
      "packages/testing/src/jest-shim.ts"
    ],
    "base_commit": "26677ad4e0654f5fc7627c44b3c4d98707bbd0b2",
    "head_commit": "0520c172b6b0b81061592a12cb362ecc8c465afd",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15702",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15702",
    "dockerfile": "",
    "pr_merged_at": "2024-02-01T10:42:09.000Z",
    "patch": "diff --git a/galata/playwright.config.js b/galata/playwright.config.js\nindex 46d6ddd9ba14..c056991e2bcf 100644\n--- a/galata/playwright.config.js\n+++ b/galata/playwright.config.js\n@@ -27,7 +27,7 @@ module.exports = {\n     },\n     {\n       name: 'jupyterlab',\n-      testMatch: 'test/jupyterlab/**',\n+      testMatch: 'test/jupyterlab/**/*.test.ts',\n       testIgnore: '**/.ipynb_checkpoints/**',\n       use: {\n         contextOptions: {\n\ndiff --git a/packages/notebook/src/actions.tsx b/packages/notebook/src/actions.tsx\nindex fa75d84d36a5..d76f74bdc679 100644\n--- a/packages/notebook/src/actions.tsx\n+++ b/packages/notebook/src/actions.tsx\n@@ -549,7 +549,7 @@ export namespace NotebookActions {\n       translator\n     );\n \n-    void Private.handleRunState(notebook, state, false);\n+    void Private.handleRunState(notebook, state);\n     return promise;\n   }\n \n@@ -587,7 +587,8 @@ export namespace NotebookActions {\n       sessionDialogs,\n       translator\n     );\n-    void Private.handleRunState(notebook, state, false);\n+\n+    void Private.handleRunState(notebook, state);\n     return promise;\n   }\n \n@@ -652,7 +653,13 @@ export namespace NotebookActions {\n       notebook.activeCellIndex++;\n     }\n \n-    void Private.handleRunState(notebook, state, true);\n+    // If a cell is outside of viewport and scrolling is needed, the `smart`\n+    // logic in `handleRunState` will choose appropriate alignment, except\n+    // for the case of a small cell less than one viewport away for which it\n+    // would use the `auto` heuristic, for which we set the preferred alignment\n+    // to `center` as in most cases there will be space below and above a cell\n+    // that is smaller than (or approximately equal to) the viewport size.\n+    void Private.handleRunState(notebook, state, 'center');\n     return promise;\n   }\n \n@@ -709,7 +716,7 @@ export namespace NotebookActions {\n       );\n     }\n     notebook.mode = 'edit';\n-    void Private.handleRunState(notebook, state, true);\n+    void Private.handleRunState(notebook, state, 'center');\n     return promise;\n   }\n \n@@ -751,7 +758,7 @@ export namespace NotebookActions {\n     notebook.activeCellIndex = lastIndex;\n     notebook.deselectAll();\n \n-    void Private.handleRunState(notebook, state, true);\n+    void Private.handleRunState(notebook, state);\n     return promise;\n   }\n \n@@ -774,7 +781,7 @@ export namespace NotebookActions {\n     }\n     const promise = Private.runSelected(notebook);\n     notebook.activeCellIndex = previousIndex;\n-    void Private.handleRunState(notebook, state, true);\n+    void Private.handleRunState(notebook, state);\n     return promise;\n   }\n \n@@ -816,7 +823,7 @@ export namespace NotebookActions {\n \n     notebook.deselectAll();\n \n-    void Private.handleRunState(notebook, state, true);\n+    void Private.handleRunState(notebook, state);\n     return promise;\n   }\n \n@@ -858,7 +865,7 @@ export namespace NotebookActions {\n     notebook.activeCellIndex = lastIndex;\n     notebook.deselectAll();\n \n-    void Private.handleRunState(notebook, state, true);\n+    void Private.handleRunState(notebook, state);\n     return promise;\n   }\n \n@@ -2303,13 +2310,16 @@ namespace Private {\n   export async function handleRunState(\n     notebook: Notebook,\n     state: IState,\n-    scroll = false\n+    alignPreference?: 'start' | 'end' | 'center' | 'top-center'\n   ): Promise<void> {\n     const { activeCell, activeCellIndex } = notebook;\n-    if (scroll && activeCell) {\n-      await notebook.scrollToItem(activeCellIndex, 'smart', 0).catch(reason => {\n-        // no-op\n-      });\n+\n+    if (activeCell) {\n+      await notebook\n+        .scrollToItem(activeCellIndex, 'smart', 0, alignPreference)\n+        .catch(reason => {\n+          // no-op\n+        });\n     }\n     if (state.wasFocused || notebook.mode === 'edit') {\n       notebook.activate();\n\ndiff --git a/packages/notebook/src/toc.ts b/packages/notebook/src/toc.ts\nindex 3f2f7e749396..9bf0c1489320 100644\n--- a/packages/notebook/src/toc.ts\n+++ b/packages/notebook/src/toc.ts\n@@ -610,7 +610,8 @@ export class NotebookToCFactory extends TableOfContentsFactory<NotebookPanel> {\n             console.debug('scrolling to heading: using fallback strategy');\n             await widget.content.scrollToItem(\n               widget.content.activeCellIndex,\n-              this.scrollToTop ? 'start' : undefined\n+              this.scrollToTop ? 'start' : undefined,\n+              0\n             );\n           }\n         };\n\ndiff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex 8eb6b9060b79..01280e7ae282 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -1457,7 +1457,8 @@ export class Notebook extends StaticNotebook {\n           // activeCell.node.focus() is called, which closes the command palette.\n           // To the end user, it looks as if all the keyboard shortcut did was\n           // move focus from the cell editor to the cell as a whole.\n-          waitUntilReady: false\n+          waitUntilReady: false,\n+          preventScroll: true\n         });\n       }\n     }\n\ndiff --git a/packages/ui-components/src/components/windowedlist.ts b/packages/ui-components/src/components/windowedlist.ts\nindex de930c4d2978..8daf7aada8a4 100644\n--- a/packages/ui-components/src/components/windowedlist.ts\n+++ b/packages/ui-components/src/components/windowedlist.ts\n@@ -21,11 +21,12 @@ import { ISignal, Signal } from '@lumino/signaling';\n import { PanelLayout, Widget } from '@lumino/widgets';\n \n /**\n- * Maximal remaining time for idle callback\n+ * For how long after the scroll request should the target position\n+ * be corrected to account for resize of other widgets?\n  *\n- * Ref: https://developer.mozilla.org/en-US/docs/Web/API/Background_Tasks_API#getting_the_most_out_of_idle_callbacks\n+ * The time is given in milliseconds.\n  */\n-const MAXIMUM_TIME_REMAINING = 50;\n+const MAXIMUM_TIME_REMAINING = 100;\n \n /*\n  * Feature detection\n@@ -292,13 +293,20 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n   /**\n    * Get the scroll offset to display an item in the viewport.\n    *\n-   * By default, the list will scroll as little as possible to ensure the item is fully visible. You can control the alignment of the item though by specifying a second alignment parameter. Acceptable values are:\n+   * By default, the list will scroll as little as possible to ensure the item is fully visible (`auto`).\n+   * You can control the alignment of the item though by specifying a second alignment parameter.\n+   * Acceptable values are:\n    *\n-   *   auto (default) - Automatically align with the top or bottom minimising the amount scrolled; if item is smaller than the viewport and fully visible, do not scroll at all.\n-   *   smart - If the item is significantly visible, don't scroll at all (regardless of whether it fits in the viewport). If it is less than one viewport away or exceeds viewport in height, scroll so that it becomes visible. If it is more than one viewport away and fits the viewport, scroll so that it is centered within the viewport.\n-   *   center - Center align the item within the list.\n-   *   end - Align the item to the end of the list\n-   *   start - Align the item to the beginning of the list\n+   *   auto - Automatically align with the top or bottom minimising the amount scrolled,\n+   *          If `alignPreference` is given, follow such preferred alignment.\n+   *          If item is smaller than the viewport and fully visible, do not scroll at all.\n+   *   smart - If the item is significantly visible, don't scroll at all (regardless of whether it fits in the viewport).\n+   *           If the item is less than one viewport away, scroll so that it becomes fully visible (following the `auto` heuristics).\n+   *           If the item is more than one viewport away, scroll so that it is centered within the viewport (`center` if smaller than viewport, `top-center` otherwise).\n+   *   center - Align the middle of the item with the middle of the viewport (it only works well for items smaller than the viewport).\n+   *   top-center - Align the top of the item with the middle of the viewport (works well for items larger than the viewport).\n+   *   end - Align the bottom of the item to the bottom of the list.\n+   *   start - Align the top of item to the top of the list.\n    *\n    * An item is considered significantly visible if:\n    *  - it overlaps with the viewport by the amount specified by `scrollDownThreshold` when below the viewport\n@@ -307,16 +315,26 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n    * @param index Item index\n    * @param align Where to align the item in the viewport\n    * @param margin The proportion of viewport to add when aligning with the top/bottom of the list.\n+   * @param precomputed Precomputed values to use when windowing is disabled.\n+   * @param alignPreference Allows to override the alignment of item when the `auto` heuristic decides that the item needs to be scrolled into view.\n    * @returns The needed scroll offset\n    */\n   getOffsetForIndexAndAlignment(\n     index: number,\n     align: WindowedList.ScrollToAlign = 'auto',\n-    margin: number = 0\n+    margin: number = 0,\n+    precomputed?: {\n+      totalSize: number;\n+      itemMetadata: WindowedList.ItemMetadata;\n+      currentOffset: number;\n+    },\n+    alignPreference?: WindowedList.BaseScrollToAlignment\n   ): number {\n     const boundedMargin = Math.min(Math.max(0.0, margin), 1.0);\n     const size = this._height;\n-    const itemMetadata = this._getItemMetadata(index);\n+    const itemMetadata = precomputed\n+      ? precomputed.itemMetadata\n+      : this._getItemMetadata(index);\n \n     const scrollDownThreshold =\n       this.scrollDownThreshold <= 1\n@@ -327,9 +345,12 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n         ? itemMetadata.size * this.scrollUpThreshold\n         : this.scrollUpThreshold;\n \n-    // Get estimated total size after ItemMetadata is computed,\n-    // To ensure it reflects actual measurements instead of just estimates.\n-    const estimatedTotalSize = this.getEstimatedTotalSize();\n+    // When pre-computed values are not available (we are in windowing mode),\n+    // `getEstimatedTotalSize` is called after ItemMetadata is computed\n+    // to ensure it reflects actual measurements instead of just estimates.\n+    const estimatedTotalSize = precomputed\n+      ? precomputed.totalSize\n+      : this.getEstimatedTotalSize();\n \n     const topOffset = Math.max(\n       0,\n@@ -339,14 +360,21 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n       0,\n       itemMetadata.offset - size + itemMetadata.size\n     );\n-    const currentOffset = this._scrollOffset;\n+    // Current offset (+/- padding) is the top edge of the viewport.\n+    const currentOffset = precomputed\n+      ? precomputed.currentOffset\n+      : this._scrollOffset;\n \n+    const viewportPadding = this._windowingActive ? this.paddingTop : 0;\n     const itemTop = itemMetadata.offset;\n     const itemBottom = itemMetadata.offset + itemMetadata.size;\n-    const bottomEdge = currentOffset - this.paddingTop + size;\n-    const topEdge = currentOffset - this.paddingTop;\n+    const bottomEdge = currentOffset - viewportPadding + size;\n+    const topEdge = currentOffset - viewportPadding;\n     const crossingBottomEdge = bottomEdge > itemTop && bottomEdge < itemBottom;\n     const crossingTopEdge = topEdge > itemTop && topEdge < itemBottom;\n+\n+    const isFullyWithinViewport = bottomEdge > itemBottom && topEdge < itemTop;\n+\n     if (align === 'smart') {\n       const edgeLessThanOneViewportAway =\n         currentOffset >= bottomOffset - size &&\n@@ -356,19 +384,20 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n       const hiddenPartTop = topEdge - itemTop;\n \n       if (\n+        isFullyWithinViewport ||\n         (crossingBottomEdge && visiblePartBottom >= scrollDownThreshold) ||\n         (crossingTopEdge && hiddenPartTop < scrollUpThreshold)\n       ) {\n-        return this._scrollOffset;\n+        return currentOffset;\n       } else if (edgeLessThanOneViewportAway) {\n         // Possibly less than one viewport away, scroll so that it becomes visible (including the margin)\n         align = 'auto';\n       } else {\n-        // More than one viewport away, scroll so that it is centered within the list,\n-        // unless the widget is larger than the viewport, in which case only scroll to\n-        // align with the top or bottom edge (automatically)\n+        // More than one viewport away, scroll so that it is centered within the list:\n+        // - if the item is smaller than viewport align the middle of the item with the middle of the viewport\n+        // - if the item is larger than viewport align the top of the item with the middle of the viewport\n         if (itemMetadata.size > size) {\n-          align = 'auto';\n+          align = 'top-center';\n         } else {\n           align = 'center';\n         }\n@@ -376,9 +405,11 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n     }\n \n     if (align === 'auto') {\n-      if (bottomEdge > itemBottom && topEdge < itemTop) {\n+      if (isFullyWithinViewport) {\n         // No need to change the position, return the current offset.\n-        return this._scrollOffset;\n+        return currentOffset;\n+      } else if (alignPreference !== undefined) {\n+        align = alignPreference;\n       } else if (crossingBottomEdge || bottomEdge <= itemBottom) {\n         align = 'end';\n       } else {\n@@ -388,13 +419,17 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n \n     switch (align) {\n       case 'start':\n-        // Align to the top edge.\n-        return Math.max(0, topOffset - boundedMargin * size) + this.paddingTop;\n+        // Align item top to the top edge.\n+        return Math.max(0, topOffset - boundedMargin * size) + viewportPadding;\n       case 'end':\n-        // Align to the bottom edge.\n-        return bottomOffset + boundedMargin * size + this.paddingTop;\n+        // Align item bottom to the bottom edge.\n+        return bottomOffset + boundedMargin * size + viewportPadding;\n       case 'center':\n-        return Math.round(bottomOffset + (topOffset - bottomOffset) / 2);\n+        // Align item centre to the middle of the viewport\n+        return bottomOffset + (topOffset - bottomOffset) / 2;\n+      case 'top-center':\n+        // Align item top to the middle of the viewport\n+        return topOffset - size / 2;\n     }\n   }\n \n@@ -764,7 +799,7 @@ export class WindowedList<\n     this._innerElement = innerElement;\n     this._isScrolling = null;\n     this._outerElement = outerElement;\n-    this._resizeObserver = null;\n+    this._itemsResizeObserver = null;\n     this._scrollbarElement = scrollbarElement;\n     this._scrollToItem = null;\n     this._scrollRepaint = null;\n@@ -877,7 +912,7 @@ export class WindowedList<\n    */\n   scrollTo(scrollOffset: number): void {\n     if (!this.viewModel.windowingActive) {\n-      this.node.scrollTo({ top: scrollOffset });\n+      this._outerElement.scrollTo({ top: scrollOffset });\n       return;\n     }\n \n@@ -894,35 +929,32 @@ export class WindowedList<\n   /**\n    * Scroll to the specified item.\n    *\n-   * By default, the list will scroll as little as possible to ensure the item is visible. You can control the alignment of the item though by specifying a second alignment parameter. Acceptable values are:\n+   * By default, the list will scroll as little as possible to ensure the item is fully visible (`auto`).\n+   * You can control the alignment of the item though by specifying a second alignment parameter.\n+   * Acceptable values are:\n    *\n-   *   auto (default) - Scroll as little as possible to ensure the item is visible. (If the item is already visible, it won't scroll at all.)\n-   *   smart - If the item is already visible (including the margin), don't scroll at all. If it is less than one viewport away, scroll so that it becomes visible (including the margin). If it is more than one viewport away, scroll so that it is centered within the list.\n-   *   center - Center align the item within the list.\n-   *   end - Align the item to the end of the list\n-   *   start - Align the item to the beginning of the list\n+   *   auto - Automatically align with the top or bottom minimising the amount scrolled,\n+   *          If `alignPreference` is given, follow such preferred alignment.\n+   *          If item is smaller than the viewport and fully visible, do not scroll at all.\n+   *   smart - If the item is significantly visible, don't scroll at all (regardless of whether it fits in the viewport).\n+   *           If the item is less than one viewport away, scroll so that it becomes fully visible (following the `auto` heuristics).\n+   *           If the item is more than one viewport away, scroll so that it is centered within the viewport (`center` if smaller than viewport, `top-center` otherwise).\n+   *   center - Align the middle of the item with the middle of the viewport (it only works well for items smaller than the viewport).\n+   *   top-center - Align the top of the item with the middle of the viewport (works well for items larger than the viewport).\n+   *   end - Align the bottom of the item to the bottom of the list.\n+   *   start - Align the top of item to the top of the list.\n    *\n    * @param index Item index to scroll to\n    * @param align Type of alignment\n    * @param margin In 'smart' mode the viewport proportion to add\n+   * @param alignPreference Allows to override the alignment of item when the `auto` heuristic decides that the item needs to be scrolled into view.\n    */\n   scrollToItem(\n     index: number,\n     align: WindowedList.ScrollToAlign = 'auto',\n-    margin: number = 0.25\n+    margin: number = 0.25,\n+    alignPreference?: WindowedList.BaseScrollToAlignment\n   ): Promise<void> {\n-    if (!this.viewModel.windowingActive) {\n-      const widget = this.layout.widgets[index];\n-      if (widget?.node.scrollIntoView) {\n-        widget.node.scrollIntoView({\n-          block: ['auto', 'smart'].includes(align)\n-            ? 'nearest'\n-            : (align as ScrollLogicalPosition)\n-        });\n-      }\n-      return Promise.resolve();\n-    }\n-\n     if (\n       !this._isScrolling ||\n       this._scrollToItem === null ||\n@@ -934,15 +966,41 @@ export class WindowedList<\n       }\n \n       this._isScrolling = new PromiseDelegate<void>();\n+      // Catch the internal reject, as otherwise this will\n+      // result in an unhandled promise rejection in test.\n+      this._isScrolling.promise.catch(console.debug);\n     }\n \n-    this._scrollToItem = [index, align];\n+    this._scrollToItem = [index, align, margin, alignPreference];\n+\n     this._resetScrollToItem();\n+\n+    let precomputed = undefined;\n+    if (!this.viewModel.windowingActive) {\n+      const item = this._innerElement.querySelector(\n+        `[data-windowed-list-index=\"${index}\"]`\n+      );\n+      if (!item || !(item instanceof HTMLElement)) {\n+        // Note: this can happen when scroll is requested when a cell is getting added\n+        console.debug(`Element with index ${index} not found`);\n+        return Promise.resolve();\n+      }\n+      precomputed = {\n+        totalSize: this._outerElement.scrollHeight,\n+        itemMetadata: {\n+          offset: item.offsetTop,\n+          size: item.clientHeight\n+        },\n+        currentOffset: this._outerElement.scrollTop\n+      };\n+    }\n     this.scrollTo(\n       this.viewModel.getOffsetForIndexAndAlignment(\n         Math.max(0, Math.min(index, this.viewModel.widgetCount - 1)),\n         align,\n-        margin\n+        margin,\n+        precomputed,\n+        alignPreference\n       )\n     );\n \n@@ -955,12 +1013,13 @@ export class WindowedList<\n   protected onAfterAttach(msg: Message): void {\n     super.onAfterAttach(msg);\n     if (this.viewModel.windowingActive) {\n-      this._addListeners();\n+      this._applyWindowingStyles();\n     } else {\n       this._applyNoWindowingStyles();\n     }\n+    this._addListeners();\n     this.viewModel.height = this.node.getBoundingClientRect().height;\n-    const style = window.getComputedStyle(this.node);\n+    const style = window.getComputedStyle(this._viewport);\n     this.viewModel.paddingTop = parseFloat(style.paddingTop);\n     this._scrollbarElement.addEventListener('pointerdown', this);\n   }\n@@ -969,9 +1028,7 @@ export class WindowedList<\n    * A message handler invoked on an `'before-detach'` message.\n    */\n   protected onBeforeDetach(msg: Message): void {\n-    if (this.viewModel.windowingActive) {\n-      this._removeListeners();\n-    }\n+    this._removeListeners();\n     this._scrollbarElement.removeEventListener('pointerdown', this);\n     super.onBeforeDetach(msg);\n   }\n@@ -1035,13 +1092,16 @@ export class WindowedList<\n   ): void {\n     switch (changes.name) {\n       case 'windowingActive':\n+        this._removeListeners();\n         if (this.viewModel.windowingActive) {\n-          this._addListeners();\n+          this._applyWindowingStyles();\n           this.onScroll({ currentTarget: this.node } as any);\n+          this._addListeners();\n           // Bail as onScroll will trigger update\n           return;\n         } else {\n-          this._removeListeners();\n+          this._applyNoWindowingStyles();\n+          this._addListeners();\n         }\n         break;\n     }\n@@ -1125,25 +1185,33 @@ export class WindowedList<\n    * Add listeners for viewport, contents and the virtual scrollbar.\n    */\n   private _addListeners() {\n-    if (!this._resizeObserver) {\n-      this._resizeObserver = new ResizeObserver(\n-        this._onWidgetResize.bind(this)\n-      );\n-    }\n-    for (const widget of this.layout.widgets) {\n-      this._resizeObserver.observe(widget.node);\n-      widget.disposed.connect(\n-        () => this._resizeObserver?.unobserve(widget.node)\n+    if (this.viewModel.windowingActive) {\n+      if (!this._itemsResizeObserver) {\n+        this._itemsResizeObserver = new ResizeObserver(\n+          this._onItemResize.bind(this)\n+        );\n+      }\n+      for (const widget of this.layout.widgets) {\n+        this._itemsResizeObserver.observe(widget.node);\n+        widget.disposed.connect(\n+          () => this._itemsResizeObserver?.unobserve(widget.node)\n+        );\n+      }\n+      this._outerElement.addEventListener('scroll', this, passiveIfSupported);\n+\n+      this._scrollbarResizeObserver = new ResizeObserver(\n+        this._adjustDimensionsForScrollbar.bind(this)\n       );\n+      this._scrollbarResizeObserver.observe(this._outerElement);\n+      this._scrollbarResizeObserver.observe(this._scrollbarElement);\n+    } else {\n+      if (!this._areaResizeObserver) {\n+        this._areaResizeObserver = new ResizeObserver(\n+          this._onAreaResize.bind(this)\n+        );\n+        this._areaResizeObserver.observe(this._innerElement);\n+      }\n     }\n-    this._outerElement.addEventListener('scroll', this, passiveIfSupported);\n-    this._viewport.style.position = 'absolute';\n-\n-    this._scrollbarResizeObserver = new ResizeObserver(\n-      this._adjustDimensionsForScrollbar.bind(this)\n-    );\n-    this._scrollbarResizeObserver.observe(this._outerElement);\n-    this._scrollbarResizeObserver.observe(this._scrollbarElement);\n   }\n \n   /**\n@@ -1153,17 +1221,24 @@ export class WindowedList<\n     this._viewport.style.position = 'relative';\n     this._viewport.style.top = '0px';\n   }\n+  /**\n+   * Turn on windowing related styles in the viewport.\n+   */\n+  private _applyWindowingStyles() {\n+    this._viewport.style.position = 'absolute';\n+  }\n \n   /**\n    * Remove listeners for viewport and contents (but not the virtual scrollbar).\n    */\n   private _removeListeners() {\n     this._outerElement.removeEventListener('scroll', this);\n-    this._resizeObserver?.disconnect();\n-    this._resizeObserver = null;\n+    this._areaResizeObserver?.disconnect();\n+    this._areaResizeObserver = null;\n+    this._itemsResizeObserver?.disconnect();\n+    this._itemsResizeObserver = null;\n     this._scrollbarResizeObserver?.disconnect();\n     this._scrollbarResizeObserver = null;\n-    this._applyNoWindowingStyles();\n   }\n \n   /**\n@@ -1190,17 +1265,19 @@ export class WindowedList<\n       // Remove not needed widgets\n       for (let itemIdx = nWidgets - 1; itemIdx >= 0; itemIdx--) {\n         if (!toAdd.includes(this.layout.widgets[itemIdx])) {\n-          this._resizeObserver?.unobserve(this.layout.widgets[itemIdx].node);\n+          this._itemsResizeObserver?.unobserve(\n+            this.layout.widgets[itemIdx].node\n+          );\n           this.layout.removeWidget(this.layout.widgets[itemIdx]);\n         }\n       }\n \n       for (let index = 0; index < toAdd.length; index++) {\n         const item = toAdd[index];\n-        if (this._resizeObserver && !this.layout.widgets.includes(item)) {\n-          this._resizeObserver.observe(item.node);\n+        if (this._itemsResizeObserver && !this.layout.widgets.includes(item)) {\n+          this._itemsResizeObserver.observe(item.node);\n           item.disposed.connect(\n-            () => this._resizeObserver?.unobserve(item.node)\n+            () => this._itemsResizeObserver?.unobserve(item.node)\n           );\n         }\n \n@@ -1256,9 +1333,16 @@ export class WindowedList<\n   }\n \n   /**\n-   * Handle viewport content (e.g. widgets) resize.\n+   * Handle viewport area resize.\n    */\n-  private _onWidgetResize(entries: ResizeObserverEntry[]): void {\n+  private _onAreaResize(_entries: ResizeObserverEntry[]): void {\n+    this._scrollBackToItemOnResize();\n+  }\n+\n+  /**\n+   * Handle viewport content (i.e. items) resize.\n+   */\n+  private _onItemResize(entries: ResizeObserverEntry[]): void {\n     this._resetScrollToItem();\n \n     if (this.isHidden || this.isParentHidden) {\n@@ -1283,17 +1367,39 @@ export class WindowedList<\n \n     // If some sizes changed\n     if (this.viewModel.setWidgetSize(newSizes)) {\n+      this._scrollBackToItemOnResize();\n       // Update the list\n-      if (this._scrollToItem) {\n-        this.scrollToItem(...this._scrollToItem).catch(reason => {\n-          console.log(reason);\n-        });\n-      }\n-\n       this.update();\n     }\n   }\n \n+  /**\n+   * Scroll to the item which was most recently requested.\n+   *\n+   * This method ensures that the app scrolls to the item even if a resize event\n+   * occurs shortly after the scroll. Consider the following sequence of events:\n+   *\n+   * 1. User is at the nth cell, presses Shift+Enter (run current cell and\n+   *    advance to next)\n+   * 2. App scrolls to the next (n+1) cell\n+   * 3. The nth cell finishes running and renders the output, pushing the\n+   *    (n+1) cell down out of view\n+   * 4. This triggers the resize observer, which calls this method and scrolls\n+   *    the (n+1) cell back into view\n+   *\n+   * On implementation level, this is ensured by scrolling to `this._scrollToItem`\n+   * which is cleared after a short timeout once the scrolling settles\n+   * (see `this._resetScrollToItem()`).\n+   */\n+  private _scrollBackToItemOnResize() {\n+    if (!this._scrollToItem) {\n+      return;\n+    }\n+    this.scrollToItem(...this._scrollToItem).catch(reason => {\n+      console.log(reason);\n+    });\n+  }\n+\n   /**\n    * Clear any outstanding timeout and enqueue scrolling to a new item.\n    */\n@@ -1358,11 +1464,19 @@ export class WindowedList<\n   private _needsUpdate = false;\n   private _outerElement: HTMLElement;\n   private _resetScrollToItemTimeout: number | null;\n-  private _resizeObserver: ResizeObserver | null;\n+  private _areaResizeObserver: ResizeObserver | null;\n+  private _itemsResizeObserver: ResizeObserver | null;\n   private _scrollbarElement: HTMLElement;\n   private _scrollbarResizeObserver: ResizeObserver | null;\n   private _scrollRepaint: number | null;\n-  private _scrollToItem: [number, WindowedList.ScrollToAlign] | null;\n+  private _scrollToItem:\n+    | [\n+        number,\n+        WindowedList.ScrollToAlign,\n+        number,\n+        WindowedList.BaseScrollToAlignment | undefined\n+      ]\n+    | null;\n   private _scrollUpdateWasRequested: boolean;\n   private _updater: Throttler;\n   private _viewModel: T;\n@@ -1582,23 +1696,38 @@ export namespace WindowedList {\n     /**\n      * Get the scroll offset to display an item in the viewport.\n      *\n-     * By default, the list will scroll as little as possible to ensure the item is visible. You can control the alignment of the item though by specifying a second alignment parameter. Acceptable values are:\n+     * By default, the list will scroll as little as possible to ensure the item is fully visible (`auto`).\n+     * You can control the alignment of the item though by specifying a second alignment parameter.\n+     * Acceptable values are:\n      *\n-     *   auto (default) - Scroll as little as possible to ensure the item is visible. (If the item is already visible, it won't scroll at all.)\n-     *   smart - If the item is already visible (including the margin), don't scroll at all. If it is less than one viewport away, scroll so that it becomes visible (including the margin). If it is more than one viewport away, scroll so that it is centered within the list.\n-     *   center - Center align the item within the list.\n-     *   end - Align the item to the end of the list\n-     *   start - Align the item to the beginning of the list\n+     *   auto - Automatically align with the top or bottom minimising the amount scrolled,\n+     *          If `alignPreference` is given, follow such preferred alignment.\n+     *          If item is smaller than the viewport and fully visible, do not scroll at all.\n+     *   smart - If the item is significantly visible, don't scroll at all (regardless of whether it fits in the viewport).\n+     *           If the item is less than one viewport away, scroll so that it becomes fully visible (following the `auto` heuristics).\n+     *           If the item is more than one viewport away, scroll so that it is centered within the viewport (`center` if smaller than viewport, `top-center` otherwise).\n+     *   center - Align the middle of the item with the middle of the viewport (it only works well for items smaller than the viewport).\n+     *   top-center - Align the top of the item with the middle of the viewport (works well for items larger than the viewport).\n+     *   end - Align the bottom of the item to the bottom of the list.\n+     *   start - Align the top of item to the top of the list.\n      *\n      * @param index Item index\n      * @param align Where to align the item in the viewport\n      * @param margin In 'smart' mode the viewport proportion to add\n+     * @param precomputed Precomputed values to use when windowing is disabled.\n+     * @param alignPreference Allows to override the alignment of item when the `auto` heuristic decides that the item needs to be scrolled into view.\n      * @returns The needed scroll offset\n      */\n     getOffsetForIndexAndAlignment(\n       index: number,\n       align?: ScrollToAlign,\n-      margin?: number\n+      margin?: number,\n+      precomputed?: {\n+        totalSize: number;\n+        itemMetadata: WindowedList.ItemMetadata;\n+        currentOffset: number;\n+      },\n+      alignPreference?: WindowedList.BaseScrollToAlignment\n     ): number;\n \n     /**\n@@ -1810,9 +1939,14 @@ export namespace WindowedList {\n   };\n \n   /**\n-   * Type of scroll\n+   * Basic type of scroll alignment\n+   */\n+  export type BaseScrollToAlignment = 'center' | 'top-center' | 'start' | 'end';\n+\n+  /**\n+   * Type of scroll alignment including `auto` and `smart`\n    */\n-  export type ScrollToAlign = 'auto' | 'smart' | 'center' | 'start' | 'end';\n+  export type ScrollToAlign = 'auto' | 'smart' | BaseScrollToAlignment;\n \n   /**\n    * Widget range in view port\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts b/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts\nnew file mode 100644\nindex 000000000000..d1c504f3c1e9\n--- /dev/null\n+++ b/galata/test/jupyterlab/notebook-scroll-no-windowing.test.ts\n@@ -0,0 +1,227 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { expect, galata, test } from '@jupyterlab/galata';\n+import * as path from 'path';\n+\n+import {\n+  notebookViewportRatio,\n+  positionCellPartiallyBelowViewport\n+} from './utils';\n+\n+const fileName = 'scroll.ipynb';\n+const longOutputsNb = 'long_outputs.ipynb';\n+\n+test.use({\n+  mockSettings: {\n+    ...galata.DEFAULT_SETTINGS,\n+    '@jupyterlab/notebook-extension:tracker': {\n+      ...galata.DEFAULT_SETTINGS['@jupyterlab/notebook-extension:tracker'],\n+      windowingMode: 'none'\n+    }\n+  }\n+});\n+\n+test.describe('Notebook scroll on navigation (no windowing)', () => {\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${fileName}`),\n+      `${tmpPath}/${fileName}`\n+    );\n+\n+    await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n+    await page.notebook.activate(fileName);\n+  });\n+\n+  test.afterEach(async ({ page, tmpPath }) => {\n+    await page.contents.deleteDirectory(tmpPath);\n+  });\n+\n+  const cellLinks = {\n+    'penultimate cell using heading, legacy format': 18,\n+    'penultimate cell using heading, explicit fragment': 18,\n+    'last cell using heading, legacy format': 19,\n+    'last cell using heading, explicit fragment': 19,\n+    'last cell using cell identifier': 19\n+  };\n+  for (const [link, cellIdx] of Object.entries(cellLinks)) {\n+    test(`Scroll to ${link}`, async ({ page }) => {\n+      const firstCellLocator = page.locator(\n+        '.jp-Cell[data-windowed-list-index=\"0\"]'\n+      );\n+      const lastCellLocator = page.locator(\n+        `.jp-Cell[data-windowed-list-index=\"${cellIdx}\"]`\n+      );\n+      await firstCellLocator.scrollIntoViewIfNeeded();\n+\n+      await page.click(`a:has-text(\"${link}\")`);\n+\n+      await expect(firstCellLocator).not.toBeInViewport();\n+      await expect(lastCellLocator).toBeInViewport();\n+    });\n+  }\n+});\n+\n+test.describe('Notebook scroll on execution (no windowing)', () => {\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${longOutputsNb}`),\n+      `${tmpPath}/${longOutputsNb}`\n+    );\n+\n+    await page.notebook.openByPath(`${tmpPath}/${longOutputsNb}`);\n+    await page.notebook.activate(longOutputsNb);\n+  });\n+\n+  test.afterEach(async ({ page, tmpPath }) => {\n+    await page.contents.deleteDirectory(tmpPath);\n+  });\n+\n+  test('should scroll when advancing if top is only marginally visible', async ({\n+    page\n+  }) => {\n+    const notebook = await page.notebook.getNotebookInPanel();\n+    const thirdCell = await page.notebook.getCell(2);\n+\n+    await positionCellPartiallyBelowViewport(page, notebook, thirdCell, 0.01);\n+    // Select second cell\n+    await page.notebook.selectCells(1);\n+\n+    const thirdCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"2\"]'\n+    );\n+    // The third cell should be positioned at the bottom, revealing between 0 to 2% of its content.\n+    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.0 });\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.02 });\n+    // Only a small fraction of notebook viewport should be taken up by that cell\n+    expect(await notebookViewportRatio(notebook, thirdCell)).toBeLessThan(0.1);\n+\n+    // Run second cell\n+    await page.notebook.runCell(1);\n+\n+    // After running the second cell, the third cell should be revealed, in at least 10%\n+    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.1 });\n+\n+    // The third cell should now occupy about half of the notebook viewport\n+    expect(await notebookViewportRatio(notebook, thirdCell)).toBeGreaterThan(\n+      0.4\n+    );\n+  });\n+\n+  test('should not scroll when advancing if top is non-marginally visible', async ({\n+    page\n+  }) => {\n+    const notebook = await page.notebook.getNotebookInPanel();\n+    const thirdCell = await page.notebook.getCell(2);\n+\n+    await positionCellPartiallyBelowViewport(page, notebook, thirdCell, 0.15);\n+    // Select second cell\n+    await page.notebook.selectCells(1);\n+\n+    const thirdCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"2\"]'\n+    );\n+    // The third cell should be positioned at the bottom, revealing between 10 to 20% of its content.\n+    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.1 });\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+    // This cell should initially take up between 30% and 50% of the notebook viewport\n+    let spaceTaken = await notebookViewportRatio(notebook, thirdCell);\n+    expect(spaceTaken).toBeGreaterThan(0.3);\n+    expect(spaceTaken).toBeLessThan(0.5);\n+\n+    // Run second cell\n+    await page.notebook.runCell(1);\n+    // After running the second cell, the third cell should not be scrolled\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+    // The cell should still take up between 30% and 50% of the notebook viewport\n+    spaceTaken = await notebookViewportRatio(notebook, thirdCell);\n+    expect(spaceTaken).toBeGreaterThan(0.3);\n+    expect(spaceTaken).toBeLessThan(0.5);\n+  });\n+\n+  test('should not scroll when running in-place', async ({ page }) => {\n+    const notebook = await page.notebook.getNotebookInPanel();\n+    const thirdCell = await page.notebook.getCell(2);\n+\n+    await positionCellPartiallyBelowViewport(page, notebook, thirdCell, 0.15);\n+    // Select third cell\n+    await page.notebook.enterCellEditingMode(2);\n+\n+    const thirdCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"2\"]'\n+    );\n+    // The third cell should be positioned at the bottom, revealing between 10 to 20% of its content.\n+    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.1 });\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+\n+    // Run third cell in-place\n+    await page.notebook.runCell(2, true);\n+    // After running the third cell it should not be scrolled\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+\n+    // The galata implementation of `page.notebook.runCell(2, true);`\n+    // first switches to command mode before cell execution,\n+    // so we want to also check if this works from edit mode too.\n+    await page.keyboard.press('Control+Enter');\n+\n+    // After running the third cell it should not be scrolled\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+  });\n+});\n+\n+test.describe('Notebook scroll over long outputs (no windowing)', () => {\n+  const outputAndHeading = 'long_output_and_headings.ipynb';\n+  test.beforeEach(async ({ page, tmpPath }) => {\n+    await page.contents.uploadFile(\n+      path.resolve(__dirname, `./notebooks/${outputAndHeading}`),\n+      `${tmpPath}/${outputAndHeading}`\n+    );\n+\n+    await page.notebook.openByPath(`${tmpPath}/${outputAndHeading}`);\n+    await page.notebook.activate(outputAndHeading);\n+  });\n+\n+  test.afterEach(async ({ page, tmpPath }) => {\n+    await page.contents.deleteDirectory(tmpPath);\n+  });\n+\n+  test('should scroll smoothly without snapping to headings', async ({\n+    page\n+  }) => {\n+    const renderedMarkdownLocator = page.locator(\n+      '.jp-Cell .jp-RenderedMarkdown:has-text(\"Before\")'\n+    );\n+    // Wait until Markdown cells are rendered\n+    await renderedMarkdownLocator.waitFor({ timeout: 100 });\n+    // Un-render the \"before\" markdown cell\n+    await renderedMarkdownLocator.dblclick();\n+    // Make the first cell active\n+    await page.notebook.selectCells(0);\n+    // Check that that the markdown cell is un-rendered\n+    await renderedMarkdownLocator.waitFor({ state: 'hidden', timeout: 100 });\n+\n+    // Scroll to the last cell\n+    const lastCell = await page.notebook.getCell(10);\n+    await lastCell.scrollIntoViewIfNeeded();\n+\n+    // Get the outer window\n+    const outer = page.locator('.jp-WindowedPanel-outer');\n+\n+    let previousOffset = await outer.evaluate(node => node.scrollTop);\n+    expect(previousOffset).toBeGreaterThan(1000);\n+\n+    // Scroll piece by piece checking that there is no jump\n+    while (previousOffset > 75) {\n+      await page.mouse.wheel(0, -100);\n+      // Explicit wait because mouse wheel does not wait for scrolling.\n+      await page.waitForTimeout(150);\n+      const offset = await outer.evaluate(node => node.scrollTop);\n+      const diff = previousOffset - offset;\n+      // The scroll should be by about 100px, but because wheel event\n+      // does not wait we allow for some wiggle room (+/-25px).\n+      expect(diff).toBeLessThanOrEqual(125);\n+      expect(diff).toBeGreaterThan(75);\n+      previousOffset = offset;\n+    }\n+  });\n+});\n\ndiff --git a/galata/test/jupyterlab/notebook-scroll.test.ts b/galata/test/jupyterlab/notebook-scroll.test.ts\nindex 52bce8356ecf..61fb55b815d2 100644\n--- a/galata/test/jupyterlab/notebook-scroll.test.ts\n+++ b/galata/test/jupyterlab/notebook-scroll.test.ts\n@@ -2,9 +2,13 @@\n // Distributed under the terms of the Modified BSD License.\n \n import { expect, galata, test } from '@jupyterlab/galata';\n-import { ElementHandle } from '@playwright/test';\n import * as path from 'path';\n \n+import {\n+  notebookViewportRatio,\n+  positionCellPartiallyBelowViewport\n+} from './utils';\n+\n const fileName = 'scroll.ipynb';\n const longOutputsNb = 'long_outputs.ipynb';\n \n@@ -18,7 +22,7 @@ test.use({\n   }\n });\n \n-test.describe('Notebook scroll on navigation', () => {\n+test.describe('Notebook scroll on navigation (with windowing)', () => {\n   test.beforeEach(async ({ page, tmpPath }) => {\n     await page.contents.uploadFile(\n       path.resolve(__dirname, `./notebooks/${fileName}`),\n@@ -42,20 +46,23 @@ test.describe('Notebook scroll on navigation', () => {\n   };\n   for (const [link, cellIdx] of Object.entries(cellLinks)) {\n     test(`Scroll to ${link}`, async ({ page }) => {\n-      const firstCell = await page.notebook.getCell(0);\n-      await firstCell.scrollIntoViewIfNeeded();\n+      const firstCellLocator = page.locator(\n+        '.jp-Cell[data-windowed-list-index=\"0\"]'\n+      );\n+      const lastCellLocator = page.locator(\n+        `.jp-Cell[data-windowed-list-index=\"${cellIdx}\"]`\n+      );\n+      await firstCellLocator.scrollIntoViewIfNeeded();\n \n       await page.click(`a:has-text(\"${link}\")`);\n \n-      await firstCell.waitForElementState('hidden');\n-\n-      const lastCell = await page.notebook.getCell(cellIdx);\n-      await lastCell.waitForElementState('visible');\n+      await expect(firstCellLocator).not.toBeInViewport();\n+      await expect(lastCellLocator).toBeInViewport();\n     });\n   }\n });\n \n-test.describe('Notebook scroll on execution', () => {\n+test.describe('Notebook scroll on execution (with windowing)', () => {\n   test.beforeEach(async ({ page, tmpPath }) => {\n     await page.contents.uploadFile(\n       path.resolve(__dirname, `./notebooks/${longOutputsNb}`),\n@@ -76,18 +83,7 @@ test.describe('Notebook scroll on execution', () => {\n     const notebook = await page.notebook.getNotebookInPanel();\n     const thirdCell = await page.notebook.getCell(2);\n \n-    const scroller = (await notebook.$(\n-      '.jp-WindowedPanel-outer'\n-    )) as ElementHandle<HTMLElement>;\n-    const notebookBbox = await scroller.boundingBox();\n-    const thirdCellBBox = await thirdCell.boundingBox();\n-    await page.mouse.move(notebookBbox.x, notebookBbox.y);\n-    const scrollOffset =\n-      thirdCellBBox.y -\n-      notebookBbox.y -\n-      notebookBbox.height +\n-      thirdCellBBox.height * 0.01;\n-    await Promise.all([page.mouse.wheel(0, scrollOffset)]);\n+    await positionCellPartiallyBelowViewport(page, notebook, thirdCell, 0.01);\n     // Select second cell\n     await page.notebook.selectCells(1);\n \n@@ -97,11 +93,19 @@ test.describe('Notebook scroll on execution', () => {\n     // The third cell should be positioned at the bottom, revealing between 0 to 2% of its content.\n     await expect(thirdCellLocator).toBeInViewport({ ratio: 0.0 });\n     await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.02 });\n+    // Only a small fraction of notebook viewport should be taken up by that cell\n+    expect(await notebookViewportRatio(notebook, thirdCell)).toBeLessThan(0.1);\n \n     // Run second cell\n     await page.notebook.runCell(1);\n-    // After running the second cell, the third cell should be revealed, in at least 25%\n-    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.25 });\n+\n+    // After running the second cell, the third cell should be revealed, in at least 10%\n+    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.1 });\n+\n+    // The third cell should now occupy about half of the notebook viewport\n+    expect(await notebookViewportRatio(notebook, thirdCell)).toBeGreaterThan(\n+      0.4\n+    );\n   });\n \n   test('should not scroll when advancing if top is non-marginally visible', async ({\n@@ -110,18 +114,7 @@ test.describe('Notebook scroll on execution', () => {\n     const notebook = await page.notebook.getNotebookInPanel();\n     const thirdCell = await page.notebook.getCell(2);\n \n-    const scroller = (await notebook.$(\n-      '.jp-WindowedPanel-outer'\n-    )) as ElementHandle<HTMLElement>;\n-    const notebookBbox = await scroller.boundingBox();\n-    const thirdCellBBox = await thirdCell.boundingBox();\n-    await page.mouse.move(notebookBbox.x, notebookBbox.y);\n-    const scrollOffset =\n-      thirdCellBBox.y -\n-      notebookBbox.y -\n-      notebookBbox.height +\n-      thirdCellBBox.height * 0.15;\n-    await Promise.all([page.mouse.wheel(0, scrollOffset)]);\n+    await positionCellPartiallyBelowViewport(page, notebook, thirdCell, 0.15);\n     // Select second cell\n     await page.notebook.selectCells(1);\n \n@@ -131,15 +124,52 @@ test.describe('Notebook scroll on execution', () => {\n     // The third cell should be positioned at the bottom, revealing between 10 to 20% of its content.\n     await expect(thirdCellLocator).toBeInViewport({ ratio: 0.1 });\n     await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+    // This cell should initially take up between 30% and 50% of the notebook viewport\n+    let spaceTaken = await notebookViewportRatio(notebook, thirdCell);\n+    expect(spaceTaken).toBeGreaterThan(0.3);\n+    expect(spaceTaken).toBeLessThan(0.5);\n \n     // Run second cell\n     await page.notebook.runCell(1);\n     // After running the second cell, the third cell should not be scrolled\n     await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+    // The cell should still take up between 30% and 50% of the notebook viewport\n+    spaceTaken = await notebookViewportRatio(notebook, thirdCell);\n+    expect(spaceTaken).toBeGreaterThan(0.3);\n+    expect(spaceTaken).toBeLessThan(0.5);\n+  });\n+\n+  test('should not scroll when running in-place', async ({ page }) => {\n+    const notebook = await page.notebook.getNotebookInPanel();\n+    const thirdCell = await page.notebook.getCell(2);\n+\n+    await positionCellPartiallyBelowViewport(page, notebook, thirdCell, 0.15);\n+    // Select third cell\n+    await page.notebook.enterCellEditingMode(2);\n+\n+    const thirdCellLocator = page.locator(\n+      '.jp-Cell[data-windowed-list-index=\"2\"]'\n+    );\n+    // The third cell should be positioned at the bottom, revealing between 10 to 20% of its content.\n+    await expect(thirdCellLocator).toBeInViewport({ ratio: 0.1 });\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+\n+    // Run third cell in-place\n+    await page.notebook.runCell(2, true);\n+    // After running the third cell it should not be scrolled\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n+\n+    // The galata implementation of `page.notebook.runCell(2, true);`\n+    // first switches to command mode before cell execution,\n+    // so we want to also check if this works from edit mode too.\n+    await page.keyboard.press('Control+Enter');\n+\n+    // After running the third cell it should not be scrolled\n+    await expect(thirdCellLocator).not.toBeInViewport({ ratio: 0.2 });\n   });\n });\n \n-test.describe('Notebook scroll over long outputs', () => {\n+test.describe('Notebook scroll over long outputs (with windowing)', () => {\n   const outputAndHeading = 'long_output_and_headings.ipynb';\n   test.beforeEach(async ({ page, tmpPath }) => {\n     await page.contents.uploadFile(\n\ndiff --git a/galata/test/jupyterlab/utils.ts b/galata/test/jupyterlab/utils.ts\nnew file mode 100644\nindex 000000000000..1fb2568a5816\n--- /dev/null\n+++ b/galata/test/jupyterlab/utils.ts\n@@ -0,0 +1,51 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+import { IJupyterLabPageFixture } from '@jupyterlab/galata';\n+import { ElementHandle } from '@playwright/test';\n+\n+const OUTER_SELECTOR = '.jp-WindowedPanel-outer';\n+\n+/**\n+ * Measure how much of the **notebook** viewport does a cell take up.\n+ */\n+export async function notebookViewportRatio(\n+  notebook: ElementHandle,\n+  cell: ElementHandle\n+): Promise<number> {\n+  const scroller = (await notebook.$(\n+    OUTER_SELECTOR\n+  )) as ElementHandle<HTMLElement>;\n+  const n = await scroller.boundingBox();\n+  const c = await cell.boundingBox();\n+  const cellBottom = c.y + c.height;\n+  const cellTop = c.y;\n+  const notebookBottom = n.y + n.height;\n+  const notebookTop = n.y;\n+  const visibleBottom =\n+    notebookBottom > cellBottom ? cellBottom - notebookTop : 0;\n+  const visibleTop = cellTop > notebookTop ? notebookBottom - cellTop : 0;\n+  const intersection =\n+    notebookBottom > cellBottom && cellTop > notebookTop\n+      ? n.height\n+      : visibleBottom + visibleTop;\n+  return intersection / n.height;\n+}\n+/**\n+ * Scroll so that the given cell is below the viewport, revealing only a given `ratio` of the cell.\n+ */\n+export async function positionCellPartiallyBelowViewport(\n+  page: IJupyterLabPageFixture,\n+  notebook: ElementHandle,\n+  cell: ElementHandle,\n+  ratio: number\n+): Promise<void> {\n+  const scroller = (await notebook.$(\n+    OUTER_SELECTOR\n+  )) as ElementHandle<HTMLElement>;\n+  const notebookBbox = await scroller.boundingBox();\n+  const cellBbox = await cell.boundingBox();\n+  await page.mouse.move(notebookBbox.x, notebookBbox.y);\n+  const scrollOffset =\n+    cellBbox.y - notebookBbox.y - notebookBbox.height + cellBbox.height * ratio;\n+  await page.mouse.wheel(0, scrollOffset);\n+}\n\ndiff --git a/galata/test/jupyterlab/windowed-notebook.test.ts b/galata/test/jupyterlab/windowed-notebook.test.ts\nindex b3233de9e907..c36864b890cf 100644\n--- a/galata/test/jupyterlab/windowed-notebook.test.ts\n+++ b/galata/test/jupyterlab/windowed-notebook.test.ts\n@@ -328,32 +328,38 @@ test('should remove all cells including hidden outputs artifacts', async ({\n   expect(found).toEqual(false);\n });\n \n-test('should scroll as little as possible on markdown rendering', async ({\n+test('should center on next cell after rendering markdown cell and advancing', async ({\n   page,\n   tmpPath\n }) => {\n   await page.notebook.openByPath(`${tmpPath}/${fileName}`);\n-  const h = await page.notebook.getNotebookInPanel();\n-  const mdCell = await h.waitForSelector(\n-    '.jp-MarkdownCell[data-windowed-list-index=\"2\"]'\n-  );\n+  const mdCell = page.locator('.jp-MarkdownCell[data-windowed-list-index=\"2\"]');\n+  const thirdCell = page.locator('.jp-CodeCell[data-windowed-list-index=\"3\"]');\n+  const fourthCell = page.locator('.jp-RawCell[data-windowed-list-index=\"4\"]');\n \n   await page\n     .locator('.jp-Notebook-ExecutionIndicator[data-status=\"idle\"]')\n     .waitFor();\n \n-  await mdCell.click();\n-\n-  const thirdCell = page.locator('.jp-CodeCell[data-windowed-list-index=\"3\"]');\n-  const fourthCell = page.locator('.jp-RawCell[data-windowed-list-index=\"4\"]');\n+  // Un-render markdown cell\n+  await page.notebook.enterCellEditingMode(2);\n \n+  // The next cells should not be (significantly) visible (yet)\n   await expect.soft(thirdCell).not.toBeInViewport({ ratio: 0.1 });\n   await expect.soft(fourthCell).not.toBeInViewport();\n \n+  // Render current (markdown) cell and advance\n   await page.keyboard.press('Shift+Enter');\n \n-  await expect(thirdCell).toBeInViewport();\n-  await expect(fourthCell).not.toBeInViewport({ ratio: 0.1 });\n+  // The notebook should advance to next (third) cell and make it fully visible\n+  await expect(thirdCell).toBeInViewport({ ratio: 1 });\n+\n+  // Because the third cell is not larger than the notebook viewport,\n+  // the surrounding cells should be visible after it got centered:\n+  // - the previous cell should still be visible\n+  await expect(mdCell).toBeInViewport({ ratio: 1 });\n+  // - the next cell should now be visible too\n+  await expect(fourthCell).toBeInViewport({ ratio: 1 });\n });\n \n test('should rendered injected styles of out-of-viewport cells', async ({\n\ndiff --git a/packages/notebook/test/actions.spec.ts b/packages/notebook/test/actions.spec.ts\nindex f53914f29f94..d4f230c89e6d 100644\n--- a/packages/notebook/test/actions.spec.ts\n+++ b/packages/notebook/test/actions.spec.ts\n@@ -162,7 +162,7 @@ describe('@jupyterlab/notebook', () => {\n       });\n     });\n \n-    describe('#splitCell({})', () => {\n+    describe('#splitCell()', () => {\n       it('should split the active cell into two cells', () => {\n         const cell = widget.activeCell!;\n         const source = 'thisisasamplestringwithnospaces';\n\ndiff --git a/packages/testing/src/jest-shim.ts b/packages/testing/src/jest-shim.ts\nindex 806d7ec1482b..fbcacc5c6bcd 100644\n--- a/packages/testing/src/jest-shim.ts\n+++ b/packages/testing/src/jest-shim.ts\n@@ -57,6 +57,34 @@ window.focus = () => {\n   /* JSDom throws \"Not Implemented\" */\n };\n \n+/**\n+ * Shim scrollTo because jsdom still does not implement a shim for it, see:\n+ * https://github.com/jsdom/jsdom/issues/2751\n+ */\n+window.Element.prototype.scrollTo = (\n+  _optionsOrX?: ScrollToOptions | number\n+) => {\n+  // no-op\n+};\n+\n+// https://github.com/jsdom/jsdom/issues/3368\n+class ResizeObserverMock {\n+  constructor(_callback: any) {\n+    // no-op\n+  }\n+  observe(_target: any, _options?: any) {\n+    // no-op\n+  }\n+  unobserve(_target: any) {\n+    // no-op\n+  }\n+  disconnect() {\n+    // no-op\n+  }\n+}\n+\n+window.ResizeObserver = ResizeObserverMock;\n+\n (window as any).document.elementFromPoint = (left: number, top: number) =>\n   document.body;\n \n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15690",
    "pr_id": 15690,
    "issue_id": 15688,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Search highlights don't get removed when removing the search query\n\r\n## Description\r\nThe search queries remain highlighted after removing the search query. Here's a gif - \r\n![search](https://github.com/jupyterlab/jupyterlab/assets/30082866/301e6371-0647-4efa-905e-a99bfae4d57c)\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\n\r\n- JupyterLab version: 4.1.0b2\r\n\r\n",
    "issue_word_count": 66,
    "test_files_count": 2,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-search.test.ts",
      "packages/documentsearch/src/searchmodel.ts",
      "packages/documentsearch/test/searchmodel.spec.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-search.test.ts",
      "packages/documentsearch/test/searchmodel.spec.ts"
    ],
    "base_commit": "ae54125a155946e6aa817bc9d8ea21cd0b497631",
    "head_commit": "f86ffaff28eb1f94db2c89e35917eb317fe7b077",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15690",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15690",
    "dockerfile": "",
    "pr_merged_at": "2024-01-29T22:06:59.000Z",
    "patch": "diff --git a/packages/documentsearch/src/searchmodel.ts b/packages/documentsearch/src/searchmodel.ts\nindex b20a20b859fb..6b12c790091c 100644\n--- a/packages/documentsearch/src/searchmodel.ts\n+++ b/packages/documentsearch/src/searchmodel.ts\n@@ -357,9 +357,12 @@ export class SearchDocumentModel\n       if (query) {\n         this._searchActive = true;\n         await this.searchProvider.startQuery(query, this._filters);\n-        // Emit state change as the index needs to be updated\n-        this.stateChanged.emit();\n+      } else {\n+        this._searchActive = false;\n+        await this.searchProvider.endQuery();\n       }\n+      // Emit state change as the index needs to be updated\n+      this.stateChanged.emit();\n     } catch (reason) {\n       this._parsingError = reason.toString();\n       this.stateChanged.emit();\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-search.test.ts b/galata/test/jupyterlab/notebook-search.test.ts\nindex 8f72b280f8c4..b9f6679f0d88 100644\n--- a/galata/test/jupyterlab/notebook-search.test.ts\n+++ b/galata/test/jupyterlab/notebook-search.test.ts\n@@ -177,6 +177,28 @@ test.describe('Notebook Search', () => {\n     await page.waitForSelector('text=1/2');\n   });\n \n+  test('Clear search when box is empty', async ({ page }) => {\n+    // Open search box\n+    await page.keyboard.press('Control+f');\n+\n+    // Search for \"test\"\n+    await page.keyboard.press('Control+f');\n+    await page.fill('[placeholder=\"Find\"]', 'test');\n+\n+    // Should find \"test\" matches\n+    await page.locator('text=1/2').waitFor();\n+    await expect(page.locator('[placeholder=\"Find\"]')).toHaveValue('test');\n+\n+    // Remove the \"test\" query\n+    for (let i = 0; i < 4; i++) {\n+      await page.press('[placeholder=\"Find\"]', 'Backspace');\n+    }\n+    await expect(page.locator('[placeholder=\"Find\"]')).toHaveValue('');\n+\n+    // Should reset the search to a clean state\n+    await page.locator('text=-/-').waitFor();\n+  });\n+\n   test('Close with Escape', async ({ page }) => {\n     // Open search box\n     await page.keyboard.press('Control+f');\n\ndiff --git a/packages/documentsearch/test/searchmodel.spec.ts b/packages/documentsearch/test/searchmodel.spec.ts\nindex 57d6ce692600..4a0adf8ea7a6 100644\n--- a/packages/documentsearch/test/searchmodel.spec.ts\n+++ b/packages/documentsearch/test/searchmodel.spec.ts\n@@ -10,21 +10,30 @@ import { signalToPromise } from '@jupyterlab/testing';\n \n class LogSearchProvider extends GenericSearchProvider {\n   private _queryReceived: PromiseDelegate<RegExp | null>;\n+  private _queryEnded: PromiseDelegate<void>;\n   private _initialQuery: string = 'unset';\n \n   constructor(widget: Widget) {\n     super(widget);\n     this._queryReceived = new PromiseDelegate();\n+    this._queryEnded = new PromiseDelegate();\n   }\n   get queryReceived(): Promise<RegExp | null> {\n     return this._queryReceived.promise;\n   }\n+  get queryEnded(): Promise<void> {\n+    return this._queryEnded.promise;\n+  }\n \n   async startQuery(query: RegExp | null, filters = {}): Promise<void> {\n     this._queryReceived.resolve(query);\n     this._queryReceived = new PromiseDelegate();\n   }\n \n+  async endQuery(): Promise<void> {\n+    this._queryEnded.resolve();\n+  }\n+\n   set initialQuery(query: string) {\n     this._initialQuery = query;\n   }\n@@ -60,6 +69,16 @@ describe('documentsearch/searchmodel', () => {\n         expect(query.test('test')).toEqual(false);\n         query.lastIndex = 0;\n       });\n+      it('should end search when query is empty', async () => {\n+        // Start a search\n+        model.searchExpression = 'query';\n+        expect(model.searchExpression).toEqual('query');\n+        await provider.queryReceived;\n+        // Empty the query\n+        model.searchExpression = '';\n+        await provider.queryEnded;\n+        expect(model.searchExpression).toEqual('');\n+      });\n     });\n \n     describe('#parsingError', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15661",
    "pr_id": 15661,
    "issue_id": 15660,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Mermaid.js state diagrams do not always render in Windows\nI have had some mermaid diagrams work, but many don't.\r\n\r\n\r\n\r\nI setup a new environment to test the beta:\r\n```bash\r\nconda create -n lab_b1\r\nconda activate lab_b1\r\nconda install -c conda-forge/label/jupyterlab_beta -c conda-forge jupyterlab\r\njupyterlab \r\n```\r\n\r\nI was working through some examples on https://mermaid.js.org/ and noticed a lot of them don't work in jupyterlab.\r\n\r\n## Example 1\r\n\r\nOn this page:\r\nhttps://mermaid.js.org/syntax/stateDiagram.html\r\n\r\nThis is what that site shows:\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/1798497/ecc153eb-6c8f-4cb3-8d5b-e3cb9abb6bce)\r\n\r\n\r\nHere is the code:\r\n```\r\n---\r\ntitle: Simple sample\r\n---\r\nstateDiagram-v2\r\n    [*] --> Still\r\n    Still --> [*]\r\n\r\n    Still --> Moving\r\n    Moving --> Still\r\n    Moving --> Crash\r\n    Crash --> [*]\r\n```\r\n\r\nHere is what jupyterlab renders:\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/1798497/f3210b1c-89cf-4cf4-8fe0-5ac6e673c8f3)\r\n\r\n\r\n\r\n## Example 2\r\n\r\nOn this page:\r\nhttps://mermaid.js.org/syntax/classDiagram.html\r\nI see this:\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/1798497/383fd85f-8fcf-482d-b346-57448c9d7dfe)\r\n\r\n\r\nHere is the code:\r\n```\r\n---\r\ntitle: Animal example\r\n---\r\nclassDiagram\r\n    note \"From Duck till Zebra\"\r\n    Animal <|-- Duck\r\n    note for Duck \"can fly\\ncan swim\\ncan dive\\ncan help in debugging\"\r\n    Animal <|-- Fish\r\n    Animal <|-- Zebra\r\n    Animal : +int age\r\n    Animal : +String gender\r\n    Animal: +isMammal()\r\n    Animal: +mate()\r\n    class Duck{\r\n        +String beakColor\r\n        +swim()\r\n        +quack()\r\n    }\r\n    class Fish{\r\n        -int sizeInFeet\r\n        -canEat()\r\n    }\r\n    class Zebra{\r\n        +bool is_wild\r\n        +run()\r\n    }\r\n```\r\n\r\nThis is what jupyterlab renders:\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/1798497/d14e3633-a7ed-4684-8eee-23d940a17db4)\r\n\r\n## Example 3\r\n\r\nOn this page:\r\nhttps://mermaid.js.org/syntax/sequenceDiagram.html\r\nI see this:\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/1798497/01deeffd-1b06-49e8-af3e-0365bef984ce)\r\n\r\nHere is the code:\r\n```\r\nsequenceDiagram\r\n    Alice->>Bob: Hello Bob, how are you ?\r\n    Bob->>Alice: Fine, thank you. And you?\r\n    create participant Carl\r\n    Alice->>Carl: Hi Carl!\r\n    create actor D as Donald\r\n    Carl->>D: Hi!\r\n    destroy Carl\r\n    Alice-xCarl: We are too many\r\n    destroy Bob\r\n    Bob->>Alice: I agree\r\n```\r\n\r\nThis is what jupyterlab renders:\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/1798497/20fdfb14-c2e5-4328-949d-b59005d940f8)\r\n",
    "issue_word_count": 337,
    "test_files_count": 35,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-00-flowchart-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-01-sequence-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-02-class-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-03-state-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-04-er-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-05-journey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-06-gantt-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-07-pie-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-08-quadrant-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-09-requirement-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-10-c4-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-11-mindmap-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-12-timeline-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-13-sankey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-14-xy-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-00-flowchart-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-01-sequence-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-02-class-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-03-state-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-04-er-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-05-journey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-06-gantt-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-07-pie-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-08-quadrant-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-09-requirement-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-10-c4-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-11-mindmap-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-12-timeline-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-13-sankey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-14-xy-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebooks/mermaid_diagrams.ipynb",
      "packages/mermaid/src/manager.ts",
      "packages/mermaid/test/clean.spec.ts",
      "packages/mermaid/test/renderer.spec.ts",
      "packages/mermaid/test/utils.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-00-flowchart-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-01-sequence-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-02-class-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-03-state-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-04-er-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-05-journey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-06-gantt-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-07-pie-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-08-quadrant-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-09-requirement-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-10-c4-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-11-mindmap-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-12-timeline-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-13-sankey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-14-xy-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-00-flowchart-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-01-sequence-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-02-class-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-03-state-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-04-er-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-05-journey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-06-gantt-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-07-pie-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-08-quadrant-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-09-requirement-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-10-c4-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-11-mindmap-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-12-timeline-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-13-sankey-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-14-xy-jupyterlab-linux.png",
      "galata/test/jupyterlab/notebooks/mermaid_diagrams.ipynb",
      "packages/mermaid/test/clean.spec.ts",
      "packages/mermaid/test/renderer.spec.ts",
      "packages/mermaid/test/utils.ts"
    ],
    "base_commit": "7052a4c74f5f3708afb5352b6c728a3f6456cbe8",
    "head_commit": "7a156910eab847489e286dd5f5c2f4530ebee9ab",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15661",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15661",
    "dockerfile": "",
    "pr_merged_at": "2024-02-02T09:27:35.000Z",
    "patch": "diff --git a/packages/mermaid/src/manager.ts b/packages/mermaid/src/manager.ts\nindex 22b3709b3f5d..d3d2081edcf1 100644\n--- a/packages/mermaid/src/manager.ts\n+++ b/packages/mermaid/src/manager.ts\n@@ -37,6 +37,13 @@ export class MermaidManager implements IMermaidManager {\n     }\n   }\n \n+  /**\n+   * Post-process to ensure mermaid diagrams contain only valid SVG and XHTML.\n+   */\n+  static cleanMermaidSvg(svg: string): string {\n+    return svg.replace(Private.RE_VOID_ELEMENT, Private.replaceVoidElement);\n+  }\n+\n   /**\n    * Handle (re)-initializing mermaid based on external values.\n    */\n@@ -81,7 +88,9 @@ export class MermaidManager implements IMermaidManager {\n     const el = document.createElement('div');\n     document.body.appendChild(el);\n     try {\n-      const { svg } = await _mermaid.render(id, text, el);\n+      let { svg } = await _mermaid.render(id, text, el);\n+      svg = MermaidManager.cleanMermaidSvg(svg);\n+\n       const parser = new DOMParser();\n       const doc = parser.parseFromString(svg, 'image/svg+xml');\n \n@@ -285,6 +294,7 @@ namespace Private {\n     _mermaid.mermaidAPI.initialize({\n       theme,\n       fontFamily,\n+      securityLevel: 'strict',\n       maxTextSize: 100000,\n       maxEdges: 100000,\n       startOnLoad: false\n@@ -323,4 +333,27 @@ namespace Private {\n     _loading.resolve(_mermaid);\n     return _mermaid;\n   }\n+\n+  /**\n+   * A regular expression for all void elements, which may include attributes and\n+   * a slash.\n+   *\n+   * @see https://developer.mozilla.org/en-US/docs/Glossary/Void_element\n+   *\n+   * Of these, only `<br>` is generated by Mermaid in place of `\\n`,\n+   * but _any_ \"malformed\" tag will break the SVG rendering entirely.\n+   */\n+  export const RE_VOID_ELEMENT =\n+    /<\\s*(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)\\s*([^>]*?)\\s*>/gi;\n+\n+  /**\n+   * Ensure a void element is closed with a slash, preserving any attributes.\n+   */\n+  export function replaceVoidElement(match: string, tag: string, rest: string) {\n+    rest = rest.trim();\n+    if (!rest.endsWith('/')) {\n+      rest = `${rest} /`;\n+    }\n+    return `<${tag} ${rest}>`;\n+  }\n }\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts\nnew file mode 100644\nindex 000000000000..00e2f262a0ea\n--- /dev/null\n+++ b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts\n@@ -0,0 +1,90 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { expect, galata, test } from '@jupyterlab/galata';\n+import * as path from 'path';\n+import { Locator } from '@playwright/test';\n+\n+const fileName = 'mermaid_diagrams.ipynb';\n+\n+const EXPECTED_MERMAID_ORDER = [\n+  'flowchart',\n+  'sequence',\n+  'class',\n+  'state',\n+  'er',\n+  'journey',\n+  'gantt',\n+  'pie',\n+  'quadrant',\n+  'requirement',\n+  'c4',\n+  'mindmap',\n+  'timeline',\n+  'sankey',\n+  'xy'\n+];\n+\n+/**\n+ * Workaround for playwright not handling screenshots\n+ * for elements larger than viewport, derived from:\n+ * https://github.com/microsoft/playwright/issues/13486#issuecomment-1112012053\n+ */\n+async function resizePageAndScreenshot(locator: Locator) {\n+  const page = locator.page();\n+  const box = await locator.boundingBox();\n+  const originalSize = page.viewportSize();\n+  if (box.width > originalSize.width || box.height > originalSize.height) {\n+    const scaleFactor = Math.max(\n+      originalSize.width / box.width,\n+      originalSize.height / box.height\n+    );\n+    await page.setViewportSize({\n+      width: Math.ceil(box.width * scaleFactor),\n+      height: Math.ceil(box.height * scaleFactor)\n+    });\n+  }\n+  const screenshot = await locator.screenshot();\n+  await page.setViewportSize(originalSize);\n+  return screenshot;\n+}\n+\n+for (const theme of ['default', 'dark']) {\n+  const dark = theme === 'dark';\n+  test.describe(`Notebook Mermaid Diagrams ${theme}`, () => {\n+    test.beforeEach(async ({ page, request, tmpPath }) => {\n+      const contents = galata.newContentsHelper(request);\n+      await contents.uploadFile(\n+        path.resolve(__dirname, `./notebooks/${fileName}`),\n+        `${tmpPath}/${fileName}`\n+      );\n+      await page.filebrowser.openDirectory(tmpPath);\n+      const nbPath = `${tmpPath}/${fileName}`;\n+\n+      if (dark) {\n+        await page.theme.setDarkTheme();\n+      }\n+\n+      await page.notebook.openByPath(nbPath);\n+      await page.notebook.activate(fileName);\n+    });\n+\n+    for (let i = 0; i < EXPECTED_MERMAID_ORDER.length; i++) {\n+      let diagram = EXPECTED_MERMAID_ORDER[i];\n+      const iZero = `${i}`.padStart(2, '0');\n+\n+      test(`Mermaid Diagram ${i} ${diagram} in ${theme} theme`, async ({\n+        page\n+      }) => {\n+        const output = page.locator(\n+          `.jp-Cell:nth-child(${i + 1}) .jp-RenderedMermaid`\n+        );\n+        await output.waitFor();\n+\n+        expect(await resizePageAndScreenshot(output)).toMatchSnapshot(\n+          `mermaid-diagram-${theme}-${iZero}-${diagram}.png`\n+        );\n+      });\n+    }\n+  });\n+}\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-00-flowchart-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-00-flowchart-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..de8a9c79f4db\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-00-flowchart-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-01-sequence-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-01-sequence-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..8ec48dacd212\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-01-sequence-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-02-class-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-02-class-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..bb7712839c71\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-02-class-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-03-state-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-03-state-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..28218e4b54d3\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-03-state-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-04-er-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-04-er-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..d8dc2e6fe4d5\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-04-er-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-05-journey-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-05-journey-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..04616392001d\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-05-journey-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-06-gantt-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-06-gantt-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..bff0d80342eb\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-06-gantt-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-07-pie-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-07-pie-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..2e9598b53dd3\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-07-pie-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-08-quadrant-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-08-quadrant-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..996ad0494d23\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-08-quadrant-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-09-requirement-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-09-requirement-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..a524b611fc89\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-09-requirement-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-10-c4-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-10-c4-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..1b672e1b883d\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-10-c4-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-11-mindmap-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-11-mindmap-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..2da58fc745a5\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-11-mindmap-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-12-timeline-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-12-timeline-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..2bf39613b93b\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-12-timeline-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-13-sankey-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-13-sankey-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..fac0249423a5\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-13-sankey-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-14-xy-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-14-xy-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..908c9ff4051f\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-dark-14-xy-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-00-flowchart-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-00-flowchart-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..3f33adc1cba2\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-00-flowchart-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-01-sequence-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-01-sequence-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..afac15531676\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-01-sequence-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-02-class-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-02-class-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..3b3812dc9d28\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-02-class-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-03-state-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-03-state-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..1fdd678a9859\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-03-state-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-04-er-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-04-er-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..53e05164c16a\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-04-er-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-05-journey-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-05-journey-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..ebec53f83679\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-05-journey-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-06-gantt-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-06-gantt-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..6e03ce464e90\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-06-gantt-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-07-pie-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-07-pie-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..fea66e28fe50\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-07-pie-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-08-quadrant-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-08-quadrant-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..7fb75f9a0314\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-08-quadrant-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-09-requirement-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-09-requirement-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..8642bc39657d\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-09-requirement-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-10-c4-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-10-c4-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..96c24134eb2f\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-10-c4-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-11-mindmap-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-11-mindmap-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..dc46eeb78015\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-11-mindmap-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-12-timeline-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-12-timeline-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..5a36b47b1cb1\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-12-timeline-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-13-sankey-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-13-sankey-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..1a3d5969fb51\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-13-sankey-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-14-xy-jupyterlab-linux.png b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-14-xy-jupyterlab-linux.png\nnew file mode 100644\nindex 000000000000..7cfb85e7fb27\nBinary files /dev/null and b/galata/test/jupyterlab/notebook-mermaid-diagrams.test.ts-snapshots/mermaid-diagram-default-14-xy-jupyterlab-linux.png differ\n\ndiff --git a/galata/test/jupyterlab/notebooks/mermaid_diagrams.ipynb b/galata/test/jupyterlab/notebooks/mermaid_diagrams.ipynb\nnew file mode 100644\nindex 000000000000..ac25bfaddc53\n--- /dev/null\n+++ b/galata/test/jupyterlab/notebooks/mermaid_diagrams.ipynb\n@@ -0,0 +1,546 @@\n+{\n+ \"cells\": [\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## flowchart\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/flowchart.html) \\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"%%{init: {\\\"flowchart\\\": {\\\"htmlLabels\\\": false}} }%%\\n\",\n+    \"flowchart LR\\n\",\n+    \"    markdown[\\\"`This **is** _Markdown_`\\\"]\\n\",\n+    \"    newLines[\\\"`Line1\\n\",\n+    \"    Line 2\\n\",\n+    \"    Line 3`\\\"]\\n\",\n+    \"    markdown --> newLines\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## sequence\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/sequenceDiagram.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"sequenceDiagram\\n\",\n+    \"    Alice->John: Hello John, how are you?\\n\",\n+    \"    Note over Alice,John: A typical interaction<br/>But now in two lines\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## class\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/classDiagram.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"---\\n\",\n+    \"title: Animal example\\n\",\n+    \"---\\n\",\n+    \"classDiagram\\n\",\n+    \"    note \\\"From Duck till Zebra\\\"\\n\",\n+    \"    Animal <|-- Duck\\n\",\n+    \"    note for Duck \\\"can fly\\\\ncan swim\\\\ncan dive\\\\ncan help in debugging\\\"\\n\",\n+    \"    Animal <|-- Fish\\n\",\n+    \"    Animal <|-- Zebra\\n\",\n+    \"    Animal : +int age\\n\",\n+    \"    Animal : +String gender\\n\",\n+    \"    Animal: +isMammal()\\n\",\n+    \"    Animal: +mate()\\n\",\n+    \"    class Duck{\\n\",\n+    \"        +String beakColor\\n\",\n+    \"        +swim()\\n\",\n+    \"        +quack()\\n\",\n+    \"    }\\n\",\n+    \"    class Fish{\\n\",\n+    \"        -int sizeInFeet\\n\",\n+    \"        -canEat()\\n\",\n+    \"    }\\n\",\n+    \"    class Zebra{\\n\",\n+    \"        +bool is_wild\\n\",\n+    \"        +run()\\n\",\n+    \"    }\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## state\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/stateDiagram.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \" stateDiagram-v2\\n\",\n+    \"        State1: The state with a note\\n\",\n+    \"        note right of State1\\n\",\n+    \"            Important information! You can write\\n\",\n+    \"            notes.\\n\",\n+    \"        end note\\n\",\n+    \"        State1 --> State2\\n\",\n+    \"        note left of State2 : This is the note to the left.\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## er\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/entityRelationshipDiagram.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"erDiagram\\n\",\n+    \"    CAR ||--o{ NAMED-DRIVER : allows\\n\",\n+    \"    CAR {\\n\",\n+    \"        string registrationNumber PK\\n\",\n+    \"        string make\\n\",\n+    \"        string model\\n\",\n+    \"        string[] parts\\n\",\n+    \"    }\\n\",\n+    \"    PERSON ||--o{ NAMED-DRIVER : is\\n\",\n+    \"    PERSON {\\n\",\n+    \"        string driversLicense PK \\\"The license #\\\"\\n\",\n+    \"        string(99) firstName \\\"Only 99 characters are allowed\\\"\\n\",\n+    \"        string lastName\\n\",\n+    \"        string phone UK\\n\",\n+    \"        int age\\n\",\n+    \"    }\\n\",\n+    \"    NAMED-DRIVER {\\n\",\n+    \"        string carRegistrationNumber PK, FK\\n\",\n+    \"        string driverLicence PK, FK\\n\",\n+    \"    }\\n\",\n+    \"    MANUFACTURER only one to zero or more CAR : makes\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## journey\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/userJourney.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"journey\\n\",\n+    \"    title My working day\\n\",\n+    \"    section Go to work\\n\",\n+    \"      Make tea: 5: Me\\n\",\n+    \"      Go upstairs: 3: Me\\n\",\n+    \"      Do work: 1: Me, Cat\\n\",\n+    \"    section Go home\\n\",\n+    \"      Go downstairs: 5: Me\\n\",\n+    \"      Sit down: 5: Me\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## gantt\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/gantt.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"gantt\\n\",\n+    \"    dateFormat  YYYY-MM-DD\\n\",\n+    \"    title       Adding GANTT diagram functionality to mermaid\\n\",\n+    \"    excludes    weekends\\n\",\n+    \"    %% (`excludes` accepts specific dates in YYYY-MM-DD format, days of the week (\\\"sunday\\\") or \\\"weekends\\\", but not the word \\\"weekdays\\\".)\\n\",\n+    \"\\n\",\n+    \"    section A section\\n\",\n+    \"    Completed task            :done,    des1, 2014-01-06,2014-01-08\\n\",\n+    \"    Active task               :active,  des2, 2014-01-09, 3d\\n\",\n+    \"    Future task               :         des3, after des2, 5d\\n\",\n+    \"    Future task2              :         des4, after des3, 5d\\n\",\n+    \"\\n\",\n+    \"    section Critical tasks\\n\",\n+    \"    Completed task in the critical line :crit, done, 2014-01-06,24h\\n\",\n+    \"    Implement parser and jison          :crit, done, after des1, 2d\\n\",\n+    \"    Create tests for parser             :crit, active, 3d\\n\",\n+    \"    Future task in critical line        :crit, 5d\\n\",\n+    \"    Create tests for renderer           :2d\\n\",\n+    \"    Add to mermaid                      :1d\\n\",\n+    \"    Functionality added                 :milestone, 2014-01-25, 0d\\n\",\n+    \"\\n\",\n+    \"    section Documentation\\n\",\n+    \"    Describe gantt syntax               :active, a1, after des1, 3d\\n\",\n+    \"    Add gantt diagram to demo page      :after a1  , 20h\\n\",\n+    \"    Add another diagram to demo page    :doc1, after a1  , 48h\\n\",\n+    \"\\n\",\n+    \"    section Last section\\n\",\n+    \"    Describe gantt syntax               :after doc1, 3d\\n\",\n+    \"    Add gantt diagram to demo page      :20h\\n\",\n+    \"    Add another diagram to demo page    :48h\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## pie\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/pie.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"%%{init: {\\\"pie\\\": {\\\"textPosition\\\": 0.5}, \\\"themeVariables\\\": {\\\"pieOuterStrokeWidth\\\": \\\"5px\\\"}} }%%\\n\",\n+    \"pie showData\\n\",\n+    \"    title Key elements in Product X\\n\",\n+    \"    \\\"Calcium\\\" : 42.96\\n\",\n+    \"    \\\"Potassium\\\" : 50.05\\n\",\n+    \"    \\\"Magnesium\\\" : 10.01\\n\",\n+    \"    \\\"Iron\\\" :  5\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## quadrant\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/quadrantChart.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"%%{init: {\\\"quadrantChart\\\": {\\\"chartWidth\\\": 400, \\\"chartHeight\\\": 400}, \\\"themeVariables\\\": {\\\"quadrant1TextFill\\\": \\\"#ff0000\\\"} }}%%\\n\",\n+    \"quadrantChart\\n\",\n+    \"  x-axis Urgent --> Not Urgent\\n\",\n+    \"  y-axis Not Important --> \\\"Important â¤\\\"\\n\",\n+    \"  quadrant-1 Plan\\n\",\n+    \"  quadrant-2 Do\\n\",\n+    \"  quadrant-3 Delegate\\n\",\n+    \"  quadrant-4 Delete\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## requirement\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/requirementDiagram.html)\\n\",\n+    \"> \\n\",\n+    \"> note: some long text also overflows the box upstream\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"requirementDiagram\\n\",\n+    \"    requirement test_req {\\n\",\n+    \"    id: 1\\n\",\n+    \"    text: the test text.\\n\",\n+    \"    risk: high\\n\",\n+    \"    verifymethod: test\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    functionalRequirement test_req2 {\\n\",\n+    \"    id: 1.1\\n\",\n+    \"    text: the second test text.\\n\",\n+    \"    risk: low\\n\",\n+    \"    verifymethod: inspection\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    performanceRequirement test_req3 {\\n\",\n+    \"    id: 1.2\\n\",\n+    \"    text: the third test text.\\n\",\n+    \"    risk: medium\\n\",\n+    \"    verifymethod: demonstration\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    interfaceRequirement test_req4 {\\n\",\n+    \"    id: 1.2.1\\n\",\n+    \"    text: the fourth test text.\\n\",\n+    \"    risk: medium\\n\",\n+    \"    verifymethod: analysis\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    physicalRequirement test_req5 {\\n\",\n+    \"    id: 1.2.2\\n\",\n+    \"    text: the fifth test text.\\n\",\n+    \"    risk: medium\\n\",\n+    \"    verifymethod: analysis\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    designConstraint test_req6 {\\n\",\n+    \"    id: 1.2.3\\n\",\n+    \"    text: the sixth test text.\\n\",\n+    \"    risk: medium\\n\",\n+    \"    verifymethod: analysis\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    element test_entity {\\n\",\n+    \"    type: simulation\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    element test_entity2 {\\n\",\n+    \"    type: word doc\\n\",\n+    \"    docRef: reqs/test_entity\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"    element test_entity3 {\\n\",\n+    \"    type: \\\"test suite\\\"\\n\",\n+    \"    docRef: github.com/all_the_tests\\n\",\n+    \"    }\\n\",\n+    \"\\n\",\n+    \"\\n\",\n+    \"    test_entity - satisfies -> test_req2\\n\",\n+    \"    test_req - traces -> test_req2\\n\",\n+    \"    test_req - contains -> test_req3\\n\",\n+    \"    test_req3 - contains -> test_req4\\n\",\n+    \"    test_req4 - derives -> test_req5\\n\",\n+    \"    test_req5 - refines -> test_req6\\n\",\n+    \"    test_entity3 - verifies -> test_req5\\n\",\n+    \"    test_req <- copies - test_entity2\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## c4\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/c4.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \" C4Context\\n\",\n+    \"      title System Context diagram for Internet Banking System\\n\",\n+    \"      Enterprise_Boundary(b0, \\\"BankBoundary0\\\") {\\n\",\n+    \"        Person(customerA, \\\"Banking Customer A\\\", \\\"A customer of the bank, with personal bank accounts.\\\")\\n\",\n+    \"        Person(customerB, \\\"Banking Customer B\\\")\\n\",\n+    \"        Person_Ext(customerC, \\\"Banking Customer C\\\", \\\"desc\\\")\\n\",\n+    \"\\n\",\n+    \"        Person(customerD, \\\"Banking Customer D\\\", \\\"A customer of the bank, <br/> with personal bank accounts.\\\")\\n\",\n+    \"\\n\",\n+    \"        System(SystemAA, \\\"Internet Banking System\\\", \\\"Allows customers to view information about their bank accounts, and make payments.\\\")\\n\",\n+    \"\\n\",\n+    \"        Enterprise_Boundary(b1, \\\"BankBoundary\\\") {\\n\",\n+    \"\\n\",\n+    \"          SystemDb_Ext(SystemE, \\\"Mainframe Banking System\\\", \\\"Stores all of the core banking information about customers, accounts, transactions, etc.\\\")\\n\",\n+    \"\\n\",\n+    \"          System_Boundary(b2, \\\"BankBoundary2\\\") {\\n\",\n+    \"            System(SystemA, \\\"Banking System A\\\")\\n\",\n+    \"            System(SystemB, \\\"Banking System B\\\", \\\"A system of the bank, with personal bank accounts. next line.\\\")\\n\",\n+    \"          }\\n\",\n+    \"\\n\",\n+    \"          System_Ext(SystemC, \\\"E-mail system\\\", \\\"The internal Microsoft Exchange e-mail system.\\\")\\n\",\n+    \"          SystemDb(SystemD, \\\"Banking System D Database\\\", \\\"A system of the bank, with personal bank accounts.\\\")\\n\",\n+    \"\\n\",\n+    \"          Boundary(b3, \\\"BankBoundary3\\\", \\\"boundary\\\") {\\n\",\n+    \"            SystemQueue(SystemF, \\\"Banking System F Queue\\\", \\\"A system of the bank.\\\")\\n\",\n+    \"            SystemQueue_Ext(SystemG, \\\"Banking System G Queue\\\", \\\"A system of the bank, with personal bank accounts.\\\")\\n\",\n+    \"          }\\n\",\n+    \"        }\\n\",\n+    \"      }\\n\",\n+    \"\\n\",\n+    \"      BiRel(customerA, SystemAA, \\\"Uses\\\")\\n\",\n+    \"      BiRel(SystemAA, SystemE, \\\"Uses\\\")\\n\",\n+    \"      Rel(SystemAA, SystemC, \\\"Sends e-mails\\\", \\\"SMTP\\\")\\n\",\n+    \"      Rel(SystemC, customerA, \\\"Sends e-mails to\\\")\\n\",\n+    \"\\n\",\n+    \"      UpdateElementStyle(customerA, $fontColor=\\\"red\\\", $bgColor=\\\"grey\\\", $borderColor=\\\"red\\\")\\n\",\n+    \"      UpdateRelStyle(customerA, SystemAA, $textColor=\\\"blue\\\", $lineColor=\\\"blue\\\", $offsetX=\\\"5\\\")\\n\",\n+    \"      UpdateRelStyle(SystemAA, SystemE, $textColor=\\\"blue\\\", $lineColor=\\\"blue\\\", $offsetY=\\\"-10\\\")\\n\",\n+    \"      UpdateRelStyle(SystemAA, SystemC, $textColor=\\\"blue\\\", $lineColor=\\\"blue\\\", $offsetY=\\\"-40\\\", $offsetX=\\\"-50\\\")\\n\",\n+    \"      UpdateRelStyle(SystemC, customerA, $textColor=\\\"red\\\", $lineColor=\\\"red\\\", $offsetX=\\\"-50\\\", $offsetY=\\\"20\\\")\\n\",\n+    \"\\n\",\n+    \"      UpdateLayoutConfig($c4ShapeInRow=\\\"3\\\", $c4BoundaryInRow=\\\"1\\\")\\n\",\n+    \"\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## mindmap\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/mindmap.html)\\n\",\n+    \">\\n\",\n+    \"> note: icons will not be available\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"mindmap\\n\",\n+    \"  root((mindmap))\\n\",\n+    \"    Origins\\n\",\n+    \"      Long history\\n\",\n+    \"      ::icon(fa fa-book)\\n\",\n+    \"      Popularisation\\n\",\n+    \"        British popular psychology author Tony Buzan\\n\",\n+    \"    Research\\n\",\n+    \"      On effectiveness<br/>and features\\n\",\n+    \"      On Automatic creation\\n\",\n+    \"        Uses\\n\",\n+    \"            Creative techniques\\n\",\n+    \"            Strategic planning\\n\",\n+    \"            Argument mapping\\n\",\n+    \"    Tools\\n\",\n+    \"      Pen and paper\\n\",\n+    \"      Mermaid\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## timeline\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/timeline.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"timeline\\n\",\n+    \"        title England's History Timeline\\n\",\n+    \"        section Stone Age\\n\",\n+    \"          7600 BC : Britain's oldest known house was built in Orkney, Scotland\\n\",\n+    \"          6000 BC : Sea levels rise and Britain becomes an island.<br> The people who live here are hunter-gatherers.\\n\",\n+    \"        section Bronze Age\\n\",\n+    \"          2300 BC : People arrive from Europe and settle in Britain. <br>They bring farming and metalworking.\\n\",\n+    \"                  : New styles of pottery and ways of burying the dead appear.\\n\",\n+    \"          2200 BC : The last major building works are completed at Stonehenge.<br> People now bury their dead in stone circles.\\n\",\n+    \"                  : The first metal objects are made in Britain.Some other nice things happen. it is a good time to be alive.\\n\",\n+    \"\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## sankey\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/sankey.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"---\\n\",\n+    \"config:\\n\",\n+    \"  sankey:\\n\",\n+    \"    showValues: false\\n\",\n+    \"---\\n\",\n+    \"sankey-beta\\n\",\n+    \"\\n\",\n+    \"Agricultural 'waste',Bio-conversion,124.729\\n\",\n+    \"Bio-conversion,Liquid,0.597\\n\",\n+    \"Bio-conversion,Losses,26.862\\n\",\n+    \"Bio-conversion,Solid,280.322\\n\",\n+    \"Bio-conversion,Gas,81.144\\n\",\n+    \"Biofuel imports,Liquid,35\\n\",\n+    \"Biomass imports,Solid,35\\n\",\n+    \"Coal imports,Coal,11.606\\n\",\n+    \"Coal reserves,Coal,63.965\\n\",\n+    \"Coal,Solid,75.571\\n\",\n+    \"District heating,Industry,10.639\\n\",\n+    \"District heating,Heating and cooling - commercial,22.505\\n\",\n+    \"District heating,Heating and cooling - homes,46.184\\n\",\n+    \"Electricity grid,Over generation / exports,104.453\\n\",\n+    \"Electricity grid,Heating and cooling - homes,113.726\\n\",\n+    \"Electricity grid,H2 conversion,27.14\\n\",\n+    \"Electricity grid,Industry,342.165\\n\",\n+    \"Electricity grid,Road transport,37.797\\n\",\n+    \"Electricity grid,Agriculture,4.412\\n\",\n+    \"Electricity grid,Heating and cooling - commercial,40.858\\n\",\n+    \"Electricity grid,Losses,56.691\\n\",\n+    \"Electricity grid,Rail transport,7.863\\n\",\n+    \"Electricity grid,Lighting & appliances - commercial,90.008\\n\",\n+    \"Electricity grid,Lighting & appliances - homes,93.494\\n\",\n+    \"Gas imports,Ngas,40.719\\n\",\n+    \"Gas reserves,Ngas,82.233\\n\",\n+    \"Gas,Heating and cooling - commercial,0.129\\n\",\n+    \"Gas,Losses,1.401\\n\",\n+    \"Gas,Thermal generation,151.891\\n\",\n+    \"Gas,Agriculture,2.096\\n\",\n+    \"Gas,Industry,48.58\\n\",\n+    \"Geothermal,Electricity grid,7.013\\n\",\n+    \"H2 conversion,H2,20.897\\n\",\n+    \"H2 conversion,Losses,6.242\\n\",\n+    \"H2,Road transport,20.897\\n\",\n+    \"Hydro,Electricity grid,6.995\\n\",\n+    \"Liquid,Industry,121.066\\n\",\n+    \"Liquid,International shipping,128.69\\n\",\n+    \"Liquid,Road transport,135.835\\n\",\n+    \"Liquid,Domestic aviation,14.458\\n\",\n+    \"Liquid,International aviation,206.267\\n\",\n+    \"Liquid,Agriculture,3.64\\n\",\n+    \"Liquid,National navigation,33.218\\n\",\n+    \"Liquid,Rail transport,4.413\\n\",\n+    \"Marine algae,Bio-conversion,4.375\\n\",\n+    \"Ngas,Gas,122.952\\n\",\n+    \"Nuclear,Thermal generation,839.978\\n\",\n+    \"Oil imports,Oil,504.287\\n\",\n+    \"Oil reserves,Oil,107.703\\n\",\n+    \"Oil,Liquid,611.99\\n\",\n+    \"Other waste,Solid,56.587\\n\",\n+    \"Other waste,Bio-conversion,77.81\\n\",\n+    \"Pumped heat,Heating and cooling - homes,193.026\\n\",\n+    \"Pumped heat,Heating and cooling - commercial,70.672\\n\",\n+    \"Solar PV,Electricity grid,59.901\\n\",\n+    \"Solar Thermal,Heating and cooling - homes,19.263\\n\",\n+    \"Solar,Solar Thermal,19.263\\n\",\n+    \"Solar,Solar PV,59.901\\n\",\n+    \"Solid,Agriculture,0.882\\n\",\n+    \"Solid,Thermal generation,400.12\\n\",\n+    \"Solid,Industry,46.477\\n\",\n+    \"Thermal generation,Electricity grid,525.531\\n\",\n+    \"Thermal generation,Losses,787.129\\n\",\n+    \"Thermal generation,District heating,79.329\\n\",\n+    \"Tidal,Electricity grid,9.452\\n\",\n+    \"UK land based bioenergy,Bio-conversion,182.01\\n\",\n+    \"Wave,Electricity grid,19.013\\n\",\n+    \"Wind,Electricity grid,289.366\\n\",\n+    \"```\"\n+   ]\n+  },\n+  {\n+   \"cell_type\": \"markdown\",\n+   \"metadata\": {},\n+   \"source\": [\n+    \"## xy\\n\",\n+    \"\\n\",\n+    \"> [docs](https://mermaid.js.org/syntax/xyChart.html)\\n\",\n+    \"\\n\",\n+    \"```mermaid\\n\",\n+    \"xychart-beta\\n\",\n+    \"    title \\\"Sales Revenue\\\"\\n\",\n+    \"    x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]\\n\",\n+    \"    y-axis \\\"Revenue (in $)\\\" 4000 --> 11000\\n\",\n+    \"    bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]\\n\",\n+    \"    line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]\\n\",\n+    \"```\"\n+   ]\n+  }\n+ ],\n+ \"metadata\": {\n+  \"kernelspec\": {\n+   \"display_name\": \"Python 3 (ipykernel)\",\n+   \"language\": \"python\",\n+   \"name\": \"python3\"\n+  },\n+  \"language_info\": {\n+   \"codemirror_mode\": {\n+    \"name\": \"ipython\",\n+    \"version\": 3\n+   },\n+   \"file_extension\": \".py\",\n+   \"mimetype\": \"text/x-python\",\n+   \"name\": \"python\",\n+   \"nbconvert_exporter\": \"python\",\n+   \"pygments_lexer\": \"ipython3\",\n+   \"version\": \"3.12.1\"\n+  }\n+ },\n+ \"nbformat\": 4,\n+ \"nbformat_minor\": 4\n+}\n\ndiff --git a/packages/mermaid/test/clean.spec.ts b/packages/mermaid/test/clean.spec.ts\nnew file mode 100644\nindex 000000000000..e5dedbc1d3d2\n--- /dev/null\n+++ b/packages/mermaid/test/clean.spec.ts\n@@ -0,0 +1,36 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+\n+import { MermaidManager } from '@jupyterlab/mermaid';\n+\n+import {\n+  makeElementVariants,\n+  SVG_MIME,\n+  SVG_XHTML_FOOTER,\n+  SVG_XHTML_HEADER,\n+  VOID_ELEMENTS\n+} from './utils';\n+\n+const parser = new DOMParser();\n+\n+describe('@jupyterlab/mermaid', () => {\n+  for (const element of VOID_ELEMENTS) {\n+    it(`should clean void element ${element}`, () => {\n+      const variants = makeElementVariants(element);\n+      const raw = [...SVG_XHTML_HEADER, ...variants, ...SVG_XHTML_FOOTER].join(\n+        '\\n'\n+      );\n+\n+      const clean = MermaidManager.cleanMermaidSvg(raw);\n+      const parsed = parser.parseFromString(clean, SVG_MIME);\n+      const { numberValue } = parsed.evaluate(\n+        `count(//${element})`,\n+        parsed,\n+        null,\n+        XPathResult.NUMBER_TYPE,\n+        null\n+      );\n+      expect(numberValue).toBe(variants.length);\n+    });\n+  }\n+});\n\ndiff --git a/packages/mermaid/test/renderer.spec.ts b/packages/mermaid/test/renderer.spec.ts\nindex c953336139f5..a01d87aa0b3b 100644\n--- a/packages/mermaid/test/renderer.spec.ts\n+++ b/packages/mermaid/test/renderer.spec.ts\n@@ -12,7 +12,7 @@ import {\n   SVG_DATA_ATTR\n } from './utils';\n \n-describe('@jupyterlab/mermaid-extension', () => {\n+describe('@jupyterlab/mermaid', () => {\n   describe('RenderedMermaid', () => {\n     it('should attach an SVG and version if parsing succeeds', async () => {\n       const model = new MimeModel({\n\ndiff --git a/packages/mermaid/test/utils.ts b/packages/mermaid/test/utils.ts\nindex 24581f591ed4..1054cd574174 100644\n--- a/packages/mermaid/test/utils.ts\n+++ b/packages/mermaid/test/utils.ts\n@@ -23,9 +23,35 @@ flowchart LR\n     ${FAIL} -->\n `;\n \n-export const SVG_DATA_ATTR = 'data.image/svg+xml';\n+export const SVG_MIME = 'image/svg+xml';\n+export const SVG_DATA_ATTR = `data.${SVG_MIME}`;\n export const MERMAID_VERSION_ATTR = ['metadata', 'text/vnd.mermaid', 'version'];\n \n+export const VOID_ELEMENTS = [\n+  'area',\n+  'base',\n+  'br',\n+  'col',\n+  'embed',\n+  'hr',\n+  'img',\n+  'input',\n+  'link',\n+  'meta',\n+  'param',\n+  'source',\n+  'track',\n+  'wbr'\n+];\n+\n+export const SVG_XHTML_HEADER = [\n+  '<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\">',\n+  '<foreignObject>',\n+  '<div xmlns=\"http://www.w3.org/1999/xhtml\">'\n+];\n+\n+export const SVG_XHTML_FOOTER = ['</div>', '</foreignObject>', '</svg>'];\n+\n /**\n  * A mock mermaid that provides the minimal renderer API.\n  *\n@@ -89,3 +115,20 @@ export const MERMAID_RENDERER = new RenderedMermaid({\n     sanitize: (s: string) => s\n   }\n });\n+\n+export function makeElementVariants(element: string) {\n+  return [\n+    `<${element}>`,\n+    `<${element}>`,\n+    `<${element} >`,\n+    `<${element} />`,\n+    `<${element} / >`,\n+    `<  ${element}  /  >`,\n+    `<${element} id=\"a\" >`,\n+    `<${element} id=\"b\" >`,\n+    `<${element} id=\"c\"/>`,\n+    `<${element} id=\"d\" />`,\n+    `<${element} id=\"e\" / >`,\n+    `<  ${element} id=\"f\"  /  >`\n+  ];\n+}\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15638",
    "pr_id": 15638,
    "issue_id": 15605,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Running/rendering cell with ctrl + enter inserts a new line at the end\n## Description\r\n\r\nRendering or running a cell with <kbd>ctrl</kbd> + <kbd>enter</kbd> inserts an empty line at the end.\r\n\r\n## Reproduce\r\n\r\n1. Run an empty code or markdown cell with <kbd>ctrl</kbd> + <kbd>enter</kbd>\r\n2. See new line inserted\r\n\r\n![repro](https://github.com/jupyterlab/jupyterlab/assets/5832902/3b0d4efc-a2f1-4708-b280-af36865eb2cf)\r\n\r\n## Expected behavior\r\n\r\nNo new line is inserted.\r\n\r\n## Context\r\n\r\nThis does not happen in 4.0.10.",
    "issue_word_count": 83,
    "test_files_count": 2,
    "non_test_files_count": 3,
    "pr_changed_files": [
      "galata/src/helpers/notebook.ts",
      "galata/test/galata/notebook.spec.ts",
      "galata/test/jupyterlab/cells.test.ts",
      "packages/codemirror/src/commands.ts",
      "packages/codemirror/src/extension.ts"
    ],
    "pr_changed_test_files": [
      "galata/test/galata/notebook.spec.ts",
      "galata/test/jupyterlab/cells.test.ts"
    ],
    "base_commit": "83b2ae958f86b8a6925b9e0c36adb7b897bff62b",
    "head_commit": "cf02dfd9da3224cedc41ad1ed5681ec0fee9195b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15638",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15638",
    "dockerfile": "",
    "pr_merged_at": "2024-01-16T13:24:21.000Z",
    "patch": "diff --git a/galata/src/helpers/notebook.ts b/galata/src/helpers/notebook.ts\nindex 4b15c98aa79e..5a36e5a5e798 100644\n--- a/galata/src/helpers/notebook.ts\n+++ b/galata/src/helpers/notebook.ts\n@@ -623,6 +623,34 @@ export class NotebookHelper {\n     return cellEditor;\n   }\n \n+  /**\n+   * Get the content of the cell input\n+   *\n+   * @param cellIndex Cell index\n+   * @returns the code input\n+   */\n+  async getCellTextInput(cellIndex: number): Promise<string> {\n+    // Using textContent on handle does not preserve new lines, so we need to either:\n+    // (a) use `evaluate()` operate on the codemirror instance directly to get the code\n+    // (b) iterate the lines in representation and concatenate manually\n+    // (c) copy-paste the content and read the clipboard\n+    // Out of the three options only (c) does not touch implementation details of CodeMirror.\n+    const wasInEditingMode = await this.isCellInEditingMode(cellIndex);\n+    if (!wasInEditingMode) {\n+      await this.enterCellEditingMode(cellIndex);\n+    }\n+    await this.page.keyboard.press('Control+A');\n+    await this.page.keyboard.press('Control+C');\n+    await this.page.context().grantPermissions(['clipboard-read']);\n+    const handle = await this.page.evaluateHandle(() =>\n+      navigator.clipboard.readText()\n+    );\n+    if (!wasInEditingMode) {\n+      await this.leaveCellEditingMode(cellIndex);\n+    }\n+    return await handle.jsonValue();\n+  }\n+\n   /**\n    * Get the handle to the input expander of a cell\n    *\n\ndiff --git a/packages/codemirror/src/commands.ts b/packages/codemirror/src/commands.ts\nindex 3c6021d4ea69..9b30c4d556b8 100644\n--- a/packages/codemirror/src/commands.ts\n+++ b/packages/codemirror/src/commands.ts\n@@ -14,6 +14,11 @@ import {\n   COMPLETER_ENABLED_CLASS\n } from '@jupyterlab/codeeditor';\n \n+/**\n+ * Selector for a widget that can run code.\n+ */\n+const CODE_RUNNER_SELECTOR = '[data-jp-code-runner]';\n+\n /**\n  * CodeMirror commands namespace\n  */\n@@ -61,4 +66,14 @@ export namespace StateCommands {\n     const arg = { state: target.state, dispatch: target.dispatch };\n     return insertNewlineAndIndent(arg);\n   }\n+\n+  /**\n+   * Prevent insertion of new line when running cell with Ctrl/Command + Enter\n+   */\n+  export function preventNewLineOnRun(target: { dom: HTMLElement }): boolean {\n+    if (target.dom.closest(CODE_RUNNER_SELECTOR)) {\n+      return true;\n+    }\n+    return false;\n+  }\n }\n\ndiff --git a/packages/codemirror/src/extension.ts b/packages/codemirror/src/extension.ts\nindex 000302e6b40a..3e0424368772 100644\n--- a/packages/codemirror/src/extension.ts\n+++ b/packages/codemirror/src/extension.ts\n@@ -703,6 +703,10 @@ export namespace EditorExtensionRegistry {\n       Object.freeze({\n         name: 'keymap',\n         default: [\n+          {\n+            key: 'Mod-Enter',\n+            run: StateCommands.preventNewLineOnRun\n+          },\n           {\n             key: 'Enter',\n             run: StateCommands.completerOrInsertNewLine\n",
    "test_patch": "diff --git a/galata/test/galata/notebook.spec.ts b/galata/test/galata/notebook.spec.ts\nindex 3bcf7947ca5d..939f6faa3f71 100644\n--- a/galata/test/galata/notebook.spec.ts\n+++ b/galata/test/galata/notebook.spec.ts\n@@ -25,6 +25,9 @@ test.describe('Notebook Tests', () => {\n     await page.notebook.setCell(0, 'markdown', '## This is a markdown cell');\n     expect(await page.notebook.getCellCount()).toBe(1);\n     expect(await page.notebook.getCellType(0)).toBe('markdown');\n+    expect(await page.notebook.getCellTextInput(0)).toBe(\n+      '## This is a markdown cell'\n+    );\n \n     // Wait for kernel to be idle\n     await page.locator('#jp-main-statusbar').getByText('Idle').waitFor();\n@@ -40,6 +43,7 @@ test.describe('Notebook Tests', () => {\n     await page.notebook.addCell('raw', 'This is a raw cell');\n     expect(await page.notebook.getCellCount()).toBe(2);\n     expect(await page.notebook.getCellType(1)).toBe('raw');\n+    expect(await page.notebook.getCellTextInput(1)).toBe('This is a raw cell');\n \n     // Wait for kernel to be idle and the debug switch to appear\n     await Promise.all([\n@@ -58,6 +62,7 @@ test.describe('Notebook Tests', () => {\n     await page.notebook.addCell('code', '2 + 2');\n     expect(await page.notebook.getCellCount()).toBe(2);\n     expect(await page.notebook.getCellType(1)).toBe('code');\n+    expect(await page.notebook.getCellTextInput(1)).toBe('2 + 2');\n \n     // Wait for kernel to be idle\n     await page.locator('#jp-main-statusbar').getByText('Idle').waitFor();\n@@ -67,6 +72,13 @@ test.describe('Notebook Tests', () => {\n     );\n   });\n \n+  test('Should copy cell input content with new lines', async ({ page }) => {\n+    await page.notebook.createNew();\n+\n+    await page.notebook.setCell(0, 'code', 'a\\nb\\nc');\n+    expect(await page.notebook.getCellTextInput(0)).toBe('a\\nb\\nc');\n+  });\n+\n   test('Run Cells', async ({ page }) => {\n     await page.notebook.createNew();\n \n\ndiff --git a/galata/test/jupyterlab/cells.test.ts b/galata/test/jupyterlab/cells.test.ts\nindex a6bf3d581116..afb305b93632 100644\n--- a/galata/test/jupyterlab/cells.test.ts\n+++ b/galata/test/jupyterlab/cells.test.ts\n@@ -32,3 +32,25 @@ test.describe('Cells', () => {\n     );\n   });\n });\n+\n+test.describe('Run Cells With Keyboard', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.notebook.createNew();\n+  });\n+\n+  test('Run code cell with Ctrl + Enter', async ({ page }) => {\n+    await page.notebook.setCell(0, 'code', '2**32');\n+    await page.notebook.enterCellEditingMode(0);\n+    const initialOutput = await page.notebook.getCellTextOutput(0);\n+    expect(initialOutput).toBe(null);\n+    await page.keyboard.press('Control+Enter');\n+\n+    // Confirm that the cell has be executed by checking output\n+    const output = await page.notebook.getCellTextOutput(0);\n+    expect(output).toEqual(['4294967296']);\n+\n+    // Expect the input to NOT include an extra line;\n+    const text = await page.notebook.getCellTextInput(0);\n+    expect(text).toBe('2**32');\n+  });\n+});\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15634",
    "pr_id": 15634,
    "issue_id": 15595,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Clicking away from rendered markdown cell unrenders it\n## Description\r\n\r\nWhen an active cell is a markdown cell and user clicks on a different cell, the markdown cell unrenders causing content jump thus distraction and annoyance.\r\n\r\n## Reproduce\r\n\r\n![clicking-away-unrenders-header](https://github.com/jupyterlab/jupyterlab/assets/5832902/3b2fa13d-68df-4e3f-a1dc-7a058ab1fcea)\r\n\r\nInterestingly, this does not happen when:\r\n- changing the active cell with arrow keys\r\n- clicking outside of the notebook or on its toolbar\r\n\r\n## Expected behavior\r\n\r\nClicking on another cell does not unrender the previous cell.\r\n\r\n## Context\r\n\r\n- Browser and version: Chrome\r\n- JupyterLab version: 4.1.0b0\r\n\r\n\r\nLikely a regression in 4.1.0beta but Binder does not start for me at the moment so I cannot confirm.",
    "issue_word_count": 117,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/widget.ts",
      "packages/notebook/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/widget.spec.ts"
    ],
    "base_commit": "f5c11cb48fa2061c38a31a57c1ac5d7244607b64",
    "head_commit": "e27c3bd5a178a9c71dace298999ee82baf3f1f99",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15634",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15634",
    "dockerfile": "",
    "pr_merged_at": "2024-01-13T14:06:56.000Z",
    "patch": "diff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex 888417f5b6af..05af9423f386 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -2781,13 +2781,16 @@ export class Notebook extends StaticNotebook {\n       if (widget.editorWidget && !widget.editorWidget.node.contains(target)) {\n         this.setMode('command', { focus: false });\n       }\n+\n+      // Cell index needs to be updated before changing mode,\n+      // otherwise the previous cell may get un-rendered.\n+      this.activeCellIndex = index;\n+\n       // If the editor has focus, ensure edit mode.\n       const node = widget.editorWidget?.node;\n       if (node?.contains(target)) {\n         this.setMode('edit', { focus: false });\n       }\n-      // This will set the focus\n-      this.activeCellIndex = index;\n     } else {\n       // No cell has focus, ensure command mode.\n       this.setMode('command', { focus: false });\n",
    "test_patch": "diff --git a/packages/notebook/test/widget.spec.ts b/packages/notebook/test/widget.spec.ts\nindex e3dedac74d91..d7a37765d48f 100644\n--- a/packages/notebook/test/widget.spec.ts\n+++ b/packages/notebook/test/widget.spec.ts\n@@ -1345,6 +1345,24 @@ describe('@jupyter/notebook', () => {\n           expect(widget.events).toEqual(expect.arrayContaining(['focusin']));\n           expect(widget.mode).toBe('command');\n         });\n+\n+        it('should not unrender previously active markdown cell', async () => {\n+          widget.model!.sharedModel.insertCell(0, {\n+            cell_type: 'markdown',\n+            source: '# Hello'\n+          });\n+          const mdCell = widget.widgets[0] as MarkdownCell;\n+          if (!mdCell.inViewport) {\n+            await signalToPromise(mdCell.inViewportChanged);\n+          }\n+          widget.activeCellIndex = 0;\n+          expect(mdCell.rendered).toBe(true);\n+          const cellToActivate = widget.widgets[1];\n+          expect(widget.mode).toBe('command');\n+          simulate(cellToActivate.editorWidget!.node, 'focusin');\n+          expect(widget.mode).toBe('edit');\n+          expect(mdCell.rendered).toBe(true);\n+        });\n       });\n \n       describe('focusout', () => {\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15623",
    "pr_id": 15623,
    "issue_id": 9399,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Accessibility Issues Needing Addressing for WCAG 2.1 compliance (As of Version 2.2.6)\n# Accessibility Issues Needing Addressing for WCAG 2.1 compliance\r\n\r\n## JupyterLab Accessibility Summary by Handicap for Version 2.2.6\r\n-\t**Blind Users** â€“ completely inaccessible. Grade F.\r\n-\t**Low Vision** â€“ hard to use to completely inaccessible. Grade D. (Alternate ticket to just fix these issues #10004)\r\n-\t**Color Blind** â€“ Out-of-the-box functionality is for the most part accessible with exception of coding which is mostly inaccessible. With the setting of additional contrast settings, it does get better but still needs addressing. Grade C. (Alternate ticket to just fix these issues #10008)\r\n-\t**Ambulatory** - hard to use to completely inaccessible. Grade D.\r\n-\t**Deaf/Hard of Hearing** - completely supported. JupyterLab is 100% compliant as far as I know. I saw videos that get pulled into the app through the documentation sections but they wouldnâ€™t play so donâ€™t know if they have audio-descriptive closed captions. Just leaving at passed for now because in my test, technically, deaf users and non-deaf users would have had the exact same user experience. Grade A.\r\n-\t**Cognitive** - completely supported. JupyterLab is 100% compliant. Grade A.\r\n-\t**Seizures** - completely supported. JupyterLab is 100% compliant. Grade A.\r\n\r\n## Issues\r\n### Keyboard/Gestures\r\n- [ ] Issue Area # 1\r\n- **Expectation**: Keyboard can be used to navigate all necessary tasks instead of the mouse. (WCAG Criteria 2.1.1 & 2.1.2 (A))\r\n- **Observed**:\r\n  - Getting into code block wonâ€™t let screenreader users leave. Tab adds tab to code block and escape leaves but tabbing again puts them right back in it.\r\n  - Top nav, sidebars, footer nav,  and sub-nav within the File Browser section are not in the tab order and thus canâ€™t be selected using tabs, arrows keys, etc.\r\n\r\n- [ ] Issue Area # 2\r\n- **Expectation**: All actions can be consistently executed by using either the Enter key or Spacebar. (WCAG Criteria 2.1.1 & 2.1.2 (A)).\r\n- **Observed**: Spacebar to selection elements within File Browser section and Launcher page are not working, and a couple others, but more importantly tabs vertically and horizontally canâ€™t even be focuses to test if either work. (20% resolved with finish of #9491 and #9686)\r\n\r\n### Focus\r\n- [ ] Issue Area # 1\r\n- **Expectation**: All supplementary elements that a user needs to interact with receive keyboard focus and be reached using only the keyboard. (WCAG Criteria 2.1.1 (A))\r\n- **Observed**:\r\n  - Large number of elements arenâ€™t in the tab order and thus canâ€™t be found via the screenreader. Already addressed in â€œKeyboard/Gesturesâ€ section above.\r\n  - On mobile, sub nav within File Browser, and numerous other icons/buttons across the site are too small to select. Need to at least be 44px by 44px.\r\n\r\n- [ ] Issue Area # 2\r\n- **Expectation**: Current focus is visually indicated on screen and programmatically exposed. (WCAG Criteria 2.4.7 (AA))\r\n- **Observed**: Keyboard tab focus is never exposed. Never.\r\n\r\n- [ ] Issue Area # 3 (90% solved with Ticket: #9696. Will audit system after that and landmarks gets in, but to date all of the other sections seem in order and may just need to nitpick with listen form labels before the field is read or when focused on it, etc.)\r\n- **Expectation**: Focus moves in a logical order or flow. (WCAG Criteria 2.4.3 (A))\r\n- **Observed**: So many elements are not in the tab order so impossible to say. Safe to say it is probably logical, but the navs will need tweaking. Needs to be readdressed after tab order gets fixed.\r\n\r\n### Text\r\n- [ ] Issue Area # 1 (Ticket: #9682 & #9686)\r\n- **Expectation**: ALT text or other text equivalent is provided for all non-text static elements with content (WCAG Criteria 1.1.1 (A), 1.3.1 (A), and 2.4.6 (AA)).\r\n- **Observed**:\r\n  - Vertical tabs (sidebars) do not have ALT text. Title element is not readable to screenreaders. (#9686)\r\n  - No ALT text on File Browserâ€™s sub-nav icons (Ticket: #9682)\r\n  - Close tab icon is an image with no ALT text also so users donâ€™t know what that is and may accidentally close a tab theyâ€™re working on. (Ticket: #9682)\r\n\r\n- [ ] Issue Area # 2\r\n- **Expectation**: Links are visually distinct with text that explains what will happen when the link is clicked (WCAG Criteria 1.4.1 (A), 2.4.4 (A))\r\n- **Observed**:\r\n  - Sometimes hard to figure out whatâ€™s a button or a link. One will send you somewhere and one preforms an action so important to know.\r\n  - Kernel Sessions, footer tabs, and perhaps others are not visually distinct from surrounding text.\r\n  - Install, Uninstall, and Disable button within packages section look like text\r\n  - Various elements with a screenreader are not explaining what they do. All buttons that toggle a view, filter, etc donâ€™t say toggle, filter, etc. Kernel search missing type of â€œsearchâ€, package search missing type of â€œsearchâ€, package expand icon missing label\r\n\r\n- [ ] Issue Area # 3 (50% done with Ticket: #9622, rest will add notes for later)\r\n- **Expectation**: All controls, feedback, mechanisms, status indicators, navigational mechanisms, etc. are meaningfully and consistently labeled throughout the interface (WCAG Criteria 3.2.3 (A), 3.2.4 (A)).\r\n- **Observed**: Consistent, yes, but none from any of the 2-3 navs and up to 2 sidebars are labeled.\r\n\r\n- [ ] Issue Area # 4\r\n- **Expectation**: Interactive elements such as controls, form fields, and other form elements include sufficient information such as hints, help, mandatory format, length, values, status, and if the field is required (WCAG Criteria 3.3.1 (A), 3.3.2 (A)).\r\n- **Observed**:\r\n  - Dropdowns found in the top nav are not labeled with aria-expanded=â€trueâ€ and â€œfalseâ€ when their submenus are open or not. In addition they are also missing the aria-haspopup=â€trueâ€ which all provides additional information to the screenreader.\r\n  - Line column form has no type of text and input is missing aria-labelledby and then the label id below it.\r\n  - Modals have no role=â€dialogâ€ and the text within no role=â€alertâ€ to interrupt the screenreader to inform them they have hit an error or they need to confirm something.\r\n  - Search fields need role=â€searchâ€. Mentioned earlier.\r\n  - (MENTIONED EARLIER/is Duplicate) Various elements with a screenreader are not explaining what they do. All buttons that toggle donâ€™t say toggle. Kernel search missing type of â€œsearchâ€, package search missing type of â€œsearchâ€, package expand icon missing label\r\n\r\n- [ ] Issue Area # 5 (Ticket: #9682)\r\n- **Expectation**: All decorative elements are coded as decorative and vis-a-versa. (WCAG Criteria 1.1.1 (A) and 1.3.1 (A)).\r\n- **Observed**:\r\n  - Package selection icons have no alt text. Add alt=â€{descriptionâ€}â€ to them.\r\n  - Documentation images have no alt text. Add alt=â€{descriptionâ€}â€ to them.\r\n  - Tab icons no alt text. If text font add aria-label=\"{label\". If image tag add alt=â€{descriptionâ€}â€. If SVG tag, add <title>\"{title}\"</title> and <desc>\"{description}\"</desc> sub tags.\r\n  - Kernal Sessions icons no alt text. Add alt=â€{descriptionâ€}â€ to them.\r\n  - Launcher type icons should be decorative, an aria-hidden=â€trueâ€ should be applied to them.\r\nIMAGES of ALL of these problem areas: https://imgur.com/a/6HvOcYK\r\n\r\n- [ ] Issue Area # 6\r\n- **Expectation**: Meaningful labels are provided when user input is required. (WCAG Criteria 1.1.1 (A))).\r\n- **Observed**:\r\n  - Search fields donâ€™t specify what they are searching or if itâ€™s a search or a filter functionality. Difference is a filter typically already has results below the user can look at.\r\n  - Find/Replace input not type of text, missing form, missing descriptions of which field is which also if I remember correctly.\r\n  - (MENTIONED EARLIER/is Duplicate Line column form has no type of text and input is missing aria-labelledby and then the label id below it.\r\n  - Inputs within modals coming from the top nav bar probably need labeling as well or placeholder text.\r\n\r\n- [ ] Issue Area # 7 (Ticket: #9684)\r\n- **Expectation**: The line height, paragraph spacing, letter spacing, and word spacing can be adjusted without loss of content or functionality. Should support line height at least 1.5 times font-size, letter spacing 0.12 times font-size, paragraph spacing at least 2 times font-size, and word-spacing at least 0.16 times font-size. (WCAG Criteria 1.4.12 Text Spacing).\r\n- **Observed**: When injecting the CSS most accessibility or elder-friendly browser extensions inject, found that Launcher tabâ€™s text within kernel containers wraps and gets cut off (accessibility issue). In addition the nav in the header gets off centered and leaves a shadow looking thing when expanding their dropdowns (cosmetic issue).\r\n\r\n- [ ] Issue Area # 8 (Ticket: #9682)\r\n- **Expectation**: The programmatic and visual labeling of all user interface components with text or images of text are the same. (WCAG Criteria 2.5.3 (A)).\r\n- **Observed**: Images found under the packages section appear decorative but provide context of who is it that made the package/extension. Some of those labels such as IBM, Lab, Jupyter all include text within the image that is meant to provide additional information that a blind user wouldnâ€™t have.\r\n- **Solution** Images found under the packages section need ALT text (ex. alt=â€Created by IBMâ€) or hidden with aria-hidden=â€œtrueâ€ and another field added to these listings that provide information on the maker.\r\n\r\n### Content, Organization, and Navigation\r\n- [ ] Issue Area # 1 (Landmarks) (Ticket #9622 and partially #9686. Will need another for forms, but lower priority and not needed for compliance)\r\n- **Expectation**: Appropriate text and code labels are included to allow quick orientation and movement between pages and sections (WCAG Criteria 1.3.1 (A), 2.4.2 (A), and 2.4.6 (AA).\r\n- **Observed**:\r\n  - Forms are not using <form> tag. In it's place the role=â€formâ€ to simulate this isn't used either.\r\n  - **(DONE w/ #9622)** No <section> tags or or role=\"region\" are used. Which like the header, footer, and rolls like searches and navigation is needed so screenreader users to instantly jump between sections with a single click of the keyboard.\r\n  - **(DONE w/ #9622)** None of the 2-3 navs are using the <nav> tags or using divs with role=â€navigationâ€ with aria-labels to help the screenreader user differentiate between the 2-3.\r\n  - **(DONE w/ #9622)** No use of either the `<header>` tag or role=â€bannerâ€ has been applied to the div acting as the header tag.\r\n  - **(DONE w/ #9622)** No use of either the `<footer>` tag or role=\"contentinfo\" has been applied to the div acting as the footer tag.\r\n  - **(DONE w/ #9622)** No use of the role=â€complementaryâ€ for the 1-2 side bars and aria-labels for the user to be able to help differentiate between them.\r\n  - Headers are missing an H1 on every page so need to figure out how to handle it to either force notebooks all down one (doing some hack) or stay compliant and let them break it should they desire but we need to be compliant at the start. Logo may need to secretly be set as an H1 with screenreader text of â€œJupyterLabâ€ or something.\r\n  - (BUG - UNRELATED) Header 3 (H3) featuring no text appears at the top of the Launcher page. Not sure why.\r\n\r\n- [ ] Issue Area # 2 (Ticket: #9696)\r\n- **Expectation**: The reading order of assistive technology is complete, logical, and intuitive (WCAG Criteria 1.3.2 (A), 2.4.3 (A)).\r\n- **Observed**:\r\n  - When testing to see if the site is still usable or logical when loading without a stylesheet which is how you test this and also how a super small % of users may choose to view the site when fonts, contrast, and background images are too prolific and busy, JupyterLab looks like the image below.\r\n![jupyterlab without styling](https://user-images.githubusercontent.com/51969207/100277105-96cec100-2f30-11eb-8c48-dc895b706ec7.PNG)\r\n\r\n  - All of the dropdownâ€™s links are showing up in the tab order and shouldnâ€™t until you expand it.\r\n  - Text is overlapping indicating usually hardcoded styling regarding positioning.\r\n  - Every icon, every, is missing screenreader-only text.\r\n- **Proposed Solution**:\r\n  - Dropdown should by default have hardcoded styling of display: â€œnoneâ€ and upon button being selected display: â€œblockâ€ is applied. If you then open another, this needs to go back to none, and the new set to block. This prevents the user from getting overwhelmed.\r\n  - No hardcoded CSS should be applied but hiding or revealing things.\r\n  - All code editor buttons need alt text and images should be loaded in via CSS, not directly into the view. If user does not need to save the image (aka, the â€œCutâ€ button), it shouldnâ€™t be in the view. Donâ€™t use widths to align of these items, they should be inline-blocked. Rigid styles will prevent the flexibility of the webpage to mobile pages or 1500% zoom, and whatever else.\r\n\r\n- [x] Issue Area # 3 (Ticket: #9688)\r\n- **Expectation**: The user can skip navigation functions/sidebar and go straight to the content (WCAG Criteria 2.4.1 (A)).\r\n- **Observed**: No skip link exists is available to skip the header, navs, etc and just straight to the left panel or notebook, etc editing.\r\n- **Proposed Solution**: On first or second tab, have an element that is off screen gain focus and upon gaining focus changes position down 50px (all via CSS) and something that is either a single skip to the notebook panel or a table of contents that lets you jump to sidebar, left panel, notebook panel, whatever.\r\n\r\n- [ ] Issue Area # 4\r\n- **Expectation**: User is informed when content changes dynamically (WCAG Criteria 3.2.2 (A) and 4.1.3 Status Messages).\r\n- **Observed**: Running a notebook and the code shell shifting to reveal a graph, error, or whatever else does not inform the user an error was found or the notebook has finished without issue and content may have adjusted to reveal code cell results.\r\n- **Proposed Solution**: When an error is hit, create a visually hidden error message just for screenreaders with role=â€alertâ€ so it interrupts anything they were reading while it was running to inform them their notebook has hit and error and has been injected below the code shell in question. Should also change their focus to the first error found. On success, should not change focus but should still inform them via an invisible role=â€alertâ€ that their notebook completed successfully and may have had the space below their code cells adjusted with results. Really the more information you can give them the better. What kind of error, how many code cells, etc but the before mentioned is key.\r\n\r\n- [ ] Issue Area # 5\r\n- **Expectation**: Tables are used appropriately, are clearly organized, and labeled (WCAG Criteria 1.3.1 (A)).\r\n- **Observed**: File browser contains a fake table made out of divs. This needs to actually be a table with the property table formatting. Table > thead & tbody > tr th tr td etc. In addition, table needs to contain a <caption class=â€sr-onlyâ€> to explain the purpose of the table or just title it but only to screenreader users. Reason this is needed is because screenreader users can search by tables and just jump table to table if needed and it needs to have a description associated with it.\r\n\r\n- [ ] Issue Area # 6\r\n- **Expectation**: Content be used in both mobile portrait and mobile landscape orientation (WCAG Criteria 1.3.1 (A)).\r\n- **Observed**: Not mobile-responsive, switching shouldnâ€™t break but both are broken, which means on a desktop it wonâ€™t be able to magnify appropriately for low-vision users without content being cut off or hard to use.\r\n- **Proposed Solution**: Explained in other sections what exactly to fix, but in short, using CSS flex display is a life saver and wrapping entire panels/containers once a certain width is seen, using ems and percentages and adjusting font-sizes over hard-coded pixels, and a handful of other things will be Jupyter perfectly usable for Low Vision as well as mobile users.\r\n\r\n### Color, Contrast, and Zoom\r\n- [ ] Issue Area # 1 (Ticket: #10008)\r\n- **Expectation**: The default text and background size and colors provide sufficient contrast. (WCAG Criteria 1.4.3 (AA)).\r\n- **Observed for Default theme/OOTB Functionality**:\r\n  - File Browser/settings highlighted field have a 3.12 contrast ratio (white on light blue background). Needs to be contrast ratio of 4.5.\r\n  - Kernal Sessions â€œShut Downâ€ buttons have a 2.16 contrast ratio (bright orange on white) out of 4.5.\r\n  - Search section disabled console actions have a 2.68 contrast ratio out of 4.5 (gray on white background).\r\n  - Notebook â€œ[ ]:â€ text is 4.26 contrast ratio (light blue/green on white). Needs to be 4.5.\r\n  - Syntax highlighting fails in numerous places. The # 258f8f is 3.08 on red error background, the # 627d12 a 2.85, the # a1a6b2 a 1.93 â€“ make instead a # 007373, # 895f00, and # 5d6776 respectively.\r\n  - Settings tabs â€œ1 {â€œ text and file endings featuring green on white/gray are 2.59/2.85. Make it #008a00 instead.\r\n  - Syntax highlighter color # 8888ff is 2.99, use # 6464f1.\r\n\r\n- [ ] Issue Area # 2 (Ticket: #10008)\r\n- **Expectation**: Interface components and graphical objects that convey information have sufficient contrast with the background and surrounding objects (WCAG Criteria 1.4.11 Not-Text Contrast (AA)).\r\n- **Observed**: File search section search icon is 1.87 contrast (dark gray magnified glass on blue background) and needs to be a 3.0 or higher.\r\n\r\n- [ ] Issue Area # 3 (Ticket: #10004)\r\n- **Expectation**: The page can be zoomed to 400% in a 1280px wide display and site is still completely usable (no loss of functional). In addition this is done without requiring BOTH a vertical and horizontal scroll bar (WCAG Criteria â€“ {forgot}). For low vision support and assistance for color blind users.\r\n- **Observed**: 400% zoom makes coding impossible. File browser last modified column is lost, Kernel Session text only shows first letter (ex. â€œCâ€¦â€), Search section console, extensions, and other subsettings are trundated, and complete inability to see, access, or use footer buttons, right sidebar, packages button in the left sidebar, \r\n\r\n### Error Handling\r\n- [ ] Issue Area # 1\r\n- **Expectation**: Validation identifies the error, provides suggestion on fixing the error, and allows the user to fix the error. (WCAG Criteria 3.3.2 (A) and 3.3.3 (AA)).\r\n- **Observed**: (PENDING) Errors were mostly useful but I was only able to load a couple. Need to audit all of them. Will do that when able to test version 3.0+ of JupyterLab.\r\n\r\n### Extra Credit\r\n- [ ] Issue Area # 1\r\n- **Expectation**: Long waiting times or screens without text should inform the users with sceenreaders what the system is doing so they donâ€™t think think it crashed or computer black screened (so they donâ€™t turn restart their computer). \r\n- **Observed**: Initially loading JupyterLab loads the Jupyter logo which they canâ€™t read and they donâ€™t know what the page is doing nor when it is done.\r\n- **Proposed Solution**: On initial load an invisible message with role=â€alertâ€ that says â€œJupyterLab is loadingâ€ (said to screenreaders in 1.0 seconds). And then once the page loads, a new alert appears that stays on the page (although invisible and unable to grab focus) that says â€œJupyterLab has successfully loadedâ€. Users can re-read their alerts in case they forget, didnâ€™t hear it, or want to regain their train of thought.",
    "issue_word_count": 3157,
    "test_files_count": 3,
    "non_test_files_count": 18,
    "pr_changed_files": [
      "dev_mode/package.json",
      "galata/src/helpers/theme.ts",
      "galata/test/jupyterlab/general.test.ts",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png",
      "packages/application/style/sidepanel.css",
      "packages/metapackage/package.json",
      "packages/metapackage/tsconfig.json",
      "packages/metapackage/tsconfig.test.json",
      "packages/shortcuts-extension/style/base.css",
      "packages/theme-dark-high-contrast-extension/README.md",
      "packages/theme-dark-high-contrast-extension/package.json",
      "packages/theme-dark-high-contrast-extension/src/index.ts",
      "packages/theme-dark-high-contrast-extension/style/index.css",
      "packages/theme-dark-high-contrast-extension/style/index.js",
      "packages/theme-dark-high-contrast-extension/style/theme.css",
      "packages/theme-dark-high-contrast-extension/style/variables.css",
      "packages/theme-dark-high-contrast-extension/tsconfig.json",
      "packages/theme-dark-high-contrast-extension/typedoc.json",
      "packages/ui-components/style/sidepanel.css",
      "tsconfigdoc.json",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/general.test.ts",
      "galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png",
      "packages/metapackage/tsconfig.test.json"
    ],
    "base_commit": "41be86d5142a793ab9cb8b9eb99f92a33c8dc441",
    "head_commit": "53baccdefc2ff26efc2bb985a35a81732d1cfdfc",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15623",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15623",
    "dockerfile": "",
    "pr_merged_at": "2024-04-04T10:48:55.000Z",
    "patch": "diff --git a/dev_mode/package.json b/dev_mode/package.json\nindex aa7514d06d60..0605545a5246 100644\n--- a/dev_mode/package.json\n+++ b/dev_mode/package.json\n@@ -108,6 +108,7 @@\n     \"@jupyterlab/terminal\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/terminal-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/theme-dark-extension\": \"~4.2.0-beta.0\",\n+    \"@jupyterlab/theme-dark-high-contrast-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/theme-light-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/toc\": \"~6.2.0-beta.0\",\n     \"@jupyterlab/toc-extension\": \"~6.2.0-beta.0\",\n@@ -186,6 +187,7 @@\n     \"@jupyterlab/statusbar-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/terminal-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/theme-dark-extension\": \"~4.2.0-beta.0\",\n+    \"@jupyterlab/theme-dark-high-contrast-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/theme-light-extension\": \"~4.2.0-beta.0\",\n     \"@jupyterlab/toc-extension\": \"~6.2.0-beta.0\",\n     \"@jupyterlab/tooltip-extension\": \"~4.2.0-beta.0\",\n@@ -263,6 +265,7 @@\n       \"@jupyterlab/statusbar-extension\": \"\",\n       \"@jupyterlab/terminal-extension\": \"\",\n       \"@jupyterlab/theme-dark-extension\": \"\",\n+      \"@jupyterlab/theme-dark-high-contrast-extension\": \"\",\n       \"@jupyterlab/theme-light-extension\": \"\",\n       \"@jupyterlab/toc-extension\": \"\",\n       \"@jupyterlab/tooltip-extension\": \"\",\n@@ -435,6 +438,7 @@\n       \"@jupyterlab/terminal-extension\": \"../packages/terminal-extension\",\n       \"@jupyterlab/testing\": \"../packages/testing\",\n       \"@jupyterlab/theme-dark-extension\": \"../packages/theme-dark-extension\",\n+      \"@jupyterlab/theme-dark-high-contrast-extension\": \"../packages/theme-dark-high-contrast-extension\",\n       \"@jupyterlab/theme-light-extension\": \"../packages/theme-light-extension\",\n       \"@jupyterlab/toc\": \"../packages/toc\",\n       \"@jupyterlab/toc-extension\": \"../packages/toc-extension\",\n\ndiff --git a/galata/src/helpers/theme.ts b/galata/src/helpers/theme.ts\nindex 3e75d33ed041..197e35742743 100644\n--- a/galata/src/helpers/theme.ts\n+++ b/galata/src/helpers/theme.ts\n@@ -16,6 +16,13 @@ export class ThemeHelper {\n     await this.setTheme('JupyterLab Dark');\n   }\n \n+  /**\n+   * Set JupyterLab theme to Dark High Contrast\n+   */\n+  async setDarkHighContrastTheme(): Promise<void> {\n+    await this.setTheme('JupyterLab Dark High Contrast');\n+  }\n+\n   /**\n    * Set JupyterLab theme to Light\n    */\n\ndiff --git a/packages/application/style/sidepanel.css b/packages/application/style/sidepanel.css\nindex a849f3d6c2f5..7d8209b5a99e 100644\n--- a/packages/application/style/sidepanel.css\n+++ b/packages/application/style/sidepanel.css\n@@ -52,6 +52,11 @@\n   position: relative;\n }\n \n+.jp-SideBar .lm-TabBar-tab:focus-visible {\n+  outline: 4px solid var(--jp-accept-color-active, var(--jp-brand-color1));\n+  outline-offset: -1px;\n+}\n+\n .jp-SideBar .lm-TabBar-tab.lm-mod-current::after {\n   /* Internal border override pseudo-element */\n   position: absolute;\n\ndiff --git a/packages/metapackage/package.json b/packages/metapackage/package.json\nindex f923946a8f39..6e6463084cad 100644\n--- a/packages/metapackage/package.json\n+++ b/packages/metapackage/package.json\n@@ -121,6 +121,7 @@\n     \"@jupyterlab/terminal\": \"^4.2.0-beta.0\",\n     \"@jupyterlab/terminal-extension\": \"^4.2.0-beta.0\",\n     \"@jupyterlab/theme-dark-extension\": \"^4.2.0-beta.0\",\n+    \"@jupyterlab/theme-dark-high-contrast-extension\": \"^4.2.0-beta.0\",\n     \"@jupyterlab/theme-light-extension\": \"^4.2.0-beta.0\",\n     \"@jupyterlab/toc\": \"^6.2.0-beta.0\",\n     \"@jupyterlab/toc-extension\": \"^6.2.0-beta.0\",\n\ndiff --git a/packages/metapackage/tsconfig.json b/packages/metapackage/tsconfig.json\nindex 59f20ae24b23..d0f7338b7edc 100644\n--- a/packages/metapackage/tsconfig.json\n+++ b/packages/metapackage/tsconfig.json\n@@ -255,6 +255,9 @@\n     {\n       \"path\": \"../theme-dark-extension\"\n     },\n+    {\n+      \"path\": \"../theme-dark-high-contrast-extension\"\n+    },\n     {\n       \"path\": \"../theme-light-extension\"\n     },\n\ndiff --git a/packages/shortcuts-extension/style/base.css b/packages/shortcuts-extension/style/base.css\nindex 9d73fa561440..c79338b91ff9 100644\n--- a/packages/shortcuts-extension/style/base.css\n+++ b/packages/shortcuts-extension/style/base.css\n@@ -247,6 +247,7 @@\n   border-width: var(--jp-border-width);\n   margin: 3px 0;\n   padding: 5px 6px;\n+  color: var(--jp-ui-inverse-font-color1);\n }\n \n .jp-Shortcuts-Plus:hover {\n\ndiff --git a/packages/theme-dark-high-contrast-extension/README.md b/packages/theme-dark-high-contrast-extension/README.md\nnew file mode 100644\nindex 000000000000..ddd5ac3a3025\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/README.md\n@@ -0,0 +1,3 @@\n+# @jupyterlab/theme-dark-high-contrast-extension\n+\n+A JupyterLab theme extension which provides a dark high contrast theme.\n\ndiff --git a/packages/theme-dark-high-contrast-extension/package.json b/packages/theme-dark-high-contrast-extension/package.json\nnew file mode 100644\nindex 000000000000..6d700eb51496\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/package.json\n@@ -0,0 +1,51 @@\n+{\n+  \"name\": \"@jupyterlab/theme-dark-high-contrast-extension\",\n+  \"version\": \"4.2.0-beta.0\",\n+  \"description\": \"JupyterLab - Dark High Contrast Theme\",\n+  \"homepage\": \"https://github.com/jupyterlab/jupyterlab\",\n+  \"bugs\": {\n+    \"url\": \"https://github.com/jupyterlab/jupyterlab/issues\"\n+  },\n+  \"repository\": {\n+    \"type\": \"git\",\n+    \"url\": \"https://github.com/jupyterlab/jupyterlab.git\"\n+  },\n+  \"license\": \"BSD-3-Clause\",\n+  \"author\": \"Project Jupyter\",\n+  \"sideEffects\": true,\n+  \"main\": \"lib/index.js\",\n+  \"types\": \"lib/index.d.ts\",\n+  \"directories\": {\n+    \"lib\": \"lib/\"\n+  },\n+  \"files\": [\n+    \"lib/*.d.ts\",\n+    \"lib/*.js.map\",\n+    \"lib/*.js\",\n+    \"style/**/*.{css,eot,gif,html,jpg,json,png,svg,woff2,ttf}\",\n+    \"style/index.js\",\n+    \"src/**/*.{ts,tsx}\"\n+  ],\n+  \"scripts\": {\n+    \"build\": \"tsc -b\",\n+    \"clean\": \"rimraf lib && rimraf tsconfig.tsbuildinfo\",\n+    \"watch\": \"tsc -b --watch\"\n+  },\n+  \"dependencies\": {\n+    \"@jupyterlab/application\": \"^4.2.0-beta.0\",\n+    \"@jupyterlab/apputils\": \"^4.3.0-beta.0\",\n+    \"@jupyterlab/translation\": \"^4.2.0-beta.0\"\n+  },\n+  \"devDependencies\": {\n+    \"rimraf\": \"~5.0.5\",\n+    \"typedoc\": \"~0.24.7\",\n+    \"typescript\": \"~5.1.6\"\n+  },\n+  \"publishConfig\": {\n+    \"access\": \"public\"\n+  },\n+  \"jupyterlab\": {\n+    \"extension\": true,\n+    \"themePath\": \"style/theme.css\"\n+  }\n+}\n\ndiff --git a/packages/theme-dark-high-contrast-extension/src/index.ts b/packages/theme-dark-high-contrast-extension/src/index.ts\nnew file mode 100644\nindex 000000000000..63efff65a485\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/src/index.ts\n@@ -0,0 +1,41 @@\n+// Copyright (c) Jupyter Development Team.\n+// Distributed under the terms of the Modified BSD License.\n+/**\n+ * @packageDocumentation\n+ * @module theme-dark-high-contrast-extension\n+ */\n+\n+import {\n+  JupyterFrontEnd,\n+  JupyterFrontEndPlugin\n+} from '@jupyterlab/application';\n+import { IThemeManager } from '@jupyterlab/apputils';\n+import { ITranslator } from '@jupyterlab/translation';\n+\n+/**\n+ * A plugin for the Jupyter Dark Theme.\n+ */\n+const plugin: JupyterFrontEndPlugin<void> = {\n+  id: '@jupyterlab/theme-dark-high-contrast-extension:plugin',\n+  description: 'Adds a dark high contrast theme.',\n+  requires: [IThemeManager, ITranslator],\n+  activate: (\n+    app: JupyterFrontEnd,\n+    manager: IThemeManager,\n+    translator: ITranslator\n+  ) => {\n+    const trans = translator.load('jupyterlab');\n+    const style = '@jupyterlab/theme-dark-high-contrast-extension/index.css';\n+    manager.register({\n+      name: 'JupyterLab Dark High Contrast',\n+      displayName: trans.__('JupyterLab Dark High Contrast'),\n+      isLight: false,\n+      themeScrollbars: true,\n+      load: () => manager.loadCSS(style),\n+      unload: () => Promise.resolve(undefined)\n+    });\n+  },\n+  autoStart: true\n+};\n+\n+export default plugin;\n\ndiff --git a/packages/theme-dark-high-contrast-extension/style/index.css b/packages/theme-dark-high-contrast-extension/style/index.css\nnew file mode 100644\nindex 000000000000..e95e0399ef1e\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/style/index.css\n@@ -0,0 +1,8 @@\n+/*-----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+\n+/* This file was auto-generated by ensurePackage() in @jupyterlab/buildutils */\n+@import url('~@jupyterlab/apputils/style/index.css');\n+@import url('~@jupyterlab/application/style/index.css');\n\ndiff --git a/packages/theme-dark-high-contrast-extension/style/index.js b/packages/theme-dark-high-contrast-extension/style/index.js\nnew file mode 100644\nindex 000000000000..5b276eab001e\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/style/index.js\n@@ -0,0 +1,8 @@\n+/*-----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+\n+/* This file was auto-generated by ensurePackage() in @jupyterlab/buildutils */\n+import '@jupyterlab/apputils/style/index.js';\n+import '@jupyterlab/application/style/index.js';\n\ndiff --git a/packages/theme-dark-high-contrast-extension/style/theme.css b/packages/theme-dark-high-contrast-extension/style/theme.css\nnew file mode 100644\nindex 000000000000..dece106611b3\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/style/theme.css\n@@ -0,0 +1,26 @@\n+/*-----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+\n+@import './variables.css';\n+\n+/* Set the default typography for monospace elements */\n+tt,\n+code,\n+kbd,\n+samp,\n+pre {\n+  font-family: var(--jp-code-font-family);\n+  font-size: var(--jp-code-font-size);\n+  line-height: var(--jp-code-line-height);\n+}\n+\n+/* fix illegible yellow backround in exception stacktrace */\n+:where(\n+    .jp-RenderedText[data-mime-type='application/vnd.jupyter.stderr']\n+      pre\n+      .ansi-yellow-bg\n+  ) {\n+  color: black;\n+}\n\ndiff --git a/packages/theme-dark-high-contrast-extension/style/variables.css b/packages/theme-dark-high-contrast-extension/style/variables.css\nnew file mode 100644\nindex 000000000000..f8153a3bec97\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/style/variables.css\n@@ -0,0 +1,440 @@\n+/*-----------------------------------------------------------------------------\n+| Copyright (c) Jupyter Development Team.\n+| Distributed under the terms of the Modified BSD License.\n+|----------------------------------------------------------------------------*/\n+\n+/*\n+The following CSS variables define the main, public API for styling JupyterLab.\n+These variables should be used by all plugins wherever possible. In other\n+words, plugins should not define custom colors, sizes, etc unless absolutely\n+necessary. This enables users to change the visual theme of JupyterLab\n+by changing these variables.\n+\n+Many variables appear in an ordered sequence (0,1,2,3). These sequences\n+are designed to work well together, so for example, `--jp-border-color1` should\n+be used with `--jp-layout-color1`. The numbers have the following meanings:\n+\n+* 0: super-primary, reserved for special emphasis\n+* 1: primary, most important under normal situations\n+* 2: secondary, next most important under normal situations\n+* 3: tertiary, next most important under normal situations\n+\n+Throughout JupyterLab, we are mostly following principles from Google's\n+Material Design when selecting colors. We are not, however, following\n+all of MD as it is not optimized for dense, information rich UIs.\n+*/\n+\n+:root {\n+  /* Elevation\n+   *\n+   * We style box-shadows using Material Design's idea of elevation. These particular numbers are taken from here:\n+   *\n+   * https://github.com/material-components/material-components-web\n+   * https://material-components-web.appspot.com/elevation.html\n+   */\n+\n+  /* The dark theme shadows need a bit of work, but this will probably also require work on the core layout\n+   * colors used in the theme as well. */\n+  --jp-shadow-base-lightness: 32;\n+  --jp-shadow-umbra-color: rgba(\n+    var(--jp-shadow-base-lightness),\n+    var(--jp-shadow-base-lightness),\n+    var(--jp-shadow-base-lightness),\n+    0.2\n+  );\n+  --jp-shadow-penumbra-color: rgba(\n+    var(--jp-shadow-base-lightness),\n+    var(--jp-shadow-base-lightness),\n+    var(--jp-shadow-base-lightness),\n+    0.14\n+  );\n+  --jp-shadow-ambient-color: rgba(\n+    var(--jp-shadow-base-lightness),\n+    var(--jp-shadow-base-lightness),\n+    var(--jp-shadow-base-lightness),\n+    0.12\n+  );\n+  --jp-elevation-z0: none;\n+  --jp-elevation-z1: 0 2px 1px -1px var(--jp-shadow-umbra-color),\n+    0 1px 1px 0 var(--jp-shadow-penumbra-color),\n+    0 1px 3px 0 var(--jp-shadow-ambient-color);\n+  --jp-elevation-z2: 0 3px 1px -2px var(--jp-shadow-umbra-color),\n+    0 2px 2px 0 var(--jp-shadow-penumbra-color),\n+    0 1px 5px 0 var(--jp-shadow-ambient-color);\n+  --jp-elevation-z4: 0 2px 4px -1px var(--jp-shadow-umbra-color),\n+    0 4px 5px 0 var(--jp-shadow-penumbra-color),\n+    0 1px 10px 0 var(--jp-shadow-ambient-color);\n+  --jp-elevation-z6: 0 3px 5px -1px var(--jp-shadow-umbra-color),\n+    0 6px 10px 0 var(--jp-shadow-penumbra-color),\n+    0 1px 18px 0 var(--jp-shadow-ambient-color);\n+  --jp-elevation-z8: 0 5px 5px -3px var(--jp-shadow-umbra-color),\n+    0 8px 10px 1px var(--jp-shadow-penumbra-color),\n+    0 3px 14px 2px var(--jp-shadow-ambient-color);\n+  --jp-elevation-z12: 0 7px 8px -4px var(--jp-shadow-umbra-color),\n+    0 12px 17px 2px var(--jp-shadow-penumbra-color),\n+    0 5px 22px 4px var(--jp-shadow-ambient-color);\n+  --jp-elevation-z16: 0 8px 10px -5px var(--jp-shadow-umbra-color),\n+    0 16px 24px 2px var(--jp-shadow-penumbra-color),\n+    0 6px 30px 5px var(--jp-shadow-ambient-color);\n+  --jp-elevation-z20: 0 10px 13px -6px var(--jp-shadow-umbra-color),\n+    0 20px 31px 3px var(--jp-shadow-penumbra-color),\n+    0 8px 38px 7px var(--jp-shadow-ambient-color);\n+  --jp-elevation-z24: 0 11px 15px -7px var(--jp-shadow-umbra-color),\n+    0 24px 38px 3px var(--jp-shadow-penumbra-color),\n+    0 9px 46px 8px var(--jp-shadow-ambient-color);\n+\n+  /* Borders\n+   *\n+   * The following variables, specify the visual styling of borders in JupyterLab.\n+   */\n+\n+  --jp-border-width: 1px;\n+  --jp-border-color0: white;\n+  --jp-border-color1: white;\n+  --jp-border-color2: var(--md-grey-300);\n+  --jp-border-color3: white;\n+  --jp-inverse-border-color: var(--md-grey-600);\n+  --jp-border-radius: 2px;\n+\n+  /* UI Fonts\n+   *\n+   * The UI font CSS variables are used for the typography all of the JupyterLab\n+   * user interface elements that are not directly user generated content.\n+   *\n+   * The font sizing here is done assuming that the body font size of --jp-ui-font-size1\n+   * is applied to a parent element. When children elements, such as headings, are sized\n+   * in em all things will be computed relative to that body size.\n+   */\n+\n+  --jp-ui-font-scale-factor: 1.2;\n+  --jp-ui-font-size0: 0.83333em;\n+  --jp-ui-font-size1: 13px; /* Base font size */\n+  --jp-ui-font-size2: 1.2em;\n+  --jp-ui-font-size3: 1.44em;\n+  --jp-ui-font-family: system-ui, -apple-system, blinkmacsystemfont, 'Segoe UI',\n+    helvetica, arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',\n+    'Segoe UI Symbol';\n+\n+  /*\n+   * Use these font colors against the corresponding main layout colors.\n+   * In a light theme, these go from dark to light.\n+   */\n+\n+  /* Defaults use Material Design specification */\n+  --jp-ui-font-color0: rgba(255, 255, 255, 1);\n+  --jp-ui-font-color1: rgba(255, 255, 255, 1);\n+  --jp-ui-font-color2: rgba(255, 255, 255, 1);\n+  --jp-ui-font-color3: rgba(255, 255, 255, 1);\n+\n+  /*\n+   * Use these against the brand/accent/warn/error colors.\n+   * These will typically go from light to darker, in both a dark and light theme.\n+   */\n+\n+  --jp-ui-inverse-font-color0: white;\n+  --jp-ui-inverse-font-color1: black;\n+  --jp-ui-inverse-font-color2: white;\n+  --jp-ui-inverse-font-color3: white;\n+\n+  /* Content Fonts\n+   *\n+   * Content font variables are used for typography of user generated content.\n+   *\n+   * The font sizing here is done assuming that the body font size of --jp-content-font-size1\n+   * is applied to a parent element. When children elements, such as headings, are sized\n+   * in em all things will be computed relative to that body size.\n+   */\n+\n+  --jp-content-line-height: 1.6;\n+  --jp-content-font-scale-factor: 1.2;\n+  --jp-content-font-size0: 0.83333em;\n+  --jp-content-font-size1: 14px; /* Base font size */\n+  --jp-content-font-size2: 1.2em;\n+  --jp-content-font-size3: 1.44em;\n+  --jp-content-font-size4: 1.728em;\n+  --jp-content-font-size5: 2.0736em;\n+\n+  /* This gives a magnification of about 125% in presentation mode over normal. */\n+  --jp-content-presentation-font-size1: 17px;\n+  --jp-content-heading-line-height: 1;\n+  --jp-content-heading-margin-top: 1.2em;\n+  --jp-content-heading-margin-bottom: 0.8em;\n+  --jp-content-heading-font-weight: 500;\n+\n+  /* Defaults use Material Design specification */\n+  --jp-content-font-color0: rgba(255, 255, 255, 1);\n+  --jp-content-font-color1: rgba(255, 255, 255, 1);\n+  --jp-content-font-color2: rgba(255, 255, 255, 0.7);\n+  --jp-content-font-color3: rgba(255, 255, 255, 0.5);\n+  --jp-content-link-color: var(--md-blue-300);\n+  --jp-content-link-visited-color: #d979ea;\n+  --jp-content-link-hover-color: var(--md-blue-400);\n+  --jp-content-font-family: system-ui, -apple-system, blinkmacsystemfont,\n+    'Segoe UI', helvetica, arial, sans-serif, 'Apple Color Emoji',\n+    'Segoe UI Emoji', 'Segoe UI Symbol';\n+\n+  /*\n+   * Code Fonts\n+   *\n+   * Code font variables are used for typography of code and other monospaces content.\n+   */\n+\n+  --jp-code-font-size: 13px;\n+  --jp-code-line-height: 1.3077; /* 17px for 13px base */\n+  --jp-code-padding: 5px; /* 5px for 13px base, codemirror highlighting needs integer px value */\n+  --jp-code-font-family-default: menlo, consolas, 'DejaVu Sans Mono', monospace;\n+  --jp-code-font-family: var(--jp-code-font-family-default);\n+\n+  /* This gives a magnification of about 125% in presentation mode over normal. */\n+  --jp-code-presentation-font-size: 16px;\n+\n+  /* may need to tweak cursor width if you change font size */\n+  --jp-code-cursor-width0: 1.4px;\n+  --jp-code-cursor-width1: 2px;\n+  --jp-code-cursor-width2: 4px;\n+\n+  /* Layout\n+   *\n+   * The following are the main layout colors use in JupyterLab. In a light\n+   * theme these would go from light to dark.\n+   */\n+\n+  --jp-layout-color0: #111;\n+  --jp-layout-color1: #111;\n+  --jp-layout-color2: #424242;\n+  --jp-layout-color3: #111;\n+  --jp-layout-color4: white;\n+\n+  /* Inverse Layout\n+   *\n+   * The following are the inverse layout colors use in JupyterLab. In a light\n+   * theme these would go from dark to light.\n+   */\n+\n+  --jp-inverse-layout-color0: white;\n+  --jp-inverse-layout-color1: white;\n+  --jp-inverse-layout-color2: var(--md-grey-200);\n+  --jp-inverse-layout-color3: white;\n+  --jp-inverse-layout-color4: var(--md-grey-600);\n+\n+  /* Brand/accent - some colours have been updated to meet WCAG AAA for contrast with text */\n+\n+  --jp-brand-color0: var(--md-blue-700);\n+  --jp-brand-color1: #319bf2;\n+  --jp-brand-color2: var(--md-blue-300);\n+  --jp-brand-color3: var(--md-blue-100);\n+  --jp-brand-color4: var(--md-blue-50);\n+  --jp-accent-color0: var(--md-green-700);\n+  --jp-accent-color1: var(--md-green-500);\n+  --jp-accent-color2: var(--md-green-300);\n+  --jp-accent-color3: var(--md-green-100);\n+\n+  /* State colors (warn, error, success, info) */\n+\n+  --jp-warn-color0: var(--md-orange-700);\n+  --jp-warn-color1: var(--md-orange-500);\n+  --jp-warn-color2: var(--md-orange-300);\n+  --jp-warn-color3: var(--md-orange-100);\n+  --jp-error-color0: var(--md-red-700);\n+  --jp-error-color1: var(--md-red-500);\n+  --jp-error-color2: var(--md-red-300);\n+  --jp-error-color3: var(--md-red-100);\n+  --jp-success-color0: var(--md-green-700);\n+  --jp-success-color1: var(--md-green-500);\n+  --jp-success-color2: var(--md-green-300);\n+  --jp-success-color3: var(--md-green-100);\n+  --jp-info-color0: var(--md-cyan-700);\n+  --jp-info-color1: var(--md-cyan-500);\n+  --jp-info-color2: var(--md-cyan-300);\n+  --jp-info-color3: var(--md-cyan-100);\n+\n+  /* Cell specific styles */\n+\n+  --jp-cell-padding: 5px;\n+  --jp-cell-collapser-width: 8px;\n+  --jp-cell-collapser-min-height: 20px;\n+  --jp-cell-collapser-not-active-hover-opacity: 0.6;\n+  --jp-cell-editor-background: var(--jp-layout-color1);\n+  --jp-cell-editor-border-color: white;\n+  --jp-cell-editor-box-shadow: inset 0 0 2px var(--md-blue-300);\n+  --jp-cell-editor-active-background: var(--jp-layout-color0);\n+  --jp-cell-editor-active-border-color: var(--jp-brand-color1);\n+  --jp-cell-prompt-width: 64px;\n+  --jp-cell-prompt-font-family: var(--jp-code-font-family-default);\n+  --jp-cell-prompt-letter-spacing: 0;\n+  --jp-cell-prompt-opacity: 1;\n+  --jp-cell-prompt-not-active-opacity: 1;\n+  --jp-cell-prompt-not-active-font-color: var(--md-grey-300);\n+\n+  /* A custom blend of MD grey and blue 600\n+   * See https://meyerweb.com/eric/tools/color-blend/#546E7A:1E88E5:5:hex */\n+  --jp-cell-inprompt-font-color: #307fc1;\n+\n+  /* A custom blend of MD grey and orange 600\n+   * https://meyerweb.com/eric/tools/color-blend/#546E7A:F4511E:5:hex */\n+  --jp-cell-outprompt-font-color: #bf5b3d;\n+\n+  /* Notebook specific styles */\n+\n+  --jp-notebook-padding: 10px;\n+  --jp-notebook-select-background: var(--jp-layout-color1);\n+  --jp-notebook-multiselected-color: rgba(33, 150, 243, 0.24);\n+\n+  /* The scroll padding is calculated to fill enough space at the bottom of the\n+  notebook to show one single-line cell (with appropriate padding) at the top\n+  when the notebook is scrolled all the way to the bottom. We also subtract one\n+  pixel so that no scrollbar appears if we have just one single-line cell in the\n+  notebook. This padding is to enable a 'scroll past end' feature in a notebook.\n+  */\n+  --jp-notebook-scroll-padding: calc(\n+    100% - var(--jp-code-font-size) * var(--jp-code-line-height) -\n+      var(--jp-code-padding) - var(--jp-cell-padding) - 1px\n+  );\n+\n+  /* Rendermime styles */\n+\n+  --jp-rendermime-error-background: rgba(244, 67, 54, 0.28);\n+  --jp-rendermime-table-row-background: var(--md-grey-900);\n+  --jp-rendermime-table-row-hover-background: rgba(3, 169, 244, 0.2);\n+\n+  /* Dialog specific styles */\n+\n+  --jp-dialog-background: rgba(0, 0, 0, 0.6);\n+\n+  /* Console specific styles */\n+\n+  --jp-console-padding: 10px;\n+\n+  /* Toolbar specific styles */\n+\n+  --jp-toolbar-border-color: white;\n+  --jp-toolbar-micro-height: 8px;\n+  --jp-toolbar-background: var(--jp-layout-color1);\n+  --jp-toolbar-box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.8);\n+  --jp-toolbar-header-margin: 4px 4px 0 4px;\n+  --jp-toolbar-active-background: var(--jp-layout-color0);\n+\n+  /* Statusbar specific styles */\n+\n+  --jp-statusbar-height: 24px;\n+\n+  /* Input field styles */\n+\n+  --jp-input-box-shadow: inset 0 0 2px var(--md-blue-300);\n+  --jp-input-active-background: var(--jp-layout-color0);\n+  --jp-input-hover-background: var(--jp-layout-color2);\n+  --jp-input-background: var(--md-grey-800);\n+  --jp-input-border-color: white;\n+  --jp-input-active-border-color: white;\n+  --jp-input-active-box-shadow-color: rgba(19, 124, 189, 0.3);\n+\n+  /* General editor styles */\n+\n+  --jp-editor-selected-background: var(--jp-layout-color2);\n+  --jp-editor-selected-focused-background: rgba(33, 150, 243, 0.24);\n+  --jp-editor-cursor-color: var(--jp-ui-font-color0);\n+\n+  /* Code mirror specific styles */\n+\n+  --jp-mirror-editor-keyword-color: #4eb352;\n+  --jp-mirror-editor-atom-color: var(--md-blue-300);\n+  --jp-mirror-editor-number-color: var(--md-green-400);\n+  --jp-mirror-editor-def-color: var(--md-blue-600);\n+  --jp-mirror-editor-variable-color: var(--md-grey-300);\n+  --jp-mirror-editor-variable-2-color: var(--md-blue-500);\n+  --jp-mirror-editor-variable-3-color: var(--md-green-600);\n+  --jp-mirror-editor-punctuation-color: var(--md-blue-400);\n+  --jp-mirror-editor-property-color: var(--md-blue-400);\n+  --jp-mirror-editor-operator-color: #cc7cff;\n+  --jp-mirror-editor-comment-color: #56acac;\n+  --jp-mirror-editor-string-color: #ff7070;\n+  --jp-mirror-editor-string-2-color: var(--md-purple-300);\n+  --jp-mirror-editor-meta-color: #a2f;\n+  --jp-mirror-editor-qualifier-color: #555;\n+  --jp-mirror-editor-builtin-color: var(--md-green-600);\n+  --jp-mirror-editor-bracket-color: #a1a17d;\n+  --jp-mirror-editor-tag-color: var(--md-green-700);\n+  --jp-mirror-editor-attribute-color: var(--md-blue-700);\n+  --jp-mirror-editor-header-color: #32a4ff;\n+  --jp-mirror-editor-quote-color: var(--md-green-300);\n+  --jp-mirror-editor-link-color: var(--md-blue-700);\n+  --jp-mirror-editor-error-color: #f00;\n+  --jp-mirror-editor-hr-color: #999;\n+\n+  /*\n+    RTC user specific colors.\n+    These colors are used for the cursor, username in the editor,\n+    and the icon of the user.\n+  */\n+\n+  --jp-collaborator-color1: #ad4a00;\n+  --jp-collaborator-color2: #7b6a00;\n+  --jp-collaborator-color3: #007e00;\n+  --jp-collaborator-color4: #008772;\n+  --jp-collaborator-color5: #0079b9;\n+  --jp-collaborator-color6: #8b45c6;\n+  --jp-collaborator-color7: #be208b;\n+\n+  /* Vega extension styles */\n+\n+  --jp-vega-background: var(--md-grey-400);\n+\n+  /* Sidebar-related styles */\n+\n+  --jp-sidebar-min-width: 250px;\n+\n+  /* Search-related styles */\n+\n+  --jp-search-toggle-off-opacity: 0.6;\n+  --jp-search-toggle-hover-opacity: 0.8;\n+  --jp-search-toggle-on-opacity: 1;\n+  --jp-search-selected-match-background-color: rgb(255, 225, 0);\n+  --jp-search-selected-match-color: black;\n+  --jp-search-unselected-match-background-color: var(\n+    --jp-inverse-layout-color0\n+  );\n+  --jp-search-unselected-match-color: var(--jp-ui-inverse-font-color0);\n+\n+  /* scrollbar related styles. Supports every browser except Edge. */\n+\n+  /* colors based on JetBrain's Darcula theme */\n+\n+  --jp-scrollbar-background-color: #000;\n+  --jp-scrollbar-thumb-color: 88, 96, 97; /* need to specify thumb color as an RGB triplet */\n+  --jp-scrollbar-endpad: 3px; /* the minimum gap between the thumb and the ends of a scrollbar */\n+\n+  /* hacks for setting the thumb shape. These do nothing in Firefox */\n+\n+  --jp-scrollbar-thumb-margin: 3.5px; /* the space in between the sides of the thumb and the track */\n+  --jp-scrollbar-thumb-radius: 9px; /* set to a large-ish value for rounded endcaps on the thumb */\n+\n+  /* Icon colors that work well with light or dark backgrounds */\n+  --jp-icon-contrast-color0: var(--md-purple-600);\n+  --jp-icon-contrast-color1: var(--md-green-600);\n+  --jp-icon-contrast-color2: var(--md-pink-600);\n+  --jp-icon-contrast-color3: var(--md-blue-600);\n+\n+  /* Button colors */\n+  --jp-accept-color-normal: var(--md-blue-700);\n+  --jp-accept-color-hover: var(--md-blue-800);\n+  --jp-accept-color-active: var(--md-blue-900);\n+  --jp-warn-color-normal: var(--md-red-700);\n+  --jp-warn-color-hover: var(--md-red-800);\n+  --jp-warn-color-active: var(--md-red-900);\n+  --jp-reject-color-normal: var(--md-grey-600);\n+  --jp-reject-color-hover: var(--md-grey-700);\n+  --jp-reject-color-active: var(--md-grey-800);\n+\n+  /* File or activity icons and switch semantic variables */\n+  --jp-jupyter-icon-color: #f37626;\n+  --jp-notebook-icon-color: #f37626;\n+  --jp-json-icon-color: var(--md-orange-500);\n+  --jp-console-icon-background-color: var(--md-blue-500);\n+  --jp-console-icon-color: white;\n+  --jp-terminal-icon-background-color: var(--md-grey-200);\n+  --jp-terminal-icon-color: var(--md-grey-800);\n+  --jp-text-editor-icon-color: var(--md-grey-200);\n+  --jp-inspector-icon-color: var(--md-grey-200);\n+  --jp-switch-color: var(--md-grey-400);\n+  --jp-switch-true-position-color: var(--md-orange-700);\n+}\n\ndiff --git a/packages/theme-dark-high-contrast-extension/tsconfig.json b/packages/theme-dark-high-contrast-extension/tsconfig.json\nnew file mode 100644\nindex 000000000000..308d22557211\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/tsconfig.json\n@@ -0,0 +1,19 @@\n+{\n+  \"extends\": \"../../tsconfigbase\",\n+  \"compilerOptions\": {\n+    \"outDir\": \"lib\",\n+    \"rootDir\": \"src\"\n+  },\n+  \"include\": [\"src/*\"],\n+  \"references\": [\n+    {\n+      \"path\": \"../application\"\n+    },\n+    {\n+      \"path\": \"../apputils\"\n+    },\n+    {\n+      \"path\": \"../translation\"\n+    }\n+  ]\n+}\n\ndiff --git a/packages/theme-dark-high-contrast-extension/typedoc.json b/packages/theme-dark-high-contrast-extension/typedoc.json\nnew file mode 100644\nindex 000000000000..3959c182f6ce\n--- /dev/null\n+++ b/packages/theme-dark-high-contrast-extension/typedoc.json\n@@ -0,0 +1,4 @@\n+{\n+  \"out\": \"../../docs/api/theme-dark-high-contrast-extension\",\n+  \"theme\": \"../../typedoc-theme\"\n+}\n\ndiff --git a/packages/ui-components/style/sidepanel.css b/packages/ui-components/style/sidepanel.css\nindex 553a6ab71d38..13bf1bb24537 100644\n--- a/packages/ui-components/style/sidepanel.css\n+++ b/packages/ui-components/style/sidepanel.css\n@@ -55,6 +55,11 @@\n   font-size: var(--jp-ui-font-size0);\n }\n \n+.lm-AccordionPanel .jp-AccordionPanel-title:focus-visible {\n+  outline: 4px solid var(--jp-accept-color-active, var(--jp-brand-color1));\n+  outline-offset: -1px;\n+}\n+\n .jp-AccordionPanel-title {\n   cursor: pointer;\n   user-select: none;\n\ndiff --git a/tsconfigdoc.json b/tsconfigdoc.json\nindex 5d0e5af65d6e..9c1efc152eed 100644\n--- a/tsconfigdoc.json\n+++ b/tsconfigdoc.json\n@@ -271,6 +271,9 @@\n     {\n       \"path\": \"./packages/theme-dark-extension\"\n     },\n+    {\n+      \"path\": \"./packages/theme-dark-high-contrast-extension\"\n+    },\n     {\n       \"path\": \"./packages/theme-light-extension\"\n     },\n\ndiff --git a/yarn.lock b/yarn.lock\nindex c5402de82d2b..f9dc87c992b0 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2162,6 +2162,7 @@ __metadata:\n     \"@jupyterlab/statusbar-extension\": ~4.2.0-beta.0\n     \"@jupyterlab/terminal-extension\": ~4.2.0-beta.0\n     \"@jupyterlab/theme-dark-extension\": ~4.2.0-beta.0\n+    \"@jupyterlab/theme-dark-high-contrast-extension\": ~4.2.0-beta.0\n     \"@jupyterlab/theme-light-extension\": ~4.2.0-beta.0\n     \"@jupyterlab/toc-extension\": ~6.2.0-beta.0\n     \"@jupyterlab/tooltip-extension\": ~4.2.0-beta.0\n@@ -4136,6 +4137,7 @@ __metadata:\n     \"@jupyterlab/terminal-extension\": ^4.2.0-beta.0\n     \"@jupyterlab/testing\": ^4.2.0-beta.0\n     \"@jupyterlab/theme-dark-extension\": ^4.2.0-beta.0\n+    \"@jupyterlab/theme-dark-high-contrast-extension\": ^4.2.0-beta.0\n     \"@jupyterlab/theme-light-extension\": ^4.2.0-beta.0\n     \"@jupyterlab/toc\": ^6.2.0-beta.0\n     \"@jupyterlab/toc-extension\": ^6.2.0-beta.0\n@@ -4868,6 +4870,19 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n+\"@jupyterlab/theme-dark-high-contrast-extension@^4.2.0-beta.0, @jupyterlab/theme-dark-high-contrast-extension@workspace:packages/theme-dark-high-contrast-extension, @jupyterlab/theme-dark-high-contrast-extension@~4.2.0-beta.0\":\n+  version: 0.0.0-use.local\n+  resolution: \"@jupyterlab/theme-dark-high-contrast-extension@workspace:packages/theme-dark-high-contrast-extension\"\n+  dependencies:\n+    \"@jupyterlab/application\": ^4.2.0-beta.0\n+    \"@jupyterlab/apputils\": ^4.3.0-beta.0\n+    \"@jupyterlab/translation\": ^4.2.0-beta.0\n+    rimraf: ~5.0.5\n+    typedoc: ~0.24.7\n+    typescript: ~5.1.6\n+  languageName: unknown\n+  linkType: soft\n+\n \"@jupyterlab/theme-light-extension@^4.2.0-beta.0, @jupyterlab/theme-light-extension@workspace:packages/theme-light-extension, @jupyterlab/theme-light-extension@~4.2.0-beta.0\":\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/theme-light-extension@workspace:packages/theme-light-extension\"\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/general.test.ts b/galata/test/jupyterlab/general.test.ts\nindex 9e26b80b93d2..5b5aaf250d39 100644\n--- a/galata/test/jupyterlab/general.test.ts\n+++ b/galata/test/jupyterlab/general.test.ts\n@@ -38,6 +38,13 @@ test.describe('General Tests', () => {\n     expect(await page.theme.getTheme()).toEqual('JupyterLab Light');\n   });\n \n+  test('Toggle Dark High Contrast theme', async ({ page }) => {\n+    await page.theme.setDarkHighContrastTheme();\n+    expect(await page.theme.getTheme()).toEqual(\n+      'JupyterLab Dark High Contrast'\n+    );\n+  });\n+\n   test('Toggle adaptive theme', async ({ page }) => {\n     await page.emulateMedia({ colorScheme: 'dark' });\n     await page.menu.clickMenuItem(\n\ndiff --git a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png\nindex 05ed050d7827..7630f015e975 100644\nBinary files a/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png and b/galata/test/jupyterlab/menus.test.ts-snapshots/opened-menu-settings-theme-jupyterlab-linux.png differ\n\ndiff --git a/packages/metapackage/tsconfig.test.json b/packages/metapackage/tsconfig.test.json\nindex deb5daace1c0..17b9dd937562 100644\n--- a/packages/metapackage/tsconfig.test.json\n+++ b/packages/metapackage/tsconfig.test.json\n@@ -251,6 +251,9 @@\n     {\n       \"path\": \"../theme-dark-extension\"\n     },\n+    {\n+      \"path\": \"../theme-dark-high-contrast-extension\"\n+    },\n     {\n       \"path\": \"../theme-light-extension\"\n     },\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15548",
    "pr_id": 15548,
    "issue_id": 15513,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Tracebacks do not link to files in `/`\n## Description\r\n\r\nhttps://github.com/jupyterlab/jupyterlab/pull/13390 introduced support for opening files from tracebacks. It works well for files in the user home (e.g. `~`) but it fails to link to files in Unix-like file systems this is any path starting with `/`\r\n\r\n## Reproduce\r\n\r\nCreate a test file in `/tmp/test`:\r\n\r\n```\r\nmkdir -p /tmp/test && echo 'def div(a, b): return a / b' > /tmp/test/div.py\r\n```\r\n\r\nRun jupyterlab from some place else\r\n\r\n```\r\nPYTHONPATH=$PYTHONPATH:/tmp/test jupyter lab\r\n```\r\n\r\nOr even in the `/tmp` to make sure this is not due to prefix mismatch:\r\n\r\n```\r\nPYTHONPATH=$PYTHONPATH:/tmp/test jupyter lab --ServerApp.root_dir /tmp/\r\n```\r\n\r\nCreate a notebook with a code cell `import div; div.div(1, 0)`\r\n\r\nRun and see no link:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/090d3fe4-48f5-46aa-a188-23c34b5c1621)\r\n\r\n\r\n## Expected behavior\r\n\r\n`/tmp/test/div.py:1` should be linkified\r\n\r\n## Context\r\n\r\n- JupyterLab version: 4.0.0a4",
    "issue_word_count": 158,
    "test_files_count": 1,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "packages/coreutils/src/url.ts",
      "packages/coreutils/test/url.spec.ts",
      "packages/rendermime-interfaces/src/index.ts",
      "packages/rendermime/src/registry.ts",
      "packages/rendermime/src/renderers.ts"
    ],
    "pr_changed_test_files": [
      "packages/coreutils/test/url.spec.ts"
    ],
    "base_commit": "2097a5f99bb1d139c714106a9e01ddd18c72739f",
    "head_commit": "3a76e9d39ac91e7d2f18907b3c860a5b5138346c",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15548",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15548",
    "dockerfile": "",
    "pr_merged_at": "2023-12-22T10:13:51.000Z",
    "patch": "diff --git a/packages/coreutils/src/url.ts b/packages/coreutils/src/url.ts\nindex 037b815e1471..6c76af1fe389 100644\n--- a/packages/coreutils/src/url.ts\n+++ b/packages/coreutils/src/url.ts\n@@ -141,16 +141,18 @@ export namespace URLExt {\n   /**\n    * Test whether the url is a local url.\n    *\n+   * @param allowRoot - Whether the paths starting at Unix-style filesystem root (`/`) are permitted.\n+   *\n    * #### Notes\n    * This function returns `false` for any fully qualified url, including\n    * `data:`, `file:`, and `//` protocol URLs.\n    */\n-  export function isLocal(url: string): boolean {\n+  export function isLocal(url: string, allowRoot: boolean = false): boolean {\n     const { protocol } = parse(url);\n \n     return (\n       (!protocol || url.toLowerCase().indexOf(protocol) !== 0) &&\n-      url.indexOf('/') !== 0\n+      (allowRoot ? url.indexOf('//') !== 0 : url.indexOf('/') !== 0)\n     );\n   }\n \n\ndiff --git a/packages/rendermime-interfaces/src/index.ts b/packages/rendermime-interfaces/src/index.ts\nindex 05f325e08f08..1cfa630add65 100644\n--- a/packages/rendermime-interfaces/src/index.ts\n+++ b/packages/rendermime-interfaces/src/index.ts\n@@ -488,12 +488,14 @@ export namespace IRenderMime {\n      * Whether the URL should be handled by the resolver\n      * or not.\n      *\n+     * @param allowRoot - Whether the paths starting at Unix-style filesystem root (`/`) are permitted.\n+     *\n      * #### Notes\n      * This is similar to the `isLocal` check in `URLExt`,\n      * but can also perform additional checks on whether the\n      * resolver should handle a given URL.\n      */\n-    isLocal?: (url: string) => boolean;\n+    isLocal?: (url: string, allowRoot?: boolean) => boolean;\n \n     /**\n      * Resolve a path from Jupyter kernel to a path:\n\ndiff --git a/packages/rendermime/src/registry.ts b/packages/rendermime/src/registry.ts\nindex ce7f539b638a..e214679feddc 100644\n--- a/packages/rendermime/src/registry.ts\n+++ b/packages/rendermime/src/registry.ts\n@@ -373,17 +373,22 @@ export namespace RenderMimeRegistry {\n      * Whether the URL should be handled by the resolver\n      * or not.\n      *\n+     * @param allowRoot - Whether the paths starting at Unix-style filesystem root (`/`) are permitted.\n+     *\n      * #### Notes\n      * This is similar to the `isLocal` check in `URLExt`,\n      * but it also checks whether the path points to any\n      * of the `IDrive`s that may be registered with the contents\n      * manager.\n      */\n-    isLocal(url: string): boolean {\n+    isLocal(url: string, allowRoot: boolean = false): boolean {\n       if (this.isMalformed(url)) {\n         return false;\n       }\n-      return URLExt.isLocal(url) || !!this._contents.driveName(decodeURI(url));\n+      return (\n+        URLExt.isLocal(url, allowRoot) ||\n+        !!this._contents.driveName(decodeURI(url))\n+      );\n     }\n \n     /**\n\ndiff --git a/packages/rendermime/src/renderers.ts b/packages/rendermime/src/renderers.ts\nindex a503b037f9b8..70bd3489f6d0 100644\n--- a/packages/rendermime/src/renderers.ts\n+++ b/packages/rendermime/src/renderers.ts\n@@ -1270,10 +1270,11 @@ namespace Private {\n     let locator = anchor.dataset.locator ? '#' + anchor.dataset.locator : '';\n     delete anchor.dataset.path;\n     delete anchor.dataset.locator;\n+    const allowRoot = true;\n \n     const isLocal = resolver.isLocal\n-      ? resolver.isLocal(path)\n-      : URLExt.isLocal(path);\n+      ? resolver.isLocal(path, allowRoot)\n+      : URLExt.isLocal(path, allowRoot);\n \n     // Bail if:\n     // - it is not a file-like url,\n",
    "test_patch": "diff --git a/packages/coreutils/test/url.spec.ts b/packages/coreutils/test/url.spec.ts\nindex b152815473f4..dc5d15c95108 100644\n--- a/packages/coreutils/test/url.spec.ts\n+++ b/packages/coreutils/test/url.spec.ts\n@@ -106,6 +106,10 @@ describe('@jupyterlab/coreutils', () => {\n         expect(URLExt.isLocal('foo/bar.txt')).toBe(true);\n         expect(URLExt.isLocal('bar.txt')).toBe(true);\n       });\n+      it('should optionally allow references to root', () => {\n+        expect(URLExt.isLocal('/foo/bar.txt', true)).toBe(true);\n+        expect(URLExt.isLocal('//foo/bar.txt', true)).toBe(false);\n+      });\n     });\n   });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15536",
    "pr_id": 15536,
    "issue_id": 15416,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Publish the visual regression test results to netlify?\nViewing test reports is time consuming and slows down review as @afshin mentioned during two separate calls.\r\n\r\nWe could either:\r\n- using a dedicated test management platform which not only allows to view test reports but also supports shards (https://github.com/jupyterlab/jupyterlab/issues/13600), tracks flaky tests etc: [currents.dev/playwright](https://currents.dev/playwright), [deploysentinel](https://www.deploysentinel.com/), Testmo - they are all quite expensive when it comes to the usage that we would require\r\n- build a home grown deploy to netlify step (which would be super simple as playwright already can output a single HTML file) and use per-PR preview URLs\r\n- use github pages which will be very difficult as we would need to build a custom solution to handle PRs from forks\r\n\r\nWe already use netlify in https://github.com/jupyter/jupyter.github.io which shows like this:\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/5832902/a7485a7a-5fb3-49d6-833e-522bb467de3f)\r\n\r\nAnd clicking on \"Details\" open a preview of the site. In our case it could open the visual regression test report.",
    "issue_word_count": 185,
    "test_files_count": 1,
    "non_test_files_count": 3,
    "pr_changed_files": [
      ".github/workflows/benchmark.yml",
      ".github/workflows/check-release.yml",
      ".github/workflows/galata.yml",
      ".github/workflows/linuxtests.yml"
    ],
    "pr_changed_test_files": [
      ".github/workflows/linuxtests.yml"
    ],
    "base_commit": "90a3c429e0fb51cc71bb385770963ae29c06533f",
    "head_commit": "b495c7c7b2706f190a5338fac854c315cbbcd26f",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15536",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15536",
    "dockerfile": "",
    "pr_merged_at": "2023-12-15T20:03:40.000Z",
    "patch": "diff --git a/.github/workflows/benchmark.yml b/.github/workflows/benchmark.yml\nindex af0f6a8b57c7..60cb28974081 100644\n--- a/.github/workflows/benchmark.yml\n+++ b/.github/workflows/benchmark.yml\n@@ -190,7 +190,7 @@ jobs:\n \n       - name: Upload Galata Test assets\n         if: always()\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: benchmark-assets\n           path: |\n\ndiff --git a/.github/workflows/check-release.yml b/.github/workflows/check-release.yml\nindex cb82187d1e87..37ef8dfcd612 100644\n--- a/.github/workflows/check-release.yml\n+++ b/.github/workflows/check-release.yml\n@@ -26,7 +26,7 @@ jobs:\n           version_spec: next\n \n       - name: Upload Assets\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: jupyterlab-releaser-dist-${{ github.run_number }}\n           path: |\n\ndiff --git a/.github/workflows/galata.yml b/.github/workflows/galata.yml\nindex 1d2c032b9c82..a599c3531c6d 100644\n--- a/.github/workflows/galata.yml\n+++ b/.github/workflows/galata.yml\n@@ -65,7 +65,7 @@ jobs:\n \n       - name: Upload Galata Test assets\n         if: always()\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: jupyterlab-galata-test-assets\n           path: |\n@@ -74,7 +74,7 @@ jobs:\n \n       - name: Upload Galata Test report\n         if: always()\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: jupyterlab-galata-report\n           path: |\n@@ -176,7 +176,7 @@ jobs:\n \n       - name: Upload Galata Test assets\n         if: always()\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: jupyterlab-documentation-test-assets\n           path: |\n@@ -184,7 +184,7 @@ jobs:\n \n       - name: Upload Galata Test report\n         if: always()\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: jupyterlab-documentation-report\n           path: |\n",
    "test_patch": "diff --git a/.github/workflows/linuxtests.yml b/.github/workflows/linuxtests.yml\nindex 127d3d701316..4b4b57946d38 100644\n--- a/.github/workflows/linuxtests.yml\n+++ b/.github/workflows/linuxtests.yml\n@@ -72,7 +72,7 @@ jobs:\n \n       - name: Upload ${{ matrix.group }} results\n         if: ${{ matrix.upload-output && always() }}\n-        uses: actions/upload-artifact@v3\n+        uses: actions/upload-artifact@v4\n         with:\n           name: ${{ matrix.group }} ${{ github.run_number }}\n           path: |\n@@ -112,7 +112,7 @@ jobs:\n         run: |\n           pip install build\n           python -m build --sdist\n-      - uses: actions/upload-artifact@v3\n+      - uses: actions/upload-artifact@v4\n         with:\n           name: \"sdist\"\n           path: dist/*.tar.gz\n@@ -126,7 +126,7 @@ jobs:\n       - name: Base Setup\n         uses: jupyterlab/maintainer-tools/.github/actions/base-setup@v1\n       - name: Download sdist\n-        uses: actions/download-artifact@v3\n+        uses: actions/download-artifact@v4\n       - name: Install From SDist\n         run: |\n           set -ex\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15512",
    "pr_id": 15512,
    "issue_id": 15486,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Plugin manager doesn't allow users to enable an extension\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nTo disable extensions, the plugin manager seems to be writing the `page_config` to the `sys_prefix` location and not a location in the user directory. Whenever I try to disable a plugin it throws the following error  in the UI - \r\n```\r\nError when performing an action.\r\nReason given:\r\nError: PermissionError(13, 'Permission denied')\r\n\r\n```\r\n\r\nand the following error in the console - \r\n```\r\nERROR 16:11:53 500 POST /lab/api/plugins?1701686512826 (choudhdi@10.240.172.120) 382.22ms referer=http://localhost:8888/lab/workspaces/auto-n\r\n```\r\n\r\n<!--Describe the bug clearly and concisely. Include screenshots if possible-->\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\nTry to disable any extension using the plugin manager.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\n<!--Describe what you expected to happen-->\r\nIt shouldn't throw a permission denied error.\r\n\r\n## Context\r\njupyterlab==4.1.0a4\r\n",
    "issue_word_count": 200,
    "test_files_count": 1,
    "non_test_files_count": 4,
    "pr_changed_files": [
      "docs/source/user/extensions.rst",
      "jupyterlab/extensions/manager.py",
      "jupyterlab/labapp.py",
      "jupyterlab/tests/test_extensions.py",
      "pyproject.toml"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/test_extensions.py"
    ],
    "base_commit": "1c2741f123c5a82603fb75fbc50ef3ff077a876c",
    "head_commit": "8dbb791114a40b2c7962b8e04d364db8bb134279",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15512",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15512",
    "dockerfile": "",
    "pr_merged_at": "2023-12-12T20:38:20.000Z",
    "patch": "diff --git a/docs/source/user/extensions.rst b/docs/source/user/extensions.rst\nindex 8d9cf75421da..82ce2ef2626d 100644\n--- a/docs/source/user/extensions.rst\n+++ b/docs/source/user/extensions.rst\n@@ -377,6 +377,13 @@ running the ``jupyter labextension enable`` or ``jupyter labextension disable``\n    :class: jp-screenshot\n    :alt: An example search result in the plugin extension listing.\n \n+\n+Plugins can be enabled/disabled on ``system``, ``sys-prefix`` (default) or\n+``user`` level, which influences where the ``page_config.json`` configuration\n+file is written to (see ``config` section in results of ``jupyter --paths``).\n+To change the level for the plugin manager and the default extension manager\n+use ``PluginManager.level`` trait (extension manager inherits from plugin manager).\n+\n .. _locking_plugins:\n \n Locking and Unlocking Plugins\n\ndiff --git a/jupyterlab/extensions/manager.py b/jupyterlab/extensions/manager.py\nindex 76594c9ecf0d..56a9ee82b44d 100644\n--- a/jupyterlab/extensions/manager.py\n+++ b/jupyterlab/extensions/manager.py\n@@ -11,6 +11,7 @@\n \n import tornado\n from jupyterlab_server.translation_utils import translator\n+from traitlets import Enum\n from traitlets.config import Configurable, LoggingConfigurable\n \n from jupyterlab.commands import (\n@@ -192,6 +193,12 @@ class PluginManager(LoggingConfigurable):\n         options: Plugin manager options\n     \"\"\"\n \n+    level = Enum(\n+        values=[\"sys_prefix\", \"user\", \"system\"],\n+        default_value=\"sys_prefix\",\n+        help=\"Level at which to manage plugins: sys_prefix, user, system\",\n+    ).tag(config=True)\n+\n     def __init__(\n         self,\n         app_options: Optional[dict] = None,\n@@ -199,6 +206,9 @@ def __init__(\n         parent: Optional[Configurable] = None,\n     ) -> None:\n         super().__init__(parent=parent)\n+        self.log.debug(\n+            \"Plugins in %s will managed on the %s level\", self.__class__.__name__, self.level\n+        )\n         self.app_options = _ensure_options(app_options)\n         plugin_options_field = {f.name for f in fields(PluginManagerOptions)}\n         plugin_options = {\n@@ -255,7 +265,7 @@ async def disable(self, plugins: Union[str, List[str]]) -> ActionResult:\n             )\n         try:\n             for plugin in plugins:\n-                disable_extension(plugin, app_options=self.app_options)\n+                disable_extension(plugin, app_options=self.app_options, level=self.level)\n             return ActionResult(status=\"ok\", needs_restart=[\"frontend\"])\n         except Exception as err:\n             return ActionResult(status=\"error\", message=repr(err))\n@@ -281,7 +291,7 @@ async def enable(self, plugins: Union[str, List[str]]) -> ActionResult:\n             )\n         try:\n             for plugin in plugins:\n-                enable_extension(plugin, app_options=self.app_options)\n+                enable_extension(plugin, app_options=self.app_options, level=self.level)\n             return ActionResult(status=\"ok\", needs_restart=[\"frontend\"])\n         except Exception as err:\n             return ActionResult(status=\"error\", message=repr(err))\n\ndiff --git a/jupyterlab/labapp.py b/jupyterlab/labapp.py\nindex 1fb700394cd6..f30a445e1545 100644\n--- a/jupyterlab/labapp.py\n+++ b/jupyterlab/labapp.py\n@@ -867,6 +867,7 @@ def initialize_handlers(self):  # noqa\n                                 \"lock_rules\": lock_rules,\n                                 \"all_locked\": self.lock_all_plugins,\n                             },\n+                            parent=self,\n                         )\n                     },\n                 )\n\ndiff --git a/pyproject.toml b/pyproject.toml\nindex dab92b1865db..6a366a3c484b 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -213,7 +213,7 @@ npm = [\"node\", \"yarn.js\"]\n \n [tool.pytest.ini_options]\n testpaths = \"jupyterlab/tests\"\n-norecursedirs = \"node_modules .git _build\"\n+norecursedirs = \"node_modules .git _build .ipynb_checkpoints\"\n addopts = \"--pdbcls=IPython.terminal.debugger:Pdb -v --junitxml=junit.xml\"\n ignore = \"tests examples\"\n \n",
    "test_patch": "diff --git a/jupyterlab/tests/test_extensions.py b/jupyterlab/tests/test_extensions.py\nindex 9df368b044a6..e6bcdfde2654 100644\n--- a/jupyterlab/tests/test_extensions.py\n+++ b/jupyterlab/tests/test_extensions.py\n@@ -8,7 +8,7 @@\n from traitlets.config import Config, Configurable\n \n from jupyterlab.extensions import PyPIExtensionManager, ReadOnlyExtensionManager\n-from jupyterlab.extensions.manager import ExtensionManager, ExtensionPackage\n+from jupyterlab.extensions.manager import ExtensionManager, ExtensionPackage, PluginManager\n \n from . import fake_client_factory\n \n@@ -340,3 +340,32 @@ async def test_PyPiExtensionManager_custom_server_url():\n     manager = PyPIExtensionManager(parent=parent)\n \n     assert manager.base_url == BASE_URL\n+\n+\n+LEVELS = [\"user\", \"sys_prefix\", \"system\"]\n+\n+\n+@pytest.mark.parametrize(\"level\", LEVELS)\n+async def test_PyPiExtensionManager_custom_level(level):\n+    parent = Configurable(config=Config({\"PyPIExtensionManager\": {\"level\": level}}))\n+    manager = PyPIExtensionManager(parent=parent)\n+    assert manager.level == level\n+\n+\n+@pytest.mark.parametrize(\"level\", LEVELS)\n+async def test_PyPiExtensionManager_inherits_custom_level(level):\n+    parent = Configurable(config=Config({\"PluginManager\": {\"level\": level}}))\n+    manager = PyPIExtensionManager(parent=parent)\n+    assert manager.level == level\n+\n+\n+@pytest.mark.parametrize(\"level\", LEVELS)\n+async def test_PluginManager_custom_level(level):\n+    parent = Configurable(config=Config({\"PluginManager\": {\"level\": level}}))\n+    manager = PluginManager(parent=parent)\n+    assert manager.level == level\n+\n+\n+async def test_PluginManager_default_level():\n+    manager = PluginManager()\n+    assert manager.level == \"sys_prefix\"\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15502",
    "pr_id": 15502,
    "issue_id": 15460,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Need to update eslint dependencies (Typescript compatibility message)\n```\r\n=============\r\n\r\nWARNING: You are currently running a version of TypeScript which is not officially supported by @typescript-eslint/typescript-estree.\r\n\r\nYou may find that it works just fine, or you may not.\r\n\r\nSUPPORTED TYPESCRIPT VERSIONS: >=3.3.1 <5.1.0\r\n\r\nYOUR TYPESCRIPT VERSION: 5.1.6\r\n\r\nPlease only submit bug reports when using the officially supported version.\r\n\r\n=============\r\n```\r\n",
    "issue_word_count": 65,
    "test_files_count": 2,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "dev_mode/webpack.config.js",
      "galata/test/jupyterlab/sidebars.test.ts",
      "package.json",
      "packages/completer/src/manager.ts",
      "packages/docmanager-extension/src/index.tsx",
      "packages/filebrowser/test/model.spec.ts",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/sidebars.test.ts",
      "packages/filebrowser/test/model.spec.ts"
    ],
    "base_commit": "439f48d7e683ffa30a93f920bc18247cdb1d819c",
    "head_commit": "3e491bf304a5cfbf3f65d739abf9e321e09de27b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15502",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15502",
    "dockerfile": "",
    "pr_merged_at": "2023-12-09T17:03:03.000Z",
    "patch": "diff --git a/dev_mode/webpack.config.js b/dev_mode/webpack.config.js\nindex 4beb160bb68d..79961c8ef76e 100644\n--- a/dev_mode/webpack.config.js\n+++ b/dev_mode/webpack.config.js\n@@ -176,10 +176,9 @@ for (let pkg of extensionPackages) {\n const extraShared = [];\n for (let pkg of extensionPackages) {\n   let pkgShared = {};\n-  let {\n-    dependencies = {},\n-    jupyterlab: { sharedPackages = {} } = {}\n-  } = require(`${pkg}/package.json`);\n+  let { dependencies = {}, jupyterlab: { sharedPackages = {} } = {} } = require(\n+    `${pkg}/package.json`\n+  );\n   for (let [dep, requiredVersion] of Object.entries(dependencies)) {\n     if (!shared[dep]) {\n       pkgShared[dep] = { requiredVersion };\n\ndiff --git a/package.json b/package.json\nindex dfca9df864d4..2c9775774248 100644\n--- a/package.json\n+++ b/package.json\n@@ -110,13 +110,13 @@\n     \"yjs\": \"^13.5.40\"\n   },\n   \"dependencies\": {\n-    \"@typescript-eslint/eslint-plugin\": \"~5.55.0\",\n-    \"@typescript-eslint/parser\": \"~5.55.0\",\n-    \"eslint\": \"~8.36.0\",\n-    \"eslint-config-prettier\": \"~8.7.0\",\n-    \"eslint-plugin-jest\": \"~27.2.1\",\n-    \"eslint-plugin-prettier\": \"~5.0.0\",\n-    \"eslint-plugin-react\": \"~7.32.2\",\n+    \"@typescript-eslint/eslint-plugin\": \"~6.13.2\",\n+    \"@typescript-eslint/parser\": \"~6.13.2\",\n+    \"eslint\": \"~8.55.0\",\n+    \"eslint-config-prettier\": \"~9.1.0\",\n+    \"eslint-plugin-jest\": \"~27.6.0\",\n+    \"eslint-plugin-prettier\": \"~5.0.1\",\n+    \"eslint-plugin-react\": \"~7.33.2\",\n     \"prettier\": \"~3.0.0\",\n     \"stylelint\": \"^15.10.1\",\n     \"stylelint-config-prettier\": \"^9.0.3\",\n\ndiff --git a/packages/completer/src/manager.ts b/packages/completer/src/manager.ts\nindex 5ce5286d8ba6..b56c489e57e5 100644\n--- a/packages/completer/src/manager.ts\n+++ b/packages/completer/src/manager.ts\n@@ -189,9 +189,8 @@ export class CompletionProviderManager implements ICompletionProviderManager {\n \n       if (editor) {\n         handler.editor = editor;\n-        handler.reconciliator = await this.generateReconciliator(\n-          newCompleterContext\n-        );\n+        handler.reconciliator =\n+          await this.generateReconciliator(newCompleterContext);\n       }\n     }\n   }\n\ndiff --git a/packages/docmanager-extension/src/index.tsx b/packages/docmanager-extension/src/index.tsx\nindex d480deb75e87..8167c7116127 100644\n--- a/packages/docmanager-extension/src/index.tsx\n+++ b/packages/docmanager-extension/src/index.tsx\n@@ -1023,7 +1023,7 @@ function addCommands(\n           }\n         };\n         docManager.services.contents.fileChanged.connect(onChange);\n-        context\n+        void context\n           .saveAs()\n           .finally(() =>\n             docManager.services.contents.fileChanged.disconnect(onChange)\n\ndiff --git a/yarn.lock b/yarn.lock\nindex 3849a79c378b..3f940f7ce93b 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -5,6 +5,13 @@ __metadata:\n   version: 6\n   cacheKey: 8\n \n+\"@aashutoshrathi/word-wrap@npm:^1.2.3\":\n+  version: 1.2.6\n+  resolution: \"@aashutoshrathi/word-wrap@npm:1.2.6\"\n+  checksum: ada901b9e7c680d190f1d012c84217ce0063d8f5c5a7725bb91ec3c5ed99bb7572680eb2d2938a531ccbaec39a95422fcd8a6b4a13110c7d98dd75402f66a0cd\n+  languageName: node\n+  linkType: hard\n+\n \"@ampproject/remapping@npm:^2.2.0\":\n   version: 2.2.0\n   resolution: \"@ampproject/remapping@npm:2.2.0\"\n@@ -1638,45 +1645,45 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@eslint-community/eslint-utils@npm:^4.2.0\":\n-  version: 4.3.0\n-  resolution: \"@eslint-community/eslint-utils@npm:4.3.0\"\n+\"@eslint-community/eslint-utils@npm:^4.2.0, @eslint-community/eslint-utils@npm:^4.4.0\":\n+  version: 4.4.0\n+  resolution: \"@eslint-community/eslint-utils@npm:4.4.0\"\n   dependencies:\n     eslint-visitor-keys: ^3.3.0\n   peerDependencies:\n     eslint: ^6.0.0 || ^7.0.0 || >=8.0.0\n-  checksum: f487760a692f0f1fef76e248ad72976919576ba57edc2b1b1dc1d182553bae6b5bf7b078e654da85d04f0af8a485d20bd26280002768f4fbcd2e330078340cb0\n+  checksum: cdfe3ae42b4f572cbfb46d20edafe6f36fc5fb52bf2d90875c58aefe226892b9677fef60820e2832caf864a326fe4fc225714c46e8389ccca04d5f9288aabd22\n   languageName: node\n   linkType: hard\n \n-\"@eslint-community/regexpp@npm:^4.4.0\":\n-  version: 4.4.0\n-  resolution: \"@eslint-community/regexpp@npm:4.4.0\"\n-  checksum: 2d127af0c752b80e8a782eacfe996a86925d21de92da3ffc6f9e615e701145e44a62e26bdd88bfac2cd76779c39ba8d9875a91046ec5e7e5f23cb647c247ea6a\n+\"@eslint-community/regexpp@npm:^4.5.1, @eslint-community/regexpp@npm:^4.6.1\":\n+  version: 4.10.0\n+  resolution: \"@eslint-community/regexpp@npm:4.10.0\"\n+  checksum: 2a6e345429ea8382aaaf3a61f865cae16ed44d31ca917910033c02dc00d505d939f10b81e079fa14d43b51499c640138e153b7e40743c4c094d9df97d4e56f7b\n   languageName: node\n   linkType: hard\n \n-\"@eslint/eslintrc@npm:^2.0.1\":\n-  version: 2.0.1\n-  resolution: \"@eslint/eslintrc@npm:2.0.1\"\n+\"@eslint/eslintrc@npm:^2.1.4\":\n+  version: 2.1.4\n+  resolution: \"@eslint/eslintrc@npm:2.1.4\"\n   dependencies:\n     ajv: ^6.12.4\n     debug: ^4.3.2\n-    espree: ^9.5.0\n+    espree: ^9.6.0\n     globals: ^13.19.0\n     ignore: ^5.2.0\n     import-fresh: ^3.2.1\n     js-yaml: ^4.1.0\n     minimatch: ^3.1.2\n     strip-json-comments: ^3.1.1\n-  checksum: 56b9192a687a450db53a7b883daf9f0f447c43b3510189cf88808a7a2467c2a302a42a50f184cc6d5a9faf3d1df890a2ef0fd0d60b751f32a3e9dfea717c6b48\n+  checksum: 10957c7592b20ca0089262d8c2a8accbad14b4f6507e35416c32ee6b4dbf9cad67dfb77096bbd405405e9ada2b107f3797fe94362e1c55e0b09d6e90dd149127\n   languageName: node\n   linkType: hard\n \n-\"@eslint/js@npm:8.36.0\":\n-  version: 8.36.0\n-  resolution: \"@eslint/js@npm:8.36.0\"\n-  checksum: b7d6b84b823c8c7784be390741196617565527b1f7c0977fde9455bfb57fd88f81c074a03dd878757d2c33fa29f24291e9ecbc1425710f067917324b55e1bf3a\n+\"@eslint/js@npm:8.55.0\":\n+  version: 8.55.0\n+  resolution: \"@eslint/js@npm:8.55.0\"\n+  checksum: fa33ef619f0646ed15649b0c2e313e4d9ccee8425884bdbfc78020d6b6b64c0c42fa9d83061d0e6158e1d4274f03f0f9008786540e2efab8fcdc48082259908c\n   languageName: node\n   linkType: hard\n \n@@ -1694,14 +1701,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@humanwhocodes/config-array@npm:^0.11.8\":\n-  version: 0.11.8\n-  resolution: \"@humanwhocodes/config-array@npm:0.11.8\"\n+\"@humanwhocodes/config-array@npm:^0.11.13\":\n+  version: 0.11.13\n+  resolution: \"@humanwhocodes/config-array@npm:0.11.13\"\n   dependencies:\n-    \"@humanwhocodes/object-schema\": ^1.2.1\n+    \"@humanwhocodes/object-schema\": ^2.0.1\n     debug: ^4.1.1\n     minimatch: ^3.0.5\n-  checksum: 0fd6b3c54f1674ce0a224df09b9c2f9846d20b9e54fabae1281ecfc04f2e6ad69bf19e1d6af6a28f88e8aa3990168b6cb9e1ef755868c3256a630605ec2cb1d3\n+  checksum: f8ea57b0d7ed7f2d64cd3944654976829d9da91c04d9c860e18804729a33f7681f78166ef4c761850b8c324d362f7d53f14c5c44907a6b38b32c703ff85e4805\n   languageName: node\n   linkType: hard\n \n@@ -1712,10 +1719,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@humanwhocodes/object-schema@npm:^1.2.1\":\n-  version: 1.2.1\n-  resolution: \"@humanwhocodes/object-schema@npm:1.2.1\"\n-  checksum: a824a1ec31591231e4bad5787641f59e9633827d0a2eaae131a288d33c9ef0290bd16fda8da6f7c0fcb014147865d12118df10db57f27f41e20da92369fcb3f1\n+\"@humanwhocodes/object-schema@npm:^2.0.1\":\n+  version: 2.0.1\n+  resolution: \"@humanwhocodes/object-schema@npm:2.0.1\"\n+  checksum: 24929487b1ed48795d2f08346a0116cc5ee4634848bce64161fb947109352c562310fd159fc64dda0e8b853307f5794605191a9547f7341158559ca3c8262a45\n   languageName: node\n   linkType: hard\n \n@@ -4496,13 +4503,13 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"@jupyterlab/repo-top@workspace:.\"\n   dependencies:\n-    \"@typescript-eslint/eslint-plugin\": ~5.55.0\n-    \"@typescript-eslint/parser\": ~5.55.0\n-    eslint: ~8.36.0\n-    eslint-config-prettier: ~8.7.0\n-    eslint-plugin-jest: ~27.2.1\n-    eslint-plugin-prettier: ~5.0.0\n-    eslint-plugin-react: ~7.32.2\n+    \"@typescript-eslint/eslint-plugin\": ~6.13.2\n+    \"@typescript-eslint/parser\": ~6.13.2\n+    eslint: ~8.55.0\n+    eslint-config-prettier: ~9.1.0\n+    eslint-plugin-jest: ~27.6.0\n+    eslint-plugin-prettier: ~5.0.1\n+    eslint-plugin-react: ~7.33.2\n     lerna: ^7.1.4\n     prettier: ~3.0.0\n     stylelint: ^15.10.1\n@@ -6974,10 +6981,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@types/json-schema@npm:*, @types/json-schema@npm:^7.0.3, @types/json-schema@npm:^7.0.5, @types/json-schema@npm:^7.0.8, @types/json-schema@npm:^7.0.9\":\n-  version: 7.0.11\n-  resolution: \"@types/json-schema@npm:7.0.11\"\n-  checksum: 527bddfe62db9012fccd7627794bd4c71beb77601861055d87e3ee464f2217c85fca7a4b56ae677478367bbd248dbde13553312b7d4dbc702a2f2bbf60c4018d\n+\"@types/json-schema@npm:*, @types/json-schema@npm:^7.0.12, @types/json-schema@npm:^7.0.3, @types/json-schema@npm:^7.0.5, @types/json-schema@npm:^7.0.8, @types/json-schema@npm:^7.0.9\":\n+  version: 7.0.15\n+  resolution: \"@types/json-schema@npm:7.0.15\"\n+  checksum: 97ed0cb44d4070aecea772b7b2e2ed971e10c81ec87dd4ecc160322ffa55ff330dace1793489540e3e318d90942064bb697cc0f8989391797792d919737b3b98\n   languageName: node\n   linkType: hard\n \n@@ -7187,10 +7194,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@types/semver@npm:^7.1.0, @types/semver@npm:^7.3.12, @types/semver@npm:^7.3.3\":\n-  version: 7.5.0\n-  resolution: \"@types/semver@npm:7.5.0\"\n-  checksum: 0a64b9b9c7424d9a467658b18dd70d1d781c2d6f033096a6e05762d20ebbad23c1b69b0083b0484722aabf35640b78ccc3de26368bcae1129c87e9df028a22e2\n+\"@types/semver@npm:^7.1.0, @types/semver@npm:^7.3.12, @types/semver@npm:^7.3.3, @types/semver@npm:^7.5.0\":\n+  version: 7.5.6\n+  resolution: \"@types/semver@npm:7.5.6\"\n+  checksum: 563a0120ec0efcc326567db2ed920d5d98346f3638b6324ea6b50222b96f02a8add3c51a916b6897b51523aad8ac227d21d3dcf8913559f1bfc6c15b14d23037\n   languageName: node\n   linkType: hard\n \n@@ -7302,44 +7309,46 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@typescript-eslint/eslint-plugin@npm:~5.55.0\":\n-  version: 5.55.0\n-  resolution: \"@typescript-eslint/eslint-plugin@npm:5.55.0\"\n+\"@typescript-eslint/eslint-plugin@npm:~6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/eslint-plugin@npm:6.13.2\"\n   dependencies:\n-    \"@eslint-community/regexpp\": ^4.4.0\n-    \"@typescript-eslint/scope-manager\": 5.55.0\n-    \"@typescript-eslint/type-utils\": 5.55.0\n-    \"@typescript-eslint/utils\": 5.55.0\n+    \"@eslint-community/regexpp\": ^4.5.1\n+    \"@typescript-eslint/scope-manager\": 6.13.2\n+    \"@typescript-eslint/type-utils\": 6.13.2\n+    \"@typescript-eslint/utils\": 6.13.2\n+    \"@typescript-eslint/visitor-keys\": 6.13.2\n     debug: ^4.3.4\n-    grapheme-splitter: ^1.0.4\n-    ignore: ^5.2.0\n-    natural-compare-lite: ^1.4.0\n-    semver: ^7.3.7\n-    tsutils: ^3.21.0\n+    graphemer: ^1.4.0\n+    ignore: ^5.2.4\n+    natural-compare: ^1.4.0\n+    semver: ^7.5.4\n+    ts-api-utils: ^1.0.1\n   peerDependencies:\n-    \"@typescript-eslint/parser\": ^5.0.0\n-    eslint: ^6.0.0 || ^7.0.0 || ^8.0.0\n+    \"@typescript-eslint/parser\": ^6.0.0 || ^6.0.0-alpha\n+    eslint: ^7.0.0 || ^8.0.0\n   peerDependenciesMeta:\n     typescript:\n       optional: true\n-  checksum: e3239ec6016eeb73b8b4d8310581978e28b8d3378140a8eb70bd8e33ffd332266020c19d493e0ccae4edfd4abd6097608718c50308fe6288f4ffeb8e4784efd9\n+  checksum: e50cbbe7104eecef59faf3355ab981d9f353b19327f0b4607dfd829b4726f9e694b536fe43ab55f50bb00fbfdd2e4268a7e2a568b28d5fcd0d2a32a8d2466218\n   languageName: node\n   linkType: hard\n \n-\"@typescript-eslint/parser@npm:~5.55.0\":\n-  version: 5.55.0\n-  resolution: \"@typescript-eslint/parser@npm:5.55.0\"\n+\"@typescript-eslint/parser@npm:~6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/parser@npm:6.13.2\"\n   dependencies:\n-    \"@typescript-eslint/scope-manager\": 5.55.0\n-    \"@typescript-eslint/types\": 5.55.0\n-    \"@typescript-eslint/typescript-estree\": 5.55.0\n+    \"@typescript-eslint/scope-manager\": 6.13.2\n+    \"@typescript-eslint/types\": 6.13.2\n+    \"@typescript-eslint/typescript-estree\": 6.13.2\n+    \"@typescript-eslint/visitor-keys\": 6.13.2\n     debug: ^4.3.4\n   peerDependencies:\n-    eslint: ^6.0.0 || ^7.0.0 || ^8.0.0\n+    eslint: ^7.0.0 || ^8.0.0\n   peerDependenciesMeta:\n     typescript:\n       optional: true\n-  checksum: 48a20dc7e67960b5168b77bfb9d11d053a21d57bb83cf7b59f750191cbca5eea3b4636a8e6e75cc0aca5a84cdef91fed5440934fc2935f8c6fa71630a253a50c\n+  checksum: aeafc414d295d7855384f10d57abb4f5f2ff35b57991b5c8854f43268761b3cc995e62af585dea1dc48295d762f466b565b5ae5699bfe642585d3f83ba8e1515\n   languageName: node\n   linkType: hard\n \n@@ -7353,20 +7362,30 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@typescript-eslint/type-utils@npm:5.55.0\":\n-  version: 5.55.0\n-  resolution: \"@typescript-eslint/type-utils@npm:5.55.0\"\n+\"@typescript-eslint/scope-manager@npm:6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/scope-manager@npm:6.13.2\"\n   dependencies:\n-    \"@typescript-eslint/typescript-estree\": 5.55.0\n-    \"@typescript-eslint/utils\": 5.55.0\n+    \"@typescript-eslint/types\": 6.13.2\n+    \"@typescript-eslint/visitor-keys\": 6.13.2\n+  checksum: ff8fd64ddf324e296e2e0e34a8f73149c9a5f14d1761ea8e8665fc5998faa2b0bbbd1a5d416aa10d725f13c804032d532f68e39a0ca6cc36d1c9b9c0aea94311\n+  languageName: node\n+  linkType: hard\n+\n+\"@typescript-eslint/type-utils@npm:6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/type-utils@npm:6.13.2\"\n+  dependencies:\n+    \"@typescript-eslint/typescript-estree\": 6.13.2\n+    \"@typescript-eslint/utils\": 6.13.2\n     debug: ^4.3.4\n-    tsutils: ^3.21.0\n+    ts-api-utils: ^1.0.1\n   peerDependencies:\n-    eslint: \"*\"\n+    eslint: ^7.0.0 || ^8.0.0\n   peerDependenciesMeta:\n     typescript:\n       optional: true\n-  checksum: 5c60d441355b51f96b596324068c10605c74abb46748c0bbc6d8f7f2ea40acb6b4bda3b537105fa189172324c56d18bd88e7102e67f99f8c03bc05c6d0e2023d\n+  checksum: ba54e5746139f778c35e4058e523ec8c20b68cf6472b3a7784170328e48c228f0761d2fc7e43dab053ca7d85ac4378b6965567774e6afedf551e600638404215\n   languageName: node\n   linkType: hard\n \n@@ -7377,6 +7396,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@typescript-eslint/types@npm:6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/types@npm:6.13.2\"\n+  checksum: 4493ff06fa07c68c5adbcbd842f6dd6f5c88f14d160b53c3379b6b703e6f62808fab7fdebcc06ff06a56f20ab432b6ceeb0afb8931dc97d4061cb417e787f2c1\n+  languageName: node\n+  linkType: hard\n+\n \"@typescript-eslint/typescript-estree@npm:5.55.0\":\n   version: 5.55.0\n   resolution: \"@typescript-eslint/typescript-estree@npm:5.55.0\"\n@@ -7395,7 +7421,42 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@typescript-eslint/utils@npm:5.55.0, @typescript-eslint/utils@npm:^5.10.0\":\n+\"@typescript-eslint/typescript-estree@npm:6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/typescript-estree@npm:6.13.2\"\n+  dependencies:\n+    \"@typescript-eslint/types\": 6.13.2\n+    \"@typescript-eslint/visitor-keys\": 6.13.2\n+    debug: ^4.3.4\n+    globby: ^11.1.0\n+    is-glob: ^4.0.3\n+    semver: ^7.5.4\n+    ts-api-utils: ^1.0.1\n+  peerDependenciesMeta:\n+    typescript:\n+      optional: true\n+  checksum: 0c18ee5ef594a2411a788fe9d7bc6d51a03bce38d9d764bcb24ab557e5bc1942c2ddf9bd6fb4877eb102b0ae488974fb7b7fe72daa70a2054bf04d3cc6803546\n+  languageName: node\n+  linkType: hard\n+\n+\"@typescript-eslint/utils@npm:6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/utils@npm:6.13.2\"\n+  dependencies:\n+    \"@eslint-community/eslint-utils\": ^4.4.0\n+    \"@types/json-schema\": ^7.0.12\n+    \"@types/semver\": ^7.5.0\n+    \"@typescript-eslint/scope-manager\": 6.13.2\n+    \"@typescript-eslint/types\": 6.13.2\n+    \"@typescript-eslint/typescript-estree\": 6.13.2\n+    semver: ^7.5.4\n+  peerDependencies:\n+    eslint: ^7.0.0 || ^8.0.0\n+  checksum: b66bcf2a945e9c55f3dccb48af49565863d974837ee23b2f01ce7f3fb2462eb8a5871784d4a2fcc80dac7d5cd4ed90c8d01431cd177c0249de89a448f6663fc8\n+  languageName: node\n+  linkType: hard\n+\n+\"@typescript-eslint/utils@npm:^5.10.0\":\n   version: 5.55.0\n   resolution: \"@typescript-eslint/utils@npm:5.55.0\"\n   dependencies:\n@@ -7423,6 +7484,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@typescript-eslint/visitor-keys@npm:6.13.2\":\n+  version: 6.13.2\n+  resolution: \"@typescript-eslint/visitor-keys@npm:6.13.2\"\n+  dependencies:\n+    \"@typescript-eslint/types\": 6.13.2\n+    eslint-visitor-keys: ^3.4.1\n+  checksum: 4b4def7acd7451e6a18dab3ee13f06504b3d23e51f195fced7c544f2203ee8a83426c82fa57ab6b58725c70fdedaf7a3eccb69793180be35756eed0f2c69fe04\n+  languageName: node\n+  linkType: hard\n+\n+\"@ungap/structured-clone@npm:^1.2.0\":\n+  version: 1.2.0\n+  resolution: \"@ungap/structured-clone@npm:1.2.0\"\n+  checksum: 4f656b7b4672f2ce6e272f2427d8b0824ed11546a601d8d5412b9d7704e83db38a8d9f402ecdf2b9063fc164af842ad0ec4a55819f621ed7e7ea4d1efcc74524\n+  languageName: node\n+  linkType: hard\n+\n \"@verdaccio/commons-api@npm:10.2.0\":\n   version: 10.2.0\n   resolution: \"@verdaccio/commons-api@npm:10.2.0\"\n@@ -8040,12 +8118,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"acorn@npm:^8.0.4, acorn@npm:^8.1.0, acorn@npm:^8.5.0, acorn@npm:^8.7.1, acorn@npm:^8.8.0, acorn@npm:^8.8.1\":\n-  version: 8.8.2\n-  resolution: \"acorn@npm:8.8.2\"\n+\"acorn@npm:^8.0.4, acorn@npm:^8.1.0, acorn@npm:^8.5.0, acorn@npm:^8.7.1, acorn@npm:^8.8.1, acorn@npm:^8.9.0\":\n+  version: 8.11.2\n+  resolution: \"acorn@npm:8.11.2\"\n   bin:\n     acorn: bin/acorn\n-  checksum: f790b99a1bf63ef160c967e23c46feea7787e531292bb827126334612c234ed489a0dc2c7ba33156416f0ffa8d25bf2b0fdb7f35c2ba60eb3e960572bece4001\n+  checksum: 818450408684da89423e3daae24e4dc9b68692db8ab49ea4569c7c5abb7a3f23669438bf129cc81dfdada95e1c9b944ee1bfca2c57a05a4dc73834a612fbf6a7\n   languageName: node\n   linkType: hard\n \n@@ -8132,7 +8210,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"ajv@npm:^6.10.0, ajv@npm:^6.12.3, ajv@npm:^6.12.4, ajv@npm:^6.12.5\":\n+\"ajv@npm:^6.12.3, ajv@npm:^6.12.4, ajv@npm:^6.12.5\":\n   version: 6.12.6\n   resolution: \"ajv@npm:6.12.6\"\n   dependencies:\n@@ -8296,6 +8374,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"array-buffer-byte-length@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"array-buffer-byte-length@npm:1.0.0\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    is-array-buffer: ^3.0.1\n+  checksum: 044e101ce150f4804ad19c51d6c4d4cfa505c5b2577bd179256e4aa3f3f6a0a5e9874c78cd428ee566ac574c8a04d7ce21af9fe52e844abfdccb82b33035a7c3\n+  languageName: node\n+  linkType: hard\n+\n \"array-differ@npm:^3.0.0\":\n   version: 3.0.0\n   resolution: \"array-differ@npm:3.0.0\"\n@@ -8362,6 +8450,21 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"arraybuffer.prototype.slice@npm:^1.0.2\":\n+  version: 1.0.2\n+  resolution: \"arraybuffer.prototype.slice@npm:1.0.2\"\n+  dependencies:\n+    array-buffer-byte-length: ^1.0.0\n+    call-bind: ^1.0.2\n+    define-properties: ^1.2.0\n+    es-abstract: ^1.22.1\n+    get-intrinsic: ^1.2.1\n+    is-array-buffer: ^3.0.2\n+    is-shared-array-buffer: ^1.0.2\n+  checksum: c200faf437786f5b2c80d4564ff5481c886a16dee642ef02abdc7306c7edd523d1f01d1dd12b769c7eb42ac9bc53874510db19a92a2c035c0f6696172aafa5d3\n+  languageName: node\n+  linkType: hard\n+\n \"arrify@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"arrify@npm:1.0.1\"\n@@ -8413,6 +8516,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"asynciterator.prototype@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"asynciterator.prototype@npm:1.0.0\"\n+  dependencies:\n+    has-symbols: ^1.0.3\n+  checksum: e8ebfd9493ac651cf9b4165e9d64030b3da1d17181bb1963627b59e240cdaf021d9b59d44b827dc1dde4e22387ec04c2d0f8720cf58a1c282e34e40cc12721b3\n+  languageName: node\n+  linkType: hard\n+\n \"asynckit@npm:^0.4.0\":\n   version: 0.4.0\n   resolution: \"asynckit@npm:0.4.0\"\n@@ -8929,13 +9041,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"call-bind@npm:^1.0.0, call-bind@npm:^1.0.2\":\n-  version: 1.0.2\n-  resolution: \"call-bind@npm:1.0.2\"\n+\"call-bind@npm:^1.0.0, call-bind@npm:^1.0.2, call-bind@npm:^1.0.4, call-bind@npm:^1.0.5\":\n+  version: 1.0.5\n+  resolution: \"call-bind@npm:1.0.5\"\n   dependencies:\n-    function-bind: ^1.1.1\n-    get-intrinsic: ^1.0.2\n-  checksum: f8e31de9d19988a4b80f3e704788c4a2d6b6f3d17cfec4f57dc29ced450c53a49270dc66bf0fbd693329ee948dd33e6c90a329519aef17474a4d961e8d6426b0\n+    function-bind: ^1.1.2\n+    get-intrinsic: ^1.2.1\n+    set-function-length: ^1.1.1\n+  checksum: 449e83ecbd4ba48e7eaac5af26fea3b50f8f6072202c2dd7c5a6e7a6308f2421abe5e13a3bbd55221087f76320c5e09f25a8fdad1bab2b77c68ae74d92234ea5\n   languageName: node\n   linkType: hard\n \n@@ -10566,6 +10679,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.1\":\n+  version: 1.1.1\n+  resolution: \"define-data-property@npm:1.1.1\"\n+  dependencies:\n+    get-intrinsic: ^1.2.1\n+    gopd: ^1.0.1\n+    has-property-descriptors: ^1.0.0\n+  checksum: a29855ad3f0630ea82e3c5012c812efa6ca3078d5c2aa8df06b5f597c1cde6f7254692df41945851d903e05a1668607b6d34e778f402b9ff9ffb38111f1a3f0d\n+  languageName: node\n+  linkType: hard\n+\n \"define-lazy-prop@npm:^2.0.0\":\n   version: 2.0.0\n   resolution: \"define-lazy-prop@npm:2.0.0\"\n@@ -10580,13 +10704,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-properties@npm:^1.1.3, define-properties@npm:^1.1.4\":\n-  version: 1.2.0\n-  resolution: \"define-properties@npm:1.2.0\"\n+\"define-properties@npm:^1.1.3, define-properties@npm:^1.1.4, define-properties@npm:^1.2.0, define-properties@npm:^1.2.1\":\n+  version: 1.2.1\n+  resolution: \"define-properties@npm:1.2.1\"\n   dependencies:\n+    define-data-property: ^1.0.1\n     has-property-descriptors: ^1.0.0\n     object-keys: ^1.1.1\n-  checksum: e60aee6a19b102df4e2b1f301816804e81ab48bb91f00d0d935f269bf4b3f79c88b39e4f89eaa132890d23267335fd1140dfcd8d5ccd61031a0a2c41a54e33a6\n+  checksum: b4ccd00597dd46cb2d4a379398f5b19fca84a16f3374e2249201992f36b30f6835949a9429669ee6b41b6e837205a163eadd745e472069e70dfc10f03e5fcc12\n   languageName: node\n   linkType: hard\n \n@@ -11062,44 +11187,72 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"es-abstract@npm:^1.19.0, es-abstract@npm:^1.20.4\":\n-  version: 1.21.1\n-  resolution: \"es-abstract@npm:1.21.1\"\n+\"es-abstract@npm:^1.20.4, es-abstract@npm:^1.22.1\":\n+  version: 1.22.3\n+  resolution: \"es-abstract@npm:1.22.3\"\n   dependencies:\n+    array-buffer-byte-length: ^1.0.0\n+    arraybuffer.prototype.slice: ^1.0.2\n     available-typed-arrays: ^1.0.5\n-    call-bind: ^1.0.2\n+    call-bind: ^1.0.5\n     es-set-tostringtag: ^2.0.1\n     es-to-primitive: ^1.2.1\n-    function-bind: ^1.1.1\n-    function.prototype.name: ^1.1.5\n-    get-intrinsic: ^1.1.3\n+    function.prototype.name: ^1.1.6\n+    get-intrinsic: ^1.2.2\n     get-symbol-description: ^1.0.0\n     globalthis: ^1.0.3\n     gopd: ^1.0.1\n-    has: ^1.0.3\n     has-property-descriptors: ^1.0.0\n     has-proto: ^1.0.1\n     has-symbols: ^1.0.3\n-    internal-slot: ^1.0.4\n-    is-array-buffer: ^3.0.1\n+    hasown: ^2.0.0\n+    internal-slot: ^1.0.5\n+    is-array-buffer: ^3.0.2\n     is-callable: ^1.2.7\n     is-negative-zero: ^2.0.2\n     is-regex: ^1.1.4\n     is-shared-array-buffer: ^1.0.2\n     is-string: ^1.0.7\n-    is-typed-array: ^1.1.10\n+    is-typed-array: ^1.1.12\n     is-weakref: ^1.0.2\n-    object-inspect: ^1.12.2\n+    object-inspect: ^1.13.1\n     object-keys: ^1.1.1\n     object.assign: ^4.1.4\n-    regexp.prototype.flags: ^1.4.3\n+    regexp.prototype.flags: ^1.5.1\n+    safe-array-concat: ^1.0.1\n     safe-regex-test: ^1.0.0\n-    string.prototype.trimend: ^1.0.6\n-    string.prototype.trimstart: ^1.0.6\n+    string.prototype.trim: ^1.2.8\n+    string.prototype.trimend: ^1.0.7\n+    string.prototype.trimstart: ^1.0.7\n+    typed-array-buffer: ^1.0.0\n+    typed-array-byte-length: ^1.0.0\n+    typed-array-byte-offset: ^1.0.0\n     typed-array-length: ^1.0.4\n     unbox-primitive: ^1.0.2\n-    which-typed-array: ^1.1.9\n-  checksum: 23ff60d42d17a55d150e7bcedbdb065d4077a8b98c436e0e2e1ef4dd532a6d78a56028673de0bd8ed464a43c46ba781c50d9af429b6a17e44dbd14c7d7fb7926\n+    which-typed-array: ^1.1.13\n+  checksum: b1bdc962856836f6e72be10b58dc128282bdf33771c7a38ae90419d920fc3b36cc5d2b70a222ad8016e3fc322c367bf4e9e89fc2bc79b7e933c05b218e83d79a\n+  languageName: node\n+  linkType: hard\n+\n+\"es-iterator-helpers@npm:^1.0.12\":\n+  version: 1.0.15\n+  resolution: \"es-iterator-helpers@npm:1.0.15\"\n+  dependencies:\n+    asynciterator.prototype: ^1.0.0\n+    call-bind: ^1.0.2\n+    define-properties: ^1.2.1\n+    es-abstract: ^1.22.1\n+    es-set-tostringtag: ^2.0.1\n+    function-bind: ^1.1.1\n+    get-intrinsic: ^1.2.1\n+    globalthis: ^1.0.3\n+    has-property-descriptors: ^1.0.0\n+    has-proto: ^1.0.1\n+    has-symbols: ^1.0.3\n+    internal-slot: ^1.0.5\n+    iterator.prototype: ^1.1.2\n+    safe-array-concat: ^1.0.1\n+  checksum: 50081ae5c549efe62e5c1d244df0194b40b075f7897fc2116b7e1aa437eb3c41f946d2afda18c33f9b31266ec544765932542765af839f76fa6d7b7855d1e0e1\n   languageName: node\n   linkType: hard\n \n@@ -11246,37 +11399,38 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"eslint-config-prettier@npm:~8.7.0\":\n-  version: 8.7.0\n-  resolution: \"eslint-config-prettier@npm:8.7.0\"\n+\"eslint-config-prettier@npm:~9.1.0\":\n+  version: 9.1.0\n+  resolution: \"eslint-config-prettier@npm:9.1.0\"\n   peerDependencies:\n     eslint: \">=7.0.0\"\n   bin:\n     eslint-config-prettier: bin/cli.js\n-  checksum: b05bc7f2296ce3e0925c14147849706544870e0382d38af2352d709a6cf8521bdaff2bd8e5021f1780e570775a8ffa1d2bac28b8065d90d43a3f1f98fd26ce52\n+  checksum: 9229b768c879f500ee54ca05925f31b0c0bafff3d9f5521f98ff05127356de78c81deb9365c86a5ec4efa990cb72b74df8612ae15965b14136044c73e1f6a907\n   languageName: node\n   linkType: hard\n \n-\"eslint-plugin-jest@npm:~27.2.1\":\n-  version: 27.2.1\n-  resolution: \"eslint-plugin-jest@npm:27.2.1\"\n+\"eslint-plugin-jest@npm:~27.6.0\":\n+  version: 27.6.0\n+  resolution: \"eslint-plugin-jest@npm:27.6.0\"\n   dependencies:\n     \"@typescript-eslint/utils\": ^5.10.0\n   peerDependencies:\n-    \"@typescript-eslint/eslint-plugin\": ^5.0.0\n+    \"@typescript-eslint/eslint-plugin\": ^5.0.0 || ^6.0.0\n     eslint: ^7.0.0 || ^8.0.0\n+    jest: \"*\"\n   peerDependenciesMeta:\n     \"@typescript-eslint/eslint-plugin\":\n       optional: true\n     jest:\n       optional: true\n-  checksum: 579a4d26304cc6748b2e6dff6c965ea7a21b618d8b051eb02727d25cf5c7767f6db8ef5237531635ff77e242b983b973e7cb8c820a4d20d5bda73358c452a8ab\n+  checksum: 4c42641f9bf2d597761637028083e20b9f81762308e98baae40eb805d3e81ff8d837f06f4f0c1a2fd249e2be2fb24d33b7aafeaa8942de805c2b8d7c3b6fc4e4\n   languageName: node\n   linkType: hard\n \n-\"eslint-plugin-prettier@npm:~5.0.0\":\n-  version: 5.0.0\n-  resolution: \"eslint-plugin-prettier@npm:5.0.0\"\n+\"eslint-plugin-prettier@npm:~5.0.1\":\n+  version: 5.0.1\n+  resolution: \"eslint-plugin-prettier@npm:5.0.1\"\n   dependencies:\n     prettier-linter-helpers: ^1.0.0\n     synckit: ^0.8.5\n@@ -11289,18 +11443,19 @@ __metadata:\n       optional: true\n     eslint-config-prettier:\n       optional: true\n-  checksum: 84e88744b9050f2d5ef31b94e85294dda16f3a53c2449f9d33eac8ae6264889b459bf35a68e438fb6b329c2a1d6491aac4bfa00d86317e7009de3dad0311bec6\n+  checksum: c2261033b97bafe99ccb7cc47c2fac6fa85b8bbc8b128042e52631f906b69e12afed2cdd9d7e3021cc892ee8dd4204a3574e1f32a0b718b4bb3b440944b6983b\n   languageName: node\n   linkType: hard\n \n-\"eslint-plugin-react@npm:~7.32.2\":\n-  version: 7.32.2\n-  resolution: \"eslint-plugin-react@npm:7.32.2\"\n+\"eslint-plugin-react@npm:~7.33.2\":\n+  version: 7.33.2\n+  resolution: \"eslint-plugin-react@npm:7.33.2\"\n   dependencies:\n     array-includes: ^3.1.6\n     array.prototype.flatmap: ^1.3.1\n     array.prototype.tosorted: ^1.1.1\n     doctrine: ^2.1.0\n+    es-iterator-helpers: ^1.0.12\n     estraverse: ^5.3.0\n     jsx-ast-utils: ^2.4.1 || ^3.0.0\n     minimatch: ^3.1.2\n@@ -11310,11 +11465,11 @@ __metadata:\n     object.values: ^1.1.6\n     prop-types: ^15.8.1\n     resolve: ^2.0.0-next.4\n-    semver: ^6.3.0\n+    semver: ^6.3.1\n     string.prototype.matchall: ^4.0.8\n   peerDependencies:\n     eslint: ^3 || ^4 || ^5 || ^6 || ^7 || ^8\n-  checksum: 2232b3b8945aa50b7773919c15cd96892acf35d2f82503667a79e2f55def90f728ed4f0e496f0f157acbe1bd4397c5615b676ae7428fe84488a544ca53feb944\n+  checksum: b4c3d76390b0ae6b6f9fed78170604cc2c04b48e6778a637db339e8e3911ec9ef22510b0ae77c429698151d0f1b245f282177f384105b6830e7b29b9c9b26610\n   languageName: node\n   linkType: hard\n \n@@ -11328,43 +11483,44 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"eslint-scope@npm:^7.1.1\":\n-  version: 7.1.1\n-  resolution: \"eslint-scope@npm:7.1.1\"\n+\"eslint-scope@npm:^7.2.2\":\n+  version: 7.2.2\n+  resolution: \"eslint-scope@npm:7.2.2\"\n   dependencies:\n     esrecurse: ^4.3.0\n     estraverse: ^5.2.0\n-  checksum: 9f6e974ab2db641ca8ab13508c405b7b859e72afe9f254e8131ff154d2f40c99ad4545ce326fd9fde3212ff29707102562a4834f1c48617b35d98c71a97fbf3e\n+  checksum: ec97dbf5fb04b94e8f4c5a91a7f0a6dd3c55e46bfc7bbcd0e3138c3a76977570e02ed89a1810c778dcd72072ff0e9621ba1379b4babe53921d71e2e4486fda3e\n   languageName: node\n   linkType: hard\n \n-\"eslint-visitor-keys@npm:^3.3.0\":\n-  version: 3.3.0\n-  resolution: \"eslint-visitor-keys@npm:3.3.0\"\n-  checksum: d59e68a7c5a6d0146526b0eec16ce87fbf97fe46b8281e0d41384224375c4e52f5ffb9e16d48f4ea50785cde93f766b0c898e31ab89978d88b0e1720fbfb7808\n+\"eslint-visitor-keys@npm:^3.3.0, eslint-visitor-keys@npm:^3.4.1, eslint-visitor-keys@npm:^3.4.3\":\n+  version: 3.4.3\n+  resolution: \"eslint-visitor-keys@npm:3.4.3\"\n+  checksum: 36e9ef87fca698b6fd7ca5ca35d7b2b6eeaaf106572e2f7fd31c12d3bfdaccdb587bba6d3621067e5aece31c8c3a348b93922ab8f7b2cbc6aaab5e1d89040c60\n   languageName: node\n   linkType: hard\n \n-\"eslint@npm:~8.36.0\":\n-  version: 8.36.0\n-  resolution: \"eslint@npm:8.36.0\"\n+\"eslint@npm:~8.55.0\":\n+  version: 8.55.0\n+  resolution: \"eslint@npm:8.55.0\"\n   dependencies:\n     \"@eslint-community/eslint-utils\": ^4.2.0\n-    \"@eslint-community/regexpp\": ^4.4.0\n-    \"@eslint/eslintrc\": ^2.0.1\n-    \"@eslint/js\": 8.36.0\n-    \"@humanwhocodes/config-array\": ^0.11.8\n+    \"@eslint-community/regexpp\": ^4.6.1\n+    \"@eslint/eslintrc\": ^2.1.4\n+    \"@eslint/js\": 8.55.0\n+    \"@humanwhocodes/config-array\": ^0.11.13\n     \"@humanwhocodes/module-importer\": ^1.0.1\n     \"@nodelib/fs.walk\": ^1.2.8\n-    ajv: ^6.10.0\n+    \"@ungap/structured-clone\": ^1.2.0\n+    ajv: ^6.12.4\n     chalk: ^4.0.0\n     cross-spawn: ^7.0.2\n     debug: ^4.3.2\n     doctrine: ^3.0.0\n     escape-string-regexp: ^4.0.0\n-    eslint-scope: ^7.1.1\n-    eslint-visitor-keys: ^3.3.0\n-    espree: ^9.5.0\n+    eslint-scope: ^7.2.2\n+    eslint-visitor-keys: ^3.4.3\n+    espree: ^9.6.1\n     esquery: ^1.4.2\n     esutils: ^2.0.2\n     fast-deep-equal: ^3.1.3\n@@ -11372,26 +11528,23 @@ __metadata:\n     find-up: ^5.0.0\n     glob-parent: ^6.0.2\n     globals: ^13.19.0\n-    grapheme-splitter: ^1.0.4\n+    graphemer: ^1.4.0\n     ignore: ^5.2.0\n-    import-fresh: ^3.0.0\n     imurmurhash: ^0.1.4\n     is-glob: ^4.0.0\n     is-path-inside: ^3.0.3\n-    js-sdsl: ^4.1.4\n     js-yaml: ^4.1.0\n     json-stable-stringify-without-jsonify: ^1.0.1\n     levn: ^0.4.1\n     lodash.merge: ^4.6.2\n     minimatch: ^3.1.2\n     natural-compare: ^1.4.0\n-    optionator: ^0.9.1\n+    optionator: ^0.9.3\n     strip-ansi: ^6.0.1\n-    strip-json-comments: ^3.1.0\n     text-table: ^0.2.0\n   bin:\n     eslint: bin/eslint.js\n-  checksum: e9a961fc3b3de5cff5a1cb2c92eeffaa7e155a715489e30b3e1e76f186bd1255e0481e09564f2094733c0b1dbd3453499fb72ae7c043c83156e11e6d965b2304\n+  checksum: 83f82a604559dc1faae79d28fdf3dfc9e592ca221052e2ea516e1b379b37e77e4597705a16880e2f5ece4f79087c1dd13fd7f6e9746f794a401175519db18b41\n   languageName: node\n   linkType: hard\n \n@@ -11402,14 +11555,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"espree@npm:^9.5.0\":\n-  version: 9.5.0\n-  resolution: \"espree@npm:9.5.0\"\n+\"espree@npm:^9.6.0, espree@npm:^9.6.1\":\n+  version: 9.6.1\n+  resolution: \"espree@npm:9.6.1\"\n   dependencies:\n-    acorn: ^8.8.0\n+    acorn: ^8.9.0\n     acorn-jsx: ^5.3.2\n-    eslint-visitor-keys: ^3.3.0\n-  checksum: a7f110aefb6407e0d3237aa635ab3cea87106ae63748dd23c67031afccc640d04c4209fca2daf16e2233c82efb505faead0fb84097478fd9cc6e8f8dd80bf99d\n+    eslint-visitor-keys: ^3.4.1\n+  checksum: eb8c149c7a2a77b3f33a5af80c10875c3abd65450f60b8af6db1bfcfa8f101e21c1e56a561c6dc13b848e18148d43469e7cd208506238554fb5395a9ea5a1ab9\n   languageName: node\n   linkType: hard\n \n@@ -12034,26 +12187,26 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"function-bind@npm:^1.1.1\":\n-  version: 1.1.1\n-  resolution: \"function-bind@npm:1.1.1\"\n-  checksum: b32fbaebb3f8ec4969f033073b43f5c8befbb58f1a79e12f1d7490358150359ebd92f49e72ff0144f65f2c48ea2a605bff2d07965f548f6474fd8efd95bf361a\n+\"function-bind@npm:^1.1.1, function-bind@npm:^1.1.2\":\n+  version: 1.1.2\n+  resolution: \"function-bind@npm:1.1.2\"\n+  checksum: 2b0ff4ce708d99715ad14a6d1f894e2a83242e4a52ccfcefaee5e40050562e5f6dafc1adbb4ce2d4ab47279a45dc736ab91ea5042d843c3c092820dfe032efb1\n   languageName: node\n   linkType: hard\n \n-\"function.prototype.name@npm:^1.1.5\":\n-  version: 1.1.5\n-  resolution: \"function.prototype.name@npm:1.1.5\"\n+\"function.prototype.name@npm:^1.1.5, function.prototype.name@npm:^1.1.6\":\n+  version: 1.1.6\n+  resolution: \"function.prototype.name@npm:1.1.6\"\n   dependencies:\n     call-bind: ^1.0.2\n-    define-properties: ^1.1.3\n-    es-abstract: ^1.19.0\n-    functions-have-names: ^1.2.2\n-  checksum: acd21d733a9b649c2c442f067567743214af5fa248dbeee69d8278ce7df3329ea5abac572be9f7470b4ec1cd4d8f1040e3c5caccf98ebf2bf861a0deab735c27\n+    define-properties: ^1.2.0\n+    es-abstract: ^1.22.1\n+    functions-have-names: ^1.2.3\n+  checksum: 7a3f9bd98adab09a07f6e1f03da03d3f7c26abbdeaeee15223f6c04a9fb5674792bdf5e689dac19b97ac71de6aad2027ba3048a9b883aa1b3173eed6ab07f479\n   languageName: node\n   linkType: hard\n \n-\"functions-have-names@npm:^1.2.2\":\n+\"functions-have-names@npm:^1.2.3\":\n   version: 1.2.3\n   resolution: \"functions-have-names@npm:1.2.3\"\n   checksum: c3f1f5ba20f4e962efb71344ce0a40722163e85bee2101ce25f88214e78182d2d2476aa85ef37950c579eb6cf6ee811c17b3101bb84004bb75655f3e33f3fdb5\n@@ -12107,14 +12260,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"get-intrinsic@npm:^1.0.2, get-intrinsic@npm:^1.1.1, get-intrinsic@npm:^1.1.3, get-intrinsic@npm:^1.2.0\":\n-  version: 1.2.0\n-  resolution: \"get-intrinsic@npm:1.2.0\"\n+\"get-intrinsic@npm:^1.0.2, get-intrinsic@npm:^1.1.1, get-intrinsic@npm:^1.1.3, get-intrinsic@npm:^1.2.0, get-intrinsic@npm:^1.2.1, get-intrinsic@npm:^1.2.2\":\n+  version: 1.2.2\n+  resolution: \"get-intrinsic@npm:1.2.2\"\n   dependencies:\n-    function-bind: ^1.1.1\n-    has: ^1.0.3\n+    function-bind: ^1.1.2\n+    has-proto: ^1.0.1\n     has-symbols: ^1.0.3\n-  checksum: 78fc0487b783f5c58cf2dccafc3ae656ee8d2d8062a8831ce4a95e7057af4587a1d4882246c033aca0a7b4965276f4802b45cc300338d1b77a73d3e3e3f4877d\n+    hasown: ^2.0.0\n+  checksum: 447ff0724df26829908dc033b62732359596fcf66027bc131ab37984afb33842d9cd458fd6cecadfe7eac22fd8a54b349799ed334cf2726025c921c7250e7417\n   languageName: node\n   linkType: hard\n \n@@ -12508,6 +12662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"graphemer@npm:^1.4.0\":\n+  version: 1.4.0\n+  resolution: \"graphemer@npm:1.4.0\"\n+  checksum: bab8f0be9b568857c7bec9fda95a89f87b783546d02951c40c33f84d05bb7da3fd10f863a9beb901463669b6583173a8c8cc6d6b306ea2b9b9d5d3d943c3a673\n+  languageName: node\n+  linkType: hard\n+\n \"gzip-size@npm:^6.0.0\":\n   version: 6.0.0\n   resolution: \"gzip-size@npm:6.0.0\"\n@@ -12635,6 +12796,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"hasown@npm:^2.0.0\":\n+  version: 2.0.0\n+  resolution: \"hasown@npm:2.0.0\"\n+  dependencies:\n+    function-bind: ^1.1.2\n+  checksum: 6151c75ca12554565098641c98a40f4cc86b85b0fd5b6fe92360967e4605a4f9610f7757260b4e8098dd1c2ce7f4b095f2006fe72a570e3b6d2d28de0298c176\n+  languageName: node\n+  linkType: hard\n+\n \"he@npm:^1.2.0\":\n   version: 1.2.0\n   resolution: \"he@npm:1.2.0\"\n@@ -12974,7 +13144,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"import-fresh@npm:^3.0.0, import-fresh@npm:^3.2.1\":\n+\"import-fresh@npm:^3.2.1\":\n   version: 3.3.0\n   resolution: \"import-fresh@npm:3.3.0\"\n   dependencies:\n@@ -13123,14 +13293,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"internal-slot@npm:^1.0.3, internal-slot@npm:^1.0.4\":\n-  version: 1.0.5\n-  resolution: \"internal-slot@npm:1.0.5\"\n+\"internal-slot@npm:^1.0.3, internal-slot@npm:^1.0.5\":\n+  version: 1.0.6\n+  resolution: \"internal-slot@npm:1.0.6\"\n   dependencies:\n-    get-intrinsic: ^1.2.0\n-    has: ^1.0.3\n+    get-intrinsic: ^1.2.2\n+    hasown: ^2.0.0\n     side-channel: ^1.0.4\n-  checksum: 97e84046bf9e7574d0956bd98d7162313ce7057883b6db6c5c7b5e5f05688864b0978ba07610c726d15d66544ffe4b1050107d93f8a39ebc59b15d8b429b497a\n+  checksum: 7872454888047553ce97a3fa1da7cc054a28ec5400a9c2e9f4dbe4fe7c1d041cb8e8301467614b80d4246d50377aad2fb58860b294ed74d6700cc346b6f89549\n   languageName: node\n   linkType: hard\n \n@@ -13162,7 +13332,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-array-buffer@npm:^3.0.1\":\n+\"is-array-buffer@npm:^3.0.1, is-array-buffer@npm:^3.0.2\":\n   version: 3.0.2\n   resolution: \"is-array-buffer@npm:3.0.2\"\n   dependencies:\n@@ -13187,6 +13357,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-async-function@npm:^2.0.0\":\n+  version: 2.0.0\n+  resolution: \"is-async-function@npm:2.0.0\"\n+  dependencies:\n+    has-tostringtag: ^1.0.0\n+  checksum: e3471d95e6c014bf37cad8a93f2f4b6aac962178e0a5041e8903147166964fdc1c5c1d2ef87e86d77322c370ca18f2ea004fa7420581fa747bcaf7c223069dbd\n+  languageName: node\n+  linkType: hard\n+\n \"is-bigint@npm:^1.0.1\":\n   version: 1.0.4\n   resolution: \"is-bigint@npm:1.0.4\"\n@@ -13242,7 +13421,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-date-object@npm:^1.0.1\":\n+\"is-date-object@npm:^1.0.1, is-date-object@npm:^1.0.5\":\n   version: 1.0.5\n   resolution: \"is-date-object@npm:1.0.5\"\n   dependencies:\n@@ -13276,6 +13455,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-finalizationregistry@npm:^1.0.2\":\n+  version: 1.0.2\n+  resolution: \"is-finalizationregistry@npm:1.0.2\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+  checksum: 4f243a8e06228cd45bdab8608d2cb7abfc20f6f0189c8ac21ea8d603f1f196eabd531ce0bb8e08cbab047e9845ef2c191a3761c9a17ad5cabf8b35499c4ad35d\n+  languageName: node\n+  linkType: hard\n+\n \"is-fullwidth-code-point@npm:^3.0.0\":\n   version: 3.0.0\n   resolution: \"is-fullwidth-code-point@npm:3.0.0\"\n@@ -13290,6 +13478,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-generator-function@npm:^1.0.10\":\n+  version: 1.0.10\n+  resolution: \"is-generator-function@npm:1.0.10\"\n+  dependencies:\n+    has-tostringtag: ^1.0.0\n+  checksum: d54644e7dbaccef15ceb1e5d91d680eb5068c9ee9f9eb0a9e04173eb5542c9b51b5ab52c5537f5703e48d5fddfd376817c1ca07a84a407b7115b769d4bdde72b\n+  languageName: node\n+  linkType: hard\n+\n \"is-glob@npm:^4.0.0, is-glob@npm:^4.0.1, is-glob@npm:^4.0.3, is-glob@npm:~4.0.1\":\n   version: 4.0.3\n   resolution: \"is-glob@npm:4.0.3\"\n@@ -13331,6 +13528,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-map@npm:^2.0.1\":\n+  version: 2.0.2\n+  resolution: \"is-map@npm:2.0.2\"\n+  checksum: ace3d0ecd667bbdefdb1852de601268f67f2db725624b1958f279316e13fecb8fa7df91fd60f690d7417b4ec180712f5a7ee967008e27c65cfd475cc84337728\n+  languageName: node\n+  linkType: hard\n+\n \"is-negative-zero@npm:^2.0.2\":\n   version: 2.0.2\n   resolution: \"is-negative-zero@npm:2.0.2\"\n@@ -13422,6 +13626,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-set@npm:^2.0.1\":\n+  version: 2.0.2\n+  resolution: \"is-set@npm:2.0.2\"\n+  checksum: b64343faf45e9387b97a6fd32be632ee7b269bd8183701f3b3f5b71a7cf00d04450ed8669d0bd08753e08b968beda96fca73a10fd0ff56a32603f64deba55a57\n+  languageName: node\n+  linkType: hard\n+\n \"is-shared-array-buffer@npm:^1.0.2\":\n   version: 1.0.2\n   resolution: \"is-shared-array-buffer@npm:1.0.2\"\n@@ -13481,16 +13692,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-typed-array@npm:^1.1.10, is-typed-array@npm:^1.1.9\":\n-  version: 1.1.10\n-  resolution: \"is-typed-array@npm:1.1.10\"\n+\"is-typed-array@npm:^1.1.10, is-typed-array@npm:^1.1.12, is-typed-array@npm:^1.1.9\":\n+  version: 1.1.12\n+  resolution: \"is-typed-array@npm:1.1.12\"\n   dependencies:\n-    available-typed-arrays: ^1.0.5\n-    call-bind: ^1.0.2\n-    for-each: ^0.3.3\n-    gopd: ^1.0.1\n-    has-tostringtag: ^1.0.0\n-  checksum: aac6ecb59d4c56a1cdeb69b1f129154ef462bbffe434cb8a8235ca89b42f258b7ae94073c41b3cb7bce37f6a1733ad4499f07882d5d5093a7ba84dfc4ebb8017\n+    which-typed-array: ^1.1.11\n+  checksum: 4c89c4a3be07186caddadf92197b17fda663a9d259ea0d44a85f171558270d36059d1c386d34a12cba22dfade5aba497ce22778e866adc9406098c8fc4771796\n   languageName: node\n   linkType: hard\n \n@@ -13515,6 +13722,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-weakmap@npm:^2.0.1\":\n+  version: 2.0.1\n+  resolution: \"is-weakmap@npm:2.0.1\"\n+  checksum: 1222bb7e90c32bdb949226e66d26cb7bce12e1e28e3e1b40bfa6b390ba3e08192a8664a703dff2a00a84825f4e022f9cd58c4599ff9981ab72b1d69479f4f7f6\n+  languageName: node\n+  linkType: hard\n+\n \"is-weakref@npm:^1.0.2\":\n   version: 1.0.2\n   resolution: \"is-weakref@npm:1.0.2\"\n@@ -13524,6 +13738,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-weakset@npm:^2.0.1\":\n+  version: 2.0.2\n+  resolution: \"is-weakset@npm:2.0.2\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    get-intrinsic: ^1.1.1\n+  checksum: 5d8698d1fa599a0635d7ca85be9c26d547b317ed8fd83fc75f03efbe75d50001b5eececb1e9971de85fcde84f69ae6f8346bc92d20d55d46201d328e4c74a367\n+  languageName: node\n+  linkType: hard\n+\n \"is-wsl@npm:^2.2.0\":\n   version: 2.2.0\n   resolution: \"is-wsl@npm:2.2.0\"\n@@ -13540,6 +13764,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"isarray@npm:^2.0.5\":\n+  version: 2.0.5\n+  resolution: \"isarray@npm:2.0.5\"\n+  checksum: bd5bbe4104438c4196ba58a54650116007fa0262eccef13a4c55b2e09a5b36b59f1e75b9fcc49883dd9d4953892e6fc007eef9e9155648ceea036e184b0f930a\n+  languageName: node\n+  linkType: hard\n+\n \"isarray@npm:~1.0.0\":\n   version: 1.0.0\n   resolution: \"isarray@npm:1.0.0\"\n@@ -13627,6 +13858,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"iterator.prototype@npm:^1.1.2\":\n+  version: 1.1.2\n+  resolution: \"iterator.prototype@npm:1.1.2\"\n+  dependencies:\n+    define-properties: ^1.2.1\n+    get-intrinsic: ^1.2.1\n+    has-symbols: ^1.0.3\n+    reflect.getprototypeof: ^1.0.4\n+    set-function-name: ^2.0.1\n+  checksum: d8a507e2ccdc2ce762e8a1d3f4438c5669160ac72b88b648e59a688eec6bc4e64b22338e74000518418d9e693faf2a092d2af21b9ec7dbf7763b037a54701168\n+  languageName: node\n+  linkType: hard\n+\n \"jackspeak@npm:^2.3.5\":\n   version: 2.3.6\n   resolution: \"jackspeak@npm:2.3.6\"\n@@ -14140,13 +14384,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"js-sdsl@npm:^4.1.4\":\n-  version: 4.3.0\n-  resolution: \"js-sdsl@npm:4.3.0\"\n-  checksum: ce908257cf6909e213af580af3a691a736f5ee8b16315454768f917a682a4ea0c11bde1b241bbfaecedc0eb67b72101b2c2df2ffaed32aed5d539fca816f054e\n-  languageName: node\n-  linkType: hard\n-\n \"js-tokens@npm:^3.0.0 || ^4.0.0, js-tokens@npm:^4.0.0\":\n   version: 4.0.0\n   resolution: \"js-tokens@npm:4.0.0\"\n@@ -16002,13 +16239,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"natural-compare-lite@npm:^1.4.0\":\n-  version: 1.4.0\n-  resolution: \"natural-compare-lite@npm:1.4.0\"\n-  checksum: 5222ac3986a2b78dd6069ac62cbb52a7bf8ffc90d972ab76dfe7b01892485d229530ed20d0c62e79a6b363a663b273db3bde195a1358ce9e5f779d4453887225\n-  languageName: node\n-  linkType: hard\n-\n \"natural-compare@npm:^1.4.0\":\n   version: 1.4.0\n   resolution: \"natural-compare@npm:1.4.0\"\n@@ -16504,10 +16734,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"object-inspect@npm:^1.12.2, object-inspect@npm:^1.9.0\":\n-  version: 1.12.3\n-  resolution: \"object-inspect@npm:1.12.3\"\n-  checksum: dabfd824d97a5f407e6d5d24810d888859f6be394d8b733a77442b277e0808860555176719c5905e765e3743a7cada6b8b0a3b85e5331c530fd418cc8ae991db\n+\"object-inspect@npm:^1.13.1, object-inspect@npm:^1.9.0\":\n+  version: 1.13.1\n+  resolution: \"object-inspect@npm:1.13.1\"\n+  checksum: 7d9fa9221de3311dcb5c7c307ee5dc011cdd31dc43624b7c184b3840514e118e05ef0002be5388304c416c0eb592feb46e983db12577fc47e47d5752fbbfb61f\n   languageName: node\n   linkType: hard\n \n@@ -16687,17 +16917,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"optionator@npm:^0.9.1\":\n-  version: 0.9.1\n-  resolution: \"optionator@npm:0.9.1\"\n+\"optionator@npm:^0.9.3\":\n+  version: 0.9.3\n+  resolution: \"optionator@npm:0.9.3\"\n   dependencies:\n+    \"@aashutoshrathi/word-wrap\": ^1.2.3\n     deep-is: ^0.1.3\n     fast-levenshtein: ^2.0.6\n     levn: ^0.4.1\n     prelude-ls: ^1.2.1\n     type-check: ^0.4.0\n-    word-wrap: ^1.2.3\n-  checksum: dbc6fa065604b24ea57d734261914e697bd73b69eff7f18e967e8912aa2a40a19a9f599a507fa805be6c13c24c4eae8c71306c239d517d42d4c041c942f508a0\n+  checksum: 09281999441f2fe9c33a5eeab76700795365a061563d66b098923eb719251a42bdbe432790d35064d0816ead9296dbeb1ad51a733edf4167c96bd5d0882e428a\n   languageName: node\n   linkType: hard\n \n@@ -17379,11 +17609,11 @@ __metadata:\n   linkType: hard\n \n \"prettier@npm:~3.0.0\":\n-  version: 3.0.0\n-  resolution: \"prettier@npm:3.0.0\"\n+  version: 3.0.3\n+  resolution: \"prettier@npm:3.0.3\"\n   bin:\n     prettier: bin/prettier.cjs\n-  checksum: 6a832876a1552dc58330d2467874e5a0b46b9ccbfc5d3531eb69d15684743e7f83dc9fbd202db6270446deba9c82b79d24383d09924c462b457136a759425e33\n+  checksum: e10b9af02b281f6c617362ebd2571b1d7fc9fb8a3bd17e371754428cda992e5e8d8b7a046e8f7d3e2da1dcd21aa001e2e3c797402ebb6111b5cd19609dd228e0\n   languageName: node\n   linkType: hard\n \n@@ -17998,6 +18228,20 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"reflect.getprototypeof@npm:^1.0.4\":\n+  version: 1.0.4\n+  resolution: \"reflect.getprototypeof@npm:1.0.4\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    define-properties: ^1.2.0\n+    es-abstract: ^1.22.1\n+    get-intrinsic: ^1.2.1\n+    globalthis: ^1.0.3\n+    which-builtin-type: ^1.1.3\n+  checksum: 16e2361988dbdd23274b53fb2b1b9cefeab876c3941a2543b4cadac6f989e3db3957b07a44aac46cfceb3e06e2871785ec2aac992d824f76292f3b5ee87f66f2\n+  languageName: node\n+  linkType: hard\n+\n \"regenerate-unicode-properties@npm:^10.1.0\":\n   version: 10.1.0\n   resolution: \"regenerate-unicode-properties@npm:10.1.0\"\n@@ -18055,14 +18299,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"regexp.prototype.flags@npm:^1.4.3\":\n-  version: 1.4.3\n-  resolution: \"regexp.prototype.flags@npm:1.4.3\"\n+\"regexp.prototype.flags@npm:^1.4.3, regexp.prototype.flags@npm:^1.5.1\":\n+  version: 1.5.1\n+  resolution: \"regexp.prototype.flags@npm:1.5.1\"\n   dependencies:\n     call-bind: ^1.0.2\n-    define-properties: ^1.1.3\n-    functions-have-names: ^1.2.2\n-  checksum: 51228bae732592adb3ededd5e15426be25f289e9c4ef15212f4da73f4ec3919b6140806374b8894036a86020d054a8d2657d3fee6bb9b4d35d8939c20030b7a6\n+    define-properties: ^1.2.0\n+    set-function-name: ^2.0.0\n+  checksum: 869edff00288442f8d7fa4c9327f91d85f3b3acf8cbbef9ea7a220345cf23e9241b6def9263d2c1ebcf3a316b0aa52ad26a43a84aa02baca3381717b3e307f47\n   languageName: node\n   linkType: hard\n \n@@ -18411,6 +18655,18 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"safe-array-concat@npm:^1.0.1\":\n+  version: 1.0.1\n+  resolution: \"safe-array-concat@npm:1.0.1\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    get-intrinsic: ^1.2.1\n+    has-symbols: ^1.0.3\n+    isarray: ^2.0.5\n+  checksum: 001ecf1d8af398251cbfabaf30ed66e3855127fbceee178179524b24160b49d15442f94ed6c0db0b2e796da76bb05b73bf3cc241490ec9c2b741b41d33058581\n+  languageName: node\n+  linkType: hard\n+\n \"safe-buffer@npm:5.1.2, safe-buffer@npm:~5.1.0, safe-buffer@npm:~5.1.1\":\n   version: 5.1.2\n   resolution: \"safe-buffer@npm:5.1.2\"\n@@ -18547,7 +18803,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"semver@npm:7.5.3, semver@npm:7.x, semver@npm:^7.0.0, semver@npm:^7.1.1, semver@npm:^7.1.2, semver@npm:^7.3.2, semver@npm:^7.3.4, semver@npm:^7.3.5, semver@npm:^7.3.7, semver@npm:^7.3.8\":\n+\"semver@npm:7.5.3\":\n   version: 7.5.3\n   resolution: \"semver@npm:7.5.3\"\n   dependencies:\n@@ -18558,12 +18814,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"semver@npm:^6.0.0, semver@npm:^6.1.1, semver@npm:^6.1.2, semver@npm:^6.3.0\":\n-  version: 6.3.0\n-  resolution: \"semver@npm:6.3.0\"\n+\"semver@npm:7.x, semver@npm:^7.0.0, semver@npm:^7.1.1, semver@npm:^7.1.2, semver@npm:^7.3.2, semver@npm:^7.3.4, semver@npm:^7.3.5, semver@npm:^7.3.7, semver@npm:^7.3.8, semver@npm:^7.5.4\":\n+  version: 7.5.4\n+  resolution: \"semver@npm:7.5.4\"\n+  dependencies:\n+    lru-cache: ^6.0.0\n+  bin:\n+    semver: bin/semver.js\n+  checksum: 12d8ad952fa353b0995bf180cdac205a4068b759a140e5d3c608317098b3575ac2f1e09182206bf2eb26120e1c0ed8fb92c48c592f6099680de56bb071423ca3\n+  languageName: node\n+  linkType: hard\n+\n+\"semver@npm:^6.0.0, semver@npm:^6.1.1, semver@npm:^6.1.2, semver@npm:^6.3.0, semver@npm:^6.3.1\":\n+  version: 6.3.1\n+  resolution: \"semver@npm:6.3.1\"\n   bin:\n-    semver: ./bin/semver.js\n-  checksum: 1b26ecf6db9e8292dd90df4e781d91875c0dcc1b1909e70f5d12959a23c7eebb8f01ea581c00783bbee72ceeaad9505797c381756326073850dc36ed284b21b9\n+    semver: bin/semver.js\n+  checksum: ae47d06de28836adb9d3e25f22a92943477371292d9b665fb023fae278d345d508ca1958232af086d85e0155aee22e313e100971898bbb8d5d89b8b1d4054ca2\n   languageName: node\n   linkType: hard\n \n@@ -18616,6 +18883,29 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-function-length@npm:^1.1.1\":\n+  version: 1.1.1\n+  resolution: \"set-function-length@npm:1.1.1\"\n+  dependencies:\n+    define-data-property: ^1.1.1\n+    get-intrinsic: ^1.2.1\n+    gopd: ^1.0.1\n+    has-property-descriptors: ^1.0.0\n+  checksum: c131d7569cd7e110cafdfbfbb0557249b538477624dfac4fc18c376d879672fa52563b74029ca01f8f4583a8acb35bb1e873d573a24edb80d978a7ee607c6e06\n+  languageName: node\n+  linkType: hard\n+\n+\"set-function-name@npm:^2.0.0, set-function-name@npm:^2.0.1\":\n+  version: 2.0.1\n+  resolution: \"set-function-name@npm:2.0.1\"\n+  dependencies:\n+    define-data-property: ^1.0.1\n+    functions-have-names: ^1.2.3\n+    has-property-descriptors: ^1.0.0\n+  checksum: 4975d17d90c40168eee2c7c9c59d023429f0a1690a89d75656306481ece0c3c1fb1ebcc0150ea546d1913e35fbd037bace91372c69e543e51fc5d1f31a9fa126\n+  languageName: node\n+  linkType: hard\n+\n \"setprototypeof@npm:1.2.0\":\n   version: 1.2.0\n   resolution: \"setprototypeof@npm:1.2.0\"\n@@ -19144,25 +19434,36 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"string.prototype.trimend@npm:^1.0.6\":\n-  version: 1.0.6\n-  resolution: \"string.prototype.trimend@npm:1.0.6\"\n+\"string.prototype.trim@npm:^1.2.8\":\n+  version: 1.2.8\n+  resolution: \"string.prototype.trim@npm:1.2.8\"\n   dependencies:\n     call-bind: ^1.0.2\n-    define-properties: ^1.1.4\n-    es-abstract: ^1.20.4\n-  checksum: 0fdc34645a639bd35179b5a08227a353b88dc089adf438f46be8a7c197fc3f22f8514c1c9be4629b3cd29c281582730a8cbbad6466c60f76b5f99cf2addb132e\n+    define-properties: ^1.2.0\n+    es-abstract: ^1.22.1\n+  checksum: 49eb1a862a53aba73c3fb6c2a53f5463173cb1f4512374b623bcd6b43ad49dd559a06fb5789bdec771a40fc4d2a564411c0a75d35fb27e76bbe738c211ecff07\n   languageName: node\n   linkType: hard\n \n-\"string.prototype.trimstart@npm:^1.0.6\":\n-  version: 1.0.6\n-  resolution: \"string.prototype.trimstart@npm:1.0.6\"\n+\"string.prototype.trimend@npm:^1.0.7\":\n+  version: 1.0.7\n+  resolution: \"string.prototype.trimend@npm:1.0.7\"\n   dependencies:\n     call-bind: ^1.0.2\n-    define-properties: ^1.1.4\n-    es-abstract: ^1.20.4\n-  checksum: 89080feef416621e6ef1279588994305477a7a91648d9436490d56010a1f7adc39167cddac7ce0b9884b8cdbef086987c4dcb2960209f2af8bac0d23ceff4f41\n+    define-properties: ^1.2.0\n+    es-abstract: ^1.22.1\n+  checksum: 2375516272fd1ba75992f4c4aa88a7b5f3c7a9ca308d963bcd5645adf689eba6f8a04ebab80c33e30ec0aefc6554181a3a8416015c38da0aa118e60ec896310c\n+  languageName: node\n+  linkType: hard\n+\n+\"string.prototype.trimstart@npm:^1.0.7\":\n+  version: 1.0.7\n+  resolution: \"string.prototype.trimstart@npm:1.0.7\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    define-properties: ^1.2.0\n+    es-abstract: ^1.22.1\n+  checksum: 13d0c2cb0d5ff9e926fa0bec559158b062eed2b68cd5be777ffba782c96b2b492944e47057274e064549b94dd27cf81f48b27a31fee8af5b574cff253e7eb613\n   languageName: node\n   linkType: hard\n \n@@ -19239,7 +19540,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"strip-json-comments@npm:^3.1.0, strip-json-comments@npm:^3.1.1\":\n+\"strip-json-comments@npm:^3.1.1\":\n   version: 3.1.1\n   resolution: \"strip-json-comments@npm:3.1.1\"\n   checksum: 492f73e27268f9b1c122733f28ecb0e7e8d8a531a6662efbd08e22cccb3f9475e90a1b82cab06a392f6afae6d2de636f977e231296400d0ec5304ba70f166443\n@@ -19843,6 +20144,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"ts-api-utils@npm:^1.0.1\":\n+  version: 1.0.3\n+  resolution: \"ts-api-utils@npm:1.0.3\"\n+  peerDependencies:\n+    typescript: \">=4.2.0\"\n+  checksum: 441cc4489d65fd515ae6b0f4eb8690057add6f3b6a63a36073753547fb6ce0c9ea0e0530220a0b282b0eec535f52c4dfc315d35f8a4c9a91c0def0707a714ca6\n+  languageName: node\n+  linkType: hard\n+\n \"ts-dedent@npm:^2.2.0\":\n   version: 2.2.0\n   resolution: \"ts-dedent@npm:2.2.0\"\n@@ -20079,6 +20389,42 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"typed-array-buffer@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"typed-array-buffer@npm:1.0.0\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    get-intrinsic: ^1.2.1\n+    is-typed-array: ^1.1.10\n+  checksum: 3e0281c79b2a40cd97fe715db803884301993f4e8c18e8d79d75fd18f796e8cd203310fec8c7fdb5e6c09bedf0af4f6ab8b75eb3d3a85da69328f28a80456bd3\n+  languageName: node\n+  linkType: hard\n+\n+\"typed-array-byte-length@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"typed-array-byte-length@npm:1.0.0\"\n+  dependencies:\n+    call-bind: ^1.0.2\n+    for-each: ^0.3.3\n+    has-proto: ^1.0.1\n+    is-typed-array: ^1.1.10\n+  checksum: b03db16458322b263d87a702ff25388293f1356326c8a678d7515767ef563ef80e1e67ce648b821ec13178dd628eb2afdc19f97001ceae7a31acf674c849af94\n+  languageName: node\n+  linkType: hard\n+\n+\"typed-array-byte-offset@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"typed-array-byte-offset@npm:1.0.0\"\n+  dependencies:\n+    available-typed-arrays: ^1.0.5\n+    call-bind: ^1.0.2\n+    for-each: ^0.3.3\n+    has-proto: ^1.0.1\n+    is-typed-array: ^1.1.10\n+  checksum: 04f6f02d0e9a948a95fbfe0d5a70b002191fae0b8fe0fe3130a9b2336f043daf7a3dda56a31333c35a067a97e13f539949ab261ca0f3692c41603a46a94e960b\n+  languageName: node\n+  linkType: hard\n+\n \"typed-array-length@npm:^1.0.4\":\n   version: 1.0.4\n   resolution: \"typed-array-length@npm:1.0.4\"\n@@ -21364,17 +21710,48 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"which-typed-array@npm:^1.1.9\":\n-  version: 1.1.9\n-  resolution: \"which-typed-array@npm:1.1.9\"\n+\"which-builtin-type@npm:^1.1.3\":\n+  version: 1.1.3\n+  resolution: \"which-builtin-type@npm:1.1.3\"\n+  dependencies:\n+    function.prototype.name: ^1.1.5\n+    has-tostringtag: ^1.0.0\n+    is-async-function: ^2.0.0\n+    is-date-object: ^1.0.5\n+    is-finalizationregistry: ^1.0.2\n+    is-generator-function: ^1.0.10\n+    is-regex: ^1.1.4\n+    is-weakref: ^1.0.2\n+    isarray: ^2.0.5\n+    which-boxed-primitive: ^1.0.2\n+    which-collection: ^1.0.1\n+    which-typed-array: ^1.1.9\n+  checksum: 43730f7d8660ff9e33d1d3f9f9451c4784265ee7bf222babc35e61674a11a08e1c2925019d6c03154fcaaca4541df43abe35d2720843b9b4cbcebdcc31408f36\n+  languageName: node\n+  linkType: hard\n+\n+\"which-collection@npm:^1.0.1\":\n+  version: 1.0.1\n+  resolution: \"which-collection@npm:1.0.1\"\n+  dependencies:\n+    is-map: ^2.0.1\n+    is-set: ^2.0.1\n+    is-weakmap: ^2.0.1\n+    is-weakset: ^2.0.1\n+  checksum: c815bbd163107ef9cb84f135e6f34453eaf4cca994e7ba85ddb0d27cea724c623fae2a473ceccfd5549c53cc65a5d82692de418166df3f858e1e5dc60818581c\n+  languageName: node\n+  linkType: hard\n+\n+\"which-typed-array@npm:^1.1.11, which-typed-array@npm:^1.1.13, which-typed-array@npm:^1.1.9\":\n+  version: 1.1.13\n+  resolution: \"which-typed-array@npm:1.1.13\"\n   dependencies:\n     available-typed-arrays: ^1.0.5\n-    call-bind: ^1.0.2\n+    call-bind: ^1.0.4\n     for-each: ^0.3.3\n     gopd: ^1.0.1\n     has-tostringtag: ^1.0.0\n-    is-typed-array: ^1.1.10\n-  checksum: fe0178ca44c57699ca2c0e657b64eaa8d2db2372a4e2851184f568f98c478ae3dc3fdb5f7e46c384487046b0cf9e23241423242b277e03e8ba3dabc7c84c98ef\n+  checksum: 3828a0d5d72c800e369d447e54c7620742a4cc0c9baf1b5e8c17e9b6ff90d8d861a3a6dd4800f1953dbf80e5e5cec954a289e5b4a223e3bee4aeb1f8c5f33309\n   languageName: node\n   linkType: hard\n \n@@ -21434,7 +21811,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"word-wrap@npm:^1.2.3, word-wrap@npm:~1.2.3\":\n+\"word-wrap@npm:~1.2.3\":\n   version: 1.2.4\n   resolution: \"word-wrap@npm:1.2.4\"\n   checksum: 8f1f2e0a397c0e074ca225ba9f67baa23f99293bc064e31355d426ae91b8b3f6b5f6c1fc9ae5e9141178bb362d563f55e62fd8d5c31f2a77e3ade56cb3e35bd1\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/sidebars.test.ts b/galata/test/jupyterlab/sidebars.test.ts\nindex 34eb32ca8a4f..65e26d0b8303 100644\n--- a/galata/test/jupyterlab/sidebars.test.ts\n+++ b/galata/test/jupyterlab/sidebars.test.ts\n@@ -132,9 +132,8 @@ test.describe('Sidebars', () => {\n     const runningSessionsWidget = page.locator('#jp-running-sessions');\n     const runningSessionsElementAriaLabel =\n       await runningSessionsWidget.getAttribute('aria-label');\n-    const runningSessionsElementRole = await runningSessionsWidget.getAttribute(\n-      'role'\n-    );\n+    const runningSessionsElementRole =\n+      await runningSessionsWidget.getAttribute('role');\n     expect(runningSessionsElementAriaLabel).toEqual('Running Sessions section');\n     expect(runningSessionsElementRole).toEqual('region');\n   });\n@@ -161,9 +160,8 @@ test.describe('Sidebars', () => {\n   }) => {\n     await page.sidebar.open('left');\n     const fileBrowserWidget = page.locator('#filebrowser');\n-    const fileBrowserElementAriaLabel = await fileBrowserWidget.getAttribute(\n-      'aria-label'\n-    );\n+    const fileBrowserElementAriaLabel =\n+      await fileBrowserWidget.getAttribute('aria-label');\n     const fileBrowserElementRole = await fileBrowserWidget.getAttribute('role');\n     expect(fileBrowserElementAriaLabel).toEqual('File Browser Section');\n     expect(fileBrowserElementRole).toEqual('region');\n@@ -174,9 +172,8 @@ test.describe('Sidebars', () => {\n   }) => {\n     await page.sidebar.open('right');\n     const debuggerWidget = page.locator('#jp-debugger-sidebar');\n-    const debuggerElementAriaLabel = await debuggerWidget.getAttribute(\n-      'aria-label'\n-    );\n+    const debuggerElementAriaLabel =\n+      await debuggerWidget.getAttribute('aria-label');\n     const debuggerElementRole = await debuggerWidget.getAttribute('role');\n     expect(debuggerElementAriaLabel).toEqual('Debugger section');\n     expect(debuggerElementRole).toEqual('region');\n@@ -189,9 +186,8 @@ test.describe('Sidebars', () => {\n     const tableOfContentsWidget = page.locator('#table-of-contents');\n     const tableOfContentsElementAriaLabel =\n       await tableOfContentsWidget.getAttribute('aria-label');\n-    const tableOfContentsElementRole = await tableOfContentsWidget.getAttribute(\n-      'role'\n-    );\n+    const tableOfContentsElementRole =\n+      await tableOfContentsWidget.getAttribute('role');\n     expect(tableOfContentsElementAriaLabel).toEqual(\n       'Table of Contents section'\n     );\n\ndiff --git a/packages/filebrowser/test/model.spec.ts b/packages/filebrowser/test/model.spec.ts\nindex 98716eeaf1e1..60f8fdd79227 100644\n--- a/packages/filebrowser/test/model.spec.ts\n+++ b/packages/filebrowser/test/model.spec.ts\n@@ -436,9 +436,8 @@ describe('filebrowser/model', () => {\n               const file = new File([content], fname, { type: 'text/plain' });\n               await model.upload(file);\n               // Ensure we get the file back.\n-              const contentModel = await model.manager.services.contents.get(\n-                fname\n-              );\n+              const contentModel =\n+                await model.manager.services.contents.get(fname);\n               expect(contentModel.content.length).toBeGreaterThan(0);\n             });\n           }\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15499",
    "pr_id": 15499,
    "issue_id": 15498,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Adopt Ruff format\nWe should look into adopting the new Ruff format: https://docs.astral.sh/ruff/formatter/\r\n\r\nAnd then drop `black`. This would simplify tooling more, and auto-update PRs like https://github.com/jupyterlab/jupyterlab/pull/15491.\r\n\r\nFor reference the notebook repo adopted ruff format in https://github.com/jupyter/notebook/pull/7132.",
    "issue_word_count": 55,
    "test_files_count": 3,
    "non_test_files_count": 14,
    "pr_changed_files": [
      ".pre-commit-config.yaml",
      "binder/environment.yml",
      "clean.py",
      "docs/source/conf.py",
      "docs/source/developer/contributing.rst",
      "examples/example_check.py",
      "jupyterlab/commands.py",
      "jupyterlab/extensions/manager.py",
      "jupyterlab/federated_labextensions.py",
      "jupyterlab/handlers/announcements.py",
      "jupyterlab/labapp.py",
      "jupyterlab/tests/conftest.py",
      "jupyterlab/tests/test_custom_css_handler.py",
      "jupyterlab/tests/test_extensions.py",
      "jupyterlab/upgrade_extension.py",
      "pyproject.toml",
      "scripts/ci_script.sh"
    ],
    "pr_changed_test_files": [
      "jupyterlab/tests/conftest.py",
      "jupyterlab/tests/test_custom_css_handler.py",
      "jupyterlab/tests/test_extensions.py"
    ],
    "base_commit": "b20bc015328689ebda9c95fbc545c6aed0f26c82",
    "head_commit": "96a57750b01b1b5f351ceb7c22995cdfdde53a76",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15499",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15499",
    "dockerfile": "",
    "pr_merged_at": "2023-12-07T12:42:52.000Z",
    "patch": "diff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 044bb95b90c3..7394e4d8a075 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -31,17 +31,13 @@ repos:\n     hooks:\n       - id: check-github-workflows\n \n-  - repo: https://github.com/psf/black\n-    rev: 23.11.0\n-    hooks:\n-      - id: black\n-\n   # Check ruff version is aligned with the one in pyproject.toml\n   - repo: https://github.com/astral-sh/ruff-pre-commit\n     rev: v0.1.6\n     hooks:\n       - id: ruff\n         args: [\"--fix\"]\n+      - id: ruff-format\n \n   - repo: local\n     hooks:\n\ndiff --git a/binder/environment.yml b/binder/environment.yml\nindex d3549cdb430d..9b6357290628 100644\n--- a/binder/environment.yml\n+++ b/binder/environment.yml\n@@ -39,7 +39,6 @@ dependencies:\n   - requests-cache\n   - virtualenv\n   # dev\n-  - black-jupyter\n   - bump2version\n   - hatch\n   - pre-commit\n\ndiff --git a/clean.py b/clean.py\nindex 2672d280bf3e..2b67712e7c03 100644\n--- a/clean.py\n+++ b/clean.py\n@@ -12,7 +12,9 @@\n     for root, dnames, _ in os.walk(here):\n         if \"node_modules\" in dnames:\n             subprocess.check_call(\n-                [\"rmdir\", \"/s\", \"/q\", \"node_modules\"], cwd=root, shell=True  # noqa S602 S607\n+                [\"rmdir\", \"/s\", \"/q\", \"node_modules\"],  # noqa S602 S607\n+                cwd=root,\n+                shell=True,  # noqa S602 S607\n             )\n             dnames.remove(\"node_modules\")\n \n\ndiff --git a/docs/source/conf.py b/docs/source/conf.py\nindex d22f5dfe1c0f..4cf9a2419df6 100644\n--- a/docs/source/conf.py\n+++ b/docs/source/conf.py\n@@ -396,7 +396,7 @@ def document_plugins_tokens_list(list_path: Path, output_path: Path) -> None:\n \n \n # Example configuration for intersphinx: refer to the Python standard library.\n-intersphinx_mapping = {'python': ('https://docs.python.org/3', None)}\n+intersphinx_mapping = {\"python\": (\"https://docs.python.org/3\", None)}\n \n \n def setup(app):\n\ndiff --git a/docs/source/developer/contributing.rst b/docs/source/developer/contributing.rst\nindex 6d7923254d43..6c181792897f 100644\n--- a/docs/source/developer/contributing.rst\n+++ b/docs/source/developer/contributing.rst\n@@ -97,11 +97,11 @@ All source code is written in\n `TypeScript <https://www.typescriptlang.org/Handbook>`__. See the `Style\n Guide <https://github.com/jupyterlab/jupyterlab/wiki/TypeScript-Style-Guide>`__.\n \n-All non-python source code is formatted using `prettier <https://prettier.io>`__, and python source code is formatted using `black <https://github.com/psf/black>`__.\n+All non-python source code is formatted using `prettier <https://prettier.io>`__, and python source code is formatted using `ruff <https://docs.astral.sh/ruff>`__.\n When code is modified and committed, all staged files will be\n automatically formatted using pre-commit git hooks (with help from\n `pre-commit <https://github.com/pre-commit/pre-commit>`__). The benefit of\n-using a code formatters like ``prettier`` and ``black`` is that it removes the topic of\n+using a code formatters like ``prettier`` and ``ruff`` is that it removes the topic of\n code style from the conversation when reviewing pull requests, thereby\n speeding up the review process.\n \n@@ -121,7 +121,7 @@ You can invoke the pre-commit hook by hand at any time with::\n \n which should run any autoformatting on your code\n and tell you about any errors it couldn't fix automatically.\n-You may also install `black integration <https://github.com/psf/black#editor-integration>`__\n+You may also install `ruff integration <https://docs.astral.sh/ruff/integrations>`__\n into your text editor to format code automatically.\n \n If you have already committed files before setting up the pre-commit\n\ndiff --git a/examples/example_check.py b/examples/example_check.py\nindex 2972964f5748..5bc49b972c23 100644\n--- a/examples/example_check.py\n+++ b/examples/example_check.py\n@@ -21,7 +21,7 @@\n \n here = Path(__file__).parent.resolve()\n TEST_FILE = here / \"example.spec.ts\"\n-REF_SNAPSHOT = Path(TEST_FILE.with_suffix('.ts-snapshots').name) / \"example-linux.png\"\n+REF_SNAPSHOT = Path(TEST_FILE.with_suffix(\".ts-snapshots\").name) / \"example-linux.png\"\n \n \n def main():\n@@ -96,7 +96,7 @@ async def run_browser(url):\n \n     current_env = os.environ.copy()\n     current_env[\"BASE_URL\"] = url\n-    current_env[\"TEST_SNAPSHOT\"] = '1' if has_snapshot else '0'\n+    current_env[\"TEST_SNAPSHOT\"] = \"1\" if has_snapshot else \"0\"\n     try:\n         await run_async_process([\"npx\", \"playwright\", \"test\"], env=current_env, cwd=str(target))\n     finally:\n\ndiff --git a/jupyterlab/commands.py b/jupyterlab/commands.py\nindex 054190a3428d..4b3fe8d161df 100644\n--- a/jupyterlab/commands.py\n+++ b/jupyterlab/commands.py\n@@ -2054,7 +2054,9 @@ def _yarn_config(logger):\n \n     try:\n         output_binary = subprocess.check_output(\n-            [node, YARN_PATH, \"config\", \"--json\"], stderr=subprocess.PIPE, cwd=HERE  # noqa S603\n+            [node, YARN_PATH, \"config\", \"--json\"],  # noqa S603\n+            stderr=subprocess.PIPE,\n+            cwd=HERE,\n         )\n         output = output_binary.decode(\"utf-8\")\n         lines = iter(output.splitlines())\n@@ -2363,7 +2365,7 @@ def _is_locked(name, locked=None) -> LockStatus:\n             continue\n         if name == lock:\n             return LockStatus(entire_extension_locked=True)\n-        extension_part = lock.partition(':')[0]\n+        extension_part = lock.partition(\":\")[0]\n         if name == extension_part:\n             locked_plugins.add(lock)\n \n@@ -2415,7 +2417,7 @@ def _log_multiple_compat_errors(logger, errors_map):\n                 [\n                     \"\\n   The following extensions are outdated:\",\n                     *outdated,\n-                    '\\n   Consider checking if an update is available for these packages.\\n',\n+                    \"\\n   Consider checking if an update is available for these packages.\\n\",\n                 ]\n             )\n         )\n\ndiff --git a/jupyterlab/extensions/manager.py b/jupyterlab/extensions/manager.py\nindex 5d962c9bbb8a..76594c9ecf0d 100644\n--- a/jupyterlab/extensions/manager.py\n+++ b/jupyterlab/extensions/manager.py\n@@ -221,10 +221,10 @@ def _find_locked(self, plugins_or_extensions: List[str]) -> FrozenSet[str]:\n             return set(plugins_or_extensions)\n         locked_subset = set()\n         extensions_with_locked_plugins = {\n-            plugin.split(':')[0] for plugin in self.options.lock_rules\n+            plugin.split(\":\")[0] for plugin in self.options.lock_rules\n         }\n         for plugin in plugins_or_extensions:\n-            if ':' in plugin:\n+            if \":\" in plugin:\n                 # check directly if this is a plugin identifier (has colon)\n                 if plugin in self.options.lock_rules:\n                     locked_subset.add(plugin)\n\ndiff --git a/jupyterlab/federated_labextensions.py b/jupyterlab/federated_labextensions.py\nindex f5caac220e7b..9645332a6c7e 100644\n--- a/jupyterlab/federated_labextensions.py\n+++ b/jupyterlab/federated_labextensions.py\n@@ -442,7 +442,8 @@ def _get_labextension_metadata(module):  # noqa\n         try:\n             package = (\n                 subprocess.check_output(\n-                    [sys.executable, \"setup.py\", \"--name\"], cwd=mod_path  # noqa S603\n+                    [sys.executable, \"setup.py\", \"--name\"],  # noqa S603\n+                    cwd=mod_path,\n                 )\n                 .decode(\"utf8\")\n                 .strip()\n\ndiff --git a/jupyterlab/handlers/announcements.py b/jupyterlab/handlers/announcements.py\nindex e94d68cefc5e..e98becf75f34 100644\n--- a/jupyterlab/handlers/announcements.py\n+++ b/jupyterlab/handlers/announcements.py\n@@ -238,7 +238,7 @@ def get_xml_text(attr: str, default: Optional[str] = None) -> str:\n                             return default\n                         else:\n                             error_m = (\n-                                f'atom feed entry does not contain a required attribute: {attr}'\n+                                f\"atom feed entry does not contain a required attribute: {attr}\"\n                             )\n                             raise KeyError(error_m)\n \n@@ -246,10 +246,10 @@ def get_xml_text(attr: str, default: Optional[str] = None) -> str:\n                     entry_id = get_xml_text(\"id\")\n                     entry_updated = get_xml_text(\"updated\")\n                     entry_published = get_xml_text(\"published\", entry_updated)\n-                    entry_summary = get_xml_text(\"summary\", default='')\n+                    entry_summary = get_xml_text(\"summary\", default=\"\")\n                     links = node.findall(\"atom:link\", xml_namespaces)\n                     if len(links) > 1:\n-                        alternate = list(filter(lambda elem: elem.get('rel') == 'alternate', links))\n+                        alternate = list(filter(lambda elem: elem.get(\"rel\") == \"alternate\", links))\n                         link_node = alternate[0] if alternate else links[0]\n                     else:\n                         link_node = links[0] if len(links) == 1 else None\n\ndiff --git a/jupyterlab/labapp.py b/jupyterlab/labapp.py\nindex 12fe4d6fdeca..1fb700394cd6 100644\n--- a/jupyterlab/labapp.py\n+++ b/jupyterlab/labapp.py\n@@ -751,8 +751,8 @@ def initialize_handlers(self):  # noqa\n                     r\"/custom/(.*)(?<!\\.js)$\",\n                     self.serverapp.web_app.settings[\"static_handler_class\"],\n                     {\n-                        'path': self.serverapp.web_app.settings['static_custom_path'],\n-                        'no_cache_paths': ['/'],  # don't cache anything in custom\n+                        \"path\": self.serverapp.web_app.settings[\"static_custom_path\"],\n+                        \"no_cache_paths\": [\"/\"],  # don't cache anything in custom\n                     },\n                 )\n             )\n\ndiff --git a/jupyterlab/upgrade_extension.py b/jupyterlab/upgrade_extension.py\nindex f8b86ba2ccaa..77c1bda18df4 100644\n--- a/jupyterlab/upgrade_extension.py\n+++ b/jupyterlab/upgrade_extension.py\n@@ -98,7 +98,8 @@ def update_extension(  # noqa\n         if setup_file.exists():\n             python_name = (\n                 subprocess.check_output(\n-                    [sys.executable, \"setup.py\", \"--name\"], cwd=target  # noqa S603\n+                    [sys.executable, \"setup.py\", \"--name\"],  # noqa: S603\n+                    cwd=target,\n                 )\n                 .decode(\"utf8\")\n                 .strip()\n@@ -149,7 +150,7 @@ def update_extension(  # noqa\n     }\n \n     template = \"https://github.com/jupyterlab/extension-template\"\n-    if tuple(copier.__version__.split('.')) < ('8', '0', '0'):\n+    if tuple(copier.__version__.split(\".\")) < (\"8\", \"0\", \"0\"):\n         copier.run_auto(template, output_dir, vcs_ref=vcs_ref, data=extra_context, defaults=True)\n     else:\n         copier.run_copy(\n@@ -281,7 +282,7 @@ def update_extension(  # noqa\n                 pyproject = tomllib.loads(pyproject_file.read_text())\n \n                 # Backport requirements\n-                requirements_raw = config.get('options', 'install_requires', fallback=None)\n+                requirements_raw = config.get(\"options\", \"install_requires\", fallback=None)\n                 if requirements_raw is not None:\n                     requirements = list(\n                         filter(\n@@ -297,8 +298,8 @@ def update_extension(  # noqa\n                 )\n \n                 # Backport extras\n-                if config.has_section('options.extras_require'):\n-                    for extra, deps_raw in config.items('options.extras_require'):\n+                if config.has_section(\"options.extras_require\"):\n+                    for extra, deps_raw in config.items(\"options.extras_require\"):\n                         deps = list(filter(lambda r: r, deps_raw.splitlines()))\n                         if extra in pyproject[\"project\"].get(\"optional-dependencies\", {}):\n                             if pyproject[\"project\"].get(\"optional-dependencies\") is None:\n@@ -339,7 +340,7 @@ def update_extension(  # noqa\n \n     if answer_file.exists():\n         msg = \"This script won't do anything for copier template, instead execute in your extension directory:\\n\\n    copier update\"\n-        if tuple(copier.__version__.split('.')) >= ('8', '0', '0'):\n+        if tuple(copier.__version__.split(\".\")) >= (\"8\", \"0\", \"0\"):\n             msg += \" --UNSAFE\"\n         print(msg)\n     else:\n\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 59f3fc62326f..63f8ce7ff023 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -118,7 +118,6 @@ dev = [\n     \"hatch\",\n     \"bump2version\",\n     \"ruff==0.1.6\",\n-    \"black[jupyter]==23.11.0\"\n ]\n \n [tool.check-wheel-contents]\n@@ -240,21 +239,11 @@ before-build-python = [\n ]\n after-publish-assets = \"npm run after:publish:assets\"\n \n-[tool.black]\n-line-length = 100\n-target-version = [\"py37\"]\n-skip-string-normalization = true\n-extend-exclude = '''\n-(\n-  .*\\/css_js_injection.ipynb  # Exclude integration test notebook\n-)\n-'''\n-\n [tool.ruff]\n-target-version = \"py37\"\n+target-version = \"py38\"\n line-length = 100\n select = [\n-  \"A\", \"B\", \"C\", \"DTZ\", \"E\", \"EM\", \"F\", \"FBT\", \"I\", \"ICN\", \"ISC\", \"N\",\n+  \"A\", \"B\", \"C\", \"DTZ\", \"E\", \"EM\", \"F\", \"FBT\", \"I\", \"ICN\", \"N\",\n   \"PLC\", \"PLE\", \"PLR\", \"PLW\", \"Q\", \"RUF\", \"S\", \"SIM\", \"T\", \"TID\", \"UP\",\n   \"W\", \"YTT\",\n ]\n@@ -271,7 +260,7 @@ ignore = [\n \"SIM105\",\n ]\n \n-[tool.ruff.per-file-ignores]\n+[tool.ruff.lint.per-file-ignores]\n # F821 Undefined name `c`\n \"binder/jupyter_config.py\" = [\"F821\"]\n # RUF012 Mutable class attributes should be annotated with `typing.ClassVar`\n\ndiff --git a/scripts/ci_script.sh b/scripts/ci_script.sh\nindex 7272057148c4..9d7d60b9dad8 100755\n--- a/scripts/ci_script.sh\n+++ b/scripts/ci_script.sh\n@@ -81,7 +81,7 @@ if [[ $GROUP == lint ]]; then\n     jlpm run stylelint:check || (echo 'Please run `jlpm run stylelint` locally and push changes' && exit 1)\n \n     # Python checks\n-    black --check --diff --color .\n+    ruff format .\n     ruff .\n     pipx run 'validate-pyproject[all]' pyproject.toml\n fi\n",
    "test_patch": "diff --git a/jupyterlab/tests/conftest.py b/jupyterlab/tests/conftest.py\nindex dd73673683d5..38ed7ca23287 100644\n--- a/jupyterlab/tests/conftest.py\n+++ b/jupyterlab/tests/conftest.py\n@@ -23,8 +23,8 @@ def labserverapp(jp_serverapp, make_labserver_extension_app):\n                 r\"/custom/(.*)(?<!\\.js)$\",\n                 jp_serverapp.web_app.settings[\"static_handler_class\"],\n                 {\n-                    'path': jp_serverapp.web_app.settings['static_custom_path'],\n-                    'no_cache_paths': ['/'],  # don't cache anything in custom\n+                    \"path\": jp_serverapp.web_app.settings[\"static_custom_path\"],\n+                    \"no_cache_paths\": [\"/\"],  # don't cache anything in custom\n                 },\n             ),\n             (\n\ndiff --git a/jupyterlab/tests/test_custom_css_handler.py b/jupyterlab/tests/test_custom_css_handler.py\nindex ad6c3c29c391..2e3458716b64 100644\n--- a/jupyterlab/tests/test_custom_css_handler.py\n+++ b/jupyterlab/tests/test_custom_css_handler.py\n@@ -28,7 +28,7 @@ def jp_server_config(jp_server_config, tmp_path):\n async def test_CustomCssHandler(tmp_path, jp_serverapp, labserverapp, jp_fetch):\n     custom_path = tmp_path / \"config\" / \"custom\"\n     # Check we are placing the custom.css file in the appropriate folder\n-    assert str(custom_path) in jp_serverapp.web_app.settings['static_custom_path']\n+    assert str(custom_path) in jp_serverapp.web_app.settings[\"static_custom_path\"]\n     custom_path.mkdir(parents=True, exist_ok=True)\n     (custom_path / \"custom.css\").write_text(CUSTOM_CSS)\n     response = await jp_fetch(\"custom\", \"custom.css\", method=\"GET\")\n\ndiff --git a/jupyterlab/tests/test_extensions.py b/jupyterlab/tests/test_extensions.py\nindex e19d60c8e353..9df368b044a6 100644\n--- a/jupyterlab/tests/test_extensions.py\n+++ b/jupyterlab/tests/test_extensions.py\n@@ -239,7 +239,6 @@ async def mock_pkg_metadata(n, l, b):  # noqa\n                     \"nbformat\",\n                     \"packaging\",\n                     \"pexpect\",\n-                    \"black ; extra == 'dev'\",\n                     \"coverage ; extra == 'dev'\",\n                     \"jupyter-packaging (~=0.7.9) ; extra == 'dev'\",\n                     \"jupyterlab (~=3.0) ; extra == 'dev'\",\n@@ -248,7 +247,6 @@ async def mock_pkg_metadata(n, l, b):  # noqa\n                     \"pytest-asyncio ; extra == 'dev'\",\n                     \"pytest-cov ; extra == 'dev'\",\n                     \"pytest-tornasync ; extra == 'dev'\",\n-                    \"black ; extra == 'tests'\",\n                     \"coverage ; extra == 'tests'\",\n                     \"jupyter-packaging (~=0.7.9) ; extra == 'tests'\",\n                     \"jupyterlab (~=3.0) ; extra == 'tests'\",\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15479",
    "pr_id": 15479,
    "issue_id": 12322,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "ipdb focus issues causes some characters to be put into cell above\n## Description\r\n\r\nIf you push enter to fast in ipdb, this puts the character into the input above. While this may result in some extra whitespace, it could delete code if you had any text selected.\r\n\r\n## Reproduce\r\n```\r\nimport ipdb\r\ndef inf_loop():\r\n    i = 0\r\n    while True:\r\n        print(i)\r\n        i += 1\r\nipdb.runcall(inf_loop)\r\n```\r\nPush n then hold enter.\r\n![spaces](https://user-images.githubusercontent.com/1813603/161161671-2710778d-2c47-4ba3-a1da-5fad45b70352.gif)\r\n\r\n\r\n## Expected behavior\r\n\r\nThe input cell is not changed.\r\n\r\n## Context\r\n- JupyterLab version: 3.3.0",
    "issue_word_count": 96,
    "test_files_count": 1,
    "non_test_files_count": 2,
    "pr_changed_files": [
      "galata/test/jupyterlab/outputarea-stdin.test.ts",
      "packages/outputarea/src/widget.ts",
      "packages/outputarea/style/base.css"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/outputarea-stdin.test.ts"
    ],
    "base_commit": "c26a0e7cced6eea64a7f0908a7cded8e4c8874fb",
    "head_commit": "3aa773f59c69097c0aa44e5c453721289d9a975d",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15479",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15479",
    "dockerfile": "",
    "pr_merged_at": "2023-12-13T18:24:28.000Z",
    "patch": "diff --git a/packages/outputarea/src/widget.ts b/packages/outputarea/src/widget.ts\nindex 8a588a57520b..76686cd24536 100644\n--- a/packages/outputarea/src/widget.ts\n+++ b/packages/outputarea/src/widget.ts\n@@ -44,6 +44,8 @@ const OUTPUT_AREA_OUTPUT_CLASS = 'jp-OutputArea-output';\n  */\n const OUTPUT_AREA_PROMPT_CLASS = 'jp-OutputArea-prompt';\n \n+const OUTPUT_AREA_STDIN_HIDING_CLASS = 'jp-OutputArea-stdin-hiding';\n+\n /**\n  * The class name added to OutputPrompt.\n  */\n@@ -457,10 +459,11 @@ export class OutputArea extends Widget {\n     if (this.model.length >= this.maxNumberOutputs) {\n       this.maxNumberOutputs = this.model.length;\n     }\n-    this.layout.addWidget(panel);\n-\n     this._inputRequested.emit(input);\n \n+    // Get the input node to ensure focus after updating the model upon user reply.\n+    const inputNode = input.node.getElementsByTagName('input')[0];\n+\n     /**\n      * Wait for the stdin to complete, add it to the model (so it persists)\n      * and remove the stdin widget.\n@@ -470,14 +473,37 @@ export class OutputArea extends Widget {\n       if (this.model.length >= this.maxNumberOutputs) {\n         this.maxNumberOutputs = this.model.length + 1;\n       }\n+      panel.addClass(OUTPUT_AREA_STDIN_HIDING_CLASS);\n       // Use stdin as the stream so it does not get combined with stdout.\n+      // Note: because it modifies DOM it may (will) shift focus away from the input node.\n       this.model.add({\n         output_type: 'stream',\n         name: 'stdin',\n         text: value + '\\n'\n       });\n-      panel.dispose();\n+      // Refocus the input node after it lost focus due to update of the model.\n+      inputNode.focus();\n+\n+      // Keep the input in view for a little while; this (along refocusing)\n+      // ensures that we can avoid the cell editor stealing the focus, and\n+      // leading to user inadvertently modifying editor content when executing\n+      // consecutive commands in short succession.\n+      window.setTimeout(() => {\n+        // Tack currently focused element to ensure that it remains on it\n+        // after disposal of the panel with the old input\n+        // (which modifies DOM and can lead to focus jump).\n+        const focusedElement = document.activeElement;\n+        // Dispose the old panel with no longer needed input box.\n+        panel.dispose();\n+        // Refocus the element that was focused before.\n+        if (focusedElement && focusedElement instanceof HTMLElement) {\n+          focusedElement.focus();\n+        }\n+      }, 500);\n     });\n+\n+    // Note: the `input.value` promise must be listened to before we attach the panel\n+    this.layout.addWidget(panel);\n   }\n \n   /**\n@@ -1093,6 +1119,11 @@ export class Stdin extends Widget implements IStdin {\n    * not be called directly by user code.\n    */\n   handleEvent(event: KeyboardEvent): void {\n+    if (this._resolved) {\n+      // Do not handle any more key events if the promise was resolved.\n+      event.preventDefault();\n+      return;\n+    }\n     const input = this._input;\n \n     if (event.type === 'keydown') {\n@@ -1112,6 +1143,7 @@ export class Stdin extends Widget implements IStdin {\n           this._value += input.value;\n           Stdin._historyPush(this._historyKey, input.value);\n         }\n+        this._resolved = true;\n         this._promise.resolve(void 0);\n       } else if (event.key === 'Escape') {\n         // currently this gets clobbered by the documentsearch:end command at the notebook level\n@@ -1227,6 +1259,7 @@ export class Stdin extends Widget implements IStdin {\n   private _trans: TranslationBundle;\n   private _value: string;\n   private _valueCache: string;\n+  private _resolved: boolean = false;\n }\n \n export namespace Stdin {\n\ndiff --git a/packages/outputarea/style/base.css b/packages/outputarea/style/base.css\nindex 6d59355f4f71..ff18a4a36ec1 100644\n--- a/packages/outputarea/style/base.css\n+++ b/packages/outputarea/style/base.css\n@@ -249,6 +249,12 @@ body.lm-mod-override-cursor .jp-OutputArea-output.jp-mod-isolated::before {\n   opacity: 1;\n }\n \n+.jp-OutputArea-stdin-hiding {\n+  /* soft-hide the output, preserving focus */\n+  opacity: 0;\n+  height: 0;\n+}\n+\n /*-----------------------------------------------------------------------------\n | Output Area View\n |----------------------------------------------------------------------------*/\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/outputarea-stdin.test.ts b/galata/test/jupyterlab/outputarea-stdin.test.ts\nindex 12ef944f1a31..9eb578c440b2 100644\n--- a/galata/test/jupyterlab/outputarea-stdin.test.ts\n+++ b/galata/test/jupyterlab/outputarea-stdin.test.ts\n@@ -7,6 +7,16 @@ test.use({\n   locale: 'en-US'\n });\n \n+const loopedInput = `\\\n+from time import sleep\n+input()\n+print('before sleep')\n+sleep(0.1)\n+print('after sleep')`;\n+\n+const ACTIVE_INPUT =\n+  '.jp-OutputArea-stdin-item:not(.jp-OutputArea-stdin-hiding) .jp-Stdin-input';\n+\n test.describe('Stdin for ipdb', () => {\n   test.beforeEach(async ({ page }) => {\n     await page.notebook.createNew();\n@@ -24,20 +34,20 @@ test.describe('Stdin for ipdb', () => {\n     await page.keyboard.press('Control+Enter');\n \n     // enter a bunch of nonsense commands into the stdin attached to ipdb\n-    await page.waitForSelector('.jp-Stdin-input');\n+    await page.waitForSelector(ACTIVE_INPUT);\n     await page.keyboard.insertText('foofoo');\n     await page.keyboard.press('Enter');\n \n-    await page.waitForSelector('.jp-Stdin-input');\n+    await page.waitForSelector(ACTIVE_INPUT);\n     await page.keyboard.insertText('barbar');\n     await page.keyboard.press('Enter');\n \n-    await page.waitForSelector('.jp-Stdin-input');\n+    await page.waitForSelector(ACTIVE_INPUT);\n     await page.keyboard.insertText('bazbaz');\n     await page.keyboard.press('Enter');\n \n     // search for the first nonsense command\n-    await page.waitForSelector('.jp-Stdin-input');\n+    await page.waitForSelector(ACTIVE_INPUT);\n     await page.keyboard.insertText('foo');\n     await page.keyboard.press('Control+ArrowUp');\n \n@@ -54,7 +64,7 @@ test.describe('Stdin for ipdb', () => {\n \n     // Check that the input remains focused and cursor is at the end.\n     await page.keyboard.insertText('x');\n-    await expect(page.locator('.jp-Stdin-input')).toHaveValue('foofoox');\n+    await expect(page.locator(ACTIVE_INPUT)).toHaveValue('foofoox');\n   });\n \n   test('Typing in stdin box', async ({ page }) => {\n@@ -82,4 +92,39 @@ test.describe('Stdin for ipdb', () => {\n       alphabet + alphabet.toUpperCase() + digits\n     );\n   });\n+\n+  test('Subsequent execution in short succession', async ({ page }) => {\n+    await page.notebook.setCell(0, 'code', loopedInput);\n+    // Run the selected (only) cell without proceeding and without waiting\n+    // for it to complete (as it should stay waiting for input).\n+    await page.keyboard.press('Control+Enter');\n+\n+    // Wait for first input\n+    await page.waitForSelector('.jp-Stdin-input');\n+\n+    // Note: this test does not wait for subsequent inputs on purpose\n+\n+    await page.getByText('before sleep').waitFor();\n+\n+    // Press enter five times (should do nothing)\n+    for (let j = 0; j < 5; j++) {\n+      await page.keyboard.press('Enter');\n+    }\n+    // Press a key which should go to the input\n+    await page.keyboard.press('x');\n+\n+    await page.getByText('after sleep').waitFor();\n+\n+    // Press enter five times (should submit and then do nothing)\n+    for (let j = 0; j < 5; j++) {\n+      await page.keyboard.press('Enter');\n+    }\n+\n+    const cellInput = await page.notebook.getCellInput(0);\n+    const editor = await cellInput.$('.cm-content');\n+    const contentAfter = await editor.evaluate((e: any) =>\n+      e.cmView.view.state.doc.toString()\n+    );\n+    expect(contentAfter).toBe(loopedInput);\n+  });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15440",
    "pr_id": 15440,
    "issue_id": 15429,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "User input clobbered by Keyboard Shortcuts in Lab\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nWhen attempting to get user input in a notebook cell in Jupyter Lab 4.0.7 or Notebook 7.0.6, if the keyboard input matches any keyboard shortcut, the keyboard shortcut is triggered instead.  For instance: Shift+L to toggle line numbers.  The only way to enter a capital L is to turn on caps lock, press L and turn off caps lock. This works properly at least in Jupyter Lab 4.0.4 but I haven't tested 4.0.5 or 4.0.6\r\n\r\n## Reproduce\r\n\r\n- create a cell containing: `input()` (or getpass.getpass())\r\n- Run the cell\r\n- Attempt to enter a capital L by pressing Shift+L\r\n- Jupyter will trigger the SHIFT+L keyboard shortcut that toggles line numbers off/on rather than entering a capital L in the input field\r\n\r\n![image](https://github.com/jupyterlab/jupyterlab/assets/51446717/9b28b530-9d17-4324-85f8-461fe61e179d)\r\n\r\n\r\n## Expected behavior\r\n\r\nThe input field receives the value of Capital L\r\n\r\n## Context\r\nUsing jupyter/base-notebook:848a82674792 container\r\nGoogle Chrome 119.0.6045.160 to access it\r\nNo Browser Console Output",
    "issue_word_count": 223,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "galata/test/jupyterlab/outputarea-stdin.test.ts",
      "packages/notebook-extension/schema/tracker.json"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/outputarea-stdin.test.ts"
    ],
    "base_commit": "3d525a2c24524fe1431c3227e62057c9137940ed",
    "head_commit": "9b6a83ee2a728a49f766fd3bb382f451f0b5d4a6",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15440",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15440",
    "dockerfile": "",
    "pr_merged_at": "2023-11-28T14:29:47.000Z",
    "patch": "diff --git a/packages/notebook-extension/schema/tracker.json b/packages/notebook-extension/schema/tracker.json\nindex 26059a897ed4..020ed62d819e 100644\n--- a/packages/notebook-extension/schema/tracker.json\n+++ b/packages/notebook-extension/schema/tracker.json\n@@ -611,7 +611,7 @@\n     {\n       \"command\": \"viewmenu:line-numbering\",\n       \"keys\": [\"Shift L\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode\"\n+      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n     },\n     {\n       \"command\": \"viewmenu:match-brackets\",\n@@ -628,11 +628,6 @@\n       \"keys\": [\"Ctrl Shift -\"],\n       \"selector\": \".jp-Notebook.jp-mod-editMode\"\n     },\n-    {\n-      \"command\": \"notebook:toggle-all-cell-line-numbers\",\n-      \"keys\": [\"Shift L\"],\n-      \"selector\": \".jp-Notebook.jp-mod-commandMode :focus:not(:read-write)\"\n-    },\n     {\n       \"command\": \"notebook:undo-cell-action\",\n       \"keys\": [\"Z\"],\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/outputarea-stdin.test.ts b/galata/test/jupyterlab/outputarea-stdin.test.ts\nindex 2efeb9427bc0..12ef944f1a31 100644\n--- a/galata/test/jupyterlab/outputarea-stdin.test.ts\n+++ b/galata/test/jupyterlab/outputarea-stdin.test.ts\n@@ -3,6 +3,10 @@\n \n import { expect, test } from '@jupyterlab/galata';\n \n+test.use({\n+  locale: 'en-US'\n+});\n+\n test.describe('Stdin for ipdb', () => {\n   test.beforeEach(async ({ page }) => {\n     await page.notebook.createNew();\n@@ -52,4 +56,30 @@ test.describe('Stdin for ipdb', () => {\n     await page.keyboard.insertText('x');\n     await expect(page.locator('.jp-Stdin-input')).toHaveValue('foofoox');\n   });\n+\n+  test('Typing in stdin box', async ({ page }) => {\n+    // Test to ensure that notebook shortcuts do not capture text typed into inputs.\n+    // This may not be sufficient to ensure no conflicts with other languages but\n+    // should catch the most severe issues.\n+    const alphabet = 'abcdefghijklmnopqrstuvwxyz';\n+    const digits = '0123456789';\n+    await page.notebook.setCell(0, 'code', 'input()');\n+    // Run the selected (only) cell without proceeding and without waiting\n+    // for it to complete (as it should stay waiting for input).\n+    await page.keyboard.press('Control+Enter');\n+\n+    await page.waitForSelector('.jp-Stdin-input');\n+    for (const letter of alphabet) {\n+      await page.keyboard.press(`Key${letter.toUpperCase()}`);\n+    }\n+    for (const letter of alphabet) {\n+      await page.keyboard.press(`Shift+Key${letter.toUpperCase()}`);\n+    }\n+    for (const digit of digits) {\n+      await page.keyboard.press(`Digit${digit}`);\n+    }\n+    await expect(page.locator('.jp-Stdin-input')).toHaveValue(\n+      alphabet + alphabet.toUpperCase() + digits\n+    );\n+  });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15408",
    "pr_id": 15408,
    "issue_id": 15407,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Scrolling jitter [windowed nb]\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nIn full windowing mode, it is possible to enter a jitter mode when activating a inactive notebook with active cell out side the view (aka scrolling will be needed).\r\n\r\n![bug_focus_switching](https://github.com/jupyterlab/jupyterlab/assets/8435071/cd17593e-e686-4524-a8ab-e3eb184c1fe7)\r\n\r\n> Note that before the jittering notebook, when returning on the cell with `pp` leads to an unexpected scroll.\r\n\r\n## Reproduce\r\n\r\n<!--Describe step-by-step instructions to reproduce the behavior-->\r\n\r\nSee screen cast - basically switch between two tabs one being a notebook and when going back to the notebook, click on a cell that is not active with the active cell out of the view.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\n<!--Describe what you expected to happen-->\r\nNo scrolling occur when reactivating a notebook.\r\n\r\n## Context\r\n\r\n<!--Complete the following for context, and add any other relevant context-->\r\nmain branch: 5a28ab4147764a6c8ac2ad442ed948579f8615b3\r\nFirefox 114\r\n<!--The more content you provide, the more we can help!-->\r\n\r\n<details><summary>Troubleshoot Output</summary>\r\n<pre>\r\nPaste the output from running `jupyter troubleshoot` from the command line here.\r\nYou may want to sanitize the paths in the output.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Command Line Output</summary>\r\n<pre>\r\nPaste the output from your command line running `jupyter lab` here, use `--debug` if possible.\r\n</pre>\r\n</details>\r\n\r\n<details><summary>Browser Output</summary>\r\n<!--See https://webmasters.stackexchange.com/a/77337 for how to access the JavaScript console-->\r\n<pre>\r\nPaste the output from your browser Javascript console here, if applicable.\r\n\r\n</pre>\r\n</details>\r\n",
    "issue_word_count": 295,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/notebook/src/widget.ts",
      "packages/notebook/test/widget.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/notebook/test/widget.spec.ts"
    ],
    "base_commit": "5a28ab4147764a6c8ac2ad442ed948579f8615b3",
    "head_commit": "99ec7191cf05bbaf52a77c819fbf9d130637a3f1",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15408",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15408",
    "dockerfile": "",
    "pr_merged_at": "2023-12-01T12:50:53.000Z",
    "patch": "diff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex 4da66a96afc4..b4191ee9a7e9 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -1359,12 +1359,29 @@ export class Notebook extends StaticNotebook {\n     return this._mode;\n   }\n   set mode(newValue: NotebookMode) {\n+    this.setMode(newValue);\n+  }\n+\n+  /**\n+   * Set the notebook mode.\n+   *\n+   * @param newValue Notebook mode\n+   * @param options Control mode side-effect\n+   * @param options.focus Whether to ensure focus (default) or not when setting the mode.\n+   */\n+  protected setMode(\n+    newValue: NotebookMode,\n+    options: { focus?: boolean } = {}\n+  ): void {\n+    const setFocus = options.focus ?? true;\n     const activeCell = this.activeCell;\n     if (!activeCell) {\n       newValue = 'command';\n     }\n     if (newValue === this._mode) {\n-      this._ensureFocus();\n+      if (setFocus) {\n+        this._ensureFocus();\n+      }\n       return;\n     }\n     // Post an update request.\n@@ -1383,18 +1400,22 @@ export class Notebook extends StaticNotebook {\n       }\n       activeCell!.inputHidden = false;\n     } else {\n-      void NotebookActions.focusActiveCell(this, {\n-        // Do not await the active cell because that creates a bug. If the user\n-        // is editing a code cell and presses Accel Shift C to open the command\n-        // palette, then the command palette opens before\n-        // activeCell.node.focus() is called, which closes the command palette.\n-        // To the end user, it looks as if all the keyboard shortcut did was\n-        // move focus from the cell editor to the cell as a whole.\n-        waitUntilReady: false\n-      });\n+      if (setFocus) {\n+        void NotebookActions.focusActiveCell(this, {\n+          // Do not await the active cell because that creates a bug. If the user\n+          // is editing a code cell and presses Accel Shift C to open the command\n+          // palette, then the command palette opens before\n+          // activeCell.node.focus() is called, which closes the command palette.\n+          // To the end user, it looks as if all the keyboard shortcut did was\n+          // move focus from the cell editor to the cell as a whole.\n+          waitUntilReady: false\n+        });\n+      }\n     }\n     this._stateChanged.emit({ name: 'mode', oldValue, newValue });\n-    this._ensureFocus();\n+    if (setFocus) {\n+      this._ensureFocus();\n+    }\n   }\n \n   /**\n@@ -2700,17 +2721,18 @@ export class Notebook extends StaticNotebook {\n       const widget = this.widgets[index];\n       // If the editor itself does not have focus, ensure command mode.\n       if (widget.editorWidget && !widget.editorWidget.node.contains(target)) {\n-        this.mode = 'command';\n+        this.setMode('command', { focus: false });\n       }\n       // If the editor has focus, ensure edit mode.\n       const node = widget.editorWidget?.node;\n       if (node?.contains(target)) {\n-        this.mode = 'edit';\n+        this.setMode('edit', { focus: false });\n       }\n+      // This will set the focus\n       this.activeCellIndex = index;\n     } else {\n       // No cell has focus, ensure command mode.\n-      this.mode = 'command';\n+      this.setMode('command', { focus: false });\n \n       // Prevents the parent element to get the focus.\n       event.preventDefault();\n@@ -2767,13 +2789,7 @@ export class Notebook extends StaticNotebook {\n \n     // Otherwise enter command mode if not already.\n     if (this.mode !== 'command') {\n-      this.mode = 'command';\n-\n-      // Switching to command mode currently focuses the active cell, so\n-      // refocus the relatedTarget so the focus actually switches as intended.\n-      if (relatedTarget) {\n-        relatedTarget.focus();\n-      }\n+      this.setMode('command', { focus: false });\n     }\n   }\n \n",
    "test_patch": "diff --git a/packages/notebook/test/widget.spec.ts b/packages/notebook/test/widget.spec.ts\nindex 138fcced6778..e3dedac74d91 100644\n--- a/packages/notebook/test/widget.spec.ts\n+++ b/packages/notebook/test/widget.spec.ts\n@@ -1348,7 +1348,7 @@ describe('@jupyter/notebook', () => {\n       });\n \n       describe('focusout', () => {\n-        it('should switch to command mode', () => {\n+        it('should switch to command mode', async () => {\n           simulate(widget.node, 'focusin');\n           widget.mode = 'edit';\n           const event = generate('focusout');\n@@ -1356,6 +1356,8 @@ describe('@jupyter/notebook', () => {\n           widget.node.dispatchEvent(event);\n           expect(widget.mode).toBe('command');\n           MessageLoop.sendMessage(widget, Widget.Msg.ActivateRequest);\n+          // Wait for the activeCell to be focused\n+          await framePromise();\n           expect(widget.mode).toBe('command');\n           expect(widget.activeCell!.editor!.hasFocus()).toBe(false);\n         });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15401",
    "pr_id": 15401,
    "issue_id": 13343,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Scrollbar jumps back in a virtualized notebook on scrolling\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\n\r\nIn a virtualized notebook, on scrolling, the scrollbar jumps back and shrinks as more content is rendered. This is a bit jarring visually and the original scrollbar is not indicative of the actual size of the notebook.\r\n\r\n## Reproduce\r\n\r\nIn a notebook running from Jupyterlab >= 4.0.0a29, \r\n\r\n1. Open a notebook with about a 100 cells - the scrollbar at this point does not reflect the actual size of the notebook (100 cells)\r\n3. Start scrolling down to view cells below the original viewport\r\n4. The scrollbar jumps back and changes in size as more DOM elements are added.\r\n\r\n<!--Describe how you diagnosed the issue. See the guidelines at\r\n https://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html -->\r\n\r\n## Expected behavior\r\n\r\nScroll bar moves smoothly during scrolling\r\n\r\n## Context\r\n\r\n- Browser and version:  Chrome 106, Firefox 106\r\n- JupyterLab version: 4.0.0a29\r\n\r\n",
    "issue_word_count": 185,
    "test_files_count": 1,
    "non_test_files_count": 5,
    "pr_changed_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts",
      "packages/notebook/package.json",
      "packages/notebook/src/widget.ts",
      "packages/notebook/src/windowing.ts",
      "packages/ui-components/src/components/windowedlist.ts",
      "yarn.lock"
    ],
    "pr_changed_test_files": [
      "galata/test/jupyterlab/windowed-notebook.test.ts"
    ],
    "base_commit": "80dd3d65e3cde89d6b7f5dccd7fdf38f18b453a1",
    "head_commit": "69c8cfa123df0ce01bcca6c3b2240b238d84556b",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15401",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15401",
    "dockerfile": "",
    "pr_merged_at": "2024-03-26T15:42:46.000Z",
    "patch": "diff --git a/packages/notebook/package.json b/packages/notebook/package.json\nindex 90ebdd4bad8c..a02f25a95939 100644\n--- a/packages/notebook/package.json\n+++ b/packages/notebook/package.json\n@@ -65,6 +65,7 @@\n     \"@lumino/domutils\": \"^2.0.1\",\n     \"@lumino/dragdrop\": \"^2.1.4\",\n     \"@lumino/messaging\": \"^2.0.1\",\n+    \"@lumino/polling\": \"^2.1.2\",\n     \"@lumino/properties\": \"^2.0.1\",\n     \"@lumino/signaling\": \"^2.1.2\",\n     \"@lumino/virtualdom\": \"^2.0.1\",\n\ndiff --git a/packages/notebook/src/widget.ts b/packages/notebook/src/widget.ts\nindex e125fa64176b..11629b3fc414 100644\n--- a/packages/notebook/src/widget.ts\n+++ b/packages/notebook/src/widget.ts\n@@ -196,7 +196,7 @@ if ((window as any).requestIdleCallback === undefined) {\n  * `null` model, and may want to listen to the `modelChanged`\n  * signal.\n  */\n-export class StaticNotebook extends WindowedList {\n+export class StaticNotebook extends WindowedList<NotebookViewModel> {\n   /**\n    * Construct a notebook widget.\n    */\n@@ -895,13 +895,18 @@ export class StaticNotebook extends WindowedList {\n     ) {\n       const cell = this.cellsArray[cellIdx];\n       if (cell.isPlaceholder()) {\n-        switch (this.notebookConfig.windowingMode) {\n-          case 'defer':\n-            await this._updateForDeferMode(cell, cellIdx);\n-            break;\n-          case 'full':\n-            this._renderCSSAndJSOutputs(cell, cellIdx);\n-            break;\n+        if (['defer', 'full'].includes(this.notebookConfig.windowingMode)) {\n+          await this._updateForDeferMode(cell, cellIdx);\n+          if (this.notebookConfig.windowingMode === 'full') {\n+            // We need to delay slightly the removal to let codemirror properly initialize\n+            requestAnimationFrame(() => {\n+              this.viewModel.setEstimatedWidgetSize(\n+                cell.model.id,\n+                cell.node.getBoundingClientRect().height\n+              );\n+              this.layout.removeWidget(cell);\n+            });\n+          }\n         }\n       }\n       cellIdx++;\n@@ -937,34 +942,6 @@ export class StaticNotebook extends WindowedList {\n     await cell.ready;\n   }\n \n-  private _renderCSSAndJSOutputs(\n-    cell: Cell<ICellModel>,\n-    cellIdx: number\n-  ): void {\n-    // Only render cell with text/html outputs containing scripts or/and styles\n-    // Note:\n-    //   We don't need to render JavaScript mimetype outputs because they get\n-    //   directly evaluate without adding DOM elements (see @jupyterlab/javascript-extension)\n-    if (cell instanceof CodeCell) {\n-      for (\n-        let outputIdx = 0;\n-        outputIdx < (cell.model.outputs?.length ?? 0);\n-        outputIdx++\n-      ) {\n-        const output = cell.model.outputs.get(outputIdx);\n-        const html = (output.data['text/html'] as string) ?? '';\n-        if (\n-          html.match(\n-            /(<style[^>]*>[^<]*<\\/style[^>]*>|<script[^>]*>.*?<\\/script[^>]*>)/gims\n-          )\n-        ) {\n-          this.renderCellOutputs(cellIdx);\n-          break;\n-        }\n-      }\n-    }\n-  }\n-\n   /**\n    * Apply updated notebook settings.\n    */\n\ndiff --git a/packages/notebook/src/windowing.ts b/packages/notebook/src/windowing.ts\nindex 0459029b93da..69ac275929d0 100644\n--- a/packages/notebook/src/windowing.ts\n+++ b/packages/notebook/src/windowing.ts\n@@ -3,13 +3,14 @@\n  * Distributed under the terms of the Modified BSD License.\n  */\n \n-import { Cell, CodeCell } from '@jupyterlab/cells';\n+import { Cell, CodeCell, CodeCellModel } from '@jupyterlab/cells';\n import {\n   WindowedLayout,\n   WindowedList,\n   WindowedListModel\n } from '@jupyterlab/ui-components';\n import { Message, MessageLoop } from '@lumino/messaging';\n+import { Debouncer } from '@lumino/polling';\n import { Widget } from '@lumino/widgets';\n import { DROP_SOURCE_CLASS, DROP_TARGET_CLASS } from './constants';\n \n@@ -49,16 +50,50 @@ export class NotebookViewModel extends WindowedListModel {\n    * @returns Cell height in pixels\n    */\n   estimateWidgetSize = (index: number): number => {\n-    // TODO could be improved, takes only into account the editor height\n-    const nLines = this.cells[index].model.sharedModel\n-      .getSource()\n-      .split('\\n').length;\n+    const model = this.cells[index].model;\n+    const height = this.cellsEstimatedHeight.get(model.id);\n+    if (typeof height === 'number') {\n+      return height;\n+    }\n+\n+    const nLines = model.sharedModel.getSource().split('\\n').length;\n+    let outputsLines = 0;\n+    if (model instanceof CodeCellModel) {\n+      for (let outputIdx = 0; outputIdx < model.outputs.length; outputIdx++) {\n+        const output = model.outputs.get(outputIdx);\n+        outputsLines = ((output.data['text/plain'] as string) ?? '').split(\n+          '\\n'\n+        ).length;\n+      }\n+    }\n     return (\n-      NotebookViewModel.DEFAULT_EDITOR_LINE_HEIGHT * nLines +\n+      NotebookViewModel.DEFAULT_EDITOR_LINE_HEIGHT * (nLines + outputsLines) +\n       NotebookViewModel.DEFAULT_CELL_MARGIN\n     );\n   };\n \n+  /**\n+   * Set an estimated height for a cell\n+   *\n+   * @param cellId Cell ID\n+   * @param size Cell height\n+   */\n+  setEstimatedWidgetSize(cellId: string, size: number | null): void {\n+    if (size === null) {\n+      if (this.cellsEstimatedHeight.has(cellId)) {\n+        this.cellsEstimatedHeight.delete(cellId);\n+      }\n+    } else {\n+      this.cellsEstimatedHeight.set(cellId, size);\n+      this._emitEstimatedHeightChanged.invoke().catch(error => {\n+        console.error(\n+          'Fail to trigger an update following a estimated height update.',\n+          error\n+        );\n+      });\n+    }\n+  }\n+\n   /**\n    * Render the cell at index.\n    *\n@@ -82,6 +117,23 @@ export class NotebookViewModel extends WindowedListModel {\n    * Defaults to scrolling when the cell margin or more is invisible.\n    */\n   readonly scrollUpThreshold = NotebookViewModel.DEFAULT_CELL_MARGIN / 2;\n+\n+  /**\n+   * Mapping between the cell ids and the cell estimated heights\n+   *\n+   * This height is not refreshed with the changes to the document.\n+   * It is only used to measure cells outside the viewport on CPU\n+   * idle cycle to improve UX scrolling.\n+   */\n+  protected cellsEstimatedHeight = new Map<string, number>();\n+\n+  private _emitEstimatedHeightChanged = new Debouncer(() => {\n+    this._stateChanged.emit({\n+      name: 'estimatedWidgetSize',\n+      newValue: null,\n+      oldValue: null\n+    });\n+  });\n }\n \n /**\n\ndiff --git a/packages/ui-components/src/components/windowedlist.ts b/packages/ui-components/src/components/windowedlist.ts\nindex 8daf7aada8a4..4a8e0f64106d 100644\n--- a/packages/ui-components/src/components/windowedlist.ts\n+++ b/packages/ui-components/src/components/windowedlist.ts\n@@ -137,10 +137,10 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n   /**\n    * Items list to be rendered\n    */\n-  get itemsList(): IObservableList<any> | null {\n+  get itemsList(): ISimpleObservableList | null {\n     return this._itemsList;\n   }\n-  set itemsList(v: IObservableList<any> | null) {\n+  set itemsList(v: ISimpleObservableList | null) {\n     if (this._itemsList !== v) {\n       if (this._itemsList) {\n         this._itemsList.changed.disconnect(this.onListChanged, this);\n@@ -248,7 +248,13 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n     IChangedArgs<\n       any,\n       any,\n-      'count' | 'index' | 'list' | 'overscanCount' | 'windowingActive'\n+      | 'count'\n+      | 'estimatedWidgetSize'\n+      | 'index'\n+      | 'list'\n+      | 'overscanCount'\n+      | 'windowingActive'\n+      | string\n     >\n   > {\n     return this._stateChanged;\n@@ -282,10 +288,10 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n       totalSizeOfMeasuredItems = itemMetadata.offset + itemMetadata.size;\n     }\n \n-    // We can do better than this\n-    const numUnmeasuredItems = this.widgetCount - this._lastMeasuredIndex - 1;\n-    const totalSizeOfUnmeasuredItems =\n-      numUnmeasuredItems * this._estimatedWidgetSize;\n+    let totalSizeOfUnmeasuredItems = 0;\n+    for (let i = this._lastMeasuredIndex + 1; i < this.widgetCount; i++) {\n+      totalSizeOfUnmeasuredItems += this.estimateWidgetSize(i);\n+    }\n \n     return totalSizeOfMeasuredItems + totalSizeOfUnmeasuredItems;\n   }\n@@ -548,8 +554,8 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n         this._widgetSizers.splice(\n           changes.newIndex,\n           0,\n-          ...new Array(changes.newValues.length).map(() => {\n-            return { offset: 0, size: this._estimatedWidgetSize };\n+          ...new Array(changes.newValues.length).map((_, i) => {\n+            return { offset: 0, size: this.estimateWidgetSize(i) };\n           })\n         );\n         this.resetAfterIndex(changes.newIndex - 1);\n@@ -729,6 +735,8 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n \n   /**\n    * Default widget size estimation\n+   *\n+   * @deprecated we always use {@link estimateWidgetSize}\n    */\n   protected _estimatedWidgetSize: number = WindowedList.DEFAULT_WIDGET_SIZE;\n   protected _stateChanged = new Signal<\n@@ -736,14 +744,20 @@ export abstract class WindowedListModel implements WindowedList.IModel {\n     IChangedArgs<\n       any,\n       any,\n-      'count' | 'index' | 'list' | 'overscanCount' | 'windowingActive'\n+      | 'count'\n+      | 'estimatedWidgetSize'\n+      | 'index'\n+      | 'list'\n+      | 'overscanCount'\n+      | 'windowingActive'\n+      | string\n     >\n   >(this);\n \n   private _currentWindow: WindowedList.WindowIndex = [-1, -1, -1, -1];\n   private _height: number = 0;\n   private _isDisposed = false;\n-  private _itemsList: IObservableList<any> | null = null;\n+  private _itemsList: ISimpleObservableList | null = null;\n   private _lastMeasuredIndex: number = -1;\n   private _overscanCount = 1;\n   private _scrollOffset: number = 0;\n@@ -1104,6 +1118,11 @@ export class WindowedList<\n           this._addListeners();\n         }\n         break;\n+      case 'estimatedWidgetSize':\n+        // This only impact the container height and should not\n+        // impact the elements in the viewport.\n+        this._updateTotalSize();\n+        return;\n     }\n     this.update();\n   }\n@@ -1289,10 +1308,7 @@ export class WindowedList<\n         if (stopIndex >= 0) {\n           // Read this value after creating the cells.\n           // So their actual sizes are taken into account\n-          const estimatedTotalHeight = this.viewModel.getEstimatedTotalSize();\n-\n-          // Update inner container height\n-          this._innerElement.style.height = `${estimatedTotalHeight}px`;\n+          this._updateTotalSize();\n \n           // Update position of window container\n           const [top, minHeight] = this.viewModel.getSpan(\n@@ -1458,6 +1474,19 @@ export class WindowedList<\n     }\n   }\n \n+  /**\n+   * Update the total size\n+   */\n+  private _updateTotalSize(): void {\n+    if (this.viewModel.windowingActive) {\n+      const estimatedTotalHeight = this.viewModel.getEstimatedTotalSize();\n+\n+      // Update inner container height\n+      this._innerElement.style.height = `${estimatedTotalHeight}px`;\n+    }\n+  }\n+\n+  protected _viewModel: T;\n   private _innerElement: HTMLElement;\n   private _isParentHidden: boolean;\n   private _isScrolling: PromiseDelegate<void> | null;\n@@ -1479,7 +1508,6 @@ export class WindowedList<\n     | null;\n   private _scrollUpdateWasRequested: boolean;\n   private _updater: Throttler;\n-  private _viewModel: T;\n   private _viewport: HTMLElement;\n }\n \n@@ -1623,6 +1651,15 @@ export class WindowedLayout extends PanelLayout {\n   }\n }\n \n+/**\n+ * Windowed list model interface\n+ */\n+export interface ISimpleObservableList<T = any> {\n+  get?: (index: number) => T;\n+  length: number;\n+  changed: ISignal<any, IObservableList.IChangedArgs<any>>;\n+}\n+\n /**\n  * A namespace for windowed list\n  */\n@@ -1762,11 +1799,7 @@ export namespace WindowedList {\n     /**\n      * Items list to be rendered\n      */\n-    itemsList: {\n-      get?: (index: number) => T;\n-      length: number;\n-      changed: ISignal<any, IObservableList.IChangedArgs<any>>;\n-    } | null;\n+    itemsList: ISimpleObservableList<T> | null;\n \n     /**\n      * Number of widgets to render in addition to those\n@@ -1808,7 +1841,12 @@ export namespace WindowedList {\n       IChangedArgs<\n         any,\n         any,\n-        'count' | 'index' | 'list' | 'overscanCount' | 'windowingActive'\n+        | 'count'\n+        | 'index'\n+        | 'list'\n+        | 'overscanCount'\n+        | 'windowingActive'\n+        | string\n       >\n     >;\n \n\ndiff --git a/yarn.lock b/yarn.lock\nindex 88ef232648b3..018f3de8ad56 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -4319,6 +4319,7 @@ __metadata:\n     \"@lumino/domutils\": ^2.0.1\n     \"@lumino/dragdrop\": ^2.1.4\n     \"@lumino/messaging\": ^2.0.1\n+    \"@lumino/polling\": ^2.1.2\n     \"@lumino/properties\": ^2.0.1\n     \"@lumino/signaling\": ^2.1.2\n     \"@lumino/virtualdom\": ^2.0.1\n",
    "test_patch": "diff --git a/galata/test/jupyterlab/windowed-notebook.test.ts b/galata/test/jupyterlab/windowed-notebook.test.ts\nindex de25a7f0efc6..cfda174595b3 100644\n--- a/galata/test/jupyterlab/windowed-notebook.test.ts\n+++ b/galata/test/jupyterlab/windowed-notebook.test.ts\n@@ -446,7 +446,7 @@ test('should navigate to a search hit in a out-of-viewport cell', async ({\n   await page.getByText('1/2').waitFor();\n   await expect\n     .soft(page.locator('.jp-Cell[data-windowed-list-index=\"11\"]'))\n-    .toHaveCount(0);\n+    .not.toBeVisible();\n \n   await page.getByRole('button', { name: 'Next Match (Ctrl+G)' }).click();\n \n@@ -459,7 +459,7 @@ test('should navigate to a search hit in a out-of-viewport cell', async ({\n   await page.getByText('1/1').waitFor();\n   await expect\n     .soft(page.locator('.jp-Cell[data-windowed-list-index=\"18\"]'))\n-    .toHaveCount(0);\n+    .not.toBeVisible();\n \n   await page\n     .getByRole('button', { name: 'Previous Match (Ctrl+Shift+G)' })\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  },
  {
    "instance_id": "jupyterlab__jupyterlab-15387",
    "pr_id": 15387,
    "issue_id": 15365,
    "repo": "jupyterlab/jupyterlab",
    "problem_statement": "Jitter in the file browser when refreshed\n<!-- Welcome! Thank you for contributing. These HTML comments will not render in the issue.\r\n\r\nBefore creating a new issue:\r\n* Search for relevant issues\r\n* Follow the issue reporting guidelines:\r\nhttps://jupyterlab.readthedocs.io/en/latest/getting_started/issue.html\r\n-->\r\n\r\n## Description\r\nI am noticing a jitter in the file browser on refreshing it. Please see the attached gif.\r\n![jitter2](https://github.com/jupyterlab/jupyterlab/assets/30082866/90686aeb-b24a-4ba6-87d2-c39393f18e2a)\r\n\r\n\r\n## Reproduce\r\nClick on the refresh button in the filebrowser.\r\nThis is more easily reproducible when there is a large number of items in a directory.\r\n\r\n## Context\r\nI'm using  -  jupyterlab==4.0.6\r\n",
    "issue_word_count": 108,
    "test_files_count": 1,
    "non_test_files_count": 1,
    "pr_changed_files": [
      "packages/filebrowser/src/crumbs.ts",
      "packages/filebrowser/test/crumbs.spec.ts"
    ],
    "pr_changed_test_files": [
      "packages/filebrowser/test/crumbs.spec.ts"
    ],
    "base_commit": "ea6dd41b2ce5aec02c8a9d6024ae6513911a55fe",
    "head_commit": "4f321b8c4b00ecc14c3a1f720fe43120b9309305",
    "repo_url": "https://github.com/jupyterlab/jupyterlab/pull/15387",
    "swe_url": "https://swe-bench-plus.turing.com/repos/jupyterlab__jupyterlab/15387",
    "dockerfile": "",
    "pr_merged_at": "2023-11-14T10:00:08.000Z",
    "patch": "diff --git a/packages/filebrowser/src/crumbs.ts b/packages/filebrowser/src/crumbs.ts\nindex a7b55ab4988a..22bc0140a940 100644\n--- a/packages/filebrowser/src/crumbs.ts\n+++ b/packages/filebrowser/src/crumbs.ts\n@@ -15,6 +15,7 @@ import {\n   folderIcon as rootIcon\n } from '@jupyterlab/ui-components';\n import { ArrayExt } from '@lumino/algorithm';\n+import { JSONExt } from '@lumino/coreutils';\n import { ElementExt } from '@lumino/domutils';\n import { Drag } from '@lumino/dragdrop';\n import { Message } from '@lumino/messaging';\n@@ -160,13 +161,16 @@ export class BreadCrumbs extends Widget {\n     // Update the breadcrumb list.\n     const contents = this._model.manager.services.contents;\n     const localPath = contents.localPath(this._model.path);\n-    Private.updateCrumbs(\n-      this._crumbs,\n-      this._crumbSeps,\n-      localPath,\n-      this._hasPreferred,\n-      this._fullPath\n-    );\n+    const state = {\n+      path: localPath,\n+      hasPreferred: this._hasPreferred,\n+      fullPath: this._fullPath\n+    };\n+    if (this._previousState && JSONExt.deepEqual(state, this._previousState)) {\n+      return;\n+    }\n+    this._previousState = state;\n+    Private.updateCrumbs(this._crumbs, this._crumbSeps, state);\n   }\n \n   /**\n@@ -331,6 +335,7 @@ export class BreadCrumbs extends Widget {\n   private _crumbs: ReadonlyArray<HTMLElement>;\n   private _crumbSeps: ReadonlyArray<HTMLElement>;\n   private _fullPath: boolean;\n+  private _previousState: Private.ICrumbsState | null = null;\n }\n \n /**\n@@ -373,15 +378,23 @@ namespace Private {\n     Preferred\n   }\n \n+  /**\n+   * Breadcrumbs state.\n+   */\n+  export interface ICrumbsState {\n+    [key: string]: string | boolean;\n+    path: string;\n+    hasPreferred: boolean;\n+    fullPath: boolean;\n+  }\n+\n   /**\n    * Populate the breadcrumb node.\n    */\n   export function updateCrumbs(\n     breadcrumbs: ReadonlyArray<HTMLElement>,\n     separators: ReadonlyArray<HTMLElement>,\n-    path: string,\n-    hasPreferred: boolean,\n-    fullPath: boolean\n+    state: ICrumbsState\n   ): void {\n     const node = breadcrumbs[0].parentNode as HTMLElement;\n \n@@ -391,23 +404,23 @@ namespace Private {\n       node.removeChild(firstChild.nextSibling);\n     }\n \n-    if (hasPreferred) {\n+    if (state.hasPreferred) {\n       node.appendChild(breadcrumbs[Crumb.Home]);\n       node.appendChild(separators[0]);\n     } else {\n       node.appendChild(separators[0]);\n     }\n \n-    const parts = path.split('/');\n-    if (!fullPath && parts.length > 2) {\n+    const parts = state.path.split('/');\n+    if (!state.fullPath && parts.length > 2) {\n       node.appendChild(breadcrumbs[Crumb.Ellipsis]);\n       const grandParent = parts.slice(0, parts.length - 2).join('/');\n       breadcrumbs[Crumb.Ellipsis].title = grandParent;\n       node.appendChild(separators[1]);\n     }\n \n-    if (path) {\n-      if (!fullPath) {\n+    if (state.path) {\n+      if (!state.fullPath) {\n         if (parts.length >= 2) {\n           breadcrumbs[Crumb.Parent].textContent = parts[parts.length - 2];\n           node.appendChild(breadcrumbs[Crumb.Parent]);\n@@ -417,7 +430,7 @@ namespace Private {\n         }\n         breadcrumbs[Crumb.Current].textContent = parts[parts.length - 1];\n         node.appendChild(breadcrumbs[Crumb.Current]);\n-        breadcrumbs[Crumb.Current].title = path;\n+        breadcrumbs[Crumb.Current].title = state.path;\n         node.appendChild(separators[3]);\n       } else {\n         for (let i = 0; i < parts.length; i++) {\n",
    "test_patch": "diff --git a/packages/filebrowser/test/crumbs.spec.ts b/packages/filebrowser/test/crumbs.spec.ts\nindex 6260943fcf66..fb0ed957c97d 100644\n--- a/packages/filebrowser/test/crumbs.spec.ts\n+++ b/packages/filebrowser/test/crumbs.spec.ts\n@@ -223,6 +223,59 @@ describe('filebrowser/model', () => {\n         expect(items.length).toBe(3);\n         model.dispose();\n       });\n+\n+      it('should trigger DOM updates if state changes', async () => {\n+        const model = new FileBrowserModel({ manager });\n+        crumbs = new LogCrumbs({ model });\n+        let modifications = 0;\n+        const observer = new MutationObserver(() => modifications++);\n+        observer.observe(crumbs.node, {\n+          attributes: true,\n+          childList: true,\n+          subtree: true\n+        });\n+\n+        // Should modify the DOM once\n+        await model.cd(path);\n+        crumbs.update();\n+        await framePromise();\n+        expect(modifications).toBe(1);\n+\n+        // Should modify the DOM once\n+        await model.cd('..');\n+        crumbs.update();\n+        await framePromise();\n+        expect(modifications).toBe(2);\n+\n+        observer.disconnect();\n+        model.dispose();\n+      });\n+\n+      it('should not touch DOM if state is unchanged', async () => {\n+        const model = new FileBrowserModel({ manager });\n+        crumbs = new LogCrumbs({ model });\n+        let modifications = 0;\n+        const observer = new MutationObserver(() => modifications++);\n+        observer.observe(crumbs.node, {\n+          attributes: true,\n+          childList: true,\n+          subtree: true\n+        });\n+\n+        // Should modify the DOM once\n+        await model.cd(path);\n+        crumbs.update();\n+        await framePromise();\n+        expect(modifications).toBe(1);\n+\n+        // Should not increase the number of modifications\n+        crumbs.update();\n+        await framePromise();\n+        expect(modifications).toBe(1);\n+\n+        observer.disconnect();\n+        model.dispose();\n+      });\n     });\n   });\n });\n",
    "agent_patch": null,
    "FAIL_TO_PASS": [],
    "PASS_TO_PASS": [],
    "test_output_before": null,
    "errors_before": [],
    "failed_before": [],
    "test_output_after": null,
    "errors_after": [],
    "failed_after": []
  }
]